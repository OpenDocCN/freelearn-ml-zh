# 2

# å¯¹åˆ†ç±»å˜é‡è¿›è¡Œç¼–ç 

`Home owner`å˜é‡å…·æœ‰`owner`å’Œ`non-owner`çš„å€¼ï¼Œæ˜¯åˆ†ç±»å˜é‡ï¼ŒåŒæ ·`Marital status`å˜é‡å…·æœ‰`never married`ã€`married`ã€`divorced`å’Œ`widowed`çš„å€¼ï¼Œä¹Ÿæ˜¯åˆ†ç±»å˜é‡ã€‚åœ¨ä¸€äº›åˆ†ç±»å˜é‡ä¸­ï¼Œæ ‡ç­¾å…·æœ‰å†…åœ¨é¡ºåºï¼›ä¾‹å¦‚ï¼Œåœ¨`Student's grade`å˜é‡ä¸­ï¼Œ`A`ã€`B`ã€`C`å’Œ`Fail`çš„å€¼æ˜¯æœ‰åºçš„ï¼Œå…¶ä¸­`A`æ˜¯æœ€é«˜ç­‰çº§ï¼Œ`Fail`æ˜¯æœ€ä½ç­‰çº§ã€‚è¿™äº›è¢«ç§°ä¸º`City`å˜é‡ï¼Œå…·æœ‰`London`ã€`Manchester`ã€`Bristol`ç­‰å€¼ã€‚

åˆ†ç±»å˜é‡çš„å€¼é€šå¸¸ç¼–ç ä¸ºå­—ç¬¦ä¸²ã€‚ä¸ºäº†è®­ç»ƒå¤§å¤šæ•°æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ã€‚ç”¨æ•°å­—æ›¿æ¢å­—ç¬¦ä¸²çš„è¡Œä¸ºç§°ä¸º**åˆ†ç±»ç¼–ç **ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¤šç§åˆ†ç±»ç¼–ç æ–¹æ³•ã€‚

æœ¬ç« å°†æ¶µç›–ä»¥ä¸‹é£Ÿè°±ï¼š

+   é€šè¿‡å•çƒ­ç¼–ç åˆ›å»ºäºŒè¿›åˆ¶å˜é‡

+   å¯¹é¢‘ç¹ç±»åˆ«æ‰§è¡Œå•çƒ­ç¼–ç 

+   å°†ç±»åˆ«æ›¿æ¢ä¸ºè®¡æ•°æˆ–è§‚å¯Ÿé¢‘ç‡

+   å°†ç±»åˆ«æ›¿æ¢ä¸ºåºæ•°

+   åŸºäºç›®æ ‡å€¼è¿›è¡Œåºæ•°ç¼–ç 

+   å®ç°ç›®æ ‡å‡å€¼ç¼–ç 

+   ä½¿ç”¨è¯æ®æƒé‡è¿›è¡Œç¼–ç 

+   å¯¹ç¨€æœ‰æˆ–ç½•è§ç±»åˆ«è¿›è¡Œåˆ†ç»„

+   æ‰§è¡ŒäºŒè¿›åˆ¶ç¼–ç 

# æŠ€æœ¯è¦æ±‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`Matplotlib`ã€`pandas`ã€`NumPy`ã€`scikit-learn`ã€`feature-engine`å’Œ Category Encoders Python åº“ã€‚å¦‚æœæ‚¨éœ€è¦å®‰è£… Pythonï¼Œå…è´¹çš„ Anaconda Python å‘è¡Œç‰ˆï¼ˆ[`www.anaconda.com/`](https://www.anaconda.com/ï¼‰ï¼‰åŒ…æ‹¬å¤§å¤šæ•°æ•°å€¼è®¡ç®—åº“ã€‚

å¯ä»¥ä½¿ç”¨`pip`å®‰è£…`feature-engine`ï¼š

```py
pip install feature-engine
```

å¦‚æœæ‚¨ä½¿ç”¨ Anacondaï¼Œå¯ä»¥ä½¿ç”¨`conda`å®‰è£…`feature-engine`ï¼š

```py
conda install -c conda-forge feature_engine
```

è¦å®‰è£… Category Encodersï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹`pip`å‘½ä»¤ï¼š

```py
pip install category_encoders
```

æˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª*UCI æœºå™¨å­¦ä¹ ä»“åº“*çš„**Credit Approval**æ•°æ®é›†ï¼ˆ[https://archive.ics.uci.edu/](https://archive.ics.uci.edu/)ï¼‰ï¼Œè¯¥æ•°æ®é›†æ ¹æ® CC BY 4.0 åˆ›æ„å…±äº«è®¸å¯ï¼š[`creativecommons.org/licenses/by/4.0/legalcode`](https://creativecommons.org/licenses/by/4.0/legalcode)ã€‚æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹é“¾æ¥æ‰¾åˆ°æ•°æ®é›†ï¼š[`archive.ics.uci.edu/dataset/27/credit+approval`](http://archive.ics.uci.edu/dataset/27/credit+approval)ã€‚

æˆ‘å·²ä¸‹è½½å¹¶ä¿®æ”¹äº†å¦‚æœ¬ç¬”è®°æœ¬æ‰€ç¤ºçš„æ•°æ®ï¼š[`github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/credit-approval-dataset.ipynb`](https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/credit-approval-dataset.ipynb)ã€‚

æ‚¨å¯ä»¥åœ¨é™„å¸¦çš„ GitHub ä»“åº“ä¸­æ‰¾åˆ°ä¿®æ”¹åçš„æ•°æ®é›†å‰¯æœ¬ï¼š[`github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/`](https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/)ã€‚

æ³¨æ„

åœ¨å¯¹åˆ†ç±»å˜é‡è¿›è¡Œç¼–ç ä¹‹å‰ï¼Œä½ å¯èƒ½æƒ³è¦å¡«å……å®ƒä»¬çš„ç¼ºå¤±æ•°æ®ã€‚æŸ¥çœ‹*ç¬¬ä¸€ç« *ï¼Œ*å¡«å……* *ç¼ºå¤±æ•°æ®*çš„æ–¹æ³•ã€‚

# é€šè¿‡å•çƒ­ç¼–ç åˆ›å»ºäºŒè¿›åˆ¶å˜é‡

å¦‚æœç±»åˆ«å­˜åœ¨ï¼Œåˆ™ä¸º`1`ï¼Œå¦åˆ™ä¸º`0`ã€‚

ä»¥ä¸‹è¡¨æ ¼æ˜¾ç¤ºäº†`Smoker`å˜é‡çš„å•çƒ­ç¼–ç è¡¨ç¤ºï¼Œå…¶ä¸­åŒ…å«`Smoker`å’Œ`Non-Smoker`ç±»åˆ«ï¼š

![å›¾ 2.1 â€“ Smoker å˜é‡çš„å•çƒ­ç¼–ç è¡¨ç¤º](img/B22396_02_01.jpg)

å›¾ 2.1 â€“ Smoker å˜é‡çš„å•çƒ­ç¼–ç è¡¨ç¤º

å¦‚*å›¾ 2**.1 æ‰€ç¤ºï¼Œä»`Smoker`å˜é‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºä¸€ä¸ªäºŒè¿›åˆ¶å˜é‡`Smoker`ï¼Œå¯¹äºå¸çƒŸè€…æ˜¾ç¤ºå€¼ä¸º`1`ï¼Œæˆ–è€…æ¨å¯¼å‡ºä¸€ä¸ª`Non-Smoker`çš„äºŒè¿›åˆ¶å˜é‡ï¼Œå¯¹äºä¸å¸çƒŸè€…æ˜¾ç¤ºå€¼ä¸º`1`ã€‚

å¯¹äºå…·æœ‰`red`ï¼Œ`blue`å’Œ`green`å€¼çš„`Color`åˆ†ç±»å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ä¸ªå˜é‡ï¼Œåˆ†åˆ«ç§°ä¸º`red`ï¼Œ`blue`å’Œ`green`ã€‚å¦‚æœè§‚å¯Ÿç»“æœå¯¹åº”ç›¸åº”çš„é¢œè‰²ï¼Œè¿™äº›å˜é‡å°†è¢«åˆ†é…å€¼ä¸º`1`ï¼Œå¦‚æœä¸å¯¹åº”ï¼Œåˆ™ä¸º`0`ã€‚

ä¸€ä¸ªå…·æœ‰*k*ä¸ªå”¯ä¸€ç±»åˆ«çš„åˆ†ç±»å˜é‡å¯ä»¥ä½¿ç”¨*k-1*ä¸ªäºŒè¿›åˆ¶å˜é‡è¿›è¡Œç¼–ç ã€‚å¯¹äº`Smoker`å˜é‡ï¼Œ*k*æ˜¯*2*ï¼Œå› ä¸ºå®ƒåŒ…å«ä¸¤ä¸ªæ ‡ç­¾ï¼ˆ`Smoker`å’Œ`Non-Smoker`ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªäºŒè¿›åˆ¶å˜é‡ï¼ˆ*k - 1 = 1*ï¼‰æ¥æ•æ‰æ‰€æœ‰ä¿¡æ¯ã€‚å¯¹äº`Color`å˜é‡ï¼Œå®ƒæœ‰ 3 ä¸ªç±»åˆ«ï¼ˆ*k = 3*ï¼›`red`ï¼Œ`blue`å’Œ`green`ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ 2 ä¸ªï¼ˆ*k - 1 = 2*ï¼‰äºŒè¿›åˆ¶å˜é‡æ¥æ•æ‰æ‰€æœ‰ä¿¡æ¯ï¼Œä»¥ä¾¿ä»¥ä¸‹å‘ç”Ÿï¼š

+   å¦‚æœè§‚å¯Ÿç»“æœæ˜¯çº¢è‰²ï¼Œå®ƒå°†è¢«`red`å˜é‡æ•è·ï¼ˆ`red` = `1`ï¼Œ`blue` = `0`ï¼‰

+   å¦‚æœè§‚å¯Ÿç»“æœæ˜¯è“è‰²ï¼Œå®ƒå°†è¢«`blue`å˜é‡æ•è·ï¼ˆ`red` = `0`ï¼Œ`blue` = `1`ï¼‰

+   å¦‚æœè§‚å¯Ÿç»“æœæ˜¯ç»¿è‰²ï¼Œå®ƒå°†è¢«`red`å’Œ`blue`çš„ç»„åˆæ•è·ï¼ˆ`red` = `0`ï¼Œ`blue` = `0`ï¼‰

å°†ç¼–ç åˆ°*k-1*ä¸ªäºŒè¿›åˆ¶å˜é‡éå¸¸é€‚åˆçº¿æ€§æ¨¡å‹ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½æ›´å–œæ¬¢ä½¿ç”¨*k*ä¸ªäºŒè¿›åˆ¶å˜é‡å¯¹åˆ†ç±»å˜é‡è¿›è¡Œç¼–ç ï¼š

+   åœ¨è®­ç»ƒå†³ç­–æ ‘æ—¶ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šåŒæ—¶è¯„ä¼°æ•´ä¸ªç‰¹å¾ç©ºé—´

+   åœ¨é€’å½’é€‰æ‹©ç‰¹å¾æ—¶

+   åœ¨ç¡®å®šå˜é‡ä¸­æ¯ä¸ªç±»åˆ«çš„ç›¸å¯¹é‡è¦æ€§æ—¶

åœ¨è¿™ä¸ªèœè°±ä¸­ï¼Œæˆ‘ä»¬å°†æ¯”è¾ƒ`pandas`ï¼Œ`scikit-learn`å’Œ`feature-engine`çš„å•çƒ­ç¼–ç å®ç°ã€‚

## å¦‚ä½•åšåˆ°...

é¦–å…ˆï¼Œè®©æˆ‘ä»¬è¿›è¡Œä¸€äº›å¯¼å…¥å¹¶å‡†å¤‡å¥½æ•°æ®ï¼š

1.  ä»`scikit-learn`å¯¼å…¥`pandas`å’Œ`train_test_split`å‡½æ•°ï¼š

    ```py
    import pandas as pd
    from sklearn.model_selection import train_test_split
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ Credit Approval æ•°æ®é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    ```

1.  è®©æˆ‘ä»¬å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

1.  è®©æˆ‘ä»¬æ£€æŸ¥`A4`å˜é‡çš„å”¯ä¸€ç±»åˆ«ï¼š

    ```py
    X_train["A4"].unique()
    ```

    æˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹è¾“å‡ºä¸­çœ‹åˆ°`A4`çš„ç‹¬ç‰¹å€¼ï¼š

    ```py
    A4 into *k-1* binary variables using pandas and then inspect the first five rows of the resulting DataFrame:

    ```

    dummies = pd.get_dummies(

    X_train["A4"], drop_first=True)

    dummies.head()

    ```py

    ```

æ³¨æ„

ä½¿ç”¨`pandas`çš„`get_dummies()`ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`dummy_na`å‚æ•°å¿½ç•¥æˆ–ç¼–ç ç¼ºå¤±æ•°æ®ã€‚é€šè¿‡å°†`dummy_na=True`è®¾ç½®ï¼Œç¼ºå¤±æ•°æ®å°†ç¼–ç åœ¨ä¸€ä¸ªæ–°çš„äºŒè¿›åˆ¶å˜é‡ä¸­ã€‚è¦å°†å˜é‡ç¼–ç ä¸º*k*ä¸ªè™šæ‹Ÿå˜é‡ï¼Œè¯·ä½¿ç”¨`drop_first=False`ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°*æ­¥éª¤ 5*çš„è¾“å‡ºï¼Œå…¶ä¸­æ¯ä¸ªæ ‡ç­¾ç°åœ¨éƒ½æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å˜é‡ï¼š

```py
Â Â Â Â Â Â MissingÂ Â Â Â Â Â Â Â lÂ Â Â Â Â Â Â Â uÂ Â Â Â Â Â Â Â y
596Â Â Â Â Â FalseÂ Â FalseÂ Â Â TrueÂ Â False
303Â Â Â Â Â FalseÂ Â FalseÂ Â Â TrueÂ Â False
204Â Â Â Â Â FalseÂ Â FalseÂ Â FalseÂ Â Â True
351Â Â Â Â Â FalseÂ Â FalseÂ Â FalseÂ Â Â True
118Â Â Â Â Â FalseÂ Â FalseÂ Â Â TrueÂ Â False
```

1.  ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†æ‰€æœ‰åˆ†ç±»å˜é‡ç¼–ç ä¸º*k-1*ä¸ªäºŒè¿›åˆ¶å˜é‡ï¼š

    ```py
    X_train_enc = pd.get_dummies(X_train, drop_first=True)
    X_test_enc = pd.get_dummies(X_test, drop_first=True)
    ```

å¤‡æ³¨

`pandas`çš„`get_dummies()`é»˜è®¤æƒ…å†µä¸‹å°†å¯¹è±¡ã€å­—ç¬¦ä¸²æˆ–ç±»åˆ«ç±»å‹çš„æ‰€æœ‰å˜é‡ç¼–ç ã€‚è¦ç¼–ç å˜é‡å­é›†ï¼Œè¯·å°†å˜é‡ååˆ—è¡¨ä¼ é€’ç»™`columns`å‚æ•°ã€‚

1.  è®©æˆ‘ä»¬æ£€æŸ¥ç»“æœ DataFrame çš„å‰äº”è¡Œï¼š

    ```py
    X_train_enc.head()
    ```

å¤‡æ³¨

å½“ç¼–ç å¤šä¸ªå˜é‡æ—¶ï¼Œ`get_dummies()`æ•è·å˜é‡å â€“ æ¯”å¦‚ï¼Œ`A1` â€“ å¹¶åœ¨ç±»åˆ«åå‰æ”¾ç½®ä¸€ä¸ªä¸‹åˆ’çº¿æ¥æ ‡è¯†ç»“æœäºŒè¿›åˆ¶å˜é‡ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹è¾“å‡ºä¸­çœ‹åˆ°äºŒè¿›åˆ¶å˜é‡ï¼š

![å›¾ 2.2 â€“ ä¸€ä¸ªè½¬æ¢åçš„ DataFrameï¼Œæ˜¾ç¤ºäº†æ•°å€¼å˜é‡éšåæ˜¯åˆ†ç±»å˜é‡çš„ç‹¬çƒ­ç¼–ç è¡¨ç¤º](img/B22396_02_02.jpg)

å›¾ 2.2 â€“ ä¸€ä¸ªè½¬æ¢åçš„ DataFrameï¼Œæ˜¾ç¤ºäº†æ•°å€¼å˜é‡éšåæ˜¯åˆ†ç±»å˜é‡çš„ç‹¬çƒ­ç¼–ç è¡¨ç¤º

å¤‡æ³¨

`pandas`çš„`get_dummies()`å°†ä¸º DataFrame ä¸­çœ‹åˆ°çš„æ¯ä¸ªç±»åˆ«åˆ›å»ºä¸€ä¸ªäºŒè¿›åˆ¶å˜é‡ã€‚å› æ­¤ï¼Œå¦‚æœè®­ç»ƒé›†ä¸­çš„ç±»åˆ«æ¯”æµ‹è¯•é›†ä¸­çš„å¤šï¼Œ`get_dummies()`å°†åœ¨è½¬æ¢åçš„è®­ç»ƒé›†ä¸­è¿”å›æ¯”æµ‹è¯•é›†æ›´å¤šçš„åˆ—ï¼Œåä¹‹äº¦ç„¶ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæœ€å¥½ä½¿ç”¨`scikit-learn`æˆ–`feature-engine`è¿›è¡Œç‹¬çƒ­ç¼–ç ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨`scikit-learn`è¿›è¡Œç‹¬çƒ­ç¼–ç ã€‚

1.  è®©æˆ‘ä»¬å¯¼å…¥`scikit-learn`ä¸­çš„ç¼–ç å™¨å’Œ`ColumnTransformer`ï¼š

    ```py
    from sklearn.preprocessing import OneHotEncoder
    from sklearn.compose import ColumnTransformer
    ```

1.  è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«åˆ†ç±»å˜é‡åçš„åˆ—è¡¨ï¼š

    ```py
    cat_vars = X_train.select_dtypes(
    Â Â Â Â include="O").columns.to_list()
    ```

1.  è®©æˆ‘ä»¬è®¾ç½®ç¼–ç å™¨ä»¥åˆ›å»º*k-1*ä¸ªäºŒè¿›åˆ¶å˜é‡ï¼š

    ```py
    encoder = OneHotEncoder(drop="first",
    Â Â Â Â sparse_output=False)
    ```

å¤‡æ³¨

è¦å°†å˜é‡ç¼–ç ä¸º*k*ä¸ªè™šæ‹Ÿå˜é‡ï¼Œå°†`drop`å‚æ•°è®¾ç½®ä¸º`None`ã€‚è¦å°†ä»…äºŒè¿›åˆ¶å˜é‡ç¼–ç ä¸º*k-1*ï¼Œå°†`drop`å‚æ•°è®¾ç½®ä¸º`if_binary`ã€‚åè€…å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå°†äºŒè¿›åˆ¶å˜é‡ç¼–ç ä¸º*k*ä¸ªè™šæ‹Ÿå˜é‡æ˜¯å¤šä½™çš„ã€‚

1.  è®©æˆ‘ä»¬å°†ç¼–ç é™åˆ¶åœ¨åˆ†ç±»å˜é‡ä¸Šï¼š

    ```py
    ct = ColumnTransformer(
    Â Â Â Â [("encoder", encoder, cat_vars)],
    Â Â Â Â remainder="passthrough",
    Â Â Â Â force_int_remainder_cols=False,
    ).set_output(transform="pandas")
    ```

1.  è®©æˆ‘ä»¬è°ƒæ•´ç¼–ç å™¨ï¼Œä½¿å…¶èƒ½å¤Ÿè¯†åˆ«è¦ç¼–ç çš„ç±»åˆ«ï¼š

    ```py
    ct.fit(X_train)
    ```

1.  è®©æˆ‘ä»¬æ£€æŸ¥å°†è¢«äºŒè¿›åˆ¶å˜é‡è¡¨ç¤ºçš„ç±»åˆ«ï¼š

    ```py
    ct.named_transformers_["encoder"].categories_
    ```

    å˜æ¢å™¨å°†ä¸ºä»¥ä¸‹ç±»åˆ«æ·»åŠ äºŒè¿›åˆ¶å˜é‡ï¼š

![å›¾ 2.3 â€“ å°†è¢«ç¼–ç ä¸ºäºŒè¿›åˆ¶å˜é‡çš„ç±»åˆ«æ•°ç»„ï¼ˆæ¯ä¸ªå˜é‡ä¸€ä¸ªæ•°ç»„ï¼‰](img/B22396_02_03.jpg)

å›¾ 2.3 â€“ å°†è¢«ç¼–ç ä¸ºäºŒè¿›åˆ¶å˜é‡çš„ç±»åˆ«æ•°ç»„ï¼ˆæ¯ä¸ªå˜é‡ä¸€ä¸ªæ•°ç»„ï¼‰

å¤‡æ³¨

`scikit-learn`çš„`OneHotEncoder()`åªä¼šå¯¹ä»è®­ç»ƒé›†ä¸­å­¦ä¹ åˆ°çš„ç±»åˆ«è¿›è¡Œç¼–ç ã€‚å¦‚æœæµ‹è¯•é›†ä¸­æœ‰æ–°çš„ç±»åˆ«ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®`handle_unknown`å‚æ•°ä¸º`ignore`ã€`error`æˆ–`infrequent_if_exists`æ¥æŒ‡ç¤ºç¼–ç å™¨å¿½ç•¥å®ƒä»¬ã€è¿”å›é”™è¯¯æˆ–ç”¨ä¸å¸¸è§çš„ç±»åˆ«æ›¿æ¢å®ƒä»¬ã€‚

1.  è®©æˆ‘ä»¬ç¼–ç åˆ†ç±»å˜é‡ï¼š

    ```py
    X_train_enc = ct.transform(X_train)
    X_test_enc = ct.transform(X_test)
    ```

    ç¡®ä¿é€šè¿‡æ‰§è¡Œ`X_test_enc.head()`æ¥æ£€æŸ¥ç»“æœã€‚

1.  ä¸ºäº†ç†Ÿæ‚‰è¾“å‡ºï¼Œè®©æˆ‘ä»¬æ‰“å°ç»“æœ DataFrame çš„å˜é‡åç§°ï¼š

    ```py
    ct.get_feature_names_out()
    ```

    åœ¨ä»¥ä¸‹å›¾åƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è½¬æ¢åçš„ DataFrame ä¸­çš„å˜é‡åç§°ï¼š

![å›¾ 2.4 â€“ ç»“æœ DataFrame ä¸­å˜é‡çš„åç§°æ•°ç»„](img/B22396_02_04.jpg)

å›¾ 2.4 â€“ ç»“æœ DataFrame ä¸­å˜é‡çš„åç§°æ•°ç»„

æ³¨æ„

`ColumnTransformer()`åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¼šæ›´æ”¹å˜é‡çš„åç§°å’Œé¡ºåºã€‚å¦‚æœå˜é‡è¢«ç¼–ç ï¼Œå®ƒå°†é™„åŠ `encoder`å‰ç¼€ï¼›å¦‚æœå˜é‡æœªè¢«ä¿®æ”¹ï¼Œå®ƒå°†é™„åŠ `remainder`å‰ç¼€ã€‚

ä¸ºäº†æ€»ç»“è¿™ä¸ªèœè°±ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨`feature-engine`è¿›è¡Œ one-hot ç¼–ç ã€‚

1.  è®©æˆ‘ä»¬ä»`f``eature-engine`å¯¼å…¥ç¼–ç å™¨ï¼š

    ```py
    from feature_engine.encoding import OneHotEncoder
    ```

1.  è®©æˆ‘ä»¬è®¾ç½®ç¼–ç å™¨ï¼Œä½¿å…¶è¿”å›*k-1*ä¸ªäºŒè¿›åˆ¶å˜é‡ï¼š

    ```py
    ohe_enc = OneHotEncoder(drop_last=True)
    ```

æ³¨æ„

`feature-engine`çš„`OneHotEncoder()`é»˜è®¤ç¼–ç æ‰€æœ‰åˆ†ç±»å˜é‡ã€‚è¦ç¼–ç å˜é‡çš„å­é›†ï¼Œè¯·ä¼ é€’å˜é‡åç§°åˆ—è¡¨ï¼š`OneHotEncoder(variables=["A1", "A4"])`ã€‚è¦ç¼–ç æ•°å€¼å˜é‡ï¼Œå°†`ignore_format`å‚æ•°è®¾ç½®ä¸º`True`æˆ–å°†å˜é‡è½¬æ¢ä¸ºå¯¹è±¡ç±»å‹ã€‚

1.  è®©æˆ‘ä»¬å°†ç¼–ç å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ä¸­ï¼Œä»¥ä¾¿å®ƒå­¦ä¹ è¦ç¼–ç çš„ç±»åˆ«å’Œå˜é‡ï¼š

    ```py
    ohe_enc.fit(X_train)
    ```

æ³¨æ„

è¦å°†äºŒè¿›åˆ¶å˜é‡ç¼–ç ä¸º*k-1*ï¼Œå¹¶å°†å…¶ä»–åˆ†ç±»å˜é‡ç¼–ç ä¸º*k*ä¸ªè™šæ‹Ÿå˜é‡ï¼Œå°†`drop_last_binary`å‚æ•°è®¾ç½®ä¸º`True`ã€‚

1.  è®©æˆ‘ä»¬æ¢ç´¢å°†è¦ç¼–ç çš„å˜é‡ï¼š

    ```py
    ohe_enc.variables_
    ```

    è½¬æ¢å™¨æ‰¾åˆ°äº†å¹¶å­˜å‚¨äº†å¯¹è±¡æˆ–åˆ†ç±»ç±»å‹çš„å˜é‡ï¼Œå¦‚ä¸‹é¢çš„è¾“å‡ºæ‰€ç¤ºï¼š

    ```py
    ['A1', 'A4', 'A5', 'A6', 'A7', 'A9', 'A10', 'A12', 'A13']
    ```

1.  è®©æˆ‘ä»¬æ¢ç´¢å°†åˆ›å»ºè™šæ‹Ÿå˜é‡çš„ç±»åˆ«ï¼š

    ```py
    ohe_enc.encoder_dict_
    ```

    ä»¥ä¸‹å­—å…¸åŒ…å«å°†ç¼–ç åˆ°æ¯ä¸ªå˜é‡ä¸­çš„ç±»åˆ«ï¼š

    ```py
     {'A1': ['a', 'b'],
     'A4': ['u', 'y', 'Missing'],
     'A5': ['g', 'p', 'Missing'],
     'A6': ['c', 'q', 'w', 'ff', 'm', 'i', 'e', 'cc', 'x', 'd', 'k', 'j', 'Missing', 'aa'],
     'A7': ['v', 'ff', 'h', 'dd', 'z', 'bb', 'j', 'Missing', 'n'],
     'A9': ['t'],
     'A10': ['t'],
     'A12': ['t'],
     'A13': ['g', 's']}
    ```

1.  è®©æˆ‘ä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­ç¼–ç åˆ†ç±»å˜é‡ï¼š

    ```py
    X_train_enc = ohe_enc.transform(X_train)
    X_test_enc = ohe_enc.transform(X_test)
    ```

    å¦‚æœæˆ‘ä»¬æ‰§è¡Œ`X_train_enc.head()`ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»¥ä¸‹ DataFrameï¼š

![å›¾ 2.5 â€“ è½¬æ¢åçš„ DataFrameï¼Œå…¶ä¸­åŒ…å«æ•°å€¼å˜é‡ï¼Œåé¢è·Ÿç€åˆ†ç±»å˜é‡çš„ one-hot ç¼–ç è¡¨ç¤º](img/B22396_02_05.jpg)

å›¾ 2.5 â€“ è½¬æ¢åçš„ DataFrameï¼Œå…¶ä¸­åŒ…å«æ•°å€¼å˜é‡ï¼Œåé¢è·Ÿç€åˆ†ç±»å˜é‡çš„ one-hot ç¼–ç è¡¨ç¤º

æ³¨æ„åˆ°`A4`åˆ†ç±»å˜é‡è¢«æ›¿æ¢ä¸º`A4_u`ã€`A4_y`ç­‰ç­‰ã€‚

æ³¨æ„

æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ`ohe_enc.get_feature_names_out()`æ¥è·å–è½¬æ¢æ•°æ®é›†ä¸­æ‰€æœ‰å˜é‡çš„åç§°ã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªèœè°±ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`pandas`ã€`scikit-learn`å’Œ`feature-engine`å¯¹åˆ†ç±»å˜é‡è¿›è¡Œäº† one-hot ç¼–ç ã€‚

`pandas` çš„ `get_dummies()` å°†ç±»åˆ«å˜é‡æ›¿æ¢ä¸ºè¡¨ç¤ºæ¯ä¸ªç±»åˆ«çš„äºŒè¿›åˆ¶å˜é‡é›†åˆã€‚å½“åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šä½¿ç”¨æ—¶ï¼Œå®ƒè¿”å›æ•°å€¼å˜é‡ï¼Œéšåæ˜¯æ¯ä¸ªå˜é‡ç±»å‹ä¸ºå¯¹è±¡ã€å­—ç¬¦ä¸²æˆ–ç±»åˆ«çš„æ¯ä¸ªå˜é‡ä¸­çœ‹åˆ°çš„æ¯ä¸ªç±»åˆ«çš„ç‹¬çƒ­ç¼–ç è¡¨ç¤ºã€‚

æ³¨æ„

`pandas` ä¼šä¸ºæ•°æ®é›†ä¸­å‡ºç°çš„æ¯ä¸ªç±»åˆ«è¿”å›äºŒè¿›åˆ¶å˜é‡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸ºäº†é¿å…æ•°æ®æ³„éœ²å¹¶é¢„æµ‹éƒ¨ç½²æƒ…å†µï¼Œæˆ‘ä»¬åªæƒ³ä¸ºè®­ç»ƒé›†ä¸­å‡ºç°çš„ç±»åˆ«è¿”å›è™šæ‹Ÿå˜é‡ã€‚å› æ­¤ï¼Œä½¿ç”¨ `scikit-learn` å’Œ `feature-engine` æ›´ä¸ºå®‰å…¨ã€‚

`OneHotEncoder()` ä» `scikit-learn` æˆ– `feature-engine` ä¸­å­¦ä¹ ï¼Œåœ¨åº”ç”¨ `fit()` æ—¶ä»è®­ç»ƒé›†ä¸­è¯†åˆ«å‡ºåº”è¯¥ç”¨äºŒè¿›åˆ¶å˜é‡è¡¨ç¤ºçš„ç±»åˆ«ã€‚ä½¿ç”¨ `transform()`ï¼Œ`scikit-learn` ä»…è¿”å›äºŒè¿›åˆ¶å˜é‡ï¼Œè€Œ `feature-engine` åˆ™è¿”å›æ•°å€¼å˜é‡ï¼Œéšåæ˜¯ç±»åˆ«å˜é‡çš„ç‹¬çƒ­ç¼–ç è¡¨ç¤ºã€‚

`scikit-learn` çš„ `OneHotEncoder()` é»˜è®¤å¯¹æ‰€æœ‰å˜é‡è¿›è¡Œç¼–ç ã€‚ä¸ºäº†é™åˆ¶ç¼–ç åªé’ˆå¯¹ç±»åˆ«å˜é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `ColumnTransformer()`ã€‚æˆ‘ä»¬å°† `transform()` çš„è¾“å‡ºè®¾ç½®ä¸º `pandas`ï¼Œä»¥è·å¾—ç»“æœæ•°æ®ä½œä¸º DataFrameã€‚

æ³¨æ„

ç‹¬çƒ­ç¼–ç é€‚ç”¨äºçº¿æ€§æ¨¡å‹ã€‚å®ƒè¿˜ä¼šæ‰©å±•ç‰¹å¾ç©ºé—´ã€‚å¦‚æœä½ çš„æ•°æ®é›†ä¸­åŒ…å«è®¸å¤šç±»åˆ«å˜é‡æˆ–é«˜åº¦åŸºæ•°å˜é‡ï¼Œä½ å¯ä»¥é€šè¿‡ä»…ç¼–ç æœ€é¢‘ç¹çš„ç±»åˆ«æ¥é™åˆ¶äºŒè¿›åˆ¶å˜é‡çš„æ•°é‡ã€‚ä½ å¯ä»¥åƒæˆ‘ä»¬åœ¨ *å¯¹é¢‘ç¹ç±»åˆ«è¿›è¡Œç‹¬çƒ­ç¼–ç * é£Ÿè°±ä¸­æè¿°çš„é‚£æ ·ï¼Œä½¿ç”¨ `scikit-learn` å’Œ `feature-engine` è‡ªåŠ¨å®Œæˆæ­¤æ“ä½œã€‚

## è¿˜æœ‰æ›´å¤š...

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Category Encoders Python åº“è¿›è¡Œç‹¬çƒ­ç¼–ç ï¼š[`contrib.scikit-learn.org/category_encoders/onehot.html`](https://contrib.scikit-learn.org/category_encoders/onehot.html)ã€‚

ä¸ºäº†é™åˆ¶äºŒè¿›åˆ¶å˜é‡çš„æ•°é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è¦ç¼–ç çš„ç±»åˆ«å’Œè¦å¿½ç•¥çš„ç±»åˆ«ï¼›æŸ¥çœ‹ä»¥ä¸‹æ–‡ç« ä¸­çš„ Python ç¤ºä¾‹ï¼šhttps://www.blog.trainindata.com/one-hot-encoding-categorical-variables/ã€‚

# å¯¹é¢‘ç¹ç±»åˆ«è¿›è¡Œç‹¬çƒ­ç¼–ç 

ç‹¬çƒ­ç¼–ç ä½¿ç”¨äºŒè¿›åˆ¶å˜é‡è¡¨ç¤ºæ¯ä¸ªå˜é‡çš„ç±»åˆ«ã€‚å› æ­¤ï¼Œå¯¹é«˜åº¦åŸºæ•°å˜é‡æˆ–å…·æœ‰å¤šä¸ªç±»åˆ«ç‰¹å¾çš„é›†åˆè¿›è¡Œç‹¬çƒ­ç¼–ç å¯ä»¥æ˜¾è‘—æ‰©å±•ç‰¹å¾ç©ºé—´ã€‚è¿™åè¿‡æ¥å¯èƒ½ä¼šå¢åŠ ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹çš„è®¡ç®—æˆæœ¬æˆ–é™ä½å…¶æ€§èƒ½ã€‚ä¸ºäº†å‡å°‘äºŒè¿›åˆ¶å˜é‡çš„æ•°é‡ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æœ€é¢‘ç¹çš„ç±»åˆ«è¿›è¡Œç‹¬çƒ­ç¼–ç ã€‚å¯¹é¡¶çº§ç±»åˆ«è¿›è¡Œç‹¬çƒ­ç¼–ç ç›¸å½“äºå°†å‰©ä½™çš„ã€è¾ƒå°‘å‡ºç°çš„ç±»åˆ«è§†ä¸ºä¸€ä¸ªå”¯ä¸€çš„ç±»åˆ«ã€‚

åœ¨æœ¬é£Ÿè°±ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `pandas`ã€`Scikit-learn` å’Œ `feature-engine` å®ç°å¯¹æœ€æµè¡Œç±»åˆ«çš„ç‹¬çƒ­ç¼–ç ã€‚

## å¦‚ä½•å®ç°...

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¯¼å…¥å¿…è¦çš„ Python åº“å¹¶å‡†å¤‡å¥½æ•°æ®é›†ï¼š

1.  å¯¼å…¥æ‰€éœ€çš„ Python åº“ã€å‡½æ•°å’Œç±»ï¼š

    ```py
    import pandas as pd
    import numpy as np
    from sklearn.model_selection import train_test_split
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ä¿¡ç”¨å®¡æ‰¹æ•°æ®é›†å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

å¤‡æ³¨

åœ¨è®­ç»ƒé›†ä¸­éœ€è¦ç¡®å®šæœ€é¢‘ç¹çš„ç±»åˆ«ã€‚è¿™æ˜¯ä¸ºäº†é¿å…æ•°æ®æ³„éœ²ã€‚

1.  è®©æˆ‘ä»¬æ£€æŸ¥`A6`å˜é‡çš„å”¯ä¸€ç±»åˆ«ï¼š

    ```py
    X_train["A6"].unique()
    ```

    `A6`çš„å”¯ä¸€å€¼æ˜¾ç¤ºåœ¨ä»¥ä¸‹è¾“å‡ºä¸­ï¼š

    ```py
    A6, sort them in decreasing order, and then display the five most frequent categories:

    ```

    X_train["A6"].value_counts().sort_values(

    ascending=False).head(5)

    ```py

    We can see the five most frequent categories and the number of observations per category in the following output:

    ```

    A6

    cÂ Â Â Â Â Â 93

    qÂ Â Â Â Â Â 56

    wÂ Â Â Â Â Â 48

    iÂ Â Â Â Â Â 41

    ffÂ Â Â Â Â 38

    ä½¿ç”¨*æ­¥éª¤ 4*ä¸­çš„ä»£ç é€šè¿‡åˆ—è¡¨æ¨å¯¼å¼å°† A6 æ”¾å…¥ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼š

    ```py
    top_5 = [x for x in X_train[
    " A6"].value_counts().sort_values(
    ascending=False).head(5).index
    ]
    ```

    ```py

    ```

1.  è®©æˆ‘ä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„å‰¯æœ¬ä¸­ä¸ºæ¯ä¸ªé¡¶çº§ç±»åˆ«æ·»åŠ ä¸€ä¸ªäºŒå…ƒå˜é‡ï¼š

    ```py
    X_train_enc = X_train.copy()
    X_test_enc = X_test.copy()
    for label in top_5:
    Â Â Â Â X_train_enc[f"A6_{label}"] = np.where(
    Â Â Â Â Â Â Â Â X_train["A6"] == label, 1, 0)
    Â Â Â Â X_test_enc[f"A6_{label}"] = np.where(
    Â Â Â Â Â Â Â Â X_test["A6"] == label, 1, 0)
    ```

1.  è®©æˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸­æ˜¾ç¤ºåŸå§‹å˜é‡å’Œç¼–ç å˜é‡`A6`çš„å‰`10`è¡Œï¼š

    ```py
    X_train_enc[["A6"] + [f"A6_{
    Â Â Â Â label}" for label in top_5]].head(10)
    ```

    åœ¨ç¬¬ 7 æ­¥çš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°`A6`å˜é‡ï¼Œéšåæ˜¯äºŒå…ƒå˜é‡ï¼š

    ```py
    Â Â Â Â Â Â A6Â Â A6_cÂ Â A6_qÂ Â A6_wÂ Â A6_iÂ Â A6_ff
    596Â Â Â cÂ Â Â Â Â Â 1Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â Â Â 0
    303Â Â Â qÂ Â Â Â Â Â 0Â Â Â Â Â Â 1Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â Â Â 0
    204Â Â Â wÂ Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 1Â Â Â Â Â Â 0Â Â Â Â Â Â Â Â 0
    351Â Â ffÂ Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â Â Â 1
    118Â Â Â mÂ Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â Â Â 0
    247Â Â Â qÂ Â Â Â Â Â 0Â Â Â Â Â Â 1Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â Â Â 0
    652Â Â Â iÂ Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 1Â Â Â Â Â Â Â Â 0
    513Â Â Â eÂ Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â Â Â 0
    230Â Â ccÂ Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â 0Â Â Â Â Â Â Â Â 0
    scikit-learn.
    ```

1.  è®©æˆ‘ä»¬å¯¼å…¥ç¼–ç å™¨ï¼š

    ```py
    from sklearn.preprocessing import OneHotEncoder
    ```

1.  è®©æˆ‘ä»¬è®¾ç½®ç¼–ç å™¨ï¼Œä»¥ç¼–ç è‡³å°‘æœ‰`39`ä¸ªè§‚å¯Ÿå€¼çš„ç±»åˆ«ï¼Œå¹¶å°†ç¼–ç çš„ç±»åˆ«æ•°é‡é™åˆ¶ä¸º`5`ï¼š

    ```py
    encoder = OneHotEncoder(
    Â Â Â Â min_frequency=39,
    Â Â Â Â max_categories=5,
    Â Â Â Â sparse_output=False,
    ).set_output(transform="pandas")
    ```

1.  æœ€åï¼Œè®©æˆ‘ä»¬å°†è½¬æ¢å™¨æ‹Ÿåˆåˆ°ä¸¤ä¸ªé«˜åŸºæ•°å˜é‡ï¼Œç„¶åè½¬æ¢æ•°æ®ï¼š

    ```py
    X_train_enc = encoder.fit_transform(X_train[
    Â Â Â Â ['A6', 'A7']])
    X_test_enc = encoder.transform(X_test[['A6', 'A7']])
    ```

    å¦‚æœæ‚¨æ‰§è¡Œ`X_train_enc.head()`ï¼Œæ‚¨å°†çœ‹åˆ°ç”Ÿæˆçš„ DataFrameï¼š

![å›¾ 2.6 â€“ åŒ…å«è‡³å°‘æœ‰ 39 ä¸ªè§‚å¯Ÿå€¼çš„ç±»åˆ«äºŒå…ƒå˜é‡ä»¥åŠè¡¨ç¤ºæ‰€æœ‰å‰©ä½™ç±»åˆ«çš„é¢å¤–äºŒå…ƒå˜é‡çš„è½¬æ¢ DataFrame](img/B22396_02_06.jpg)

å›¾ 2.6 â€“ åŒ…å«è‡³å°‘æœ‰ 39 ä¸ªè§‚å¯Ÿå€¼çš„ç±»åˆ«äºŒå…ƒå˜é‡ä»¥åŠè¡¨ç¤ºæ‰€æœ‰å‰©ä½™ç±»åˆ«çš„é¢å¤–äºŒå…ƒå˜é‡çš„è½¬æ¢ DataFrame

ä¸ºäº†æ€»ç»“è¿™ä¸ªé…æ–¹ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨`feature-engine`å¯¹æœ€é¢‘ç¹çš„ç±»åˆ«è¿›è¡Œç¼–ç ã€‚

1.  è®©æˆ‘ä»¬è®¾ç½®ä¸€çƒ­ç¼–ç å™¨æ¥ç¼–ç `A6`å’Œ`A7`å˜é‡ä¸­æœ€é¢‘ç¹çš„äº”ä¸ªç±»åˆ«ï¼š

    ```py
    From feature_engine.encoding import OneHotEncoder
    ohe_enc = OneHotEncoder(
    Â Â Â Â top_categories=5,
    Â Â Â Â variables=["A6", "A7"]
    )
    ```

å¤‡æ³¨

è¦ç¼–ç çš„é¢‘ç¹ç±»åˆ«æ•°é‡ç”±ç”¨æˆ·ä»»æ„ç¡®å®šã€‚

1.  è®©æˆ‘ä»¬å°†ç¼–ç å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ï¼Œä»¥ä¾¿å®ƒå­¦ä¹ å¹¶å­˜å‚¨`A6`å’Œ`A7`å˜é‡çš„æœ€é¢‘ç¹ç±»åˆ«ï¼š

    ```py
    ohe_enc.fit(X_train)
    ```

1.  æœ€åï¼Œè®©æˆ‘ä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­å¯¹`A6`å’Œ`A7`è¿›è¡Œç¼–ç ï¼š

    ```py
    X_train_enc = ohe_enc.transform(X_train)
    X_test_enc = ohe_enc.transform(X_test)
    ```

    æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œ`X_train_enc.head()`æ¥æŸ¥çœ‹è½¬æ¢ DataFrame ä¸­çš„æ–°äºŒå…ƒå˜é‡ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡æ‰§è¡Œ`ohe_enc.encoder_dict_`æ¥æ‰¾åˆ°ç¼–ç å™¨å­¦ä¹ åˆ°çš„å‰äº”ä¸ªç±»åˆ«ã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªé…æ–¹çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¤„ç†äº†`A6`åˆ†ç±»å˜é‡ã€‚æˆ‘ä»¬ä½¿ç”¨`pandas`çš„`unique()`æ£€æŸ¥å…¶å”¯ä¸€ç±»åˆ«ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`pandas`çš„`value_counts()`è®¡ç®—æ¯ä¸ªç±»åˆ«çš„è§‚æµ‹å€¼æ•°é‡ï¼Œå®ƒè¿”å›ä¸€ä¸ªä»¥ç±»åˆ«ä¸ºç´¢å¼•ã€è§‚æµ‹å€¼æ•°é‡ä¸ºå€¼çš„`pandas`ç³»åˆ—ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨`pandas`çš„`sort_values()`å°†ç±»åˆ«ä»è§‚æµ‹å€¼æœ€å¤šåˆ°æœ€å°‘çš„é¡ºåºæ’åºã€‚æˆ‘ä»¬ç„¶åä½¿ç”¨`pandas`çš„`head()`å°†ç³»åˆ—ç¼©å‡åˆ°æœ€æµè¡Œçš„äº”ä¸ªç±»åˆ«ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç³»åˆ—åœ¨ä¸€ä¸ªåˆ—è¡¨æ¨å¯¼å¼ä¸­æ•è·æœ€é¢‘ç¹ç±»åˆ«çš„åç§°ã€‚ä¹‹åï¼Œæˆ‘ä»¬éå†æ¯ä¸ªç±»åˆ«ï¼Œå¹¶ä½¿ç”¨ NumPy çš„`where()`ï¼Œå¦‚æœè§‚æµ‹å€¼æ˜¾ç¤ºäº†è¯¥ç±»åˆ«ï¼Œåˆ™åˆ›å»ºå€¼ä¸º`1`çš„äºŒå…ƒå˜é‡ï¼Œå¦åˆ™ä¸º`0`ã€‚

æˆ‘ä»¬åœ¨â€œé€šè¿‡ç‹¬çƒ­ç¼–ç åˆ›å»ºäºŒå…ƒå˜é‡â€çš„é…æ–¹ä¸­è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨`scikit-learn`å’Œ`feature-engine`ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†åªå¼ºè°ƒç¼–ç æœ€é¢‘ç¹ç±»åˆ«æ‰€éœ€çš„å‚æ•°ã€‚

è¦ä½¿ç”¨`scikit-learn`ç¼–ç é¢‘ç¹ç±»åˆ«ï¼Œæˆ‘ä»¬å°†`min_frequency`å‚æ•°è®¾ç½®ä¸º`39`ã€‚å› æ­¤ï¼Œåœ¨å°‘äº`39`ä¸ªè§‚æµ‹å€¼ä¸­å‡ºç°çš„ç±»åˆ«å°†è¢«ç»„åˆæˆä¸€ä¸ªé¢å¤–çš„äºŒå…ƒå˜é‡ï¼Œç§°ä¸º`infrequent_sklearn`ã€‚

è¦ä½¿ç”¨`feature-engine`ç¼–ç é¢‘ç¹ç±»åˆ«ï¼Œæˆ‘ä»¬å°†`top_categories`å‚æ•°è®¾ç½®ä¸º`5`ã€‚å› æ­¤ï¼Œåˆ›å»ºçš„è½¬æ¢å™¨åªä¸º 5 ä¸ªæœ€é¢‘ç¹çš„ç±»åˆ«åˆ›å»ºäºŒå…ƒå˜é‡ã€‚è¾ƒå°‘è§çš„ç±»åˆ«å°†åœ¨æ‰€æœ‰äºŒå…ƒå˜é‡ä¸­æ˜¾ç¤ºä¸º`0`ã€‚

## è¿˜æœ‰æ›´å¤š...

è¿™ä¸ªé…æ–¹åŸºäº 2009 å¹´çŸ¥è¯†å‘ç°ä¸æ•°æ®ï¼ˆ**KDD**ï¼‰æŒ–æ˜æ¯çš„è·èƒœæ–¹æ¡ˆï¼Œ*ä½¿ç”¨é›†æˆé€‰æ‹©èµ¢å¾— KDD Cup Orange æŒ‘æˆ˜*ï¼ˆhttp://proceedings.mlr.press/v7/niculescu09/niculescu09.pdfï¼‰ï¼Œå…¶ä¸­ä½œè€…å°†ç‹¬çƒ­ç¼–ç é™åˆ¶ä¸ºæ¯ä¸ªå˜é‡çš„ 10 ä¸ªæœ€é¢‘ç¹ç±»åˆ«ã€‚

# ç”¨è§‚æµ‹å€¼çš„è®¡æ•°æˆ–é¢‘ç‡æ›¿æ¢ç±»åˆ«

åœ¨â€œè®¡æ•°ä¸è§‚æµ‹å€¼çš„è®¡æ•°æˆ–é¢‘ç‡â€æˆ–é¢‘ç‡ç¼–ç ä¸­ï¼Œæˆ‘ä»¬å°†ç±»åˆ«æ›¿æ¢ä¸ºæ˜¾ç¤ºè¯¥ç±»åˆ«çš„è§‚æµ‹å€¼çš„è®¡æ•°æˆ–åˆ†æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ 10 ä¸ªè§‚æµ‹å€¼ä¸­çš„ 100 ä¸ªæ˜¾ç¤º`Color`å˜é‡çš„`blue`ç±»åˆ«ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œè®¡æ•°ç¼–ç æ—¶å°†`blue`æ›¿æ¢ä¸º`10`ï¼Œæˆ–è€…åœ¨æ‰§è¡Œé¢‘ç‡ç¼–ç æ—¶æ›¿æ¢ä¸º`0.1`ã€‚è¿™äº›ç¼–ç æ–¹æ³•åœ¨ç±»åˆ«é¢‘ç‡ä¸ç›®æ ‡ä¹‹é—´å­˜åœ¨å…³ç³»æ—¶å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨é”€å”®ä¸­ï¼Œäº§å“çš„é¢‘ç‡å¯èƒ½è¡¨æ˜å…¶å—æ¬¢è¿ç¨‹åº¦ã€‚

æ³¨æ„

å¦‚æœä¸¤ä¸ªä¸åŒçš„ç±»åˆ«åœ¨ç›¸åŒæ•°é‡çš„è§‚æµ‹å€¼ä¸­å‡ºç°ï¼Œå®ƒä»¬å°†è¢«ç›¸åŒçš„å€¼æ›¿æ¢ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¿¡æ¯ä¸¢å¤±ã€‚

åœ¨è¿™ä¸ªé…æ–¹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`pandas`å’Œ`feature-engine`æ‰§è¡Œè®¡æ•°å’Œé¢‘ç‡ç¼–ç ã€‚

## å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹...

æˆ‘ä»¬å°†é¦–å…ˆä½¿ç”¨`pandas`ç¼–ç ä¸€ä¸ªå˜é‡ï¼Œç„¶åæˆ‘ä»¬å°†ä½¿ç”¨`feature-engine`è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼š

1.  è®©æˆ‘ä»¬ä»å¯¼å…¥å¼€å§‹ï¼š

    ```py
    import pandas as pd
    from sklearn.model_selection import train_test_split
    from feature_engine.encoding import CountFrequencyEncoder
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ä¿¡ç”¨æ‰¹å‡†æ•°æ®é›†å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

1.  è®©æˆ‘ä»¬é€šè¿‡è®¡æ•°æˆ–è§‚å¯Ÿé¢‘ç‡æ¥æ•è· `A7` å˜é‡æ¯ä¸ªç±»åˆ«çš„è§‚å¯Ÿæ•°é‡ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ä¸€ä¸ªå­—å…¸ä¸­ï¼š

    ```py
    counts = X_train["A7"].value_counts().to_dict()
    ```

æ³¨æ„

è¦æ‰¾åˆ°é¢‘ç‡ï¼Œè¯·æ‰§è¡Œ `X_train["A7"].value_counts(normalize=True).to_dict()`ã€‚

å¦‚æœæˆ‘ä»¬æ‰§è¡Œ `print(counts)`ï¼Œæˆ‘ä»¬å°†çœ‹åˆ° `A7` æ¯ä¸ªç±»åˆ«çš„è§‚å¯Ÿè®¡æ•°ï¼š

```py
{'v': 277, 'h': 101, 'ff': 41, 'bb': 39, 'z': 7, 'dd': 5, 'j': 5, 'Missing': 4, 'n': 3, 'o': 1}
```

1.  è®©æˆ‘ä»¬åœ¨æ•°æ®é›†çš„å‰¯æœ¬ä¸­å°† `A7` ä¸­çš„ç±»åˆ«æ›¿æ¢ä¸ºè®¡æ•°ï¼š

    ```py
    X_train_enc = X_train.copy()
    X_test_enc = X_test.copy()
    X_train_enc["A7"] = X_train_enc["A7"].map(counts)
    X_test_enc["A7"] = X_test_enc["A7"].map(counts)
    ```

    ç»§ç»­æ‰§è¡Œ `X_train_enc.head()` æ¥æ£€æŸ¥ç±»åˆ«æ˜¯å¦å·²è¢«æ›¿æ¢ä¸ºè®¡æ•°ã€‚

    è¦å°†æ­¤è¿‡ç¨‹åº”ç”¨äºå¤šä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `feature-engine`ã€‚

1.  è®©æˆ‘ä»¬è®¾ç½®ç¼–ç å™¨ï¼Œä½¿å…¶ä½¿ç”¨è§‚å¯Ÿè®¡æ•°æ¥ç¼–ç æ‰€æœ‰åˆ†ç±»å˜é‡ï¼š

    ```py
    count_enc = CountFrequencyEncoder(
    Â Â Â Â encoding_method="count", variables=None,
    )
    ```

æ³¨æ„

`CountFrequencyEncoder()` å°†è‡ªåŠ¨æ‰¾åˆ°å¹¶ç¼–ç è®­ç»ƒé›†ä¸­çš„æ‰€æœ‰åˆ†ç±»å˜é‡ã€‚è¦ä»…ç¼–ç å˜é‡å­é›†ï¼Œè¯·å°†å˜é‡åç§°åˆ—è¡¨ä¼ é€’ç»™ `variables` å‚æ•°ã€‚è¦ä½¿ç”¨é¢‘ç‡è¿›è¡Œç¼–ç ï¼Œè¯·ä½¿ç”¨ `encoding_method="frequency"`ã€‚

1.  è®©æˆ‘ä»¬å°†ç¼–ç å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ï¼Œä»¥ä¾¿å®ƒå­˜å‚¨æ¯ä¸ªå˜é‡æ¯ä¸ªç±»åˆ«çš„è§‚å¯Ÿæ•°é‡ï¼š

    ```py
    count_enc.fit(X_train)
    ```

1.  ç¼–ç å™¨è‡ªåŠ¨æ‰¾åˆ°äº†åˆ†ç±»å˜é‡ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼š

    ```py
    count_enc.variables_
    ```

    ä¹‹å‰çš„å‘½ä»¤è¿”å›è®­ç»ƒé›†ä¸­åˆ†ç±»å˜é‡çš„åç§°ï¼š

    ```py
    ['A1', 'A4', 'A5', 'A6', 'A7', 'A9', 'A10', 'A12', 'A13']
    ```

1.  è®©æˆ‘ä»¬æ‰“å°æ¯ä¸ªå˜é‡æ¯ä¸ªç±»åˆ«çš„è§‚å¯Ÿè®¡æ•°ï¼š

    ```py
    count_enc.encoder_dict_
    ```

    ä¹‹å‰çš„å±æ€§å­˜å‚¨äº†å°†ç”¨äºæ›¿æ¢ç±»åˆ«çš„æ˜ å°„ï¼š

![å›¾ 2.7 â€“ åŒ…å«æ¯ä¸ªå˜é‡æ¯ä¸ªç±»åˆ«çš„è§‚å¯Ÿæ•°é‡çš„å­—å…¸ï¼›è¿™äº›å€¼å°†ç”¨äºç¼–ç åˆ†ç±»å˜é‡](img/B22396_02_07.jpg)

å›¾ 2.7 â€“ åŒ…å«æ¯ä¸ªå˜é‡æ¯ä¸ªç±»åˆ«çš„è§‚å¯Ÿæ•°é‡çš„å­—å…¸ï¼›è¿™äº›å€¼å°†ç”¨äºç¼–ç åˆ†ç±»å˜é‡

1.  æœ€åï¼Œè®©æˆ‘ä»¬åœ¨è®­ç»ƒå’Œæµ‹è¯•é›†ä¸­ä½¿ç”¨â€œè®¡æ•°æˆ–è§‚å¯Ÿé¢‘ç‡â€å°†ç±»åˆ«æ›¿æ¢ä¸ºè®¡æ•°ï¼š

    ```py
    X_train_enc = count_enc.transform(X_train)
    X_test_enc = count_enc.transform(X_test)
    ```

é€šè¿‡æ‰§è¡Œ `X_train_enc.head()` æ¥æ£€æŸ¥ç»“æœã€‚ç¼–ç å™¨è¿”å› `pandas` DataFrameï¼Œå…¶ä¸­åˆ†ç±»å˜é‡çš„å­—ç¬¦ä¸²è¢«è§‚å¯Ÿè®¡æ•°æ›¿æ¢ï¼Œä½¿å˜é‡å‡†å¤‡å¥½åœ¨æœºå™¨å­¦ä¹ æ¨¡å‹ä¸­ä½¿ç”¨ã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªèœè°±ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `pandas` å’Œ `feature-engine` å°†ç±»åˆ«æ›¿æ¢ä¸ºè§‚å¯Ÿè®¡æ•°ã€‚

ä½¿ç”¨ `pandas` çš„ `value_counts()`ï¼Œæˆ‘ä»¬ç¡®å®šäº† `A7` å˜é‡æ¯ä¸ªç±»åˆ«çš„è§‚å¯Ÿæ•°é‡ï¼Œå¹¶é€šè¿‡ `pandas` çš„ `to_dict()`ï¼Œå°†è¿™äº›å€¼æ•è·åœ¨â€œè®¡æ•°æˆ–è§‚å¯Ÿé¢‘ç‡â€å­—å…¸ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªé”®æ˜¯ä¸€ä¸ªå”¯ä¸€çš„ç±»åˆ«ï¼Œæ¯ä¸ªå€¼æ˜¯è¯¥ç±»åˆ«çš„è§‚å¯Ÿæ•°é‡ã€‚é€šè¿‡ `pandas` çš„ `map()` å’Œä½¿ç”¨æ­¤å­—å…¸ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒå’Œæµ‹è¯•é›†ä¸­å°†ç±»åˆ«æ›¿æ¢ä¸ºè§‚å¯Ÿè®¡æ•°ã€‚

æ³¨æ„

ç¼–ç çš„è§‚æµ‹å€¼æ•°é‡åº”ä»è®­ç»ƒé›†ä¸­è·å–ï¼Œä»¥é¿å…æ•°æ®æ³„éœ²ã€‚è¯·æ³¨æ„ï¼Œæµ‹è¯•é›†ä¸­çš„æ–°ç±»åˆ«å°†æ²¡æœ‰å¯¹åº”çš„æ˜ å°„ï¼Œå› æ­¤å°†è¢«æ›¿æ¢ä¸º`nan`ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè¯·ä½¿ç”¨`feature-engine`ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥å°†`nan`æ›¿æ¢ä¸º`0`ã€‚

è¦ä½¿ç”¨`feature-engine`æ‰§è¡Œè®¡æ•°ç¼–ç ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`CountFrequencyEncoder()`å¹¶å°†`encoding_method`è®¾ç½®ä¸º`'count'`ã€‚æˆ‘ä»¬å°†`variables`å‚æ•°è®¾ç½®ä¸º`None`ï¼Œä»¥ä¾¿ç¼–ç å™¨è‡ªåŠ¨æ‰¾åˆ°æ•°æ®é›†ä¸­çš„æ‰€æœ‰åˆ†ç±»å˜é‡ã€‚ä½¿ç”¨`fit()`ï¼Œè½¬æ¢å™¨æ‰¾åˆ°äº†åˆ†ç±»å˜é‡ï¼Œå¹¶å°†æ¯ä¸ªç±»åˆ«çš„è§‚æµ‹å€¼è®¡æ•°å­˜å‚¨åœ¨`encoder_dict_`å±æ€§ä¸­ã€‚ä½¿ç”¨`transform()`ï¼Œè½¬æ¢å™¨ç”¨è®¡æ•°æ›¿æ¢äº†ç±»åˆ«ï¼Œè¿”å›ä¸€ä¸ª`pandas` DataFrameã€‚

æ³¨æ„

å¦‚æœæµ‹è¯•é›†ä¸­æœ‰è®­ç»ƒé›†ä¸­ä¸å­˜åœ¨çš„ç±»åˆ«ï¼Œç¼–ç å™¨å°†é»˜è®¤å¼•å‘é”™è¯¯ã€‚æ‚¨å¯ä»¥ä½¿å…¶å¿½ç•¥å®ƒä»¬ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬å°†æ˜¾ç¤ºä¸º`nan`ï¼Œæˆ–è€…å°†å®ƒä»¬ç¼–ç ä¸º`0`ã€‚

## å‚è§

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Python åº“ Category Encoders æ‰§è¡Œè®¡æ•°å’Œé¢‘ç‡ç¼–ç ï¼š[`contrib.scikit-learn.org/category_encoders/count.html`](https://contrib.scikit-learn.org/category_encoders/count.html)ã€‚

è¦æŸ¥çœ‹è®¡æ•°ç¼–ç çš„ä¸€äº›æœ‰ç”¨åº”ç”¨ï¼Œè¯·å‚é˜…è¿™ç¯‡æ–‡ç« ï¼š[`letsdatascience.com/frequency-encoding/`](https://letsdatascience.com/frequency-encoding/)ã€‚

# ç”¨åºæ•°æ›¿æ¢ç±»åˆ«

åºæ•°ç¼–ç åŒ…æ‹¬ç”¨ä»`1`åˆ°`k`ï¼ˆæˆ–æ ¹æ®å®ç°ä»`0`åˆ°`k-1`ï¼‰çš„æ•°å­—æ›¿æ¢ç±»åˆ«ï¼Œå…¶ä¸­`k`æ˜¯å˜é‡çš„ä¸åŒç±»åˆ«çš„æ•°é‡ã€‚è¿™äº›æ•°å­—æ˜¯ä»»æ„åˆ†é…çš„ã€‚åºæ•°ç¼–ç æ›´é€‚åˆéçº¿æ€§æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹å¯ä»¥é€šè¿‡ä»»æ„åˆ†é…çš„æ•°å­—æ¥å¯»æ‰¾ä¸ç›®æ ‡ç›¸å…³çš„æ¨¡å¼ã€‚

åœ¨è¿™ä¸ªèœè°±ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`pandas`ã€`scikit-learn`å’Œ`feature-engine`æ‰§è¡Œåºæ•°ç¼–ç ã€‚

## å¦‚ä½•æ“ä½œ...

é¦–å…ˆï¼Œè®©æˆ‘ä»¬è¿›è¡Œå¯¼å…¥å¹¶å‡†å¤‡æ•°æ®é›†ï¼š

1.  å¯¼å…¥`pandas`å’Œæ•°æ®æ‹†åˆ†å‡½æ•°ï¼š

    ```py
    import pandas as pd
    from sklearn.model_selection import train_test_split
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ Credit Approval æ•°æ®é›†å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

1.  è¦ç¼–ç `A7`å˜é‡ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»åˆ«åˆ°æ•´æ•°çš„å­—å…¸ï¼š

    ```py
    ordinal_mapping = {k: i for i, k in enumerate(
    Â Â Â Â X_train["A7"].unique(), 0)
    }
    ```

    å¦‚æœæˆ‘ä»¬æ‰§è¡Œ`print(ordinal_mapping)`ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å°†æ›¿æ¢æ¯ä¸ªç±»åˆ«çš„æ•°å­—ï¼š

    ```py
    {'v': 0, 'ff': 1, 'h': 2, 'dd': 3, 'z': 4, 'bb': 5, 'j': 6, 'Missing': 7, 'n': 8, 'o': 9}
    ```

1.  ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ DataFrame çš„å‰¯æœ¬ä¸­æ›¿æ¢ç±»åˆ«ï¼š

    ```py
    X_train_enc = X_train.copy()
    X_test_enc = X_test.copy()
    X_train_enc["A7"] = X_train_enc["A7"].map(ordinal_mapping)
    X_test_enc["A7"] = X_test_enc["A7"].map(ordinal_mapping)
    ```

    æ‰§è¡Œ`print(X_train["A7"].head())`ä»¥æŸ¥çœ‹ä¸Šä¸€æ“ä½œçš„ç»“æœã€‚

    æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`scikit-learn`æ‰§è¡Œåºæ•°ç¼–ç ã€‚

1.  è®©æˆ‘ä»¬å¯¼å…¥æ‰€éœ€çš„ç±»ï¼š

    ```py
    from sklearn.preprocessing import OrdinalEncoder
    from sklearn.compose import ColumnTransformer
    ```

æ³¨æ„

ä¸è¦æ··æ·†`OrdinalEncoder()`å’Œæ¥è‡ª`scikit-learn`çš„`LabelEncoder()`ã€‚å‰è€…æ—¨åœ¨ç¼–ç é¢„æµ‹ç‰¹å¾ï¼Œè€Œåè€…æ—¨åœ¨ä¿®æ”¹ç›®æ ‡å˜é‡ã€‚

1.  è®©æˆ‘ä»¬è®¾ç½®ç¼–ç å™¨ï¼š

    ```py
    enc = OrdinalEncoder()
    ```

1.  è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«éœ€è¦ç¼–ç çš„åˆ†ç±»å˜é‡çš„åˆ—è¡¨ï¼š

    ```py
    cat_vars = X_train.select_dtypes(include="O").columns.to_list()
    ```

1.  è®©æˆ‘ä»¬å°†ç¼–ç é™åˆ¶åœ¨åˆ†ç±»å˜é‡ä¸Šï¼š

    ```py
    ct = ColumnTransformer(
    Â Â Â Â [("encoder", enc, cat_vars)],
    Â Â Â Â remainder="passthrough",
    Â Â Â Â force_int_remainder_cols=False,
    ).set_output(transform="pandas")
    ```

æ³¨æ„

è®°å¾—å°†`remainder`è®¾ç½®ä¸º`"passthrough"`ï¼Œä»¥ä¾¿`ColumnTransformer()`è¿”å›æœªè½¬æ¢çš„å˜é‡ã€‚

1.  è®©æˆ‘ä»¬å°†ç¼–ç å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ï¼Œä»¥ä¾¿å®ƒåˆ›å»ºå¹¶å­˜å‚¨ç±»åˆ«åˆ°æ•°å­—çš„è¡¨ç¤ºï¼š

    ```py
    ct.fit(X_train)
    ```

æ³¨æ„

é€šè¿‡æ‰§è¡Œ`ct.named_transformers_["encoder"].categories_`ï¼Œæ‚¨å¯ä»¥å¯è§†åŒ–æ¯ä¸ªå˜é‡çš„å”¯ä¸€ç±»åˆ«ã€‚

1.  ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­çš„åˆ†ç±»å˜é‡è¿›è¡Œç¼–ç ï¼š

    ```py
    X_train_enc = ct.transform(X_train)
    X_test_enc = ct.transform(X_test)
    ```

    æ‰§è¡Œ`X_train_enc.head()`æ¥æŸ¥çœ‹ç”Ÿæˆçš„ DataFrameã€‚

æ³¨æ„

`ColumnTransformer()`å°†é€šè¿‡åœ¨å˜é‡ååé™„åŠ `encoder`æ¥æ ‡è®°å·²ç¼–ç çš„å˜é‡ã€‚æœªä¿®æ”¹çš„å˜é‡æ˜¾ç¤º`remainder`å‰ç¼€ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨`feature-engine`è¿›è¡Œé¡ºåºç¼–ç ã€‚

1.  è®©æˆ‘ä»¬å¯¼å…¥ç¼–ç å™¨ï¼š

    ```py
    from feature_engine.encoding import OrdinalEncoder
    ```

1.  è®©æˆ‘ä»¬è®¾ç½®ç¼–ç å™¨ï¼Œä½¿å…¶åœ¨*æ­¥éª¤ 7*ä¸­æŒ‡å®šçš„åˆ†ç±»å˜é‡ä¸­å°†ç±»åˆ«æ›¿æ¢ä¸ºä»»æ„æ•´æ•°ï¼š

    ```py
    enc = OrdinalEncoder(
    Â Â Â Â encoding_method="arbitrary",
    Â Â Â Â variables=cat_vars,
    )
    ```

æ³¨æ„

å¦‚æœ`variables`å‚æ•°ä¸º`None`ï¼Œ`feature-engine`çš„`OrdinalEncoder()`å°†è‡ªåŠ¨æŸ¥æ‰¾å¹¶ç¼–ç æ‰€æœ‰åˆ†ç±»å˜é‡ã€‚æˆ–è€…ï¼Œå®ƒå°†ç¼–ç åˆ—è¡¨ä¸­æŒ‡ç¤ºçš„å˜é‡ã€‚æ­¤å¤–ï¼Œå®ƒå¯ä»¥æ ¹æ®ç›®æ ‡å¹³å‡å€¼åˆ†é…æ•´æ•°ï¼ˆå‚è§*åŸºäºç›®æ ‡* *å€¼* è¿›è¡Œé¡ºåºç¼–ç çš„é…æ–¹ï¼‰ã€‚

1.  è®©æˆ‘ä»¬å°†ç¼–ç å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ï¼Œä»¥ä¾¿å®ƒå­¦ä¹ å¹¶å­˜å‚¨ç±»åˆ«åˆ°æ•´æ•°çš„æ˜ å°„ï¼š

    ```py
    enc.fit(X_train)
    ```

æ³¨æ„

ç±»åˆ«åˆ°æ•´æ•°çš„æ˜ å°„å­˜å‚¨åœ¨`encoder_dict_`å±æ€§ä¸­ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ`enc.encoder_dict_`æ¥è®¿é—®ã€‚

1.  æœ€åï¼Œè®©æˆ‘ä»¬å°†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­çš„åˆ†ç±»å˜é‡è¿›è¡Œç¼–ç ï¼š

    ```py
    X_train_enc = enc.transform(X_train)
    X_test_enc = enc.transform(X_test)
    ```

`feature-engine`è¿”å›`pandas` DataFrameï¼Œå…¶ä¸­åŸå§‹å˜é‡çš„å€¼è¢«æ•°å­—æ›¿æ¢ï¼Œä½¿ DataFrame å‡†å¤‡å¥½åœ¨æœºå™¨å­¦ä¹ æ¨¡å‹ä¸­ä½¿ç”¨ã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªé…æ–¹ä¸­ï¼Œæˆ‘ä»¬å°†ç±»åˆ«æ›¿æ¢ä¸ºä»»æ„åˆ†é…çš„æ•´æ•°ã€‚

æˆ‘ä»¬ä½¿ç”¨`pandas`çš„`unique()`æ‰¾åˆ°`A7`å˜é‡çš„å”¯ä¸€ç±»åˆ«ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç±»åˆ«åˆ°æ•´æ•°çš„å­—å…¸ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™`pandas`çš„`map()`ï¼Œä»¥å°†`A7`ä¸­çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ•´æ•°ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`scikit-learn`çš„`OrdinalEncoder()`è¿›è¡Œäº†é¡ºåºç¼–ç ï¼Œå¹¶ä½¿ç”¨`ColumnTransformer()`å°†ç¼–ç é™åˆ¶åœ¨åˆ†ç±»å˜é‡ä¸Šã€‚é€šè¿‡`fit()`ï¼Œè½¬æ¢å™¨æ ¹æ®è®­ç»ƒé›†ä¸­çš„ç±»åˆ«åˆ›å»ºäº†ç±»åˆ«åˆ°æ•´æ•°çš„æ˜ å°„ã€‚é€šè¿‡`transform()`ï¼Œç±»åˆ«è¢«æ›¿æ¢ä¸ºæ•´æ•°ã€‚é€šè¿‡å°†`remainder`å‚æ•°è®¾ç½®ä¸º`passthrough`ï¼Œæˆ‘ä»¬ä½¿`ColumnTransformer()`å°†æœªç¼–ç çš„å˜é‡è¿æ¥åˆ°ç¼–ç ç‰¹å¾ä¹‹åã€‚

ä½¿ç”¨`feature-engine`è¿›è¡Œæœ‰åºç¼–ç æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`OrdinalEncoder()`ï¼Œè¡¨ç¤ºæ•´æ•°åº”é€šè¿‡`encoding_method`ä»»æ„åˆ†é…ï¼Œå¹¶é€šè¿‡`variables`å‚æ•°ä¼ é€’äº†ä¸€ä¸ªåŒ…å«è¦ç¼–ç çš„å˜é‡çš„åˆ—è¡¨ã€‚ä½¿ç”¨`fit()`ï¼Œç¼–ç å™¨å°†æ•´æ•°åˆ†é…ç»™æ¯ä¸ªå˜é‡çš„ç±»åˆ«ï¼Œè¿™äº›ç±»åˆ«å­˜å‚¨åœ¨`encoder_dict_`å±æ€§ä¸­ã€‚ç„¶åï¼Œè¿™äº›æ˜ å°„è¢«`transform()`æ–¹æ³•ç”¨äºæ›¿æ¢è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­çš„ç±»åˆ«ï¼Œè¿”å› DataFramesã€‚

æ³¨æ„

å½“æµ‹è¯•é›†ä¸­çš„ç±»åˆ«ä¸åœ¨è®­ç»ƒé›†ä¸­æ—¶ï¼Œå®ƒå°†æ²¡æœ‰æ˜ å°„åˆ°æ•°å­—ã€‚`scikit-learn`çš„`OrdinalEncoder()`å’Œ`feature-engine`é»˜è®¤ä¼šå¼•å‘é”™è¯¯ã€‚ç„¶è€Œï¼Œå®ƒä»¬éƒ½æœ‰é€‰é¡¹ç”¨ç”¨æˆ·å®šä¹‰çš„å€¼æˆ–`-1`æ›¿æ¢æœªçœ‹åˆ°çš„ç±»åˆ«ã€‚

`scikit-learn`çš„`OrdinalEncoder()`å¯ä»¥é™åˆ¶ç¼–ç åˆ°å…·æœ‰æœ€å°é¢‘ç‡çš„ç±»åˆ«ã€‚`feature-engine`çš„`OrdinalEncoder()`å¯ä»¥æ ¹æ®ç›®æ ‡å¹³å‡å€¼åˆ†é…æ•°å­—ï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªé…æ–¹ä¸­çœ‹åˆ°çš„ã€‚

## æ›´å¤š...

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨`OrdinalEncoder()`ä»`Category Encoders`è¿›è¡Œæœ‰åºç¼–ç ã€‚è¯·æŸ¥çœ‹[`contrib.scikit-learn.org/category_encoders/ordinal.html`](http://contrib.scikit-learn.org/category_encoders/ordinal.html)ã€‚

# åŸºäºç›®æ ‡å€¼è¿›è¡Œæœ‰åºç¼–ç 

åœ¨å‰é¢çš„é…æ–¹ä¸­ï¼Œæˆ‘ä»¬ç”¨æ•´æ•°æ›¿æ¢äº†ç±»åˆ«ï¼Œè¿™äº›æ•´æ•°æ˜¯ä»»æ„åˆ†é…çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®ç›®æ ‡å€¼ç»™ç±»åˆ«åˆ†é…æ•´æ•°ã€‚ä¸ºæ­¤ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬è®¡ç®—æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡å€¼çš„å¹³å‡å€¼ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‰ç›®æ ‡å¹³å‡å€¼ä»ä½åˆ°é«˜å¯¹ç±»åˆ«è¿›è¡Œæ’åºã€‚æœ€åï¼Œæˆ‘ä»¬å°†æ•°å­—åˆ†é…ç»™æœ‰åºçš„ç±»åˆ«ï¼Œä»ç¬¬ä¸€ä¸ªç±»åˆ«å¼€å§‹çš„*0*åˆ°æœ€åä¸€ä¸ªç±»åˆ«çš„*k-1*ã€‚

è¿™ç§ç¼–ç æ–¹æ³•åœ¨åˆ†ç±»å˜é‡å’Œå“åº”å˜é‡ä¹‹é—´åˆ›å»ºäº†ä¸€ä¸ªå•è°ƒå…³ç³»ï¼Œå› æ­¤ä½¿å¾—å˜é‡æ›´é€‚åˆç”¨äºçº¿æ€§æ¨¡å‹ã€‚

åœ¨è¿™ä¸ªé…æ–¹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`pandas`å’Œ`feature-engine`åœ¨éµå¾ªç›®æ ‡å€¼çš„åŒæ—¶å¯¹ç±»åˆ«è¿›è¡Œç¼–ç ã€‚

## å¦‚ä½•æ“ä½œ...

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¯¼å…¥å¿…è¦çš„ Python åº“å¹¶å‡†å¤‡å¥½æ•°æ®é›†ï¼š

1.  å¯¼å…¥æ‰€éœ€çš„ Python åº“ã€å‡½æ•°å’Œç±»ï¼š

    ```py
    import pandas as pd
    import matplotlib.pyplot as plt
    from sklearn.model_selection import train_test_split
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ Credit Approval æ•°æ®é›†å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

1.  è®©æˆ‘ä»¬åœ¨`A7`ä¸­ç¡®å®šæ¯ä¸ªç±»åˆ«çš„å¹³å‡ç›®æ ‡å€¼ï¼Œç„¶åæŒ‰ç›®æ ‡å€¼ä»ä½åˆ°é«˜æ’åºç±»åˆ«ï¼š

    ```py
    y_train.groupby(X_train["A7"]).mean().sort_values()
    ```

    ä»¥ä¸‹æ˜¯åœ¨å‰é¢çš„å‘½ä»¤ä¸­çš„è¾“å‡ºï¼š

    ```py
    A7
    oÂ Â Â Â Â Â Â Â Â Â 0.000000
    ffÂ Â Â Â Â Â Â Â Â 0.146341
    jÂ Â Â Â Â Â Â Â Â Â 0.200000
    ddÂ Â Â Â Â Â Â Â Â 0.400000
    vÂ Â Â Â Â Â Â Â Â Â 0.418773
    bbÂ Â Â Â Â Â Â Â Â 0.512821
    hÂ Â Â Â Â Â Â Â Â Â 0.603960
    nÂ Â Â Â Â Â Â Â Â Â 0.666667
    zÂ Â Â Â Â Â Â Â Â Â 0.714286
    MissingÂ Â Â Â 1.000000
    Name: target, dtype: float64
    ```

1.  ç°åœ¨ï¼Œè®©æˆ‘ä»¬é‡å¤ç¬¬ 3 æ­¥çš„è®¡ç®—ï¼Œä½†è¿™æ¬¡ï¼Œè®©æˆ‘ä»¬ä¿ç•™æœ‰åºçš„ç±»åˆ«åç§°ï¼š

    ```py
    ordered_labels = y_train.groupby(
    Â Â Â Â X_train["A7"]).mean().sort_values().index
    ```

    è¦æ˜¾ç¤ºå‰é¢å‘½ä»¤çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ`print(ordered_labels)`ï¼š`Index(['o', 'ff', 'j', 'dd', 'v', 'bb', 'h', 'n', 'z', 'Missing'], dtype='object', name='A7')`ã€‚

1.  è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»åˆ«åˆ°æ•´æ•°çš„å­—å…¸ï¼Œä½¿ç”¨æˆ‘ä»¬åœ¨ *æ­¥éª¤ 4* ä¸­åˆ›å»ºçš„æœ‰åºåˆ—è¡¨ï¼š

    ```py
    ordinal_mapping = {
    Â Â Â Â k: i for i, k in enumerate(ordered_labels, 0)
    }
    ```

    æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ `print(ordinal_mapping)` æ¥å¯è§†åŒ–å‰é¢ä»£ç çš„ç»“æœï¼š

    ```py
    A7 in a copy of the datasets:

    ```

    X_train_enc = X_train.copy()

    X_test_enc = X_test.copy()

    X_train_enc["A7"] = X_train_enc["A7"].map(

    ordinal_mapping)

    X_test_enc["A7"] = X_test_enc["A7"].map(

    ordinal_mapping)

    ```py

    ```

æ³¨æ„

å¦‚æœæµ‹è¯•é›†åŒ…å«è®­ç»ƒé›†ä¸­ä¸å­˜åœ¨çš„ç±»åˆ«ï¼Œå‰é¢çš„ä»£ç å°†å¼•å…¥ `np.nan`ã€‚

ä¸ºäº†å¯è§†åŒ–è¿™ç§ç¼–ç çš„æ•ˆæœï¼Œè®©æˆ‘ä»¬ç»˜åˆ¶ç¼–ç å‰å `A7` å˜é‡çš„ç±»åˆ«ä¸ç›®æ ‡ä¹‹é—´çš„å…³ç³»ã€‚

1.  è®©æˆ‘ä»¬ç»˜åˆ¶ `A7` å˜é‡æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡å“åº”å¹³å‡å€¼ï¼š

    ```py
    y_train.groupby(X_train["A7"]).mean().plot()
    plt.title("Relationship between A7 and the target")
    plt.ylabel("Mean of target")
    plt.show()
    ```

    æˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹å›¾è¡¨ä¸­çœ‹åˆ° `A7` ç±»åˆ«å’Œç›®æ ‡ä¹‹é—´çš„éå•è°ƒå…³ç³»ï¼š

![å›¾ 2.8 â€“ ç¼–ç å‰ A7 æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡å€¼å¹³å‡å€¼](img/B22396_02_08.jpg)

å›¾ 2.8 â€“ ç¼–ç å‰ A7 æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡å€¼å¹³å‡å€¼

1.  è®©æˆ‘ä»¬ç»˜åˆ¶ç¼–ç å˜é‡ä¸­æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡å€¼å¹³å‡å€¼ï¼š

    ```py
    y_train.groupby(X_train_enc["A7"]).mean().plot()
    plt.title("Relationship between A7 and the target")
    plt.ylabel("Mean of target")
    plt.show()
    ```

    ç¼–ç åçš„å˜é‡ä¸ç›®æ ‡ä¹‹é—´å­˜åœ¨å•è°ƒå…³ç³» â€“ ç›®æ ‡å€¼å¹³å‡å€¼è¶Šé«˜ï¼Œåˆ†é…ç»™ç±»åˆ«çš„æ•°å­—å°±è¶Šé«˜ï¼š

![å›¾ 2.9 â€“ ç¼–ç å A7 æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡å€¼å¹³å‡å€¼](img/B22396_02_09.jpg)

å›¾ 2.9 â€“ ç¼–ç å A7 æ¯ä¸ªç±»åˆ«çš„ç›®æ ‡å€¼å¹³å‡å€¼

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ `feature-engine` æ‰§è¡Œæœ‰åºé¡ºåºç¼–ç ã€‚

1.  è®©æˆ‘ä»¬å¯¼å…¥ç¼–ç å™¨ï¼š

    ```py
    from feature_engine.encoding import OrdinalEncoder
    ```

1.  æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è®¾ç½®ç¼–ç å™¨ï¼Œä½¿å…¶æ ¹æ®ç›®æ ‡å¹³å‡å€¼å°†æ•´æ•°åˆ†é…ç»™æ•°æ®é›†ä¸­çš„æ‰€æœ‰åˆ†ç±»å˜é‡ï¼š

    ```py
    ordinal_enc = OrdinalEncoder(
    Â Â Â Â encoding_method="ordered",
    Â Â Â Â variables=None)
    ```

æ³¨æ„

`OrdinalEncoder()` å°†è‡ªåŠ¨æŸ¥æ‰¾å¹¶ç¼–ç æ‰€æœ‰åˆ†ç±»å˜é‡ã€‚è¦é™åˆ¶ç¼–ç åˆ°å˜é‡çš„å­é›†ï¼Œå°†å®ƒä»¬çš„åç§°ä½œä¸ºåˆ—è¡¨ä¼ é€’ç»™ `variables` å‚æ•°ã€‚è¦ç¼–ç æ•°å€¼å˜é‡ï¼Œè®¾ç½® `ignore_format=True`ã€‚

1.  è®©æˆ‘ä»¬å°†ç¼–ç å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ï¼Œä»¥ä¾¿å®ƒæ‰¾åˆ°åˆ†ç±»å˜é‡ï¼Œç„¶åå­˜å‚¨ç±»åˆ«å’Œæ•´æ•°æ˜ å°„ï¼š

    ```py
    ordinal_enc.fit(X_train, y_train)
    ```

1.  æœ€åï¼Œè®©æˆ‘ä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­å°†ç±»åˆ«æ›¿æ¢ä¸ºæ•°å­—ï¼š

    ```py
    X_train_enc = ordinal_enc.transform(X_train)
    X_test_enc = ordinal_enc.transform(X_test)
    ```

æ³¨æ„

ä½ å°†åœ¨ `encoder_dict_` å±æ€§ä¸­æ‰¾åˆ°æ›¿æ¢æ¯ä¸ªç±»åˆ«çš„æ•°å­—ã€‚

é€šè¿‡æ‰§è¡Œ `X_train_enc.head()` æ¥æŸ¥çœ‹è½¬æ¢çš„è¾“å‡ºã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªé…æ–¹ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®ç›®æ ‡å¹³å‡å€¼å°†ç±»åˆ«æ›¿æ¢ä¸ºæ•´æ•°ã€‚

åœ¨æœ¬é£Ÿè°±çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¤„ç†äº†`A7`åˆ†ç±»å˜é‡ã€‚ä½¿ç”¨`pandas`çš„`groupby()`å‡½æ•°ï¼Œæˆ‘ä»¬æ ¹æ®`A7`çš„åˆ†ç±»å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä½¿ç”¨`pandas`çš„`mean()`å‡½æ•°ç¡®å®šæ¯ä¸ªåˆ†ç±»çš„ç›®æ ‡å‡å€¼ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`pandas`çš„`sort_values()`å‡½æ•°æŒ‰ç›®æ ‡å‡å€¼å“åº”ä»ä½åˆ°é«˜å¯¹åˆ†ç±»è¿›è¡Œæ’åºã€‚è¿™ä¸ªæ“ä½œçš„è¾“å‡ºæ˜¯ä¸€ä¸ª`pandas`ç³»åˆ—ï¼Œå…¶ä¸­åˆ†ç±»ä½œä¸ºç´¢å¼•ï¼Œç›®æ ‡å‡å€¼ä½œä¸ºå€¼ã€‚ä½¿ç”¨`pandas`çš„`index`ï¼Œæˆ‘ä»¬å°†æ’åºåçš„åˆ†ç±»å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼›ç„¶åï¼Œä½¿ç”¨ Python å­—å…¸æ¨å¯¼å¼åˆ›å»ºäº†ä¸€ä¸ªåˆ†ç±»åˆ°æ•´æ•°çš„å­—å…¸å¯¹ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå­—å…¸é€šè¿‡`pandas`çš„`map()`å‡½æ•°å°†åˆ†ç±»æ›¿æ¢ä¸ºæ•´æ•°ã€‚

æ³¨æ„

ä¸ºäº†é¿å…æ•°æ®æ³„éœ²ï¼Œæˆ‘ä»¬ä»è®­ç»ƒé›†ä¸­ç¡®å®šåˆ†ç±»åˆ°æ•´æ•°çš„æ˜ å°„ã€‚

è¦ä½¿ç”¨`feature-engine`æ‰§è¡Œç¼–ç ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`OrdinalEncoder()`ï¼Œå°†`encoding_method`è®¾ç½®ä¸º`ordered`ã€‚æˆ‘ä»¬å°†å˜é‡å‚æ•°è®¾ç½®ä¸º`None`ï¼Œä»¥ä¾¿ç¼–ç å™¨è‡ªåŠ¨æ£€æµ‹æ•°æ®é›†ä¸­çš„æ‰€æœ‰åˆ†ç±»å˜é‡ã€‚ä½¿ç”¨`fit()`ï¼Œç¼–ç å™¨æ‰¾åˆ°äº†åˆ†ç±»å˜é‡ï¼Œå¹¶æ ¹æ®ç›®æ ‡å‡å€¼å€¼åˆ†é…æ•°å­—ç»™å®ƒä»¬çš„åˆ†ç±»ã€‚åˆ†ç±»å˜é‡çš„åç§°å’Œåˆ†ç±»åˆ°æ•°å­—å¯¹çš„å­—å…¸åˆ†åˆ«å­˜å‚¨åœ¨`variables_`å’Œ`encoder_dict_`å±æ€§ä¸­ã€‚æœ€åï¼Œä½¿ç”¨`transform()`ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­ç”¨æ•°å­—æ›¿æ¢äº†åˆ†ç±»ï¼Œè¿”å›`pandas`æ•°æ®æ¡†ã€‚

## å‚è§

è¦æŸ¥çœ‹ä½¿ç”¨åˆ†ç±»ç¼–ç å™¨çš„æœ¬é£Ÿè°±çš„å®ç°ï¼Œè¯·è®¿é—®æœ¬ä¹¦çš„ GitHub ä»“åº“ï¼š[`github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-05-Ordered-ordinal-encoding.ipynb`](https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-05-Ordered-ordinal-encoding.ipynb)ã€‚

# å®ç°ç›®æ ‡å‡å€¼ç¼–ç 

**å‡å€¼ç¼–ç **æˆ–**ç›®æ ‡ç¼–ç **å°†æ¯ä¸ªåˆ†ç±»æ˜ å°„åˆ°ç›®æ ‡å±æ€§çš„é¢„æµ‹æ¦‚ç‡ã€‚å¦‚æœç›®æ ‡æ˜¯äºŒå…ƒçš„ï¼Œæ•°å€¼æ˜ å°„æ˜¯ç›®æ ‡åœ¨ç»™å®šåˆ†ç±»å€¼æ¡ä»¶ä¸‹çš„åéªŒæ¦‚ç‡ã€‚å¦‚æœç›®æ ‡æ˜¯è¿ç»­çš„ï¼Œæ•°å€¼è¡¨ç¤ºæ˜¯ç»™å®šåˆ†ç±»å€¼çš„ç›®æ ‡çš„æœŸæœ›å€¼ã€‚

åœ¨å…¶æœ€ç®€å•å½¢å¼ä¸­ï¼Œæ¯ä¸ªç±»åˆ«çš„æ•°å€¼è¡¨ç¤ºç”±ç‰¹å®šç±»åˆ«ç»„çš„ç›®æ ‡å˜é‡çš„å¹³å‡å€¼ç»™å‡ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª`City`å˜é‡ï¼Œç±»åˆ«ä¸º`London`ã€`Manchester`å’Œ`Bristol`ï¼Œæˆ‘ä»¬æƒ³è¦é¢„æµ‹è¿çº¦ç‡ï¼ˆç›®æ ‡å–å€¼ä¸º`0`å’Œ`1`ï¼‰ï¼›å¦‚æœ`London`çš„è¿çº¦ç‡æ˜¯ 30%ï¼Œæˆ‘ä»¬å°†`London`æ›¿æ¢ä¸º`0.3`ï¼›å¦‚æœ`Manchester`çš„è¿çº¦ç‡æ˜¯ 20%ï¼Œæˆ‘ä»¬å°†`Manchester`æ›¿æ¢ä¸º`0.2`ï¼›ä¾æ­¤ç±»æ¨ã€‚å¦‚æœç›®æ ‡æ˜¯è¿ç»­çš„â€”â€”æ¯”å¦‚è¯´æˆ‘ä»¬æƒ³è¦é¢„æµ‹æ”¶å…¥â€”â€”é‚£ä¹ˆæˆ‘ä»¬å°†`London`ã€`Manchester`å’Œ`Bristol`æ›¿æ¢ä¸ºæ¯ä¸ªåŸå¸‚æ‰€èµšå–çš„å¹³å‡æ”¶å…¥ã€‚

ä»æ•°å­¦çš„è§’åº¦æ¥çœ‹ï¼Œå¦‚æœç›®æ ‡æ˜¯äºŒå…ƒçš„ï¼Œæ›¿æ¢å€¼*S*çš„ç¡®å®šå¦‚ä¸‹ï¼š

![<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" display="block"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>(</mml:mo><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math>](img/1.png)

åœ¨è¿™é‡Œï¼Œåˆ†å­æ˜¯ç±»åˆ«*i*ä¸­å…·æœ‰ç›®æ ‡å€¼*1*çš„è§‚æµ‹å€¼çš„æ•°é‡ï¼Œåˆ†æ¯æ˜¯å…·æœ‰ç±»åˆ«å€¼*i*çš„è§‚æµ‹å€¼çš„æ•°é‡ã€‚

å¦‚æœç›®æ ‡æ˜¯è¿ç»­çš„ï¼Œ*S*ï¼Œåˆ™ç”±ä»¥ä¸‹å…¬å¼ç¡®å®šï¼š

![<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><mo>âˆ‘</mo><msub><mi>y</mi><mi>i</mi></msub></mrow><msub><mi>n</mi><mi>i</mi></msub></mfrac></mrow></mrow></math>](img/2.png)

åœ¨è¿™é‡Œï¼Œåˆ†å­æ˜¯ç±»åˆ«*i*ä¸­è§‚æµ‹å€¼çš„æ€»å’Œï¼Œè€Œ![<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math>](img/3.png)æ˜¯ç±»åˆ«*i*ä¸­çš„è§‚æµ‹å€¼æ€»æ•°ã€‚

è¿™äº›å…¬å¼åœ¨å­˜åœ¨è¶³å¤Ÿå¤šçš„æ¯ä¸ªç±»åˆ«å€¼çš„è§‚æµ‹å€¼æ—¶æä¾›äº†å¯¹ç›®æ ‡ä¼°è®¡çš„è‰¯å¥½è¿‘ä¼¼â€”â€”æ¢å¥è¯è¯´ï¼Œå¦‚æœ![<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math>](img/4.png)å¾ˆå¤§ã€‚ç„¶è€Œï¼Œåœ¨è®¸å¤šæ•°æ®é›†ä¸­ï¼Œå°†å­˜åœ¨ä¸€äº›è§‚æµ‹å€¼ä¸­åŒ…å«çš„ç±»åˆ«ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä»å…ˆå‰çš„å…¬å¼ä¸­å¾—å‡ºçš„ç›®æ ‡ä¼°è®¡å¯èƒ½ä¸å¯é ã€‚

ä¸ºäº†å‡è½»å¯¹ç½•è§ç±»åˆ«è¿”å›çš„ä¼°è®¡ä¸ä½³ï¼Œç›®æ ‡ä¼°è®¡å¯ä»¥ç¡®å®šä¸ºä¸¤ç§æ¦‚ç‡çš„æ··åˆï¼šå‰ä¸€ä¸ªå…¬å¼è¿”å›çš„æ¦‚ç‡å’ŒåŸºäºæ•´ä¸ªè®­ç»ƒçš„ç›®æ ‡å…ˆéªŒæ¦‚ç‡ã€‚è¿™ä¸¤ä¸ªæ¦‚ç‡é€šè¿‡ä¸€ä¸ªæƒé‡å› å­è¿›è¡Œæ··åˆï¼Œè¯¥æƒé‡å› å­æ˜¯ç±»åˆ«ç»„å¤§å°çš„å‡½æ•°ï¼š

![<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mrow><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mi>Î»</mi><mfrac><msub><mi>n</mi><mrow><mi>i</mi><mo>(</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo>)</mo></mrow></msub><msub><mi>n</mi><mi>i</mi></msub></mfrac><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>Î»</mi><mi>i</mi></msub><mo>)</mo><mfrac><msub><mi>n</mi><mi>Î»</mi></msub><mi>N</mi></mfrac></mrow></mrow></mrow></math>](img/5.png)

åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼Œ![<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Î»</mml:mi></mml:mrow></mml:msub></mml:math>](img/6.png) æ˜¯ç›®æ ‡å–å€¼ä¸º *1* çš„æ€»æ¡ˆä¾‹æ•°ï¼Œ*N* æ˜¯è®­ç»ƒé›†çš„å¤§å°ï¼Œè€Œ *ğœ†* æ˜¯æƒé‡å› å­ã€‚

å½“ç±»åˆ«ç»„è¾ƒå¤§æ—¶ï¼Œ*ğœ†* è¶‹å‘äº *1*ï¼Œå› æ­¤æ–¹ç¨‹çš„ç¬¬ä¸€é¡¹è¢«èµ‹äºˆæ›´å¤šçš„æƒé‡ã€‚å½“ç±»åˆ«ç»„è¾ƒå°æ—¶ï¼Œ*ğœ†* è¶‹å‘äº *0*ï¼Œå› æ­¤ä¼°è®¡ä¸»è¦ç”±æ–¹ç¨‹çš„ç¬¬äºŒé¡¹é©±åŠ¨â€”â€”å³ç›®æ ‡çš„å…ˆéªŒæ¦‚ç‡ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœç»„å¤§å°è¾ƒå°ï¼ŒçŸ¥é“ç±»åˆ«å€¼å¹¶ä¸èƒ½å‘Šè¯‰æˆ‘ä»¬å…³äºç›®æ ‡å€¼çš„ä¿¡æ¯ã€‚

æƒé‡å› å­ï¼Œ*ğœ†*ï¼Œåœ¨ä¸åŒçš„å¼€æºå®ç°ä¸­ç¡®å®šæ–¹å¼ä¸åŒã€‚åœ¨ Category Encoders ä¸­ï¼Œ*ğœ†* æ˜¯ç»„å¤§å°ï¼Œ*k*ï¼Œä»¥åŠå¹³æ»‘å‚æ•°ï¼Œ*f* çš„å‡½æ•°ï¼Œå®ƒæ§åˆ¶ç€å‰ä¸€ä¸ªæ–¹ç¨‹ä¸­ç¬¬ä¸€é¡¹å’Œç¬¬äºŒé¡¹ä¹‹é—´çš„è½¬æ¢é€Ÿç‡ï¼š

![<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi mathvariant="normal">Î»</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mrow><mrow><mo>âˆ’</mo><mo>(</mo><mi>n</mi><mo>âˆ’</mo><mi>k</mi><mo>)</mo></mrow></mrow><mo>/</mo><mi>f</mi></mrow></msup></mrow></mfrac></mrow></mrow></math>](img/7.png)

åœ¨è¿™é‡Œï¼Œ*k* æ˜¯æˆ‘ä»¬å®Œå…¨ä¿¡ä»»æ–¹ç¨‹ç¬¬ä¸€é¡¹çš„æœ€å°å¤§å°çš„ä¸€åŠã€‚*f* å‚æ•°ç”±ç”¨æˆ·ä»»æ„é€‰æ‹©æˆ–é€šè¿‡ä¼˜åŒ–é€‰æ‹©ã€‚

åœ¨ `scikit-learn` å’Œ `feature-engine` ä¸­ï¼Œ*ğœ†* æ˜¯æ•´ä¸ªæ•°æ®é›†å’Œç±»åˆ«å†…çš„ç›®æ ‡æ–¹å·®çš„å‡½æ•°ï¼Œå¹¶æŒ‰ä»¥ä¸‹æ–¹å¼ç¡®å®šï¼š

![<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi mathvariant="normal">Î»</mi><mo>=</mo><mfrac><mrow><mi>n</mi><mi>i</mi><mo>Ã—</mo><mi>t</mi></mrow><mrow><mi>s</mi><mo>+</mo><mi>n</mi><mi>i</mi><mo>Ã—</mo><mi>t</mi></mrow></mfrac></mrow></mrow></math>](img/8.png)

åœ¨è¿™é‡Œï¼Œ*t* æ˜¯æ•´ä¸ªæ•°æ®é›†çš„ç›®æ ‡æ–¹å·®ï¼Œè€Œ *s* æ˜¯ç±»åˆ«å†…çš„ç›®æ ‡æ–¹å·®ã€‚ä¸¤ç§å®ç°æ–¹å¼æ˜¯ç­‰æ•ˆçš„ï¼Œä½†äº†è§£è¿™äº›æ–¹ç¨‹å¼å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä»¬å°†å¸®åŠ©ä½ åœ¨å˜å‹å™¨ä¸­è®¾ç½®å‚æ•°ã€‚

æ³¨æ„

å¹³å‡ç¼–ç æ—¨åœ¨åœ¨ä¸æ‰©å±•ç‰¹å¾ç©ºé—´çš„æƒ…å†µä¸‹ç¼–ç é«˜åº¦åŸºæ•°åˆ†ç±»å˜é‡ã€‚æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚é˜…ä»¥ä¸‹æ–‡ç« ï¼šMicci-Barreca D. A.ï¼Œã€Šç”¨äºåˆ†ç±»å’Œé¢„æµ‹é—®é¢˜ä¸­é«˜åŸºæ•°åˆ†ç±»å±æ€§çš„å‰å¤„ç†æ–¹æ¡ˆã€‹ã€‚ACM SIGKDD Explorations Newsletterï¼Œ2001ã€‚

åœ¨è¿™ä¸ªé…æ–¹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `scikit-learn` å’Œ `feature-engine` æ‰§è¡Œå¹³å‡ç¼–ç ã€‚

## å¦‚ä½•æ“ä½œ...

è®©æˆ‘ä»¬ä»è¿™ä¸ªé…æ–¹å¼€å§‹ï¼š

1.  å¯¼å…¥ `pandas` å’Œæ•°æ®æ‹†åˆ†å‡½æ•°ï¼š

    ```py
    import pandas as pd
    from sklearn.model_selection import train_test_split
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ Credit Approval æ•°æ®é›†å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

1.  è®©æˆ‘ä»¬å¯¼å…¥ `scikit-learn` ä¸­çš„å˜å‹å™¨ï¼š

    ```py
    from sklearn.preprocessing import TargetEncoder
    from sklearn.compose import ColumnTransformer
    ```

1.  è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«åˆ†ç±»å˜é‡åç§°çš„åˆ—è¡¨ï¼š

    ```py
    cat_vars = X_train.select_dtypes(
    Â Â Â Â include="O").columns.to_list()
    ```

1.  è®©æˆ‘ä»¬å°†ç¼–ç å™¨è®¾ç½®ä¸ºä½¿ç”¨ç›®æ ‡æ–¹å·®æ¥ç¡®å®šæƒé‡å› å­ï¼Œæ­£å¦‚é…æ–¹å¼€å¤´æ‰€è¿°ï¼š

    ```py
    enc = TargetEncoder(smooth="auto", random_state=9)
    ```

1.  è®©æˆ‘ä»¬å°†æ’è¡¥é™åˆ¶ä¸ºåˆ†ç±»å˜é‡ï¼š

    ```py
    ct = ColumnTransformer(
    Â Â Â Â [("encoder", enc, cat_vars)],
    Â Â Â Â remainder="passthrough",
    ).set_output(transform="pandas")
    ```

1.  è®©æˆ‘ä»¬æ‹Ÿåˆç¼–ç å™¨å¹¶è½¬æ¢æ•°æ®é›†ï¼š

    ```py
    X_train_enc = ct.fit_transform(X_train, y_train)
    X_test_enc = ct.transform(X_test)
    ```

    é€šè¿‡æ‰§è¡Œ `X_train_enc.head()` æ£€æŸ¥ç»“æœã€‚

æ³¨æ„

`scikit-learn` çš„ `TargetEncoder()` çš„ `fit_transform()` æ–¹æ³•ä¸ `fit().transform()` çš„åº”ç”¨ä¸ç­‰ä»·ã€‚ä½¿ç”¨ `fit_transform()`ï¼Œç”Ÿæˆçš„æ•°æ®é›†åŸºäºäº¤å‰éªŒè¯æ–¹æ¡ˆè®­ç»ƒæŠ˜çš„å±€éƒ¨æ‹Ÿåˆè¿›è¡Œç¼–ç ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯æ•…æ„è®¾è®¡çš„ï¼Œä»¥é˜²æ­¢æœºå™¨å­¦ä¹ æ¨¡å‹è¿‡åº¦æ‹Ÿåˆè®­ç»ƒé›†ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ `feature-engine` æ‰§è¡Œç›®æ ‡ç¼–ç ï¼š

1.  è®©æˆ‘ä»¬å¯¼å…¥ç¼–ç å™¨ï¼š

    ```py
    from feature_engine.encoding import MeanEncoder
    ```

1.  è®©æˆ‘ä»¬è®¾ç½®ç›®æ ‡å¹³å‡ç¼–ç å™¨ï¼Œåœ¨åº”ç”¨å¹³æ»‘çš„åŒæ—¶ç¼–ç æ‰€æœ‰åˆ†ç±»å˜é‡ï¼š

    ```py
    mean_enc = MeanEncoder(smoothing="auto",
    Â Â Â Â variables=None)
    ```

æ³¨æ„

`MeanEncoder()` é»˜è®¤ä¸åº”ç”¨å¹³æ»‘ã€‚ç¡®ä¿å°†å…¶è®¾ç½®ä¸º `auto` æˆ–æ•´æ•°ä»¥æ§åˆ¶å…ˆéªŒå’ŒåéªŒç›®æ ‡ä¼°è®¡ä¹‹é—´çš„æ··åˆã€‚

1.  è®©æˆ‘ä»¬å°†å˜å‹å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ï¼Œä»¥ä¾¿å®ƒå­¦ä¹ å¹¶å­˜å‚¨æ¯ä¸ªå˜é‡æ¯ä¸ªç±»åˆ«çš„å¹³å‡ç›®æ ‡å€¼ï¼š

    ```py
    mean_enc.fit(X_train, y_train)
    ```

1.  æœ€åï¼Œè®©æˆ‘ä»¬å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†è¿›è¡Œç¼–ç ï¼š

    ```py
    X_train_enc = mean_enc.transform(X_train)
    X_test_enc = mean_enc.transform(X_test)
    ```

æ³¨æ„

ç±»åˆ«åˆ°æ•°å­—å¯¹å­˜å‚¨åœ¨ `encoder_dict_` å±æ€§ä¸­çš„å­—å…¸å­—å…¸ä¸­ã€‚è¦æ˜¾ç¤ºå­˜å‚¨çš„å‚æ•°ï¼Œæ‰§è¡Œ `mean_enc.encoder_dict_`ã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªé…æ–¹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `scikit-learn` å’Œ `feature-engine` å°†ç±»åˆ«æ›¿æ¢ä¸ºå¹³å‡ç›®æ ‡å€¼ã€‚

è¦ä½¿ç”¨ `scikit-learn` è¿›è¡Œç¼–ç ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `TargetEncoder()`ï¼Œå°† `smooth` å‚æ•°ä¿ç•™ä¸ºå…¶é»˜è®¤å€¼ `auto`ã€‚è¿™æ ·ï¼Œå˜å‹å™¨ä½¿ç”¨ç›®æ ‡æ–¹å·®æ¥ç¡®å®šæ¦‚ç‡æ··åˆçš„æƒé‡å› å­ã€‚ä½¿ç”¨ `fit()`ï¼Œå˜å‹å™¨å­¦ä¹ å®ƒåº”è¯¥ç”¨æ¥æ›¿æ¢ç±»åˆ«çš„å€¼ï¼Œè€Œä½¿ç”¨ `transform()`ï¼Œå®ƒæ›¿æ¢äº†ç±»åˆ«ã€‚

æ³¨æ„ï¼Œå¯¹äº`TargetEncoder()`ï¼Œ`fit()`æ–¹æ³•åé¢è·Ÿ`transform()`æ–¹æ³•å¹¶ä¸è¿”å›ä¸`fit_transform()`æ–¹æ³•ç›¸åŒçš„æ•°æ®é›†ã€‚åè€…åŸºäºäº¤å‰éªŒè¯æ‰¾åˆ°çš„æ˜ å°„æ¥ç¼–ç è®­ç»ƒé›†ã€‚æƒ³æ³•æ˜¯åœ¨ç®¡é“ä¸­ä½¿ç”¨`fit_transform()`ï¼Œè¿™æ ·æœºå™¨å­¦ä¹ æ¨¡å‹å°±ä¸ä¼šè¿‡æ‹Ÿåˆã€‚ç„¶è€Œï¼Œè¿™é‡Œå˜å¾—æœ‰äº›å¤æ‚ï¼Œå­˜å‚¨åœ¨`encodings_`å±æ€§ä¸­çš„æ˜ å°„åœ¨`fit()`å’Œ`fit_transform()`ä¹‹åæ˜¯ç›¸åŒçš„ï¼Œè¿™æ˜¯æ•…æ„ä¸ºä¹‹ï¼Œä»¥ä¾¿å½“æˆ‘ä»¬å°†`transform()`åº”ç”¨äºæ–°æ•°æ®é›†æ—¶ï¼Œæ— è®ºæˆ‘ä»¬æ˜¯å¦å°†`fit()`æˆ–`fit_transform()`åº”ç”¨äºè®­ç»ƒé›†ï¼Œæˆ‘ä»¬éƒ½ä¼šè·å¾—ç›¸åŒçš„ç»“æœã€‚

æ³¨æ„

æœªè§è¿‡ç±»åˆ«ç”±`scikit-learn`çš„`TargetEncoder()`ç”¨ç›®æ ‡å‡å€¼è¿›è¡Œç¼–ç ã€‚`feature-engine`çš„`MeanEncoder()`å¯ä»¥è¿”å›é”™è¯¯ï¼Œç”¨`nan`æ›¿æ¢æœªè§è¿‡ç±»åˆ«ï¼Œæˆ–è€…ç”¨ç›®æ ‡å‡å€¼æ›¿æ¢ã€‚

ä½¿ç”¨`feature-engine`è¿›è¡Œç›®æ ‡ç¼–ç æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`MeanEncoder()`ï¼Œå¹¶å°†`smoothing`å‚æ•°è®¾ç½®ä¸º`auto`ã€‚é€šè¿‡`fit()`æ–¹æ³•ï¼Œè½¬æ¢å™¨æ‰¾åˆ°äº†å¹¶å­˜å‚¨äº†åˆ†ç±»å˜é‡ä»¥åŠç¼–ç æ¯ä¸ªç±»åˆ«çš„å€¼ã€‚é€šè¿‡`transform()`æ–¹æ³•ï¼Œå®ƒç”¨æ•°å­—æ›¿æ¢äº†ç±»åˆ«ï¼Œè¿”å›`pandas`æ•°æ®æ¡†ã€‚

## è¿˜æœ‰æ›´å¤š...

å¦‚æœä½ æƒ³ä½¿ç”¨`pandas`æˆ–ç±»åˆ«ç¼–ç å™¨å®ç°ç›®æ ‡ç¼–ç ï¼Œè¯·æŸ¥çœ‹éšé™„ GitHub ä»“åº“ä¸­çš„ç¬”è®°æœ¬ï¼š[`github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-06-Target-mean-encoding.ipynb`](https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-06-Target-mean-encoding.ipynb)ã€‚

å½“ç±»åˆ«ç»„è¾ƒå°æ—¶ï¼Œæœ‰ä¸€ç§æ›¿ä»£æ–¹æ³•å¯ä»¥è¿”å›*æ›´å¥½çš„*ç›®æ ‡ä¼°è®¡ã€‚æ¯ä¸ªç±»åˆ«çš„æ›¿æ¢å€¼ç¡®å®šå¦‚ä¸‹ï¼š

![<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>n</mi><mrow><mi>i</mi><mfenced open="(" close=")"><mrow><mi>Y</mi><mo>=</mo><mn>1</mn></mrow></mfenced></mrow></msub><mo>+</mo><mi>p</mi><mi>Y</mi><mi>x</mi><mi>m</mi></mrow><mrow><msub><mi>n</mi><mi>i</mi></msub><mo>+</mo><mi>m</mi></mrow></mfrac></mrow></mrow></math>](img/9.png)

åœ¨è¿™é‡Œï¼Œ![<math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>n</mi><mrow><mi>i</mi><mo>(</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo>)</mo></mrow></msub></mrow></math>](img/10.png) æ˜¯ç±»åˆ« *i* çš„ç›®æ ‡å‡å€¼ï¼Œè€Œ ![<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math>](img/11.png) æ˜¯å…·æœ‰ç±»åˆ« *i* çš„è§‚æµ‹æ•°ã€‚ç›®æ ‡å…ˆéªŒç”± *pY* ç»™å‡ºï¼Œè€Œ *m* æ˜¯æƒé‡å› å­ã€‚é€šè¿‡è¿™ç§è°ƒæ•´ï¼Œæˆ‘ä»¬å”¯ä¸€éœ€è¦è®¾ç½®çš„å‚æ•°æ˜¯æƒé‡ï¼Œ*m*ã€‚å¦‚æœ *m* è¾ƒå¤§ï¼Œåˆ™æ›´é‡è§†ç›®æ ‡çš„å…ˆéªŒæ¦‚ç‡ã€‚è¿™ç§è°ƒæ•´ä¼šå½±å“æ‰€æœ‰ç±»åˆ«çš„ç›®æ ‡ä¼°è®¡ï¼Œä½†å¯¹äºè§‚æµ‹æ•°è¾ƒå°‘çš„ç±»åˆ«å½±å“æ›´å¤§ï¼Œå› ä¸ºåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ*m* å¯èƒ½æ¯”å…¬å¼åˆ†æ¯ä¸­çš„ ![<mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math>](img/12.png) å¤§å¾—å¤šã€‚

æ³¨æ„

è¿™ç§æ–¹æ³•æ˜¯ Category Encoders çš„ `TargetEncoder()` çš„è‰¯å¥½æ›¿ä»£å“ï¼Œå› ä¸ºåœ¨ Category Encoders çš„ç›®æ ‡ç¼–ç å®ç°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¼˜åŒ–ä¸¤ä¸ªå‚æ•°è€Œä¸æ˜¯ä¸€ä¸ªï¼ˆæ­£å¦‚æˆ‘ä»¬åœ¨ `feature-engine` å’Œ `scikit-learn` ä¸­æ‰€åšçš„é‚£æ ·ï¼‰æ¥æ§åˆ¶å¹³æ»‘åº¦ã€‚

è¦äº†è§£ä½¿ç”¨ `MEstimateEncoder()` å®ç°æ­¤ç¼–ç æ–¹æ³•çš„ç¤ºä¾‹ï¼Œè¯·è®¿é—®æ­¤ä¹¦çš„ GitHub ä»“åº“ï¼š[`github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-06-Target-mean-encoding.ipynb`](https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-06-Target-mean-encoding.ipynb)ã€‚

# ä½¿ç”¨è¯æ®æƒé‡è¿›è¡Œç¼–ç 

**è¯æ®æƒé‡**ï¼ˆ**WoE**ï¼‰ä¸»è¦æ˜¯åœ¨ä¿¡ç”¨å’Œé‡‘èè¡Œä¸šå¼€å‘çš„ï¼Œæ—¨åœ¨ä¿ƒè¿›å˜é‡ç­›é€‰å’Œæ¢ç´¢æ€§åˆ†æï¼Œå¹¶æ„å»ºæ›´é¢„æµ‹æ€§çš„çº¿æ€§æ¨¡å‹æ¥è¯„ä¼°è´·æ¬¾è¿çº¦çš„é£é™©ã€‚

WoE æ˜¯ä»åŸºæœ¬æ¦‚ç‡æ¯”è®¡ç®—å¾—å‡ºçš„ï¼š

![<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>WoE</mi><mo>=</mo><mi>log</mi><mrow><mrow><mo>(</mo><mfrac><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>s</mi></mrow><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>n</mi><mi>e</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>s</mi></mrow></mfrac><mo>)</mo></mrow></mrow></mrow></mrow></math>](img/13.png)

åœ¨è¿™é‡Œï¼Œæ­£è´Ÿåˆ†åˆ«æŒ‡ç›®æ ‡å€¼çš„*1*æˆ–*0*ï¼Œæ¯ä¸ªç±»åˆ«çš„æ­£ä¾‹æ¯”ä¾‹æ˜¯æ¯ä¸ªç±»åˆ«ç»„æ­£ä¾‹æ€»å’Œé™¤ä»¥è®­ç»ƒé›†ä¸­æ­£ä¾‹æ€»æ•°ã€‚æ¯ä¸ªç±»åˆ«çš„è´Ÿä¾‹æ¯”ä¾‹æ˜¯æ¯ä¸ªç±»åˆ«ç»„è´Ÿä¾‹æ€»å’Œé™¤ä»¥è®­ç»ƒé›†ä¸­è´Ÿè§‚å¯Ÿå€¼çš„æ€»æ•°ã€‚

WOE å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

+   å½“*p(æ­£é¢)* / *p(è´Ÿé¢)* = *1*æ—¶ï¼ŒWOE = *0*ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç»“æœæ˜¯éšæœºçš„ã€‚

+   å½“*p(æ­£é¢)* > *p(è´Ÿé¢)*æ—¶ï¼ŒWOE > *0*ã€‚

+   å½“*p(è´Ÿé¢)* > *p(æ­£é¢)*æ—¶ï¼ŒWOE < *0*ã€‚

è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥å¯è§†åŒ–å˜é‡ä¸­ç±»åˆ«çš„é¢„æµ‹èƒ½åŠ›ï¼šWOE è¶Šé«˜ï¼Œäº‹ä»¶å‘ç”Ÿçš„å¯èƒ½æ€§è¶Šå¤§ã€‚å¦‚æœ WOE ä¸ºæ­£ï¼Œåˆ™äº‹ä»¶å¾ˆå¯èƒ½å‘ç”Ÿã€‚

é€»è¾‘å›å½’æ¨¡å‹åŸºäºé¢„æµ‹å˜é‡*X*çš„äºŒè¿›åˆ¶å“åº”*Y*ï¼Œå‡è®¾*X*ä¸*Y*çš„å¯¹æ•°ä¼˜åŠ¿ä¹‹é—´å­˜åœ¨çº¿æ€§å…³ç³»ï¼š

![<math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mrow><mi>log</mi><mfenced open="(" close=")"><mfrac><mrow><mi>p</mi><mfenced open="(" close=")"><mrow><mi>Y</mi><mo>=</mo><mn>1</mn></mrow></mfenced></mrow><mrow><mi>p</mi><mfenced open="(" close=")"><mrow><mi>Y</mi><mo>=</mo><mn>0</mn></mrow></mfenced></mrow></mfrac></mfenced><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><msub><mi>X</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><msub><mi>X</mi><mn>2</mn></msub><mo>+</mo><mo>â€¦</mo><mo>+</mo><msub><mi>b</mi><mi>n</mi></msub><msub><mi>X</mi><mi>n</mi></msub></mrow></mrow></math>](img/14.png)

è¿™é‡Œï¼Œ*log (p(Y=1)/p(Y=0))* æ˜¯ä¼˜åŠ¿æ¯”çš„å¯¹æ•°ã€‚æ­£å¦‚ä½ æ‰€è§ï¼ŒWOE å°†ç±»åˆ«ç¼–ç åœ¨ç›¸åŒçš„å°ºåº¦ä¸Šâ€”â€”å³ä¼˜åŠ¿æ¯”çš„å¯¹æ•°â€”â€”ä¸é€»è¾‘å›å½’çš„ç»“æœç›¸åŒã€‚

å› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨ WOEï¼Œé¢„æµ‹å› å­è¢«å‡†å¤‡å¹¶ç¼–ç åœ¨åŒä¸€å°ºåº¦ä¸Šï¼Œé€»è¾‘å›å½’æ¨¡å‹ä¸­çš„å‚æ•°â€”â€”å³ç³»æ•°â€”â€”å¯ä»¥ç›´æ¥æ¯”è¾ƒã€‚

åœ¨è¿™ä¸ªèœè°±ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`pandas`å’Œ`feature-engine`æ‰§è¡Œ WOE ç¼–ç ã€‚

## å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹...

è®©æˆ‘ä»¬å…ˆè¿›è¡Œä¸€äº›å¯¼å…¥å’Œå‡†å¤‡æ•°æ®ï¼š

1.  å¯¼å…¥æ‰€éœ€çš„åº“å’Œå‡½æ•°ï¼š

    ```py
    import numpy as np
    import pandas as pd
    from sklearn.model_selection import train_test_split
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ Credit Approval æ•°æ®é›†å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

1.  è®©æˆ‘ä»¬è·å–ç›®æ ‡å€¼çš„é€†ï¼Œä»¥ä¾¿èƒ½å¤Ÿè®¡ç®—è´Ÿä¾‹ï¼š

    ```py
    neg_y_train = pd.Series(
    Â Â Â Â np.where(y_train == 1, 0, 1),
    Â Â Â Â index=y_train.index
    )
    ```

1.  è®©æˆ‘ä»¬ç¡®å®šç›®æ ‡å˜é‡å–å€¼ä¸º`1`æˆ–`0`çš„è§‚æµ‹æ•°ï¼š

    ```py
    total_pos = y_train.sum()
    total_neg = neg_y_train.sum()
    ```

1.  ç°åœ¨ï¼Œè®©æˆ‘ä»¬è®¡ç®—æˆ‘ä»¬ä¹‹å‰åœ¨æœ¬èœè°±ä¸­è®¨è®ºçš„ WOE å…¬å¼çš„åˆ†å­å’Œåˆ†æ¯ï¼š

    ```py
    pos = y_train.groupby(
    Â Â Â Â X_train["A1"]).sum() / total_pos
    neg = neg_y_train.groupby(
    Â Â Â Â X_train["A1"]).sum() / total_neg
    ```

1.  ç°åœ¨ï¼Œè®©æˆ‘ä»¬è®¡ç®—æ¯ä¸ªç±»åˆ«çš„ WOE å€¼ï¼š

    ```py
    woe = np.log(pos/neg)
    ```

    æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ`print(woe)`æ¥æ˜¾ç¤ºå…·æœ‰ç±»åˆ«åˆ° WOE å¯¹çš„åºåˆ—ï¼š

    ```py
    A1
    MissingÂ Â Â Â 0.203599
    aÂ Â Â Â Â Â Â Â Â Â 0.092373
    bÂ Â Â Â Â Â Â Â Â -0.042410
    A1 with the WoE in a copy of the datasets:

    ```

    X_train_enc = X_train.copy()

    X_test_enc = X_test.copy()

    X_train_enc["A1"] = X_train_enc["A1"].map(woe)

    X_test_enc["A1"] = X_test_enc["A1"].map(woe)

    ```py

    You can inspect the encoded variable by executing `X_train_enc["A1"].head()`.Now, letâ€™s perform WoE encoding using `feature-engine`.
    ```

1.  è®©æˆ‘ä»¬å¯¼å…¥ç¼–ç å™¨ï¼š

    ```py
    from feature_engine.encoding import WoEEncoder
    ```

1.  æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬è®¾ç½®ç¼–ç å™¨ä»¥ç¼–ç ä¸‰ä¸ªåˆ†ç±»å˜é‡ï¼š

    ```py
    woe_enc = WoEEncoder(variables = ["A1", "A9", "A12"])
    ```

æ³¨æ„

å¯¹äºç¨€å°‘ç±»åˆ«ï¼Œå¯èƒ½ä¼šå‘ç”Ÿ`p(0)=0`æˆ–`p(1)=0`çš„æƒ…å†µï¼Œè¿™æ—¶é™¤æ³•æˆ–å¯¹æ•°æ²¡æœ‰å®šä¹‰ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè¯·æŒ‰ç…§*åˆ†ç»„ç¨€å°‘æˆ–ä¸å¸¸è§ç±»åˆ«*é£Ÿè°±ä¸­çš„æ–¹æ³•å°†ä¸å¸¸è§çš„ç±»åˆ«åˆ†ç»„ã€‚

1.  è®©æˆ‘ä»¬å°†è½¬æ¢å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ï¼Œä»¥ä¾¿å®ƒå­¦ä¹ å¹¶å­˜å‚¨ä¸åŒç±»åˆ«çš„ WoEï¼š

    ```py
    woe_enc.fit(X_train, y_train)
    ```

æ³¨æ„

æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ`woe_enc.encoder_dict_`æ¥æ˜¾ç¤ºå…·æœ‰ç±»åˆ«åˆ° WoE å¯¹çš„å­—å…¸ã€‚

1.  æœ€åï¼Œè®©æˆ‘ä»¬å°†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­çš„ä¸‰ä¸ªåˆ†ç±»å˜é‡è¿›è¡Œç¼–ç ï¼š

    ```py
    X_train_enc = woe_enc.transform(X_train)
    X_test_enc = woe_enc.transform(X_test)
    ```

`feature-engine`è¿”å›åŒ…å«ç¼–ç å¥½çš„åˆ†ç±»å˜é‡çš„`pandas` DataFrameï¼Œè¿™äº›å˜é‡å¯ä»¥ç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªé£Ÿè°±ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`pandas`å’Œ`feature-engine`å¯¹åˆ†ç±»å˜é‡è¿›è¡Œäº† WoE ç¼–ç ã€‚

æˆ‘ä»¬ç»“åˆäº†`pandas`çš„`sum()`å’Œ`groupby()`ä»¥åŠ`numpy`çš„`log()`ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨æœ¬é£Ÿè°±å¼€å¤´æ‰€æè¿°çš„é‚£æ ·ï¼Œæ¥ç¡®å®š WoEã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`feature-engine`è‡ªåŠ¨åŒ–äº†è¯¥è¿‡ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨äº†`WoEEncoder()`ï¼Œå®ƒä½¿ç”¨`fit()`æ–¹æ³•å­¦ä¹ æ¯ä¸ªç±»åˆ«çš„ WoEï¼Œç„¶åä½¿ç”¨`transform()`å°†ç±»åˆ«æ›¿æ¢ä¸ºç›¸åº”çš„æ•°å­—ã€‚

## å‚è§

è¦æŸ¥çœ‹ä½¿ç”¨ç±»åˆ«ç¼–ç å™¨çš„ WoE çš„å®ç°ï¼Œè¯·è®¿é—®æœ¬ä¹¦çš„ GitHub ä»“åº“ï¼š[`github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-07-Weight-of-evidence.ipynb`](https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-07-Weight-of-evidence.ipynb)ã€‚

# åˆ†ç»„ç¨€å°‘æˆ–ä¸å¸¸è§çš„ç±»åˆ«

ç¨€å°‘ç±»åˆ«æ˜¯æŒ‡åªå­˜åœ¨äºè§‚æµ‹ä¸­ä¸€å°éƒ¨åˆ†çš„ç±»åˆ«ã€‚æ²¡æœ‰è§„åˆ™å¯ä»¥ç¡®å®šå¤šå°å¯ä»¥è¢«è®¤ä¸ºæ˜¯å°çš„ï¼Œä½†é€šå¸¸ï¼Œä»»ä½•ä½äº 5%çš„å€¼éƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ç¨€å°‘çš„ã€‚

ä¸å¸¸è§çš„æ ‡ç­¾é€šå¸¸åªå‡ºç°åœ¨è®­ç»ƒé›†æˆ–æµ‹è¯•é›†ä¸­ï¼Œè¿™ä½¿å¾—ç®—æ³•å®¹æ˜“è¿‡æ‹Ÿåˆæˆ–æ— æ³•è¯„åˆ†è§‚æµ‹ã€‚æ­¤å¤–ï¼Œå½“å°†ç±»åˆ«ç¼–ç ä¸ºæ•°å­—æ—¶ï¼Œæˆ‘ä»¬åªä¸ºåœ¨è®­ç»ƒé›†ä¸­è§‚å¯Ÿåˆ°çš„ç±»åˆ«åˆ›å»ºæ˜ å°„ï¼Œå› æ­¤æˆ‘ä»¬ä¸çŸ¥é“å¦‚ä½•ç¼–ç æ–°çš„æ ‡ç­¾ã€‚ä¸ºäº†é¿å…è¿™äº›å¤æ‚æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸å¸¸è§çš„ç±»åˆ«ç»„åˆæˆä¸€ä¸ªç§°ä¸º`Rare`æˆ–`Other`çš„å•ä¸ªç±»åˆ«ã€‚

åœ¨è¿™ä¸ªé£Ÿè°±ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`pandas`å’Œ`feature-engine`å¯¹ä¸å¸¸è§çš„ç±»åˆ«è¿›è¡Œåˆ†ç»„ã€‚

## å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹...

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¯¼å…¥å¿…è¦çš„ Python åº“å¹¶å‡†å¤‡å¥½æ•°æ®é›†ï¼š

1.  å¯¼å…¥å¿…è¦çš„ Python åº“ã€å‡½æ•°å’Œç±»ï¼š

    ```py
    import numpy as np
    import pandas as pd
    from sklearn.model_selection import train_test_split
    from feature_engine.encoding import RareLabelEncoder
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ Credit Approval æ•°æ®é›†å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

1.  è®©æˆ‘ä»¬åœ¨å˜é‡`A7`ä¸­æ•è·æ¯ä¸ªç±»åˆ«çš„è§‚æµ‹æ¯”ä¾‹ï¼š

    ```py
    freqs = X_train["A7"].value_counts(normalize=True)
    ```

    åœ¨æ‰§è¡Œ`print(freqs)`åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºä¸­`A7`æ¯ä¸ªç±»åˆ«çš„è§‚æµ‹ç™¾åˆ†æ¯”ï¼Œä»¥å°æ•°è¡¨ç¤ºï¼š

    ```py
    v 0.573499
    h 0.209110
    ff 0.084886
    bb 0.080745
    z 0.014493
    dd 0.010352
    j 0.010352
    Missing 0.008282
    n 0.006211
    o 0.002070
    z, dd, j, Missing, n, and o are rare categories.
    ```

1.  è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«åœ¨è¶…è¿‡ 5%çš„è§‚æµ‹ä¸­å­˜åœ¨çš„ç±»åˆ«åç§°çš„åˆ—è¡¨ï¼š

    ```py
    frequent_cat = [
    Â Â Â Â x for x in freqs.loc[freqs > 0.05].index.values]
    ```

    å¦‚æœæˆ‘ä»¬æ‰§è¡Œ`print(frequent_cat)`ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°`A7`çš„é¢‘ç¹ç±»åˆ«ï¼š

    ```py
    Rare string in a copy of the datasets:

    ```

    X_train_enc = X_train.copy()

    X_test_enc = X_test.copy()

    X_train_enc["A7"] = np.where(X_train["A7"].isin(

    frequent_cat), X_train["A7"], "Rare")

    X_test_enc["A7"] = np.where(X_test["A7"].isin(

    frequent_cat), X_test["A7"], "Rare")

    ```py

    ```

1.  è®©æˆ‘ä»¬ç¡®å®šç¼–ç å˜é‡ä¸­è§‚æµ‹å€¼çš„ç™¾åˆ†æ¯”ï¼š

    ```py
    X_train["A7"].value_counts(normalize=True)
    ```

    æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸é¢‘ç¹çš„æ ‡ç­¾ç°åœ¨å·²ç»è¢«é‡æ–°åˆ†ç»„åˆ°`Rare`ç±»åˆ«ä¸­ï¼š

    ```py
    vÂ Â Â Â Â Â Â 0.573499
    hÂ Â Â Â Â Â Â 0.209110
    ffÂ Â Â Â Â Â 0.084886
    bbÂ Â Â Â Â Â 0.080745
    RareÂ Â Â Â 0.051760
    feature-engine.
    ```

1.  è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç¨€å°‘æ ‡ç­¾ç¼–ç å™¨ï¼Œå°†å°‘äº 5%çš„è§‚æµ‹å€¼ä¸­å­˜åœ¨çš„ç±»åˆ«åˆ†ç»„ï¼Œå‰ææ˜¯åˆ†ç±»å˜é‡æœ‰è¶…è¿‡å››ä¸ªä¸åŒçš„å€¼ï¼š

    ```py
    rare_encoder = RareLabelEncoder(tol=0.05,
    Â Â Â Â n_categories=4)
    ```

1.  è®©æˆ‘ä»¬æ‹Ÿåˆç¼–ç å™¨ï¼Œä»¥ä¾¿å®ƒæ‰¾åˆ°åˆ†ç±»å˜é‡ï¼Œç„¶åå­¦ä¹ å®ƒä»¬çš„é¢‘ç¹ç±»åˆ«ï¼š

    ```py
    rare_encoder.fit(X_train)
    ```

æ³¨æ„

åœ¨æ‹Ÿåˆè¿‡ç¨‹ä¸­ï¼Œè½¬æ¢å™¨å°†å‘å‡ºè­¦å‘Šï¼Œè¡¨æ˜è®¸å¤šåˆ†ç±»å˜é‡å°‘äºå››ä¸ªç±»åˆ«ï¼Œå› æ­¤å®ƒä»¬çš„å€¼å°†ä¸ä¼šè¢«åˆ†ç»„ã€‚è½¬æ¢å™¨åªæ˜¯è®©ä½ çŸ¥é“è¿™ç§æƒ…å†µæ­£åœ¨å‘ç”Ÿã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ`rare_encoder.encoder_dict_`æ¥æ˜¾ç¤ºæ¯ä¸ªå˜é‡çš„é¢‘ç¹ç±»åˆ«ï¼Œä»¥åŠæ‰§è¡Œ`rare_encoder.variables_`æ¥æ˜¾ç¤ºå°†è¢«ç¼–ç çš„å˜é‡ã€‚

1.  æœ€åï¼Œè®©æˆ‘ä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­å¯¹ç¨€å°‘æ ‡ç­¾è¿›è¡Œåˆ†ç»„ï¼š

    ```py
    X_train_enc = rare_encoder.transform(X_train)
    X_test_enc = rare_encoder.transform(X_test)
    ```

ç°åœ¨æˆ‘ä»¬å·²ç»åˆ†ç»„äº†ç¨€å°‘æ ‡ç­¾ï¼Œæˆ‘ä»¬å‡†å¤‡å¯¹åˆ†ç±»å˜é‡è¿›è¡Œç¼–ç ï¼Œå°±åƒæˆ‘ä»¬åœ¨æœ¬ç« å‰é¢çš„é£Ÿè°±ä¸­æ‰€åšçš„é‚£æ ·ã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªé£Ÿè°±ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`pandas`å’Œ`feature-engine`å°†ä¸é¢‘ç¹çš„ç±»åˆ«åˆ†ç»„ã€‚

æˆ‘ä»¬ä½¿ç”¨`pandas`çš„`value_counts()`ç¡®å®šäº†`A7`å˜é‡æ¯ä¸ªç±»åˆ«çš„è§‚æµ‹å€¼æ¯”ä¾‹ï¼Œé€šè¿‡å°†`normalize`å‚æ•°è®¾ç½®ä¸º`True`ã€‚ä½¿ç”¨åˆ—è¡¨æ¨å¯¼ï¼Œæˆ‘ä»¬æ•è·äº†åœ¨è¶…è¿‡ 5%çš„è§‚æµ‹å€¼ä¸­å­˜åœ¨çš„å˜é‡åç§°ã€‚æœ€åï¼Œä½¿ç”¨ NumPy çš„`where()`ï¼Œæˆ‘ä»¬æœç´¢`A7`çš„æ¯ä¸€è¡Œï¼Œå¦‚æœè§‚æµ‹å€¼æ˜¯åˆ—è¡¨ä¸­çš„é¢‘ç¹ç±»åˆ«ä¹‹ä¸€ï¼Œæˆ‘ä»¬ä½¿ç”¨`pandas`çš„`isin()`è¿›è¡Œæ£€æŸ¥ï¼Œåˆ™ä¿ç•™å…¶å€¼ï¼›å¦åˆ™ï¼Œå°†å…¶æ›¿æ¢ä¸º`Rare`ã€‚

æˆ‘ä»¬ä½¿ç”¨`feature-engine`çš„`RareLabelEncoder()`è‡ªåŠ¨åŒ–äº†å‰é¢å¤šä¸ªåˆ†ç±»å˜é‡çš„æ­¥éª¤ã€‚é€šè¿‡å°†`tol`è®¾ç½®ä¸º`0.05`ï¼Œæˆ‘ä»¬ä¿ç•™äº†åœ¨è¶…è¿‡ 5%çš„è§‚æµ‹å€¼ä¸­å­˜åœ¨çš„ç±»åˆ«ã€‚é€šè¿‡å°†`n_categories`è®¾ç½®ä¸º`4`ï¼Œæˆ‘ä»¬åªå¯¹å…·æœ‰è¶…è¿‡å››ä¸ªå”¯ä¸€å€¼çš„å˜é‡ä¸­çš„ç±»åˆ«è¿›è¡Œåˆ†ç»„ã€‚ä½¿ç”¨`fit()`ï¼Œè½¬æ¢å™¨è¯†åˆ«äº†åˆ†ç±»å˜é‡ï¼Œç„¶åå­¦ä¹ å¹¶å­˜å‚¨äº†å®ƒä»¬çš„é¢‘ç¹ç±»åˆ«ã€‚ä½¿ç”¨`transform()`ï¼Œè½¬æ¢å™¨å°†ä¸é¢‘ç¹çš„ç±»åˆ«æ›¿æ¢ä¸º`Rare`å­—ç¬¦ä¸²ã€‚

# æ‰§è¡ŒäºŒè¿›åˆ¶ç¼–ç 

æ•´æ•°`1`å¯ä»¥ç”¨`1-0`çš„åºåˆ—è¡¨ç¤ºï¼Œæ•´æ•°`2`ç”¨`0-1`è¡¨ç¤ºï¼Œæ•´æ•°`3`ç”¨`1-1`è¡¨ç¤ºï¼Œè€Œæ•´æ•°`0`ç”¨`0-0`è¡¨ç¤ºã€‚äºŒè¿›åˆ¶å­—ç¬¦ä¸²çš„ä¸¤ä¸ªä½ç½®çš„æ•°å­—æˆä¸ºåˆ—ï¼Œå®ƒä»¬æ˜¯åŸå§‹å˜é‡çš„ç¼–ç è¡¨ç¤ºï¼š

![å›¾ 2.10 â€“ è¡¨æ ¼æ˜¾ç¤ºå¯¹é¢œè‰²å˜é‡è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç æ‰€éœ€çš„æ­¥éª¤](img/B22396_02_10.jpg)

å›¾ 2.10 â€“ æ˜¾ç¤ºäºŒè¿›åˆ¶ç¼–ç é¢œè‰²å˜é‡çš„æ­¥éª¤çš„è¡¨æ ¼

äºŒè¿›åˆ¶ç¼–ç åœ¨ç»´åº¦ä¸Šæ¯”ç‹¬çƒ­ç¼–ç å°‘ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ`Color`å˜é‡å°†é€šè¿‡ç‹¬çƒ­ç¼–ç ç¼–ç ä¸º*k-1*ç±»åˆ«â€”â€”å³ä¸‰ä¸ªå˜é‡â€”â€”ä½†ä½¿ç”¨äºŒè¿›åˆ¶ç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥åªç”¨ä¸¤ä¸ªç‰¹å¾æ¥è¡¨ç¤ºå˜é‡ã€‚æ›´æ™®éåœ°ï¼Œæˆ‘ä»¬ç¡®å®šç¼–ç ä¸€ä¸ªå˜é‡æ‰€éœ€çš„äºŒè¿›åˆ¶ç‰¹å¾æ•°é‡ä¸º*log2(ä¸åŒç±»åˆ«çš„æ•°é‡)*ï¼›åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ*log2(4) = 2*äºŒè¿›åˆ¶ç‰¹å¾ã€‚

äºŒè¿›åˆ¶ç¼–ç æ˜¯ä¸€ç§æ›¿ä»£ç‹¬çƒ­ç¼–ç çš„æ–¹æ³•ï¼Œåœ¨è¿™ç§æ–¹æ³•ä¸­æˆ‘ä»¬ä¸ä¼šä¸¢å¤±å˜é‡çš„ä¿¡æ¯ï¼Œä½†åœ¨ç¼–ç åæˆ‘ä»¬è·å¾—çš„ç‰¹å¾æ›´å°‘ã€‚è¿™åœ¨å¤„ç†é«˜åº¦åŸºæ•°å˜é‡æ—¶å°¤å…¶æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå˜é‡åŒ…å« 128 ä¸ªç‹¬ç‰¹çš„ç±»åˆ«ï¼Œä½¿ç”¨ç‹¬çƒ­ç¼–ç ï¼Œæˆ‘ä»¬éœ€è¦ 127 ä¸ªç‰¹å¾æ¥ç¼–ç è¿™ä¸ªå˜é‡ï¼Œè€Œä½¿ç”¨äºŒè¿›åˆ¶ç¼–ç ï¼Œæˆ‘ä»¬åªéœ€è¦*7ï¼ˆlog2(128)=7ï¼‰*ã€‚å› æ­¤ï¼Œè¿™ç§ç¼–ç å¯ä»¥é˜²æ­¢ç‰¹å¾ç©ºé—´çˆ†ç‚¸ã€‚æ­¤å¤–ï¼ŒäºŒè¿›åˆ¶ç¼–ç çš„ç‰¹å¾ä¹Ÿé€‚åˆçº¿æ€§æ¨¡å‹ã€‚ç„¶è€Œï¼Œä»å¦ä¸€æ–¹é¢æ¥çœ‹ï¼Œæ´¾ç”Ÿçš„äºŒè¿›åˆ¶ç‰¹å¾ç¼ºä¹äººç±»å¯è§£é‡Šæ€§ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è§£é‡Šæ¨¡å‹æ‰€åšçš„å†³ç­–ï¼Œè¿™ç§ç¼–ç æ–¹æ³•å¯èƒ½ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚

åœ¨è¿™ä¸ªèœè°±ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ç±»åˆ«ç¼–ç å™¨æ‰§è¡ŒäºŒè¿›åˆ¶ç¼–ç ã€‚

## å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹...

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¯¼å…¥å¿…è¦çš„ Python åº“å¹¶å‡†å¤‡å¥½æ•°æ®é›†ï¼š

1.  å¯¼å…¥æ‰€éœ€çš„ Python åº“ã€å‡½æ•°å’Œç±»ï¼š

    ```py
    import pandas as pd
    from sklearn.model_selection import train_test_split
    from category_encoders.binary import BinaryEncoder
    ```

1.  è®©æˆ‘ä»¬åŠ è½½ Credit Approval æ•°æ®é›†å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

    ```py
    data = pd.read_csv("credit_approval_uci.csv")
    X_train, X_test, y_train, y_test = train_test_split(
    Â Â Â Â data.drop(labels=["target"], axis=1),
    Â Â Â Â data["target"],
    Â Â Â Â test_size=0.3,
    Â Â Â Â random_state=0,
    )
    ```

1.  è®©æˆ‘ä»¬æ£€æŸ¥`A7`ä¸­çš„å”¯ä¸€ç±»åˆ«ï¼š

    ```py
    X_train["A7"].unique()
    ```

    åœ¨ä¸‹é¢çš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°`A7`æœ‰ 10 ä¸ªä¸åŒçš„ç±»åˆ«ï¼š

    ```py
    A7:

    ```

    encoder = BinaryEncoder(cols=["A7"],

    drop_invariant=True)

    ```py

    ```

æ³¨æ„

`BinaryEncoder()`ä»¥åŠç±»åˆ«ç¼–ç å™¨åŒ…ä¸­çš„å…¶ä»–ç¼–ç å™¨å…è®¸æˆ‘ä»¬é€‰æ‹©è¦ç¼–ç çš„å˜é‡ã€‚æˆ‘ä»¬åªéœ€å°†åˆ—ååˆ—è¡¨ä¼ é€’ç»™`cols`å‚æ•°ã€‚

1.  è®©æˆ‘ä»¬å°†è½¬æ¢å™¨æ‹Ÿåˆåˆ°è®­ç»ƒé›†ï¼Œä»¥ä¾¿å®ƒè®¡ç®—æ‰€éœ€çš„äºŒè¿›åˆ¶å˜é‡æ•°é‡å¹¶åˆ›å»ºå˜é‡åˆ°äºŒè¿›åˆ¶ä»£ç è¡¨ç¤ºï¼š

    ```py
    encoder.fit(X_train)
    ```

1.  æœ€åï¼Œè®©æˆ‘ä»¬åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­å¯¹`A7`è¿›è¡Œç¼–ç ï¼š

    ```py
    X_train_enc = encoder.transform(X_train)
    X_test_enc = encoder.transform(X_test)
    ```

    æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ`print(X_train_enc.head())`æ¥æ˜¾ç¤ºè½¬æ¢åè®­ç»ƒé›†çš„å‰å‡ è¡Œï¼Œå®ƒè¿”å›ä»¥ä¸‹è¾“å‡ºï¼š

![å›¾ 2.11 â€“ äºŒè¿›åˆ¶ç¼–ç åçš„å˜é‡ DataFrame](img/B22396_02_11.jpg)

å›¾ 2.11 â€“ äºŒè¿›åˆ¶ç¼–ç åçš„å˜é‡ DataFrame

äºŒè¿›åˆ¶ç¼–ç ä¸º`A7`è¿”å›äº†å››ä¸ªäºŒè¿›åˆ¶å˜é‡ï¼Œåˆ†åˆ«æ˜¯`A7_0`ã€`A7_1`ã€`A7_2`å’Œ`A7_3`ï¼Œè€Œä¸æ˜¯ç‹¬çƒ­ç¼–ç ä¼šè¿”å›çš„ä¹ä¸ªã€‚

## å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„...

åœ¨è¿™ä¸ªé£Ÿè°±ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Category Encoders åŒ…è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç ã€‚æˆ‘ä»¬ç”¨`BinaryEncoder()`æ¥ç¼–ç `A7`å˜é‡ã€‚é€šè¿‡`fit()`æ–¹æ³•ï¼Œ`BinaryEncoder()`åˆ›å»ºäº†ä¸€ä¸ªä»ç±»åˆ«åˆ°ä¸€ç»„äºŒè¿›åˆ¶åˆ—çš„æ˜ å°„ï¼Œè€Œé€šè¿‡`transform()`æ–¹æ³•ï¼Œç¼–ç å™¨åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­å¯¹`A7`å˜é‡è¿›è¡Œäº†ç¼–ç ã€‚

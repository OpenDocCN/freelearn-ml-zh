# 第二章：数据科学流程

在过去十年中，组织见证了数据的快速增长。从这些数据中获取洞察力对于这些组织的增长和维持至关重要。然而，负责从数据中提取价值的团队由于各种原因而失败。在本章中，我们将探讨组织如何避免数据科学的潜在陷阱。

关于数据质量和治理的更深入讨论我们在这里不会涉及。经验丰富的数据科学家认识到数据面临的挑战，并在他们的流程中考虑到这些挑战。一般来说，这些挑战包括以下内容：

+   数据质量和一致性差

+   由个人业务团队驱动的数据孤岛

+   难以使用的 ...

# TDSP 阶段

**团队数据科学流程**（**TDSP**）是由微软创建的一种方法，用于指导组织内数据科学项目的整个生命周期。它并不是一个完整的解决方案，而是一个框架，通过这个框架，团队可以为他们的流程增加结构，并实现他们分析的全部商业价值。

除了 TDSP 之外，组织一直在采用的其他流行方法是称为 **CRISP-DM**（代表 **跨行业数据挖掘标准流程**）。这种方法自 1990 年代中期以来一直存在。在 2000 年代，有几次尝试更新它，但都被放弃了。CRISP-DM 的主要重点是数据挖掘，但其原则也可以扩展到数据科学。CRISP-DM 中列出的主要步骤如下：业务理解、数据理解、数据准备、建模、评估和部署。对于从业者来说，这些步骤可能看起来是多余的，但对于刚开始从数据中获取价值的组织来说，这是一个构建流程的绝佳框架。事实上，许多厂商在市场上发布的数据科学工具本身就具有推动用户通过这些步骤的功能。

当 CRISP-DM 方法应用于数据科学时，存在几个差距。最明显的一个是需要将业务成果与流程的每一步联系起来。数据质量、数据来源、偏差、算法质量和可扩展性等方面的挑战需要超越这里列出的内容来解决。

TDSP 不是 CRISP-DM 的替代品，但可以被视为一个额外的框架，可以增强以包括现有的数据工作流程。TDSP 更侧重于任务，但与 CRISP-DM 在高层次上共享一些相同的概念。

TDSP 的一个核心原则是，如以下图表所示的数据科学生命周期结果是智能应用，这些应用可以为业务带来价值。新的数据科学项目可以利用 TDSP 的部分内容，预期随着项目的成熟，它们将完成学业并利用流程的其他步骤。从这个意义上说，TDSP 是旨在迭代的和敏捷的。根据项目的性质和成熟度，某些流程可以被消除。

![图片](img/cfc4ea6a-af97-4bc1-be15-49e0882fd254.png)

TDSP 中定义了五个广泛阶段，如下所示：

+   业务理解

+   数据获取和理解

+   建模

+   部署

+   客户接受

# 业务理解

在 TDSP 的这个阶段，有两个任务推动其目标：

+   定义目标

+   识别数据源

让我们分解和分析这些任务，看看它们如何帮助推导出业务理解。

定义目标任务包括以下因素：

+   **模型目标**：项目的成功是由业务目标驱动的，而业务目标反过来又是由分析期间跟踪的一些变量驱动的。这些变量被称为 **模型目标**，与模型目标相关的可能有多个指标，这些指标决定了它们的成功。常用的模型目标示例包括收入预测或交易欺诈的概率。

+   **相关问题**：您可以定义 ...

# 可交付成果

如下的可交付成果：

+   **章程文件**：本文件用于跟踪项目的各个方面。这些包括业务背景、范围、人员、计划、架构、指标和沟通。此文件的模板在此提供：[`github.com/Azure/Azure-TDSP-ProjectTemplate/blob/master/Docs/Project/Charter.md`](https://github.com/Azure/Azure-TDSP-ProjectTemplate/blob/master/Docs/Project/Charter.md)。

+   **数据源**：本文件描述了所有数据源以及将它们纳入项目所需的任何转换。任何处理过的数据或工程化特征也予以记录。此可交付成果的模板在此展示：[`github.com/Azure/Azure-TDSP-ProjectTemplate/blob/master/Docs/Data_Report/Data%20Defintion.md`](https://github.com/Azure/Azure-TDSP-ProjectTemplate/blob/master/Docs/Data_Report/Data%20Defintion.md)。

+   **数据字典**：本文件为每个数据源提供了详细描述。这可能包括表架构和数据类型示例。此可交付成果的模板在此提供：[`github.com/Azure/Azure-TDSP-ProjectTemplate/tree/master/Docs/Data_Dictionaries`](https://github.com/Azure/Azure-TDSP-ProjectTemplate/tree/master/Docs/Data_Dictionaries)。

# 数据获取和理解

在 TDSP 的这个阶段，有三个任务推动其目标：

+   **数据摄取**：为了使数据的探索和建模更加容易，尽可能将源数据移动到单个分析系统中是理想的。在 Azure 中，通过各种工具可以轻松地在不同服务之间移动数据，同时考虑到这些类型的用例。

+   **探索数据**：理解数据的本质对于成功的分析项目至关重要。在大多数组织中，数据存在许多缺陷：异常值、缺失值、不良值等。可视化数据和分析数据的特征是成功数据科学项目的先决条件。这也是 ...

# 可交付成果

可交付成果如下：

+   **数据质量报告**：IDEAR 工具可以帮助创建总结源数据和目标变量的报告。

+   **解决方案架构**：在这个项目阶段，可以绘制一个数据流图或描述，以显示管道的评分和（如果需要）重新训练。

+   **检查点决策**：根据对数据的初步评估，你可以决定是否将项目推进到这个阶段之后。如果在这个阶段预期的商业价值尚不明确，可以决定获取更多数据或停止项目。在某些情况下，利益相关者可能会考虑重新定位。

# 建模

在这个阶段，有三个主要任务来实现其目标：

+   **特征工程**：在许多用例中，原始数据本身可能不是目标变量的良好指标。根据使用的算法，可能需要将某些数据特征转换为新的特征，以便其有效使用。

这个任务被认为是有效数据科学项目艺术的一部分。它需要从数据探索任务中获得的有效见解和领域专业知识的有效结合。还有选择构建模型时正确特征数量的困境。使用过多的变量可能会给模型添加不必要的噪声，而选择过少可能无法准确预测目标变量（s）。...

# 可交付成果

可交付成果如下：

+   **特征集**：用于构建模型的特征被记录为数据定义报告的一部分。如果任何特征是从原始数据生成的，则生成特征的代码将记录在这个报告中。

+   **模型报告**：标准报告将显示每个模型在各种指标上的表现。这些指标可能包括准确性指标，以及模型的速度和效率。

+   **检查点**：评估模型的表现，并确定它是否足够好以部署到生产系统。

# 部署

在这个阶段，主要任务是将模型和数据管道部署到类似生产的环境，以便应用程序使用。

一旦您有一个或多个提供所需业务指标的模型，您可以为不同的应用程序将它们投入运营。模型通常通过某些 API 接口暴露，允许应用程序与之交互并为各种输入生成预测。这些 API 通常可以处理批量或实时，或这两种方式的混合，用于其输入数据。该网络服务本身通常是弹性、健壮和可扩展的。这是通过跟踪网络服务的各种指标来实现的，以跟踪服务的负载并帮助 ...

# 交付成果

以下为交付成果：

+   显示预测系统健康和关键指标的控制台

+   一个显示部署细节的建模报告

+   一个捕获解决方案各个组件的解决方案架构文档

# 客户接受

本阶段涉及的主要任务如下：

+   **系统验证**：确认部署的模型和数据管道符合利益相关者的需求

+   **项目移交**：将系统移交给将要运行生产系统的团队

客户应验证端到端解决方案是否符合在初始业务理解阶段定义的业务需求。系统是否能够及时做出满足为应用程序选择的指标的预测？

所有文档均已审查并最终确定，并移交给负责运行操作的团队。该团队将负责对迄今为止完成的工作进行维护，并贯穿其生命周期。

# 交付成果

在此阶段结束时，将交付项目退出报告。它包含操作和维护系统至其设计潜力所需的所有项目细节。退出报告的模板在此提供：[`github.com/Azure/Azure-TDSP-ProjectTemplate/blob/master/Docs/Project/Exit%20Report.md`](https://github.com/Azure/Azure-TDSP-ProjectTemplate/blob/master/Docs/Project/Exit%20Report.md)。

# TDSP 工具

微软发布了一套工具，使组织更容易遵循 TDSP 流程。其中之一是针对 CRAN-R、Microsoft R 和 Python 发布的 IDEAR 实用工具。另一个工具是**自动化建模和报告**（**AMAR**）实用工具。在本节中，我们将探讨如何在 TDSP 流程中利用这些工具。

# R 的 IDEAR 工具

要安装此工具，请导航到[`github.com/Azure/Azure-TDSP-Utilities/blob/master/DataScienceUtilities/DataReport-Utils/R/Run-IDEAR.R`](https://github.com/Azure/Azure-TDSP-Utilities/blob/master/DataScienceUtilities/DataReport-Utils/R/Run-IDEAR.R)，以检索此工具所需的代码。下载 GitHub 仓库以方便导航到本练习所需的不同文件。

在您的计算机上打开 R Studio，导航到前面的文件，并打开它。在代码标签的右上角，点击源来执行包，如下所示：

![图片](img/683781cb-40c2-4c95-a371-57cd37c25c63.png)

然后，以下提示将显示：

![图片](img/6b75f3c9-9cdc-4fd2-ac92-aca93dd2faf0.png)

一个示例 `.yaml` 文件可以从以下位置加载。按照以下步骤选择 `para-adult.yaml`：

![图片](img/fbfbbfb7-3925-40b1-8900-175631dbe2dd.png)

这将打开 YAML 文件中描述的数据示例的数据质量报告，如下截图所示：

![图片](img/9a2d7744-d074-4baf-b883-7a5ae352fef9.png)

你可以使用左侧的菜单来浏览输出的不同部分。第一部分是任务摘要，它通过列出文件位置、不同类型变量的名称以及数据科学任务类型（例如，分类）来总结读取的文件：

![图片](img/f8377493-c0fa-4cd5-b74c-6804265c2232.png)

点击数据摘要进入下一部分。在以下截图的 2.1 下，你可以通过选择所需的顶部 n 行来查看数据样本：

![图片](img/1d573a0f-259c-41c2-95bd-e0848150721e.png)

这是一种检查加载的数据中差异的视觉检查的好方法。以下截图的第 2.2 节显示了通过计数行数和列数来总结数据：

![图片](img/385d97ee-8ae4-47ae-aa59-6f5e54d7bf06.png)

在第 2.3 节中，报告显示列的名称和类型，指示它们是数值型还是分类型：

![图片](img/9254bdff-b9ac-4f68-8b9e-ca22205d7465.png)

报告的第 2.4 节检查数据的质量。该报告将每个变量的缺失数据百分比进行映射。热图格式有助于检测任何缺失数据模式：

![图片](img/5c3f7855-a778-42d4-97c2-bb4c4801b7b3.png)

第 2.5 节通过显示数值数据的百分位数和分类数据的频率计数来总结数据的基本统计信息：

![图片](img/66b52eb6-c4e1-419b-a710-ba73b019913b.png)

现在我们进入第三部分，我们将更深入地研究每个单独的变量以进一步调查它们。在第 3.1 节中，你可以看到每个变量的更详细统计数据：

![图片](img/f1eecfd2-e544-4242-a3fc-2d53685af2ad.png)

在第 3.2 节中，你可以可视化目标变量：

![图片](img/fe0b7459-cd7b-4f9a-938e-09c63214f727.png)

在第 3.3 节中，你可以可视化任何数值变量，并查看数据的分位数和分布：

![图片](img/ca646959-ec01-47b0-b3cf-d6d54518cc7b.png)

在第 3.4 节中，你可以可视化分类变量，显示它们内部不同类别的频率：

![图片](img/2afe3a8a-4cf2-4aba-9708-497394e4fa09.png)

在第四部分中，报告帮助你分析不同变量之间的关系。这对于理解哪些变量对于构建模型很重要，哪些可以删除很重要。在第 4.1 节中，你可以根据参考变量对变量的影响进行排名：

![图片](img/2ad08159-539b-47a5-a99c-67efc00ba918.png)

在第 4.2 节中，您可以检查两个分类变量之间的相关性。例如，在下面的图中，我们看到男性的收入比女性多：

![](img/d134c73b-99c2-4113-8bbc-c7e76c94c36d.png)

类似地，在第 4.3 节中，您可以看到两个数值变量之间的交互：

![](img/2783e63c-09ce-408b-9fd5-e2a4f04ceb1a.png)

在第 4.4 节中，您可以使用不同的相关方法来计算数值变量之间的相关性：

![](img/952259a7-a935-4a40-8a68-24664e5ce2ce.png)

在第 4.5 节中，您可以使用箱线图可视化数值和分类变量之间的交互：

![](img/37e71ad1-3d5c-4842-b5e1-63b476ee4691.png)

接下来的三个部分将重点介绍多元统计分析。第 4.6 节利用**主成分分析**（**PCA**）来查看数据在降维变量空间中的分布：

![](img/adb63ce8-389f-4810-9b35-4f2337a775dc.png)

在第 4.7 节中，您可以使用 t-SNE 方法将数值变量投影到 2D 空间。在第 4.8 节中，您可以将数值和分类变量同时投影到 PCA 并可视化：

![](img/d915a61d-ce98-43f2-a66d-3fba6f17fc82.png)

在第五部分中，如果您点击“生成报告”按钮，它将创建包含前几节所有摘要的总结报告。

# R 中的自动建模和报告（AMAR）

AMR 工具是一个可定制的、半自动化的实用工具，内置在 R 中，用于训练和评估单个或多个机器学习模型。它具有参数扫描等特性，以找到符合所需指标的模型。

一旦生成报告，它将包含以下信息：

+   模型描述

+   模型评估和比较

+   特征排名

通常，报告中描述的信息可以帮助提高以下方面：

+   特征变量的质量

+   机器学习任务的难度级别

+   后续特征工程和建模的指导

AMAR 工具可在以下 GitHub 位置找到：[`github.com/Azure/Azure-TDSP-Utilities/tree/master/DataScienceUtilities/Modeling ...`](https://github.com/Azure/Azure-TDSP-Utilities/tree/master/DataScienceUtilities/Modeling)

# 摘要

总之，我们在本章中向您介绍了 TDSP，并详细介绍了涉及到的每个不同步骤。这个过程旨在增强现有流程而不是取代它们。我们还探讨了微软提供的各种 TDSP 实用工具，这些工具使得构建数据科学生命周期中的某些结构变得更加容易。在接下来的几章中，我们将探讨 Azure 中可用于构建满足您业务需求的人工智能解决方案的每个选项。

# 为您的应用程序选择最佳算法

软件工程过程有三个不同的阶段：构思、实施和部署。本书主要关注过程的实施阶段，这是软件工程师开发项目核心功能（即机器学习算法）和特性的阶段。在最后一章，我们讨论了与部署阶段相关的问题。我们的学习几乎已经完成。

在这一章的最后，我们将转向构思阶段，以完善我们对整个机器学习开发过程的理解。具体来说，我们将讨论如何为给定问题选择最佳算法。机器学习生态系统正在演变，令人畏惧，充满了连经验丰富的软件开发者都感到陌生的术语。我经常看到机器学习的初学者在过程的开始阶段陷入困境，不知道在广阔而陌生的领域中从何入手。他们还没有意识到，一旦你克服了选择算法和解读术语的初步障碍，剩下的旅程就会容易得多。

本章的目标是提供一个指南针，一个简单的指南，你可以用它来在领域中找到自己的道路。选择正确的算法并不总是容易，但有时也是可能的。本章的前几节将教你四个简单的决策点——本质上就是四个多项选择题——你可以使用这些决策点来专注于最适合你项目的算法。在经过这个过程后，大多数情况下，你将只剩下一个或两个算法可供选择。

然后，我们将继续通过讨论与规划机器学习系统相关的其他主题来继续我们的教育。我们将讨论你选择了错误算法的明显迹象，这样你就可以尽早识别错误。你还将学习如何区分使用错误的算法与一个糟糕的实现之间的区别。

我还会给你展示如何结合两种不同的机器学习模型（ML models）的例子，这样你就可以从适合各自任务的独立模型中组合出更大的系统。如果设计得当，这种方法可以产生非常好的结果。

我之所以称这一章为指南针而不是地图，是有原因的。它不是一本涵盖计算机科学家所知的所有机器学习算法的全面指南。就像指南针一样，你也必须运用你的智慧和技能来找到自己的道路。使用本章来找到你自己的项目的起点，然后继续进行你自己的研究。虽然本书中讨论的 20 多种算法和技术为你提供了对整个领域的广泛视角，但它们只是生态系统的一小部分。

当我们来到这本书的结尾时，我想给你一条最后的建议。要成为某个领域的专家，需要持续致力于**练习和玩耍**。如果你想成为一名世界级的钢琴家，你必须花无数个小时用节拍器进行细致的死记硬背练习，练习指法练习，学习有挑战性的**练习曲**。

但你还得去“玩”，这是探索发生和创造力发展的地方。经过三十分钟的练习后，钢琴家可能会花三十分钟即兴创作爵士乐，尝试旋律和对位，学习音乐的“je ne sais quoi”或音阶和模式中的情感本质。这种玩耍的探索，创造力中的实验，以死记硬背所不具备的方式发展了音乐的直觉感。死记硬背——细致的工作和学习——反过来又发展了机械感和技能，这是玩耍所不能做到的。练习和玩耍在良性循环中相互提升。有技能的人能够比没有技能的人探索得更远、更深入，而更深层次的东西所带来的兴奋感正是推动技能发展的练习的动力。时间和耐心、练习和玩耍、动机和纪律是你从新手到专家所需要的一切。

机器学习与爵士钢琴相反，但成为专家的道路是相同的。机器学习的死记硬背——相当于练习音阶——是构建和实现算法。我特别推荐从头开始编写算法作为练习；这是真正理解内部发生情况的唯一方法。不要只写一次算法来证明自己可以做到。要在不同的环境中、不同的编程语言、不同的架构、不同的数据集上多次编写算法，并且一直这样做，直到你能够几乎从头到尾地写出整个算法。我相当确信我可以在任何三种编程语言中闭着眼睛编写一个朴素贝叶斯分类器，就像你在编写了数十个之后也能做到的那样。

机器学习的乐趣在于实验。本章是关于为你的应用程序选择最佳算法，但这并不是法律规则。如果你从不实验，你就永远不会对算法或数据发展出丰富的直觉。尝试其他方法、参数或算法的变体，并从实验中学习。你会惊讶于实验成功有多频繁，但更重要的是，实验应该成为你的练习和教育的一部分。

让我们从讨论四个主要决策点开始，这些决策点可以帮助你在算法上磨练技能：

+   学习方式

+   当前任务

+   数据的格式或形式

+   可用资源

我们还将讨论当一切出错时应该做什么，最后我们将讨论将多个模型组合在一起。

# 学习方式

选择机器学习算法时，首先要考虑学习过程的模式：监督学习、无监督学习或强化学习。这些模式之间几乎没有重叠；一般来说，一个算法要么是监督学习，要么是无监督学习，但不会两者兼具。这大约将你的选择缩小了一半，幸运的是，判断哪种学习模式适用于你的问题非常容易。

监督学习和无监督学习之间的区别在于你是否需要标记的训练示例来教授算法。如果你只有数据点，而没有与之关联的标签或类别，那么你只能执行无监督学习。因此，你必须选择一个无监督学习算法，例如 k-means 聚类、回归、**主成分分析**（**PCA**）或奇异值分解。

监督学习和无监督学习之间的另一个明显区别是是否存在判断语义准确性的方法。如果你的应用中判断准确性的概念没有意义（因为你没有标记的训练数据或参考数据），那么你面临的是一个无监督学习问题。

然而，在某些情况下，你可能没有训练数据，但问题最好通过监督学习来解决。认识到拥有训练数据和需要训练数据之间的区别很重要。当你需要训练数据时，你很可能面对的是一个监督学习问题。如果你需要训练数据但没有，你必须想出某种方法来获取训练数据。

为问题生成训练数据的最简单方法是自行生成。在图像分类任务中，你可以手动标记几百张图片来生成你的训练数据。这很耗时，但对于小规模训练集来说可行。

一种更可扩展的方法是使用像 Amazon Mechanical Turk 这样的服务，通过这个服务，你可以支付给人工工作者每张图片 0.05-0.10 美元的标签费用。Mechanical Turk 方法在机器学习研究人员和数据科学家中变得非常流行，因为它是一种快速且可扩展的方式，以合理的成本生成大量训练数据。在 Mechanical Turk 上为 5,000 张图片生成标签可能需要 250 美元，并且可能需要一两天的时间。如果你认为 250 美元很贵，考虑一下如果你亲自标记这 5,000 张图片需要花费多少时间。

有更多巧妙的方法来生成训练数据，例如将责任转移到你的应用程序的用户身上。多年前，当 Facebook 首次引入在照片中标记人的功能时，他们要求照片的上传者围绕每个主题的脸部画一个框并标记他们。经过数十亿张照片的上传，Facebook 拥有一个巨大的训练集，不仅能够识别面部形状，还能识别照片中的特定人物。如今，在标记照片时不再需要围绕人们的脸部画框，通常 Facebook 能够自动识别照片中的每个主题。我们，作为用户，为他们提供了这个庞大的训练集。

监督学习通过在预标注数据上训练算法来显现，其目标是算法从标签中学习，并且能够将这种知识扩展并应用于新的、未见过的例子。如果你发现自己处于一个有很多数据点，但其中只有一些，而不是全部都有正确答案或标签的情况，你可能需要一个监督学习算法。如果你有百万封电子邮件，其中 5,000 封被手动过滤为垃圾邮件或非垃圾邮件，并且如果目标是扩展这种知识到其他 995,000 条消息，那么你正在寻找一个监督学习算法。

如果你需要判断算法的语义准确性，你也必须使用监督学习算法。无监督算法没有真相来源；这些算法将聚类、平滑或外推数据，但没有权威的参考，无法判断算法的准确性。另一方面，监督学习算法可以通过预标注的训练数据作为真相来源来判断其语义准确性。

虽然我们在这本书中没有涵盖强化学习算法，但它们的特点是算法必须通过影响其环境来尝试优化行为。算法的输出与行动结果之间存在一定的距离，因为环境本身就是一个因素。强化学习的一个例子是教 AI 通过扫描屏幕并使用鼠标和键盘控制来玩电子游戏。玩《超级马里奥兄弟》的 AI 只能通过在控制板上按上、下、左、右、A 和 B 的组合来与环境互动。算法的输出在环境中采取行动，环境将奖励或惩罚这些行动。因此，算法试图最大化其奖励，例如通过收集金币、通过关卡、击败敌人以及不落入无底洞。

强化学习算法是应用机器人学、控制系统设计、基于模拟的优化、硬件在环模拟以及许多其他领域的重大主题，这些领域将物理世界与算法世界相结合。当您研究的系统——环境——是一个复杂的黑盒，无法直接建模时，强化学习最为有效。例如，强化学习被用于优化将在任意环境中使用的系统的控制策略，例如必须自主导航未知地形的机器人。

最后，有一些任务只需要优化一个模型已知或可以直接观察的系统。这些只是与机器学习问题有间接关系，更合适地称为**优化问题**。如果您必须根据当前交通状况从 A 点选择最佳驾驶路线到 B 点，例如，您可以使用遗传算法。如果您必须优化配置不同模型的一小部分参数，您可能尝试网格搜索。如果您必须确定复杂系统的边界条件，蒙特卡洛方法可能有所帮助。如果您必须找到连续系统的全局最优解，那么随机梯度下降可能适合您的目的。

优化算法通常用于解决机器学习算法的问题。确实，用于训练人工神经网络的反向传播算法使用梯度下降作为其优化器。k-means 或其他无监督算法的参数可以通过网格搜索自动调整，以最小化方差。我们在这本书中没有深入讨论优化算法，但您应该了解它们及其用例。

当为您的应用程序选择算法时，从最简单的问题开始：我需要监督学习还是无监督学习？确定您是否拥有或可以生成训练数据；如果您不能，您被迫使用无监督算法。问问自己是否需要判断算法输出的准确性（监督学习），或者您是否只是在探索数据（无监督）。

在您确定了学习模式，这将大致将您的选择减半之后，您可以通过考虑具体任务或研究目标来进一步专注于您需要的算法。

# 当前任务

最有效地划分机器学习算法的世界的方法是考虑当前任务，或者算法的预期结果和目的。如果您能确定您问题的目标——也就是说，您是否需要根据输入预测连续值，对数据进行分类，对文本进行分类，降低维度等——您就能将您的选择减少到只有几个算法。

例如，在你需要预测一个连续输出值的情况下——例如预测未来某天的服务器负载——你可能会需要一个回归算法。可供选择的回归算法只有少数几个，本指南中的其他决策点将有助于进一步减少这些选项。

在你需要检查数据并识别彼此相似的数据点的情况下，聚类算法将是最合适的。你选择的特定聚类算法将取决于其他决策点，例如数据的格式或形式、关系的线性或非线性，以及你拥有的资源（时间、处理能力、内存等）。

如果你的算法目的是将数据点分类为一打可能的标签之一，你必须从几个分类算法中选择一个。再次强调，从你可用的分类算法家族中选择正确的算法将取决于数据的形式、你对准确度的要求以及施加在你身上的任何资源限制。

初学者在这个阶段面临的一个常见问题是项目实际目标与单个算法能力之间的不明确性。有时，问题的业务目标是抽象的，只部分定义。在这些情况下，业务目标通常只能通过使用几个单独的算法来实现。机器学习的学生可能难以确定为了实现目标必须组合的具体技术步骤。

一个说明性的例子是编写一个分析图像并返回图像内容自然语言描述的应用程序的业务目标。例如，当上传一张公园小径的照片时，目标可能是返回文本“一条小径上有一个公园长椅和垃圾桶，背景有树木”。人们很容易专注于项目的单一业务目标，并假设一个业务目标对应一个算法。

然而，这个例子至少需要两个或三个机器学习算法。首先，一个**卷积神经网络**（**CNN**）必须能够识别图像中的对象。然后，另一个算法必须能够确定对象之间的空间关系。最后，一个自然语言处理或机器学习算法必须能够从前两个算法的输出中提取信息，并从该信息中构建自然语言表示。

能够理解业务目标并将其转化为具体的技术步骤需要时间和经验来培养。你必须能够解析业务目标，并反向工作以将其分解为单个子任务。一旦确定了子任务，确定哪个算法最适合每个子任务就成为了这个决策过程中的一个简单练习。我们很快就会讨论算法组合的话题，但到目前为止，重要的启示是，某些业务目标可能需要多个机器学习算法。

在某些情况下，手头的任务将你的选择缩小到只有一个算法。例如，图像中的目标检测最好通过卷积神经网络（CNN）来实现。当然，有许多不同的专门子类型的 CNN 可以执行目标检测（如 RCNN、Fast RCNN、Mask RCNN 等），但在这个案例中，我们能够将竞争范围缩小到仅 CNN。

在其他情况下，手头的任务可以通过几个或许多算法来完成，在这种情况下，你必须使用额外的决策点来选择最适合你应用的最佳算法。例如，情感分析可以通过许多算法来实现。朴素贝叶斯分类器、最大熵模型、随机森林和人工神经网络（尤其是循环神经网络）都可以解决情感分析问题。

你可能还需要组合多个算法以实现情感分析器最佳精度。因此，使用哪种方法的决策不仅取决于手头的任务，还取决于你组合中使用的其他算法的数据的形式和格式。并非每个算法都适用于与其他所有算法组合使用，因此形式和格式决策点实际上是递归的，你需要将其应用于你为追求业务目标而确定的每个子任务。

# 格式、形式、输入和输出

我所描述的数据的格式和形式包含几个概念。最表面地，数据的*格式*与输入和输出的具体数据类型（例如，整数、连续数字/浮点数、文本和离散类别）有关。数据的*形式*封装了数据结构之间的关系以及问题或解决方案空间的整体形状。这些因素可以帮助你在手头的任务提供了多个算法选择的情况下选择合适的算法。

当处理文本（格式）时，例如，你必须考虑文本在问题空间和当前任务中的处理方式；我称之为数据的形式。在过滤垃圾邮件时，通常没有必要映射单个单词之间的关系。在分析文本以进行情感分析时，确实可能需要映射一些单词之间的关系（例如，处理否定或其他语言修饰语），这将需要额外的维度。在解析文本以构建知识图谱时，你需要细致地映射不仅单个单词之间的关系，还有它们的概念意义之间的关系，这需要更高的维度。

在这些例子中，数据格式是相同的——所有三个例子都处理文本，但形式不同。问题空间的结构不同。垃圾邮件过滤器有一个更简单的问题空间，具有较低维度和线性可分的关系；每个单词都是独立处理的。情感分析器具有不同的形式，需要问题空间中的一些额外维度来编码某些单词之间的关系，但并不一定需要所有单词之间所有关系。知识图谱问题需要一个高度维度的空间，将单词之间复杂的语义和空间关系映射进去。

在这些文本分析案例中，你常常可以问自己一系列简单的问题，这些问题有助于你缩小到正确的算法：每个单词是否可以独立处理？我们需要考虑单词是否被其他单词修改（例如*不像*与*不像*，或*好*与*非常好*）吗？我们需要维护相隔很远的单词之间的关系（例如，一篇在第一段介绍主题但在许多段落之后继续提及该主题的维基百科文章）？

你跟踪的每一项关系都会给问题空间增加一个维度，因此你必须选择一个能够在问题空间维度上有效工作的算法。在处理像知识图谱问题这样的高维问题时使用低维度的算法，例如朴素贝叶斯，是不会得到好结果的；这就像一个人一生都在三维空间中生活，却试图可视化物理中的十维超弦理论空间。

相反，一个高度维度的算法，如**长短期记忆**（**LSTM**）RNN，可以解决低维问题，如垃圾邮件过滤，但它有一个代价：训练高度维度算法所需的时间和资源。它们与问题的难度不相称。贝叶斯分类器可以在几十秒内训练数百万份文档，但 LSTM RNN 可能需要数小时来训练同样的任务，并且评估数据点的速度慢一个数量级。即使如此，也不能保证 LSTM RNN 在准确性方面优于贝叶斯分类器。

你还必须考虑形式和维度性，当处理数值数据时。与统计分析相比，时间序列分析需要额外的维度来捕捉数据的顺序性，除了数据的值。这类似于词袋模型文本算法（如朴素贝叶斯）与保留文本顺序的算法（如 LSTM RNN）之间的区别。

最后，数据的结构格式可能也是一个需要考虑的因素，尽管格式通常可以成功转换为更易于处理的格式。在第十章，《实践中的自然语言处理》中，我们讨论了 Word2vec 词嵌入算法，该算法将文本转换为数值向量，以便它们可以作为神经网络（需要数值输入）的输入。格式转换实际上使我们的决策过程更加困难，因为它允许我们从更广泛的算法中选择。使用 Word2vec 意味着我们可以将文本作为输入提供给通常不接受文本的算法，因此给我们提供了更多的选择。

另一种常见的格式转换是对连续数值的量化或分桶。例如，一个从 0 到 10 的连续数值可以量化为三个桶：小、中、大。这种转换允许我们在只处理离散值或类别的算法中使用我们的连续值数据。

你还应该考虑从算法中获取的输出形式和格式。在分类任务中，分类器的名义输出将是一个离散标签，用于描述输入。但并非所有分类器都是同等创建的。决策树分类器将输出一个标签作为其输出，而贝叶斯分类器将输出所有可能标签的概率作为其输出。在这两种情况下，名义输出是一个可能的标签，但贝叶斯分类器还会返回其猜测的置信度以及所有可能猜测的概率分布。在某些任务中，你从算法中需要的可能只是一个单一标签；在其他情况下，概率分布可能是有用的，甚至可能是必需的。

算法输出的形式与模型的数学机制密切相关。这意味着即使没有对算法本身的深入了解，你也可以通过观察其输出的形式来评估模型的数学属性。如果一个分类器将其输出作为概率的一部分，那么它很可能是一个概率分类器，可以用于你怀疑非确定性方法比确定性方法更有效的任务。

同样，如果一个算法返回语义排序的输出（与无序输出相对），那么这表明该算法本身模型化和记住了一些形式的排序。即使你的应用程序不需要直接排序的输出，你也可能选择这个算法，因为你认识到你的数据形式包含了嵌入在数据序数中的信息。另一方面，如果你知道你的数据序数中不包含任何相关信息，那么返回排序输出（因此将序数作为维度进行建模）的算法可能就是过度设计。

如果此时你还有几个算法可供选择，那么最后一步确定最佳算法将是要考虑你所能利用的资源，并将它们与你对准确性和速度的要求进行权衡。

# 可用资源

通常情况下，从一系列算法选项中很难找出一个明显的胜者。例如，在情感分析问题中，有几种可能的方法，而且通常并不清楚应该选择哪一种。你可以选择带有嵌入否定词的朴素贝叶斯分类器、使用二元组的朴素贝叶斯分类器、LSTM RNN、最大熵模型以及几种其他技术。

如果格式和形式决策点在这里没有帮助你——例如，如果你没有对概率分类器的需求——你可以根据你可用的资源和性能目标来做出决定。贝叶斯分类器轻量级，训练时间快，评估时间非常快，内存占用小，存储和 CPU 需求相对较小。

另一方面，LSTM RNN 是一个复杂的模型，训练时间较长，评估时间适中，对 CPU/GPU 的要求显著，尤其是在训练期间，并且比贝叶斯分类器有更高的内存和存储需求。

如果没有其他因素为你提供如何选择算法的明确指导，你可以根据你或你的应用程序用户可用的资源（CPU、GPU、内存、存储或时间）来做出决定。在这种情况下，几乎总是存在权衡；更复杂的模型通常比简单的模型更准确。当然，这并不总是正确的，因为朴素贝叶斯分类器在垃圾邮件过滤方面始终优于其他方法；但这是因为垃圾邮件检测问题空间的形态和维度。

在某些情况下，你的应用的限制因素将是训练或评估时间。如果一个应用需要 1 毫秒或更少的评估，可能不适合使用人工神经网络（ANN），而一个可以容忍 50 毫秒评估的应用则更加灵活。

在其他情况下，限制因素或可用的资源是算法所需的精度。如果你认为错误的预测是一种资源消耗，你可能能够确定算法所需精度的下限。机器学习的世界并不太不同于高性能体育的世界，因为在金牌和铜牌之间的差距可能只是几秒钟的时间。

这同样适用于机器学习算法：对于特定问题，最先进的算法可能具有 94%的准确率，而更常见的算法可能只有 90%的准确率。如果错误预测的成本足够高，那么这四个百分点的差异可能就是你在选择算法以及投入多少时间和精力解决问题时的决定性因素。另一方面，如果错误预测的成本很低，那么更常见的算法可能基于资源、时间和努力来实现，可能是最佳选择。

如果你仔细考虑这四个决策点——学习模式、当前任务、数据的格式和形式，以及你拥有的资源——你通常会发现最佳算法的选择非常明显。这并不总是如此；有时你将不得不基于你最熟悉的算法和流程做出判断。

有时候，在选择了一个算法之后，你会发现你的结果无法接受。立即放弃你的算法并选择一个新的算法可能会很有诱惑力，但在这里要小心，因为通常很难区分算法选择不当和算法配置不当。因此，你必须准备好在一切出错时调试你的系统。

# 当出错时

在机器学习中，可能的不理想结果范围很广。这些可能包括模型根本不起作用，或者模型虽然有效但在这个过程中使用了不必要的资源。负面结果可能由许多因素引起，例如选择不适当的算法、特征工程不良、不当的训练技术、预处理不足或结果解释错误。

在最佳情况下——即负面结果的最好情况——问题将在你实施早期阶段自行显现。你可能会在训练和验证阶段发现你的 ANN 从未达到超过 50%的准确率。在某些情况下，ANN 在经过几个训练周期后可能会迅速稳定在 25%的准确率，并且不再提高。

在这种方式下训练过程中显现出来的问题是最容易调试的。一般来说，这些都是你选择了错误算法的迹象。在第五章《分类算法》中，我向你介绍了随机森林分类器，我们发现它在我们示例问题中的准确率低得无法接受。使用随机森林的决定仅仅是错误的决策吗？或者这是一个合理的决策，但由于参数选择不当而受阻？在这种情况下，答案是**都不是**。我对使用随机森林以及参数选择都很有信心，所以我用不同的编程语言将相同的数据和参数通过一个随机森林库运行，得到了更符合我预期的结果。这指向了第三个可能的原因：我选择的随机森林算法库的具体实现可能存在问题。

有时候问题更难调试，尤其是当你没有从第一原理编写算法时。在第五章《分类算法》中，我向你介绍了随机森林分类器，我们发现它在我们示例问题中的准确率低得无法接受。使用随机森林的决定仅仅是错误的决策吗？或者这是一个合理的决策，但由于参数选择不当而受阻？在这种情况下，答案是**都不是**。我对使用随机森林以及参数选择都很有信心，所以我用不同的编程语言将相同的数据和参数通过一个随机森林库运行，得到了更符合我预期的结果。这指向了第三个可能的原因：我选择的随机森林算法库的具体实现可能存在问题。

不幸的是，如果没有经验带来的信心，很容易假设随机森林只是那个问题的算法选择不当。这就是为什么我鼓励实践和玩耍，理论和实验。如果没有对随机森林背后概念的彻底理解，我可能被误导，认为算法本身是问题所在，而且如果没有实验的倾向，我可能永远无法确认算法和参数确实合适。

当事情出错时，我的建议是回归到第一原理。回到你的工程设计过程的最初阶段，依次考虑每一步。算法的选择是否合适？数据的形式和格式是否合适？算法能否足够地解决问题空间的维度？我是否适当地训练了算法？问自己这些问题，直到你确定你最没有信心的一项，然后开始探索和实验。

从我的角度来看，机器学习的最坏情况是一个“无声失败”的算法。这些情况是指一个算法在训练和验证中成功，被部署到实际应用中，但使用现实世界数据产生了较差的结果。该算法未能推广其知识，只是足够好地记住了训练数据以通过验证。这种无声的失败发生是因为算法在验证期间显示出良好的准确性，让你产生了虚假的安全感。然后你将算法部署到生产环境中，信任其结果，但几个月或一年后发现算法表现极差，做出了影响真实人或过程的错误决策，现在需要纠正。

因此，你必须始终监控你的算法在实际工作负载下的性能。你应该定期抽查算法的工作，以确保其在现实世界中的准确性与你训练期间观察到的相当。如果一个算法在训练期间达到 85%的准确性，而在对 20 个数据点的生产抽查中产生了 15 个正确答案（75%），那么这个算法可能正在按预期工作。然而，如果你发现只有 50%的现实世界评估是正确的，你应该扩大对算法的审计，并可能基于从更真实的数据点中抽取的更新后的训练集重新训练它。

这些无声的失败通常是由过度训练或训练不当引起的。即使你遵循了训练的最佳实践，并将预标记的数据集分成单独的训练和验证集，仍然可能过度训练和泛化不足。在某些情况下，源数据本身可能存在问题。例如，如果你的整个训练和验证集都是根据大学生的调查结果生成的，那么模型可能无法准确评估老年人的调查结果。在这种情况下，即使你在独立数据集上验证了你的模型，训练和验证数据本身也不是现实世界条件的适当随机抽样。在实际使用中，你将看到比验证结果更低的准确性，因为用于训练模型的数据源已被选择偏差所损害。

类似的情况也可能发生在其他类型的分类任务中。一个在电影评论上训练的情感分析算法可能无法推广到餐厅评论；这两个数据源之间的术语和语气——数据的形式——可能不同。

如果你的模型表现不佳，你真正不知道下一步该做什么，转向实验和探索。使用相同的训练集测试不同的算法并比较结果。尝试生成一个新的训练集，要么更广泛，要么更窄。尝试不同的标记化技术，不同的预处理技术，甚至可能尝试同一算法的不同实现。在网上搜索其他研究人员如何处理类似问题，最重要的是，永远不要放弃。挫折是学习过程的一部分。

# 模型组合

有时，为了实现单一的商业目标，你需要结合多个算法和模型，并将它们协同使用来解决单个问题。实现这一目标有两种主要方法：串联组合模型和并行组合模型。

在模型串联组合中，第一个模型的输出成为第二个模型的输入。一个简单的例子是在分类器 ANN 之前使用的 Word2vec 词嵌入算法。Word2vec 算法本身就是一个 ANN，其输出被用作另一个 ANN 的输入。在这种情况下，Word2vec 和分类器是分别训练但一起评估的，串联进行。

你也可以将 CNN 视为模型的串联组合；每一层（卷积、最大池化和全连接）的操作都有不同的目的，本质上是一个独立的模型，其输出为下一层提供输入。然而，在这种情况下，整个网络既被评估也被作为一个单一单元进行训练。

并行运行的模型通常被称为**集成**，随机森林是一个简单的例子。在随机森林中，许多单独的决策树并行运行，并将它们的输出组合。更普遍地说，并行运行的模型不需要是相同类型的算法。例如，在分析情感时，你可以并行运行一个二元朴素贝叶斯分类器和一个 LSTM RNN，并使用它们输出的加权平均来产生比单独运行更准确的结果。

在某些情况下，你可以组合模型以更好地处理异构数据。让我们想象一个商业目标，即根据用户的书面内容和从其个人资料中衍生出的许多其他特征，将用户分类到十个心理测量类别之一。也许目标是分析 Twitter 上的用户，以确定将他们放置在哪个营销垂直领域：*时尚达人*，*周末战士*，*运动狂热者*等等。你可以使用的数据包括他们推文历史的文本内容，他们的朋友列表和内容互动，以及一些衍生指标，如平均发帖频率，平均 Flesch-Kincaid 阅读难度，关注者与朋友的比例等等。

这个问题是一个分类任务，但它是一个需要通过多个技术步骤才能实现的企业目标。因为输入数据不均匀，我们必须将问题分解成几个部分，并分别解决。然后我们将这些部分组合起来，以形成一个准确且高效的机器学习系统。

首先，我们可以获取用户的推文文本内容，并通过朴素贝叶斯分类器来决定内容最适合的 10 个类别之一。该分类器将返回一个概率分布，例如 *5% fashionista，60% sports junkie，和 25% weekend warrior*。这个分类器单独可能不足以解决问题；周末战士和运动狂热者倾向于写类似的话题，贝叶斯分类器无法区分两者，因为它们有很多重叠。

幸运的是，我们可以将文本分类与其他信号结合起来，例如用户在推特上发布图片的频率，他们在周末和周中发推文的频率等等。像随机森林这样的算法，可以处理异构输入数据，在这里会很有用。

我们可以采取的方法是使用贝叶斯分类器生成的 10 个概率，将它们与从用户个人资料数据直接导出的另外 10 个特征结合起来，然后将这 20 个特征的组合列表输入到随机森林分类器中。随机森林将学会何时信任贝叶斯分类器的输出，何时更依赖其他信号。例如，当贝叶斯分类器难以区分运动狂热者和周末战士时，随机森林可能会根据额外的上下文在这两者之间做出区分。

此外，随机森林将能够学习何时信任贝叶斯概率，何时不信任。随机森林可能会学会，当贝叶斯分类器以 90% 的概率判断 *fashionista* 时，它通常是正确的。它可能会以类似的方式学会，当贝叶斯分类器在高概率下判断 *weekend warrior* 时是不可靠的，并且对于相当一部分时间，周末战士可能会被误认为是运动狂热者。

从直观的角度来看，随机森林是适用于此用例的好算法。因为它基于决策树，能够根据特定属性的值创建决策点。随机森林可能会生成如下逻辑结构：

+   如果 *bayes_fashionista_probability* 大于 85%，则返回 *fashionista*

+   如果 *bayes_weekend_warrior_probability* 大于 99%，则返回 *weekend warrior*

+   如果 *bayes_weekend_warrior_probability* 小于 99%，则继续：

    +   如果 *twitter_weekend_post_frequency* 大于 70%，则返回 *weekend warrior*

    +   否则，如果 *bayes_sports_junkie_probability* 大于 60%，则返回 *sports junkie*

在这个简化的例子中，随机森林已经学会了信任贝叶斯分类器对**时尚达人**类别的判断。然而，只有当概率非常高时，森林才会信任贝叶斯分类器对周末战士的判断。如果贝叶斯分类器对周末战士的分类不太确定，那么随机森林可以转向用户周末发推文的频率作为一个单独的信号，用于区分周末战士和运动狂热者。

当精心设计时，像这样的组合模型可以是非常强大的工具，能够处理许多情况。这项技术允许你将业务目标分解成多个技术目标，为每种类型的数据或分类选择最佳算法，并将结果组合成一个连贯且自信的响应。

# 摘要

本书的大部分内容都集中在实现用于解决特定问题的机器学习算法上。然而，算法的实现只是软件开发设计过程的一部分。工程师还必须擅长选择适合她问题的正确算法或系统，并且能够处理出现的问题。

在本章中，你学习了一个简单的四点决策过程，可以帮助你为特定用例选择最佳算法或算法。通过排除法，你可以通过根据每个决策点排除算法来逐步减少你的选择。最明显的是，当你面对监督学习问题时，你不应该使用无监督算法。你可以通过考虑手头的具体任务或业务目标，考虑输入和输出数据的格式和形式或问题空间，以及对你可用的资源进行成本效益分析来进一步排除选项。

我们还讨论了在现实世界中使用机器学习模型时可能出现的某些问题，例如由于训练实践不当而导致的隐蔽的静默故障问题，或者由于算法选择不当或网络拓扑不合适而导致的更明显的故障。

最后，我们讨论了将模型以串联或并行方式组合的想法，以便利用算法的特定优势，尤其是在面对异构数据时。我展示了一个随机森林分类器的例子，它使用直接信号和另一个贝叶斯分类器的输出作为其输入；这种方法有助于消除贝叶斯分类器产生的混淆信号，因为贝叶斯分类器本身可能无法准确解决重叠类别。

我还有很多东西想教给你。这本书仅仅是一个概述，是对机器学习核心概念和算法的快速介绍。我所展示的每一个算法都是一个研究领域，其深度远远超过 10 或 20 页所能教授的内容。

我不期望这本书能解决你所有的机器学习问题，你也不应该这样期望。然而，我希望这本书为你提供了一个坚实的理解基础，你可以在此基础上构建未来的教育。在像机器学习这样的领域，既神秘又充满术语，最大的挑战往往是知道从哪里开始。希望这些页面中的信息已经给你足够的理解和清晰度，能够独自导航更广泛的机器学习世界。

当你阅读完这些最后的页面时，我不期望你在这个机器学习语言的熟练度上已经达到流利，但希望你现在至少能够进行对话。虽然你可能还不能独自设计复杂的 ANN 拓扑结构，但你至少应该对核心概念感到舒适，能够与其他研究人员交流，并找到自己继续深入学习资源的途径。你也可以解决许多以前可能无法解决的问题，如果那样的话，我就达到了我的目标。

我有一个最后的请求：如果你继续你的机器学习教育，尤其是在 JavaScript 生态系统内，请回馈社区。正如你所看到的，今天有很多高质量的 JavaScript 机器学习库和工具，但生态系统中也存在很大的空白。一些算法和技术在 JavaScript 世界中尚不存在，我鼓励你寻找机会，尽可能填补这些空白，无论是通过为开源软件做出贡献，还是为他人编写教育材料。

感谢你抽出时间阅读这本关于 JavaScript 机器学习的谦逊导论——我希望它对你有所帮助。

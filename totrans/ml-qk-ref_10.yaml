- en: Causal Inference
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this final chapter, we will learn about the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Granger causality in time series (econometric approach to causality)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Graphical models causality
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Granger causality
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In time series, we typically use univariate data. That is, we use a single series
    to predict its future values. Let's say that we are studying Google's stock price
    data, and we are asked to forecast the future values of stock prices. In this
    case, we will need historic data of Google's stock prices. Based on that, we will
    make predictions.
  prefs: []
  type: TYPE_NORMAL
- en: However, at times, we need multiple time series to make a forecast. But why
    is it that we need multiple time series? Any guesses?
  prefs: []
  type: TYPE_NORMAL
- en: 'The following graph shows Google''s stock price data:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/dcfb259b-6986-47e2-958a-4f8424f6c745.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The answer is that we need to understand and explore the relationship between
    multiple time series as this can improve our forecast. For example, we have got
    correlated time series of **GDP Deflator: Services** and **WPI: All Commodities**,
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5ac9b772-c549-4d12-9691-19065159518f.png)'
  prefs: []
  type: TYPE_IMG
- en: 'It is quite evident that these two seem to carry a relationship. When we have
    to forecast **GDP Deflator: Services**, we can use **WPI: All Commodities** time
    series data as input. This is called **Granger causality**.'
  prefs: []
  type: TYPE_NORMAL
- en: To put it more aptly, Granger causality is one of the ways to investigate causality between
    two variables in a time series. This method is a probabilistic account of causality.
  prefs: []
  type: TYPE_NORMAL
- en: Even though we are talking about causality here, it isn't exactly the same.
    Typically, causality is associated with a situation where variable *1* is the
    cause of variable 2 or vice versa. However, with Granger causality, we do not
    test a true cause and effect relationship. The fundamental reason to know is whether **a
    particular variable comes before another** in the time series.
  prefs: []
  type: TYPE_NORMAL
- en: You aren't testing a true cause and effect relationship. What you want to know
    is whether **a particular variable comes before another** in the time series.
    That is to say, if we find Granger causality in the data, then there isn't any
    causal link in the true sense of the word.
  prefs: []
  type: TYPE_NORMAL
- en: When econometricians say cause, what they mean is Granger-cause, although a
    more appropriate word might be precedence. Granger causality was proposed by a
    Nobel laureate in Economics, Prof Clive Granger, in 2003.
  prefs: []
  type: TYPE_NORMAL
- en: Let's look at one more example. Here, we have GDP per capita for OECD nations.
    We can see that the number of OECD countries have a similar growth and pattern
    in GDP. We can assume that these countries are responsible for each other's GDP
    growth due to dependencies.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following is a graph that shows GDP per capita for OECD countries:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/64a5d92a-f8d2-4e59-af45-6993f3a8fb3d.png)'
  prefs: []
  type: TYPE_IMG
- en: We can utilize the series of one country to forecast for another one. More often
    than not, this kind of relationship is prevalent more in financial time series.
    The stock market of India, NSE/BSE, and so on may have an impact on NYSE. Therefore,
    NYSE indices can be used to make a forecast for NSE indices.
  prefs: []
  type: TYPE_NORMAL
- en: Let's infuse a bit of mathematics into this. Let's say there are two time series,
    *X(t)* and *Y(t)*. If the past values of *X(t)* are helping to predict the future
    values of *Y(t)*, it is said that *X(t)* Granger causes *Y(t)*.
  prefs: []
  type: TYPE_NORMAL
- en: 'So, *Y(t)* is a function of the lag of *Y(t)* and also of the lag of *X(t)*.
    It can be expressed as as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Y(t) = f(Yt-p, Xt-p)*'
  prefs: []
  type: TYPE_NORMAL
- en: 'However, this only holds true in the following situations:'
  prefs: []
  type: TYPE_NORMAL
- en: Cause takes place prior to effect. What this means is that *Y(t) = f(Xt-1)*,
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Cause has got significant information about the future values of its effect,
    for example:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Y(t) = a1 Yt-1 + b1 Xt-1 + error*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Xt-1* is adding an extra effect on *Y(t)*. The magnitude of effect is decided
    by *b1*.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s say we have two equations:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Yt= a0+ a1* Yt-1*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Yt= a0 + a1*Yt-1 + a2*Xt-1*'
  prefs: []
  type: TYPE_NORMAL
- en: 'The null hypothesis here is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '*H0: a2=0*: What this means is that there is no effect of other series, where
    *Xt-1* on *Yt*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The alternate hypothesis here is as follows::'
  prefs: []
  type: TYPE_NORMAL
- en: '*H1: a2≠ 0*: What this means is that there is a significant effect of other
    series, where *Xt-1* on *Yt*'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We run a t-test to determine whether there is a significant effect of other
    series of *Xt-1* on *Yt*.
  prefs: []
  type: TYPE_NORMAL
- en: If the null hypothesis is rejected, we can say that it is a case of Granger
    causality.
  prefs: []
  type: TYPE_NORMAL
- en: F-test
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The basic steps for running this test are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Formulate the null hypothesis and its alternative.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Choose the lags. These can depend on the amount of data you have. One way to choose
    lags i and j is to run a model order test. It would be easier to pick up multiple
    values and run the Granger test to see if the results are the similar for different
    lag levels.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Also identify the f-value. The two equations can be used to find out whether
    *βj = 0* for all lags *j*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Limitations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The different limitations of this approach are as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: Granger causality is not a true causality
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If *X(t)* affects *Y(t)* through a third variable, *Z(t)*, then it is difficult
    to find Granger causality
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use case
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Here, we have a multivariate time series dataset called `AirQualityUCI`. We
    have to test whether NOx has a Granger causality of NO2.
  prefs: []
  type: TYPE_NORMAL
- en: Since we don't have a library in Python for multivariate Granger causality,
    we will do this in R by using the `lmtest` package.
  prefs: []
  type: TYPE_NORMAL
- en: 'Load the `lmtest` library. In case the library isn''t there, you will need
    to install it, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Load the data. Then, make use of the `grangertest` function to find out whether
    there is any significant relationship between NOx and NO2:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'The output for this is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6f859784-a489-4873-a8db-ba5a66b51d3a.png)'
  prefs: []
  type: TYPE_IMG
- en: So, the f-test has become significant, which means that the coefficients of
    lagged NO2 have a significant impact on NOx.
  prefs: []
  type: TYPE_NORMAL
- en: Graphical causal models
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This model was covered in detail in [Chapter 8](64be9aad-a25e-4ea4-abbb-bc8ff4cbbe1a.xhtml)*, Probabilistic
    Graphical Models*. We will also look into it briefly here, too.
  prefs: []
  type: TYPE_NORMAL
- en: 'Bayesian networks are directed acyclic graphs (DAGs) where the nodes represent
    variables of interest (for example, the temperature of a device, the gender of
    a patient, a feature of an object, the occurrence of an event, and so on). Causal
    influences among the variables are represented using links. The strength of an
    influence can be potrayed by conditional probabilities that are linked to each
    cluster of the parent-child nodes in the network. In the following diagram we
    can see the causal models, that have a node and an edge:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/620df37b-3981-4203-b6d5-c1e7bc97b31f.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The node represents the variables and the edges stand for conditional relationship
    between the variables. What we are looking for is full joint probability distribution. Here,
    the conditional dependency is being spoken. Rain causes the ground to be wet.
    However, winning the lottery has nothing to do with other variables. It''s got
    conditional independence, as shown in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/54801f88-0c6d-4815-80ed-84770c9f370f.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Here, the probability for conditional independence is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '*P(Lottery,Rain, Wet Ground)= P(Lottery) P(Rain) P(Wet Ground | Rain)*'
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, we can say that a Bayesian network describes a probability distribution
    among all variables by putting conditional probability as edges.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s look at an example in Python:'
  prefs: []
  type: TYPE_NORMAL
- en: 'First, we need to load the library, `CausalGraphicalModel`, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Let''s set up the model for a condition that if somebody is doing a `Job` and
    if it''s powered by `Smartwork` and `Hardwork`, he/she reaps rewards and eventually,
    ends up having a promotion:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'The following is the output of the preceding code:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2fd1eb17-9b5b-43c8-96a9-f18293786a63.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Let''s obtain the distribution:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Then we will get the following as a output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/8e90a859-0356-4cb2-be40-7c1bf3a651fc.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Let''s extract all of the conditional independence relationships:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '![](img/b8d32eb6-6c71-4219-a81c-416d3e40dee5.png)'
  prefs: []
  type: TYPE_IMG
- en: Here, we are able to assess the conditional independence among the variables.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s mix this in with `Reward`:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '![](img/941edca5-e300-421f-b430-8a7b2656af3b.png)'
  prefs: []
  type: TYPE_IMG
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we studied Granger causality, which is where we use a single
    time series to predict its future values, along with the different models of graphical
    causality models. The graphical causality models cover two examples that will
    give us a basic idea about the graphical causal models.
  prefs: []
  type: TYPE_NORMAL

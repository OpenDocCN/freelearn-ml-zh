- en: Visualizing Economic Problems in the European Union
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now, we will move on and look at a second problem, which is the detection of
    macroeconomic imbalances in different countries, particularly within the European
    Union, which, in my opinion, failed and increased the damage of the financial
    crisis.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will take a look at what our problem is and create clusters
    for the countries that have been identified as suffering from macroeconomic imbalances.
    We will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: A general overview of economic problems in the European Union
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Clustering countries based on macroeconomic imbalances
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A general overview of economic problems in countries
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The worldwide financial crisis of 2008 started as a bank-level crisis that closed
    the flow of money and increased financial instability. During the first few months,
    the impact was felt primarily by financial institutions and intermediaries. After
    that, however, it then reached macroeconomic dimensions, threatening the stability
    of entire countries.
  prefs: []
  type: TYPE_NORMAL
- en: The European Union, the **International Monetary Fund** (**IMF**), and the **European
    Central Bank** (**ECB**) took urgent measures to avoid the insolvency of some
    countries. As a result, Greece received €110 billion in 2010 to pay its public
    debt. This loan was the start of further expenditure. Ireland received €87 billion
    euros in November 2017 with the same aim. Problems were then identified in Portugal
    in 2011 and an additional loan was received by Greece. Spain and Cyprus also received
    money in 2012 and 2013, respectively.
  prefs: []
  type: TYPE_NORMAL
- en: When a financial crisis occurs or a new problem arises, people often say that
    it was bound to happen or that everyone had predicted it. Prior to the financial
    crisis, macroeconomic imbalances had been increasing steadily, but were probably
    hidden because of the worldwide economic growth that took place from 2002\. Credit
    rating agencies also weren't able to detect these macroeconomic imbalances.
  prefs: []
  type: TYPE_NORMAL
- en: Understanding credit ratings
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Credit ratings can be described as a category or grade that represents a government's
    ability and willingness to repay its debts fully and on time. An implicit probability
    of defaulting can be associated with a credit rating.
  prefs: []
  type: TYPE_NORMAL
- en: Credit ratings are very important for countries because they determine the cost
    of funding in capital markets and they enable access to derivative and loan contracts.
  prefs: []
  type: TYPE_NORMAL
- en: 'In recent years, the number of ratings and their importance has increased considerably.
    In a more globalized and complex world, investors need standard metrics to compare
    the credit quality between issuers, even if they belong to very different countries.
    Although they are not an exact science, as the **Credit Rating Agency** (**CRA**)
    Standard & Poor''s argues, credit rating establishes a ranking of countries according
    to their solvency. They are considered an important reference for investors and
    international organizations. In the following table, the different grades and
    their meanings are described:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/71c29554-2072-46b6-85d9-cb170671eb94.png)'
  prefs: []
  type: TYPE_IMG
- en: The role of credit rating agencies
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The reliance on credit ratings has granted a high level of influence and political
    power to CRAs. Although there is a large number of CRAs, only three of them collect
    more than 90% of the market share. These are **Moody's**, **Standard & Poor's**,
    and **Fitch**.
  prefs: []
  type: TYPE_NORMAL
- en: Credit rating agencies have been criticized for their performance in important
    crises such as the Asian and Russian financial crisis of the late 1990s and the
    recent global financial crisis that started in 2008\. During these events, CRAs
    exacerbated imbalances, taking too much time to react or to predict default events,
    and then they reacted excessively, with severe downgrades.
  prefs: []
  type: TYPE_NORMAL
- en: For example, in the most recent financial crisis, European economies were downgraded
    by an average of three notches. Greece and Italy were among the most severely
    affected countries.
  prefs: []
  type: TYPE_NORMAL
- en: The credit rating process
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Many factors are considered in the rating process, including political, growth,
    external debt, the financial sector, the structure of the public and private sector,
    social development, and trade. Standard & Poor's, for example, scores five key
    factors of a country's degree of creditworthiness on a six-point scale. The different
    weights and the way in which the factors are combined, however, is unknown. Moreover,
    the importance of these factors changes over time. Qualitative judgement usually
    plays a very important role in the rating assignation process.
  prefs: []
  type: TYPE_NORMAL
- en: Concerns about the quality of ratings have acted as an incentive to researchers
    around the world over the last two decades. It is important to understand the
    determinants of ratings to reduce the dependency on CRAs and to make the assignation
    of credit ratings more objective.
  prefs: []
  type: TYPE_NORMAL
- en: The replication of a credit rating is mainly based on different econometric
    models that try to find a set of macroeconomic variables to better explain external
    ratings. Nevertheless, credit rating studies have widely ignored qualitative and
    more subjective information. This additional information could complement the
    current quantitative macroeconomic information and improve the performance of
    credit rating models.
  prefs: []
  type: TYPE_NORMAL
- en: Clustering countries based on macroeconomic imbalances
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we will develop an unsupervised model to visually detect macroeconomic
    problems in countries and also understand a little more about the main drivers
    of credit ratings. We will start by creating a cluster of the countries with macroeconomic
    problems. In the next chapter, we will move on to predicting the credit ratings
    based on these clusters.
  prefs: []
  type: TYPE_NORMAL
- en: Throughout this chapter, I've tried to make an effort to reiterate the code
    from the previous chapters.
  prefs: []
  type: TYPE_NORMAL
- en: Let's get started!
  prefs: []
  type: TYPE_NORMAL
- en: Data collection
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As in the previous model, we need to collect the largest amount of data possible.
    First, we need the macroeconomic indicators of countries to analyze the macroeconomic
    imbalances and predict the sovereign ratings.
  prefs: []
  type: TYPE_NORMAL
- en: Downloading and viewing the data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We will use the `wbstats` package, which provides structured access to all
    of the information that''s available from the World Bank API, including all annual,
    quarterly, and monthly data. In this package, the `wb_cachelist` function provides
    a snapshot of the available countries, indicators, and other relevant information,
    shown as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: More than 16,000 variables for more than 300 countries are available. The default
    language is English.
  prefs: []
  type: TYPE_NORMAL
- en: 'To search for different indicators, let''s use the `wbsearch` function. For
    example, we can search for all the indicators containing **Gross Domestic Product**
    (**GDP**), as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'You can also download the data and specify the indicator, the starting date,
    and the end date, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'We have now downloaded the stock market returns for all countries. The first
    values belong to Argentina. It is also possible to obtain information just for
    specific countries. Let''s obtain the total population of the United States and
    Spain between 2015 to 2017, shown as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Variables are always obtained in rows, but this is not a very common way to
    present the information. With the `return_wide = TRUE` option, if more than one
    variable is obtained, they will be presented in columns. Let''s take a look at
    the following example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'If the latest available date of an indicator is unknown, the `mrv` parameter
    stands for the most recent value and takes an integer that corresponds to the
    number of most desired recent values. Let''s display the 10 most recent values
    of the stock market return for the United States, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: The default date format is not useful for sorting or plotting. The `POSIXct`
    parameter adds the `date_ct` and `granularity` columns, making these tasks much
    easier.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s take a look the evolution of military expenses in the United States
    over time as an example, shown as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'You will get the following plot as an output:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/8e81beff-d896-4c27-85ca-0ff9d4da2f12.png)'
  prefs: []
  type: TYPE_IMG
- en: We have seen that it is very easy to download information. To develop our model,
    however, we will not use all of the data. Now, let's define how many variables
    and countries and how much historical data we need.
  prefs: []
  type: TYPE_NORMAL
- en: Streamlining data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Let''s see the list of countries in the World Bank database using the following
    code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Although the list is large, some countries belong to unions of several countries,
    such as the Arab World or the European Union. We will need to make a selection
    of countries.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s look at a list of the available indicators, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'The list of indicators is even bigger (there are more than 16,000 entries),
    but we will select the most important ones, as shown in the following snippet.
    These are obtained using the rating methodology guidelines that are provided by
    the main credit rating agencies:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'The acquired list of indicators is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Let''s download the historical data for these indicators from 2000 to 2018\.
    This will take about five minutes using the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Let''s get the structure of our data with the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'The complete output is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'As you can see, most of the variables display missing values in the first few
    rows. Let''s acquire a list of the number of times a country appears in the preceding
    list:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'The total number of countries this data includes can be found as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'We can explore our missing values as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'The output that we will acquire will be as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/422f125c-c85d-457f-8d60-f1439629fac8.png)'
  prefs: []
  type: TYPE_IMG
- en: The graph that's obtained is not very pretty because there's a large number
    of variables. Although information is easily obtained, many of the variables display
    a high number of missing values. This is because the information is not updated
    and data for the most recent years is unavailable.
  prefs: []
  type: TYPE_NORMAL
- en: 'To view the results, you should manually select the relevant variables for
    different official sources and merge them in an Excel file, which will be used
    for our model development. First, remove all of the objects in the workspace,
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: 'Now, load the new data sample into R, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'The file contains the following information:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'As the `str` function shows, the data sample contains `224` observations and
    the following `14` variables:'
  prefs: []
  type: TYPE_NORMAL
- en: '`Year`: The reference date of the year-end'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`CountryISO`: The international standard country code'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`CountryName`: The name of the country'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`CARA`: The current account balance of a country'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`DCPI`: The consumer prices growth rate'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`DGDP`: The GDP growth'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`ILMA`: The international reserves'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`PSBR`: The budget balance as a percentage of the GDP'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`PUDP`: The public debt as a percentage of the GDP'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`TDRA`: Total imports less total exports of goods and services as a percentage
    of the GDP'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`YPCA`: The GDP per head'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`MEANWGI`: The mean of the six worldwide governance indicators'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`YearsFromLastDefault`: The amount of time elapsed since the last time the
    country defaulted'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`RatingMayT1`: The credit rating of the country one year after the macroeconomic
    information'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can obtain additional data from the following sources:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://www.worldbank.org/](https://www.worldbank.org/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.oecd.org/](https://www.oecd.org/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://ec.europa.eu/eurostat](https://ec.europa.eu/eurostat)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://info.worldbank.org/governance/wgi](https://info.worldbank.org/governance/wgi)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.cia.gov/library/publications/the-world-factbook](https://www.cia.gov/library/publications/the-world-factbook)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.imf.org/](https://www.imf.org/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://www.oecd.org/](https://www.oecd.org/)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All of the considered variables have been widely used in previous studies or
    by CRAs. We are using various World Bank governance indicators in our list of
    variables, including the `MEANWGI` variable. This variable is calculated as the
    simple average of six different indicators that are provided by the World Bank.
    These measure topics such as political stability, level of violence, and control
    of corruption. The World Bank calculates these aggregate indicators based on surveys
    by different non-governmental organizations, international organizations, or private
    sector firms. The higher the value of each indicator, the highest the quality
    or the score of a country in the indicator.
  prefs: []
  type: TYPE_NORMAL
- en: The dataset that will be used in the remaining part of this chapter collects
    the credit rating at the end of May for each country over several years. The macroeconomic
    information represents the economic situation of each country at the end of the
    previous year. Countries publish this information in the first or second quarter
    of the year, so the most updated macroeconomic information taken every May belongs
    to the previous year.
  prefs: []
  type: TYPE_NORMAL
- en: Studying the data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Our first objective will be to detect clusters of countries according to their
    macroeconomic situation and to predict ratings for those countries. We will then
    assess whether the qualitative information that's included in the country reports
    issued by the European Commission are useful to predict country ratings. These
    reports are usually issued in the first months of each year, so they should be
    influential in the credit ratings around May as well.
  prefs: []
  type: TYPE_NORMAL
- en: 'Again, we must start by analyzing the following dataset:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'There are no missing values in this dataset. Let''s explore our data, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'The macroeconomic information for the different countries is available from
    the years 2010 to 2017, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: 'The following is the list of the 28 countries in the dataset:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: Acquiring the target variable
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The target variable will be the credit rating of each country. Let''s see the
    different values of the target variables with the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: 'As we can see, the scale only takes six different grades, and they are numerical,
    not alphabetical. The following code creates a table to display the assigned numbers
    for each rating category:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'The following mapping table will be used to reduce the number of all possible
    credit rating levels into only six categories:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: Thus, a value of `6` is associated with the highest-rated grade (`AAA`), while
    `1` corresponds to the worst-rated grade. This mapping is done to reduce the number
    of different labels and to obtain a less granular target variable.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s take a look at the distribution of our target variable graphically with
    the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: 'You will see a plot that looks as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c327657f-e36f-416e-8581-b9e93ec68272.png)'
  prefs: []
  type: TYPE_IMG
- en: Acquiring the credit quality
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In May 2018, the credit ratings for each European country can be found as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: 'The credit quality table for every country is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: Denmark, Germany, Luxembourg, Netherlands, and Sweden display the highest credit
    quality. On the other hand, Greece is the country with the lowest solvency in
    the European Union, according to Standard & Poor's.
  prefs: []
  type: TYPE_NORMAL
- en: Displaying the credit ratings on a map
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Using the `rworldmap` package, we can create a map and display the credit ratings
    by country. Let''s focus on the last available credit rating (from May 2018),
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: 'A quick summary can be displayed as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: 'Assign the axes limits, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: 'A very pretty output such as the following will be displayed:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/112a3abb-7623-4214-bf75-470d273bc11d.png)'
  prefs: []
  type: TYPE_IMG
- en: Carrying out a descriptive analysis of data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We should now carry out a descriptive analysis, just like we did in the previous
    chapters, using the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: 'The acquired output is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'Plot these variables, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: 'The following graphs are shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/8676bacb-f5b1-41d1-b78e-63ed8b070fc1.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Once we have studied our dataset, we can start to work with our data. Save
    a backup of your workspace. If something goes wrong, it is always possible to
    load the backups and continue with the code, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: Detecting macroeconomic imbalances
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we will use a technique called **self-organizing maps** (**SOM**)
    to perform a classification of the European countries depending on their solvency
    by using macroeconomic variables.
  prefs: []
  type: TYPE_NORMAL
- en: The self-organizing maps technique
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The identification of similarities and differences between countries is crucial
    for detecting imbalances and taking corrective measures to avoid the propagation
    of financial crises. SOM is an unsupervised neural network that is very useful
    for **exploratory data analysis** (**EDA**). The unsupervised nature of SOM is
    due to the fact that the network is able to learn patterns in the data without
    using a target variable. Therefore, the different neurons contained in the network
    self-organize themselves using the input data. The following diagram is the most
    common representation of a SOM:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c1b4f1e2-6761-4fdc-8199-d381632baf25.png)'
  prefs: []
  type: TYPE_IMG
- en: 'As we can see in the preceding diagram, there are two main layers of neurons:
    an input layer and an output layer. The input layer is the input data we send
    to the network, which is the data to be analyzed. The output layer is a bidimensional
    map in which all our data will be placed. The data in the input layer is connected
    to all the neurons of the output layer through synaptic weights. In this way,
    the information that''s provided by each neuron of the input layer is transmitted
    to all of the neurons of the output layer.'
  prefs: []
  type: TYPE_NORMAL
- en: The network tries to find the neuron of the output layer with the most similar
    synaptic weights to the values of the input layer neurons. The most similar weights
    have the lowest distances between the input data and the prototype of weights
    that were created in the output layer. These weights are initially created randomly.
    Once the distances are calculated, the winning neuron is identified. This neuron
    is the one with the least difference or the shortest Euclidean distance between
    its weights and the set of inputs.
  prefs: []
  type: TYPE_NORMAL
- en: Once the winning neuron is identified, its weights will be adjusted with a learning
    rule to proxy these weights to the input pattern that has made the neuron win.
    In this way, the neuron with the weights that are the closest to the input pattern
    is updated to become even closer. As a result, each neuron in the output layer
    specializes in this input pattern.
  prefs: []
  type: TYPE_NORMAL
- en: The winning neuron is not the unique neuron that updates its weights. A neighborhood
    function is also used to update not only the weights of the winning neuron but
    the neighbor neurons to localize similar patterns. This neighborhood radio decreases
    with the number of iterations of the model that are carried out to achieve a better
    specialization of each neuron.
  prefs: []
  type: TYPE_NORMAL
- en: Training the SOM
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It's now time to train the SOM using R. For that, we will use the `kohonen`
    package. The name of the package comes from Teuvo Kohonen, who first introduced
    this algorithm.
  prefs: []
  type: TYPE_NORMAL
- en: 'As SOM is mainly based on Euclidean distances, it is recommended to standardize
    your variables. We will use the `caret` package for this, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: 'This will create a data frame with the transformed variables. Then, we will
    add the country name and ratings to this transformed data frame, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: 'Now, it is time to train the map. The first layer of the network will have
    ten input patterns or ten macroeconomic variables. Our output layer will be fixed
    as a bidimensional map that is 6×5 in size. This size was obtained after several
    tests, shown as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: After 800 iterations, the training process finishes. Different plots can be
    obtained from the trained map.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s display the mean distance to the closest codebook vector during the
    training, using the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: 'This will plot the following graph:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/558810d6-92ac-4ffd-933c-393037e47f91.png)'
  prefs: []
  type: TYPE_IMG
- en: We can see that the error of the training process, measured as the mean distance
    to the closest unit, is reduced over the course of the iterations. If the number
    of iterations is high enough, the algorithm converges.
  prefs: []
  type: TYPE_NORMAL
- en: 'Moreover, it is possible to visualize the map and count the number of countries
    that are classified in each neuron:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: 'A graphical representation of the node counts can be seen in the following
    plot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c32b62bb-8572-4465-9121-44778712c5fd.png)'
  prefs: []
  type: TYPE_IMG
- en: In the graph, 30 cells (6x5 in size) are marked in a different color, depending
    on the number of countries classified. Grey cells indicate that no countries have
    been classified in this cell. The larger the number of cells, the lower the number
    of countries in each neuron, obtaining a more granular map.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following plot, the average distance of the countries mapped to each
    unit in the map is shown. The smaller the distances, the better the countries
    are represented by the codebook vectors, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: 'The node quality plot is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b2b328ca-f45f-40f9-aeef-300da8c71af5.png)'
  prefs: []
  type: TYPE_IMG
- en: The weight vectors across the map can also be visualized. This is useful to
    uncover patterns in the distribution of the different countries.
  prefs: []
  type: TYPE_NORMAL
- en: 'The node weight vectors, or codes, are made up of normalized values of the
    original variables that are used to generate the SOM:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: 'The output of the preceding code is displayed in the following plot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/259a13dd-2d2f-4301-a7b8-276027289060.png)'
  prefs: []
  type: TYPE_IMG
- en: 'From the preceding diagram, it is possible to extract the characteristics of
    countries that have been placed in each cell. It is also possible to visualize
    how individual variables are distributed on the map. For example, let''s look
    at the distribution of the `MEANWGI` variable, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: 'The trained map is plotted and the cells are colored depending on the values
    of this variable for the countries placed on them, as shown in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2ba3695b-905c-4b5d-b36f-7599317b7363.png)'
  prefs: []
  type: TYPE_IMG
- en: According to the preceding map, countries with higher values in this variable
    will be located in the top-right part of the map.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, let''s see where the countries are located by using the macroeconomic
    information from December 2017 with the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: 'A map will be displayed, where countries will be placed according to their
    economic variables, as shown in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d1901549-bc48-42a8-99d4-6b96b4f30348.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Closer countries display similar values in macroeconomic variables. Thus, Greece,
    Portugal, and Cyprus are very close on the map. These countries have had important
    problems in the last few years as a consequence of financial crises. Countries
    such as Germany, France, and the United Kingdom are also similar, based on the
    macroeconomic information. Finally, we can create different clusters or groups
    on this map by taking into account the codebook vectors of the trained map. Hierarchical
    clustering can be used to select the number of groups. With the following code,
    we will obtain five different groups of countries:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: 'The recently created groups can be visualized on the map by running the following
    code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: 'The following map is plotted:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5a0e4765-bcf2-43bb-b798-4eb542fae82b.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The preceding diagram gives us the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Group 1**: Countries such as Portugal, Greece, and Cyprus.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Group 2**: Countries such as Poland, Malta, Bulgaria, and Spain. In general,
    this is a cluster of countries from Western Europe and other countries with a
    weak economic situation. This group is in a better shape than the previous group.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Group 3**: More solvent countries in the European Union, such as the UK,
    Germany, and France.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Group 4** and **Group 5**: These groups have one cell each, one of which
    contains Ireland. Ireland was in a deep economic crisis a few years back, but
    its situation is very different now. The difference is to such an extent that
    it cannot be included in any other group of countries.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'As usual, you can now back up your workspace using the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: With this simple clustering approach, it is possible to visualize the different
    situations of each country in the European Union.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we introduced the economic crisis that's experienced by different
    European countries. We obtained the data and analyzed it. Then, we developed a
    visual tool to compare the countries using different variables at the same time.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will try to create a rating model. We will assign different
    scores to countries according to their economic situations. Let's see if we are
    able to predict the ratings of different countries!
  prefs: []
  type: TYPE_NORMAL

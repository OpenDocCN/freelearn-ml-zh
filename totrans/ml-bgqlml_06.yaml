- en: '*Chapter 4*: Predicting Numerical Values with Linear Regression'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第4章*：使用线性回归预测数值'
- en: Predicting numerical measures could be extremely valuable for companies that
    need to plan their strategies in terms of budgets and resources. In most industries,
    predicting numbers could bring huge business advantages over their competition,
    and also enable new business scenarios.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 对于需要根据预算和资源来规划战略的公司来说，预测数值可能具有极大的价值。在大多数行业中，预测数字可能比竞争对手带来巨大的商业优势，并能够开启新的商业场景。
- en: Born from the statistics discipline, linear regression became one of the most
    well-known machine learning techniques to perform this kind of task. In data science,
    linear regression models are used to find and quantify the relationships between
    causes and effects among different variables. This kind of model can be very useful
    in different business scenarios where it's needed to make predictions on numerical
    measures.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 线性回归起源于统计学领域，成为执行此类任务最知名的机器学习技术之一。在数据科学中，线性回归模型用于寻找和量化不同变量之间原因和效果之间的关系。这类模型在需要预测数值测量的不同商业场景中非常有用。
- en: In this chapter, we'll go through all the steps required to build a linear regression
    model while leveraging BigQuery ML, which simplifies and accelerates all the stages
    of the development process.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将通过利用大查询ML构建线性回归模型的所有必要步骤，这将简化并加速开发过程的各个阶段。
- en: 'By following a gradual and incremental approach, we''ll cover the following
    topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 通过采用逐步和渐进的方法，我们将涵盖以下主题：
- en: Introducing the business scenario
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: Discovering linear regression
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现线性回归
- en: Exploring and understanding the dataset
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索和理解数据集
- en: Training the linear regression model
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 训练线性回归模型
- en: Evaluating the linear regression model
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估线性回归模型
- en: Utilizing the linear regression model
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用线性回归模型
- en: Drawing business conclusions
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提炼业务结论
- en: Let's get started!
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧！
- en: Technical requirements
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter requires you to access to a web browser and be able to leverage
    the following:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章要求您能够访问网络浏览器并能够利用以下功能：
- en: A GCP account to access Google Cloud Console
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP账户以访问Google Cloud Console
- en: A GCP project to host the BigQuery datasets
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP项目来托管BigQuery数据集
- en: Now, let's dive into the analysis and development parts of our BigQuery ML linear
    regression model.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们深入分析和发展我们的大查询ML线性回归模型的部分。
- en: 'Check out the following video to see the Code in Action: [https://bit.ly/2Rru9wA](https://bit.ly/2Rru9wA)'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下视频以查看代码的实际应用：[https://bit.ly/2Rru9wA](https://bit.ly/2Rru9wA)
- en: Introducing the business scenario
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: 'Imagine being one of the business analysts that works for a large company in
    New York City. Your company manages the nation''s largest bike sharing program.
    It leverages 10,000 bikes and has realized 600 stations across different New York
    areas: Manhattan, Brooklyn, Queens, and Jersey City.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，你是一名在纽约市一家大型公司工作的商业分析师。你的公司管理着全国最大的共享单车项目。它利用了10,000辆自行车，并在纽约的不同地区（曼哈顿、布鲁克林、皇后区和泽西城）实现了600个站点。
- en: 'The following is a picture from a bike sharing station in New York City:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是从纽约市的一个共享单车站拍摄的照片：
- en: '![Figure 4.1 – New York City bike sharing service by Citi Bike'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.1 – 纽约市共享单车服务由Citi Bike提供'
- en: '](img/B16722_04_001.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ']'
- en: Figure 4.1 – New York City bike sharing service by Citi Bike
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.1 – 由Citi Bike提供的纽约市共享单车服务
- en: Thanks to the vision and spirit of innovation of the company, huge amounts of
    data has been collected since 2013 and is still updated every day. This data contains
    a lot of information about the usage of the service and can be used to extract
    very interesting statistics.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 多亏了公司的远见和创新精神，自2013年以来已经收集了大量的数据，并且每天都在更新。这些数据包含了很多关于服务使用情况的信息，可以用来提取非常有趣的统计数据。
- en: At the time of writing, the bike sharing service is available for all the customers
    that have signed up for a weekly, monthly, or yearly subscription. However, this
    is not accessible to and convenient for people that only stay for a few days in
    the city, such as tourists or business travelers.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写本文时，共享单车服务对所有已注册每周、每月或年度订阅的客户开放。然而，这对那些只在城市逗留几天的人（如游客或商务旅行者）来说既不便利也不容易获得。
- en: Considering the large number of people staying in New York City for only a few
    days, the company wants people to be able to rent a bike for only a few hours.
    For this reason, management is thinking about the possibility to enable a new
    pay-as-you-go rental option.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到在纽约市仅停留几天的庞大人群，公司希望人们能够仅租用几小时的自行车。因此，管理层正在考虑启用新的按使用付费的租赁选项的可能性。
- en: The company's goal is to create a fully digital experience for this segment
    of customers and is thinking about the development of a new mobile application.
    If the customer indicates their departure and arrival station in advance, the
    mobile application should be able to predict the average trip time and a cost
    estimation for the ride. Thanks to this feature, the customers would know in advance
    if the trip time is compatible with their time schedule and if it's cheaper compared
    to other public transportation services.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 公司的目标是为这部分客户创造一个完全数字化的体验，并正在考虑开发一个新移动应用程序。如果客户提前表明他们的出发站和到达站，移动应用程序应该能够预测平均旅行时间和行程的成本估算。多亏了这个功能，客户可以提前知道旅行时间是否与他们的时间表相匹配，以及与其他公共交通服务相比是否更便宜。
- en: One of the managers of the company may ask you to use **Machine Learning** (**ML**)
    to develop the prediction system that will be introduced to the new mobile application.
    The ML system should predict the trip time of a bike rental using the data that
    has already been collected and stored in a BigQuery public dataset.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 公司的一位经理可能会要求你使用**机器学习**（**ML**）来开发将被引入新移动应用程序的预测系统。该机器学习系统应使用已收集并存储在BigQuery公共数据集中的数据来预测自行车租赁的旅行时间。
- en: Now that we've explained and understood the problem statement, let's take a
    look at the machine learning technique that we can use to predict a numerical
    value such as the duration of a trip.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经解释并理解了问题陈述，让我们来看看我们可以使用的机器学习技术来预测诸如旅行时间这样的数值。
- en: Discovering linear regression
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发现线性回归
- en: '**Linear regression** is one of the simplest techniques that we can apply when
    we have a continuous numerical value to predict. It is a well-known algorithm
    that was initially introduced in statistics to analyze the correlation between
    different variables.'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '**线性回归**是我们可以在拥有连续数值进行预测时应用的最简单技术之一。这是一个众所周知的算法，最初在统计学中引入，用于分析不同变量之间的相关性。'
- en: Important note
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: In statistics, the term regression means that two variables are correlated.
    This term describes a cause and effect relationship. The cause is called the **independent
    variable**, while the effect is called the **dependent variable**. The dependent
    variable can be calculated as a function of the independent variable.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在统计学中，回归一词表示两个变量是相关的。这个术语描述了因果关系。原因被称为**自变量**，而效果被称为**因变量**。因变量可以作为自变量的函数来计算。
- en: 'The following diagram shows the graphical representation of a simple linear
    relationship between two variables:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的图表显示了两个变量之间简单线性关系的图形表示：
- en: '![Figure 4.2 – Representation of simple linear regression'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.2 – 简单线性回归的表示'
- en: '](img/B16722_04_002.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片 B16722_04_002.jpg]'
- en: Figure 4.2 – Representation of simple linear regression
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.2 – 简单线性回归的表示
- en: A linear regression model tries to predict the label by finding the best linear
    relationship between the label and its features. If the machine learning model
    uses only one input variable, the model is defined as **simple linear regression**.
    If the ML model is based on multiple features, it is called **multivariate linear
    regression**.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 线性回归模型试图通过找到标签与其特征之间最佳线性关系来预测标签。如果机器学习模型只使用一个输入变量，则该模型定义为**简单线性回归**。如果ML模型基于多个特征，则称为**多元线性回归**。
- en: In our business scenario, the duration of a ride can be expressed with a numeric
    value, so we can use the linear regression approach to train our ML model. An
    example of simple linear regression is represented by the possibility to leverage
    only one variable, such as the distance between the start and stop station, to
    predict the outcome. Multivariate linear regression is based on multiple input
    variables. In our scenario this could be the distance between the start and stop
    stations, the age of the rider, and the day of the week when the rent occurred.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的业务场景中，行程的持续时间可以用一个数值来表示，因此我们可以使用线性回归方法来训练我们的机器学习模型。简单线性回归的一个例子是利用仅一个变量，例如起止站之间的距离，来预测结果。多元线性回归基于多个输入变量。在我们的场景中，这可能包括起止站之间的距离、骑行者的年龄以及租赁发生的星期几。
- en: Training a linear regression model means trying to find the values of the coefficients
    that can be used in the linear equation between the input variables, called features,
    and the output variable, called the label.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 训练线性回归模型意味着尝试找到可以用于输入变量（称为特征）和输出变量（称为标签）之间线性方程的系数值。
- en: 'We won''t go through all the details of linear regression in this book, but
    we can mention some examples of linear relation to better understand this concept.
    In real life, we can find a lot of measures that can be well-estimated with linear
    regression, such as the following:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会在这本书中详细介绍线性回归的所有细节，但我们可以提及一些线性关系的例子，以更好地理解这个概念。在现实生活中，我们可以找到许多可以用线性回归很好地估计的度量，例如以下内容：
- en: The weight of a person is dependent on their height.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 人的体重取决于他们的身高。
- en: The revenues of a company are a function of the number of customers.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公司的收入是客户数量的函数。
- en: The quantity of fuel consumed by a plane is conditioned by the distance traveled.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 飞机消耗的燃料量取决于航行的距离。
- en: Now that we've learned the basics of linear regression, it's time to take a
    look at the dataset that we'll use to build our machine learning model.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经学习了线性回归的基础知识，是时候看看我们将用于构建机器学习模型的数据集了。
- en: Exploring and understanding the dataset
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索和理解数据集
- en: Before diving into the machine learning implementation, it's necessary to analyze
    the data that is available for our use case. Since machine learning training is
    based on examples, we need to clearly understand what data to consider and check
    the quality of the available records.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入到机器学习实现之前，分析我们用例中可用的数据是必要的。由于机器学习训练基于示例，我们需要清楚地了解要考虑哪些数据，并检查可用记录的质量。
- en: Tip
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: Data scientists and business analysts spend a lot of time and resources getting
    a clear understanding of the datasets, checking their quality, and preparing them.
    Although these operations don't seem to be directly linked to the realization
    of a machine learning algorithm, they are essential if you wish to get solid results.
    The actual training of the model is the last mile of a longer journey that begins
    with comprehending data, the control of its quality, and preparing it.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 数据科学家和商业分析师花费大量时间和资源来清楚地理解数据集，检查它们的质量，并准备它们。尽管这些操作似乎与实现机器学习算法没有直接联系，但如果你希望得到可靠的结果，它们是至关重要的。模型的实际训练是开始于理解数据、控制其质量并准备数据这一更长旅程的最后一英里。
- en: Let's start by getting a clear understanding of the information that we have
    in our dataset to build our use case.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从清楚地了解我们数据集中用于构建用例的信息开始。
- en: Understanding the data
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解数据
- en: 'To have a clear understanding of the dataset that we''re going to be using
    for the implementation of this use case, we need to do the following:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 为了清楚地了解我们将要用于实现此用例的数据集，我们需要做以下事情：
- en: Log into Google Cloud Console and access the BigQuery user interface from the
    navigation menu:![Figure 4.3 – Accessing the BigQuery service from the GCP console
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录Google Cloud控制台，从导航菜单访问BigQuery用户界面：![图4.3 – 从GCP控制台访问BigQuery服务
- en: '](img/B16722_04_003.jpg)'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_04_003.jpg]'
- en: Figure 4.3 – Accessing the BigQuery service from the GCP console
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图4.3 – 从GCP控制台访问BigQuery服务
- en: Create a new dataset under the project that we created in [*Chapter 2*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039),
    *Setting Up Your GCP and BigQuery Environment*. To do this, we need to select
    our GCP project in the BigQuery navigation menu and click on the `04_nyc_bike_sharing`,
    keeping all the other options with default values:![Figure 4.4 – Creating the
    new BigQuery dataset to host the assets of our use case
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '](img/B16722_04_004.jpg)'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Figure 4.4 – Creating the new BigQuery dataset to host the assets of our use
    case
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: This dataset will contain our BigQuery ML model and all the intermediate tables
    that we'll create in the next steps of this chapter.
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Once the dataset has been created, it will be visible in the BigQuery navigation
    menu, as shown in the following screenshot:'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Figure 4.5 – The new dataset is available within the GCP project and'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: visible in the BigQuery navigation menu
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '](img/B16722_04_005.jpg)'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Figure 4.5 – The new dataset is available within the GCP project and visible
    in the BigQuery navigation menu
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Open the **bigquery-public-data** GCP project that hosts all the BigQuery public
    datasets and browse the items until you find the **new_york_citibike** dataset.
    In this public dataset, we will see two BigQuery tables: **citibike_stations**
    and **citibike_trips**. The first table is a registry of the stations of our bike
    sharing service, while the second one is the most interesting for our use case.
    We can start analyzing it now:![Figure 4.6 – The New York Citi Bike Public dataset
    contains two'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: different tables that can be used for our business scenario
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '](img/B16722_04_006.jpg)'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Figure 4.6 – The New York Citi Bike Public dataset contains two different tables
    that can be used for our business scenario
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Let's click on the **citibike_trips** table in the BigQuery navigation menu
    to access the schema of the table:![Figure 4.7 – The structure of the citibike_trips
    table lists all the fields that
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: can be used as labels and features
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '](img/B16722_04_007.jpg)'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Figure 4.7 – The structure of the citibike_trips table lists all the fields
    that can be used as labels and features
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The table is well-documented and for each column, we can easily understand the
    name, the datatypes, and the meaning of the content.
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'This table contains relevant information for our use case: the **tripduration**
    field indicates the duration expressed in seconds of each bike rental. The value
    of **tripduration** is a numeric value and it''s what we want to predict in our
    business scenario, so it will be our **label**.'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: All the other fields in the table are potential **features**. In fact, we have
    information about the starting and stopping stations, when the trip happened,
    and some insights into the customer, such as their age. All these columns could
    be good candidates for features since the position of the stations is directly
    related to the distance to go through and affects the duration of the trip. Also,
    the moment the ride begins could affect the duration because, on some, days the
    streets could be busier. Then, from a customer perspective, we might guess that
    young people ride faster than old people. From a schema perspective, we can conclude
    that this table represents a good dataset for developing our machine learning
    model, but we need to check our initial guesses further.
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 表格中的所有其他字段都是潜在的**特征**。实际上，我们有关于起始站和终点站、行程发生时间以及一些关于客户的信息，例如他们的年龄。所有这些列都可能是特征的良好候选者，因为站点的位置与要通过的距离直接相关，并影响行程的持续时间。此外，骑行开始的时间可能会影响持续时间，因为在某些日子里，街道可能会更繁忙。然后，从客户的角度来看，我们可能会猜测年轻人骑得比老年人快。从模式的角度来看，我们可以得出结论，这个表格代表了一个很好的数据集，用于开发我们的机器学习模型，但我们需要进一步检查我们的初步猜测。
- en: As the next step, let's take a look at how many records we have in the table
    and if they're enough for our purposes.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为下一步，让我们看看表格中有多少条记录，以及这些记录是否足够满足我们的需求。
- en: 'Clicking on the **Details** tab, we can see that the table contains more than
    58 million records:'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 点击**详情**标签页，我们可以看到该表格包含超过5800万条记录：
- en: '![Figure 4.8 – The Details tab of the citibike_trips table shows the number
    of records that are available'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.8 – citibike_trips表的详情标签页显示了可用的记录数'
- en: '](img/B16722_04_008.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_04_008.jpg](img/B16722_04_008.jpg)'
- en: Figure 4.8 – The Details tab of the citibike_trips table shows the number of
    records that are available
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.8 – citibike_trips表的详情标签页显示了可用的记录数
- en: We can be extremely confident about building an ML model with this huge amount
    of data.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以非常自信地使用如此大量的数据来构建ML模型。
- en: In this section, we understood how much information we can obtain just by analyzing
    the metadata provided by BigQuery in its user interface. Now, it's time to look
    at the actual data in this table and use it effectively.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们了解了仅通过分析BigQuery用户界面提供的元数据，我们可以获得多少信息。现在，是时候查看这个表格中的实际数据并有效地使用它了。
- en: Checking the data's quality
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 检查数据质量
- en: The quality of data is fundamental to building robust machine learning models.
    An ML model learns from examples. If the examples present incorrect data, the
    model will inevitably learn from these errors and apply them during the actual
    usage.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 数据质量对于构建健壮的机器学习模型至关重要。ML模型从示例中学习。如果示例包含错误数据，模型不可避免地会从这些错误中学习并在实际使用中应用它们。
- en: 'Let''s start analyzing the dataset that will be used to build our ML model:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始分析用于构建我们的ML模型的数据库集：
- en: 'Frist of all, we will focus on the `tripduration` field. This is the column
    that we want to predict with our machine learning model and represents our label:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将关注`tripduration`字段。这是我们希望用我们的机器学习模型进行预测的列，它代表我们的标签：
- en: '[PRE0]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This query statement counts the number of rows with a `tripduration` that's
    empty or less than zero. Although the table description reported that the dataset
    only contains trips with a duration greater than 1 minute, we can immediately
    notice that the outcome of this query is a number greater than 0\. In fact, we
    can find more than five million records with the `tripduration` field not properly
    valued. Since we cannot train a model on an empty or wrong value of the label,
    we'll need to exclude these records from our use case.
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这个查询语句计算了`tripduration`为空或小于零的行数。尽管表格描述报告称该数据集只包含持续时间大于1分钟的行程，但我们可以立即注意到这个查询的结果是一个大于0的数字。事实上，我们可以找到超过五百万条`tripduration`字段未正确赋值的记录。由于我们不能在标签的空值或错误值上训练模型，我们需要将这些记录排除在我们的用例之外。
- en: 'Next, we''ll inspect the minimum and the maximum value of the `tripduration`
    field to evidence any outlier that can cause poor performance for our machine
    learning model:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将检查`tripduration`字段的最低值和最高值，以证明任何可能对我们的机器学习模型性能产生不良影响的异常值：
- en: '[PRE1]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: While the minimum rental time is an expected value of 1 minute, we can see that
    the maximum value is not compatible with the normal functionality of a bike sharing
    service. In fact, the maximum duration is more than 300,000 minutes, which is
    approximately equivalent to a rental period of more than 225 days.
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 虽然最小租赁时间是1分钟，但我们看到最大值与自行车共享服务的正常功能不兼容。实际上，最大时长超过300,000分钟，这大约相当于超过225天的租赁期。
- en: 'In the following screenshot, you can see the result of the query:'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，你可以看到查询的结果：
- en: '![Figure 4.8 – The Details tab of the citibike_trips table shows the number
    of records that are available'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![Figure 4.8 – citibike_trips表的详细信息标签页显示了可用的记录数'
- en: '](img/B16722_04_009.jpg)'
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_04_009.jpg](img/B16722_04_009.jpg)'
- en: Figure 4.9 – The results of the query, evidencing the presence of outliers in
    the tripduration column
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图4.9 – 查询结果，证明了`tripduration`列中存在异常值
- en: While preparing our datasets, we'll take all these factors into considerations
    to avoid any impact on the machine learning model.
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在准备我们的数据集时，我们会考虑所有这些因素，以避免对机器学习模型造成任何影响。
- en: 'Then, we can apply a similar check to all the columns that are potential features
    of our machine learning model, excluding the records that present a non-significant
    value of `tripduration`:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们可以对所有可能的机器学习模型特征列应用类似的检查，排除那些`tripduration`值非显著性的记录：
- en: '[PRE2]'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: With this query statement, we're only focusing on the records with a rental
    duration greater than zero and not empty. The goal of the query is to check that
    all the other potential features are not empty fields.
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用这个查询语句，我们只关注租赁时长大于零且非空的记录。查询的目标是检查所有其他潜在特征字段不为空。
- en: In this case, the query returns a count of zero. For this reason, we can be
    confident that, excluding the rows where `tripduration` is `NULL`, we'll get meaningful
    values for the other columns.
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这种情况下，查询返回零。因此，我们可以确信，排除`tripduration`为`NULL`的行，我们将在其他列得到有意义的值。
- en: 'After that, we can analyze the `birth_year` column, which represents the birth
    year of the customer that is using the bike sharing service:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后，我们可以分析`birth_year`列，该列代表使用自行车共享服务的客户的出生年份：
- en: '[PRE3]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `SELECT COUNT (*)` statement looks for records where the customer's birth
    year is empty. The query filters the records where `tripduration` is `NULL` or
    less than zero.
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`SELECT COUNT (*)`语句寻找客户出生年份为空的记录。查询过滤了`tripduration`为`NULL`或小于零的记录。'
- en: Upon executing the query, we can immediately notice that there are more than
    five million records that contain a `NULL` value for `birth_year`. We'll need
    to filter these records in the following stages of our use case.
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行查询后，我们可以立即注意到有超过五百万条记录的`birth_year`字段为`NULL`。我们需要在用例的后续阶段过滤这些记录。
- en: Tip
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 小贴士
- en: To accelerate the process of composing a `SELECT` statement on a table and to
    avoid any typos, BigQuery allows you to use the **Query Table** button, which
    automatically generates a SQL stub where you need to choose only the fields to
    extract. In addition, you can also select the table name from the navigation menu,
    or the column name from the **Schema** tab, to automatically include the name
    of the selected object in the SQL query that you're composing.
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了加速在表上编写`SELECT`语句的过程并避免任何错误，BigQuery允许你使用**查询表**按钮，该按钮会自动生成一个SQL占位符，你只需选择要提取的字段。此外，你还可以从导航菜单中选择表名，或从**模式**标签中选择列名，以自动将所选对象的名称包含在你正在编写的SQL查询中。
- en: 'Now that we''ve performed some quality checks on our dataset, let''s focus
    on segmenting the rows into three different tables: training, evaluation, and
    prediction.'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经对我们的数据集进行了质量检查，让我们将行划分为三个不同的表：训练、评估和预测。
- en: Segmenting the dataset
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据集划分
- en: One of the main principles of developing a machine learning model is based on
    segmenting our dataset into train and evaluation sets, and then using the ML model
    on different records.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 开发机器学习模型的主要原则之一是将我们的数据集划分为训练集和评估集，然后在不同记录上应用机器学习模型。
- en: 'Let''s start segmenting the dataset by performing the following steps:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从以下步骤开始划分数据集：
- en: 'To understand how the data is distributed across the years and months, we can
    use the following query statement:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要了解数据如何在年份和月份之间分布，我们可以使用以下查询语句：
- en: '[PRE4]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The `SELECT` statement extracts the year and the month from the `starttime`
    field, which indicates the exact moment when the bike trip started.
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: To extract a portion of the entire timestamp, we can use the `EXTRACT` function,
    which accepts a parameter such as `YEAR`, `MONTH`, `QUARTER`, `WEEK`, `DAYOFYEAR`,
    or `DAYOFWEEK` as input, followed by the `FROM` keyword and the field that contains
    the date expression.
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The query already excludes all the bad records that we found in the previous
    section and focuses on `2017` and `2018`.
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: To exclude outliers in the `tripduration` column, we're only taking into consideration
    the rows with a minimum rental time of 3 minutes and a maximum of 3 hours.
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: We can also add a filter to the year of birth of our customers, by filtering
    all the records with an empty `birth_year` and ignoring all the customers born
    after `2007`.
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The query counts the number of rows segmenting the results per year and month
    with the `GROUP BY` clause and orders these periods in ascending mode, as specified
    in the `ORDER BY` clause.
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'In the following screenshot, you can see the query''s result:'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Figure 4.10 – The results of the query describe the segmentation on a monthly
    basis'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '](img/B16722_04_010.jpg)'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Figure 4.10 – The results of the query describe the segmentation on a monthly
    basis
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: From the results of the query, we can see that the dataset goes from April 2017
    until May 2018\. We can use a rule of thumb and keep 80% of the data for training,
    10% for evaluation, and the remaining 10% for prediction. By applying this rule
    to our dataset, we'll use the first 11 months for the training stage, the following
    2 months for the evaluation stage, and the last month for the prediction stage.
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Applying what we decided on in the previous step, let''s create a table that
    contains only the rows that will be used to train our BigQuery ML model:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The result of the query is stored in the new `` `04_nyc_bike_sharing.training_table`
    `` table that we created to support the following steps of our use case.
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The `SELECT` statement extracts all the fields inside the `citibike_trips` table
    from the BigQuery public dataset, converting the value of `tripduration` from
    seconds into minutes.
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The `WHERE` clause allows us to consider only the months that we want to use
    for the training stage. The time frame goes from April 2017 to February 2018\.
    We've also applied the filters that come from the data quality checks in the same
    clause.
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Now that we''ve delimited the training dataset, we can create another table
    dedicated to the records that will be used to evaluate our machine learning model:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The query is very similar to the statement that was used to create the training
    table. The only difference is related to the period we selected in the `WHERE`
    clause. For `evaluation_table`, we've focused our `SELECT` statement on the records
    from March and April 2018, which were previously excluded from the training table.
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Using the same approach, we can also create the table that will be used to
    test our machine learning model:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The query will apply the necessary logic but will only take the month of May
    2018 into consideration.
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now that we've segmented our dataset and we're clear about which records to
    use for the training, evaluation, and test phases, let's dive into the ML model's
    creation.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
- en: Training the linear regression model
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Training a BigQuery ML model is not a one-shot operation, but it''s a process
    that can require multiple attempts and recycles to get closer to the final goal
    of developing an effective asset with good performance, according to the requirements
    of the business scenario. For our use case, we''ll go try to improve the performance
    of our ML model multiple times. Let''s get started:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: 'First, let''s start training a new machine learning model named `trip_duration_by_stations`:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: In this statement, we can notice the `CREATE OR REPLACE MODEL` keyword, which
    is used to create a new model. This keyword is followed by the identifier of the
    model, which is represented by concatenating the dataset and ML model name.
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: After these first lines, we have the `OPTIONS` keyword, where the type of machine
    learning model to use is specified. In this case, we're using a linear regression
    identified by `model_type='linear_reg'`.
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'After `OPTIONS`, we need to specify the set of records that the ML model will
    be trained on. For this first attempt, we will decide to use only two features:
    the names of the start and of stop stations of the bike trip.'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'With the `as label` keyword, we are instructing BigQuery to use `tripduration`
    as the label for our machine learning model. As an alternative, it is possible
    to include the label among the list of `OPTIONS` with the `INPUT_LABEL_COLS` keyword,
    as shown in the following snippet of code:'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: After a few seconds, the BigQuery ML model will be created and available in
    the navigation menu, under the `04_nyc_bike_sharing` dataset. Select the ML model
    and click on the `trip_duration_by_stations`.
  id: totrans-146
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In this case, we'll focus our attention on **Mean absolute error**. This value
    represents the average distance between the actual value and the predicted value
    of the label.
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'As shown in the following screenshot, it''s very close to 7 minutes:'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Figure 4.11 – The Evaluation tab shows some key performance indicators of
    the ML model'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '](img/B16722_04_011.jpg)'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Figure 4.11 – The Evaluation tab shows some key performance indicators of the
    ML model
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Now, let''s try to enrich the ML model with other features that can bring additional
    value:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: In this second model, we've added a new feature called `is_weekend`. This field
    is a `IF` statement that returns `true` if the day is Sunday or Saturday, represented
    by the values `1` and `7`; otherwise, it's `false`.
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If we check the mean absolute error of this new BigQuery ML model, we can notice
    that we've slightly improved the performance of our model with a value of 6.7784.
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Since we''ve had some improvements from adding more features, let''s try including
    the age of the customer as a new parameter for our ML model:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Compared to the previous model, we've added the new `age` column, which is calculated
    as the difference between the year of `starttime` and the customer's birth year.
  id: totrans-158
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once we've executed the query statement, we will see that the new `age` feature
    doesn't improve the performance of our ML model. This is because the mean absolute
    error is 6.9508\. This value is better compared to our first attempt, but worse
    than the second.
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In this section, we created different ML models while trying to use different
    features in our dataset. Next, we will continue using the `trip_duration_by_stations_and_day`
    model, which, during the training phase, realized the best performance in terms
    of mean absolute error.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: Now, let's learn how to start the evaluation phase.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: Evaluating the linear regression model
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For the evaluation stage of our BigQuery ML model, we'll use the `ML.EVALUATE`
    function and the table that we've expressly created to host the evaluation records.
    These are completely separate from the rows that are used during the training
    phase.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s execute the following query to evaluate our ML model on the evaluation
    table:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The `SELECT` statement extracts all the fields returned by the `ML.EVALUATE`
    function. The evaluation function is applied to the `` `04_nyc_bike_sharing.trip_duration_by_stations_and_day`
    `` model and on the rows that have been extracted from the `evaluation_table`
    table.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: The most internal `SELECT` extracts the same fields that were used to train
    the ML model as the features that are applying the same transformations, such
    as on the `is_weekend` field, which is calculated with the same logic as the training
    phase.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: The results of the query show a mean absolute error very close to 7 minutes,
    which is similar to the value of 6.7784 that was achieved during the training
    phase. For this reason, we can say that the ML model maintains its performance
    on a dataset different from the training one. We can say that the model is not
    affected by overfitting.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following screenshot, you can see the performance indicators that have
    been extracted by the evaluation query:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 4.12 – The query results of the EVALUATE function show the ML key'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: performance calculated on the evaluation table
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16722_04_012.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.12 – The query results of the EVALUATE function show the ML key performance
    calculated on the evaluation table
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: Now that we've trained the model and we're also satisfied with the outcomes
    of the evaluation stage, let's learn how to apply our machine learning model to
    other records and get predictions.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: Utilizing the linear regression model
  id: totrans-175
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To use our BigQuery ML model, we'll use the `ML.PREDICT` function and the table
    that we've expressly created to host the records that we haven't used yet.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: 'The following query will predict the label using the data in `prediction_table`:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The query statement is composed of a `SELECT` keyword, which extracts the actual
    and the predicted duration of the rental. It calculates the difference in minutes
    and orders the results from the minimum to the maximum difference of minutes.
    To calculate the difference, we used the `ABS` function, which extracts the absolute
    value of a numeric.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
- en: The `ML.PREDICT` function is applied to the `SELECT` statement, which extracts
    the features and the actual duration from `prediction_table`. This last field
    is only used for comparison with the predicted value and is not used to run the
    ML model.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following screenshot, you can see the results of the query execution:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 4.13 – The query results of the PREDICT function show the actual and
    the predicted duration.'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B16722_04_013.jpg)'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.13 – The query results of the PREDICT function show the actual and
    the predicted duration.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: Now that we've applied our model, let's formulate some final considerations
    and provide the answers to our managers about the possibility of predicting the
    trip duration of a bike rental.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
- en: Drawing business conclusions
  id: totrans-186
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this section, we'll formulate some final considerations using the results
    that we got from applying our ML model.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: By enriching the previous query with a parent `SELECT COUNT` statement, we can
    identify how many predictions are less than `15` minutes away from the actual
    value.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s execute the following query to calculate how often the trip duration
    predictions are far from the actual values:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The result of the `SELECT COUNT` query returns a value of 1,548,370 predictions,
    with a difference between the predicted and the actual value being less than `15`
    minutes.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
- en: Considering that the total size of the `prediction_table` table is 1,728,078,
    we can say that in 89.6% of cases, our machine learning model is able to predict
    the trip duration with a gap that's less than 15 minutes.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: For the reasons we expressed previously, we can suggest to management to start
    with a quarterly fare for the new on-demand and pay-as-you-go pricing model. With
    this strategy, when a customer picks up a bike from a start station and specifies
    its destination on the mobile application on a specific day of the week, our model
    will be able to predict the exact fare of the ride with a mean absolute error
    of about 7 minutes. The 89.6% the application will provide a good estimation of
    the price to our customer.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-194
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we built our first machine learning use case based on a real-life
    scenario. After a brief introduction to the use case, we discovered what linear
    regression is and how it can be used to predict numerical values.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
- en: Before diving into actually developing the machine learning model, we learned
    that having a clear understanding of the data and checking its quality is fundamental
    to getting effective machine learning models. To start from a solid foundation,
    we leveraged the BigQuery public dataset, which collects information about all
    the rentals for a bike sharing service in New York City.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
- en: For training the model, we used different features to understand which variables
    are relevant to building our BigQuery ML model.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: Then, we chose one machine learning model to carry on to the evaluation stage.
    In this phase, we used the BigQuery evaluation function to verify that the machine
    learning model could also effectively work on new rows outside the training dataset.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
- en: Finally, we applied our ML model to a third subset of records to predict the
    duration of each bike rental. We did this by leveraging the start and stop stations
    chosen by the user and the day of the week that the trip is happening on.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
- en: We also calculated that 89% of them have a difference of less than 15 minutes
    compared to the actual duration of the trip. For this reason, we can conclude
    that we can provide a good user experience to our customers if the company applies
    a quarterly fare to our new pay-as-you-go offering.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we'll discover binary logistic regression and how to use
    it with BigQuery ML to predict boolean variables.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
- en: Further reading
  id: totrans-202
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**NYC Bike Sharing Public Dataset**: [https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike](https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike)'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**BigQuery ML Create Model**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**BigQuery ML Evaluate Model**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**BigQuery ML Predict**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**BigQuery ML Linear Regression Example**: [https://cloud.google.com/bigquery-ml/docs/bigqueryml-natality](https://cloud.google.com/bigquery-ml/docs/bigqueryml-natality)'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL

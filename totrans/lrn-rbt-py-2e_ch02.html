<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis">
<head>
  <meta charset="UTF-8"/>
  <title>Understanding the Basics of Differential Robots</title>
  <link type="text/css" rel="stylesheet" media="all" href="style.css"/>
  <link type="text/css" rel="stylesheet" media="all" href="core.css"/>
</head>
<body>
  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Understanding the Basics of Differential Robots</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we discussed the basics of ROS, how to install it, and the basics of the Gazebo robot simulator. As we have already mentioned, we are going to create an autonomous wheeled robot from scratch. The robot that we are going to design is a differential drive robot, which involves having two wheels on opposite sides of the robot chassis, enabling the robot's direction to be adjusted by changing the speed of each of the two wheels.</p>
<p>It will be good to understand the basic ideas and terminology behind differential wheel robots before programming the robot. This chapter will give you an idea of how to analyze the robot mathematically and how to solve the robot's kinematics equation. The kinematics equation helps you to predict the robot's position from its sensor data.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Mathematical modeling of differential drive robots</li>
<li>Forward kinematics of differential drive robots</li>
<li>Inverse kinematics of differential drive robots</li>
</ul>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Mathematical modeling of the robot</h1>
                </header>
            
            <article>
                
<p>An important part of a mobile robot is its steering system. This will help the robot to navigate its environment. One of the simplest and most cost-effective steering systems is the differential drive system. A differential drive robot consists of two main wheels mounted on a common axis that are controlled by separate motors. A differential drive system/steering system is a nonholonomic system, which means that it has constraints for the changing the robot's pose.</p>
<p>A car is an example of a nonholonomic system, as it cannot change its position without changing its pose. Let's look at how this type of robot works and how we can model the robot in terms of its mathematics.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Introduction to the differential drive system and robot kinematics</h1>
                </header>
            
            <article>
                
<p><strong>Robot kinematics</strong> is the study of the mathematics of motion without considering the forces that affect the motion. It mainly deals with the geometric relationships that govern the system. <strong>Robot dynamics</strong> is the study of motion in robots in which all the forces involved in the robots' movement are modeled.</p>
<p>A mobile robot or vehicle has six <strong>degrees of freedom</strong> (<strong>DOFs</strong>) expressed by the pose (x, y, z, roll, pitch, and yaw). These DOFs consist of the position (x, y, z) and attitude (roll, pitch, and yaw). <strong>Roll</strong> refers to sidewise rotation, <strong>pitch</strong> refers to forward and backward rotation, and <strong>yaw</strong> (called the heading or orientation) refers to the direction in which the robot moves in the x-y plane. The differential drive robot moves from x to y in the horizontal plane, so the 2D pose contains mainly x, y, and θ, where θ is the heading of the robot that points in the robot's forward direction. This information is sufficient to describe a differential robot pose:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/bf59012e-07c6-40a5-8ae5-d64ce234c08f.png" style="width:35.00em;height:21.92em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">The pose of the robot in x, y, and θ in the global coordinate system</div>
<p>In a differential drive robot, the motion can be controlled by adjusting the velocity of two independently controlled motors on the left-hand and right-hand side, named V-left and V-right, respectively. The following image shows a couple of popular differential drive robots available on the market:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/f2612c91-4061-421d-b7c6-fdb1007c3c1c.jpg" style="width:28.25em;height:21.25em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Robot Roomba (<a href="https://en.wikipedia.org/wiki/IRobot">https://en.wikipedia.org/wiki/IRobot</a><span class="MsoHyperlink">)</span></div>
<p>The Roomba series of autonomous vacuum cleaners is a popular differential robot from iRobot.</p>
<div class="packt_figure"></div>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/1d830fcb-1a56-4031-983a-665969eb0f52.png"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Pioneer 3-DX (<a href="http://robots.ros.org/pioneer-3-dx/">http://robots.ros.org/pioneer-3-dx/</a><span class="MsoHyperlink">)</span></div>
<p>The Pioneer 3-DX is a popular differential drive research platform from Omron Adept Mobile Robots.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Forward kinematics of a differential robot</h1>
                </header>
            
            <article>
                
<p>The forward kinematics equations for a robot with a differential drive system are used to solve the following problem:</p>
<p>If a robot is standing in a position (<em>x</em>, <em>y</em>, <em>θ</em>) at time <em>t</em>, determine the pose (<em>x'</em>, <em>y'</em>, <em>θ'</em>) at <em>t + δt</em> given the control parameters <em>V-left</em> and <em>V-right</em>.</p>
<p>This technique can be calculated by the robot to follow a particular trajectory.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Explanations of the forward kinematics equation</h1>
                </header>
            
            <article>
                
<p>We can start by formulating a solution for forward kinematics. The following figure is an illustration of one of the wheels of the robot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/48ecb864-dd75-4b41-bb95-75c5e84ebb18.png" style="width:20.58em;height:17.83em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">A single wheel of the robot rotating along the local y-axis</div>
<p>The motion around the <strong>y-axis</strong> is known as the roll; everything else is called the slip. Let's assume that no slip occurs in this case. When the wheel completes one full rotation, it covers a distance of <em>2π r</em>, where <em>r</em> is the radius of the wheel. We will assume that the movement is two-dimensional. This means that the surface is flat and even.</p>
<p>When the robot is about to perform a turning motion, the robot must rotate around a point that lies along its common left and right wheel axis. The point that the robot rotates around is known as the <strong>ICC</strong><strong>-the instantaneous center of curvature</strong>. The ICC is located outside the robot. The following diagram shows the wheel configuration of the differential drive robot in relation to its ICC:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/68098a0b-6c98-4d16-96fc-f8f4b711e9fd.png" style="width:21.00em;height:16.00em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Wheel configuration for a robot with a differential drive</div>
<p>The central concept for the derivation of the kinematic equation is the <em>ω</em> angular velocity of the robot. Each wheel on the robot rotates around the ICC along the circumference of a circle with a wheel radius of <em>r</em>.</p>
<p>The speed of the wheel is <em>v = 2 π r / T,</em> where <em>T</em> is the time taken to complete one full turn around the ICC. The <em>ω</em> angular velocity is defined as <em>2 π / T</em>, and typically has the unit of radians (or degrees) per second. Combining the equations for <em>v</em> and <em>w</em> yields <em>ω= 2 π / T</em>, and we can conclude the following:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/5fab14c0-adf5-440c-a61e-854469611148.png" style="width:33.50em;height:2.58em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Equation of linear velocity</div>
<p>A detailed model of the differential drive system is shown in the following diagram:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/12a41d8a-cd5c-47b4-844e-7c4a6bf21a95.png" style="width:28.92em;height:20.00em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Detailed diagram of the differential drive system</div>
<p>If we apply the previous equation to both wheels, the result will be the same-that is, <em>ω</em>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/773ce22d-2687-4115-b74c-5b23fcf1dedf.png" style="width:24.17em;height:3.50em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Differential drive wheel equation</div>
<p>Here, <em>R</em> is the distance between the ICC and the midpoint of the wheel axis and <em>l</em> is the length of the wheel axis. After solving <em>ω</em> and <em>R</em>, we get the following result:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/1fd4d9c5-ed25-45bf-8a81-c68514c97b5b.jpg" style="width:21.42em;height:2.83em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Equation to find the distance from the ICC to the center of the robot and the angular velocity of the robot</div>
<p>The previous equation is useful for solving the forward kinematics problem. Suppose the robot moves with an angular velocity of <em>ω</em> for <em>δt</em> seconds. This will result in the robot's orientation or heading changed to the following:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/d4e8350f-5c86-4814-b29c-6c7b3dfc6f5c.png" style="width:26.67em;height:2.17em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Equation to find the change in heading</div>
<p>Here, the center of the ICC rotation is given by basic trigonometry as the following:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/030cd85a-4949-421f-88a3-083513f2b820.png" style="width:25.67em;height:2.33em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Equation to find the ICC</div>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/bc25e56a-10d8-49bf-a264-73e05f89888a.png" style="width:34.50em;height:26.00em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Rotating the robot ωδt degrees around the ICC</div>
<p class="packt_figure CDPAlignCenter CDPAlign CDPAlignLeft">Given a starting position (<em>x</em>, <em>y</em>), the new position (<em>x'</em>, <em>y'</em>) can be computed using the 2D rotation matrix. The rotation around the ICC with the angular velocity <em>ω</em> for <em>δt</em> seconds yields the following position at the time <em>t + δt</em>:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/17131971-5654-46bd-88b9-5a325e0e6cde.png" style="width:30.00em;height:4.75em;"/></div>
<div class="packt_figure CDPAlignCenter CDPAlign packt_figref">Equation to calculate the new position of the robot</div>
<div class="packt_figure CDPAlignCenter CDPAlign">
<p>The new pose (<em>x'</em>, <em>y'</em>, and <em>θ'</em>) can be computed from equation (6) and (8), given <em>ω</em>, <em>δt</em>, and <em>R</em>.</p>
<p><em>ω</em> can be computed from equation (5); <em>Vr</em> and <em>Vl</em> are often more difficult to measure accurately. Instead of measuring the velocity, the rotation of each wheel can be measured using sensors called <strong>wheel encoders</strong>. The data from the wheel encoders is the robot's <strong>odometry</strong> values. These sensors are mounted on the wheel axes and deliver binary signals for each degree that the wheel rotates (each degree may be in the order of 0.1 mm). We will look at the detailed workings of the wheel encoders in <em>Chapter 6, Interfacing Actuators and Sensors to the Robot Controller</em>. These signals are fed to a counter so that <em>vδt is</em> the distance traveled from the time <em>t</em> to <em>t + δt</em>. We can write the following:</p>
<p><em>n * step = vδt</em></p>
<p>From this, we can calculate <em>v</em>:</p>
</div>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/0f7407a2-41a9-4346-a4ae-a4dedf783efc.png" style="width:31.33em;height:2.50em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Equation calculating the linear velocity from the encoder data</div>
<p>If we insert equation (9) in equations (3) and (4), we get the following result:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/684655cc-d7fe-4fde-b4b6-158e71e52d2e.png" style="width:27.83em;height:4.17em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Equation to calculate R from the encoder values</div>
<p>Here, <em><strong>nl</strong></em> and <em><strong>nr</strong></em> are the encoder counts of the left and right wheels. <em><strong>Vl</strong></em> and <em><strong>Vr</strong></em> are the speeds of the left and right wheels respectively. Thus, the robot stands in pose (<em>x</em>, <em>y</em>, <em>θ</em>) and moves <em><strong>nl</strong></em> and <em><strong>nr</strong></em> counts during a time frame of <em>δt</em>; the new pose (<em>x'</em>, <em>y'</em>, <em>θ'</em>) is given by calculating the following:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/ec40f018-8896-4c85-923e-7caadac6fc8d.png" style="width:26.83em;height:5.75em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Equation to calculate the robot's position from the encoder values</div>
<p>where,</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="images/2e9dc917-0d2f-46a9-9cbe-5e7b3ca7c704.png" style="width:25.83em;height:5.33em;"/></div>
<div class="packt_figure packt_figref CDPAlignCenter CDPAlign">Equation to calculate the ICC and other parameters from the encoder values</div>
<p>The derived kinematic equation depends mainly on the design and geometry of the robot. Different designs can lead to different equations.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Inverse kinematics</h1>
                </header>
            
            <article>
                
<p>The forward kinematics equation provides an updated pose at a given wheel speed. We can now think about the inverse problem.</p>
<p>Stand in pose (<em>x</em>, <em>y</em>, <em>θ</em>) at time <em>t</em> and determine the <em>V-left</em> and <em>V-right</em> control parameters so that the pose at time <em>t + δt</em> is (<em>x'</em>, <em>y'</em>, <em>θ'</em>).</p>
<p>In differential drive systems, this problem may not always have a solution because this kind of robot can't be moved to any pose by simply setting the wheel velocity. It's because of the nonholonomic robots' constraints.</p>
<p>In nonholonomic robots, there are some ways to increase the constrained mobility if we allow a sequence of different (<em>V-left</em>, <em>V-right</em>) movements. If we insert the values from equations (12) and (15), we can identify some special movements that we can program:</p>
<ul>
<li>If <em>V-right = V-left</em> =&gt; <em>nr = nl</em> =&gt; <em>R = ∞</em>, <em>ωδT = 0</em> =&gt;, this means that the robot moves in a straight line and <em>θ</em> remains the same</li>
<li>If <em>V-right = -V-left</em> =&gt; <em>nr = -nl</em> =&gt; <em>R=0</em>, <em>ωδt = 2nl * step / l</em> and <img src="images/ce532925-1a49-4e36-a478-09cfd6e45b62.png" style="width:9.75em;height:1.92em;"/>=&gt; <em>x' = x</em>, <em>y' = y</em>, <em>θ' = θ + ωδt</em> =&gt;, this means the robot rotates in position around ICC-that is, any <em>θ</em> is reachable, while (<em>x</em>, <em>y</em>) remains unchanged</li>
</ul>
<p>Combining these operations, the following steps can be used to reach any target pose from the starting pose:</p>
<ol>
<li>Rotate until the robot's orientation coincides with the line leading from the starting position to the target position, <em>V-right = -V-left = V-rot</em>.</li>
<li>Drive straight until the robot's position coincides with the target position, <em>V-right = V-left = V-ahead</em>.</li>
<li>Rotate until the robot's orientation coincides with the target orientation, <em>V-right = -V-left = V-rot</em>. Here, <em>V-rot</em> and <em>V-ahead</em> can be chosen arbitrarily.</li>
</ol>
<p>We will see how we can implement the kinematics equation of the robot using ROS in the upcoming chapters.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>This chapter was about the fundamental concepts of differential drive robots, and looked at how you can derive the kinematics equations of such robots. At the start of the chapter, we saw the basics of differential drive robots, and then we discussed the forward kinematics equations that are used in these robots. These equations were explained using diagrams. After looking at forward kinematics equations, we looked at the inverse kinematics equations for differential drive robots. We also looked at the basics of inverse kinematics equations.</p>
<p>In the next chapter, we will see how we can create a simulation of the autonomous mobile robot using ROS and Gazebo.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>What are holonomic and nonholonomic configurations?</li>
<li>What are robot kinematics and dynamics?</li>
<li>What is the ICC of a differential drive robot?</li>
<li>What is the forward kinematic equation in a differential robot?</li>
<li>What is the inverse kinematic equation in a differential robot?</li>
</ol>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Further information</h1>
                </header>
            
            <article>
                
<p>Refer to <a href="http://www8.cs.umu.se/~thomash/reports/KinematicsEquationsForDifferentialDriveAndArticulatedSteeringUMINF-11.19.pdf"><span class="URLPACKT">http://www8.cs.umu.se/~thomash/reports/KinematicsEquationsForDifferentialDriveAndArticulatedSteeringUMINF-11.19.pdf</span></a> for more information on kinematic equations.</p>


            </article>

            
        </section>
    </div>
</body>
</html>
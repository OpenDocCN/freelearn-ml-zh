<html><head></head><body>
		<div id="_idContainer217">
			<h1 id="_idParaDest-168" class="chapter-number"><a id="_idTextAnchor173"/>13</h1>
			<h1 id="_idParaDest-169"><a id="_idTextAnchor174"/>Using OpenAI and Azure OpenAI in Power BI Dataflows</h1>
			<p><a href="B19500_12.xhtml#_idTextAnchor165"><span class="No-Break"><em class="italic">Chapter 12</em></span></a> of this book provided an overview of the OpenAI and Azure OpenAI technologies. The chapter also explored methods to incorporate these cutting-edge AI technologies into your use case using FAA Wildlife Strike data. To enhance the quality of the content in <a href="B19500_12.xhtml#_idTextAnchor165"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>, OpenAI ChatGPT was utilized to generate better text. Moving forward, ChatGPT will continue to be used on occasion as a tool to improve the writing quality of the rest of <span class="No-Break">the book.</span></p>
			<p>Furthermore, there are two use cases for OpenAI and Azure OpenAI technologies that are discussed in detail in this chapter. Specifically, you will focus on their applications in summarization and descriptive content generation, as discussed in <a href="B19500_12.xhtml#_idTextAnchor165"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>. To illustrate these use cases, a project is included in <span class="No-Break">this chapter.</span></p>
			<p>In this chapter, you will see how to integrate OpenAI (or Azure OpenAI) into your Power BI solution for FAA Wildlife Strike data. Through this integration, you will be able to leverage GPT model APIs by adding new functions to Power BI dataflows. These functions will enable the generation of new content for each row of data in your solution. You will also use <strong class="bold">Cognitive Services</strong> in Power BI, which is an AI capability that has existed in Power Query and dataflows for a <span class="No-Break">few years.</span></p>
			<p>By the end of this chapter, you will have gained the knowledge necessary to apply GPT REST APIs in either OpenAI or Azure OpenAI to Power BI dataflows. These dataflows can then be refreshed on a predefined schedule. This capability will provide you with a powerful toolset for generating new content and insights from your data with minimal effort. The step-by-step instructions and examples provided in this chapter will equip you with the necessary skills to implement this solution in your <span class="No-Break">own projects.</span></p>
			<h1 id="_idParaDest-170"><a id="_idTextAnchor175"/>Technical requirements</h1>
			<p>For this chapter, you’ll need <span class="No-Break">the following:</span></p>
			<ul>
				<li>An account with the original open source <span class="No-Break">OpenAI: </span><a href="https://openai.com/"><span class="No-Break">https://openai.com/</span></a><span class="No-Break">.</span></li>
				<li>Optional – Azure OpenAI as part of your Azure subscription: <a href="https://azure.microsoft.com/en-us/products/cognitive-services/openai-service">https://azure.microsoft.com/en-us/products/cognitive-services/openai-service</a>. The book is written so that this is optional since it is not available to everyone at the time <span class="No-Break">of publication.</span></li>
				<li>FAA Wildlife Strike data files from either the FAA website or the Packt <span class="No-Break">GitHub site.</span></li>
				<li>A Power BI <span class="No-Break">Pro license.</span></li>
				<li>One of the following Power BI licensing options for access to Power <span class="No-Break">BI dataflows:</span><ul><li>Power <span class="No-Break">BI Premium</span></li><li>Power BI Premium <span class="No-Break">Per User</span></li></ul></li>
				<li>One of the following options for getting data into the Power BI <span class="No-Break">cloud service:</span><ul><li>Microsoft OneDrive (with connectivity to the Power BI <span class="No-Break">cloud service)</span></li><li>Microsoft Access + Power <span class="No-Break">BI Gateway</span></li><li>Azure Data Lake (with connectivity to the Power BI <span class="No-Break">cloud service)</span></li></ul></li>
			</ul>
			<h1 id="_idParaDest-171"><a id="_idTextAnchor176"/>Configuring OpenAI and Azure OpenAI for use in your Power BI solution</h1>
			<p>Prior to proceeding <a id="_idIndexMarker671"/>with the configuration <a id="_idIndexMarker672"/>of OpenAI and Azure <a id="_idIndexMarker673"/>OpenAI, it is important to note <a id="_idIndexMarker674"/>that OpenAI is still a nascent technology at the time of writing this book. In the future, the integration of OpenAI with Power BI may become less technical, as advancements in the technology continue to be made. However, the use cases that will be demonstrated in this chapter will <span class="No-Break">remain applicable.</span></p>
			<p>As such, the instructions provided in this chapter will showcase how this integration can be used to enhance your data analytics capabilities in the context of <span class="No-Break">Power BI.</span></p>
			<h2 id="_idParaDest-172"><a id="_idTextAnchor177"/>Configuring OpenAI</h2>
			<p>You can create <a id="_idIndexMarker675"/>an account in OpenAI (if you do not have one already) from this link: <a href="https://chat.openai.com/auth/login">https://chat.openai.com/auth/login</a>. At the time of writing, new accounts are granted trial credits to begin using OpenAI. If you run out of trial credits, or if the trial is no longer offered after this book has been written, you may need to pay for the use of OpenAI. Pricing <a id="_idIndexMarker676"/>details can be found at this <span class="No-Break">link: </span><a href="https://openai.com/pricing"><span class="No-Break">https://openai.com/pricing</span></a><span class="No-Break">.</span></p>
			<p>Once you have an OpenAI account, you will need to create an API key that will be used to authenticate <a id="_idIndexMarker677"/>your API calls. An API key can be easily created at this link: <a href="https://platform.openai.com/account/api-keys">https://platform.openai.com/account/api-keys</a>. Clicking on <strong class="bold">Create new secret key</strong> will allow you to create a new key for API calls that you make later in this chapter. This book will use <strong class="source-inline">abc123xyz</strong> as an example key for the sample code. Be sure to use the actual <strong class="bold">Key</strong> from OpenAI, and not the <span class="No-Break"><strong class="bold">Key Name</strong></span><span class="No-Break">.</span></p>
			<p>Once you have an account and an API key, you are ready to go with OpenAI for <span class="No-Break">this book!</span></p>
			<h2 id="_idParaDest-173"><a id="_idTextAnchor178"/>Configuring Microsoft Azure OpenAI</h2>
			<p>OpenAI is also available <a id="_idIndexMarker678"/>as a service in Microsoft Azure. By using the Microsoft Azure OpenAI Service, users can leverage large-scale AI models with the benefits of Azure, such as role-based access security, private networks, and comprehensive security tools that integrate with other Microsoft tools in Azure. Billing and governance can be centralized for large organizations to help ensure the responsible use <span class="No-Break">of AI.</span></p>
			<p>For the purposes of this book, Azure OpenAI is optional as an alternative to the original OpenAI. Azure OpenAI may not be available to everyone since it is a new technology with high demand. All of the content for the workshop can be done with either OpenAI or <span class="No-Break">Azure OpenAI.</span></p>
			<p>Instructions for setting up Azure OpenAI can be found at this link: <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/create-resource/">https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/create-resource/</a>. Once you’ve created a resource, you can also deploy a model per the instructions at that link. As noted in <a href="B19500_12.xhtml#_idTextAnchor165"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>, you will be using the <strong class="source-inline">text-davinci-003</strong> model for the workshop associated with this chapter. OpenAI is evolving rapidly, and you may be able to choose different models at the time you are reading this book. Take note of the following values when walking through these steps; they will be needed later in <span class="No-Break">this chapter:</span></p>
			<ul>
				<li><strong class="bold">Resource name</strong>: Note the name of your Azure OpenAI resource in your subscription. This book will use <strong class="source-inline">PBI_OpenAI_project</strong> for the examples in <span class="No-Break">this chapter.</span></li>
				<li><strong class="bold">Deployment name</strong>: This is the name of the resource for the <strong class="source-inline">text-davinci-003</strong> model deployment. This book will use <strong class="source-inline">davinci-PBIML</strong> for names of deployments in examples <span class="No-Break">of code.</span></li>
			</ul>
			<p>Next, you’ll need to create a key for your Azure OpenAI API calls. From your Azure OpenAI resource, named <strong class="source-inline">PBI_OpenAI_project</strong> for this book, go to <strong class="bold">Resource management</strong> | <strong class="bold">Keys and endpoint</strong>, and your keys will be on that page. This book will use <strong class="source-inline">abc123xyz</strong> as an <a id="_idIndexMarker679"/>example key for the <span class="No-Break">sample code.</span></p>
			<p>Once you have either OpenAI or Azure OpenAI set up and ready to go, you can add some new generative text capabilities to your project using FAA Wildlife <span class="No-Break">Strike data!</span></p>
			<h1 id="_idParaDest-174"><a id="_idTextAnchor179"/>Preparing a Power BI dataflow for OpenAI and Azure OpenAI</h1>
			<p>In <a href="B19500_12.xhtml#_idTextAnchor165"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>, you <a id="_idIndexMarker680"/>decided to use OpenAI for <a id="_idIndexMarker681"/>two use cases with your FAA <a id="_idIndexMarker682"/>Wildlife Strike <span class="No-Break">database </span><span class="No-Break"><a id="_idIndexMarker683"/></span><span class="No-Break">project:</span></p>
			<ul>
				<li>Generating descriptions of airplane models and the operator of the aircraft, for <span class="No-Break">each incident</span></li>
				<li>Summarizing the free text remarks provided in the report for <span class="No-Break">each incident</span></li>
			</ul>
			<p>Since OpenAI is still new at the time of writing this book, Power BI does not yet have connectors built into the product. But you can still call OpenAI and Azure OpenAI APIs from both Power Query and Power BI dataflows using custom M scripts. Let’s <span class="No-Break">get started!</span></p>
			<p>First, you will create <a id="_idIndexMarker684"/>a new dataflow for use with OpenAI <a id="_idIndexMarker685"/>and Cognitive Services in <span class="No-Break">Power BI:</span></p>
			<ol>
				<li>From <a id="_idIndexMarker686"/>your Power BI workspace, on <a id="_idIndexMarker687"/>the ribbon, select <strong class="bold">New</strong> | <span class="No-Break"><strong class="bold">Dataflow</strong></span><span class="No-Break">.</span></li>
				<li>Select <strong class="bold">Define new tables</strong> | <strong class="bold">Link tables from </strong><span class="No-Break"><strong class="bold">other dataflows</strong></span><span class="No-Break">.</span></li>
				<li>Sign in and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Next</strong></span><span class="No-Break">.</span></li>
				<li>Expand <span class="No-Break">your workspace.</span></li>
				<li>Expand the <strong class="bold">Strike Reports</strong> dataflow and check <strong class="bold">Strike Reports </strong><span class="No-Break"><strong class="bold">Curated New</strong></span><span class="No-Break">.</span></li>
				<li>Click <span class="No-Break"><strong class="bold">Transform Data</strong></span><span class="No-Break">.</span></li>
				<li>Create a group named <strong class="bold">Sources</strong> and move <strong class="bold">Strike Reports Curated New</strong> into <span class="No-Break">that group.</span></li>
				<li>Right-click <strong class="bold">Strike Reports Curated New</strong> and unselect <span class="No-Break"><strong class="bold">Enable load</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p>Next, you will create a version of the query that will be used with OpenAI and <span class="No-Break">Cognitive Services:</span></p>
			<ol>
				<li>Right-click on <strong class="bold">Strike Reports Curated New</strong> and <span class="No-Break">select </span><span class="No-Break"><strong class="bold">Reference</strong></span><span class="No-Break">.</span></li>
				<li>Rename the new query <strong class="source-inline">Strike Reports Curated </strong><span class="No-Break"><strong class="source-inline">New OpenAI</strong></span><span class="No-Break">.</span></li>
				<li>Create a group named <strong class="bold">OpenAI</strong> and move <strong class="bold">Strike Reports Curated New OpenAI</strong> into <span class="No-Break">the group.</span></li>
			</ol>
			<p>In <a href="B19500_12.xhtml#_idTextAnchor165"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>, you decided to use the FAA Wildlife Strike <strong class="bold">Operator</strong>, <strong class="bold">Aircraft</strong>, <strong class="bold">Species</strong>, and <strong class="bold">Remarks</strong> database columns as part of your OpenAI prompts. Filtering out blank and unknown values from <strong class="bold">Strike Reports Curated New OpenAI</strong> will help produce better results for your testing. Note that you may need to select <strong class="bold">Load more...</strong> if the values all come up empty <span class="No-Break">or </span><span class="No-Break"><strong class="source-inline">UNKNOWN</strong></span><span class="No-Break">:</span></p>
			<ol>
				<li>For the <strong class="bold">Operator</strong> column, filter out the <strong class="source-inline">UNKNOWN</strong>, <strong class="source-inline">UNKNOWN COMMERCIAL</strong>, <strong class="source-inline">BUSINESS</strong>, and <strong class="source-inline">PRIVATELY </strong><span class="No-Break"><strong class="source-inline">OWNED</strong></span><span class="No-Break"> values.</span></li>
				<li>For the <strong class="bold">Aircraft</strong> column, filter <span class="No-Break">out </span><span class="No-Break"><strong class="source-inline">UNKNOWN</strong></span><span class="No-Break">.</span></li>
				<li>For the <strong class="bold">Species</strong> column, filter out <strong class="source-inline">Unknown bird</strong>, <strong class="source-inline">Unknown bird – large</strong>, <strong class="source-inline">Unknown bird – medium</strong>, <strong class="source-inline">Unknown bird – small</strong>, and <strong class="source-inline">Unknown bird </strong><span class="No-Break"><strong class="source-inline">or bat</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p>For the <strong class="bold">Remarks</strong> column, filter <span class="No-Break">out </span><span class="No-Break"><strong class="source-inline">(blank)</strong></span><span class="No-Break">.</span></p>
			<p>Finally – this step is <a id="_idIndexMarker688"/>optional – you can filter the number <a id="_idIndexMarker689"/>of rows for testing purposes. Both OpenAI <a id="_idIndexMarker690"/>and Azure OpenAI can run <a id="_idIndexMarker691"/>up a bill, so limiting the number of calls for this workshop makes sense. For the example in this book, the <strong class="bold">Strike Reports Curated New OpenAI</strong> table will be filtered to events happening in or after December 2022, which can be filtered using the <strong class="bold">Incident </strong><span class="No-Break"><strong class="bold">Date</strong></span><span class="No-Break"> column.</span></p>
			<p>Now you are ready to add OpenAI and Cognitive Services content to <span class="No-Break">your data!</span></p>
			<h1 id="_idParaDest-175"><a id="_idTextAnchor180"/>Creating OpenAI and Azure OpenAI functions in Power BI dataflows</h1>
			<p>As noted earlier, integrating OpenAI and Azure OpenAI with Power Query or dataflows currently <a id="_idIndexMarker692"/>requires custom <a id="_idIndexMarker693"/>M code. To facilitate this process, we <a id="_idIndexMarker694"/>have provided M code for <a id="_idIndexMarker695"/>both OpenAI and Azure OpenAI, giving you the flexibility to choose which version to use based on your specific needs <span class="No-Break">and requirements.</span></p>
			<p>By leveraging this provided M code, you can seamlessly integrate OpenAI or Azure OpenAI with your existing Power BI solutions. This will allow you to take advantage of the unique <a id="_idIndexMarker696"/>features and capabilities <a id="_idIndexMarker697"/>offered by these powerful AI <a id="_idIndexMarker698"/>technologies, while also gaining <a id="_idIndexMarker699"/>insights and generating new content from your data <span class="No-Break">with ease.</span></p>
			<h2 id="_idParaDest-176"><a id="_idTextAnchor181"/>OpenAI and Azure OpenAI functions</h2>
			<p>OpenAI offers a <a id="_idIndexMarker700"/>user-friendly API that can be easily accessed and utilized <a id="_idIndexMarker701"/>from within Power Query or dataflows in Power BI. For further information regarding the specifics of the API, we refer you to the official OpenAI documentation, available at this <span class="No-Break">link: </span><a href="https://platform.openai.com/docs/introduction/overview"><span class="No-Break">https://platform.openai.com/docs/introduction/overview</span></a><span class="No-Break">.</span></p>
			<p>It is worth noting that optimizing and tuning the OpenAI API will likely be a popular topic in the coming year. Various concepts, including <strong class="bold">prompt engineering</strong>, <strong class="bold">optimal token usage</strong>, fine-tuning, embeddings, plugins, and parameters that modify response creativity (such as temperature and top <em class="italic">p</em>), can all be tested and fine-tuned for <span class="No-Break">optimal results.</span></p>
			<p>While these topics are complex and may be explored in greater detail in future works, this book will focus primarily on establishing connectivity between OpenAI and Power BI. Specifically, we will explore prompt engineering and token limits, which are key considerations that will be incorporated into the API call to ensure <span class="No-Break">optimal performance:</span></p>
			<ul>
				<li><strong class="bold">Prompts</strong>: Prompt engineering, in basic terms, is the English-language text that will be used to preface every <a id="_idIndexMarker702"/>API call. For example, instead of sending <strong class="source-inline">[Operator]</strong> and <strong class="source-inline">[Airplane]</strong> as values without context, text was added to the request in the previous chapter such that the API will receive <strong class="source-inline">Tell me about the airplane model [Aircraft] operated by [Operator] in three sentences:</strong>. The prompt adds context to the values passed to the <span class="No-Break">OpenAI model.</span></li>
				<li><strong class="bold">Tokens</strong>: Words sent to <a id="_idIndexMarker703"/>the OpenAI model get broken into chunks called tokens. Per the OpenAI website, a token contains about four English language characters. Reviewing the <strong class="bold">Remarks</strong> column in the Power BI dataset reveals that most entries have up to 2,000 characters. (2000 / 4) = 500, so you will specify 500 <a id="_idIndexMarker704"/>as the token limit. Is that the right number? You’d need to do extensive testing to answer that question, which goes beyond the scope of <span class="No-Break">this book.</span></li>
			</ul>
			<p>Let’s get started with building your OpenAI and Azure OpenAI API calls for Power <span class="No-Break">BI dataflows!</span></p>
			<h2 id="_idParaDest-177"><a id="_idTextAnchor182"/>Creating OpenAI and Azure OpenAI functions for Power BI dataflows</h2>
			<p>You will create <a id="_idIndexMarker705"/>two functions for OpenAI in your <a id="_idIndexMarker706"/>dataflow <a id="_idIndexMarker707"/>named <strong class="bold">OpenAI</strong>. The only difference <a id="_idIndexMarker708"/>between the two will be the token limits. The purpose of having different token limits is primarily cost savings, since larger token limits could potentially run up a bigger bill. Follow these steps to create a new function <span class="No-Break">named </span><span class="No-Break"><strong class="bold">OpenAIshort</strong></span><span class="No-Break">:</span></p>
			<ol>
				<li>Select <strong class="bold">Get data</strong> | <span class="No-Break"><strong class="bold">Blank query</strong></span><span class="No-Break">.</span></li>
				<li>Paste in the following M code and select <strong class="bold">Next</strong>. Be sure to replace <strong class="source-inline">abc123xyz</strong> with your OpenAI <span class="No-Break">API key.</span></li>
			</ol>
			<p>Here is the code for the function. The code can also be found as <strong class="source-inline">01 OpenAIshortFunction.M</strong> in the Packt GitHub repository <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Unleashing-Your-Data-with-Power-BI-Machine-Learning-and-OpenAI/tree/main/Chapter-13"><span class="No-Break">https://github.com/PacktPublishing/Unleashing-Your-Data-with-Power-BI-Machine-Learning-and-OpenAI/tree/main/Chapter-13</span></a><span class="No-Break">:</span></p>
			<pre class="source-code">
let
    callOpenAI = (prompt as text) as text =&gt;
        let
            jsonPayload = "{""prompt"": """ &amp; prompt &amp; """,            ""max_tokens"": " &amp; Text.From(120) &amp; "}",
            url = "https://api.openai.com/v1/engines/            text-davinci-003/completions",
            headers = [#"Content-Type"="application/json",             #"Authorization"="Bearer abc123xyz"],
            response = Web.Contents(url, [Headers=headers,             Content=Text.ToBinary(jsonPayload)]),
            jsonResponse = Json.Document(response),
            choices = jsonResponse[choices],
            text = choices{0}[text]
        in
            text
in
    callOpenAI</pre>
			<ol>
				<li value="3">Now, you <a id="_idIndexMarker709"/>can rename the <a id="_idIndexMarker710"/>function <strong class="source-inline">OpenAIshort</strong>. Right-click on the function in the <strong class="bold">Queries</strong> panel and duplicate it. The <a id="_idIndexMarker711"/>new function will have a <a id="_idIndexMarker712"/>larger <span class="No-Break">token limit.</span></li>
				<li>Rename this new <span class="No-Break">function </span><span class="No-Break"><strong class="source-inline">OpenAIlong</strong></span><span class="No-Break">.</span></li>
				<li>Right-click on <strong class="bold">OpenAIlong</strong> and select <span class="No-Break"><strong class="bold">Advanced editor</strong></span><span class="No-Break">.</span></li>
				<li>Change the section of code reading <strong class="source-inline">Text.From(120)</strong> <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">Text.From(500)</strong></span><span class="No-Break">.</span></li>
				<li><span class="No-Break">Click </span><span class="No-Break"><strong class="bold">OK</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p>Your screen should now look <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer207" class="IMG---Figure">
					<img src="image/Figure_13.1_B19500.jpg" alt="Figure 13.1 – OpenAI functions added to a Power BI dataflow"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.1 – OpenAI functions added to a Power BI dataflow</p>
			<p>These two functions <a id="_idIndexMarker713"/>can be used to complete <a id="_idIndexMarker714"/>the workshop for the remainder <a id="_idIndexMarker715"/>of this chapter. If you’d prefer to <a id="_idIndexMarker716"/>use Azure OpenAI, the M code for <strong class="bold">OpenAIshort</strong> would be as follows. Remember to replace <strong class="source-inline">PBI_OpenAI_project</strong> with your Azure resource name, <strong class="source-inline">davinci-PBIML</strong> with your deployment name, and <strong class="source-inline">abc123xyz</strong> with your <span class="No-Break">API key:</span></p>
			<pre class="source-code">
let
    callAzureOpenAI = (prompt as text) as text =&gt;
        let
            jsonPayload = "{""prompt"": """ &amp; prompt &amp; """,             ""max_tokens"": " &amp; Text.From(120) &amp; "}"
            url = "https://" &amp; "PBI_OpenAI_project" &amp; ".openai.azure.            com" &amp; "/openai/deployments/" &amp; "davinci-PBIML" &amp; "/            completions?api-version=2022-12-01",
            headers = [#"Content-Type"="application/json",             #"api-key"="abc123xyz"],
            response = Web.Contents(url, [Headers=headers,             Content=Text.ToBinary(jsonPayload)]),
            jsonResponse = Json.Document(response),
            choices = jsonResponse[choices],
            text = choices{0}[text]
        in
            text
in
    callAzureOpenAI</pre>
			<p>As with the <a id="_idIndexMarker717"/>previous example, changing <a id="_idIndexMarker718"/>the token limit for <strong class="source-inline">Text.From(120)</strong> to <strong class="source-inline">Text.From(500)</strong> is all you need to do to create an Azure OpenAI <a id="_idIndexMarker719"/>function for 500 tokens instead of 120. The <a id="_idIndexMarker720"/>M code to create the dataflows for your OpenAI functions can also be found on the Packt GitHub site at this <span class="No-Break">link: </span><a href="https://github.com/PacktPublishing/Unleashing-Your-Data-with-Power-BI-Machine-Learning-and-OpenAI/tree/main/Chapter-13"><span class="No-Break">https://github.com/PacktPublishing/Unleashing-Your-Data-with-Power-BI-Machine-Learning-and-OpenAI/tree/main/Chapter-13</span></a><span class="No-Break">.</span></p>
			<p>Now that you have your OpenAI and Azure OpenAI functions ready to go in a Power BI dataflow, you can test them out on the FAA Wildlife <span class="No-Break">Strike data!</span></p>
			<h1 id="_idParaDest-178"><a id="_idTextAnchor183"/>Using OpenAI and Azure OpenAI functions in Power BI dataflows</h1>
			<p>Your next step <a id="_idIndexMarker721"/>is to prep the FAA Wildlife Strike data <a id="_idIndexMarker722"/>for the OpenAI or <a id="_idIndexMarker723"/>Azure OpenAI functions to do <a id="_idIndexMarker724"/>content generation and summarization. As discussed previously, you’ll need to build effective prompts to provide context for the OpenAI models to process. The completed query for <strong class="bold">Reports Curated New OpenAI</strong>, which can be copied and pasted into Power BI, is also available from the Packt GitHub <span class="No-Break">repository: </span><a href="https://github.com/PacktPublishing/Unleashing-Your-Data-with-Power-BI-Machine-Learning-and-OpenAI/tree/main/Chapter-13"><span class="No-Break">https://github.com/PacktPublishing/Unleashing-Your-Data-with-Power-BI-Machine-Learning-and-OpenAI/tree/main/Chapter-13</span></a><span class="No-Break">.</span></p>
			<p>Looking back to <a href="B19500_12.xhtml#_idTextAnchor165"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>, you decided upon the following combinations of new text with row-level content from the FAA Wildlife <span class="No-Break">Strike database:</span></p>
			<ul>
				<li>Generating new information about airplanes and the carriers: <strong class="source-inline">Tell me about the airplane model [Aircraft] operated by [Operator] in </strong><span class="No-Break"><strong class="source-inline">three sentences:</strong></span></li>
				<li>Summarizing the remarks from each report, including the operator, aircraft, and species: <strong class="source-inline">Summarize the following: A [Operator] [Aircraft] struck a [Species]. Remarks on the FAA report </strong><span class="No-Break"><strong class="source-inline">were: [Remarks]</strong></span></li>
			</ul>
			<p>You can now <a id="_idIndexMarker725"/>add two new columns <a id="_idIndexMarker726"/>to the <strong class="bold">Strike Reports Curated New OpenAI</strong> query. First, you <a id="_idIndexMarker727"/>add a column <a id="_idIndexMarker728"/>to prompt <span class="No-Break">text generation:</span></p>
			<ol>
				<li>Select <strong class="bold">Add column</strong> | <span class="No-Break"><strong class="bold">Custom Column</strong></span><span class="No-Break">.</span></li>
				<li>Set <strong class="bold">New column name</strong> to <strong class="source-inline">Text </strong><span class="No-Break"><strong class="source-inline">Generation Prompt</strong></span><span class="No-Break">.</span></li>
				<li>Paste in the following text: <strong class="source-inline">"Tell me about the airplane model " &amp; [Aircraft] &amp;" operated by " &amp; [Operator] &amp; " in three sentences:"</strong>. Then, <span class="No-Break">select </span><span class="No-Break"><strong class="bold">OK</strong></span><span class="No-Break">.</span></li>
				<li>Change the data type <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">Text</strong></span><span class="No-Break">.</span></li>
				<li>Validate that the new column creates text to be used as information with built-in prompts that look <span class="No-Break">like this:</span></li>
			</ol>
			<div>
				<div id="_idContainer208" class="IMG---Figure">
					<img src="image/Figure_13.2_B19500.jpg" alt="Figure 13.2 – New column to be used with OpenAI"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.2 – New column to be used with OpenAI</p>
			<p>Now create a <a id="_idIndexMarker729"/>second column that will be <a id="_idIndexMarker730"/>used for text summarization <a id="_idIndexMarker731"/>that also contains <a id="_idIndexMarker732"/><span class="No-Break">built-in prompts:</span></p>
			<ol>
				<li>Select <strong class="bold">Add column</strong> | <span class="No-Break"><strong class="bold">Custom Column</strong></span><span class="No-Break">.</span></li>
				<li>Set <strong class="bold">New column name</strong> to <strong class="source-inline">Text </strong><span class="No-Break"><strong class="source-inline">Summarization Prompt</strong></span><span class="No-Break">.</span></li>
				<li>Paste in the following text: <strong class="source-inline">"Summarize the following: A " &amp; [Operator] &amp; " " &amp; [Aircraft] &amp; " struck a " &amp; [Species] &amp; ". Remarks on the FAA report were: " &amp; [</strong><span class="No-Break"><strong class="source-inline">Remarks]</strong></span><span class="No-Break">.</span></li>
				<li>Change the data type <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">Text</strong></span><span class="No-Break">.</span></li>
				<li>Validate that the new column for summarization, with a built-in prompt, looks <span class="No-Break">like this:</span></li>
			</ol>
			<div>
				<div id="_idContainer209" class="IMG---Figure">
					<img src="image/Figure_13.3_B19500.jpg" alt="Figure 13.3 – New column for summarizations with built-in prompt"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.3 – New column for summarizations with built-in prompt</p>
			<p>Now you’ve <a id="_idIndexMarker733"/>created two columns in your <a id="_idIndexMarker734"/>Power BI dataflow query that are <a id="_idIndexMarker735"/>ready for OpenAI <a id="_idIndexMarker736"/>functions! Start by calling OpenAI using the <strong class="source-inline">OpenAIshort</strong> function for <span class="No-Break">text generation:</span></p>
			<ol>
				<li>Select <strong class="bold">Add column</strong> | <span class="No-Break"><strong class="bold">Custom Column</strong></span><span class="No-Break">.</span></li>
				<li>Set <strong class="bold">New column name</strong> to <strong class="source-inline">OpenAI </strong><span class="No-Break"><strong class="source-inline">Aircraft Description</strong></span><span class="No-Break">.</span></li>
				<li>Paste the following text into <strong class="bold">Custom column formula</strong>: <strong class="source-inline">OpenAIshort([Text </strong><span class="No-Break"><strong class="source-inline">Generation Prompt])</strong></span><span class="No-Break">.</span></li>
				<li><span class="No-Break">Click </span><span class="No-Break"><strong class="bold">OK</strong></span><span class="No-Break">.</span></li>
				<li>Validate that OpenAI generated text for the new column. You can hover over a field in the new column to read the <span class="No-Break">full text:</span></li>
			</ol>
			<div>
				<div id="_idContainer210" class="IMG---Figure">
					<img src="image/Figure_13.4_B19500.jpg" alt="Figure 13.4 – OpenAI generated a description of the aircraft for that operator with new data from outside the FAA Wildlife Strike database"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.4 – OpenAI generated a description of the aircraft for that operator with new data from outside the FAA Wildlife Strike database</p>
			<p>Repeating the <a id="_idIndexMarker737"/>preceding steps for text <a id="_idIndexMarker738"/>summarization of the <strong class="bold">Remarks </strong>column <a id="_idIndexMarker739"/>is next using <a id="_idIndexMarker740"/>the <span class="No-Break"><strong class="source-inline">OpenAIlong</strong></span><span class="No-Break"> function:</span></p>
			<ol>
				<li>Select <strong class="bold">Add column</strong> | <span class="No-Break"><strong class="bold">Custom Column</strong></span><span class="No-Break">.</span></li>
				<li>Set <strong class="bold">New column name</strong> to <strong class="source-inline">OpenAI </strong><span class="No-Break"><strong class="source-inline">Remarks Summarization</strong></span><span class="No-Break">.</span></li>
				<li>Paste the following text into <strong class="bold">Custom column formula</strong>: <strong class="source-inline">OpenAIlong([Text </strong><span class="No-Break"><strong class="source-inline">Summarization Prompt])</strong></span><span class="No-Break">.</span></li>
				<li><span class="No-Break">Click </span><span class="No-Break"><strong class="bold">OK</strong></span><span class="No-Break">.</span></li>
				<li>Validate that OpenAI generated text for the new column, and again you can hover over a field to view the <span class="No-Break">full summarization:</span></li>
			</ol>
			<div>
				<div id="_idContainer211" class="IMG---Figure">
					<img src="image/Figure_13.5_B19500.jpg" alt="Figure 13.5 – Text summarization for remarks about aircraft hitting wildlife"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.5 – Text summarization for remarks about aircraft hitting wildlife</p>
			<p>You’ve done it! OpenAI was <a id="_idIndexMarker741"/>successfully <a id="_idIndexMarker742"/>used to both generate <a id="_idIndexMarker743"/>new information about aircraft <a id="_idIndexMarker744"/>and summarize the free text remarks about wildlife strike incidents. You might want to save your dataflow at this point so that you don’t lose <span class="No-Break">any work.</span></p>
			<h1 id="_idParaDest-179"><a id="_idTextAnchor184"/>Adding a Cognitive Services function to the solution</h1>
			<p>Finally, you decide to <a id="_idIndexMarker745"/>add more value to the deliverables by showcasing the Cognitive Services capabilities in Power BI. In both Power BI Desktop and Power BI dataflows, Cognitive Services is built in as part of the SaaS tool. Details <a id="_idIndexMarker746"/>about using Cognitive Services in Power BI can be found at this <span class="No-Break">link: </span><a href="https://learn.microsoft.com/en-us/power-bi/connect-data/service-tutorial-use-cognitive-services"><span class="No-Break">https://learn.microsoft.com/en-us/power-bi/connect-data/service-tutorial-use-cognitive-services</span></a><span class="No-Break">.</span></p>
			<p>Cognitive Services refers to <a id="_idIndexMarker747"/>Azure services that can be called using APIs to score data with standard ML models. These tools can score the sentiment of text, identify images, extract key phrases, detect emotion in pictures, and more. The following Cognitive Services features are <a id="_idIndexMarker748"/>native to Power BI at the time of writing <span class="No-Break">this book:</span></p>
			<ul>
				<li><span class="No-Break"><strong class="bold">Detect Language</strong></span></li>
				<li><span class="No-Break"><strong class="bold">Tag Images</strong></span></li>
				<li><span class="No-Break"><strong class="bold">Score Sentiment</strong></span></li>
				<li><strong class="bold">Extract </strong><span class="No-Break"><strong class="bold">Key Phrases</strong></span></li>
			</ul>
			<p>For this final addition <a id="_idIndexMarker749"/>to the project, you will use the Score Sentiment function on the <strong class="bold">Remarks</strong> column of the FAA Wildlife Strike database. The scores typically range from <strong class="source-inline">0</strong> to <strong class="source-inline">1</strong>, with <strong class="source-inline">0</strong> being negative, <strong class="source-inline">0.5</strong> being neutral, and <strong class="source-inline">1</strong> <span class="No-Break">being positive.</span></p>
			<p>Opening back <a id="_idIndexMarker750"/>up your <strong class="bold">OpenAI</strong> dataflow, navigate to the query for <strong class="bold">Strike Reports Curated New OpenAI</strong> and follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li>Highlight the <span class="No-Break"><strong class="bold">Remarks</strong></span><span class="No-Break"> column.</span></li>
				<li>Navigate to <strong class="bold">Home</strong> | <strong class="bold">Insights</strong> | <span class="No-Break"><strong class="bold">AI Insights</strong></span><span class="No-Break">.</span></li>
				<li>Sign in and an <strong class="bold">AI Insights</strong> window will <span class="No-Break">pop up.</span></li>
				<li>Notice that Cognitive Services is available, along with the Power BI ML models that you created! You can also use this capability to reuse your Power BI ML models to score multiple columns of data in <span class="No-Break">different dataflows.</span></li>
			</ol>
			<div>
				<div id="_idContainer212" class="IMG---Figure">
					<img src="image/Figure_13.6_B19500.jpg" alt="Figure 13.6 – Cognitive Services and Power BI ML models can be called as functions"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.6 – Cognitive Services and Power BI ML models can be called as functions</p>
			<ol>
				<li value="5"><span class="No-Break">Select </span><span class="No-Break"><strong class="bold">CognitiveServices.ScoreSentiment</strong></span><span class="No-Break">.</span></li>
				<li>Select the <strong class="bold">Remarks</strong> column from the dropdown and <span class="No-Break">hit </span><span class="No-Break"><strong class="bold">Apply</strong></span><span class="No-Break">.</span></li>
				<li>Change <a id="_idIndexMarker751"/>the data type to <span class="No-Break"><strong class="source-inline">decimal number</strong></span><span class="No-Break">.</span></li>
				<li>Validate that the sentiment was scored and added as a <span class="No-Break">new column:</span></li>
			</ol>
			<div>
				<div id="_idContainer213" class="IMG---Figure">
					<img src="image/Figure_13.7_B19500.jpg" alt="Figure 13.7 – Sentiment scores for the Remarks column"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.7 – Sentiment scores for the Remarks column</p>
			<p>You can now <a id="_idIndexMarker752"/>save and refresh your dataflow, and you’re done! When the dataflow has refreshed, you can connect from Power BI Desktop and browse the results of <span class="No-Break">your work:</span></p>
			<div>
				<div id="_idContainer214" class="IMG---Figure">
					<img src="image/Figure_13.8_B19500.jpg" alt="Figure 13.8 – Results of OpenAI and Cognitive Services viewed in Power BI"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.8 – Results of OpenAI and Cognitive Services viewed in Power BI</p>
			<p>To make <a id="_idIndexMarker753"/>it easier to read, <span class="No-Break"><em class="italic">Figure 13</em></span><em class="italic">.8</em> is split into two images. <span class="No-Break"><em class="italic">Figure 13</em></span><em class="italic">.9</em> shows the left <span class="No-Break">hand columns.</span></p>
			<div>
				<div id="_idContainer215" class="IMG---Figure">
					<img src="image/Figure_13.9_B19500.jpg" alt="Figure 13.9 – Results of OpenAI and Cognitive Services viewed in Power BI"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.9 – Results of OpenAI and Cognitive Services viewed in Power BI</p>
			<p>The right-hand <a id="_idIndexMarker754"/>column is shown in <span class="No-Break"><em class="italic">Figure 13</em></span><span class="No-Break"><em class="italic">.10</em></span><span class="No-Break">.</span></p>
			<div>
				<div id="_idContainer216" class="IMG---Figure">
					<img src="image/Figure_13.10_B19500.jpg" alt="Figure 13.10 – Results of OpenAI and Cognitive Services viewed in Power BI"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.10 – Results of OpenAI and Cognitive Services viewed in Power BI</p>
			<p>Once you have gained a solid understanding of how to implement various tools and services within Power BI, such as Cognitive Services provided by OpenAI or Azure OpenAI, you can experiment with different prompt strategies and explore a wide range of <span class="No-Break">additional capabilities.</span></p>
			<p>By leveraging the <a id="_idIndexMarker755"/>knowledge and skills gained from this book, you will be equipped to test new ideas, fine-tune your approaches, and optimize the performance of your solutions. With these tools at your disposal, the possibilities for enhancing your data analytics and content generation capabilities within Power BI are virtually limitless. So, don’t be afraid to dive in and explore all that these powerful technologies have <span class="No-Break">to offer!</span></p>
			<h1 id="_idParaDest-180"><a id="_idTextAnchor185"/>Summary</h1>
			<p>This chapter covered the integration of OpenAI or Azure OpenAI with Power BI, along with a use case for Power BI Cognitive Services. By leveraging these advanced tools, you were able to generate new descriptions of airplanes using external data and GPT models, summarize remarks about wildlife strikes, and even score the remarks for <span class="No-Break">sentiment analysis.</span></p>
			<p>Moving forward, the next and final chapter will provide an opportunity to review and reflect on the work accomplished throughout this book and the accompanying workshop. We will also begin to explore new strategies for enhancing and expanding upon the existing project, as we recognize that projects are never truly complete if there is still potential for additional value to <span class="No-Break">be achieved.</span></p>
		</div>
	</body></html>
<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Causal Inference</h1>
                </header>
            
            <article>
                
<p class="mce-root"> In this final chapter, we will learn about the following topics:</p>
<ul>
<li>Granger causality in time series (econometric approach to causality)</li>
<li>Graphical models causality</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Granger causality</h1>
                </header>
            
            <article>
                
<p>In time series, we typically use univariate data. That is, we use a single series to predict its future values. Let's say that we are studying Google's stock price data, and we are asked to forecast the future values of stock prices. In this case, we will need historic data of Google's stock prices. Based on that, we will make predictions.</p>
<p>However, at times, we need multiple time series to make a forecast. But why is it that we need multiple time series? Any guesses?</p>
<p>The following graph shows <span>Google's stock price data:</span></p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-611 image-border" src="assets/dcfb259b-6986-47e2-958a-4f8424f6c745.png" style="width:35.33em;height:19.50em;"/></p>
<p>The answer is that we need to understand and explore the relationship between multiple time series as this can improve our forecast. For example, we have got correlated time series of <strong>GDP Deflator: Services</strong> and <strong>WPI: All Commodities</strong>, as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-613 image-border" src="assets/5ac9b772-c549-4d12-9691-19065159518f.png" style="width:58.83em;height:22.83em;"/></p>
<p class="mce-root"/>
<p>It is quite evident that these two seem to carry a relationship. When we have to forecast <strong>GDP Deflator: Services</strong>, we can use <strong>WPI: All Commodities</strong> time series data as input. This is called <strong>Granger causality</strong>.</p>
<p>To put it more aptly, Granger causality is one of the ways to investigate causality between two variables in a time series. This method is a probabilistic account of causality.</p>
<p>Even though we are talking about causality here, it isn't exactly the same. Typically, causality is associated with a situation where variable <em>1</em> is the cause of variable 2 or vice versa. However, with Granger causality, we do not test a true cause and effect relationship. The fundamental reason to know is whether <strong>a particular variable comes before another</strong> in the time series. </p>
<p>You aren't testing a true cause and effect relationship. What you want to know is whether <strong>a particular variable comes before another</strong> in the time series. That is to say, if we find Granger causality in the data, then there isn't any causal link in the true sense of the word. </p>
<div class="packt_infobox">When econometricians say cause, what they mean is Granger-cause, although a more appropriate word might be precedence. Granger causality was proposed by a Nobel laureate in Economics, Prof Clive Granger, in 2003.</div>
<p>Let's look at one more example. Here, we have GDP per capita for OECD nations. We can see that the number of OECD countries have a similar growth and pattern in GDP. We can assume that these countries are responsible for each other's GDP growth due to dependencies.</p>
<p>The following is a graph that shows <span>GDP per capita for OECD countries:</span></p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-616 image-border" src="assets/64a5d92a-f8d2-4e59-af45-6993f3a8fb3d.png" style="width:37.67em;height:22.75em;"/></p>
<p>We can utilize the series of one country to forecast for another one. More often than not, this kind of relationship is prevalent more in financial time series. The stock market of India, NSE/BSE, and so on may have an impact on NYSE. Therefore, NYSE indices can be used to make a forecast for NSE indices.</p>
<p>Let's infuse a bit of mathematics into this. Let's say there are two time series, <em>X(t)</em> and <em>Y(t)</em>. If the past values of <em>X(t)</em> are helping to predict the future values of <em>Y(t)</em>, it is said that <em>X(t)</em> Granger causes <em>Y(t)</em>.</p>
<p>So, <em>Y(t)</em> is a function of the lag of <em>Y(t)</em> and also of the lag of <em>X(t)</em>. It can be expressed as as follows:</p>
<p class="CDPAlignCenter CDPAlign"><em>Y(t) = f(Yt-p, Xt-p)</em></p>
<p>However, this only holds true in the following situations:</p>
<ul>
<li>Cause takes place prior to effect. What this means is that <em>Y(t) = f(Xt-1)</em>,</li>
<li>Cause has got significant information about the future values of its effect, for example:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><em>Y(t) = a1 Yt-1 + b1 Xt-1 + error</em></p>
<p><em>Xt-1</em> is adding an extra effect on <em>Y(t)</em>. The magnitude of effect is decided by <em>b1</em>.</p>
<p>Let's say we have two equations:</p>
<p class="CDPAlignCenter CDPAlign"><em>Yt= a0+ a1* Yt-1</em></p>
<p class="CDPAlignCenter CDPAlign"><em>Yt= a0 + a1*Yt-1 + a2*Xt-1</em></p>
<p>The null hypothesis here is as follows:</p>
<ul>
<li><em>H0: a2=0</em>: What this means is that there is no effect of other series, where <em>Xt-1</em> on <em>Yt</em></li>
</ul>
<p>The alternate hypothesis here is as follows::</p>
<ul>
<li><em>H1: a2≠ 0</em>: What this means is that there is a significant effect of other series, where <em>Xt-1</em> on <em>Yt</em></li>
</ul>
<p>We run a t-test to determine whether there is a significant effect of other series of <em>Xt-1</em> on <em>Yt</em>.</p>
<p>If the null hypothesis is rejected, we can say that it is a case of Granger causality.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">F-test</h1>
                </header>
            
            <article>
                
<p>The basic steps for running this test are as follows:</p>
<ol>
<li>Formulate the null hypothesis and its alternative. </li>
<li>Choose the lags. These can depend on the amount of data you have. One way to choose lags i and j is to run a model order test. It would be easier to pick up multiple values and run the Granger test to see if the results are the similar for different lag levels.</li>
</ol>
<ol start="3">
<li>Also identify the f-value. The two equations can be used to find out whether <em>βj = 0</em> for all lags <em>j</em>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Limitations</h1>
                </header>
            
            <article>
                
<p>The different limitations of this approach are as follows:</p>
<ul>
<li>Granger causality is not a true causality</li>
<li>If <em>X(t)</em> affects <em>Y(t)</em> through a third variable, <em>Z(t)</em>, then it is difficult to find Granger causality</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Use case</h1>
                </header>
            
            <article>
                
<p>Here, we have a multivariate time series dataset called <kbd>AirQualityUCI</kbd>. We have to test whether NOx has a Granger causality of NO2.</p>
<p>Since we don't have a library in Python for multivariate Granger causality, we will do this in R by using the <kbd>lmtest</kbd> package.</p>
<p>Load the <kbd>lmtest</kbd> library. In case the library isn't there, you will need to install it, as follows:</p>
<pre>install.packages("lmtest")<br/>library(lmtest)</pre>
<p>Load the data. Then, make use of the <kbd>grangertest</kbd> function to find out whether there is any significant relationship between NOx and NO2:</p>
<pre class="mce-root">data= read.csv("AirQualityUCI.csv")<br/>grangertest(NOx.GT. ~ NO2.GT., order = 3, data = data)</pre>
<p>The output for this is as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-614 image-border" src="assets/6f859784-a489-4873-a8db-ba5a66b51d3a.png" style="width:33.08em;height:9.08em;"/></p>
<p>So, the f-test has become significant, which means that the coefficients of lagged NO2 have a significant impact on NOx.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Graphical causal models</h1>
                </header>
            
            <article>
                
<p>This model was covered in detail in <a href="64be9aad-a25e-4ea4-abbb-bc8ff4cbbe1a.xhtml" target="_blank">Chapter 8</a><em>, <span>Probabilistic Graphical Models</span></em>. We will also look into it briefly here, too.</p>
<p>Bayesian networks are directed acyclic graphs (DAGs) where the nodes represent variables of interest (for example, the temperature of a device, the gender of a patient, a feature of an object, the occurrence of an event, and so on). Causal influences among the variables are represented using links. The strength of an influence can be potrayed by conditional probabilities that are linked to each cluster of the parent-child nodes in the network. In the following diagram we can see the causal models, that have a node and an edge:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-615 image-border" src="assets/620df37b-3981-4203-b6d5-c1e7bc97b31f.png" style="width:13.67em;height:4.17em;"/></p>
<p>The node represents the variables and the edges stand for conditional relationship between the variables. What we are looking for is full joint probability distribution. <span>Here, the conditional dependency is being spoken. Rain causes the ground to be wet. However, winning the lottery has nothing to do with other variables. It's got conditional independence, as shown in the following diagram:</span></p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-612 image-border" src="assets/54801f88-0c6d-4815-80ed-84770c9f370f.png" style="width:16.25em;height:9.25em;"/></p>
<p>Here, the probability for conditional independence is as follows:</p>
<p class="CDPAlignCenter CDPAlign"><em>P(Lottery,Rain, Wet Ground)= P(Lottery) P(Rain) P(Wet Ground | Rain)</em></p>
<p>Therefore, we can say that a Bayesian network describes a probability distribution among all variables by putting conditional probability as edges.</p>
<p>Let's look at an example in Python:</p>
<ol>
<li>First, we need to load the library, <kbd>CausalGraphicalModel</kbd>, as follows:</li>
</ol>
<pre style="padding-left: 60px">from causalgraphicalmodels import CausalGraphicalModel</pre>
<ol start="2">
<li>Let's set up the model for a condition that if somebody is doing a <kbd>Job</kbd> and if it's powered by <kbd>Smartwork</kbd> and <kbd>Hardwork</kbd>, he/she reaps rewards and eventually, ends up having a promotion:</li>
</ol>
<pre style="padding-left: 60px">Model = CausalGraphicalModel(<br/> nodes=["Job", "Smartwork", "Hardwork", "Reward", "Promotion"],<br/> edges=[<br/> ("Job", "Smartwork"), <br/> ("Job", "Hardwork"), <br/> ("Smartwork", "Reward"),<br/> ("Hardwork", "Reward"), <br/> ("Reward", "Promotion")<br/> ]<br/>)<br/>Model.draw()</pre>
<p style="padding-left: 60px">The following is the output of the preceding code:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1001 image-border" src="assets/2fd1eb17-9b5b-43c8-96a9-f18293786a63.png" style="width:15.75em;height:18.92em;"/></p>
<ol start="3">
<li>Let's obtain the distribution:</li>
</ol>
<pre style="padding-left: 60px">print(Model.get_distribution())<br/></pre>
<p style="padding-left: 60px">Then we will get the following as a output:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8e90a859-0356-4cb2-be40-7c1bf3a651fc.png"/></p>
<ol start="4">
<li>Let's extract all of the conditional independence relationships:</li>
</ol>
<pre style="padding-left: 60px">Model.get_all_independence_relationships()</pre>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b8d32eb6-6c71-4219-a81c-416d3e40dee5.png" style="width:30.92em;height:17.83em;"/></p>
<p style="padding-left: 60px">Here, we are able to assess the conditional independence among the variables.</p>
<ol start="5">
<li>Let's mix this in with <kbd>Reward</kbd>:</li>
</ol>
<pre style="padding-left: 60px">Intervene = Model.do("Reward")<br/>Intervene.draw()</pre>
<p class="CDPAlignCenter CDPAlign"><img src="assets/941edca5-e300-421f-b430-8a7b2656af3b.png" style="width:24.33em;height:8.75em;"/></p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we studied Granger causality, which is where <span>we use a single time series to predict its future values,</span> along with the different models of graphical causality models. The <span>graphical causality models cover two examples that will give us a basic idea about the graphical causal models.</span></p>


            </article>

            
        </section>
    </body></html>
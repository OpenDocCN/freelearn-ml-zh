<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Visualizing Economic Problems in the European Union</h1>
                </header>
            
            <article>
                
<p class="FirstParagraph CDPAlignLeft CDPAlign">Now, we will move on and look at a second problem, which is the detection of macroeconomic imbalances in different countries, particularly within the European Union, which, in my opinion, failed and increased the damage of the financial crisis.</p>
<p>In this chapter, we will take a look at what our problem is and create clusters for the countries that have been identified as suffering from macroeconomic imbalances. We will cover the following topics:</p>
<ul>
<li>A general overview of economic problems in the European Union</li>
<li>Clustering countries based on macroeconomic imbalances</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">A general overview of economic problems in countries</h1>
                </header>
            
            <article>
                
<p>The worldwide financial crisis of 2008 started as a bank-level crisis that closed the flow of money and increased financial instability. During the first few months, the impact was felt primarily by financial institutions and intermediaries. After that, however, it then reached macroeconomic dimensions, threatening the stability of entire countries.</p>
<p>The European Union, the <strong>International Monetary Fund</strong> (<strong>IMF</strong>), and the <strong>European Central Bank</strong> (<strong>ECB</strong>) took urgent measures to avoid the insolvency of some countries. As a result, Greece received <span>€</span>110 billion in 2010 to pay its public debt. This loan was the start of further expenditure. Ireland received <span>€</span>87 billion euros in November 2017 with the same aim. Problems were then identified in Portugal in 2011 and an additional loan was received by Greece. Spain and Cyprus also received money in 2012 and 2013, respectively. </p>
<p>When a financial crisis occurs or a new problem arises, people often say that it was bound to happen or that everyone had predicted it. <span>Prior to the financial crisis, macroeconomic imbalances had been increasing steadily, but were probably hidden because of the worldwide economic growth that took place from 2002</span>. Credit rating agencies also weren't able to detect these macroeconomic imbalances.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding credit ratings</h1>
                </header>
            
            <article>
                
<p>Credit ratings can be described as a category or grade that represents a government's ability and willingness to re<span><span>pay</span></span> its debts fully and on time. An implicit probability of defaulting can be associated with a credit rating.<span> </span></p>
<p>Credit ratings are very important for countries because they determine the cost of funding in capital markets and they enable access to derivative and loan contracts.</p>
<p>In recent years, the number of ratings and their importance has increased considerably. In a more globalized and complex world, investors need standard metrics to compare the credit quality between issuers, even if they belong to very different countries. Although they are not an exact science, as the <strong>Credit Rating Agency</strong> (<strong>CRA</strong>) <span>Standard &amp; Poor's</span> argues, credit rating establishes a ranking of countries according to their solvency. They are considered an important reference for investors and international organizations. In the following table, the different grades and their meanings are described: </p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-718 image-border" src="assets/71c29554-2072-46b6-85d9-cb170671eb94.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The role of credit rating agencies</h1>
                </header>
            
            <article>
                
<p>The reliance on credit ratings has granted a high level of influence and political power to CRAs. Although there is a large number of CRAs, only three of them collect more than 90% of the market share. These are <strong>Moody's</strong>, <strong>Standard &amp; Poor's</strong>, and <strong>Fitch</strong>.</p>
<p>Credit rating agencies have been criticized for their performance in important crises such as the Asian and Russian financial crisis of the late 1990s and the recent global financial crisis that started in 2008. During these events, CRAs exacerbated imbalances, taking too much time to react or to predict default events, and then they reacted excessively, with severe downgrades.</p>
<p>For example, in the most recent financial crisis, European economies were downgraded by <span>an average of </span><span>three notches. Greece and Italy were among the most severely affected countries.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The credit rating process</h1>
                </header>
            
            <article>
                
<p>Many factors are considered in the rating process, including political, growth, external debt, the financial sector, the structure of the public and private sector, social development, and trade. Standard &amp; Poor's, for example, scores five key factors of a country's degree of creditworthiness on a six-point scale. The different weights and the way in which the factors are combined, however, is unknown. Moreover, the importance of these factors changes over time. Qualitative judgement usually plays a very important role in the rating assignation process.</p>
<p>Concerns about the quality of ratings have acted as an incentive to researchers around the world over the last two decades. It is important to understand the determinants of ratings to reduce the dependency on CRAs and to make the assignation of credit ratings more objective.</p>
<p>The replication of a credit rating is mainly based on different econometric models that try to find a set of macroeconomic variables to better explain external ratings. Nevertheless, credit rating studies have widely ignored qualitative and more subjective information. This additional information could complement the current quantitative macroeconomic information and improve the performance of credit rating models.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Clustering countries based on macroeconomic imbalances</h1>
                </header>
            
            <article>
                
<p>In this section, we will develop an unsupervised model to visually detect macroeconomic problems in countries and also understand a little more about the main drivers of credit ratings. We will start by creating a cluster of the countries with macroeconomic problems. In the next chapter, we will move on to predicting the credit ratings based on these clusters.</p>
<p>Throughout this chapter, I've tried to make an effort to reiterate the code from the previous chapters.</p>
<p>Let's get started!</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Data collection</h1>
                </header>
            
            <article>
                
<p>As in the previous model, we need to collect the largest amount of data possible. First, we need the macroeconomic indicators of countries to analyze the macroeconomic imbalances and predict the sovereign ratings.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Downloading and viewing the data</h1>
                </header>
            
            <article>
                
<p>We will use the <kbd>wbstats</kbd> package, which provides structured access to all of the information that's available from the World Bank API, including all annual, quarterly, and monthly data. In this package, the <kbd>wb_cachelist</kbd> function provides a snapshot of the available countries, indicators, and other relevant information, shown as follows:</p>
<pre>library(wbstats)<br/>str(wb_cachelist, max.level = 1)<br/> ## List of 7<br/> ##  $ countries  :'data.frame': 304 obs. of  18 variables:<br/> ##  $ indicators :'data.frame': 16978 obs. of  7 variables:<br/> ##  $ sources    :'data.frame': 43 obs. of  8 variables:<br/> ##  $ datacatalog:'data.frame': 238 obs. of  29 variables:<br/> ##  $ topics     :'data.frame': 21 obs. of  3 variables:<br/> ##  $ income     :'data.frame': 7 obs. of  3 variables:<br/> ##  $ lending    :'data.frame': 4 obs. of  3 variables:</pre>
<p>More than 16,000 variables for more than 300 countries are available. The default language is English.</p>
<p>To search for different indicators, let's use the <kbd>wbsearch</kbd> function. For example, we can search for all the indicators containing <strong>Gross Domestic Product</strong> (<strong>GDP</strong>), as follows:</p>
<pre>new_cache &lt;- wbcache()<br/>gdp_vars &lt;- wbsearch(pattern = "gdp")<br/>print(gdp_vars[1:5,])<br/> ##                     indicatorID<br/> ## 2   XGDP.56.FSGOV.FDINSTADM.FFD<br/> ## 3   XGDP.23.FSGOV.FDINSTADM.FFD<br/> ## 758           TG.VAL.TOTL.GG.ZS<br/> ## 759           TG.VAL.TOTL.GD.ZS<br/> ## 760        TG.VAL.TOTL.GD.PP.ZS<br/> ## indicator<br/> ## Government expenditure in tertiary institutions as % of GDP (%)<br/> ## Government expenditure in secondary institutions education as % of     GDP (%)<br/> ## Trade in goods (% of goods GDP)<br/> ## Merchandise trade (% of GDP)<br/> ## Trade (% of GDP, PPP)</pre>
<p>You can also download the data and specify the indicator, the starting date, and the end date, as follows:</p>
<pre>stock_return &lt;- wb(indicator = "GFDD.OM.02", startdate = 2000, enddate = 2017)<br/>head(stock_return)<br/> ##     iso3c date    value indicatorID                                  indicator<br/> ## 110   ARG 2016  31.1342  GFDD.OM.02 Stock market return (%, year-      on-year)<br/> ## 111   ARG 2015  36.6400  GFDD.OM.02 Stock market return (%, year-     on-year)<br/> ## 112   ARG 2014 103.1500  GFDD.OM.02 Stock market return (%, year-     on-year)<br/> ## 113   ARG 2013  60.0070  GFDD.OM.02 Stock market return (%, year-     on-year)<br/> ## 114   ARG 2012 -19.8370  GFDD.OM.02 Stock market return (%, year-     on-year)<br/> ## 115   ARG 2011  22.1574  GFDD.OM.02 Stock market return (%, year-     on-year)<br/> ##     iso2c   country<br/> ## 110    AR Argentina<br/> ## 111    AR Argentina<br/> ## 112    AR Argentina<br/> ## 113    AR Argentina<br/> ## 114    AR Argentina<br/> ## 115    AR Argentina</pre>
<p>We have now downloaded the stock market returns for all countries. The first values belong to Argentina. It is also possible to obtain information just for specific countries. Let's obtain the total population of the United States and Spain between 2015 to 2017, shown as follows:</p>
<pre>population_stock &lt;- wb(country = c("ES","US"),indicator = c("SP.POP.TOTL","GFDD.OM.02"), startdate = 2015, enddate = 2017)<br/> <br/>head(population_stock)<br/> ##   iso3c date     value indicatorID         indicator iso2c            country<br/> ## 1   ESP 2017  46572028 SP.POP.TOTL Population, total    ES              Spain<br/> ## 2   ESP 2016  46484062 SP.POP.TOTL Population, total    ES              Spain<br/> ## 3   ESP 2015  46444832 SP.POP.TOTL Population, total    ES              Spain<br/> ## 4   USA 2017 325719178 SP.POP.TOTL Population, total    US United      States<br/> ## 5   USA 2016 323405935 SP.POP.TOTL Population, total    US United      States<br/> ## 6   USA 2015 321039839 SP.POP.TOTL Population, total    US United      States</pre>
<p>Variables are always obtained in rows, but this is not a very common way to present the information. With the <kbd>return_wide = TRUE</kbd> option, if more than one variable is obtained, they will be presented in columns. Let's take a look at the following example:</p>
<pre>population_stock &lt;- wb(country = c("ES","US"),<br/>indicator = c("SP.POP.TOTL","GFDD.OM.02"), startdate = 2015, enddate =2017,return_wide = TRUE)<br/>head(population_stock)<br/> ##   iso3c date iso2c       country GFDD.OM.02 SP.POP.TOTL<br/> ## 1   ESP 2015    ES         Spain    1.96478    46444832<br/> ## 2   ESP 2016    ES         Spain  -18.17990    46484062<br/> ## 3   ESP 2017    ES         Spain         NA    46572028<br/> ## 4   USA 2015    US United States    6.71498   321039839<br/> ## 5   USA 2016    US United States    1.70065   323405935<br/> ## 6   USA 2017    US United States         NA   325719178</pre>
<p>If the latest available date of an indicator is unknown, the <kbd>mrv</kbd> parameter stands for the most recent value and takes an integer that corresponds to the number of most desired recent values. Let's display the 10 most recent values of the stock market return for the United States, as follows:</p>
<pre>wb(country = c("US"),indicator = "GFDD.OM.02", mrv=10,return_wide = TRUE)<br/>##    iso3c date iso2c       country GFDD.OM.02<br/> ## 1    USA 2007    US United States   12.72230<br/> ## 2    USA 2008    US United States  -17.40770<br/> ## 3    USA 2009    US United States  -22.29390<br/> ## 4    USA 2010    US United States   20.24370<br/> ## 5    USA 2011    US United States   11.19970<br/> ## 6    USA 2012    US United States    8.81282<br/> ## 7    USA 2013    US United States   19.17170<br/> ## 8    USA 2014    US United States   17.49470<br/> ## 9    USA 2015    US United States    6.71498<br/> ## 10   USA 2016    US United States    1.70065</pre>
<p>The default date format is not useful for sorting or plotting. The <kbd>POSIXct</kbd> parameter adds the <kbd>date_ct</kbd> and <kbd>granularity</kbd> columns, making these tasks much easier.</p>
<p>Let's take a look the evolution of military expenses in the United States over time as an example, shown as follows:</p>
<pre>library(ggplot2)<br/>military_exp &lt;- wb(country = c("US"),indicator = "MS.MIL.XPND.GD.ZS", POSIXct = TRUE)<br/> <br/> ggplot() + theme_bw() +<br/>   geom_line(aes(y = value, x = date_ct), size=1.5, data = military_exp,<br/>             stat="identity") +<br/>   theme(legend.position="bottom", legend.direction="horizontal",<br/>         legend.title = element_blank())  +<br/>   labs(x="Year", y="Expenses as %GDP") +<br/>   ggtitle("US Military expenses %GDP")</pre>
<p>You will get the following plot as an output:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-716 image-border" src="assets/8e81beff-d896-4c27-85ca-0ff9d4da2f12.png" style=""/></div>
<p>We have seen that it is very easy to download information. To develop our model, however, we will not use all of the data. Now, let's define how many variables and countries and how much historical data we need.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Streamlining data</h1>
                </header>
            
            <article>
                
<p>Let's see the list of countries in the World Bank database using the following code:</p>
<pre>countries&lt;-wb_cachelist$countries</pre>
<p>Although the list is large, some countries belong to unions of several countries, such as the Arab World or the European Union. We will need to make a selection of countries.</p>
<p>Let's look at a list of the available indicators, as follows:</p>
<pre>indicators&lt;-wb_cachelist$indicators</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root">The list of indicators is even bigger (there are more than 16,000 entries), but we will select the most important ones, as shown in the following snippet. These are obtained using the rating methodology guidelines that are provided by the main credit rating agencies:</p>
<pre class="mce-root">relevant_indicators&lt;-c('NYGDPMKTPKDZ','FB.BNK.CAPA.ZS','GFDD.OI.01','GFDD.EI.07','GFDD.SI.04','GFDD.OI.02','GFDD.EI.02','FD.RES.LIQU.AS.ZS','FB.AST.NPER.ZS','GFDD.SI.05','GFDD.EI.05','GFDD.EI.09','GFDD.EI.06','GFDD.EI.10','GFDD.SI.01','FM.LBL.BMNY.GD.ZS','FM.LBL.BMNY.ZG','FS.AST.CGOV.GD.ZS','CC.EST','GFDD.EI.08','BN.CAB.XOKA.GD.ZS','IC.CRD.INFO.XQ','FS.AST.DOMS.GD.ZS','NE.EXP.GNFS.KD.ZG','NE.RSB.GNFS.ZS','GFDD.DI.08','NY.GDP.MKTP.KD.ZG','NY.GDP.PCAP.CD','NY.GDP.PCAP.KD.ZG','NE.CON.GOVT.ZS','NE.CON.GOVT.KD.ZG','GE.EST','NY.GDS.TOTL.ZS','NE.GDI.FTOT.ZS','NE.GDI.FTOT.KD.ZG','NE.CON.PRVT.KD.ZG','NE.CON.PRVT.PC.KD.ZG','NE.IMP.GNFS.KD.ZG','NV.IND.TOTL.ZS','NV.IND.TOTL.KD.ZG','FP.CPI.TOTL.ZG','FR.INR.LNDP','CM.MKT.LCAP.GD.ZS','PV.EST','SP.POP.GROW','GFDD.SI.07','REER','RQ.EST','RL.EST','NV.SRV.TETC.ZS','NV.SRV.TETC.KD.ZG','DT.DOD.DSTC.ZS','DT.DOD.DSTC.IR.ZS','GFDD.OM.02','IC.LGL.CRED.XQ','TOTRESV','SL.UEM.TOTL.ZS','SL.UEM.1524.ZS','VA.EST','SP.POP.TOTL')<br/><br/>indicators&lt;-indicators[indicators$indicatorID %in% relevant_indicators,]<br/>head(indicators[,c("indicatorID","indicator")])</pre>
<p>The acquired list of indicators is as follows:</p>
<pre> ##      indicatorID<br/> ## 284       VA.EST<br/> ## 1793     TOTRESV<br/> ## 1986      PV.EST<br/> ## 2569      RQ.EST<br/> ## 2607      RL.EST<br/> ## 2636        REER<br/> ##                                                            indicator<br/> ## 284                               Voice and Accountability: Estimate<br/> ## 1793                                                  Total Reserves<br/> ## 1986 Political Stability and Absence of Violence/Terrorism: Estimate<br/> ## 2569                                    Regulatory Quality: Estimate<br/> ## 2607                                           Rule of Law: Estimate<br/> ## 2636                                    Real Effective Exchange Rate<br/>                                                                                       </pre>
<p>Let's download the historical data for these indicators from 2000 to 2018. This will take about five minutes using the following code:</p>
<pre>macroeconomic_data&lt;-wb(indicator = relevant_indicators,startdate = 2000, enddate = 2018,return_wide = TRUE,POSIXct = TRUE)</pre>
<p>Let's get the structure of our data with the following:</p>
<pre>str(macroeconomic_data)</pre>
<p>The complete output is as follows:</p>
<pre><br/> ## 'data.frame':    5903 obs. of  66 variables:<br/> ##  $ iso3c               : chr  NA NA NA NA ...<br/> ##  $ date                : chr  "2018" "2017" "2016" "2015" ...<br/> ##  $ iso2c               : chr  "EA" "EA" "EA" "EA" ...<br/> ##  $ country             : chr  "Euro Area" "Euro Area" "Euro Area" "Euro Area" ...<br/> ##  $ date_ct             : Date, format: "2018-01-01" "2017-01-01"     ...<br/> ##  $ granularity         : chr  "annual" "annual" "annual" "annual"     ...<br/> ##  $ BN.CAB.XOKA.GD.ZS   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ CC.EST              : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ CM.MKT.LCAP.GD.ZS   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ DT.DOD.DSTC.IR.ZS   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ DT.DOD.DSTC.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FB.AST.NPER.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FB.BNK.CAPA.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FD.RES.LIQU.AS.ZS   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FM.LBL.BMNY.GD.ZS   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FM.LBL.BMNY.ZG      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FP.CPI.TOTL.ZG      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FR.INR.LNDP         : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FS.AST.CGOV.GD.ZS   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ FS.AST.DOMS.GD.ZS   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GE.EST              : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.DI.08          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.EI.02          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.EI.05          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.EI.06          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.EI.07          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.EI.08          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.EI.09          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.EI.10          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.OI.01          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.OI.02          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.OM.02          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.SI.01          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.SI.04          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.SI.05          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ GFDD.SI.07          : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ IC.CRD.INFO.XQ      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ IC.LGL.CRED.XQ      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.CON.GOVT.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.CON.GOVT.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.CON.PRVT.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.CON.PRVT.PC.KD.ZG: num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.EXP.GNFS.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.GDI.FTOT.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.GDI.FTOT.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.IMP.GNFS.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NE.RSB.GNFS.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NV.IND.TOTL.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NV.IND.TOTL.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NV.SRV.TETC.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NV.SRV.TETC.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NY.GDP.MKTP.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NY.GDP.PCAP.CD      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NY.GDP.PCAP.KD.ZG   : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NY.GDS.TOTL.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ NYGDPMKTPKDZ        : num  2.1 2.39 1.8 2.07 2.21 ...<br/> ##  $ PV.EST              : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ REER                : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ RL.EST              : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ RQ.EST              : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ SL.UEM.1524.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ SL.UEM.TOTL.ZS      : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ SP.POP.GROW         : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ SP.POP.TOTL         : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ TOTRESV             : num  NA NA NA NA NA NA NA NA NA NA ...<br/> ##  $ VA.EST              : num  NA NA NA NA NA NA NA NA NA NA ...</pre>
<p>As you can see, most of the variables display missing values in the first few rows. Let's acquire a list of the number of times a country appears in the preceding list:</p>
<pre>head(table(macroeconomic_data$country))<br/> ## <br/> ## Advanced economies Advanced Economies        Afghanistan <br/> ##                  4                 19                 19 <br/> ##             Africa            Albania            Algeria <br/> ##                 12                 19                 19</pre>
<p>The total number of countries this data includes can be found as follows:</p>
<pre>length(table(macroeconomic_data$country))<br/> ## [1] 330</pre>
<p>We can explore our missing values as follows:</p>
<pre class="SourceCode"><span class="KeywordTok">library</span><span class="NormalTok">(DataExplorer)<br/></span><span class="KeywordTok">plot_missing</span><span class="NormalTok">(macroeconomic_data) </span></pre>
<p>The output that we will acquire will be as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-717 image-border" src="assets/422f125c-c85d-457f-8d60-f1439629fac8.png" style=""/></div>
<p>The graph that's obtained is not very pretty because there's a large number of variables. Although information is easily obtained, many of the variables display a high number of missing values. This is because the information is not updated and data for the most recent years is unavailable.</p>
<p>To view the results, you should manually select the relevant variables for different official sources and merge them in an Excel file, which will be used for our model development. First, remove all of the objects in the workspace, as follows:</p>
<pre>rm(list=ls())</pre>
<p>Now, load the new data sample into R, as follows:</p>
<pre>macroeconomic_data &lt;- read.csv("SovereignData.csv",sep=";",header=TRUE,stringsAsFactors = FALSE,dec=",")</pre>
<p>The file contains the following information:</p>
<pre>str(macroeconomic_data)<br/> ## 'data.frame':    224 obs. of  14 variables:<br/> ##  $ Year                : int  2010 2011 2012 2013 2014 2015 2016                  2017 2010 2011 ...<br/> ##  $ CountryISO          : chr  "AT" "AT" "AT" "AT" ...<br/> ##  $ CountryName         : chr  "Austria" "Austria" "Austria"              "Austria" ...<br/> ##  $ CARA                : num  2.92 1.57 1.5 1.95 2.39 ...<br/> ##  $ DCPI                : num  1.69 3.54 2.57 2.12 1.47 ...<br/> ##  $ DGDP                : num  1.828 2.935 0.662 0.008 0.923 ...<br/> ##  $ ILMA                : num  22284 25161 27211 23290 24941 ...<br/> ##  $ PSBR                : num  -4.44 -2.55 -2.19 -1.95 -2.68 ...<br/> ##  $ PUDP                : num  82.4 82.2 81.7 81 83.7 ...<br/> ##  $ TDRA                : num  -0.469 -1.168 -0.992 -0.313 0.232 ...<br/> ##  $ YPCA                : num  0.0467 0.0511 0.0483 0.0506 0.0519         ...<br/> ##  $ MEANWGI             : num  1.55 1.48 1.52 1.54 1.52 ...<br/> ##  $ YearsFromLastDefault: int  21 22 23 24 25 26 27 28 21 22 ...<br/> ##  $ RatingMayT1         : int  6 5 5 5 5 5 5 5 5 5 ...</pre>
<p>As the <kbd>str</kbd> function shows, the data sample contains <kbd>224</kbd> observations and the following <kbd>14</kbd> variables:</p>
<ul>
<li><kbd>Year</kbd>: The reference date of the year-end</li>
<li><kbd>CountryISO</kbd>: The international standard country code</li>
<li><kbd>CountryName</kbd>: The name of the country</li>
<li><kbd>CARA</kbd>: The current account balance of a country</li>
<li><kbd>DCPI</kbd>: The consumer prices growth rate</li>
<li><kbd>DGDP</kbd>: The GDP growth </li>
<li><kbd>ILMA</kbd>: The international reserves</li>
<li><kbd>PSBR</kbd>: The budget balance as a percentage of the GDP</li>
<li><kbd>PUDP</kbd>: The public debt <span>as a percentage of the GDP</span></li>
<li><kbd>TDRA</kbd>: Total imports less total exports of goods and services <span>as a percentage of the GDP</span></li>
<li><kbd>YPCA</kbd>: The GDP per head</li>
<li><kbd>MEANWGI</kbd>: The mean of the six worldwide governance indicators</li>
<li><kbd>YearsFromLastDefault</kbd>: The amount of time elapsed since the last time the country defaulted</li>
<li><kbd>RatingMayT1</kbd>: The credit rating of the country one year after the macroeconomic information</li>
</ul>
<div class="packt_infobox">You can obtain additional data from the following sources:<br/>
<ul>
<li><a href="https://www.worldbank.org/">https://www.worldbank.org/</a></li>
<li><a href="https://www.oecd.org/">https://www.oecd.org/</a></li>
<li><a href="https://ec.europa.eu/eurostat">https://ec.europa.eu/eurostat<br/></a><a href="https://info.worldbank.org/governance/wgi"/></li>
<li><a href="https://info.worldbank.org/governance/wgi">https://info.worldbank.org/governance/wgi<br/></a><a href="https://www.cia.gov/library/publications/the-world-factbook"/></li>
<li><a href="https://www.cia.gov/library/publications/the-world-factbook">https://www.cia.gov/library/publications/the-world-factbook<br/></a><a href="https://www.imf.org/" target="_blank"/></li>
<li><a href="https://www.imf.org/" target="_blank">https://www.imf.org/</a><br/>
<a href="https://www.oecd.org/" target="_blank"/></li>
<li><a href="https://www.oecd.org/" target="_blank">https://www.oecd.org/</a></li>
</ul>
</div>
<p>All of the considered variables have been widely used in previous studies or by CRAs. We are using various World Bank governance indicators in our list of variables, including the <kbd>MEANWGI</kbd> variable. This variable is calculated as the simple average of six different indicators that are provided by the World Bank. These measure topics such as political stability, level of violence, and control of corruption. The World Bank calculates these aggregate indicators based on surveys by different non-governmental organizations, international organizations, or private sector firms. The higher the value of each indicator, the highest the quality or the score of a country in the indicator. </p>
<p>The dataset that will be used in the remaining part of this chapter collects the credit rating at the end of May for each country over several years. The macroeconomic information represents the economic situation of each country at the end of the previous year. Countries publish this information in the first or second quarter of the year, so the most updated macroeconomic information taken every May belongs to the previous year.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Studying the data</h1>
                </header>
            
            <article>
                
<p>Our first objective will be to detect clusters of countries according to their macroeconomic situation and to predict ratings for those countries. We will then assess whether the qualitative information that's included in the country reports issued by the European Commission are useful to predict country ratings. These reports are usually issued in the first months of each year, so they should be influential in the credit ratings around May as well.</p>
<p>Again, we must start by analyzing the following dataset:</p>
<pre>head(macroeconomic_data)<br/> ##   Year CountryISO CountryName  CARA  DCPI  DGDP  ILMA   PSBR   PUDP   TDRA<br/> ## 1 2010         AT     Austria 2.923 1.694 1.828 22284 -4.440 82.401 -0.469<br/> ## 2 2011         AT     Austria 1.575 3.542 2.935 25161 -2.554 82.193 -1.168<br/> ## 3 2012         AT     Austria 1.499 2.569 0.662 27211 -2.189 81.667 -0.992<br/> ## 4 2013         AT     Austria 1.947 2.118 0.008 23290 -1.950 81.016 -0.313<br/> ## 5 2014         AT     Austria 2.389 1.468 0.923 24941 -2.683 83.714  0.232<br/> ## 6 2015         AT     Austria 1.932 0.810 1.073 22236 -1.033 84.297  0.609<br/> ##        YPCA  MEANWGI YearsFromLastDefault RatingMayT1<br/> ## 1 0.0466532 1.552740                   21           6<br/> ## 2 0.0510888 1.477206                   22           5<br/> ## 3 0.0483316 1.515706                   23           5<br/> ## 4 0.0505913 1.540124                   24           5<br/> ## 5 0.0519292 1.521760                   25           5<br/> ## 6 0.0447088 1.471732                   26           5</pre>
<p>There are no missing values in this dataset. Let's explore our data, as follows:</p>
<pre>library(funModeling)<br/>library(DataExplorer)<br/>info&lt;-df_status(macroeconomic_data)<br/> ##variable              q_zeros p_zeros q_na p_na q_inf p_inf  type<br/> ## Year                 0           0    0    0     0     0   integer<br/> ## CountryISO           0           0    0    0     0     0   character<br/> ## CountryName          0           0    0    0     0     0   character<br/> ## CARA                 0           0    0    0     0     0   numeric<br/> ## DCPI                 0           0    0    0     0     0   numeric<br/> ## DGDP                 0           0    0    0     0     0   numeric<br/> ## ILMA                 0           0    0    0     0     0   numeric<br/> ## PSBR                 0           0    0    0     0     0   numeric<br/> ## PUDP                 0           0    0    0     0     0   numeric<br/> ## TDRA                 0           0    0    0     0     0   numeric<br/> ## YPCA                 0           0    0    0     0     0   numeric<br/> ## MEANWGI              0           0    0    0     0     0   numeric<br/> ## YearsFromLastDefault 0           0    0    0     0     0   integer<br/> ## RatingMayT1          0           0    0    0     0     0   integer</pre>
<p>The macroeconomic information for the different countries is available from the years 2010 to 2017, as follows:</p>
<pre>table(macroeconomic_data$Year)<br/> ## 2010 2011 2012 2013 2014 2015 2016 2017<br/> ##   28   28   28   28   28   28   28   28</pre>
<p>The following is the list of the 28 countries in the dataset:</p>
<pre>unique(macroeconomic_data$CountryName)<br/> ##  [1] "Austria"        "Belgium"        "Bulgaria"     "Croatia"      <br/> ##  [5] "Cyprus"         "Czech Republic" "Denmark"      "Estonia"      <br/> ##  [9] "Finland"        "France"         "Germany"      "Greece"       <br/> ## [13] "Hungary"        "Ireland"        "Italy"        "Latvia"       <br/> ## [17] "Lithuania"      "Luxembourg"     "Malta"        "Netherlands"  <br/> ## [21] "Poland"         "Portugal"       "Romania"      "Slovakia"     <br/> ## [25] "Slovenia"       "Spain"          "Sweden"       "United Kingdom"</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Acquiring the target variable</h1>
                </header>
            
            <article>
                
<p>The target variable will be the credit rating of each country. Let's see the different values of the target variables with the following code:</p>
<pre>unique(macroeconomic_data$RatingMayT1)<br/>## [1] 6 5 3 2 4 1</pre>
<p>As we can see, the scale only takes six different grades, and they are numerical, not alphabetical. The following code creates a table to display the assigned numbers for each rating category:</p>
<pre>RatingSP &lt;- c('AAA','AA+','AA','AA-','A+','A','A-','BBB+','BBB','BBB-','BB+','BB','BB-','B+','B','B-','CCC+','CCC','CCC-','CC','C','D','DD','SD')<br/> <br/> Rating_num &lt;- c('6','5','5','5','4','4','4','3','3','3','2','2','2','1','1','1','1','1','1','1','1','1','1','1')<br/> <br/> mapping&lt;-data.frame(RatingSP, Rating_num)<br/> <br/> rm(RatingSP,Rating_num)<br/> <br/> print(mapping)</pre>
<p>The following mapping table will be used to reduce the number of all possible credit rating levels into only six categories: </p>
<pre> ##    RatingSP Rating_num<br/> ## 1       AAA          6<br/> ## 2       AA+          5<br/> ## 3        AA          5<br/> ## 4       AA-          5<br/> ## 5        A+          4<br/> ## 6         A          4<br/> ## 7        A-          4<br/> ## 8      BBB+          3<br/> ## 9       BBB          3<br/> ## 10     BBB-          3<br/> ## 11      BB+          2<br/> ## 12       BB          2<br/> ## 13      BB-          2<br/> ## 14       B+          1<br/> ## 15        B          1<br/> ## 16       B-          1<br/> ## 17     CCC+          1<br/> ## 18      CCC          1<br/> ## 19     CCC-          1<br/> ## 20       CC          1<br/> ## 21        C          1<br/> ## 22        D          1<br/> ## 23       DD          1<br/> ## 24       SD          1</pre>
<p>Thus, a value of <kbd>6</kbd> is associated with the highest-rated grade (<kbd>AAA</kbd>), while <kbd>1</kbd> corresponds to the worst-rated grade. This mapping is done to reduce the number of different labels and to obtain a less granular target variable.</p>
<p>Let's take a look at the distribution of our target variable graphically with the following code:</p>
<pre>tab&lt;-table(macroeconomic_data$RatingMayT1)<br/> barplot(tab,xlab="Rating",ylab="Count",border="blue",col="blue")</pre>
<p>You will see a plot that looks as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-719 image-border" src="assets/c327657f-e36f-416e-8581-b9e93ec68272.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Acquiring the credit quality</h1>
                </header>
            
            <article>
                
<p>In May 2018, the credit ratings for each European country can be found as follows:</p>
<pre>with(macroeconomic_data[macroeconomic_data$Year==2017,], table(CountryName,RatingMayT1))</pre>
<p>The credit quality table for every country is as follows:</p>
<pre> ##                 RatingMayT1<br/> ## CountryName      1 2 3 4 5 6<br/> ##   Austria        0 0 0 0 1 0<br/> ##   Belgium        0 0 0 0 1 0<br/> ##   Bulgaria       0 1 0 0 0 0<br/> ##   Croatia        0 1 0 0 0 0<br/> ##   Cyprus         0 1 0 0 0 0<br/> ##   Czech Republic 0 0 0 0 1 0<br/> ##   Denmark        0 0 0 0 0 1<br/> ##   Estonia        0 0 0 0 1 0<br/> ##   Finland        0 0 0 0 1 0<br/> ##   France         0 0 0 0 1 0<br/> ##   Germany        0 0 0 0 0 1<br/> ##   Greece         1 0 0 0 0 0<br/> ##   Hungary        0 0 1 0 0 0<br/> ##   Ireland        0 0 0 1 0 0<br/> ##   Italy          0 0 1 0 0 0<br/> ##   Latvia         0 0 0 1 0 0<br/> ##   Lithuania      0 0 0 1 0 0<br/> ##   Luxembourg     0 0 0 0 0 1<br/> ##   Malta          0 0 0 1 0 0<br/> ##   Netherlands    0 0 0 0 0 1<br/> ##   Poland         0 0 1 0 0 0<br/> ##   Portugal       0 1 0 0 0 0<br/> ##   Romania        0 0 1 0 0 0<br/> ##   Slovakia       0 0 0 1 0 0<br/> ##   Slovenia       0 0 0 1 0 0<br/> ##   Spain          0 0 1 0 0 0<br/> ##   Sweden         0 0 0 0 0 1<br/> ##   United Kingdom 0 0 0 0 1 0</pre>
<p>Denmark, Germany, Luxembourg, Netherlands, and Sweden display the highest credit quality. On the other hand, Greece is the country with the lowest solvency in the European Union, according to Standard &amp; Poor's.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Displaying the credit ratings on a map</h1>
                </header>
            
            <article>
                
<p>Using the <kbd>rworldmap</kbd> package, we can create a map and display the credit ratings by country. Let's focus on the last available credit rating (from May 2018), as follows:</p>
<pre>macro2017&lt;-macroeconomic_data[macroeconomic_data$Year==2017,]<br/>library(rworldmap)<br/>Map &lt;- joinCountryData2Map(macro2017, joinCode = "ISO2",<br/> nameJoinColumn = "CountryISO")</pre>
<p>A quick summary can be displayed as follows:</p>
<pre> ## 28 codes from your data successfully matched countries in the map<br/> ## 0 codes from your data failed to match with a country code in the     map<br/> ## 215 codes from the map weren't represented in your data</pre>
<p>Assign the axes limits, as follows:</p>
<pre>mapCountryData(Map, catMethod = "categorical", missingCountryCol = gray(.8), xlim = c(-20, 59),ylim = c(35, 71),asp = 1)</pre>
<p>A very pretty output such as the following will be displayed:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-720 image-border" src="assets/112a3abb-7623-4214-bf75-470d273bc11d.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Carrying out a descriptive analysis of data</h1>
                </header>
            
            <article>
                
<p>We should now carry out a descriptive analysis, just like we did in the previous chapters, using the following code:</p>
<pre>library(fBasics)library(DataExplorer)<br/>descriptives_num&lt;-as.data.frame(t(basicStats(macroeconomic_data[,4:13])))<br/>head(descriptives_num)</pre>
<p>The acquired output is as follows:</p>
<pre> ##      nobs NAs Minimum    Maximum 1. Quartile 3. Quartile         Mean<br/> ## CARA  224   0 -11.354     12.638    -1.44275     4.15000     1.004080<br/> ## DCPI  224   0  -2.097      6.113     0.27950     2.44350     1.418147<br/> ## DGDP  224   0  -9.168     25.492     0.87175     3.17450     1.946969<br/> ## ILMA  224   0 207.470 248856.000  3099.44000 59386.00000 45290.293839<br/> ## PSBR  224   0 -32.055      3.931    -4.32325    -0.94425    -3.110054<br/> ## PUDP  224   0   6.067    181.147    40.68500    86.39600    68.819321<br/> ##          Median          Sum     SE Mean     LCL Mean     UCL Mean<br/> ## CARA     0.6140      224.914    0.284204     0.444012     1.564149<br/> ## DCPI     1.3000      317.665    0.103081     1.215009     1.621285<br/> ## DGDP     1.8995      436.121    0.195218     1.562261     2.331676<br/> ## ILMA 23359.0000 10145025.820 3712.287504 37974.641205 52605.946474<br/> ## PSBR    -2.5980     -696.652    0.239382    -3.581794    -2.638313<br/> ## PUDP    65.0070    15415.528    2.417700    64.054860    73.583783<br/> ##          Variance        Stdev  Skewness  Kurtosis<br/> ## CARA 1.809288e+01     4.253572  0.057613  0.070869<br/> ## DCPI 2.380167e+00     1.542779  0.324855 -0.127702<br/> ## DGDP 8.536634e+00     2.921752  1.873828 18.872568<br/> ## ILMA 3.086962e+09 55560.431839  1.508513  1.483938<br/> ## PSBR 1.283607e+01     3.582746 -2.870375 18.134018<br/> ## PUDP 1.309341e+03    36.184813  0.792637  0.645762</pre>
<p>Plot these variables, as follows:</p>
<pre>plot_histogram(macroeconomic_data[,4:13])</pre>
<p>The following graphs are shown: </p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-721 image-border" src="assets/8676bacb-f5b1-41d1-b78e-63ed8b070fc1.png" style=""/></div>
<p>Once we have studied our dataset, we can start to work with our data. Save a backup of your workspace. If something goes wrong, it is always possible to load the backups and continue with the code, as follows:</p>
<pre>rm(list=setdiff(ls(), c("macroeconomic_data")))<br/> <br/> save.image("Backup1.RData")</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Detecting macroeconomic imbalances</h1>
                </header>
            
            <article>
                
<p>In this section, we will use a technique called <strong>self-organizing maps</strong> (<strong>SOM</strong>) to perform a classification of the European countries depending on their solvency by using macroeconomic variables.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The self-organizing maps technique</h1>
                </header>
            
            <article>
                
<p>The identification of similarities and differences between countries is crucial for detecting imbalances and taking corrective measures to avoid the propagation of financial crises. SOM is an unsupervised neural network that is very useful for <strong>exploratory data analysis</strong> (<strong>EDA</strong>). The unsupervised nature of SOM is due to the fact that the network is able to learn patterns in the data without using a target variable. Therefore, the different neurons contained in the network self-organize themselves using the input data. The following diagram is the most common representation of a SOM:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-722 image-border" src="assets/c1b4f1e2-6761-4fdc-8199-d381632baf25.png" style=""/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p>As we can see in the preceding diagram, there are two main layers of neurons: an input layer and an output layer. The input layer is the input data we send to the network, which is the data to be analyzed. The output layer is a bidimensional map in which all our data will be placed. The data in the input layer is connected to all the neurons of the output layer through synaptic weights. In this way, the information that's provided by each neuron of the input layer is transmitted to all of the neurons of the output layer. </p>
<p>The network tries to find the neuron of the output layer with the most similar synaptic weights to the values of the input layer neurons. The most similar weights have the lowest distances between the input data and the prototype of weights that were created in the output layer. <span>These weights are initially created randomly. Once the distances are calculated, the winning neuron is identified. This neuron is the one with the least difference or the shortest Euclidean distance between its weights and the set of inputs. </span></p>
<p>Once the winning neuron is identified, its weights will be adjusted with a learning rule to proxy these weights to the input pattern that has made the neuron win. In this way, the neuron with the weights that are the closest to the input pattern is updated to become even closer. As a result, each neuron in the output layer specializes in this input pattern.</p>
<p>The winning neuron is not the unique neuron that updates its weights. A neighborhood function is also used to update not only the weights of the winning neuron but the neighbor neurons to localize similar patterns. This neighborhood radio decreases with the number of iterations of the model that are carried out to achieve a better specialization of each neuron.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Training the SOM</h1>
                </header>
            
            <article>
                
<p>It's now time to train the SOM using R. For that, we will use the <kbd>kohonen</kbd> package. The name of the package comes from Teuvo Kohonen, who first introduced this algorithm.</p>
<p>As SOM is mainly based on Euclidean distances, it is recommended to standardize your variables. We will use the <kbd>caret</kbd> package for this, as follows:</p>
<pre>library(kohonen)<br/>library(caret)<br/>preprocess &lt;- preProcess(macroeconomic_data[,4:13], method=c("center", "scale"))<br/>print(preprocess)<br/> ## Created from 224 samples and 10 variables<br/> ## <br/> ## Pre-processing:<br/> ##   - centered (10)<br/> ##   - ignored (0)<br/> ##   - scaled (10)</pre>
<p>This will create a data frame with the transformed variables. Then, we will add the country name and ratings to this transformed data frame, as follows:</p>
<pre>macroeconomic_data_trn &lt;- cbind(macroeconomic_data[,c(1:3,14)],predict(preprocess,                      macroeconomic_data[,4:13]))</pre>
<p>Now, it is time to train the map. The first layer of the network will have ten input patterns or ten macroeconomic variables. Our output layer will be fixed as a bidimensional map that is 6×5 in size. This size was obtained after several tests, shown as follows:</p>
<pre>set.seed(1234)<br/> <br/>som_grid &lt;- somgrid(xdim = 6, ydim=5, topo="hexagonal")  <br/> <br/>som_model &lt;- som(as.matrix(macroeconomic_data_trn[,5:14]),grid=som_grid,rlen=800,alpha=c(0.1,0.01), keep.data = TRUE )</pre>
<p>After 800 iterations, the training process finishes. Different plots can be obtained from the trained map.</p>
<p>Let's display the mean distance to the closest codebook vector during the training, using the following code:</p>
<pre>plot(som_model, type = "changes")</pre>
<p>This will plot the following graph:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-723 image-border" src="assets/558810d6-92ac-4ffd-933c-393037e47f91.png" style=""/></div>
<p>We can see that the error of the training process, measured as the mean distance to the closest unit, is reduced over the course of the iterations. If the number of iterations is high enough, the algorithm converges.</p>
<p>Moreover, it is possible to visualize the map and count the number of countries that are classified in each neuron:</p>
<pre>plot(som_model, type = "counts", main="Node Counts")</pre>
<p><span>A graphical representation of the node counts can be seen in the following plot:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-724 image-border" src="assets/c32b62bb-8572-4465-9121-44778712c5fd.png" style=""/></div>
<p>In the graph, 30 cells (6x5 in size) are marked in a different color, depending on the number of countries classified. Grey cells indicate that no countries have been classified in this cell. The larger the number of cells, the lower the number of countries in each neuron, obtaining a more granular map.</p>
<p>In the following plot, the average distance of the countries mapped to each unit in the map is shown. The smaller the distances, the better the countries are represented by the codebook vectors, as follows:</p>
<pre>plot(som_model, type = "quality", main="Node Quality/Distance")</pre>
<p>The node quality plot is as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-725 image-border" src="assets/b2b328ca-f45f-40f9-aeef-300da8c71af5.png" style=""/></div>
<p>The weight vectors across the map can also be visualized. This is useful to uncover patterns in the distribution of the different countries.</p>
<p>The node weight vectors, or codes, are made up of normalized values of the original variables that are used to generate the SOM:</p>
<pre>plot(som_model, type = "codes")</pre>
<p>The output of the preceding code is displayed in the following plot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-726 image-border" src="assets/259a13dd-2d2f-4301-a7b8-276027289060.png" style=""/></div>
<p>From the preceding diagram, it is possible to extract the characteristics of countries that have been placed in each cell. It is also possible to visualize how individual variables are distributed on the map. For example, let's look at the distribution of the <kbd>MEANWGI</kbd> <span>variable, as follows</span><span>:</span></p>
<pre>plot(som_model, type = "property", property = getCodes(som_model)[,'MEANWGI'], main="WorldBank Governance Indicators")</pre>
<p>The trained map is plotted and the cells are colored depending on the values of this variable for the countries placed on them, as shown in the following diagram:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-727 image-border" src="assets/2ba3695b-905c-4b5d-b36f-7599317b7363.png" style=""/></div>
<p><span>According to the preceding map, c</span><span>ountries with higher values in this variable will be located in the top-right part of the map.</span></p>
<p>Now, let's see where the countries are located by using the macroeconomic information from December 2017 with the following code:</p>
<pre>Labels&lt;-macroeconomic_data_trn[,c("CountryName","Year")]<br/> Labels$CountryName&lt;-ifelse(Labels$Year!=2017,"",as.character(Labels$CountryName))<br/> <br/>plot(som_model, type = "mapping",label=Labels$CountryName)</pre>
<p>A map will be displayed, where countries will be placed according to their economic variables, as shown in the following diagram:</p>
<p class="mce-root"/>
<p class="mce-root"/>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-728 image-border" src="assets/d1901549-bc48-42a8-99d4-6b96b4f30348.png" style=""/></div>
<p>Closer countries display similar values in macroeconomic variables. Thus, Greece, Portugal, and Cyprus are very close on the map. These countries have had important problems in the last few years as a consequence of financial crises. Countries such as Germany, France, and the United Kingdom are also similar, based on the macroeconomic information. Finally, we can create different clusters or groups on this map by taking into account the codebook vectors of the trained map. Hierarchical clustering can be used to select the number of groups. With the following code, we will obtain five different groups of countries:</p>
<pre>clusters &lt;- cutree(hclust(dist(getCodes(som_model))), 5)</pre>
<p>The recently created groups can be visualized on the map by running the following code:</p>
<pre>plot(som_model, type="codes", bgcol = clusters, main = "Clusters")<br/>add.cluster.boundaries(som_model, clusters)</pre>
<p>The following map is plotted:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-622 image-border" src="assets/5a0e4765-bcf2-43bb-b798-4eb542fae82b.jpg" style=""/></div>
<p>The preceding diagram gives us the following:</p>
<ul>
<li><strong>Group 1</strong>: C<span>ountries such as Portugal, Greece, and Cyprus.</span></li>
<li><strong>Group 2</strong>: C<span>ountries such as Poland, Malta, Bulgaria, and Spain. </span><span>In general, this is a cluster of countries from Western Europe and other countries with a weak economic situation. This group is in a better shape than the previous group.</span></li>
<li><strong>Group 3</strong>: M<span>ore solvent countries in the European Union, such as the UK, Germany, and France.</span></li>
<li><strong>Group 4</strong> and <strong>Group 5</strong>: These groups have one cell each, one of which contains Ireland. Ireland was in a deep economic crisis a few years back, but its situation is very different now. The difference is to such an extent that it cannot be included in any other group of countries.</li>
</ul>
<p>As usual, you can now back up your workspace using the following code:</p>
<pre>save.image("Backup2.RData")</pre>
<p>With this simple clustering approach, it is possible to visualize the different situations of each country in the European Union. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we introduced the economic crisis that's experienced by different European countries. We obtained the data and analyzed it. Then, we developed a visual tool to compare the countries using different variables at the same time.</p>
<p>In the next chapter, we will try to create a rating model. We will assign different scores to countries according to their economic situations. Let's see if we are able to predict the ratings of different countries!</p>


            </article>

            
        </section>
    </body></html>
<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Machine Learning Capabilities with vSphere 6.7</h1>
                </header>
            
            <article>
                
<p>This book will brief you about how different VMware tools will help customers to reap the benefits of intelligent automatic detection and prediction. This offering will enable them to detect, visualize, and troubleshoot anomalies, future needs, and potential modern applications and infrastructure issues—all this without any additional skillset for statistical or algorithm expertise from the user's side. VMware provides customers unified visibility into the health and typical behavior of metrics across all services without user assistance, and therefore reduces troubleshooting time. These tools will also help in forecasting to understand future capacity needs and to maximize application and infrastructure efficiency cost-effectively.</p>
<p>This chapter briefs you on how to virtualize GPU in a vSphere environment by using different modes, creating profiles for specific groups of users, and information about different <strong>NVIDIA graphics cards</strong> and their usage. We will also learn about configuring NVIDIA GPU in vSphere for <strong>machine</strong> l<strong>earning</strong> (<strong>ML</strong>)-based workloads with different use cases to achieve specific business objectives while reducing cost.</p>
<p>The topics that we we will cover in this chapter are as follows:</p>
<ul>
<li>ML and VMware</li>
<li>Different modes of using GPUs</li>
<li class="h1">ML with NVIDIA GPUs</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>You can download the following:</p>
<ul>
<li>VMware vSphere 6.7 from <a href="https://my.vmware.com/en/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/6_7">https://my.vmware.com/en/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/6_7</a> </li>
<li>VMware vCenter Server 6.5 U1 <a href="https://my.vmware.com/web/vmware/details?downloadGroup=VC65U1&amp;productId=676&amp;rPId=28154">https://my.vmware.com/web/vmware/details?downloadGroup=VC65U1&amp;productId=676&amp;rPId=28154</a></li>
<li>VMware Horizon 7 <a href="https://my.vmware.com/en/web/vmware/evalcenter?p=horizon-7&amp;src=WWW_HrzOld_TopNav_DownloadFreeTrail">https://my.vmware.com/en/web/vmware/evalcenter?p=horizon-7&amp;src=WWW_HrzOld_TopNav_DownloadFreeTrail</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">ML and VMware</h1>
                </header>
            
            <article>
                
<p><strong>VMware</strong> is extensively leveraging AI and ML techniques in most of its products. We can see this with the new version of vSphere 6.7 features and also with products such as <strong>AppDefense</strong> and <strong>Workspace</strong>. This is one intelligence that will help in achieving the future vision of self-driving data centers. VMware has already done the performance benchmarking regarding how it can help its customers to run their own ML workloads on vSphere with improved support from NVIDIA GPUs.</p>
<p><span>ML</span> is important for <span>VMware mixed cloud vision, a</span><span>s ML has the</span><span> ability to absorb a huge amount of data</span> <span>to utilize it for precise learning and with end users.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">ML-based data analysis</h1>
                </header>
            
            <article>
                
<p>ML is helping customers to fetch better granular-level information from large datasets. This will give a huge competitive advantage in business, as the customer is able to integrate their data from different sources, which will help the management to take major decisions ahead of their competitors. As we get this result with the relevant reasons behind it, we can help customers with accurate and productive data. The potential of AI in our daily life is immense.</p>
<p>We have a new development in ML every day, and ML will be extended even further. All the biggest public cloud vendors use ML-based techniques in their daily operations. Apple, GE, and Bosch are also gathering massive amounts of data and applying machine learning techniques to filter out only useful data. GE is accumulating data analytics through its industrial internet, and Apple has a huge amount of consumer and health data from its millions of end users, which helps them to emerge as major players in AI. </p>
<p>Embedding AI within present cloud technologies is helping businesses and consumers to grow and also creating new opportunities with all the relevant information to plan for the future. We are moving toward intelligent infrastructure where AI uses machines to adopt human intelligence. AI is based on rules-based logic, decision trees, and methodology to enable it to behave like a human. ML analyzes data and enhances the performance of repetitive tasks. DL will help machines learn by locating and checking various options against one another in order to get the best result or solution.</p>
<p>Customers have adopted the cloud and are now embedding ML techniques and its capabilities to extend its dynamics and delivering values to customers. Customers get a safe and secure environment with the scale up and out capabilities. The cloud provider receives loyal long-term customers in return. Every cloud provider is better than others in specific fields, from a business and an AI perspective. This will give customers diverse offerings with specialized intelligence for their unique requirements.</p>
<p>VMware will help customers with intelligent infrastructure that can deliver a comparable and secure solution across mixed clouds to choose the right cloud provider for their unique business requirements, such as security, backup, disaster recovery, networking, storage, graphics, and management with basic compute resources. </p>
<p>A good example of intelligent technology is Google Maps. When we leave our office for a meeting, with Google Map's guidance, we are able to identify alternative routes via AI, saving us valuable time.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using virtualized GPUs with ML</h1>
                </header>
            
            <article>
                
<p>ML is being extensively used in research and development these days, and the computing power enhancement of accelerators such as GPUs has enabled a rapid adoption of ML applications.</p>
<p>Designers, engineers, and architects are the extensive end users who frequently use 3D graphics for a wide-range of use cases and expect their IT teams to assist them in this. They use high-end graphics workstations handling 3D models of automobiles, manufacturing components, and buildings in real time. They are part of manufacturing, architecture, engineering and construction, higher education, public sector, oil and gas, and so on. They have to view and control this rich, visual 2D and 3D data in real time. Power-user groups such as clinicians, engineers, and office professionals represent millions of users who rely on rich 2D and 3D graphics for their deliverables.</p>
<p>Organizations are evolving today as their footprint increasing with the global workforce who are geographically distributed teams using virtual desktop with graphics from anywhere, anytime and on any workstation. As these power users are working in the field and need application access from anywhere using their end-point devices such as laptops, tablets, and mobile devices, they need to collaborate with their team members in real time without the risk of data loss and with full compliance. We have to redefine the workflow for designers and engineers with a <strong>Virtual Desktop Infrastructure</strong> (<strong>VDI</strong>) solution:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/977ccd64-ad18-44d1-947d-3c23f7c96a1e.png" style="width:43.42em;height:19.83em;"/></p>
<div class="mce-root packt_figref CDPAlignCenter CDPAlign"> VMware Horizon VDI with NVIDIA GPU</div>
<p>A VMware VDI solution is certified with all leading 3D apps workstations—world-class graphics from endpoint to data center are accessible on any device while lowering the operating expenses. VMware Horizon with protocol <span><span>Blast ensures a</span></span> tremendous user experience based on NVIDIA GRID vGPU technology by providing secure, native, 3D graphics from the cloud and delivered across any endpoint devices and from any locations with lower OpEx. Graphics commands executed on each virtual machine are directly passed to the physical GPU without any overheads at the hypervisor layer with NVIDIA GRID vGPU technology.</p>
<p>It helps with application compatibility as the applications have access to the same graphics card as earlier on their workstations. NVIDIA GRID vGPU makes it possible for the GPU hardware to be time-sliced to provide the best in shared virtualized graphics performance.</p>
<p>VMware, vSphere, and VMware Horizon ensure power users, designers, and engineers can get a fabulous graphics experience that is equivalent to native hardware and certified by NVIDIA and VMware for most of the important business applications.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Modes of GPU usage</h1>
                </header>
            
            <article>
                
<p>Applications running in virtual machines hosted on vSphere can make use of GPU processing power in two ways.</p>
<p><strong>vSphere DirectPath I/O</strong> is a vSphere inherent feature that leverages <strong>virtualization technology</strong> (<strong>VT</strong>)-enabled processors configured to the hosts to enhance the performance of virtual machines. <strong>General purpose Input Output</strong> (<strong>GPIO</strong>) is a processor feature of Intel/AMD CPUs known as an I/O memory management unit that assigns direct memory access transfers and device interrupts. This way, virtual machines are able to bypass the VMkernel and get direct access to the underlying physical hardware. vMotion is supported with DPIO-enabled server hardware.</p>
<p>Hardware-assisted I/O MMU virtualization is called <strong>Intel Virtualization Technology for Directed I/O</strong> (<strong>VT-d</strong>) in Intel processors and <strong>AMD I/O Virtualization</strong> (<strong>AMD-Vi</strong> or <strong>IOMMU</strong>) in AMD processors. It is a function of the chipset that assists virtual machines to get direct access to hardware I/O devices such as network cards, storage controllers, and GPUs.</p>
<p>NVIDIA GRID GPUs support vGPU, which is the capability for multiple users to share a single physical GPU in a virtualized environment. There are three types of hardware-based graphics acceleration configurations possible for Horizon View virtual desktops. vGPU offers the best performance and compatibility options.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Comparing ML workloads to GPU configurations</h1>
                </header>
            
            <article>
                
<p class="mce-root">We can compare the same ML workload by testing it with three different GPU configurations; these are as follows:</p>
<ul>
<li>GPU using DirectPath I/O on vSphere</li>
<li>GRID vGPU on vSphere</li>
<li>Native GPU on bare metal host</li>
</ul>
<p>We have tested and found that the virtualization layer (DirectPath I/O and GRID vGPU) introduced only a 4% overhead for the tested ML application. Learning times can be compared to the specific model by using two virtual machines with different configurations.</p>
<p>VM resources along with OS of two VMs with and without GPU:</p>
<ul>
<li><strong>NVIDIA GRID Configuration</strong>: 1 vGPU, 12 vCPUs, 60 GB memory, 96 GB of SSD storage, CentOS 7.2</li>
<li><strong>No GPU configuration</strong><span>: No GPU, 12 vCPUs, 60 GB memory, 96 GB of SSD storage, CentOS 7.2</span></li>
</ul>
<p>Let's look at the following table:</p>
<div>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>MNIST workload</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong><br/>
1 vGPU (sec)</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong><br/>
No GPU (sec)</strong></p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Normalized learning time<br/>
<br/></strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">1.1</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">10.01</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>CPU utilization</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">9%</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">45%</p>
</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p>vGPU reduces the training time by 10 times and CPU utilization also goes down 5 times as shown in the preceding table. ML can be referenced with two components; these are as follows:</p>
<ul>
<li>The convolutional neural network model derived from the TensorFlow library.</li>
<li>The<strong> <span>Canadian Institute For Advanced Research</span></strong> (<strong>CIFAR</strong>)-10 dataset has defined images datasets, which we utilize in ML and IT vision algorithms.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">DirectPath I/O </h1>
                </header>
            
            <article>
                
<p>First, we focus on <strong>DirectPath I/O</strong> (<strong>DPIO</strong>) passthrough mode as we scale from one GPU to four GPUs:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>CIFAR-10</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign"><strong> 1 GPU</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>2 GPUs</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>4 GPUs</strong></td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Normalized images/sec in thousands (w.r.t. 1 GPU)</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">1.1</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">2.01</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">3.77</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>CPU utilization</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">23%</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">41%</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">73%</p>
</td>
</tr>
</tbody>
</table>
<p>Images processed per second get better with the increased number of GPUs on the server. One GPU almost used to normalized data at 1,000 images/second and will grow further with the increase of GPUs. DPIO and GRID vGPU mode performance can be compared by configuring with one vGPU/VM in both modes:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>MNIST Workload</strong></p>
<p class="CDPAlignCenter CDPAlign"><strong>(lower is better)</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign"><strong>DPIO</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>GRID vGPU</strong></td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Normalized training times</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">1.1</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">1.03</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>CIFAR-10 Workload</strong></p>
<p class="CDPAlignCenter CDPAlign"><strong>(Higher is better)</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign"><strong>DPIO</strong></td>
<td class="CDPAlignCenter CDPAlign"><strong>GRID vGPU</strong></td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Normalized images/second</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">1.1</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.83</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>DPIO and GRID mode vGPU have more-or-less the same performance as one vGPU/VM. We can configure a VM with all the available GPUs on the host in DPIO, but a VM can configure a maximum of one GPU in GRID vGPU mode. We can differentiate between four VMs running the same job and a VM using four GPUs/hosts in DPIO mode:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>CIFAR-10 Workload</strong></p>
</td>
<td class="CDPAlignCenter CDPAlign"><strong>DPIO</strong></td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>DPiO (four VMs)</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>GRID vGPU (four VMs)</strong></p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Normalized images/second<br/>
(higher is better)</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">1.1</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.96</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">0.94</p>
</td>
</tr>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>CPU utilization</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">73%</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">69%</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">67%</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>We should configure virtual machines with low latency or require a shorter training time in multi-GPU DPIO mode. As they are dedicated to specific virtual machines, the rest of the virtual machines will not be able to access the GPUs on the host during this time. We can leverage virtual machines with longer latencies or learning times by configuring 1-GPU in GRID vGPU mode and enjoy the virtualization benefits.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scalability of GPU in a virtual environment</h1>
                </header>
            
            <article>
                
<p>Horizon and vSphere support vGPU, and vGPU brings the benefit of broad API support and native NVIDIA drivers with maximum scalability. NVIDIA GRID GPUs are based on the NVIDIA Kepler GPU architecture. NVIDIA GRID GPUs support vGPU capability for multiple users to share a single physical GPU in a virtualized environment. Horizon will automatically load-balance vGPU-enabled virtual desktops across compute and storage resource pools with the required GPUs, even with different pools using various user profiles. If we create two linked-clone pools, one with a K120Q profile and another with K220Q,<span> Horizon will put the first profile on hosts with K1 cards and the latter on K2 without any effort. </span><span>vGPU profiles entitle dedicated graphics memory. The GPU manager allocates memory size to meet the specific asks of each user.</span></p>
<p>The ESXi host can go up to a maximum 16 physical GPU-based graphics to be shared among different virtual machines/users.</p>
<p>Horizon have three kinds of graphics acceleration:</p>
<ul>
<li>Virtual shared graphics</li>
<li>Virtual shared passthrough graphics</li>
<li>Virtual dedicated graphics</li>
<li>Total memory (including volatile and non-volatile memory) can't exceed the maximum memory limit (6,128 GB) per virtual machine</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Containerized ML applications inside a VM</h1>
                </header>
            
            <article>
                
<p class="mce-root">The <strong>vSphere Integrated Containers</strong> architecture gives two container deployment models:</p>
<ol>
<li class="mce-root"><strong>Virtual container hosts</strong>: vSphere Integrated Containers leverages the native constructs of vSphere to provision containers. It extends the availability and performance capabilities (DRS, HA, vMotion ) of vSphere to containerized workloads. A container image can be used as a virtual machine, and developers can also consume it as a Docker API.</li>
<li class="mce-root"><strong>Docker container hosts</strong>: <span>Developers can self-provision Docker container hosts on demand and use them as a development sandbox to repackage apps. This architecture complements agile development practices and DevOps methodologies such as <strong>continuous integration</strong> (<strong>CI</strong>) and <strong>continuous deployment</strong> (<strong>CD</strong>).</span></li>
</ol>
<p class="mce-root">It will be costly and time consuming to re-architect an in-house application that is tightly coupled to its data and other application components/logic, so it cuts costs to repackage the application in a container without changing the application’s design. The learning curve for repackaging an application is small.</p>
<p class="NormalPACKT">vSphere Integrated Containers gives an option to instantiate a Docker image by using the Docker command-line interface and then deploying the container image as a VM instead of as a container on top of a Docker host, so we can get the benefits of packaging the application as a container without re-architecting it. This way, we keep the isolation of VMs. vSphere Integrated Containers is the ideal solution for application repackaging without any new infrastructure/dedicated hardware or the need to implement new tools.</p>
<p class="NormalPACKT">The repackaged containerized application can run alongside other virtual machines running traditional or containerized applications. vSphere Integrated Containers have high availability at the infrastructure level without developer intervention to support the repackaged container. We can also utilize core vSphere features such as <strong>vSphere high availability</strong> and <strong>vSphere vMotion</strong>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">vGPU scheduling and vGPU profile selection</h1>
                </header>
            
            <article>
                
<p>GPUs support by default an equal share and have to configure a fixed share as per a customer’s requirement.</p>
<p>We can configure GPU with the following two options:</p>
<ul>
<li><strong>Equal share scheduler</strong>: A physical GPU is shared among all the virtual desktops as vGPUs running on the same host. The share of processing cycles changes as vGPUs are added/removed to a GPU and the performance of a vGPU depends on whether other vGPUs are running or stopping.</li>
<li><strong>Fixed share scheduler</strong>: Each vGPU is allocated a fixed share of the physical GPU's processing cycles in spite of whether vGPUs are added to or removed from a GPU. It will be constant, even if other vGPUs are running or stopping.</li>
</ul>
<p>NVIDIA GRID vGPU on vSphere can be configured with various options for the vGPU profile that defines the GPU memory each VM can use with the maximum number of VMs that can share a single GPU.</p>
<p><strong>vGPU profiles</strong> provides a line up of virtual GPUs with different buffer memory frame sizes and numbers of heads. The number of users will be defined by the division of a frame buffer per GPU attached to a specific profile, and the number of heads denotes the supported number of displays, while the maximum resolution will be consistent across all the profiles. vGPU profiles ending in<span> </span>Q<span> </span>have to follow an application certification process the same as the NVIDIA Quadro cards for professional graphics applications. We can get 100% compatibility and performance with these applications. You can refer to this link for a list of certified applications: <a href="https://www.nvidia.com/en-us/design-visualization/solutions/virtualization/" target="_blank">https://www.nvidia.com/en-us/design-visualization/solutions/virtualization/</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Power user and designer profiles </h1>
                </header>
            
            <article>
                
<p>We can move our most demanding end users into the data center with <strong>NVIDIA Grid</strong> and <strong>Horizon</strong>. We can help these users with mobility, easy management, centralized data and security, disaster recovery protection, and other benefits of virtualization. We can bind these users with their workstation by subsequentially chaining them to a desk. Although <span><strong>Virtual Dedicated Graphics Acceleration</strong> (</span><strong>vDGA</strong>) passthrough allows remote workstation access with a 1:1 ratio with a higher cost and without any optimization of resources, now, we can have mixed workstation users along with task/knowledge users for better resource optimization. We are getting lots of options for designing a solution with the desired compatibility and performance. We can get high-quality experience with a design application on certified software and hardware by utilizing the NVIDIA platform. Profile selection depends on the primary application’s requirements, and based on these requirements we can choose the suitable Quadro-certified vGPU profile to achieve the end user’s requirements.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Knowledge and task user profiles</h1>
                </header>
            
            <article>
                
<p>Task workers mostly need <strong>Soft 3D</strong>, a software-based 3D renderer good for less graphics-intensive applications. They do not require, or get a noticeable advantage from, hardware-based 3D acceleration. Soft 3D is a standard component of Horizon.</p>
<p>Office workers and executives come into this profile, mostly using applications such as Microsoft Office, Adobe Photoshop, and other non-specialized end-user applications. A <span><strong>Virtual Shared Graphics Acceleration</strong> (</span><strong>vSGA</strong>) solution can optimize performance for this use case by providing high levels of consolidation of users across GPUs. vSGA does not provide a broad range of graphics API support, as it is always better to consider a vGPU-based solution for knowledge workers.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding vGPU hosts to a cluster with vGPU Manager</h1>
                </header>
            
            <article>
                
<p>We have to install the NVIDIA GPU manager <strong>vSphere Installation Bundle</strong> (<strong>VIB</strong>), as NVIDIA VIB has drivers that are a must for the host to identify the GPU. This will give you <strong>vGPU Manager</strong>. ESXi host's BIOS power and performance settings should be set to the high performance policy before installing the supported version of vCenter and ESXi. ESXi hosts are managed through vCenter and configured with NTP and DNS.</p>
<p> vGPU Manager VIB is loaded the same as a driver in the hypervisor. vGPU Manager can provision up to eight users to share each physical GPU. M60 can be set up to 32 users per card. This cluster must have hosts that have NVIDIA Tesla M60 vGPU. This is to optimize the distribution of resources for the GPU.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">ML with NVIDIA GPUs</h1>
                </header>
            
            <article>
                
<p>ML helps computers to work without being explicitly programmed in a user-friendly way so anyone can learn and utilize it in their daily life such as health, research, science, finance, and intelligent system:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b6adfd15-5e68-407b-bfa4-462d8e82a98f.png" style="width:52.75em;height:26.08em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Assigning a GPU in NVIDIA GRID vGPU</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Pool and farm settings in Horizon</h1>
                </header>
            
            <article>
                
<p>We have to configure a 3D farm like a normal farm in Horizon:</p>
<ol>
<li>Configure this pool in the same way as we used to configure the pool in Horizon, until we reach the <span class="packt_screen">Desktop Pool Settings</span> section.</li>
<li>Scroll to the <span class="packt_screen">Remote Display Protocol</span> section in the <span class="packt_screen">Add Desktop Pool</span> window.</li>
<li>We have to choose between two of the following options in the <span class="packt_screen">3D Renderer</span> option:
<ol>
<li>Choose either <span class="packt_screen">Hardware</span> or <span class="packt_screen">Automatic</span> for vSGA</li>
<li>Choose <span class="packt_screen">Hardware</span> for vDGA or MxGPU</li>
</ol>
</li>
</ol>
<ol start="4">
<li>Set the default display protocol to <span class="packt_screen">PCoIP</span> in the <span class="packt_screen">Desktop Pool</span> settings and allow users to decide to choose <span class="packt_screen">No</span> in the dropdown with <span class="packt_screen">3D Renderer</span> to NVIDIA GRID VGPU.</li>
<li>To enable the <span class="packt_screen">NVIDIA vGPU</span>, enable vGPU support for a virtual machine:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f6d19b35-9ffe-4199-828f-d51a494d3147.png" style="width:48.00em;height:43.92em;"/></p>
<ol start="6">
<li>Power down the virtual machine.</li>
<li><span>Click on</span> <span class="packt_screen">VM</span> <span>in the</span> <span class="packt_screen">Navigator</span> <span>window. </span><span>Select the</span> <span class="packt_screen">Manage</span> <span>tab</span> and <span class="packt_screen">Settings</span><span>. Click on the</span> <span class="packt_screen">Edit</span> <span>button:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/db018d74-04ad-4fc2-8ee0-e31a95a7c3ce.png" style="width:41.75em;height:43.33em;"/></p>
<ol start="8">
<li>Click the <span class="packt_screen">New PCI Device</span> bar and choose <span class="packt_screen">Shared PCI Device</span> and then <span class="packt_screen">Add</span> to continue:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/aeea9196-0766-4ae7-b811-6fe122d7f7c1.png" style="width:31.42em;height:32.67em;"/></p>
<ol start="9">
<li>Now it's showing that the <span class="packt_screen">NVIDIA GRID vGPU</span> device is added.</li>
<li>Configure the GPU with the <span class="packt_screen">GPU Profile Selection</span> bar and then click <span class="packt_screen">OK</span> to finish the configuration.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring hardware-accelerated graphics</h1>
                </header>
            
            <article>
                
<p>We can configure acceleration in three ways with VMware Horizon:</p>
<ul>
<li>Virtual shared graphics</li>
<li>Virtual dedicated graphics</li>
<li>Virtual shared passthrough graphics</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Virtual shared graphics acceleration</h1>
                </header>
            
            <article>
                
<p>vSGA is the driver that supports DirectX and OpenGL. vDGA configurations do use the native graphics card driver. <span>SVGA or VMware SVGA 3D is the VMware Windows Display Driver Model-compliant driver included with VMware Tools on Windows virtual desktops. This 3D graphics driver can be installed on Windows for 2D/3D and can also can be utilized for both 3D and vSGA software.</span></p>
<p>VMware SVGA 3D can be configured for both 2D/3D <span>software </span>and vSGA deployments, and a virtual desktop can be rapidly switched between either with software or hardware acceleration, without any change to the existing configuration. vSGA supports vMotion with hardware-accelerated graphics configuration. Universal driver will work across platform without any further configuration:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4edbecf2-4d3a-4070-a712-28cb4748dbe0.png" style="width:35.92em;height:37.08em;"/></p>
<p>The server’s physical GPUs are virtualized and shared with the number of guest virtual machines residing on the same host server with vSGA techniques. We have to integrate a specific driver in the hypervisor and all guest virtual machines will leverage the VMware vSGA 3D driver. vSGA has performance limitations with few applications which don't have needed API support and also have limited support for OpenGL and DirectX.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring vSGA settings in a virtual machine</h1>
                </header>
            
            <article>
                
<p>There are three existing 3D settings in vSphere and View Pool settings. We can <span>enable or disable 3D to set the 3D setting to automatic through </span>vSphere. If we change the 3D configuration, then it will revert back the amount of video memory to the default value of 96 MB, so be sure before changing the video memory. These configurations have the following: <strong>Automatic</strong> (by default), <strong>Software</strong>, and <strong>Hardware</strong>:</p>
<ol>
<li><span class="packt_screen">Enable 3D Support</span>.</li>
<li>Set the <span class="packt_screen">3D Renderer</span> to <span class="packt_screen">Automatic</span> or <span class="packt_screen">Hardware</span>.</li>
<li>Decide on the 3D video memory. <span>By default, it is 96 MB, but it can be a minimum of 64 MB and a maximum of 512 MB:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e7b01392-e9d2-4071-8042-be277dcd9b48.png" style="width:21.25em;height:5.92em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Virtual machine settings for vGPU</h1>
                </header>
            
            <article>
                
<p>Now we will set up the virtual machine settings for vGPU with following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2480088f-5c54-448e-863a-fdb617b773d1.png" style="width:28.67em;height:26.33em;"/></p>
<p>The preceding image will give us multiple configuration options as per application requirement with all security measures.</p>
<ol>
<li class="CDPAlignLeft CDPAlign"><span>Select the virtual machine to be configured and click </span><span class="packt_screen">Edit</span> <span class="packt_screen">Settings</span>.<span> </span>First, add a <span class="packt_screen">Shared PCI Device</span> and then choose the <span class="packt_screen">NVIDIA GRID vGPU</span> to enable GPU passthrough on the virtual machine:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3880b96e-86e8-4ad7-8a3f-d05a0fd9382b.png" style="width:24.17em;height:2.25em;"/></p>
<ol start="2">
<li class="CDPAlignLeft CDPAlign">Choose the required profile from <span class="packt_screen">GPU Profile</span> drop-down menu:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b6896ff3-60e0-49ef-b82f-faddf07cb4b0.png" style="width:27.92em;height:7.83em;"/></p>
<p>GPU profile string 4q notifies the size of the frame buffer (VRAM) in GB and the needed GRID license.</p>
<p>VRAM 0,1 notifies 512 MB, 1,024 MB, respectively, and so on. GRID license types are as follows:</p>
<ul>
<li>GRID virtual PC vGPUs for business desktop computing notifies with <em>b</em></li>
<li>GRID virtual application vGPUs for remote desktop session hosts notifies with <em>a</em></li>
<li>Quadro <strong>Virtual Data Center Workstation</strong> (<strong>vDWS</strong>) for workstation-specific graphics features and accelerations, such as up to four 4K monitors and certified drivers for professional applications notifies with <em>q</em>:</li>
</ul>
<p class="CDPAlignCenter CDPAlign"><img src="assets/41416a24-0888-4046-8fda-1aab3c8bea10.png" style="width:53.67em;height:39.17em;"/></p>
<p><span>Click </span><span class="packt_screen">Reserve all memory</span> when creating a virtual machine. We can manage end-to-end NVIDIA virtual GPU solutions such as Quadro vDWS and <strong>NVIDIA GRID Virtual PC</strong> (<strong>vPC</strong>) with complete vGPU visibility into their entire infrastructure at the host, guest, or application level. This helps us to become more responsive and agile for a better end-user VDI experience.</p>
<p>We can deliver a far better user experience from high-end virtual workstations to enterprise virtual workspaces, which are cost effective to purchase, easy to deploy, and efficient to operate.</p>
<p>Users such as engineers, designers, content creators, and architects using the Pascal-based GPU with the Quadro vDWS software are able to get the best experience of running both accelerated graphics and compute (CUDA and OpenCL) workloads on any virtual workstation or laptop.</p>
<p>Knowledge workers use programs such as Windows 10, Office 365, and YouTube, which need graphics acceleration to achieve a better virtual desktop user experience using the NVIDIA Pascal™-based GPU with NVIDIA GRID™ virtual PC.<span> NVIDIA</span><span> NVENC delivers better performance and user density by o</span><span>ff-loading H.264 video encoding <span>from CPU to Linux virtual workstation users,</span> which is a heavy compute task. Horizon provides customers with a single platform to publish all kinds of desktops (Windows and Linux) and applications, as per the user's graphics requirement.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GRID vPC and GRID vApps capabilities</h1>
                </header>
            
            <article>
                
<p>NVIDIA GRID has software editions based on specific use cases:</p>
<ul>
<li><strong>NVIDIA GRID Virtual Applications (vApp)</strong>: We can use it for app virtualization or RDSH-based app publishing.</li>
<li><strong>vPC</strong>: It will be suitable for a virtual desktop providing standard desktop applications, browser, and multimedia.</li>
<li><strong>NVIDIA GRID Virtual Workstation (vWS):</strong> This will be worthwhile for scientists and designers who work on powerful 3D-content creation applications such as CATIA, S, 3DExcite, Schlumberger Petrel, or Autodesk Maya, and so on. vWS only has this NVIDIA Quadro driver.</li>
</ul>
<p>NVIDIA GRID software editions can be purchased in both annual subscription, perpetual license, and in combination with support. A high-availability license server ensures users get uninterrupted work even in situations where a primary license server goes offline; then, a secondary license server will provide the license services to clients.</p>
<p>NVIDIA virtual GPU solutions and Maxwell-powered GPUs (NVIDIA® Tesla® M60, M6, and M10) are supported in this Pascal-based launch. NVIDIA virtual GPU solutions will be supported on all Pascal GPUs with the Tesla P40 and always-recommended P6 (blade) with the appropriate software licenses.</p>
<p>Even if you have Maxwell-powered GPUs with a NVIDIA GRID solution, we require Pascal GPUs to benefit from the performance improvements, increased frame buffer, larger and more granular profile sizes, bigger system memory, the ability to run both virtualized graphics and compute workloads to scale on the same GPU, and utilize the new task scheduler.</p>
<p>Features such as streamlining management and monitoring that help in application-level monitoring and integrations work on both Maxwell and Pascal cards with the NVIDIA GRID software release and GRID Management SDK 2.0. We have to choose the recommended Pascal/Maxwell boards for specific workloads.</p>
<p>We can recommend P40 or M60 for commercial customers. The P40 provides the highest performance, larger memory, and easier management, and enables the virtualization of graphics and compute (CUDA and OpenCL). The P40 is recommended when upgrading from M60 or K2 or the Skylake-based server. The M60 will continue to be offered and provides heterogeneous profiles and larger OEM server support.</p>
<p><strong>M10</strong> is suggested for customers with density-driven deployments, and for knowledge workers running everyday graphics-accelerated applications, the M10 is recommended. For high-density blade-server deployments, the P6 is a recommended to follow on to the M6.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GRID vWS to Quadro vDWS</h1>
                </header>
            
            <article>
                
<p>We can leverage Quadro/GRID capabilities and compare it with VMware virtual workstation/PC/virtual apps solutions. NVIDIA GRID vWS is now <strong>NVIDIA Quadro Virtual Data Center Workstation</strong> or <strong>Quadro vDWS</strong>. The GRID brand will be used to describe a PC experience and will have two editions: NVIDIA GRID vPC and NVIDIA GRID vApps. While these 2 software editions were once called the NVIDIA GRID software platform, they will now be referred to as <strong>NVIDIA virtual GPU solutions</strong>.</p>
<p><span>MxGPU is a GPU virtualization technique with a built-in hardware engine responsible for VM scheduling and management. It leverages the underlying SR-IOV protocol as per the application's requirement. GPUs that are in passthrough mode can’t be virtualized, so first run the script to disable passthrough mode. If MxGPU is enabled and vCenter is accessible, then use the plugin to configure instead of the script. vDGA can help a user with unrestricted and dedicated access to a single vGPU by providing direct passthrough to a physical GPU. The steps for installing the driver on a VM using an MxGPU device are the same for a regular passthrough device under vDGA.</span></p>
<p>Configure the virtual machine while using MxGPU and vDGA:</p>
<ol>
<li>
<p>For devices with a large BAR size, such as Tesla P40, we have to set the configuration parameters on the VM:</p>
<ul>
<li>
<p><kbd>firmware="efi"</kbd></p>
</li>
<li>
<p><kbd>pciPassthru.use64bitMMIO="TRUE"</kbd></p>
</li>
<li>
<p><kbd>pciPassthru.64bitMMIOSizeGB="64"</kbd></p>
</li>
</ul>
</li>
<li class="CDPAlignLeft CDPAlign">Add a <span class="packt_screen">PCI Device</span> to the specific virtual machine and choose the required <span class="packt_screen">PCI Device</span> to enable GPU passthrough:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/cd8d8197-d58c-4c15-993b-d45a0a3abdf4.png" style="width:34.42em;height:35.75em;"/></p>
<ol start="3">
<li>Log into vSphere Web Client via the Administrator account on the <span class="packt_screen">Home</span> page and click <span class="packt_screen">Radeon Pro</span> <span class="packt_screen">Settings</span>. Go to the <span class="packt_screen">Data Center</span> and manage all MxGPU hosts in a specific data center.</li>
<li class="CDPAlignLeft CDPAlign">We can install <span class="packt_screen">Radeon Pro Settings</span> on the <span class="packt_screen">vSphere Client</span> plugin with MxGPU:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2d4fa7d3-2595-4625-ad4b-05b91ccdeb52.png"/></p>
<p style="padding-left: 60px">VMware supports both AMD and NVIDIA graphics cards. We can download the appropriate VMware graphics driver from the vendor website to use the graphics card or GPU hardware. We can add <span class="packt_screen">PCI Device</span> to a single virtual machine as well as to multiple virtual machines.</p>
<ol start="5">
<li>To add a <span class="packt_screen">PCI Device</span> for a number of virtual machines in one go with commands, do the following:
<ol>
<li>Browse to the AMD FirePro VIB driver and install AMD VIB utility: <kbd>cd /&lt;path_to_vib from ssh</kbd>.</li>
<li>Edit <kbd>vms.cfg: vi vms.cfg</kbd>.</li>
</ol>
</li>
<li>Press <em>I</em> and change the instances of <kbd>.*</kbd> to match the names of the VMs that require a GPU like to match <kbd>*MxGPU*</kbd> to VM names that include MxGPU: <kbd>.MxGPU</kbd>.</li>
<li>Save and quit by pressing <em>Esc</em>, type <kbd>:wq</kbd>, and press <em>Enter.</em></li>
</ol>
<ol start="8">
<li>Assign the virtual functions to the VMs:</li>
</ol>
<pre class="mce-root" style="padding-left: 90px">sh mxgpu-install.sh –a assign <br/>Eligible VMs:<br/>WIN10-MxGPU-001<br/>WIN10-MxGPU-002<br/>WIN8.1-MxGPU-001<br/>WIN8.1-MxGPU-002<br/><span>These VMs will be assigned a VF, is it OK?[Y/N]y</span></pre>
<ol start="9">
<li><span>Press <em>Enter</em> and c</span><span>hoose</span><span class="packt_screen"><span class="packt_screen"><span> </span></span>Reserve all guest memory (All locked)</span>.</li>
<li>Reboot the system to automatically assign <strong>Virtual Function</strong> <span>(</span><strong>VF</strong><span>) by using the MxGPU script.</span></li>
</ol>
<p><span>We should then verify that all VFs are populated in the device list. This way, we can automatically assign VF by using the script.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>Remote computing solutions for applications such as CAD/CAM, diagnostic imaging, molecular design, and space exploration proved elusive. NVIDIA GRID vGPU technology and VMware, vSphere, and Horizon virtualization software offer cost-effective solutions for design engineers, scientific investigators, and data explorers.</p>
<p>Horizon offers software-based graphics acceleration, which is sufficient for basic use, but hardware-based graphics acceleration have different combinations of GRID graphics cards with server configurations and can be used to address a wide range of advanced user requirements and fulfil them within a budget. We can configure the GPU in two modes:</p>
<ul>
<li class="mce-root">DirectPath I/O passthrough mode</li>
<li class="mce-root">GRID vGPU mode</li>
</ul>
<p>Shared access to the virtualized GPU makes immersive 3D graphics applications accessible from remote devices. This solution eliminates the need for dedicated graphics workstations, improving security and freeing the users from their offices.</p>
<p class="mce-root">The next chapter is about strategies for hosting applications in such ways as to provide freedom to end users as well as full control to administrator/service providers with policy-based operations based on ML algorithms, which will also help in improving the end-user experience.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<ul>
<li><em>VMware Documentation</em><span> </span>at <a href="https://www.vmware.com/support/pubs/">https://www.vmware.com/support/pubs/</a></li>
<li><em>VMware Compatibility Guide</em><span> </span>at <a href="https://www.vmware.com/resources/compatibility/search.php">https://www.vmware.com/resources/compatibility/search.php</a></li>
<li><em>vSphere 6.0 Configuration Maximums</em><span> </span>guide at<em> </em><a href="https://www.vmware.com/pdf/vsphere6/r60/vsphere-60-configuration-maximums.pdf">https://www.vmware.com/pdf/vsphere6/r60/vsphere-60-configuration-maximums.pdf</a></li>
<li><em>VMware vCenter Server</em><span> </span>datasheet at <a href="http://www.vmware.com/files/pdf/products/vCenter/VMware-vCenter-Server-Datasheet.pdf">http://www.vmware.com/files/pdf/products/vCenter/VMware-vCenter-Server-Datasheet.pdf</a></li>
<li><em>VMware vSphere</em><span> </span>datasheet at <a href="http://www.vmware.com/files/pdf/vsphere/VMW-vSPHR-Datasheet-6-0.pdf">http://www.vmware.com/files/pdf/vsphere/VMW-vSPHR-Datasheet-6-0.pdf</a></li>
<li><em>VMware Horizon 7</em><span> </span>datasheet at <a href="http://www.vmware.com/files/pdf/products/horizon/vmware-horizon-7-datasheet.pdf">http://www.vmware.com/files/pdf/products/horizon/vmware-horizon-7-datasheet.pdf</a></li>
<li><em>Multisite deployment best practices for each solution component</em><span> </span>at <a href="https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/techpaper/vmware-horizon-7-enterprise-edition-reference-architecture-multi-site.pdf">https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/techpaper/vmware-horizon-7-enterprise-edition-reference-architecture-multi-site.pdf</a></li>
<li><em>NVIDIA vGPU deployment guide for VMware Horizon 7.x</em><span> </span>at <a href="https://images.nvidia.com/content/pdf/vgpu/guides/vmware-horizon-vsphere-deployment_guide.pdf">https://images.nvidia.com/content/pdf/vgpu/guides/vmware-horizon-vsphere-deployment_guide.pdf</a></li>
<li><em>Preparing for NVIDIA GRID vGPU capabilities—VMware docs</em><span> </span>at <a href="https://docs.vmware.com/en/VMware-Horizon-7/7.6/horizon-virtual-desktops/GUID-AB1B6311-DB31-4982-ACDF-0E1A5ED3B17D.html">https://docs.vmware.com/en/VMware-Horizon-7/7.6/horizon-virtual-desktops/GUID-AB1B6311-DB31-4982-ACDF-0E1A5ED3B17D.html</a></li>
<li><em>Configuring desktop pools in Horizon Administrator</em><span> </span>and for complete information and a detailed procedure at <a href="https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/products/horizon/grid-vgpu-deployment-guide.pdf">https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/products/horizon/grid-vgpu-deployment-guide.pdf</a></li>
</ul>


            </article>

            
        </section>
    </body></html>
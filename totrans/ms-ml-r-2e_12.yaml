- en: Time Series and Causality
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间序列与因果关系
- en: '"An economist is an expert who will know tomorrow why the things he predicted
    yesterday didn''t happen today."'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: “一个经济学家是一个专家，他将知道明天为什么他昨天预测的事情今天没有发生。”
- en: '- Laurence J. Peter'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '- 拉乌尔·J·彼得'
- en: A univariate time series is where the measurements are collected over a standard
    measure of time, which could be by the minute, hour, day, week, or month. What
    makes the time series problematic over the other data is that the order of the
    observations probably matters. This dependency of order can cause the standard
    analysis methods to produce an unnecessarily high bias or variance.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 单变量时间序列是测量在标准时间度量上收集的，这可能是以分钟、小时、天、周或月为单位。使时间序列相对于其他数据成为问题的是观测的顺序可能很重要。这种顺序的依赖性可能导致标准分析方法的偏差或方差过高。
- en: It seems that there is a paucity of literature on machine learning and time
    series data. This is unfortunate as so much of real-world data involves a time
    component. Furthermore, time series analysis can be quite complicated and tricky.
    I would say that if you haven't seen a time series analysis done incorrectly,
    you haven't been looking close enough.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 似乎关于机器学习和时间序列数据的文献很少。这是不幸的，因为现实世界中的大量数据都涉及时间成分。此外，时间序列分析可能相当复杂且棘手。我可以说，如果你没有看到时间序列分析被错误地执行，那么你可能没有足够仔细地观察。
- en: Another aspect involving time series that is often neglected is causality. Yes,
    we don't want to confuse correlation with causation, but in time series analysis,
    one can apply the technique of Granger causality in order to determine if causality,
    statistically speaking, exists.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个常被忽视的与时间序列相关的问题是因果关系。是的，我们不希望混淆相关性与因果关系，但在时间序列分析中，可以通过应用格兰杰因果关系的技巧来确定是否存在因果关系（从统计学的角度来说）。
- en: In this chapter, we will apply time series/econometric techniques to identify
    univariate forecast models, vector autoregression models, and finally, Granger
    causality. After completing the chapter, you may not be a complete master of the
    time series analysis, but you will know enough to perform an effective analysis
    and understand the fundamental issues to consider when building time series models
    and creating predictive models (forecasts).
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将应用时间序列/计量经济学技术来识别单变量预测模型、向量自回归模型，最后是格兰杰因果关系。完成本章后，你可能不会成为时间序列分析的完全大师，但你将知道足够多的知识来进行有效的分析，并了解在构建时间序列模型和创建预测模型（预测）时需要考虑的基本问题。
- en: Univariate time series analysis
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 单变量时间序列分析
- en: 'We will focus on two methods to analyze and forecast a single time series:
    **exponential smoothing** and **autoregressive integrated moving average** (**ARIMA**)
    models. We will start by looking at exponential smoothing models.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将关注两种分析和预测单一时间序列的方法：**指数平滑**和**自回归积分移动平均**（**ARIMA**）模型。我们将首先查看指数平滑模型。
- en: 'Like moving average models, exponential smoothing models use weights for past
    observations. But unlike moving average models, the more recent the observation
    the more weight it is given relative to the later ones. There are three possible
    smoothing parameters to estimate: the overall smoothing parameter, a trend parameter,
    and smoothing parameter. If no trend or seasonality is present, then these parameters
    become null.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 与移动平均模型一样，指数平滑模型使用过去观测的权重。但与移动平均模型不同，越近期的观测得到的权重相对于较晚的观测越大。有三个可能的平滑参数可以估计：整体平滑参数、趋势参数和季节性平滑参数。如果没有趋势或季节性，那么这些参数将变为零。
- en: 'The smoothing parameter produces a forecast with the following equation:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 平滑参数产生以下方程的预测：
- en: '*Yt+1 = α(Yt) + (1 – α)Yt-1 + (1-α)2Yt-2 +…, where 0 < α ≤ 1*'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '*Yt+1 = α(Yt) + (1 – α)Yt-1 + (1-α)2Yt-2 +…，其中 0 < α ≤ 1*'
- en: In this equation, *Y[t]* is the value at the time T, and alpha (*α*) is the
    smoothing parameter. Algorithms optimize the alpha (and other parameters) by minimizing
    the errors, for example, **sum of squared error** (**SSE**) or **mean squared
    error** (**MSE**).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个方程中，*Y[t]* 是时间 T 的值，而 alpha (*α*) 是平滑参数。算法通过最小化误差来优化 alpha（以及其他参数），例如，**平方误差和**（**SSE**）或**均方误差**（**MSE**）。
- en: 'The forecast equation along with trend and seasonality equations, if applicable,
    will be as follows:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 预测方程以及趋势和季节性方程（如果适用），将如下所示：
- en: The forecast, where *A* is the preceding smoothing equation and *h* is the number
    of forecast periods, *Y[t+h] = A + hB[t] + S[t]*
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测，其中 *A* 是前一个平滑方程，*h* 是预测期数，*Y[t+h] = A + hB[t] + S[t]*
- en: The trend equation,  *B[t] = β(A[t] – A[t-1]) + (1 – β)B[t-1]*
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 趋势方程，*B[t] = β(A[t] – A[t-1]) + (1 – β)B[t-1]*
- en: The seasonality, where *m* is the number of seasonal periods, *S[t] = Ω(Y[t]
    – A[t-1] – B[t-1]) + (1 - Ω)S[t-m]*
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 季节性，其中 *m* 是季节性周期的数量， *S[t] = Ω(Y[t] – A[t-1] – B[t-1]) + (1 - Ω)S[t-m]*
- en: This equation is referred to as the **Holt-Winters Method**. The forecast equation
    is additive in nature with the trend as linear. The method also allows the inclusion
    of a dampened trend and multiplicative seasonality, where the seasonality proportionally
    increases or decreases over time. In my experience, the Holt-Winter's Method provides
    the best forecasts, even better than the ARIMA models. I have come to this conclusion
    on having to update long-term forecasts for hundreds of time series based on monthly
    data, and in roughly 90 percent of the cases, Holt-Winters produced minimal forecast
    error. Additionally, you don't have to worry about the assumption of stationarity
    as in an ARIMA model. Stationarity is where the time series has a constant mean,
    variance, and correlation between all the time periods. Having said this, it is
    still important to understand the ARIMA models as there will be situations where
    they have the best performance.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 这个方程被称为 **Holt-Winters 方法**。预测方程本质上是加性的，趋势是线性的。该方法还允许包含一个衰减趋势和乘性季节性，其中季节性随时间成比例增加或减少。根据我的经验，Holt-Winters
    方法提供了最佳的预测，甚至比 ARIMA 模型更好。我得出这个结论是因为我不得不基于月度数据更新数百个时间序列的长期预测，并且在大约 90% 的情况下，Holt-Winters
    产生了最小的预测误差。此外，你不必担心像 ARIMA 模型中的平稳性假设。平稳性是指时间序列在所有时间段内具有恒定的均值、方差和相关性。话虽如此，了解 ARIMA
    模型仍然很重要，因为会有一些情况下它们的性能最佳。
- en: 'Starting with the autoregressive model, the value of *Y* at time *T* is a linear
    function of the prior values of *Y*. The formula for an autoregressive lag-1 model *AR(1)*,
    is *Yt = constant + ΦYt-1 + Et*. The critical assumptions for the model are as
    follows:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 从自回归模型开始，时间 *T* 的 *Y* 值是 *Y* 的先前值的线性函数。自回归滞后-1模型 *AR(1)* 的公式是 *Yt = constant
    + ΦYt-1 + Et*。该模型的关键假设如下：
- en: '*Et* denotes the errors that are identically and independently distributed
    with a mean zero and constant variance'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Et* 表示具有零均值和恒定方差的同分布且相互独立的误差'
- en: The errors are independent of *Yt*
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 误差与 *Yt* 无关
- en: '*Yt, Yt-1, Yt-n...* is stationary, which means that the absolute value of *Φ*
    is less than one'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Yt, Yt-1, Yt-n...* 是平稳的，这意味着 *Φ* 的绝对值小于一'
- en: 'With a stationary time series, you can examine **Autocorrelation Function**
    (**ACF**). The ACF of a stationary series gives correlations between *Yt* and
    *Yt-h* for *h = 1, 2...n*. Let''s use R to create an *AR(1)* series and plot it.
    In doing so, we will also look at the capabilities of the `ggfortify` package,
    which acts as a wrapper around `ggplot2` functions:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 对于平稳时间序列，你可以检查 **自相关函数** (**ACF**)。平稳序列的 ACF 给出了 *Yt* 和 *Yt-h* 之间的相关性，其中 *h
    = 1, 2...n*。让我们使用 R 来创建一个 *AR(1)* 序列并绘制它。在这个过程中，我们还将查看 `ggfortify` 包的功能，它作为 `ggplot2`
    函数的包装器：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The following is the output of the preceding command:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的输出是前一个命令的结果：
- en: '![](img/image_11_01.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_01.png)'
- en: 'Now, let''s examine `ACF`:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们来检查 `ACF`：
- en: '[PRE1]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The output of the preceding command is as follows:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 前一个命令的输出如下：
- en: '![](img/image_11_02.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_02.png)'
- en: 'The **ACF** plot shows the correlations exponentially decreasing as the **Lag**
    increases. The dotted blue lines indicate the confidence bands of a significant
    correlation. Any line that extends above the high or below the low band is considered
    significant. In addition to ACF, one should also examine **Partial Autocorrelation
    Function** (**PACF**). PACF is a conditional correlation, which means that the
    correlation between *Yt* and *Yt-h* is conditional on the observations that come
    between the two. One way to intuitively understand this is to think of a linear
    regression model and its coefficients. Let''s assume that you have *Y = B0 + B1X1*
    versus *Y = B0 + B1X1 + B2X2*. The relationship of *X* to *Y* in the first model
    is linear with a coefficient, but in the second model, the coefficient will be
    different because of the relationship between *Y* and *X2* now being accounted
    for as well. Note that in the following `PACF` plot, the partial autocorrelation
    value at lag-1 is identical to the autocorrelation value at lag-1, as this is
    not a conditional correlation:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**ACF** 图像显示了随着 **滞后** 的增加，相关性指数级下降。虚线蓝色线表示显著相关性的置信区间。任何延伸到高置信区间以上或低置信区间以下的线都被认为是显著的。除了
    ACF 之外，还应该检查 **偏自相关函数** (**PACF**)。PACF 是条件相关性，这意味着 *Yt* 和 *Yt-h* 之间的相关性是在两个观察值之间的观察值条件下确定的。理解这一点的直觉方法之一是考虑一个线性回归模型及其系数。假设你有
    *Y = B0 + B1X1* 与 *Y = B0 + B1X1 + B2X2*。在第一个模型中，*X* 与 *Y* 的关系是线性的，有一个系数，但在第二个模型中，系数将不同，因为现在还要考虑
    *Y* 与 *X2* 之间的关系。注意，在以下的 `PACF` 图像中，滞后 1 处的偏自相关值与滞后 1 处的自相关值相同，因为这不是条件相关性：'
- en: '[PRE2]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The following is the output of the preceding command:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在先前的命令输出：
- en: '![](img/image_11_03.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_03.png)'
- en: We can safely make the assumption that the series is stationary from the appearance
    of the preceding time series plot. We'll look at a couple of statistical tests
    in the practical exercise to ensure that the data is stationary, but most of the
    time, the eyeball test is sufficient. If the data is not stationary, then it is
    possible to detrend the data by taking its differences. This is the Integrated
    (I) in ARIMA. After differencing, the new series becomes *ΔYt = Yt - Yt-1*. One
    should expect a first-order difference to achieve stationarity, but on some occasions,
    a second-order difference may be necessary. An ARIMA model with *AR(1)* and *I(1)*
    would be annotated as (1,1,0).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以安全地假设，从先前的时序图像来看，序列是平稳的。在实践练习中，我们将查看一些统计测试以确保数据是平稳的，但大多数情况下，目测就足够了。如果数据不是平稳的，那么可以通过取其差分来去趋势。这是
    ARIMA 中的积分 (I)。差分后，新的序列变为 *ΔYt = Yt - Yt-1*。应该期望一阶差分来实现平稳性，但在某些情况下，可能需要二阶差分。具有
    *AR(1)* 和 *I(1)* 的 ARIMA 模型将被标注为 (1,1,0)。
- en: 'The MA stands for moving average. This is not the simple moving average as
    the 50-day moving average of a stock price, it''s rather a coefficient that is
    applied to the errors. The errors are, of course, identically and independently
    distributed with a mean zero and constant variance. The formula for an *MA(1)*
    model is *Yt = constant + Et + ΘEt-1*. As we did with the *AR(1)* model, we can
    build an *MA(1)* in R, as follows:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: MA 代表移动平均。这并不是像股票价格 50 日移动平均那样的简单移动平均，而是一个应用于误差的系数。误差当然是同质独立分布的，均值为零，方差恒定。*MA(1)*
    模型的公式是 *Yt = 常数 + Et + ΘEt-1*。正如我们在 *AR(1)* 模型中所做的那样，我们可以在 R 中构建一个 *MA(1)*，如下所示：
- en: '[PRE3]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The following is the output of the preceding command:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在先前的命令输出：
- en: '![](img/image_11_04.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_04.png)'
- en: 'The `ACF` and `PACF` plots are a bit different from the *AR(1)* model. Note
    that there are some rules of thumb while looking at the plots in order to determine
    whether the model has AR and/or MA terms. They can be a bit subjective; so I will
    leave it to you to learn these heuristics, but trust R to identify the proper
    model. In the following plots, we will see a significant correlation at lag-1
    and two significant partial correlations at lag-1 and lag-2:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '`ACF` 和 `PACF` 图像与 *AR(1)* 模型略有不同。注意，在查看图像以确定模型是否具有 AR 和/或 MA 项时，有一些经验法则。它们可能有点主观；所以我会把这些启发式方法留给你去学习，但请相信
    R 可以识别正确的模型。在以下图像中，我们将看到滞后 1 处存在显著的相关性，以及滞后 1 和滞后 2 处存在两个显著的偏相关性：'
- en: '[PRE4]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The output of the preceding command is as follows:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在先前的命令输出：
- en: '![](img/image_11_05.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_05.png)'
- en: 'The preceding figure is the `ACF` plot, and now, we will see the `PACF` plot:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 上述图像是 `ACF` 图像，现在，我们将看到 `PACF` 图像：
- en: '[PRE5]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![](img/image_11_06.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_06.png)'
- en: With the ARIMA models, it is possible to incorporate seasonality, including
    the autoregressive, integrated, and moving average terms. The nonseasonal ARIMA
    model notation is commonly (p,d,q). With seasonal ARIMA, assume that the data
    is monthly, then the notation would be (p,d,q) x (P,D,Q)12, with the '12' in the
    notation taking the monthly seasonality into account. In the packages that we
    will use, R will automatically identify whether the seasonality should be included;
    if so, the optimal terms will be included as well.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 ARIMA 模型，可以纳入季节性，包括自回归、积分和移动平均项。非季节性 ARIMA 模型的表示通常为 (p,d,q)。对于季节性 ARIMA，假设数据是按月度，那么表示将是
    (p,d,q) x (P,D,Q)12，其中表示中的 '12' 考虑了月度季节性。在我们将使用的包中，R 将自动识别是否应该包含季节性；如果是，将包括最优项。
- en: Understanding Granger causality
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解格兰杰因果性
- en: 'Imagine you are asked a question such as, "What is the relationship between
    the amount of new prescriptions and total prescriptions for medicine X?". You
    know that these are measured monthly, so what could you do to understand that
    relationship, given that people believe that new scripts will drive up total scripts.
    Or, how about testing the hypothesis that commodity prices, in particular copper,
    is a leading indicator of stock market prices in the US? Well, with two sets of
    time series data, *x* and *y*, Granger causality is a method that attempts to
    determine whether one series is likely to influence a change in the other. This
    is done by taking different lags of one series and using this to model the change
    in the second series. To accomplish this, we will create two models that will
    predict *y*, one with only the past values of *y* (`Ω`) and the other with the
    past values of *y* and *x* (`π`). The models are as follows, where *k* is the
    number of lags in the time series:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你被问到一个问题，例如，“新处方数量和药物 X 的总处方数量之间有什么关系？”。你知道这些是按月度测量的，所以你该如何理解这种关系，鉴于人们认为新处方将推高总处方数量。或者，测试商品价格（特别是铜价）是否是美国股市价格领先指标的这个假设如何？好吧，使用两套时间序列数据，*x*
    和 *y*，格兰杰因果性是一种试图确定一个序列是否可能影响另一个序列变化的方法。这是通过取一个序列的不同滞后并使用它来建模第二个序列的变化来完成的。为了实现这一点，我们将创建两个模型来预测
    *y*，一个只包含 *y* 的过去值 (`Ω`)，另一个包含 *y* 和 *x* 的过去值 (`π`)。模型如下，其中 *k* 是时间序列中的滞后数：
- en: '![](img/image_11_07.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_07.png)'
- en: 'The RSS are then compared and `F-test` is used to determine whether the nested
    model `(Ω)` is adequate enough to explain the future values of *y* or whether
    the full model (`π`) is better. `F-test` is used to test the following null and
    alternate hypotheses:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将 RSS 进行比较，并使用 `F-test` 来确定嵌套模型 `(Ω)` 是否足够充分地解释 *y* 的未来值，或者是否完整模型 (`π`) 更好。`F-test`
    用于检验以下零假设和备择假设：
- en: '*H0*: `αi = 0` for each *i* `∊[1,k]`, no Granger causality'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*H0*: 对于每个 *i* `∊[1,k]`，`αi = 0`，不存在格兰杰因果性'
- en: '*H1*: `αi ≠ 0` for at least one *i* `∊[1,k]`, Granger causality'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*H1*: 至少存在一个 *i* `∊[1,k]` 使得 `αi ≠ 0`，格兰杰因果性'
- en: Essentially, we are trying to determine whether we can say that statistically,
    *x* provides more information about the future values of *y* than the past values
    of *y* alone. In this definition, it is clear that we are not trying to prove
    actual causation; only that the two values are related by some phenomenon. Along
    these lines, we must also run this model in reverse in order to verify that *y*
    does not provide information about the future values of *x*. If we find that this
    is the case, it is likely that there is some exogenous variable, say *Z*, that
    needs to be controlled or would possibly be a better candidate for the Granger
    causation. To avoid spurious results, the method should be applied to a stationary
    time series. Note that research papers are available that discuss the techniques
    nonlinear models use, but this is outside of the scope for this book; however,
    we will examine it from a non-stationary standpoint. There is an excellent introductory
    paper that revolves around the age-old conundrum of the chicken and the egg (Thurman,
    1988).
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 实质上，我们试图确定我们是否可以说，从统计上讲，*x*比*y*的过去值提供更多关于*y*未来值的信息。在这个定义中，很明显，我们并不是试图证明实际的因果关系；只是说这两个值通过某种现象相关联。沿着这个思路，我们还必须以相反的方向运行这个模型，以验证*y*不会提供关于*x*未来值的信息。如果我们发现这种情况成立，那么很可能存在一些外生变量，比如*Z*，需要控制，或者可能是格兰杰因果关系的更好候选者。为了避免虚假结果，该方法应应用于平稳时间序列。请注意，有一些研究论文讨论了非线性模型使用的技巧，但这超出了本书的范围；然而，我们将从非平稳的角度来考察它。有一篇出色的介绍性论文围绕着古老的“先有鸡还是先有蛋”的难题（Thurman，1988）。
- en: There are a couple of different ways to identify the proper lag structure. Naturally,
    one can use brute force and ignorance to test all the reasonable lags, one at
    a time. One may have a rational intuition based on domain expertise or perhaps
    prior research that exists to guide the lag selection. If not, then **Vector Autoregression**
    (**VAR**) can be applied to identify the lag structure with the lowest information
    criterion, such as **Aikake's Information Criterion** (**AIC**) or **Final Prediction
    Error** (**FPE**). For simplicity, here is the notation for the VAR models with
    two variables, and this incorporates only one lag for each variable. This notation
    can be extended for as many variables and lags as appropriate.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种不同的方法可以识别适当的滞后结构。自然地，一个人可以使用蛮力和无知来测试所有合理的滞后，一次一个。一个人可能基于领域专业知识或可能存在的先前研究而有一个合理的直觉来指导滞后选择。如果没有，那么**向量自回归**（**VAR**）可以用来识别具有最低信息准则的滞后结构，例如**赤池信息准则**（**AIC**）或**最终预测误差**（**FPE**）。为了简单起见，这里给出两个变量的VAR模型的符号，并且每个变量只包含一个滞后。这个符号可以扩展到适当数量的变量和滞后。
- en: '*Y = constant[1] + B[11]Y[t-1] + B[12]Y[t-1] + e[1]*'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Y = constant[1] + B[11]Y[t-1] + B[12]Y[t-1] + e[1]*'
- en: '*X = constant[1] + B2[1]Y[t-1] + B2[2]Y[t-1] + e2*'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*X = constant[1] + B2[1]Y[t-1] + B2[2]Y[t-1] + e2*'
- en: In R, this process is quite simple to implement as we will see in the following
    practical problem.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在R中，这个过程实施起来相当简单，我们将在下面的实际问题中看到。
- en: Business understanding
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 商业理解
- en: The planet isn't going anywhere. We are! We're goin' away.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 地球不会走开。是我们自己要走。
- en: '- Philosopher and comedian, George Carlin'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '- 哲学家和喜剧演员，乔治·卡尔林'
- en: Climate change is happening. It always has and will, but the big question, at
    least from a political and economic standpoint, is I the climate change man-made?
    I will use this chapter to put econometric time series modeling to the test to
    try and learn whether carbon emissions cause, statistically speaking, climate
    change, and in particular, rising temperatures. Personally, I would like to take
    a neutral stance on the issue, always keeping in mind the tenets that Mr. Carlin
    left for us in his teachings on the subject.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 气候变化正在发生。它始终如此，并将继续如此，但至少从政治和经济角度来看，最大的问题是气候变化是否是人为造成的？我将利用本章内容对计量经济学时间序列模型进行测试，以尝试了解碳排放是否在统计上导致气候变化，特别是气温上升。就我个人而言，我愿意对这个问题保持中立立场，始终牢记卡尔林先生在其关于该主题的教诲中留给我们的原则。
- en: The first order of business is to find and gather the data. For temperature,
    I chose the **HadCRUT4** annual median temperature time series, which is probably
    the gold standard. This data is compiled by a cooperative effort of the Climate
    Research Unit of the University of East Anglia and the Hadley Centre at the UK's
    Meteorological Office. A full discussion of how the data is compiled and modeled
    is available at [http://www.metoffice.gov.uk/hadobs/index.html](http://www.metoffice.gov.uk/hadobs/index.html).
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 第一件事是找到并收集数据。对于温度，我选择了**HadCRUT4**年际平均温度时间序列，这可能是金标准。这些数据是由东安格利亚大学的气候研究单位和英国气象办公室的哈德尔中心合作编制的。关于数据编制和建模的完整讨论可在[http://www.metoffice.gov.uk/hadobs/index.html](http://www.metoffice.gov.uk/hadobs/index.html)找到。
- en: 'The data that we will use is provided as an annual anomaly, which is calculated
    as the difference of the median annual surface temperature for a given time period versus
    the average of the reference years (1961-1990). The annual surface temperature
    is an ensemble of the temperatures collected globally and blended from the **CRUTEM4**
    surface air temperature and **HadSST3** sea-surface datasets. This data has come
    under attack as biased and unreliable: [http://www.telegraph.co.uk/comment/11561629/Top-scientists-start-to-examine-fiddled-global-warming-figures.html](http://www.telegraph.co.uk/comment/11561629/Top-scientists-start-to-examine-fiddled-global-warming-figures.html).
    This is way outside of our scope of effort here, so we must accept and utilize
    this data as it is. I''ve pulled the data from 1919 March, 1958 through 2013 to
    match our CO2 data.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用的数据是以年异常值的形式提供的，它是通过给定时间段的平均年地表温度的中位数与参考年（1961-1990年）的平均值之差来计算的。年地表温度是全球收集的温度数据集，由**CRUTEM4**地表空气温度和**HadSST3**海表数据集混合而成。这些数据因存在偏差和不准确而被质疑：[http://www.telegraph.co.uk/comment/11561629/Top-scientists-start-to-examine-fiddled-global-warming-figures.html](http://www.telegraph.co.uk/comment/11561629/Top-scientists-start-to-examine-fiddled-global-warming-figures.html)。这超出了我们努力的范围，因此我们必须接受并利用这些数据，就像它们现在这样。我从1919年3月到2013年之间提取了数据，以匹配我们的二氧化碳数据。
- en: 'Global CO2 emission estimates can be found at the **Carbon Dioxide Information
    Analysis Center** (**CDIAC**) of the US Department of Energy at the following
    website:  [http://cdiac.ornl.gov/](http://cdiac.ornl.gov/)'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 全球二氧化碳排放估计可以在美国能源部**二氧化碳信息分析中心**（**CDIAC**）的以下网站找到：[http://cdiac.ornl.gov/](http://cdiac.ornl.gov/)
- en: 'I''ve placed the data in a `.csv` file (`climate.csv`) for you to download
    and store in your working directory: [https://github.com/datameister66/data/](https://github.com/datameister66/data/)'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 我已经将数据放在了一个`.csv`文件（`climate.csv`）中，供您下载并存储在您的当前工作目录：[https://github.com/datameister66/data/](https://github.com/datameister66/data/)
- en: 'Let''s load it and examine the structure:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们加载它并检查其结构：
- en: '[PRE6]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Finally, we will put this in a time series structure, specifying the start
    and end years:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将将其放入时间序列结构中，指定起始和结束年份：
- en: '[PRE7]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: With our data loaded and put in time series structures, we can now begin to
    understand and further prepare it for analysis.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据加载并放入时间序列结构后，我们现在可以开始理解和进一步准备它以进行分析。
- en: Data understanding and preparation
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据理解和准备
- en: 'Two packages are required for this effort, so ensure they are installed on
    your system:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 需要两个包来完成这项工作，所以请确保它们已安装在你的系统上：
- en: '[PRE8]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Let''s start out with plots of the two time series:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从两个时间序列的图中开始：
- en: '[PRE9]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The output of the preceding command is as follows:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 前一个命令的输出如下：
- en: '![](img/image_11_08-1.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_08-1.png)'
- en: 'It appears that CO2 levels really started to increase after World War II and
    a rapid rise in temperature anomalies in the mid-1970s. There does not appear
    to be any obvious outliers, and variation over time appears constant. Using the
    standard procedure, we can see that the two series are highly correlated, as follows:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来，二氧化碳水平确实是在二战后开始增加的，并且在20世纪70年代中期温度异常值急剧上升。似乎没有明显的异常值，并且随时间的变化似乎是恒定的。使用标准程序，我们可以看到两个序列高度相关，如下所示：
- en: '[PRE10]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'As discussed earlier, this is nothing to jump for joy about as it proves absolutely
    nothing. We will look for the structure by plotting `ACF` and `PACF` for both
    series:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，这没有什么值得高兴的，因为它绝对证明不了任何东西。我们将通过绘制两个序列的`ACF`和`PACF`来寻找结构：
- en: '[PRE11]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The output of the preceding code snippet is as follows:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 前一段代码片段的输出如下：
- en: '![](img/image_11_09-1.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_09-1.png)'
- en: 'This code gives us the `PACF` plot for temperature:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码为我们提供了温度的`PACF`图：
- en: '[PRE12]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The output of the preceding code snippet is as follows:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 前一段代码片段的输出如下：
- en: '![](img/image_11_10.png)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_10.png)'
- en: 'This code gives us the `ACF` plot for `CO2`:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码为我们提供了`CO2`的`ACF`图：
- en: '[PRE13]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The output of the preceding code snippet is as follows:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码片段的输出如下：
- en: '![](img/image_11_11-2.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_11-2.png)'
- en: 'This code gives us the `PACF` plot for `CO2`:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码为我们提供了`CO2`的`PACF`图：
- en: '[PRE14]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The output of the preceding code snippet is as follows:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码片段的输出如下：
- en: '![](img/image_11_12-1.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_12-1.png)'
- en: 'With the slowly decaying ACF patterns and rapidly decaying PACF patterns, we
    can assume that these series are both autoregressive, although temp appears to
    have some significant MA terms. Next, let''s have a look at **Cross Correlation
    Function** (**CCF**). Note that we put our *x* before our *y* in the function:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 由于ACF模式缓慢衰减和PACF模式迅速衰减，我们可以假设这些序列都是自回归的，尽管温度似乎有一些显著的MA项。接下来，让我们看看**交叉相关函数**（**CCF**）。请注意，我们在函数中将我们的*x*放在*y*之前：
- en: '[PRE15]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](img/image_11_13-1.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_13-1.png)'
- en: '**CCF** shows us the correlation between the temperature and lags of CO2\.
     If the negative lags of the *x* variable have a high correlation, we can say
    that *x* leads *y*. If the positive lags of *x* have a high correlation, we say
    that *x* lags *y*. Here, we can see that CO2 is both a leading and lagging variable.
    For our analysis, it is encouraging that we see the former, but odd that we see
    the latter. We will see during the VAR and Granger causality analysis whether
    this will matter or not.'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**CCF**显示了温度和二氧化碳滞后之间的相关性。如果*x*变量的负滞后具有高相关性，我们可以说*x*领先*y*。如果*x*的正滞后具有高相关性，我们说*x*滞后*y*。在这里，我们可以看到CO2既是领先变量也是滞后变量。对于我们的分析，看到前者是令人鼓舞的，但看到后者是奇怪的。我们将在VAR和格兰杰因果分析中看到这是否会成为问题。'
- en: 'Additionally, we need to test whether the data is stationary. We can prove
    this with the **Augmented Dickey-Fuller** (**ADF**) test available in the `tseries`
    package, using the `adf.test()` function, as follows:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们还需要测试数据是否是平稳的。我们可以使用`tseries`包中可用的**增强迪基-富勒**（**ADF**）测试来证明这一点，使用`adf.test()`函数，如下所示：
- en: '[PRE16]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: For both series, we have insignificant `p-values`, so we cannot reject the null
    and conclude that they are not stationary.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这两个序列，我们都有不显著的`p值`，因此我们不能拒绝零假设，并得出它们不是平稳的结论。
- en: Having explored the data, let's begin the modeling process, starting with the
    application of univariate techniques to the temperature anomalies.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在探索了数据之后，让我们开始建模过程，从将单变量技术应用于温度异常开始。
- en: Modeling and evaluation
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 建模和评估
- en: For the modeling and evaluation step, we will focus on three tasks. The first
    is to produce a univariate forecast model applied to just the surface temperature.
    The second is to develop a regression model of the surface temperature based on
    itself and CO2 levels, using that output to inform our work on whether CO2 levels Granger
    cause the surface temperature anomalies.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在建模和评估步骤中，我们将关注三个任务。第一个任务是仅针对地表温度产生一个单变量预测模型。第二个任务是开发一个基于地表温度和二氧化碳水平的回归模型，利用该输出结果来告知我们关于二氧化碳水平是否是地表温度异常的格兰杰原因的研究工作。
- en: Univariate time series forecasting
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 单变量时间序列预测
- en: 'With this task, the objective is to produce a univariate forecast for the surface
    temperature, focusing on choosing either a Holt linear trend model or an ARIMA
    model. We will train the models and determine their predictive accuracy on an
    out-of-time test set, just like we''ve done in other learning endeavors. The following
    code creates the temperature subset and then the train and test sets, starting
    after WWII:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个任务中，目标是产生一个针对地表温度的单变量预测，重点是选择霍尔特线性趋势模型或ARIMA模型。我们将训练模型，并在一个时间外的测试集上确定它们的预测准确性，就像我们在其他学习尝试中所做的那样。以下代码创建了温度子集，然后是训练集和测试集，从二战后开始：
- en: '[PRE17]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'To build our smoothing model, we will use the `holt()` function found in the
    `forecast` package. We will build two models, one with and one without a damped
    trend. In this function, we will need to specify the time series, number of forecast
    periods as *h = ...*, method to select the initial state values, either `"optimal"`
    or `"simple"`, and whether we want a damped trend. Specifying `"optimal"`, the
    algorithm will find optimal initial starting values along with the smoothing parameters,
    while `"simple"` calculates starting values using the first few observations.
    Now, in the `forecast` package, you can use the `ets()` function, which will find
    all the optimal parameters. However, in our case, let''s stick with `holt()` so
    that we can compare methods. Let''s try the `holt` model without a damped trend,
    as follows:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 要构建我们的平滑模型，我们将使用`forecast`包中的`holt()`函数。我们将构建两个模型，一个带有，一个不带阻尼趋势。在这个函数中，我们需要指定时间序列，预测期数作为*h
    = ...*，选择初始状态值的方法，即`"optimal"`或`"simple"`，以及我们是否想要阻尼趋势。指定`"optimal"`，算法将找到最优的初始起始值以及平滑参数，而`"simple"`使用前几个观测值来计算起始值。现在，在`forecast`包中，你可以使用`ets()`函数，它将找到所有最优参数。然而，在我们的情况下，让我们继续使用`holt()`，这样我们可以比较方法。让我们尝试不带阻尼趋势的`holt`模型，如下所示：
- en: '[PRE18]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Plot the `forecast` and see how well it performed out of sample with the following
    code:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下代码绘制`forecast`并查看其在样本外表现如何：
- en: '[PRE19]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The output of the preceding code is as follows:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 前面代码的输出如下：
- en: '![](img/image_11_14-1.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_14-1.png)'
- en: 'Looking at the plot, it seems that this forecast is showing a slight linear
    uptrend. Let''s have a go by including the `damped` trend, as follows:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 观察图表，似乎这个预测显示了一个轻微的线性上升趋势。让我们尝试加入`damped`趋势，如下所示：
- en: '[PRE20]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The output of the preceding code is as follows:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 前面代码的输出如下：
- en: '![](img/image_11_15-1.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_15-1.png)'
- en: 'Lastly, in univariate analysis, we develop an `ARIMA` model, using `auto.arima()`,
    which is also from the `forecast` package. There are many options that you can
    specify in the function, or you can just include your time series data and it
    will find the best `ARIMA` fit:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，在单变量分析中，我们使用`auto.arima()`构建了一个`ARIMA`模型，它也来自`forecast`包。你可以在函数中指定许多选项，或者你只需包括你的时间序列数据，它将找到最佳的`ARIMA`拟合：
- en: '[PRE21]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The abbreviated output shows that the model selected is an MA = 1, I = 1, or
    `ARIMA(0,1,1)` with drift (equivalent to an intercept term). We can examine the
    plot of its performance on the `test` data in the same fashion as before:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 简化的输出显示，选定的模型是一个MA = 1，I = 1，或者`ARIMA(0,1,1)`带有漂移（相当于截距项）。我们可以以前面的方式检查其在`test`数据上的性能图：
- en: '[PRE22]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The output of the preceding code is as follows:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 前面代码的输出如下：
- en: '![](img/image_11_16-1.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_16-1.png)'
- en: 'This is very similar to the `holt` method with no damped trend. We can score
    each model to find the one that provides the lowest error, mean absolute percentage
    error (MAPE), with the following code:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 这与不带阻尼趋势的`holt`方法非常相似。我们可以对每个模型进行评分，以找到提供最低误差、平均绝对百分比误差（MAPE）的模型，以下代码所示：
- en: '[PRE23]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The forecast error is slightly less with the ARIMA 0,1,1 versus the `holt` methods,
    and clearly, the damped trend model performed the worst.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 与`holt`方法相比，ARIMA 0,1,1的预测误差略低，并且很明显，阻尼趋势模型表现最差。
- en: With the statistical and visual evidence, it seems that the best choice for
    a univariate forecast model is the ARIMA model. Interestingly, in the first edition
    using annual data, the Holt method with a damped trend had the best accuracy.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 通过统计和视觉证据，似乎对于单变量预测模型的最佳选择是ARIMA模型。有趣的是，在第一版使用年度数据时，带有阻尼趋势的Holt方法具有最佳的准确性。
- en: With this, we've completed the building of a univariate forecast model for the
    surface temperature anomalies, and now we will move on to the next task of seeing
    if CO2 levels cause these anomalies.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这样，我们已经完成了构建表面温度异常的单变量预测模型，现在我们将继续进行下一个任务，看看CO2水平是否导致这些异常。
- en: Examining the causality
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检查因果关系
- en: For this chapter, this is where I think the rubber meets the road and we will
    separate causality from mere correlation, well, statistically speaking anyway.
    This is not the first time that this technique has been applied to the problem.
    Triacca (2005) found no evidence to suggest that atmospheric CO2 Granger caused
    the surface temperature anomalies. On the other hand, Kodra (2010) concluded that
    there is a causal relationship, but put forth the caveat that their data was not
    stationary even after a second-order differencing. While this effort will not
    settle the debate, it will hopefully inspire you to apply the methodology in your
    personal endeavors. The topic at hand certainly provides an effective training
    ground to demonstrate the Granger causality.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章内容，我认为这是理论与实践相结合的关键点，我们将从纯粹的关联中区分出因果关系，好吧，至少从统计学的角度来说是这样。这不是第一次将这种技术应用于这个问题。Triacca（2005）没有找到任何证据表明大气中的二氧化碳是导致地表温度异常的格兰杰原因。另一方面，Kodra（2010）得出结论，存在因果关系，但指出他们的数据即使在二阶差分后也不是平稳的。虽然这项工作不能解决争议，但希望它能激发你在个人努力中应用这种方法。当前的主题确实提供了一个有效的训练场，以展示格兰杰因果关系。
- en: Our plan here is to first demonstrate spurious linear regression where the residuals
    suffer from autocorrelation, also known as serial correlation. Then, we will examine
    two different approaches to Granger causality. The first will be the traditional
    methods, where both series are stationary. Then, we will look at the method demonstrated
    by Toda and Yamamoto (1995), which applies the methodology to the raw data or,
    as it is sometimes called, the "levels".
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的计划是首先展示虚假的线性回归，其中残差受到自相关性的影响，也称为序列相关性。然后，我们将检查两种不同的格兰杰因果关系的处理方法。第一种将是传统方法，其中两个序列都是平稳的。然后，我们将查看Toda和Yamamoto（1995）展示的方法，该方法将该方法应用于原始数据，有时也称为“水平”。
- en: Linear regression
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 线性回归
- en: 'Let''s get started with the spurious regression then, which I have seen implemented
    in the real world far too often. Here we simply build a linear model and examine
    the results:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始虚假回归，我在现实世界中看到这种回归被实施得太频繁了。在这里，我们只是构建一个线性模型并检查结果：
- en: '[PRE24]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Notice how everything is significant, and we have an adjusted R-squared of 0.7\.
    OK, they are highly correlated but this is all meaningless as discussed by Granger
    and Newbold (1974). Again, I have seen results like these presented in meetings
    with many people with advanced degrees, and I had to be the bad guy and challenge
    the results.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 注意到一切都是显著的，我们的调整R平方为0.7。好吧，它们高度相关，但正如Granger和Newbold（1974）所讨论的，这都没有意义。再次强调，我曾在许多拥有高级学位的人的会议上看到过类似的结果，我不得不扮演“坏人”的角色，挑战这些结果。
- en: 'We can plot the serial correlation, starting with a time series plot of the
    residuals, which produce a clear pattern:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以绘制序列相关性图，从残差的时间序列图开始，这将产生一个清晰的模式：
- en: '[PRE25]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'The output of the preceding code is as follows:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码的输出如下：
- en: '![](img/image_11_17-1.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_17-1.png)'
- en: 'Then we create an ACF plot showing significant autocorrelation out to lag 10:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们创建一个ACF图，显示到滞后10的显著自相关：
- en: '[PRE26]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '![](img/image_11_18-1.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/image_11_18-1.png)'
- en: 'You can test for autocorrelation by performing the `Durbin-Watson test`. The
    null hypothesis in the test is no autocorrelation exists:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过执行`Durbin-Watson测试`来测试自相关性。测试中的零假设是没有自相关性存在：
- en: '[PRE27]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: From examining the plots, it comes as no surprise that we can safely reject
    the null hypothesis of no autocorrelation. The simple way to deal with autocorrelation
    is to incorporate lagged variables of the dependent time series and/or to make
    all the data stationary. We will do that next using vector autoregression to identify
    the appropriate lag structure to incorporate in our causality efforts.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 从观察图表来看，我们安全地拒绝无自相关性的零假设并不令人惊讶。处理自相关性的简单方法是将依赖时间序列的滞后变量纳入考虑，或者使所有数据平稳。我们将在下一步使用向量自回归来识别在因果关系努力中应包含的适当滞后结构。
- en: Vector autoregression
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 向量自回归
- en: 'We''ve seen in the preceding section that temperature is stationary and CO2
    requires a first order difference. Another simple way to show this is with the
    `forecast` package''s  `ndiffs()` function. It provides an output that spells
    out the minimum number of differences needed to make the data stationary. In the
    function, you can specify which test out of the three available ones you would
    like to use: **Kwiatkowski, Philips, Schmidt & Shin** (**KPSS**), **Augmented
    Dickey Fuller** (**ADF**), or **Philips-Peron** (**PP**). I will use ADF in the
    following code, which has a null hypothesis that the data is not stationary:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节中，我们已经看到温度是平稳的，而CO2需要一阶差分。另一种简单的方法是使用`forecast`包的`ndiffs()`函数。它提供了一个输出，说明了使数据平稳所需的最小差分数。在函数中，你可以指定你想使用三个可用测试中的哪一个：**Kwiatkowski,
    Philips, Schmidt & Shin**（**KPSS**），**Augmented Dickey Fuller**（**ADF**），或**Philips-Peron**（**PP**）。我将使用ADF，其零假设是数据不是平稳的：
- en: '[PRE28]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'We see that both require a first order difference to become stationary. To
    get started, we will create the difference. Then, we will complete the traditional
    approach, where both series are stationary. Let''s also load our packages for
    this exercise:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，两者都需要一阶差分才能达到平稳。为了开始，我们将创建差分。然后，我们将完成传统方法，其中两个序列都是平稳的。让我们也加载用于此练习的包：
- en: '[PRE29]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'It is now a matter of determining the optimal lag structure based on the information
    criteria using vector autoregression. This is done with the `VARselect` function
    in the `vars` package. You only need to specify the data and number of lags in
    the model using `lag.max = x` in the function. Let''s use a maximum of 12 lags:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 现在的问题是根据信息准则确定最优滞后结构，这可以通过向量自回归来完成。这是使用`vars`包中的`VARselect`函数完成的。你只需要在函数中使用`lag.max
    = x`指定模型中的数据和滞后数。让我们使用最多12个滞后：
- en: '[PRE30]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'We called the information criteria using `lag$selection`. Four different criteria
    are provided including **AIC**, **Hannan-Quinn Criterion** (**HQ**), **Schwarz-Bayes
    Criterion** (**SC**), and **FPE**. Note that AIC and SC are covered in [Chapter
    2](e29f4d81-7287-41b9-9f2b-0baeffb00a9c.xhtml), *Linear Regression - The Blocking
    and Tackling of Machine Learning*, so I will not go over the criterion formulas
    or differences here. If you want to see the actual results for each lag, you can
    use `lag$criteria`. We can see that `AIC` and `FPE` have selected lag 5 and HQ
    and SC lag 1 as the optimal structure to a `VAR` model. It seems to make sense
    that the 5-year lag is the one to use. We will create that model using the `var()`
    function. I''ll let you try it with lag 1:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用`lag$selection`调用了信息准则。提供了四种不同的标准，包括**AIC**，**Hannan-Quinn准则**（**HQ**），**Schwarz-Bayes准则**（**SC**），和**FPE**。请注意，AIC和SC在[第2章](e29f4d81-7287-41b9-9f2b-0baeffb00a9c.xhtml)中有所介绍，*线性回归
    - 机器学习的技巧和策略*，所以这里不会介绍准则公式或差异。如果你想看到每个滞后实际的输出结果，可以使用`lag$criteria`。我们可以看到，`AIC`和`FPE`选择了滞后5，而HQ和SC选择了滞后1作为VAR模型的最优结构。似乎使用5年滞后是有意义的。我们将使用`var()`函数创建该模型。我会让你尝试使用滞后1：
- en: '[PRE31]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'The summary results are quite lengthy as it builds two separate models and
    would take up probably two whole pages. What I provide is the abbreviated output
    showing the results with temperature as the prediction:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 摘要结果相当长，因为它构建了两个单独的模型，可能需要占用两整页。我提供的是简化的输出，显示了以温度为预测变量的结果：
- en: '[PRE32]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The model was significant with a resulting adjusted R-square of 0.35.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 该模型具有显著性，其调整后的R平方为0.35。
- en: 'As we did in the previous section, we should check for serial correlation.
    Here, the `VAR` package provides the `serial.test()` function for multivariate
    autocorrelation. It offers several different tests, but let''s focus on ` Portmanteau
    Test`, and also please note that the DW test is for univariate series only. The
    null hypothesis is that autocorrelations are zero and the alternate is that they
    are not zero:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在前一节中所做的那样，我们应该检查序列相关性。在这里，`VAR`包提供了`serial.test()`函数用于多元自相关。它提供了几种不同的测试，但让我们专注于`Portmanteau
    Test`，并且请注意，DW测试仅适用于单变量序列。零假设是自相关为零，备择假设是它们不为零：
- en: '[PRE33]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: With `p-value` at `0.3481`, we do not have evidence to reject the null and can
    say that the residuals are not autocorrelated. What does the test say with 1 lag?
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在`p-value`为`0.3481`的情况下，我们没有证据拒绝零假设，可以说残差不是自相关的。这个测试在1滞后下说了什么呢？
- en: 'To do the Granger causality tests in R, you can use either the `lmtest` package
    and the `Grangertest()` function or the `causality()` function in the `vars` package.
    I''ll demonstrate the technique using `causality()`. It is very easy as you just
    need to create two objects, one for `x` causing `y` and one for `y` causing `x`, utilizing
    the `fit1` object previously created:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 在R中进行格兰杰因果检验，你可以使用`lmtest`包中的`Grangertest()`函数或`vars`包中的`causality()`函数。我将使用`causality()`函数来演示这个技术。这非常简单，你只需要创建两个对象，一个用于`x`导致`y`，另一个用于`y`导致`x`，利用之前创建的`fit1`对象：
- en: '[PRE34]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'It is now just a simple matter to call the Granger test results:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 现在调用格兰杰检验结果只是一个简单的问题：
- en: '[PRE35]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: The `p-value` value for CO2 differences of Granger causing temperature is `0.05908` and
    not significant in the other direction. So what does all this mean? The first
    thing we can say is that Y does not cause X. As for X causing Y, we cannot reject
    the null at the 0.05 significance level and therefore conclude that X does not
    Granger cause Y.  However, is that the relevant conclusion here? Remember, the
    p-value evaluates how likely the effect is if the null hypothesis is true. Also,
    remember that the test was never designed to be some binary Yay or Nay.  If this
    was a controlled experiment, it would be unlikely for us to hesitate to say we
    had insufficient evidence to reject the null, like the **Food and Drug Administration**
    (**FDS**) would do for a phase 3 clinical trial.  Since this study is based on
    observational data, I believe we can say that it is highly probable that "CO2
    emissions Granger cause Surface Temperature Anomalies". But, there is a lot of
    room for criticism on that conclusion. I mentioned upfront the controversy around
    the quality of the data.  The thing that still concerns me is what year to start
    the analysis.  I chose 1945 because it looked about right; you could say I applied
    *proc eyeball* in SAS terminology.  What year is chosen has a dramatic impact
    on the analysis, changing the lag structure and also leading to insignificant
    `p-values`.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 格兰杰导致温度差异的CO2的`p-value`值为`0.05908`，在其他方向上并不显著。那么这一切意味着什么呢？我们可以说的第一件事是Y不会导致X。至于X导致Y，我们不能在0.05的显著性水平上拒绝零假设，因此我们得出结论，X不会格兰杰导致Y。然而，这是这里相关的结论吗？记住，p-value评估的是如果零假设为真，效果发生的可能性。还要记住，这个测试从未被设计成一些二元的是或不是。如果这是一个受控实验，我们不太可能犹豫地说我们没有足够的证据来拒绝零假设，就像**食品药品监督管理局**（**FDS**）在3期临床试验中会做的那样。由于这项研究是基于观察数据的，我相信我们可以这样说，“CO2排放格兰杰导致地表温度异常”是非常可能的。但是，对这个结论有很多批评的空间。我一开始就提到了关于数据质量的争议。仍然让我担忧的是分析从哪一年开始。我选择了1945年，因为它看起来大约是正确的；你可以说我应用了SAS术语中的*proc
    eyeball*。选择哪一年对分析有巨大的影响，改变滞后结构，也导致不显著的`p-values`。
- en: 'However, we still need to model the original CO2 levels using the alternative
    Granger causality technique. The process to find the correct number of lags is
    the same as before, except we do not need to make the data stationary:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，我们仍然需要使用替代的格兰杰因果技术来模拟原始的CO2水平。找到正确滞后数目的过程与之前相同，只是我们不需要使数据平稳：
- en: '[PRE36]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Let''s try the lag 6 structure and see whether we can achieve significance,
    remembering to add one extra lag to account for the integrated series. A discussion
    on the technique and why it needs to be done is available at [http://davegiles.blogspot.de/2011/04/testing-for-granger-causality.html](http://davegiles.blogspot.de/2011/04/testing-for-granger-causality.html):'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们尝试滞后6的结构，看看我们是否可以达到显著性，记住要额外添加一个滞后项来考虑积分序列。关于这个技术和为什么需要这样做，可以在[http://davegiles.blogspot.de/2011/04/testing-for-granger-causality.html](http://davegiles.blogspot.de/2011/04/testing-for-granger-causality.html)找到讨论：
- en: '[PRE37]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Now, to determine Granger causality for X causing Y, you conduct a Wald test,
    where the coefficients of X and only X are 0 in the equation to predict Y, remembering
    to not include the extra coefficients that account for integration in the test.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为了确定X导致Y的格兰杰因果性，你进行一个Wald测试，其中X和仅X的系数在预测Y的方程中为0，记住不要在测试中包含解释积分的额外系数。
- en: The Wald test in R is available in the `aod` package we've already loaded. We
    need to specify the coefficients of the full model, its variance-covariance matrix,
    and the coefficients of the causative variable.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: R中的Wald测试在已经加载的`aod`包中可用。我们需要指定完整模型的系数、其方差-协方差矩阵以及因果变量的系数。
- en: The coefficients for Temp that we need to test in the VAR object consist of
    a range of even numbers from 2 to 12, while the coefficients for CO2 are odd from
    1 to 11\. Instead of using c(2, 4, 6, and so on) in our function, let's create
    an object with base R's `seq()` function.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在VAR对象中我们需要测试的Temp系数包括从2到12的偶数范围，而CO2的系数则是从1到11的奇数。在我们的函数中，我们不用c(2, 4, 6，等等)，而是用base
    R的`seq()`函数创建一个对象。
- en: 'First, let''s see how CO2 does Granger causing temperature:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们看看CO2是如何导致温度的格兰杰因果关系的：
- en: '[PRE38]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'We are now ready to run the `wald` test, described in the following code:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以运行以下代码中描述的`wald`测试：
- en: '[PRE39]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'How about that? We are close to the magical 0.05 `p-value`. Let''s test the
    other direction causality with the following code:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 怎么样？我们接近了神奇的0.05 `p-value`。让我们用以下代码测试其他方向的因果关系：
- en: '[PRE40]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'The last thing to show here is how to use a vector autoregression to produce
    a forecast. A `predict` function is available, so let''s `autoplot()` it for a
    25-year period and see what happens:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 最后要展示的是如何使用向量自回归来生成预测。`predict`函数可用，所以让我们用`autoplot()`函数对其25年期的预测进行可视化，看看会发生什么：
- en: '[PRE41]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '![](img/image_11_19.png)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![](img/image_11_19.png)'
- en: It seems dark days lie ahead, perhaps, to coin a phrase, "Winter is Coming" from
    the popular TV series Game of Thrones. Fine by me as my investment and savings
    plan for a long time has consisted of canned goods and ammunition. What else am
    I supposed to do, ride a horse to work? I'll do that the day Al Gore does. In
    the meantime, I am going to work on my suntan.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来，黑暗的日子即将来临，或许可以说，就像流行电视剧《权力的游戏》中的“冬天就要来了”。对我来说这没什么，因为我的长期投资和储蓄计划一直包括罐头食品和弹药。我还能做什么呢，骑马去上班？只有当戈尔来做的时候，我才会这么做。与此同时，我将致力于我的晒黑工作。
- en: If nothing else, I hope it has stimulated your thinking on how to apply the
    technique to your own real-world problems or maybe even to examine the climate
    change data in more detail. There should be a high bar when it comes to demonstrating
    causality, and Granger causality is a great tool for assisting in that endeavor.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有别的，我希望这能激发你对如何将这项技术应用到自己的实际问题中，或者甚至更深入地检查气候变化数据的思考。在证明因果关系时，应该有一个很高的标准，而格兰杰因果关系是辅助这一努力的一个伟大工具。
- en: Summary
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, the goal was to discuss how important the element of time is
    in the field of machine learning and analytics, to identify the common traps when
    analyzing the time series, and demonstrate the techniques and methods to work
    around these traps. We explored both the univariate and bivariate time series
    analyses for global temperature anomalies and human carbon dioxide emissions.
    Additionally, we looked at Granger causality to determine whether we can say,
    statistically speaking, that atmospheric CO2 levels cause surface temperature
    anomalies. We discovered that the p-values are higher than 0.05 but less than
    0.10 for Granger causality from CO2 to temperature. It does show that Granger
    causality is an effective tool in investigating causality in machine learning
    problems. In the next chapter, we will shift gears and take a look at how to apply
    learning methods to textual data.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，目标是讨论时间元素在机器学习和分析领域的重要性，识别分析时间序列时的常见陷阱，并展示绕过这些陷阱的技术和方法。我们探讨了全球温度异常和人类二氧化碳排放的单变量和双变量时间序列分析。此外，我们还研究了格兰杰因果关系，以确定我们是否可以说，从统计学的角度来看，大气CO2水平导致地表温度异常。我们发现，从CO2到温度的格兰杰因果关系的p值高于0.05但低于0.10。这确实表明，格兰杰因果关系是研究机器学习问题中因果关系的有效工具。在下一章中，我们将转换方向，探讨如何将学习方法应用于文本数据。
- en: Additionally, keep in mind that in time series analysis, we just skimmed the
    surface. I encourage you to explore other techniques around changepoint detection,
    decomposition of time series, nonlinear forecasting, and many others. Although
    not usually considered part of the machine learning toolbox, I believe you will
    find it an invaluable addition to yours.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，请记住，在时间序列分析中，我们只是触及了表面。我鼓励你探索关于变化点检测、时间序列分解、非线性预测等许多其他技术。尽管通常不被认为是机器学习工具箱的一部分，但我相信你会发现它对你的工具箱来说是一个无价的补充。

<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer284">
<h1 class="chapter-number" id="_idParaDest-160"><a id="_idTextAnchor210"/>11</h1>
<h1 id="_idParaDest-161"><a id="_idTextAnchor211"/>Working with Model Object, Optimized (MOJO)</h1>
<p>As we learned in <a href="B17298_10.xhtml#_idTextAnchor196"><em class="italic">Chapter 10</em></a>, <em class="italic">Working with Plain Old Java Objects (POJOs)</em>, when working with production systems, we need portable software that we can easily deploy to our production servers. It is especially important in <strong class="bold">Machine Learning</strong> (<strong class="bold">ML</strong>) services that ML models <a id="_idIndexMarker1079"/>be portable and self-sufficient. This helps engineers deploy new models regularly without worrying about breaking their systems in production because of any dependency issues.</p>
<p>H2O’s model POJOs were a good solution to this problem. Model POJOs are H2O models that can be <a id="_idIndexMarker1080"/>extracted in the form of Java POJOs that you can directly run using <strong class="bold">Java Virtual Machine</strong> (<strong class="bold">JVM</strong>) with the help of <strong class="source-inline">h2o-genmodel.jar</strong>. </p>
<p>However, model POJOs have certain drawbacks that prevent them from being the best solution to all these problems. When it comes to the portability of software packages, including POJOs, the smaller the object, the faster it is to deploy it. POJOs have an inherent limit on the size of the source files, which is up to 1 GB. Thus, models larger than 1 GB cannot be extracted as POJOs and at the same time, large models can be slow to deploy and perform.</p>
<p>That is why the team at H2O.ai created an alternative to POJOs called <strong class="bold">Model Object, Optimized</strong> (<strong class="bold">MOJO</strong>). MOJOs are low-latency, self-sufficient, and standalone objects that <a id="_idIndexMarker1081"/>can be easily deployed in production. They are smaller and faster counterparts to POJOs and are as easy to extract and use as POJO<a id="_idTextAnchor212"/>s.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Understanding what a MOJO is</li>
<li>Extracting H2O models as MOJOs</li>
<li>Viewing model MOJOs</li>
<li>Using H2O AutoML model MOJOs to make predictions</li>
</ul>
<p>By the end of this chapter, you will be able to understand the difference between POJOs and MOJOs, extract trained models in the form of MOJOs using Python, R, or H2O Flow, and then use those MOJO models to load your ML program to make predictions.</p>
<h1 id="_idParaDest-162"><a id="_idTextAnchor213"/>Technical requirements</h1>
<p>In this chapter, you will need the following:</p>
<ul>
<li>The latest version of your preferred web browser</li>
<li>An <strong class="bold">Integrated Development Environment</strong> (<strong class="bold">IDE</strong>) of your choice</li>
<li>(Optional) Jupyter Notebook by Project Jupyter (<a href="https://jupyter.org/">https://jupyter.org/</a>)</li>
</ul>
<p>All the experiments conducted in this chapter are performed on a Terminal. You are free to follow along using the same setup or perform the same experiments using any IDE of your choice. All code examples for this chapter can be found on GitHub at <a href="https://github.com/PacktPublishing/Practical-Automated-Machine-Learning-on-H2O/tree/main/Chapter%2011">https://github.com/PacktPublishing/Practical-Automated-Machine-Learning-on-H2O/tree/main/Chapter%2011</a>.</p>
<h1 id="_idParaDest-163"><a id="_idTextAnchor214"/>Understanding what a MOJO is</h1>
<p><strong class="bold">MOJOs</strong> are counterparts to H2O model POJOs and technically work in the same way. H2O can build and <a id="_idIndexMarker1082"/>extract models trained in the form of MOJOs, and you can use the extracted MOJOs to deploy and make predictions on inbound data.</p>
<p>So, what makes MOJOs different from POJOs?</p>
<p>POJOs have <a id="_idIndexMarker1083"/>certain drawbacks that make them slightly less than ideal to use in a <a id="_idIndexMarker1084"/>production environment, as follows:</p>
<ul>
<li>POJOs are not supported for source files larger than 1 GB, so any models with a size larger than <a id="_idIndexMarker1085"/>1 GB cannot be compiled to POJOs.</li>
<li>POJOs do not support stacked ensemble models or Word2Vec models.</li>
</ul>
<p>MOJOs, on the <a id="_idIndexMarker1086"/>other hand, have the following <a id="_idIndexMarker1087"/>additional benefits:</p>
<ul>
<li>MOJOs have <a id="_idIndexMarker1088"/>no size restrictions</li>
<li>MOJOs solve the large size issue by removing the ML tree and using a generic tree walking algorithm to navigate the model computationally</li>
<li>MOJOs are smaller in size and faster than POJOs</li>
<li>MOJOs support all types of models trained using H2O AutoML</li>
</ul>
<p>As per H2O’s in-house experiments and testing, as stated at https://docs.h2o.ai/h2o/latest-stable/h2o-docs/productionizing.xhtml#benefits-of-mojos-over-pojos, it was noticed that MOJO models are roughly 20-25 times smaller in disk space than the respective POJO models. MOJOs were also twice as fast as POJOs when <strong class="bold">hot scoring</strong>, which is when scoring is done after the JVM has been able to optimize the <a id="_idIndexMarker1089"/>execution paths. During <strong class="bold">cold scoring</strong>, which is when scoring is done before the JVM has <a id="_idIndexMarker1090"/>optimized the execution path, MOJOs showed around 10-40 times faster execution compared to POJOs. MOJOs are more efficient compared to POJOs as the size of the model increases.</p>
<p>H2O’s in-house testing also showed that when tested with 5,000 trees with a depth of 25, POJOs performed better when running binomial classification on very small trees of around 50 with 5 depths, but MOJOs performed better for multinomial classification.</p>
<p>Now that we know what MOJOs are, as well as their benefits, let’s see how we can extract models trained using H2O’s AutoML as MOJOs using simple examples.</p>
<h1 id="_idParaDest-164"><a id="_idTextAnchor215"/>Extracting H2O models as MOJOs</h1>
<p>Just like POJOs, you <a id="_idIndexMarker1091"/>can extract models trained using <a id="_idIndexMarker1092"/>H2O’s AutoML using any of the H2O-supported languages.</p>
<p>In the following sub-sections, we shall learn how to extract the model MOJOs using the Python and <a id="_idIndexMarker1093"/>R programming languages, as well as see how we <a id="_idIndexMarker1094"/>can extract model MOJOs using H2O Flow.</p>
<h2 id="_idParaDest-165"><a id="_idTextAnchor216"/>Extracting H2O models as MOJOs in Python</h2>
<p>Let’s see how <a id="_idIndexMarker1095"/>we can extract <a id="_idIndexMarker1096"/>models as MOJOs <a id="_idIndexMarker1097"/>using Python. We shall use the same <strong class="bold">Iris flower dataset</strong> for <a id="_idIndexMarker1098"/>running AutoML. </p>
<p>Follow these steps to train models using H2O AutoML. Then, we shall extract the leader model and download it as a MOJO:</p>
<ol>
<li>Import the <strong class="source-inline">h2o</strong> module and spin up your H2O server: <p class="source-code">import h2o</p><p class="source-code">h2o.init()</p></li>
<li>Import the Iris dataset by passing the appropriate location of the dataset in your system. Execute the following command:<p class="source-code">data_frame = h2o.import_file("Dataset/iris.data")</p></li>
<li>Set the feature and label names by executing the following command:<p class="source-code">features = data_frame.columns</p><p class="source-code">label = "C5"</p><p class="source-code">features.remove(label)</p></li>
<li>Initialize the H2O AutoML object by setting the value of the <strong class="source-inline">max_model</strong> parameter to <strong class="source-inline">10</strong> and the <strong class="source-inline">seed</strong> value to <strong class="source-inline">5</strong> by executing the following commands:<p class="source-code">aml=h2o.automl.H2OAutoML(max_models=10, seed = 5)</p></li>
<li>Start the AutoML process by passing the training dataset, the feature columns, and the label column as parameters, as follows:<p class="source-code">aml.train(x = features, y = label, training_frame = data_frame) </p></li>
<li>Once <a id="_idIndexMarker1099"/>training has <a id="_idIndexMarker1100"/>finished, you <a id="_idIndexMarker1101"/>can view the AutoML leaderboard by executing the following command:<p class="source-code">print(aml.leaderboard)</p></li>
</ol>
<p>You should get the following leaderboard:</p>
<div>
<div class="IMG---Figure" id="_idContainer279">
<img alt="Figure 11.1 – AutoML leaderboard for extracting MOJOs " height="272" src="image/B17298_11_001.jpg" width="766"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – AutoML leaderboard for extracting MOJOs</p>
<ol>
<li value="7">You can use <strong class="source-inline">aml.leader</strong> to get the leader model of the AutoML training. All models have an inbuilt function, <strong class="source-inline">download_mojo()</strong>, that extracts and downloads the model MOJO file:<p class="source-code">aml.leader.download_mojo()</p></li>
</ol>
<p>This should download the model MOJO to your device. You can also download a specific model from the leaderboard using <strong class="source-inline">model_id</strong>. Let’s download the DRF model, which is ranked fourth on the leaderboard. Execute the following command:</p>
<p class="source-code">DRF_model = h2o.get_model(aml.leaderboard[3,0])</p>
<p class="source-code">DRF_model.download_mojo()</p>
<p>You can also specify the path where you want the MOJO file to be downloaded by <a id="_idIndexMarker1102"/>passing the <strong class="source-inline">path</strong> parameter, along <a id="_idIndexMarker1103"/>with the location, to the <strong class="source-inline">download_mojo()</strong> function. You can also download <strong class="source-inline">h2o-genmodel.jar</strong>, along <a id="_idIndexMarker1104"/>with the MOJO file, by passing <strong class="source-inline">get_genmodel_jar</strong> as <strong class="source-inline">True</strong> in the <strong class="source-inline">download_mojo()</strong> function.</p>
<p>Let’s see how we can do the same in the<a id="_idTextAnchor217"/> R programming language.</p>
<h2 id="_idParaDest-166"><a id="_idTextAnchor218"/>Extracting H2O models as MOJOs in R</h2>
<p>Similar to how <a id="_idIndexMarker1105"/>we can <a id="_idIndexMarker1106"/>extract a model <a id="_idIndexMarker1107"/>from the AutoML leaderboard in Python, we can do the same in the R programming language. We shall use the same Iris flower dataset again to train models using H2O AutoML and then extract the leader model to download it as a POJO. Follow these steps:</p>
<ol>
<li value="1">Import the <strong class="source-inline">h2o</strong> module and spin up your H2O server: <p class="source-code">library(h2o)</p><p class="source-code">h2o.init()</p></li>
<li>Import the dataset by passing the location of the dataset in your system. Execute the following command:<p class="source-code">data_frame &lt;- h2o.importFile("Dataset/iris.data")</p></li>
<li>Set the feature and label names by executing the following commands:<p class="source-code">label &lt;- "C5"</p><p class="source-code">features &lt;- setdiff(names(data), label)</p></li>
<li>Trigger AutoML by passing the training dataset, the feature columns, and the label columns as parameters. Also, set <strong class="source-inline">max_models</strong> to <strong class="source-inline">10</strong> and the <strong class="source-inline">seed</strong> value to <strong class="source-inline">5</strong>:<p class="source-code">aml &lt;- h2o.automl(x = features, y = label, training_frame = data_frame, max_models=10, seed = 5)</p></li>
<li>Once <a id="_idIndexMarker1108"/>training <a id="_idIndexMarker1109"/>has finished and you have the leaderboard, you can access <a id="_idIndexMarker1110"/>the leader model using <strong class="source-inline">aml@leaderboard</strong>. Using the same command, we can download the leader model as a MOJO, like so:<p class="source-code">h2o.download_pojo(aml@leaderboard)</p></li>
</ol>
<p>This will start downloading the model MOJO ZIP file to your device. Similar to Python, in R, you can specify the download path as well as set the <strong class="source-inline">get_genmodel_jar</strong> parameter to <em class="italic">True</em> to download the <strong class="source-inline">h2o-genmodel.jar</strong> file, along with the MOJO ZIP file. </p>
<p>Now that we know how to extract a model MOJO in the R programming language, let’s learn how to do the same in H2O Flow.</p>
<h2 id="_idParaDest-167"><a id="_idTextAnchor219"/>Extracting H2O models as MOJOs in H2O Flow</h2>
<p>Downloading <a id="_idIndexMarker1111"/>model MOJOs in <a id="_idIndexMarker1112"/>H2O Flow is just as easy as it was with POJOs. Right beside the <strong class="bold">Download POJO</strong> button, you have another button to download MOJO models. </p>
<p>As you learned in <a href="B17298_02.xhtml#_idTextAnchor038"><em class="italic">Chapter 2</em></a>, <em class="italic">Working with H2O Flow (H2O’s Web UI)</em>, in the <em class="italic">Working with Model Training Functions in H2O Flow</em> section, you can access specific model information.</p>
<p>In the <strong class="bold">Actions</strong> subsection, you have an interactive button titled <strong class="bold">Model Deployment Package (MOJO)</strong>, as shown in the following screenshot:</p>
<div>
<div class="IMG---Figure" id="_idContainer280">
<img alt="Figure 11.2 – The Download Model Deployment Package (MOJO) button " height="207" src="image/B17298_11_002.jpg" width="1162"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – The Download Model Deployment Package (MOJO) button</p>
<p>Simply clicking on this button will download the model as a MOJO. All models can be downloaded this way by using this interactive button in H2O Flow.</p>
<p>Unlike POJOs, where you have a single Java file, MOJOs can be downloaded as <strong class="bold">ZIP files</strong> that contain <a id="_idIndexMarker1113"/>a collection <a id="_idIndexMarker1114"/>of certain <strong class="bold">configuration settings</strong>, among other files. You can extract and explore these files if you wish, but from an implementation perspective, we will be using the whole ZIP file and using it in our services.</p>
<p>But regardless of the difference between the type of file, whether it is a Java file or a ZIP file, <strong class="source-inline">h2o-genmodel.jar</strong> has interpreters and readers for both types of files that you can use to read the models and make predictions.</p>
<p>Now that we have extracted the model MOJO, let’s explore a special feature in MOJOs where we can graphically view the contents of a trained model.</p>
<h1 id="_idParaDest-168"><a id="_idTextAnchor220"/>Viewing model MOJOs</h1>
<p>You can view MOJO models <a id="_idIndexMarker1115"/>as simple human-readable graphs by using a Java tool called <strong class="bold">Graphviz</strong>. Graphviz is a piece of visualization <a id="_idIndexMarker1116"/>software that is used for graphically visualizing structural information in the form of diagrams or graphs. It is a handy tool that is often used to show technical details in networks, web designs, and ML as simple images.</p>
<p>You can install the Graphviz library in different operating systems, as follows:</p>
<ul>
<li><strong class="bold">Linux</strong>: You can <a id="_idIndexMarker1117"/>download the library by just running the following command in your Terminal:<p class="source-code"><strong class="bold">sudo apt install graphviz</strong></p></li>
<li><strong class="bold">Mac</strong>: You can use <strong class="source-inline">brew</strong> to <a id="_idIndexMarker1118"/>install this library in your Mac system. Execute the following command in your Mac Terminal:<p class="source-code"><strong class="bold">brew install graphviz</strong></p></li>
<li><strong class="bold">Windows</strong>: Graphviz has a <a id="_idIndexMarker1119"/>Windows installer that you can download from http://www.graphviz.org/download/.</li>
</ul>
<p>Once you have installed Graphviz, you can view the model graphically by using the <strong class="source-inline">PrintMojo</strong> function from the Terminal to make a <strong class="bold">PNG file</strong>.</p>
<p>Let’s try it out. Execute the following steps:</p>
<ol>
<li value="1">Once you <a id="_idIndexMarker1120"/>have downloaded your model MOJO file and installed Graphviz, you will need the <strong class="source-inline">h2o.jar</strong> file to be in the same path to access the <strong class="source-inline">printMojo()</strong> function in the <strong class="source-inline">hex</strong> class. You can download the <strong class="source-inline">h2o.jar</strong> file from http://h2o-release.s3.amazonaws.com/h2o/rel-zumbo/2/index.xhtml.</li>
<li>Once your files are ready, open your Terminal in the same directory and execute the following command:<p class="source-code"><strong class="bold">java -cp h2o.jar hex.genmodel.tools.PrintMojo --tree 0 -i "DRF_1_AutoML_4_20220801_225630.zip" -o model.gv -f 20 -d 3</strong></p></li>
</ol>
<p>We are using the DRF model we downloaded from the experiment we did in the <em class="italic">Extracting H2O model as MOJO in Python</em> section. This command generates a <strong class="source-inline">model.gv</strong> file that the Graphviz visualization tool can use to visualize the model.</p>
<ol>
<li value="3">Now, use the Graphviz tool to build a PNG file using the <strong class="source-inline">model.gv</strong> file. Execute the following code: <p class="source-code"><strong class="bold">dot -Tpng model.gv -o model.png</strong></p></li>
</ol>
<p>This generates the <strong class="source-inline">model.png</strong> file.</p>
<ol>
<li value="4">Now, open the <strong class="source-inline">model.png</strong> file; you should see an image of the model. The model should look as follows:</li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer281">
<img alt="Figure 11.3 – Model image generated from MOJO using Graphviz " height="509" src="image/B17298_11_003.jpg" width="1210"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Model image generated from MOJO using Graphviz</p>
<p>The preceding <a id="_idIndexMarker1121"/>diagram is a nice graphical representation of how the decision tree of the <strong class="bold">Distributed Random Forest</strong> (<strong class="bold">DRF</strong>) model branches. You can also generate the <a id="_idIndexMarker1122"/>model image directly with the <strong class="source-inline">PrintMojo</strong> function without needing the Graphviz library. However, this option is only available in Java 8 <a id="_idTextAnchor221"/>and higher versions.</p>
<ol>
<li value="5">Let’s try using the <strong class="source-inline">PrintMojo</strong> function to generate the model image. Execute the steps in sequence to generate an image of the model without using Graphviz.</li>
<li>Similar to the previous experiment, where we printed the model MOJO using Graphviz, make sure that you have downloaded the model MOJO and copied it into a directory, along with your <strong class="source-inline">h2o.jar</strong> file. Now, open a Terminal in the same folder and execute the following command:<p class="source-code"><strong class="bold">java -cp h2o.jar hex.genmodel.tools.PrintMojo --tree 0 -i "DRF_1_AutoML_7_20220622_170835.zip" -o tree.png --format png</strong></p></li>
</ol>
<p>The output of this command should generate a <strong class="source-inline">tree.png</strong> folder with images of the decision tree inside it. The diagram should look as follows:</p>
<div>
<div class="IMG---Figure" id="_idContainer282">
<img alt="Figure 11.4 – Graphical images for class Iris-setosa using PrintMojo without Graphviz " height="245" src="image/B17298_11_004.jpg" width="492"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – Graphical images for class Iris-setosa using PrintMojo without Graphviz</p>
<p>Since we were using an ML model that has been trained on the Iris dataset, we have a <a id="_idIndexMarker1123"/>multinomial classification model. Thus, inside the <strong class="source-inline">tree.png</strong> file, you will have individual images for every class – one for <strong class="source-inline">Iris-setosa</strong>, one for <strong class="source-inline">Iris-virginica</strong>, and one for <strong class="source-inline">Iris-versicolor</strong>.</p>
<p>Note that this feature is only available for tree-based algorithms such as DRF, GBM, and XGBoost. Linear models such as GLM and deep learning models are not supported for viewing.</p>
<p>Now that we know how to view the models from model MOJOs, let’s learn how to use MOJOs to make predictions.</p>
<h1 id="_idParaDest-169"><a id="_idTextAnchor222"/>Using H2O AutoML model MOJOs to make predictions</h1>
<p>Making <a id="_idIndexMarker1124"/>predictions using MOJOs is the same as how we make predictions using model <a id="_idIndexMarker1125"/>POJOS, albeit with some minor changes. Similar to POJOs, there is a dependency on the <strong class="source-inline">h2o-genmodel.jar</strong> file to compile and run the model MOJO to make predictions.</p>
<p>So, let’s go ahead and quickly run an experiment where we can use the model MOJO with the <strong class="source-inline">h2o-genmodel.jar</strong> file to make predictions. We shall write a Java program that imports the <strong class="source-inline">h2o-genmodel.jar</strong> file and uses its classes to load and use our model MOJO to make predictions.</p>
<p>So, let’s start by creating a folder where we can keep the H2O MOJO file needed for the experiment and then write some code that uses it. </p>
<p>Follow these steps:</p>
<ol>
<li value="1">Open your Terminal and create an empty folder by executing the following command:<p class="source-code">mkdir H2O_MOJO</p><p class="source-code">cd H2O_MOJO</p></li>
<li>Now, copy your model MOJO file to the folder by executing the following command:<p class="source-code">mv ~/Downloads/DRF_1_AutoML_7_20220622_170835.zip .</p></li>
</ol>
<p>Make sure that you change the name of the model MOJO, <strong class="source-inline">DRF_1_AutoML_7_20220622_170835.zip</strong>, to the model MOJO you are using.</p>
<ol>
<li value="3">Then, you need to download the <strong class="source-inline">h2o-genmodel.jar</strong> file. As you learned in <a href="B17298_10.xhtml#_idTextAnchor196"><em class="italic">Chapter 10</em></a>, <em class="italic">Working with Plain Old Java Objects (POJOs)</em>, there are two ways that you can do this. Either you can download the <strong class="source-inline">h2o-genmodel.jar</strong> file from your currently running local H2O server or, if you are working on a <strong class="bold">Maven</strong> project, you can just add the Maven dependency for <strong class="source-inline">h2o-genmodel</strong>, as follows:<p class="source-code">&lt;dependency&gt;</p><p class="source-code">        &lt;groupId&gt;ai.h2o&lt;/groupId&gt;</p><p class="source-code">        &lt;artifactId&gt;h2o-genmodel&lt;/artifactId&gt;</p><p class="source-code">        &lt;version&gt;3.35.0.2&lt;/version&gt;</p><p class="source-code">&lt;/dependency&gt;</p></li>
</ol>
<p>The Maven <a id="_idIndexMarker1126"/>repository for this can be found here: https://mvnrepository.com/artifact/ai.h2o/h2o-genmodel.</p>
<ol>
<li value="4">Now, let’s <a id="_idIndexMarker1127"/>create the Java program that will be making predictions using the <a id="_idIndexMarker1128"/>model MOJO. Create a Java program called <strong class="source-inline">main.java</strong> by executing the following command in<a id="_idTextAnchor223"/> your Terminal:<p class="source-code"><strong class="bold">vim main.java</strong></p></li>
</ol>
<p>This should open the <strong class="source-inline">vim</strong> editor, where you can write your code.</p>
<ol>
<li value="5">Let’s start writing our Java program:<ol><li>First, import the necessary dependencies, as follows:</li></ol><p class="source-code">import hex.genmodel.easy.RowData;</p><p class="source-code">import hex.genmodel.easy.EasyPredictModelWrapper;</p><p class="source-code">import hex.genmodel.easy.prediction.*;</p><p class="source-code">import hex.genmodel.MojoModel;</p><ol><li value="2">Then, create the <strong class="source-inline">main</strong> class, as follows:</li></ol><p class="source-code">public class main { }</p><ol><li value="3">Then, inside the <strong class="source-inline">main</strong> class, create a <strong class="source-inline">main</strong> function, as follows:</li></ol><p class="source-code">public static void main(String[] args) throws Exception { }</p><ol><li value="4">Inside <a id="_idIndexMarker1129"/>this <strong class="source-inline">main</strong> function, create the <strong class="source-inline">EasyPredictModelWrapper</strong> object by loading the MOJO model using the <strong class="source-inline">MojoModel.load()</strong> function <a id="_idIndexMarker1130"/>and passing the location of your model MOJO. The code for this is as follows:</li></ol><p class="source-code">EasyPredictModelWrapper modelMOJO = new EasyPredictModelWrapper(MojoModel.load("DRF_1_AutoML_7_20220622_170835.zip"));</p><ol><li value="5">Now that we have our model MOJO loaded and wrapped in <strong class="source-inline">EasyPredictModelWrapper</strong>, let’s create the sample data that we will use for making predictions. Add the following code to your file:</li></ol><p class="source-code">RowData row = new RowData();</p><p class="source-code">row.put("C1", 5.1);</p><p class="source-code">row.put("C2", 3.5);</p><p class="source-code">row.put("C3", 1.4);</p><p class="source-code">row.put("C4", 0.2);</p><ol><li value="6">Similar to how we did when making predictions using model POJOs, we need a prediction handler to store the prediction results from the model MOJOs. The prediction handler that’s used for POJOs also works with MOJOs. So, let’s create an appropriate multinomial prediction handler object, as follows:</li></ol><p class="source-code">MultinomialModelPrediction predictionResultHandler = modelMOJO.predictMultinomial(row);</p><ol><li value="7">Now, let’s add the necessary <strong class="source-inline">print</strong> statements so that we have a clean and <a id="_idIndexMarker1131"/>easy way to <a id="_idIndexMarker1132"/>understand the output. Add the following <strong class="source-inline">print</strong> statements:</li></ol><p class="source-code">System.out.println("Predicted Class of Iris flower is: " + predictionResultHandler.label);</p></li>
</ol>
<p><strong class="source-inline">predictionResultHandler.label</strong> will contain the predicted label value.</p>
<ol>
<li value="8">Let’s also print out the different class probabilities. Add the following code:</li>
</ol>
<p class="source-code">System.out.println("Class probabilities are: ");</p>
<p class="source-code">for (int labelClassIndex = 0; labelClassIndex &lt; predictionResultHandler.classProbabilities.length; labelClassIndex++) {</p>
<p class="source-code">        System.out.println(predictionResultHandler.classProbabilities[labelClassIndex]);</p>
<p class="source-code">}</p>
<ol>
<li value="9">Make sure all your braces are closed correctly and save the file.</li>
</ol>
<ol>
<li value="6">Once your file is ready, just compile the file by executing the following command:<p class="source-code"><strong class="bold">javac -cp h2o-genmodel.jar -J-Xmx2g -J-XX:MaxPermSize=128m main.java</strong></p></li>
<li>Once <a id="_idIndexMarker1133"/>the compilation is successful, execute the compiled file by running <a id="_idIndexMarker1134"/>the following command in your Terminal:<p class="source-code"><strong class="bold">java -cp .:h2o-genmodel.jar main</strong></p></li>
</ol>
<p>You should get the following output:</p>
<div>
<div class="IMG---Figure" id="_idContainer283">
<img alt="Figure 11.5 – Prediction results from the H2O model MOJO implementation " height="158" src="image/B17298_11_005.jpg" width="565"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 – Prediction results from the H2O model MOJO implementation</p>
<p>As you can see, using the model MOJO is just as easy as using POJOs. Both are easy to extract and use in production. However, MOJOs benefit from being smaller and faster for large-sized models, which gives them a slight edge compared to POJOs.</p>
<p>Congratulations! You now know how to build, extract, and deploy model MOJOs to make predictions.</p>
<h1 id="_idParaDest-170"><a id="_idTextAnchor224"/>Summary</h1>
<p>In this chapter, we started by understanding what the drawbacks of POJOs are. Then, we learned that H2O created a counterpart to POJOs called MOJOs, which do not have the same issues that POJOs have. Then, we learned what MOJOs are and the benefits of using them over POJOs. We learned that MOJOs are smaller and faster than POJOs. In H2O’s internal experimentation, it was found that MOJOs performed better when working with large ML models.</p>
<p>After that, we learned how to practically extract ML models trained using AutoML as MOJOs. We understood how MOJOs can be downloaded in Python, R, and H2O Flow. Another benefit that we came across with MOJOs was that there is a special function called <strong class="source-inline">PrintMojo</strong> that can be used to create graphical pictures of ML models that can be read by humans. This also makes understanding the contents of the ML model easy.</p>
<p>Building on top of this knowledge, we implemented an experiment where we used the <strong class="source-inline">h2o-genmodel.jar</strong> file, along with the model MOJO, to make predictions on sample data, thus helping us get a better understanding of how we can use MOJOs in production.</p>
<p>In the next chapter, we shall explore the various design patterns that we can use to implement H2O AutoML. This will help us understand how to implement ideal ML solutions using H2O AutoML. </p>
</div>
</div></body></html>
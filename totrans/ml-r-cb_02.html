<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;2.&#xA0;Data Exploration with RMS Titanic"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02" class="calibre1"/>Chapter 2. Data Exploration with RMS Titanic</h1></div></div></div><p class="calibre7">In this chapter, we will cover the following recipes:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Reading a Titanic dataset from a CSV file</li><li class="listitem">Converting types on character variables</li><li class="listitem">Detecting missing values</li><li class="listitem">Imputing missing values</li><li class="listitem">Exploring and visualizing data</li><li class="listitem">Predicting passenger survival with a decision tree</li><li class="listitem">Validating the power of prediction with a confusion matrix</li><li class="listitem">Assessing performance with the ROC curve</li></ul></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Data Exploration with RMS Titanic">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch02lvl1sec18" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre7">Data exploration <a id="id132" class="calibre1"/>helps a data consumer to focus on searching for information, with a view to forming a true analysis from the gathered information. Furthermore, with the completion of the steps of data munging, analysis, modeling, and evaluation, users can generate insights and valuable points from their focused data.</p><p class="calibre7">In a real data exploration project, there are six steps involved in the exploration process. They are as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Asking the right questions.</li><li class="listitem" value="2">Data collection.</li><li class="listitem" value="3">Data munging.</li><li class="listitem" value="4">Basic exploratory data analysis.</li><li class="listitem" value="5">Advanced exploratory data analysis.</li><li class="listitem" value="6">Model assessment.</li></ol><div class="calibre14"/></div><p class="calibre7">A more detailed explanation of these six steps is provided here:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1"><span class="strong"><strong class="calibre2">Asking the right questions</strong></span>: When the user presents their question, for example "What are my expected findings after the exploration is finished?", or "What kind of information can I extract through the exploration?," different <a id="id133" class="calibre1"/>results will be given. Therefore, asking the right question is essential in the first place, for the question itself determines the objective and target of the exploration.</li><li class="listitem" value="2"><span class="strong"><strong class="calibre2">Data collection</strong></span>: Once the goal of exploration is determined, the user can start collecting or extracting relevant data from the data source, with regard to the <a id="id134" class="calibre1"/>exploration target. Mostly, data<a id="id135" class="calibre1"/> collected from disparate systems appears unorganized and diverse in format. Clearly, the original data may be from different sources, such as files, databases, or the Internet. To retrieve data from these sources requires the assistance of the file IO function, JDBC/ODBC, web crawler, and so on. This extracted data is called <span class="strong"><strong class="calibre2">raw data</strong></span>, which <a id="id136" class="calibre1"/>is because it has not been subjected to processing, or been through any other manipulation. Most raw data is not easily consumed by the majority of analysis tools or visualization programs.</li><li class="listitem" value="3"><span class="strong"><strong class="calibre2">Data munging</strong></span>: The<a id="id137" class="calibre1"/> next phase is data munging (or wrangling), a step to help map raw data into a more convenient <a id="id138" class="calibre1"/>format for consumption. During this phase, there are many processes, such as data parsing, sorting, merging, filtering, missing value completion, and other processes to transform and organize the data, and enable it to fit into a consume structure. Later, the mapped data can be further utilized for data aggregation, analysis, or visualization.</li><li class="listitem" value="4"><span class="strong"><strong class="calibre2">Basic exploratory data analysis</strong></span>: After the data munging phase, users can conduct further analysis toward data processing. The most basic analysis is to perform<a id="id139" class="calibre1"/> exploratory data <a id="id140" class="calibre1"/>analysis. Exploratory data analysis involves analyzing a dataset by summarizing its characteristics. Performing basic statistical, aggregation, and visual methods are also crucial tasks to help the user understand data characteristics, which are beneficial for the user to capture the majority, trends, and outliers easily through plots.</li><li class="listitem" value="5"><span class="strong"><strong class="calibre2">Advanced exploratory data analysis</strong></span>: Until now, the descriptive statistic gives a <a id="id141" class="calibre1"/>general description<a id="id142" class="calibre1"/> of data features. However, one would like to generate an inference rule for the user to predict data features based on input parameters. Therefore, the application of machine learning enables the user to generate an inferential model, where the user <a id="id143" class="calibre1"/>can input a training dataset to generate <a id="id144" class="calibre1"/>a predictive model. After this, the prediction model can be utilized to predict the output value or label based on given parameters.</li><li class="listitem" value="6"><span class="strong"><strong class="calibre2">Model assessment</strong></span>: Finally, to assess whether the generating model performs the best in <a id="id145" class="calibre1"/>the data estimation of a given<a id="id146" class="calibre1"/> problem, one must perform a model selection. The selection method here involves many steps, including data preprocessing, tuning parameters, and even switching the machine learning algorithm. However, one thing that is important to keep in mind is that the simplest model frequently achieves the best results in predictive or exploratory power; whereas complex models often result in over fitting.</li></ol><div class="calibre14"/></div><p class="calibre7">For the following example, we would like to perform a sample data exploration based on the dataset of passengers surviving the Titanic shipwreck. The steps we demonstrate here follow how to collect data from the online source, Kaggle; clean data through data munging; perform basic exploratory data analysis to discover important attributes that might give a prediction of the survival rate; perform advanced exploratory data analysis using the classification algorithm to predict the survival rate of the given data; and finally, perform model assessment to generate a prediction model.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Reading a Titanic dataset from a CSV file"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec19" class="calibre1"/>Reading a Titanic dataset from a CSV file</h1></div></div></div><p class="calibre7">To start <a id="id147" class="calibre1"/>the exploration, we need to retrieve a dataset from Kaggle (<a class="calibre1" href="https://www.kaggle.com/">https://www.kaggle.com/</a>). We had look at <a id="id148" class="calibre1"/>some of the samples in <a class="calibre1" title="Chapter 1. Practical Machine Learning with R" href="part0015_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre8">Practical Machine Learning with R</em></span>. Here, we introduce methods to deal with real-world problems.</p></div>

<div class="book" title="Reading a Titanic dataset from a CSV file">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec44" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">To retrieve data from Kaggle, you need to first sign up for a Kaggle account (<a class="calibre1" href="https://www.kaggle.com/account/register">https://www.kaggle.com/account/register</a>). Then, log in to the account for further exploration:</p><div class="mediaobject"><img src="../images/00030.jpeg" alt="Getting ready" class="calibre9"/><div class="caption"><p class="calibre12">Kaggle.com</p></div></div><p class="calibre10"> </p></div></div>

<div class="book" title="Reading a Titanic dataset from a CSV file">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec45" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform<a id="id149" class="calibre1"/> the following steps to read <a id="id150" class="calibre1"/>the Titanic dataset from the CSV file:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to <a class="calibre1" href="http://www.kaggle.com/c/titanic-gettingStarted/data">http://www.kaggle.com/c/titanic-gettingStarted/data</a> to retrieve the data list.</li><li class="listitem" value="2">You can see a list of data files for download, as shown in the following table:<div class="informalexample"><table border="1" class="calibre15"><colgroup class="calibre16"><col class="calibre17"/><col class="calibre17"/></colgroup><thead class="calibre18"><tr class="calibre19"><th valign="bottom" class="calibre20">
<p class="calibre21">Filename</p>
</th><th valign="bottom" class="calibre20">
<p class="calibre21">Available formats</p>
</th></tr></thead><tbody class="calibre22"><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">train</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">.csv</code> (59.76 kb)</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">genderclassmodel</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">.py</code> (4.68 kb)</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">myfirstforest</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">.csv</code> (3.18 kb)</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">myfirstforest</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">.py</code> (3.83 kb)</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">gendermodel</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">.csv</code> (3.18 kb)</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">genderclassmodel</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">.csv</code> (3.18 kb)</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">test</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">.csv</code> (27.96 kb)</p>
</td></tr><tr class="calibre19"><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">gendermodel</code>
</p>
</td><td valign="top" class="calibre23">
<p class="calibre21">
<code class="literal">.py</code> (3.58 kb)</p>
</td></tr></tbody></table></div></li><li class="listitem" value="3">Download the <a id="id151" class="calibre1"/>training data (<a class="calibre1" href="https://www.kaggle.com/c/titanic-gettingStarted/download/train.csv">https://www.kaggle.com/c/titanic-gettingStarted/download/train.csv</a>) to a local disk.</li><li class="listitem" value="4">Then, make sure the downloaded file is placed under the current directory. You can use the <code class="email">getwd</code> function to check the current working directory. If the downloaded file is not located in the working directory, move the file to the current working directory. Or, you can use <code class="email">setwd()</code> to set the working directory to where the downloaded files are located:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; getwd()</strong></span>
<span class="strong"><strong class="calibre2">[1] "C:/Users/guest"</strong></span>
</pre></div></li><li class="listitem" value="5">Next, one can use <code class="email">read.csv</code> to load data into the data frame. Here, one can use<a id="id152" class="calibre1"/> the <code class="email">read.csv </code>function to read <code class="email">train.csv</code> to frame the data with the variable names set as <code class="email">train.data</code>. However, in order to treat the blank string as <code class="email">NA</code>, one can specify that <code class="email">na.strings</code> equals either <code class="email">"NA"</code> or an empty string:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.data = read.csv("train.csv", na.strings=c("NA", ""))</strong></span>
</pre></div></li><li class="listitem" value="6">Then, check the loaded data with the <code class="email">str</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; str(train.data)</strong></span>
<span class="strong"><strong class="calibre2">'data.frame': 891 obs. of  12 variables:</strong></span>
<span class="strong"><strong class="calibre2"> $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Survived   : int  0 1 1 1 0 0 0 0 1 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Pclass     : int  3 1 3 1 3 3 1 3 3 2 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Name       : Factor w/ 891 levels "Abbing, Mr. Anthony",..: 109 191 358 277 16 559 520 629 417 581 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Sex        : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Age        : num  22 38 26 35 35 NA 54 2 27 14 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Ticket     : Factor w/ 681 levels "110152","110413",..: 524 597 670 50 473 276 86 396 345 133 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Cabin      : Factor w/ 148 levels "","A10","A14",..: 1 83 1 57 1 1 131 1 1 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Embarked   : Factor w/ 4 levels "","C","Q","S": 4 2 4 4 4 3 4 4 4 2 ...</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Reading a Titanic dataset from a CSV file">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec46" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">To begin the data exploration, we first downloaded the Titanic dataset from Kaggle, a website containing many data competitions and datasets. To load the data into the data frame, this recipe demonstrates how to apply the <code class="email">read.csv</code> function to load the dataset with the <code class="email">na.strings</code> argument, for the purpose of converting blank strings and <code class="email">"NA"</code> to NA values. To see the structure of the dataset, we used the <code class="email">str</code> function to compactly display <code class="email">train.data</code>; you can find the dataset contains demographic information and survival labels of the passengers. The data collected here is good enough for beginners to practice how to process and analyze data.</p></div></div>

<div class="book" title="Reading a Titanic dataset from a CSV file">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec47" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">On<a id="id153" class="calibre1"/> Kaggle, much of the data on science is related to competitions, which mostly refer to designing a machine learning method to solve real-world problems.</p><p class="calibre7">Most competitions on Kaggle are held by either academia or corporate bodies, such as Amazon or Facebook. In fact, they create these contests and provide rewards, such as bonuses, or job prospects (see <a class="calibre1" href="https://www.kaggle.com/competitions">https://www.kaggle.com/competitions</a>). Thus, there are many <a id="id154" class="calibre1"/>data scientists who are attracted to registering for a Kaggle account to participate in competitions. A beginner in a pilot exploration can participate in one of these competitions, which will help them gain experience by solving real-world problems with their machine learning skills.</p><p class="calibre7">To create a more challenging learning environment as a competitor, a participant needs to submit their output answer and will receive the assessment score, so that each one can assess their own rank on the leader board.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Converting types on character variables"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec20" class="calibre1"/>Converting types on character variables</h1></div></div></div><p class="calibre7">In R, since<a id="id155" class="calibre1"/> nominal, ordinal, interval, and ratio variable are treated differently in statistical modeling, we have to <a id="id156" class="calibre1"/>convert a nominal variable from a character into a factor.</p></div>

<div class="book" title="Converting types on character variables">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec48" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">You need to have the previous recipe completed by loading the Titanic training data into the R session, with the <code class="email">read.csv</code> function and assigning an argument of <code class="email">na.strings</code> equal to NA and the blank string (""). Then, assign the loaded data from <code class="email">train.csv</code> into the <code class="email">train.data</code> variables.</p></div></div>

<div class="book" title="Converting types on character variables">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec49" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to convert the types on character variables:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Use the <code class="email">str</code> function to print the overview of the Titanic data:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; str(train.data)</strong></span>
<span class="strong"><strong class="calibre2">'data.frame':  891 obs. of  12 variables:</strong></span>
<span class="strong"><strong class="calibre2"> $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Survived   : int  0 1 1 1 0 0 0 0 1 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Pclass     : int  3 1 3 1 3 3 1 3 3 2 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Name       : Factor w/ 891 levels "Abbing, Mr. Anthony",..: 109 191 358 277 16 559 520 629 417 581 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Sex        : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Age        : num  22 38 26 35 35 NA 54 2 27 14 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Ticket     : Factor w/ 681 levels "110152","110413",..: 524 597 670 50 473 276 86 396 345 133 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Cabin      : Factor w/ 147 levels "A10","A14","A16",..: NA 82 NA 56 NA NA 130 NA NA NA ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Embarked   : Factor w/ 3 levels "C","Q","S": 3 1 3 3 3 2 3 3 3 1 ...</strong></span>
</pre></div></li><li class="listitem" value="2">To<a id="id157" class="calibre1"/> transform the variable from the <code class="email">int</code> numeric type to the <code class="email">factor</code> categorical type, you<a id="id158" class="calibre1"/> can cast <code class="email">factor</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.data$Survived = factor(train.data$Survived)</strong></span>
<span class="strong"><strong class="calibre2">&gt; train.data$Pclass = factor(train.data$Pclass)</strong></span>
</pre></div></li><li class="listitem" value="3">Print out the variable with the <code class="email">str</code> function and again, you can see that <code class="email">Pclass</code> and <code class="email">Survived</code> are now transformed into the factor as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; str(train.data)</strong></span>
<span class="strong"><strong class="calibre2">'data.frame':  891 obs. of  12 variables:</strong></span>
<span class="strong"><strong class="calibre2"> $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Survived   : Factor w/ 2 levels "0","1": 1 2 2 2 1 1 1 1 2 2 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Pclass     : Factor w/ 3 levels "1","2","3": 3 1 3 1 3 3 1 3 3 2 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Name       : Factor w/ 891 levels "Abbing, Mr. Anthony",..: 109 191 358 277 16 559 520 629 417 581 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Sex        : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Age        : num  22 38 26 35 35 NA 54 2 27 14 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Ticket     : Factor w/ 681 levels "110152","110413",..: 524 597 670 50 473 276 86 396 345 133 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Cabin      : Factor w/ 147 levels "A10","A14","A16",..: NA 82 NA 56 NA NA 130 NA NA NA ...</strong></span>
<span class="strong"><strong class="calibre2"> $ Embarked   : Factor w/ 3 levels "C","Q","S": 3 1 3 3 3 2 3 3 3 1 ...</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Converting types on character variables">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec50" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">Talking<a id="id159" class="calibre1"/> about <a id="id160" class="calibre1"/>statistics, there are four measurements: nominal, ordinal, interval, and ratio. Nominal variables are used to label variables, such as gender and <a id="id161" class="calibre1"/>name; ordinal variables, and are measures of non-numeric <a id="id162" class="calibre1"/>concepts, such as satisfaction and happiness. Interval variables<a id="id163" class="calibre1"/> shows numeric scales, which tell us not <a id="id164" class="calibre1"/>only the order but can also show the differences between the values, such as temperatures in Celsius. A ratio variable shows the ratio of a magnitude of a continuous quantity to a unit magnitude. Ratio variables provide order, differences between the values, and a true zero value, such as weight and height. In R, different measurements are calculated differently, so you should perform a type conversion before applying descriptive or inferential analytics toward the dataset.</p><p class="calibre7">In this recipe, we first display the structure of the train data using the <code class="email">str</code> function. From the structure of data, you can find the attribute name, data type, and the first few values contained in each attribute. From the <code class="email">Survived</code> and <code class="email">Pclass</code> attribute, you can see the data type as <code class="email">int</code>. As the variable description listed in Chart 1 (<span class="strong"><em class="calibre8">Preface</em></span>), you can see that <code class="email">Survived</code> (0 = No; 1 = Yes) and <code class="email">Pclass</code> (1 = 1st; 2 = 2nd; 3 = 3rd) are categorical variables. As a result, we transform the data from a character to a factor type via the <code class="email">factor</code> function.</p></div></div>

<div class="book" title="Converting types on character variables">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec51" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">Besides factor, there are more type conversion functions. For numeric types, there are <code class="email">is.numeric()</code> and <code class="email">as.numeric()</code>; for character, there are: <code class="email">is.character()</code> and <code class="email">as.character()</code>. For vector, there are: <code class="email">is.vector()</code> and <code class="email">as.vector()</code>; for matrix, there are <code class="email">is.matrix()</code> and <code class="email">as.matrix()</code>. Finally, for data frame, there are: <code class="email">is.data.frame()</code> and <code class="email">as.data.frame()</code>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Detecting missing values"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec21" class="calibre1"/>Detecting missing values</h1></div></div></div><p class="calibre7">Missing <a id="id165" class="calibre1"/>values reduce the<a id="id166" class="calibre1"/> representativeness of the sample, and furthermore, might distort inferences about the population. This recipe will focus on detecting missing values within the Titanic dataset.</p></div>

<div class="book" title="Detecting missing values">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec52" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">You need to have completed the previous recipes by the <code class="email">Pclass</code> attribute and <code class="email">Survived</code> to a factor type.</p><p class="calibre7">In R, a missing<a id="id167" class="calibre1"/> value is noted with the symbol <span class="strong"><strong class="calibre2">NA</strong></span> (<span class="strong"><strong class="calibre2">not available</strong></span>), and an<a id="id168" class="calibre1"/> impossible value is <span class="strong"><strong class="calibre2">NaN</strong></span> (<span class="strong"><strong class="calibre2">not a number</strong></span>).</p></div></div>

<div class="book" title="Detecting missing values">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec53" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform <a id="id169" class="calibre1"/>the following steps <a id="id170" class="calibre1"/>to detect the missing value:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">The <code class="email">is.na</code> function is used to denote which index of the attribute contains the NA value. Here, we apply it to the <code class="email">Age</code> attribute first:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; is.na(train.data$Age)</strong></span>
</pre></div></li><li class="listitem" value="2">The <code class="email">is.na</code> function indicates the missing value of the <code class="email">Age</code> attribute. To get a general number of how many missing values there are, you can perform a <code class="email">sum</code> to calculate this:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; sum(is.na(train.data$Age) == TRUE)</strong></span>
<span class="strong"><strong class="calibre2">[1] 177</strong></span>
</pre></div></li><li class="listitem" value="3">To calculate the percentage of missing values, one method adopted is to count the number of missing values against nonmissing values:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; sum(is.na(train.data$Age) == TRUE) /  length(train.data$Age)</strong></span>
<span class="strong"><strong class="calibre2">[1] 0.1986532</strong></span>
</pre></div></li><li class="listitem" value="4">To get a percentage of the missing value of the attributes, you can use <code class="email">sapply</code> to calculate the percentage of all the attributes:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; sapply(train.data, function(df) {</strong></span>
<span class="strong"><strong class="calibre2">+               sum(is.na(df)==TRUE)/ length(df);</strong></span>
<span class="strong"><strong class="calibre2">+           }) </strong></span>
<span class="strong"><strong class="calibre2">PassengerId    Survived      Pclass        Name         Sex         Age </strong></span>
<span class="strong"><strong class="calibre2">0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.198653199 </strong></span>
<span class="strong"><strong class="calibre2">      SibSp       Parch      Ticket        Fare       Cabin    Embarked </strong></span>
<span class="strong"><strong class="calibre2">0.000000000 0.000000000 0.000000000 0.000000000 0.771043771 0.002244669 </strong></span>
</pre></div></li><li class="listitem" value="5">Besides simply viewing the percentage of missing data, one may also use the <code class="email">Amelia</code> package to visualize the missing values. Here, we use <code class="email">install.packages</code> and <code class="email">require</code> to install <code class="email">Amelia</code> and load the package. However, before the installation and loading of the <code class="email">Amelia</code> package, you are required to install <code class="email">Rcpp</code>, beforehand:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages("Amelia")</strong></span>
<span class="strong"><strong class="calibre2">&gt; require(Amelia)</strong></span>
</pre></div></li><li class="listitem" value="6">Then, use the <code class="email">missmap</code> function to plot the missing value map:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; missmap(train.data, main="Missing Map")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00031.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Missing map of the Titanic dataset</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Detecting missing values">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec54" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">In R, a missing value is often noted with the <code class="email">"NA"</code> symbol, which stands for not available. Most <a id="id171" class="calibre1"/>functions (such as <code class="email">mean</code> or <code class="email">sum</code>) may output NA while encountering an NA value in the dataset. Though you can assign an argument such as <code class="email">na.rm</code> to remove the effect of NA, it is better to impute or remove the missing data in the dataset to prevent propagating the effect of the missing value. To find out the missing value in the Titanic dataset, we first sum up all the NA values and divide them by the number of values within each attribute, Then, we apply the calculation to all the attributes with <code class="email">sapply</code>.</p><p class="calibre7">In addition to this, to display the calculation results using a table, you can utilize the <code class="email">Amelia</code> package to plot the missing value map of every attribute on one chart. The visualization of missing values enables users to get a better understanding of the missing percentage within each dataset. From the preceding screenshot, you may have observed that the missing value is beige colored, and its observed value is dark red. The <span class="strong"><em class="calibre8">x</em></span>-axis shows different attribute names, and the <span class="strong"><em class="calibre8">y</em></span>-axis shows the recorded index. Clearly, most of the cabin shows missing data, and it also shows that about 19.87 percent of the data is missing when counting the <code class="email">Age</code> attribute, and two values are missing in the <code class="email">Embarked</code> attribute.</p></div></div>

<div class="book" title="Detecting missing values">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec55" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">To handle <a id="id172" class="calibre1"/>the missing values, we<a id="id173" class="calibre1"/> introduced <code class="email">Amelia</code> to visualize them. Apart from typing console commands, you can also use the interactive GUI of <code class="email">Amelia</code> and <code class="email">AmeliaView</code>, which allows users to load datasets, manage options, and run <code class="email">Amelia</code> from a windowed environment.</p><p class="calibre7">To start running <code class="email">AmeliaView</code>, simply type <code class="email">AmeliaView()</code> in the R Console:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; AmeliaView()</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00032.jpeg" alt="There's more..." class="calibre9"/><div class="caption"><p class="calibre12">AmeliaView</p></div></div><p class="calibre10"> </p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Imputing missing values"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec22" class="calibre1"/>Imputing missing values</h1></div></div></div><p class="calibre7">After detecting the<a id="id174" class="calibre1"/> number of missing values within each <a id="id175" class="calibre1"/>attribute, we have to impute the missing values since they might have a significant effect on the conclusions that can be drawn from the data.</p></div>

<div class="book" title="Imputing missing values">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec56" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">This recipe will require <code class="email">train.data</code> loaded in the R session and have the previous recipe completed by converting <code class="email">Pclass</code> and <code class="email">Survived</code> to a factor type.</p></div></div>

<div class="book" title="Imputing missing values">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec57" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to impute the missing values:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, list the distribution<a id="id176" class="calibre1"/> of <span class="strong"><strong class="calibre2">Port of Embarkation</strong></span>. Here, we add the <code class="email">useNA = "always"</code> argument to show the number of NA values contained within <code class="email">train.data</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; table(train.data$Embarked, useNA = "always")</strong></span>

<span class="strong"><strong class="calibre2">   C    Q    S &lt;NA&gt; </strong></span>
<span class="strong"><strong class="calibre2"> 168   77  644    2 </strong></span>
</pre></div></li><li class="listitem" value="2">Assign<a id="id177" class="calibre1"/> the two <a id="id178" class="calibre1"/>missing values to a more probable port (that is, the most counted port), which is Southampton in this case:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.data$Embarked[which(is.na(train.data$Embarked))] = 'S';</strong></span>
<span class="strong"><strong class="calibre2">&gt; table(train.data$Embarked, useNA = "always")</strong></span>

<span class="strong"><strong class="calibre2">   C    Q    S &lt;NA&gt; </strong></span>
<span class="strong"><strong class="calibre2"> 168   77  646    0 </strong></span>
</pre></div></li><li class="listitem" value="3">In order to discover the types of titles contained in the names of <code class="email">train.data</code>, we first tokenize <code class="email">train.data$Name</code> by blank (a regular expression pattern as <code class="email">"\\s+"</code>), and then count the frequency of occurrence with the <code class="email">table</code> function. After this, since the name title often ends with a period, we use the regular expression to grep the word containing the period. In the end, <code class="email">sort</code> the table in decreasing order:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.data$Name = as.character(train.data$Name)</strong></span>
<span class="strong"><strong class="calibre2">&gt; table_words = table(unlist(strsplit(train.data$Name, "\\s+")))</strong></span>
<span class="strong"><strong class="calibre2">&gt; sort(table_words [grep('\\.',names(table_words))], decreasing=TRUE)</strong></span>

<span class="strong"><strong class="calibre2">      Mr.     Miss.      Mrs.   Master. </strong></span>
<span class="strong"><strong class="calibre2">      517       182       125        40 </strong></span>
<span class="strong"><strong class="calibre2">      Dr.      Rev.      Col.    Major. </strong></span>
<span class="strong"><strong class="calibre2">        7         6         2            2 </strong></span>
<span class="strong"><strong class="calibre2">    Mlle.     Capt. Countess.    Don. </strong></span>
<span class="strong"><strong class="calibre2">        2         1         1                1 </strong></span>
<span class="strong"><strong class="calibre2">Jonkheer.        L.     Lady .      Mme. </strong></span>
<span class="strong"><strong class="calibre2">        1         1         1         1 </strong></span>
<span class="strong"><strong class="calibre2">      Ms.      Sir. </strong></span>
<span class="strong"><strong class="calibre2">        1         1 </strong></span>
</pre></div></li><li class="listitem" value="4">To obtain which title contains missing values, you can use <code class="email">str_match</code> provided by the <code class="email">stringr</code> package to get a substring containing a period, then bind<a id="id179" class="calibre1"/> the<a id="id180" class="calibre1"/> column together with <code class="email">cbind</code>. Finally, by using the table function to acquire the statistics of missing values, you can work on counting each title:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; library(stringr) </strong></span>
<span class="strong"><strong class="calibre2">&gt; tb = cbind(train.data$Age, str_match(train.data$Name, " [a-zA-Z]+\\."))</strong></span>
<span class="strong"><strong class="calibre2">&gt; table(tb[is.na(tb[,1]),2])</strong></span>

<span class="strong"><strong class="calibre2">     Dr.  Master.    Miss.      Mr.     Mrs. </strong></span>
<span class="strong"><strong class="calibre2">       1        4            36       119       17 </strong></span>
</pre></div></li><li class="listitem" value="5">For a title containing a missing value, one way to impute data is to assign the mean value for each title (not containing a missing value):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; mean.mr = mean(train.data$Age[grepl(" Mr\\.", train.data$Name) &amp; !is.na(train.data$Age)])</strong></span>
<span class="strong"><strong class="calibre2">&gt; mean.mrs = mean(train.data$Age[grepl(" Mrs\\.", train.data$Name) &amp; !is.na(train.data$Age)])</strong></span>
<span class="strong"><strong class="calibre2">&gt; mean.dr = mean(train.data$Age[grepl(" Dr\\.", train.data$Name) &amp; !is.na(train.data$Age)])</strong></span>
<span class="strong"><strong class="calibre2">&gt; mean.miss = mean(train.data$Age[grepl(" Miss\\.", train.data$Name) &amp; !is.na(train.data$Age)])</strong></span>
<span class="strong"><strong class="calibre2">&gt; mean.master =  mean(train.data$Age[grepl(" Master\\.", train.data$Name) &amp; !is.na(train.data$Age)])</strong></span>
</pre></div></li><li class="listitem" value="6">Then, assign the missing value with the mean value of each title:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.data$Age[grepl(" Mr\\.", train.data$Name) &amp; is.na(train.data$Age)] = mean.mr</strong></span>
<span class="strong"><strong class="calibre2">&gt; train.data$Age[grepl(" Mrs\\.", train.data$Name) &amp; is.na(train.data$Age)] = mean.mrs</strong></span>
<span class="strong"><strong class="calibre2">&gt; train.data$Age[grepl(" Dr\\.", train.data$Name) &amp; is.na(train.data$Age)] = mean.dr</strong></span>
<span class="strong"><strong class="calibre2">&gt; train.data$Age[grepl(" Miss\\.", train.data$Name) &amp; is.na(train.data$Age)] = mean.miss</strong></span>
<span class="strong"><strong class="calibre2">&gt; train.data$Age[grepl(" Master\\.", train.data$Name) &amp; is.na(train.data$Age)] = mean.master</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Imputing missing values">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec58" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">To impute the missing value of the <code class="email">Embarked</code> attribute, we first produce the statistics of the embarked port with the <code class="email">table</code> function. The <code class="email">table</code> function counts two NA values in <code class="email">train.data</code>. From the dataset description, we recognize C, Q, and S(C = Cherbourg, Q = Queenstown, S = Southampton). Since we do not have any knowledge about which category these two missing values are in, one possible way is to assign the missing value to the most likely port, which is <code class="email">Southampton</code>.</p><p class="calibre7">As for<a id="id181" class="calibre1"/> another attribute, <code class="email">Age</code>, though about 20 percent of the value is missing, users can still infer the missing <a id="id182" class="calibre1"/>value with the title of each passenger. To discover how many titles there are within the name of the dataset, we suggest the method of counting segmented words in the <code class="email">Name</code> attribute, which helps to calculate the number of missing values of each given title. The resultant word table shows common titles such as <code class="email">Mr</code>, <code class="email">Mrs</code>, <code class="email">Miss</code>, and <code class="email">Master</code>. You may reference an English honorific entry from Wikipedia to get the description of each title.</p><p class="calibre7">Considering the missing data, we reassign the mean value of each title to the missing value with the corresponding title. However, for the <code class="email">Cabin</code> attribute, there are too many missing values, and we cannot infer the value from any referencing attribute. Therefore, we find it does not work by trying to use this attribute for further analysis.</p></div></div>

<div class="book" title="Imputing missing values">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec59" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">Here we list the honorific entry from Wikipedia for your reference. According to it (<a class="calibre1" href="http://en.wikipedia.org/wiki/English_honorific">http://en.wikipedia.org/wiki/English_honorific</a>):</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre2">Mr</strong></span>: This <a id="id183" class="calibre1"/>is used for a man, regardless of his marital status</li><li class="listitem"><span class="strong"><strong class="calibre2">Master</strong></span>: This is used for young men or boys, especially used in the UK</li><li class="listitem"><span class="strong"><strong class="calibre2">Miss</strong></span>: It is usually used for unmarried women, though also used by married female entertainers</li><li class="listitem"><span class="strong"><strong class="calibre2">Mrs</strong></span>: It is used for married women</li><li class="listitem"><span class="strong"><strong class="calibre2">Dr</strong></span>: It is used for a person in the US who owns his first professional degree</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Exploring and visualizing data"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec23" class="calibre1"/>Exploring and visualizing data</h1></div></div></div><p class="calibre7">After imputing the missing values, one should perform an exploratory analysis, which involves <a id="id184" class="calibre1"/>using a visualization <a id="id185" class="calibre1"/>plot and an aggregation <a id="id186" class="calibre1"/>method to summarize the data characteristics. The result helps the<a id="id187" class="calibre1"/> user gain a better understanding of the data in use. The following recipe will introduce how to use basic plotting techniques with a view to help the user with exploratory analysis.</p></div>

<div class="book" title="Exploring and visualizing data">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec60" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">This recipe needs the previous recipe to be completed by imputing the missing value in the <code class="email">age</code> and <code class="email">Embarked</code> attribute.</p></div></div>

<div class="book" title="Exploring and visualizing data">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec61" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to explore and visualize data:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, you can use a bar plot and histogram to generate descriptive statistics for each attribute, starting with passenger survival:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; barplot(table(train.data$Survived), main="Passenger Survival",  names= c("Perished", "Survived"))</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00033.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger survival</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="2">We can generate the bar plot of passenger class:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; barplot(table(train.data$Pclass), main="Passenger Class",  names= c("first", "second", "third"))</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00034.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger class</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="3">Next, we<a id="id188" class="calibre1"/> outline the <a id="id189" class="calibre1"/>gender data with <a id="id190" class="calibre1"/>the <a id="id191" class="calibre1"/>bar plot:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; barplot(table(train.data$Sex), main="Passenger Gender")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00035.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger gender</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="4">We then plot the histogram of the different ages with the <code class="email">hist</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; hist(train.data$Age, main="Passenger Age", xlab = "Age")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00036.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger age</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="5">We <a id="id192" class="calibre1"/>can plot the bar plot<a id="id193" class="calibre1"/> of sibling <a id="id194" class="calibre1"/>passengers<a id="id195" class="calibre1"/> to get the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; barplot(table(train.data$SibSp), main="Passenger Siblings")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00037.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger siblings</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="6">Next, we can get the distribution of the passenger parch:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; barplot(table(train.data$Parch), main="Passenger Parch")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00038.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger parch</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="7">Next, we<a id="id196" class="calibre1"/> plot the histogram <a id="id197" class="calibre1"/>of the <a id="id198" class="calibre1"/>passenger<a id="id199" class="calibre1"/> fares:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; hist(train.data$Fare, main="Passenger Fare", xlab = "Fare")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00039.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger fares</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="8">Finally, one can look at the port of embarkation:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; barplot(table(train.data$Embarked), main="Port of Embarkation")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00040.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Port of embarkation</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="9">Use <code class="email">barplot</code> to<a id="id200" class="calibre1"/> find<a id="id201" class="calibre1"/> out which gender is <a id="id202" class="calibre1"/>more<a id="id203" class="calibre1"/> likely to perish during shipwrecks:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; counts = table( train.data$Survived, train.data$Sex)</strong></span>
<span class="strong"><strong class="calibre2">&gt; barplot(counts,  col=c("darkblue","red"), legend = c("Perished", "Survived"), main = "Passenger Survival by Sex")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00041.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger survival by sex</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="10">Next, we should examine whether the <code class="email">Pclass</code> factor of each passenger may affect the survival rate:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; counts = table( train.data$Survived, train.data$Pclass)</strong></span>
<span class="strong"><strong class="calibre2">&gt; barplot(counts,  col=c("darkblue","red"), legend =c("Perished", "Survived"), main= "Titanic Class Bar Plot" )</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00042.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger survival by class</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="11">Next, we<a id="id204" class="calibre1"/> examine<a id="id205" class="calibre1"/> the gender <a id="id206" class="calibre1"/>composition<a id="id207" class="calibre1"/> of each <code class="email">Pclass</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; counts = table( train.data$Sex, train.data$Pclass)</strong></span>
<span class="strong"><strong class="calibre2">&gt; barplot(counts,  col=c("darkblue","red"), legend = rownames(counts), main= "Passenger Gender by Class")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00043.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger gender by class</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="12">Furthermore, we examine the histogram of passenger ages:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; hist(train.data$Age[which(train.data$Survived == "0")], main= "Passenger Age Histogram", xlab="Age", ylab="Count", col ="blue", breaks=seq(0,80,by=2))</strong></span>
<span class="strong"><strong class="calibre2">&gt; hist(train.data$Age[which(train.data$Survived == "1")], col ="red", add = T, breaks=seq(0,80,by=2))</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00044.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger age histogram</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="13">To <a id="id208" class="calibre1"/>examine more <a id="id209" class="calibre1"/>details about<a id="id210" class="calibre1"/> the<a id="id211" class="calibre1"/> relationship between the age and survival rate, one can use a <code class="email">boxplot</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; boxplot(train.data$Age ~ train.data$Survived, </strong></span>
<span class="strong"><strong class="calibre2">+         main="Passenger Survival by Age",</strong></span>
<span class="strong"><strong class="calibre2">+         xlab="Survived", ylab="Age")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00045.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger survival by age</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="14">To<a id="id212" class="calibre1"/> categorize people <a id="id213" class="calibre1"/>with different <a id="id214" class="calibre1"/>ages<a id="id215" class="calibre1"/> into different groups, such as children (below 13), youths (13 to 19), adults (20 to 65), and senior citizens (above 65), execute the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt;train.child = train.data$Survived[train.data$Age &lt; 13]</strong></span>
<span class="strong"><strong class="calibre2">&gt; length(train.child[which(train.child == 1)] ) / length(train.child)</strong></span>
<span class="strong"><strong class="calibre2"> [1] 0.5797101</strong></span>

<span class="strong"><strong class="calibre2">&gt; train.youth = train.data$Survived[train.data$Age &gt;= 15 &amp; train.data$Age &lt; 25]</strong></span>
<span class="strong"><strong class="calibre2">&gt; length(train.youth[which(train.youth == 1)] ) / length(train.youth)</strong></span>
<span class="strong"><strong class="calibre2">[1] 0.4285714</strong></span>

<span class="strong"><strong class="calibre2">&gt; train.adult  = train.data$Survived[train.data$Age &gt;= 20 &amp; train.data$Age &lt; 65]</strong></span>
<span class="strong"><strong class="calibre2">&gt; length(train.adult[which(train.adult == 1)] ) / length(train.adult)</strong></span>
<span class="strong"><strong class="calibre2"> [1] 0.3659218</strong></span>

<span class="strong"><strong class="calibre2">&gt; train.senior  = train.data$Survived[train.data$Age &gt;= 65]</strong></span>
<span class="strong"><strong class="calibre2">&gt; length(train.senior[which(train.senior == 1)] ) / length(train.senior)</strong></span>
<span class="strong"><strong class="calibre2">[1] 0.09090909</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Exploring and visualizing data">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec62" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">Before we predict the survival rate, one should first use the aggregation and visualization method to examine how each attribute affects the fate of the passengers. Therefore, we begin the examination by generating a bar plot and histogram of each attribute.</p><p class="calibre7">The plots from the screenshots in the preceding list give one an outline of each attribute of the Titanic dataset. As per the first screenshot, more passengers perished than survived during the shipwreck. Passengers in the third class made up the biggest number out of the three classes on board, which also reflects the truth that the third class was the most economical class on the Titanic (step 2). For the sex distribution, there were more male passengers than female (step 3). As for the age distribution, the screenshot in step 4 shows that most passengers were aged between 20 to 40. According to the screenshot in step 5, most passengers had one or fewer siblings. The screenshot in step 6 shows that most of the passengers have 0 to 2 parch. </p><p class="calibre7">In the screenshot in step 7, the fare histogram shows there were fare differences, which may be as a result of the different passenger classes on the Titanic. At last, the screenshot in step 8 shows that the boat made three stops to pick up passengers.</p><p class="calibre7">As we <a id="id216" class="calibre1"/>began the exploration from<a id="id217" class="calibre1"/> the <code class="email">sex</code> attribute, and judging by<a id="id218" class="calibre1"/> the resulting bar plot, it clearly showed that female passengers had a<a id="id219" class="calibre1"/> higher rate of survival than males during the shipwreck (step 9). In addition to this, the Wikipedia entry for RMS Titanic (<a class="calibre1" href="http://en.wikipedia.org/wiki/RMS_Titanic">http://en.wikipedia.org/wiki/RMS_Titanic</a>) explains that <span class="strong"><em class="calibre8">'A disproportionate number of men were left aboard because of a "women and children first" protocol followed by some of the officers loading the lifeboats'</em></span>. Therefore, it is reasonable that the number of female survivors outnumbered the male survivors. In other words, simply using <code class="email">sex</code> can predict whether a person will survive with a high degree of accuracy.</p><p class="calibre7">Then, we examined whether the passenger class affected the survival rate (step 10). Here, from the definition of <code class="email">Pclass</code>, the fares for each class were priced accordingly with the quality; high fares for first class, and low fares for third class. As the class of each passenger seemed to indicate their social and financial status, it is fair to assume that the wealthier passengers may have had more chances to survive.</p><p class="calibre7">Unfortunately, there was no correlation between the class and survival rate, so the result does not show the phenomenon we assumed. Nevertheless, after we examined <code class="email">sex</code> in the composition of <code class="email">pclass</code> (step 11), the results revealed that most third-class passengers were male; the assumption of wealthy people tending to survive more may not be that concrete.</p><p class="calibre7">Next, we examined the relationship between the age and passenger fate through a histogram and box plot (step 12). The bar plot shows the age distribution with horizontal columns in which red columns represent the passengers that survived, while blue columns represent those who perished. It is hard to tell the differences in the survival rate from the ages of different groups. The bar plots that we created did not prove that passengers in different age groups were more likely to survive. On the other hand, the plots showed that most people on board were aged between 20 to 40, but does not show whether this group was more likely to survive compared to elderly or young children (step 13). Here, we introduced a box plot, which is a standardized plotting technique that displays the distribution of data with information, such as minimum, first quartile, median, third quartile, maximum, and outliers.</p><p class="calibre7">Later, we further examined whether age groups have any relation to passenger fates, by categorizing passenger ages into four groups. The statistics show the the children group (below 13) was more likely to survive than the youths (13 to 20), adults (20 to 65), and senior citizens (above 65). The results showed that people in the younger age groups were more likely to survive the shipwreck. However, we noted that this possibly resulted from the 'women and children first' protocol.</p></div></div>

<div class="book" title="Exploring and visualizing data">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec63" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">Apart from <a id="id220" class="calibre1"/>using bar plots, histograms, and boxplots to visualize data, one can also apply <code class="email">mosaicplot</code> in the <code class="email">vcd</code> package<a id="id221" class="calibre1"/> to examine the relationship<a id="id222" class="calibre1"/> between <a id="id223" class="calibre1"/>multiple categorical variables. For example, when we examine the relationship between the <code class="email">Survived</code> and <code class="email">Pclass</code> variables, the application is performed as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; mosaicplot(train.data$Pclass ~ train.data$Survived, </strong></span>
<span class="strong"><strong class="calibre2">+           main="Passenger Survival Class", color=TRUE,  </strong></span>
<span class="strong"><strong class="calibre2">+  xlab="Pclass", ylab="Survived")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00046.jpeg" alt="There's more..." class="calibre9"/><div class="caption"><p class="calibre12">Passenger survival by class</p></div></div><p class="calibre10"> </p></div></div>

<div class="book" title="Exploring and visualizing data">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch02lvl2sec64" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">For more information about the shipwreck, one can read the history of RMS Titanic (please refer to the entry <span class="strong"><em class="calibre8">Sinking of the RMS Titanic</em></span> in Wikipedia <a class="calibre1" href="http://en.wikipedia.org/wiki/Sinking_of_the_RMS_Titanic">http://en.wikipedia.org/wiki/Sinking_of_the_RMS_Titanic</a>), as some of the protocol practiced at that time may have substantially affected the passenger survival rate.</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Predicting passenger survival with a decision tree"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec24" class="calibre1"/>Predicting passenger survival with a decision tree</h1></div></div></div><p class="calibre7">The <a id="id224" class="calibre1"/>exploratory analysis helps users gain insights into how single or multiple variables <a id="id225" class="calibre1"/>may affect the survival rate. However, it does not determine what combinations may generate a prediction model, so as to predict the passengers' survival. On the other hand, machine learning can generate a prediction model from a training dataset, so that the user can apply the model to predict the possible labels from the given attributes. In this recipe, we will introduce how to use a decision tree to predict passenger survival rates from the given variables.</p></div>

<div class="book" title="Predicting passenger survival with a decision tree">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec65" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">We will use the data, <code class="email">train.data</code>, that we have already used in our previous recipes.</p></div></div>

<div class="book" title="Predicting passenger survival with a decision tree">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec66" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to predict the passenger survival with the decision tree:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, we construct a data split <code class="email">split.data</code> function with three input parameters: <code class="email">data</code>, <code class="email">p</code>, and <code class="email">s</code>. The <code class="email">data</code> parameter stands for the input dataset, the <code class="email">p</code> parameter stands for the proportion of generated subset from the input dataset, and the <code class="email">s</code> parameter stands for the random seed:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; split.data = function(data, p = 0.7, s = 666){</strong></span>
<span class="strong"><strong class="calibre2">+     set.seed(s)</strong></span>
<span class="strong"><strong class="calibre2">+     index = sample(1:dim(data)[1])</strong></span>
<span class="strong"><strong class="calibre2">+     train = data[index[1:floor(dim(data)[1] * p)], ]</strong></span>
<span class="strong"><strong class="calibre2">+     test = data[index[((ceiling(dim(data)[1] * p)) + 1):dim(data)[1]], ]</strong></span>
<span class="strong"><strong class="calibre2">+     return(list(train = train, test = test))</strong></span>
<span class="strong"><strong class="calibre2">+ } </strong></span>
</pre></div></li><li class="listitem" value="2">Then, we split the data, with 70 percent assigned to the training dataset and the remaining 30 percent for the testing dataset:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; allset= split.data(train.data, p = 0.7) </strong></span>
<span class="strong"><strong class="calibre2">&gt; trainset = allset$train </strong></span>
<span class="strong"><strong class="calibre2">&gt; testset = allset$test</strong></span>
</pre></div></li><li class="listitem" value="3">For the condition tree, one has to use the <code class="email">ctree</code> function from the party package; therefore, we install and load the party package:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages('party')</strong></span>
<span class="strong"><strong class="calibre2">&gt; require('party')</strong></span>
</pre></div></li><li class="listitem" value="4">We then use <code class="email">Survived</code> as a label to generate the prediction model in use. After<a id="id226" class="calibre1"/> that, we assign the classification tree model into <a id="id227" class="calibre1"/>the <code class="email">train.ctree</code> variable:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.ctree = ctree(Survived ~ Pclass + Sex + Age + SibSp + Fare + Parch + Embarked, data=trainset)</strong></span>
<span class="strong"><strong class="calibre2">&gt; train.ctree</strong></span>

<span class="strong"><strong class="calibre2">   Conditional inference tree with 7 terminal nodes</strong></span>

<span class="strong"><strong class="calibre2">Response:  Survived </strong></span>
<span class="strong"><strong class="calibre2">Inputs:  Pclass, Sex, Age, SibSp, Fare, Parch, Embarked </strong></span>
<span class="strong"><strong class="calibre2">Number of observations:  623 </strong></span>

<span class="strong"><strong class="calibre2">1) Sex == {male}; criterion = 1, statistic = 173.672</strong></span>
<span class="strong"><strong class="calibre2">  2) Pclass == {2, 3}; criterion = 1, statistic = 30.951</strong></span>
<span class="strong"><strong class="calibre2">    3) Age &lt;= 9; criterion = 0.997, statistic = 12.173</strong></span>
<span class="strong"><strong class="calibre2">      4) SibSp &lt;= 1; criterion = 0.999, statistic = 15.432</strong></span>
<span class="strong"><strong class="calibre2">        5)*  weights = 10 </strong></span>
<span class="strong"><strong class="calibre2">      4) SibSp &gt; 1</strong></span>
<span class="strong"><strong class="calibre2">        6)*  weights = 11 </strong></span>
<span class="strong"><strong class="calibre2">    3) Age &gt; 9</strong></span>
<span class="strong"><strong class="calibre2">      7)*  weights = 282 </strong></span>
<span class="strong"><strong class="calibre2">  2) Pclass == {1}</strong></span>
<span class="strong"><strong class="calibre2">    8)*  weights = 87 </strong></span>
<span class="strong"><strong class="calibre2">1) Sex == {female}</strong></span>
<span class="strong"><strong class="calibre2">  9) Pclass == {1, 2}; criterion = 1, statistic = 59.504</strong></span>
<span class="strong"><strong class="calibre2">    10)*  weights = 125 </strong></span>
<span class="strong"><strong class="calibre2">  9) Pclass == {3}</strong></span>
<span class="strong"><strong class="calibre2">    11) Fare &lt;= 23.25; criterion = 0.997, statistic = 12.456</strong></span>
<span class="strong"><strong class="calibre2">      12)*  weights = 85 </strong></span>
<span class="strong"><strong class="calibre2">    11) Fare &gt; 23.25</strong></span>
<span class="strong"><strong class="calibre2">      13)*  weights = 23 </strong></span>
</pre></div></li><li class="listitem" value="5">We <a id="id228" class="calibre1"/>use a <code class="email">plot</code> function <a id="id229" class="calibre1"/>to plot the tree:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(train.ctree, main="Conditional inference tree of Titanic Dataset")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00047.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Conditional inference tree of the Titanic dataset</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Predicting passenger survival with a decision tree">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec67" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">This recipe introduces how to use a conditional inference tree, <code class="email">ctree</code>, to predict passenger survival. While the conditional inference tree is not the only method to solve the <a id="id230" class="calibre1"/>classification problem, it is an easy method to comprehend the decision path to predict passenger survival.</p><p class="calibre7">We first split the data into a training and testing set by using our implemented function, <code class="email">split.data</code>. So, we can then use the training set to generate a prediction model and later employ the prediction model on the testing dataset in the recipe of the model assessment. Then, we install and load the <code class="email">party</code> package, and use <code class="email">ctree</code> to build a prediction model, with <code class="email">Survived</code> as its label. Without considering any particular attribute, we put attributes such as <code class="email">Pclass</code>, <code class="email">Sex</code>, <code class="email">Age</code>, <code class="email">SibSp</code>, <code class="email">Parch</code>, <code class="email">Embarked</code>, and <code class="email">Fare</code> as training attributes, except for <code class="email">Cabin</code>, as most of this attribute's values are missing.</p><p class="calibre7">After constructing the prediction model, we can either print out the decision path and node in a text mode, or use a plot function to plot the decision tree. From the decision tree, the user can see what combination of variables may be helpful in predicting the survival rate. As per the preceding screenshot, users can find a combination of <code class="email">Pclass</code> and <code class="email">Sex</code>, which served as a good decision boundary (node 9) to predict the survival rates. This <a id="id231" class="calibre1"/>shows female passengers who were in first and second class mostly survived the shipwreck. Male passengers, those in second and third class and aged over nine, almost all perished during the shipwreck. From the tree, one may find that attributes such as <code class="email">Embarked</code> and <code class="email">Parch</code> are missing. This is because the conditional inference tree regards these attributes as less important during classification.</p><p class="calibre7">From the decision tree, the user can see what combination of variables may be helpful in predicting the survival rate. Furthermore, a conditional inference tree is helpful in selecting important attributes during the classification process; one can examine the built tree to see whether the selected attribute matches one's presumption.</p></div></div>

<div class="book" title="Predicting passenger survival with a decision tree">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec68" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">This recipe covers issues relating to classification algorithms and conditional inference trees. Since we do not discuss the background knowledge of the adapted algorithm, it is better for the user to use the <code class="email">help</code> function to view the documents related to <code class="email">ctree</code> in the <code class="email">party</code> package, if necessary.</p><p class="calibre7">There is a <a id="id232" class="calibre1"/>similar decision tree based package, named <code class="email">rpart</code>. The <a id="id233" class="calibre1"/>difference between <code class="email">party</code> and <code class="email">rpart</code> is that <code class="email">ctree</code> in the party package avoids the following variable selection bias of <code class="email">rpart</code> and <code class="email">ctree</code> in the <code class="email">party</code> package, tending to select variables that have many possible splits or many missing values. Unlike the others, <code class="email">ctree</code> uses a significance testing procedure in order to select variables, instead of selecting the variable that maximizes an information measure.</p><p class="calibre7">Besides <code class="email">ctree</code>, one can also use <code class="email">svm</code> to generate a prediction model. To load the <code class="email">svm</code> function, load the <code class="email">e1071</code> package first, and then use the <code class="email">svm</code> build to generate this prediction:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages('e1071')</strong></span>
<span class="strong"><strong class="calibre2">&gt; require('e1071')</strong></span>
<span class="strong"><strong class="calibre2">&gt; svm.model = svm(Survived ~ Pclass + Sex + Age + SibSp + Fare + Parch + Embarked, data = trainset, probability = TRUE)</strong></span>
</pre></div><p class="calibre7">Here, we<a id="id234" class="calibre1"/> use <code class="email">svm</code> to show how <a id="id235" class="calibre1"/>easy it is that you can immediately use different machine learning algorithms on the same dataset when using R. For further information on how to use <code class="email">svm</code>, please refer to <a class="calibre1" title="Chapter 6. Classification (II) – Neural Network and SVM" href="part0072_split_000.html#page">Chapter 6</a>, <span class="strong"><em class="calibre8">Classification (II) – Neural Network, SVM</em></span>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Validating the power of prediction with a confusion matrix"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec25" class="calibre1"/>Validating the power of prediction with a confusion matrix</h1></div></div></div><p class="calibre7">After constructing the prediction model, it is important to validate how the model performs <a id="id236" class="calibre1"/>while predicting the labels. In the previous recipe, we built a model with <code class="email">ctree</code> and <a id="id237" class="calibre1"/>pre-split the data into a training  and testing set. For now, users will learn to validate how well <code class="email">ctree</code> performs in a survival prediction via the use of a confusion matrix.</p></div>

<div class="book" title="Validating the power of prediction with a confusion matrix">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec69" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">Before assessing the prediction model, first be sure that the generated training set and testing dataset are within the R session.</p></div></div>

<div class="book" title="Validating the power of prediction with a confusion matrix">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec70" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to validate the prediction power:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">We start using the constructed <code class="email">train.ctree</code> model to predict the survival of the testing set:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; ctree.predict = predict(train.ctree, testset)</strong></span>
</pre></div></li><li class="listitem" value="2">First, we install the <code class="email">caret</code> package, and then load it:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages("caret")</strong></span>
<span class="strong"><strong class="calibre2">&gt; require(caret)</strong></span>
</pre></div></li><li class="listitem" value="3">After loading <code class="email">caret</code>, one can use a confusion matrix to generate the statistics of the output matrix:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; confusionMatrix(ctree.predict, testset$Survived)</strong></span>
<span class="strong"><strong class="calibre2">Confusion Matrix and Statistics</strong></span>

<span class="strong"><strong class="calibre2">          Reference</strong></span>
<span class="strong"><strong class="calibre2">Prediction   0   1</strong></span>
<span class="strong"><strong class="calibre2">         0 160  25</strong></span>
<span class="strong"><strong class="calibre2">         1  16  66</strong></span>
<span class="strong"><strong class="calibre2">                                          </strong></span>
<span class="strong"><strong class="calibre2">               Accuracy : 0.8464          </strong></span>
<span class="strong"><strong class="calibre2">                 95% CI : (0.7975, 0.8875)</strong></span>
<span class="strong"><strong class="calibre2">    No Information Rate : 0.6592          </strong></span>
<span class="strong"><strong class="calibre2">    P-Value [Acc &gt; NIR] : 4.645e-12       </strong></span>
<span class="strong"><strong class="calibre2">                                          </strong></span>
<span class="strong"><strong class="calibre2">                  Kappa : 0.6499          </strong></span>
<span class="strong"><strong class="calibre2"> Mcnemar's Test P-Value : 0.2115          </strong></span>
<span class="strong"><strong class="calibre2">                                          </strong></span>
<span class="strong"><strong class="calibre2">            Sensitivity : 0.9091          </strong></span>
<span class="strong"><strong class="calibre2">            Specificity : 0.7253          </strong></span>
<span class="strong"><strong class="calibre2">         Pos Pred Value : 0.8649          </strong></span>
<span class="strong"><strong class="calibre2">         Neg Pred Value : 0.8049          </strong></span>
<span class="strong"><strong class="calibre2">             Prevalence : 0.6592          </strong></span>
<span class="strong"><strong class="calibre2">         Detection Rate : 0.5993          </strong></span>
<span class="strong"><strong class="calibre2">   Detection Prevalence : 0.6929          </strong></span>
<span class="strong"><strong class="calibre2">      Balanced Accuracy : 0.8172          </strong></span>
<span class="strong"><strong class="calibre2">                                          </strong></span>
<span class="strong"><strong class="calibre2">       'Positive' Class : 0</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Validating the power of prediction with a confusion matrix">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec71" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">After<a id="id238" class="calibre1"/> building <a id="id239" class="calibre1"/>the prediction model in the previous recipe, it is important to measure the performance of the constructed model. The performance can be assessed by whether the prediction result matches the original label contained in the testing dataset. The assessment can be done by using the confusion matrix provided by the caret package to generate a confusion matrix, which is one method to measure the accuracy of predictions.</p><p class="calibre7">To generate a confusion matrix, a user needs to install and load the <code class="email">caret</code> package first. The confusion matrix shows that purely using <code class="email">ctree</code> can achieve accuracy of up to 84 percent. One may generate a better prediction model by tuning the attribute used, or by replacing the classification algorithm to SVM, <code class="email">glm</code>, or random forest.</p></div></div>

<div class="book" title="Validating the power of prediction with a confusion matrix">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec72" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">A caret package (<span class="strong"><em class="calibre8">Classification and Regression Training</em></span>) helps make iterating and comparing <a id="id240" class="calibre1"/>different predictive models very convenient. The package also contains several functions, including:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Data splits</li><li class="listitem">Common preprocessing: creating dummy variables, identifying zero- and near-zero-variance predictors, finding correlated predictors, centering, scaling, and <a id="id241" class="calibre1"/>so on</li><li class="listitem">Training (using cross-validation)</li><li class="listitem">Common <a id="id242" class="calibre1"/>visualizations (for example, <code class="email">featurePlot</code>)</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Assessing performance with the ROC curve"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec26" class="calibre1"/>Assessing performance with the ROC curve</h1></div></div></div><p class="calibre7">Another measurement is by using the ROC curve (this requires the <code class="email">ROCR</code> package), which plots a<a id="id243" class="calibre1"/> curve according to its true positive rate against its false positive rate. This recipe will introduce <a id="id244" class="calibre1"/>how we can use the ROC curve to measure the performance of the prediction model.</p></div>

<div class="book" title="Assessing performance with the ROC curve">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec73" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">Before applying the ROC curve to assess the prediction model, first be sure that the generated training set, testing dataset, and built prediction model, <code class="email">ctree.predict</code>, are within the R session.</p></div></div>

<div class="book" title="Assessing performance with the ROC curve">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec74" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to assess prediction performance:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Prepare the probability matrix:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.ctree.pred = predict(train.ctree, testset)</strong></span>
<span class="strong"><strong class="calibre2">&gt; train.ctree.prob =  1- unlist(treeresponse(train.ctree, testset), use.names=F)[seq(1,nrow(testset)*2,2)]</strong></span>
</pre></div></li><li class="listitem" value="2">Install and load the <code class="email">ROCR</code> package:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages("ROCR")</strong></span>
<span class="strong"><strong class="calibre2">&gt; require(ROCR)</strong></span>
</pre></div></li><li class="listitem" value="3">Create<a id="id245" class="calibre1"/> an <code class="email">ROCR</code> prediction <a id="id246" class="calibre1"/>object from probabilities:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.ctree.prob.rocr = prediction(train.ctree.prob, testset$Survived)</strong></span>
</pre></div></li><li class="listitem" value="4">Prepare the ROCR performance object for the ROC curve (<code class="email">tpr=true positive rate, fpr=false positive rate</code>) and the area under curve (AUC):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; train.ctree.perf = performance(train.ctree.prob.rocr, "tpr","fpr")</strong></span>
<span class="strong"><strong class="calibre2">&gt; train.ctree.auc.perf =  performance(train.ctree.prob.rocr, measure = "auc", x.measure = "cutoff")</strong></span>
</pre></div></li><li class="listitem" value="5">Plot the ROC curve, with colorize as <code class="email">TRUE</code>, and put <code class="email">AUC</code> as the title:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(train.ctree.perf, col=2,colorize=T, main=paste("AUC:", train.ctree.auc.perf@y.values))</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00048.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">ROC of the prediction model</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Assessing performance with the ROC curve">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec75" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">Here, we first create the prediction object from the probabilities matrix, and then prepare the ROCR performance object for the ROC curve (<code class="email">tpr=true positive rate</code>, <code class="email">fpr=false positive rate</code>) and the AUC. Lastly, we use the plot function to draw the ROC<a id="id247" class="calibre1"/> curve.</p><p class="calibre7">The result<a id="id248" class="calibre1"/> drawn in the preceding screenshot is interpreted in the following way: the larger under the curve (a perfect prediction will make AUC equal to 1), the better the prediction accuracy of the model. Our model returns a value of 0.857, which suggests that the simple conditional inference tree model is powerful enough to make survival predictions.</p></div></div>

<div class="book" title="Assessing performance with the ROC curve">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec76" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">To get more information on the ROCR, you can read the paper <span class="strong"><em class="calibre8">Sing, T.</em></span>, <span class="strong"><em class="calibre8">Sander, O.</em></span>, <span class="strong"><em class="calibre8">Berenwinkel, N.</em></span>, and <span class="strong"><em class="calibre8">Lengauer, T.</em></span> (2005). <span class="strong"><em class="calibre8">ROCR: visualizing classifier performance in R</em></span>. <span class="strong"><em class="calibre8">Bioinformatics, 21(20), 3940-3941</em></span>.</li></ul></div></div></div></body></html>
<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer058">&#13;
			<h1 id="_idParaDest-76" class="chapter-number"><a id="_idTextAnchor077"/>4</h1>&#13;
			<h1 id="_idParaDest-77"><a id="_idTextAnchor078"/>Data Visualization with ggplot2</h1>&#13;
			<p>The previous chapter covered intermediate data processing techniques, focusing on dealing with string data. When the raw data has been transformed and processed into a clean and structured shape, we can take the analysis to the next level by visualizing the clean data in a graph, which we aim to accomplish in <span class="No-Break">this chapter.</span></p>&#13;
			<p>By the end of this chapter, you will be able to plot standard graphs using the <strong class="source-inline">ggplot2</strong> package and add customizations to present <span class="No-Break">excellent visuals.</span></p>&#13;
			<p>In this chapter, we will cover the <span class="No-Break">following topics:</span></p>&#13;
			<ul>&#13;
				<li><span class="No-Break">Introducing </span><span class="No-Break"><strong class="source-inline">ggplot2</strong></span></li>&#13;
				<li>Understanding the grammar <span class="No-Break">of graphics</span></li>&#13;
				<li>Geometries <span class="No-Break">in graphics</span></li>&#13;
				<li>Controlling themes <span class="No-Break">in graphics</span></li>&#13;
			</ul>&#13;
			<h1 id="_idParaDest-78"><a id="_idTextAnchor079"/>Technical requirements</h1>&#13;
			<p>To complete the exercises in this chapter, you will need to have the latest versions of the <span class="No-Break">following packages:</span></p>&#13;
			<ul>&#13;
				<li>The <strong class="source-inline">ggplot2</strong> package, version 3.3.6. Alternatively, install the <strong class="source-inline">tidyverse</strong> package and load <span class="No-Break"><strong class="source-inline">ggplot2</strong></span><span class="No-Break"> directly.</span></li>&#13;
				<li>The <strong class="source-inline">ggthemes</strong> package, <span class="No-Break">version 4.2.4.</span></li>&#13;
			</ul>&#13;
			<p>The versions mentioned along with the packages in the preceding list are the latest ones while I am writing <span class="No-Break">this book.</span></p>&#13;
			<p>All the code and data for this chapter is available <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/The-Statistics-and-Machine-Learning-with-R-Workshop/tree/main/Chapter_4"><span class="No-Break">https://github.com/PacktPublishing/The-Statistics-and-Machine-Learning-with-R-Workshop/tree/main/Chapter_4</span></a><span class="No-Break">.</span></p>&#13;
			<h1 id="_idParaDest-79"><a id="_idTextAnchor080"/>Introducing ggplot2</h1>&#13;
			<p>Conveying information via graphs tends to be more effective and visually appealing than tables alone. After all, humans are much quicker at processing visual information, such as recognizing a car in an image. In building <strong class="bold">machine learning</strong> (<strong class="bold">ML</strong>) models, we are often interested in the training and test loss profile in the form of a line chart that indicates the reduction in the training and test set loss as the model gets trained for a more extended period. Observing performance metrics helps us better diagnose whether a model <a id="_idIndexMarker365"/>is <strong class="bold">underfitting</strong> or <strong class="bold">overfitting</strong>—in <a id="_idIndexMarker366"/>other words, whether the current model is too simple or overly complex. Note that the test set is used to approximate a future dataset, and minimizing the test set error helps the model generalize to new <a id="_idIndexMarker367"/>datasets, an approach known as <strong class="bold">empirical risk minimization</strong>. Underfitting refers to the case when the model does poorly in both training and test sets due to insufficient fitting power, while overfitting means the model does well in the training set but not in the test set due to an overly complex model. Both underfitting and overfitting lead to high error frequency on the test set and thus low <span class="No-Break">generalization power.</span></p>&#13;
			<p>Good visualization skills are also a signpost of a good communicator. Creating good visualizations requires carefully designing the interface while satisfying the technical constraints regarding what is achievable. When tasked with building an ML model, most of the time is often spent on data processing, model development, and fine-tuning, only leaving a disproportionately small amount of time to communicate the modeling results to stakeholders. Effective communication means that an ML model, albeit a black-box solution for people outside this field, could still be transparently and adequately explained to and understood by its internal users. Meaningful and powerful visualizations created by various offerings<a id="_idIndexMarker368"/> from <strong class="source-inline">ggplot2</strong>, the specific package from the <strong class="source-inline">tidyverse</strong> ecosystem that focuses on graphing, serve as an excellent enabler to effective communication; the outputs are generally more visually engaging and attractive than the default plotting options offered by base R. After all, creating good visualizations will be an essential skill as you climb up the corporate ladder and think more from the audience’s perspective. Good presentation skills will become equally important to (if not more important than) your technical skills?, such as <span class="No-Break">model development.</span></p>&#13;
			<p>This section will show you how to achieve good visual communication by building simple yet powerful plots using the <strong class="source-inline">ggplot2</strong> package. It will help demystify modern visualization techniques using R and prepare you for more advanced visualization techniques. We will start with a simple scatter plot example and introduce the basic plotting grammar of the <strong class="source-inline">ggplot2</strong> package using the <strong class="source-inline">mtcars</strong> dataset, which contains a set of automobile-related observations and is automatically loaded in the working environment when <span class="No-Break">loading </span><span class="No-Break"><strong class="source-inline">ggplot2</strong></span><span class="No-Break">.</span></p>&#13;
			<h2 id="_idParaDest-80"><a id="_idTextAnchor081"/>Building a scatter plot</h2>&#13;
			<p>A scatter plot is<a id="_idIndexMarker369"/> a two-dimensional plot where the value of the two variables, often numeric in type, uniquely determines each dot on the plot. It is the go-to plot when we want to assess the relationship between two <span class="No-Break">numeric variables.</span></p>&#13;
			<p>Let us go through an exercise to plot the relationship between the number of cylinders (the <strong class="source-inline">cyl</strong> variable) in a car and the miles per gallon (the <strong class="source-inline">mpg</strong> variable) using the <span class="No-Break"><strong class="source-inline">mtcars</strong></span><span class="No-Break"> dataset.</span></p>&#13;
			<h3>Exercise 4.1 – Building a scatter plot using the mtcars dataset</h3>&#13;
			<p>In this exercise, we<a id="_idIndexMarker370"/> will first examine the structure of the <strong class="source-inline">mtcars</strong> dataset <a id="_idIndexMarker371"/>and generate a bivariate scatter plot using <strong class="source-inline">ggplot2</strong>. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Load and examine the structure of the <strong class="source-inline">mtcars</strong> dataset, <span class="No-Break">like so:</span><pre class="source-code">&#13;
&gt;&gt;&gt; library(ggplot2)&#13;
&gt;&gt;&gt; str(mtcars)&#13;
'data.frame':  32 obs. of  11 variables:&#13;
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...&#13;
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...&#13;
 $ disp: num  160 160 108 258 360 ...&#13;
 $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...&#13;
 $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...&#13;
 $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...&#13;
 $ qsec: num  16.5 17 18.6 19.4 17 ...&#13;
 $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...&#13;
 $ am  : num  1 1 1 0 0 0 0 0 0 0 ...&#13;
 $ gear: num  4 4 4 3 3 3 3 4 4 4 ...&#13;
 $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</pre><p class="list-inset">The result shows that the <strong class="source-inline">mtcars</strong> DataFrame contains 32 rows and 11 columns, a relatively small and structured dataset that is easy to work with. Next, we will plot the relationship between <strong class="source-inline">cyl</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">mpg</strong></span><span class="No-Break">.</span></p></li>				<li>Use the <strong class="source-inline">ggplot()</strong> and <strong class="source-inline">geom_point()</strong> functions to generate a scatter plot based <a id="_idIndexMarker372"/>on the <strong class="source-inline">cyl</strong> and <strong class="source-inline">mpg</strong> variables. Enlarge the <a id="_idIndexMarker373"/>size of the title and text for the plot along both axes using the <span class="No-Break"><strong class="source-inline">theme</strong></span><span class="No-Break"> layer:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=cyl, y=mpg)) +&#13;
  geom_point() +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"))</pre><p class="list-inset">As shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.1</em>, the generated result contains 32 dots whose positions are uniquely determined by a combination of <strong class="source-inline">cyl</strong> and <strong class="source-inline">mpg</strong>. The screenshot suggests a decreasing trend in the value of <strong class="source-inline">mpg</strong> as <strong class="source-inline">cyl</strong> increases, although the within-group variation is also pronounced across the three groups <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">cyl</strong></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer023" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_001.jpg" alt="Figure 4.1 – Scatter plot between cyl and mpg" width="1069" height="716"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.1 – Scatter plot between cyl and mpg</p>&#13;
			<p class="list-inset">Note that<a id="_idIndexMarker374"/> the <strong class="source-inline">aes()</strong> function maps <strong class="source-inline">cyl</strong> to <a id="_idIndexMarker375"/>the <em class="italic">x</em> axis and <strong class="source-inline">mpg</strong> to the <em class="italic">y</em> axis. When the mapping relationship is not explicitly shown, we often assume that the first argument corresponds to the horizontal axis and the second to the <span class="No-Break">vertical axis.</span></p>&#13;
			<p class="list-inset">The script used to generate the scatter plot consists of two high-level functions: <strong class="source-inline">ggplot()</strong> and <strong class="source-inline">geom_point()</strong>. The <strong class="source-inline">ggplot()</strong> function specifies the dataset to be used in the first argument and the variables to be respectively plotted on the two axes in the second argument, wrapped using the <strong class="source-inline">aes()</strong> function (more on this later). The <strong class="source-inline">geom_point()</strong> function enforces the display to be in a scatter plot. These two functions are chained together via a particular <strong class="source-inline">+</strong> operator, indicating overlaying the second layer of operation to <span class="No-Break">the first.</span></p>&#13;
			<p class="list-inset">Also, note that the <strong class="source-inline">cyl</strong> variable is treated as numeric by <strong class="source-inline">ggplot()</strong>, as shown by the additional labels of  <strong class="source-inline">5</strong> and <strong class="source-inline">7</strong> on the horizontal axis. We can verify the distinct values of <strong class="source-inline">cyl</strong> via the <strong class="source-inline">unique()</strong> function <span class="No-Break">as follows:</span></p>&#13;
			<pre class="source-code">&#13;
&gt;&gt;&gt; unique(mtcars$cyl)&#13;
6 4 8</pre>			<p class="list-inset">Apparently, we <a id="_idIndexMarker376"/>need to treat it as a categorical <a id="_idIndexMarker377"/>variable to avoid unwanted interpolation between different values. This can be achieved by wrapping the <strong class="source-inline">cyl</strong> variable via the <strong class="source-inline">factor()</strong> function, which converts the input argument to a <span class="No-Break">categorical output:</span></p>&#13;
			<pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(factor(cyl), mpg)) +&#13;
  geom_point() +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"))</pre>			<p class="list-inset">The resulting plot is shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.2</em>. By explicitly converting <strong class="source-inline">cyl</strong> to a categorical variable, the<a id="_idIndexMarker378"/> horizontal axis correctly<a id="_idIndexMarker379"/> indicates a distribution of dots for each unique value <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">cyl</strong></span><span class="No-Break">:</span></p>&#13;
			<div>&#13;
				<div id="_idContainer024" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_002.jpg" alt="Figure 4.2 – Scatter plot after converting cyl to a categorical variable" width="1067" height="718"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.2 – Scatter plot after converting cyl to a categorical variable</p>&#13;
			<p>Up until now, we have learned how to build a scatter plot by passing in the variables of interest after converting to the desired type. This works similarly to other kinds of plots, which observe a standard set of grammatical rules. Next, we will go through these fundamental rules to understand <span class="No-Break">their commonalities.</span></p>&#13;
			<h1 id="_idParaDest-81"><a id="_idTextAnchor082"/>Understanding the grammar of graphics</h1>&#13;
			<p>The previous example contained the three essential layers that need to be specified when plotting a graph: <strong class="bold">data</strong>, <strong class="bold">aesthetics</strong>, and <strong class="bold">geometries</strong>. The primary purpose of each layer is listed <span class="No-Break">as follows:</span></p>&#13;
			<ul>&#13;
				<li>The data layer<a id="_idIndexMarker380"/> specifies the dataset to be plotted. This corresponds to the <strong class="source-inline">mtcars</strong> dataset we <span class="No-Break">specified earlier.</span></li>&#13;
				<li>The aesthetics layer<a id="_idIndexMarker381"/> specifies the scale-related items that map the variables to the visual properties of the plot. Examples include the variables to be shown for the <em class="italic">x</em> axis and <em class="italic">y</em> axis, the size and color, and other plot aesthetics. This corresponds to the <strong class="source-inline">cyl</strong> and <strong class="source-inline">mpg</strong> variables we <span class="No-Break">specified earlier.</span></li>&#13;
				<li>The geometry layer<a id="_idIndexMarker382"/> specifies the visual elements used for the data, such as presenting the data via points, lines, or other forms. The <strong class="source-inline">geom_point()</strong> command we set in the previous example tells the plot to be shown as a <span class="No-Break">scatter plot.</span></li>&#13;
			</ul>&#13;
			<p>Other layers, such as the theme layer, also help beautify the plot, which we will <span class="No-Break">cover later.</span></p>&#13;
			<p>The <strong class="source-inline">geom_point()</strong> layer from the previous example also suggests that we could easily switch to another type of plot by changing the keyword after the underscore. For example, as shown in the following code snippet, we can show the scatter plot as a boxplot for each unique value of <strong class="source-inline">cyl</strong> using the <span class="No-Break"><strong class="source-inline">geom_boxplot()</strong></span><span class="No-Break"> function:</span></p>&#13;
			<pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(factor(cyl), mpg)) +&#13;
  geom_boxplot() +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"))</pre>			<p>Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.3</em>, which visualizes a set of points as a boxplot for each distinct value of <strong class="source-inline">cyl</strong>. Employing a boxplot is an excellent way to detect outliers, such as the two extreme points lying outside the <span class="No-Break">third boxplot:</span></p>&#13;
			<div>&#13;
				<div id="_idContainer025" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_003.jpg" alt="Figure 4.3 – Visualizing the same plot using a boxplot" width="1070" height="717"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.3 – Visualizing the same plot using a boxplot</p>&#13;
			<p>Similarly, we could change the color and size of the points in the previous scatter plot by tweaking the aesthetics layer. Let us go through an exercise to see how this can <span class="No-Break">be achieved.</span></p>&#13;
			<h3>Exercise 4.2 – Changing the color and size of points in a scatter plot</h3>&#13;
			<p>In this exercise, we will <a id="_idIndexMarker383"/>use the aesthetics layer to modify the color and size of the points displayed in the last scatter plot based on the <strong class="source-inline">disp</strong> and <strong class="source-inline">hp</strong> variables. The <strong class="source-inline">disp</strong> variable measures the engine displacement, and the <strong class="source-inline">hp</strong> variable indicates the gross horsepower. The points will thus vary in color and size given different values of <strong class="source-inline">disp</strong> and <strong class="source-inline">hp</strong>. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Change the color of the points in the scatter plot by passing <strong class="source-inline">disp</strong> to the <strong class="source-inline">color</strong> argument in the <strong class="source-inline">aes()</strong> function. Enlarge the <strong class="source-inline">size</strong> parameter of the legend <span class="No-Break">as well:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(factor(cyl), mpg, color=disp)) +&#13;
  geom_point() +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this <a id="_idIndexMarker384"/>command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.4</em>, where the color gradient of each point changes based on the value <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">disp</strong></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer026" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_004.jpg" alt="Figure 4.4 – Adding color to the scatter plot" width="1064" height="717"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.4 – Adding color to the scatter plot</p>&#13;
			<ol>&#13;
				<li value="2">Change the size of the points in the scatter plot by passing <strong class="source-inline">hp</strong> to the <strong class="source-inline">size</strong> argument in the <strong class="source-inline">aes()</strong> function, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(factor(cyl), mpg, color=disp, size=hp)) +&#13;
  geom_point()</pre><p class="list-inset">Running this <a id="_idIndexMarker385"/>command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.5</em>, where the size of each point also changes based on the value <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">hp</strong></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer027" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_005.jpg" alt="Figure 4.5 – Changing point size in the scatter plot" width="1068" height="716"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.5 – Changing point size in the scatter plot</p>&#13;
			<p>Although the plot now looks more enriched, be careful when adding dimensions to a single plot. In our current example, the single plot contains four dimensions of information: <strong class="source-inline">cyl</strong>, <strong class="source-inline">mpg</strong>, <strong class="source-inline">disp</strong>, and <strong class="source-inline">hp</strong>. Human brains are adept at processing two- or three-dimensional visuals but may struggle when presented with higher dimensions of graphs. The presentation style depends on what message we want to convey to our audience. Instead of lumping all dimensions together, building a separate plot with just two or three variables for illustration may be more effective. Remember—effective communication in model development lies in the quality of the message to the audience and not in the richness <a id="_idIndexMarker386"/>of the <span class="No-Break">visual output.</span></p>&#13;
			<p>The following exercise will let us look at the individual components of different layers in <span class="No-Break">more detail.</span></p>&#13;
			<h3>Exercise 4.3 – Building a scatter plot with smooth curve fitting</h3>&#13;
			<p>In this <a id="_idIndexMarker387"/>exercise, we will build a scatter plot and fit a smooth curve that passes through the points. Adding a smooth curve helps us detect the overall pattern among the points and is achieved using the <strong class="source-inline">geom_smooth()</strong> function. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Build a scatter plot using <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong> with smooth curve fitting using <strong class="source-inline">geom_smooth()</strong> and coloring using <strong class="source-inline">disp</strong>, and adjust the opacity of the points by setting <strong class="source-inline">alpha=0.6</strong> <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">geom_point()</strong></span><span class="No-Break">:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(hp, mpg, color=disp)) +&#13;
  geom_point(alpha=0.6) +&#13;
  geom_smooth() +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running the preceding command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.6</em>, where the central blue curve represents a model that best fits the points and the surrounding bounds indicate the uncertainty interval. We will discuss more on the concept of a model in a <span class="No-Break">later chapter:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer028" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_006.jpg" alt="Figure 4.6 – Fitting a smooth curve among the points in a scatter plot" width="1068" height="714"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.6 – Fitting a smooth curve among the points in a scatter plot</p>&#13;
			<p class="list-inset">Since the <a id="_idIndexMarker388"/>graphics are based on the concept of additive layers, we can also generate a plot by starting with some components, storing them in a variable, and then furnishing the graph variable with additional components. Let us see how this is done in the <span class="No-Break">following steps.</span></p>&#13;
			<ol>&#13;
				<li value="2">Build a scatter plot using <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong> with the same opacity level and store the plot in the <span class="No-Break"><strong class="source-inline">plt</strong></span><span class="No-Break"> variable:</span><pre class="source-code">&#13;
&gt;&gt;&gt; plt = ggplot(mtcars, aes(hp, mpg)) +&#13;
  geom_point(alpha=0.6) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"))&#13;
&gt;&gt;&gt; plt</pre><p class="list-inset">As shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.7</em>, directly printing out <strong class="source-inline">plt</strong> generates a working plot, which suggests that a plot can also be stored as <span class="No-Break">an object:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer029" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_007.jpg" alt="Figure 4.7 – Generating a scatter plot using hp and mpg" width="1073" height="717"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.7 – Generating a scatter plot using hp and mpg</p>&#13;
			<ol>&#13;
				<li value="3">Color the<a id="_idIndexMarker389"/> points using <strong class="source-inline">disp</strong> and add a smooth curve fitting to the previous plot, <span class="No-Break">like so:</span><pre class="source-code">&#13;
&gt;&gt;&gt; plt = plt +&#13;
  geom_point(aes(color=disp)) +&#13;
  geom_smooth()&#13;
&gt;&gt;&gt; plt</pre><p class="list-inset">Running these commands will generate the same plot as the one shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.6</em>. Therefore, we can build a base plot, save it in a variable, and adjust its visual properties <a id="_idIndexMarker390"/>by adding extra <span class="No-Break">layer specifications.</span></p></li>			</ol>&#13;
			<p>We can also exercise more refined control over the size, shape, and color of the points in a scatter plot, all achieved by specifying the relevant arguments. Let us see how this can be completed in the <span class="No-Break">following exercise.</span></p>&#13;
			<h3>Exercise 4.4 – Controlling the size, shape, and color of points in a scatter plot</h3>&#13;
			<p>In this exercise, we <a id="_idIndexMarker391"/>will experiment with different input parameters to control a few visual properties of the points in the scatter plot. These controls are provided by the <strong class="source-inline">geom_point()</strong> function. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Generate a scatter plot between <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong>, and color the points using <strong class="source-inline">disp</strong>. Show the points as circles of <span class="No-Break">size </span><span class="No-Break"><strong class="source-inline">4</strong></span><span class="No-Break">:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(hp, mpg, color=disp)) +&#13;
  geom_point(shape=1, size=4) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.8</em>, where we see that the points are enlarged to be circles of <span class="No-Break">different colors:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer030" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_008.jpg" alt="Figure 4.8 – Generating the same scatter plot with bigger-sized circles as points" width="1067" height="715"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.8 – Generating the same scatter plot with bigger-sized circles as points</p>&#13;
			<p class="list-inset">Note that setting <strong class="source-inline">shape=1</strong> in <strong class="source-inline">geom_point()</strong> presents the points as circles. We could show them in other forms by changing this argument. For example, the<a id="_idIndexMarker392"/> following command visualizes the points as triangles of a <span class="No-Break">smaller size:</span></p>&#13;
			<pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(hp, mpg, color=disp)) +&#13;
  geom_point(shape=2, size=2) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre>			<p class="list-inset">This is shown in <span class="No-Break"><em class="italic">Figure 4</em></span><span class="No-Break"><em class="italic">.9</em></span><span class="No-Break">:</span></p>&#13;
			<div>&#13;
				<div id="_idContainer031" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_009.jpg" alt="Figure 4.9 – Visualizing the points as triangles in the scatter plot" width="1067" height="717"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.9 – Visualizing the points as triangles in the scatter plot</p>&#13;
			<p class="list-inset">Next, we will look<a id="_idIndexMarker393"/> at how to make the scatter plot more visually appealing by filling in the inner color of <span class="No-Break">the points.</span></p>&#13;
			<ol>&#13;
				<li value="2">Fill in the color of the previous scatter plot using <strong class="source-inline">cyl</strong> (after converting it to a factor type) in the <strong class="source-inline">aes()</strong> function, and set the <strong class="source-inline">shape</strong> parameter to <strong class="source-inline">21</strong>, <strong class="source-inline">size</strong> to <strong class="source-inline">5</strong>, and transparency (via <strong class="source-inline">alpha</strong>) to <strong class="source-inline">0.6</strong> in the <span class="No-Break"><strong class="source-inline">geom_point()</strong></span><span class="No-Break"> function:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(wt, mpg, fill = factor(cyl))) +&#13;
  geom_point(shape = 21, size = 5, alpha = 0.6) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Looking at the output in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.10</em>, the plot now looks more visually appealing, where three groups of points are spread across different ranges of <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong>. A shrewd reader may wonder why we are setting <strong class="source-inline">shape=21</strong> when the points are still visualized as circles. This is because <strong class="source-inline">21</strong> is a special value that allows the<a id="_idIndexMarker394"/> inner color of circles to be filled, along with their outlines or <span class="No-Break">outer color:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer032" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_010.jpg" alt="Figure 4.10 – Filling the inner color of the points in the scatter plot" width="1066" height="718"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.10 – Filling the inner color of the points in the scatter plot</p>&#13;
			<p>Note that other than visualizing points on a graph, we can also present them as textual labels, which is more informative in a particular scenario. It could also be the case that multiple points overlap, making it difficult to tell them apart. Let’s look at how to handle such situations and present the points using an alternative way via the <span class="No-Break">following exercise.</span></p>&#13;
			<h3>Exercise 4.5 – Alternative ways of presenting points in a scatter plot</h3>&#13;
			<p>In this exercise, we <a id="_idIndexMarker395"/>will learn two different ways of presenting the points in a scatter plot: showing textual labels and jittering the overlapping points. Both techniques will add more flexibility to our plotting toolkit. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Visualize the brand names based on the names of each row using <strong class="source-inline">row.names()</strong> and plot them on the previous scatter plot of <strong class="source-inline">hp</strong> against <strong class="source-inline">mpg</strong> <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">geom_text()</strong></span><span class="No-Break">:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(hp, mpg)) +&#13;
  geom_text(label=row.names(mtcars)) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"))</pre><p class="list-inset">Running this command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.11</em>, where brand names replace the points. However, some brand names overlap with each other, making it difficult to identify their specific text. Let us see how to <span class="No-Break">remedy this:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer033" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_011.jpg" alt="Figure 4.11 – Showing brand names in a scatter plot" width="1072" height="718"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.11 – Showing brand names in a scatter plot</p>&#13;
			<ol>&#13;
				<li value="2">Adjust the overlapping text using the <strong class="source-inline">position_jitter()</strong> function by passing it into<a id="_idIndexMarker396"/> the <strong class="source-inline">position</strong> argument of the <span class="No-Break"><strong class="source-inline">geom_text()</strong></span><span class="No-Break"> function:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(hp, mpg)) +&#13;
  geom_text(label=row.names(mtcars),&#13;
            fontface = "bold",&#13;
           position=position_jitter(width=20,height=20)) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"))</pre><p class="list-inset">Executing this command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.12</em>, where we have additionally specified the <strong class="source-inline">fontface</strong> argument to be <strong class="source-inline">bold</strong> for better clarity. By changing the <strong class="source-inline">width</strong> and <strong class="source-inline">height</strong> parameters of the <strong class="source-inline">position_jitter()</strong> function and passing it to the <strong class="source-inline">position</strong> argument of <strong class="source-inline">geom_text()</strong>, we managed to adjust the position of the text on the graph, which is now more <span class="No-Break">visually digestible:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer034" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_012.jpg" alt="Figure 4.12 – Jittering the position of the text" width="1074" height="712"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.12 – Jittering the position of the text</p>&#13;
			<p class="list-inset">Next, we will look at <a id="_idIndexMarker397"/>how to jitter <span class="No-Break">overlapping points.</span></p>&#13;
			<ol>&#13;
				<li value="3">Generate a scatter plot of factored <strong class="source-inline">cyl</strong> against <strong class="source-inline">mpg</strong>, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(factor(cyl), mpg)) +&#13;
  geom_point() +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"))</pre><p class="list-inset">Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.13</em>, where we intentionally used <a id="_idIndexMarker398"/>the <strong class="source-inline">cyl</strong> categorical variable to show that multiple points are overlapping on <span class="No-Break">the graph:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer035" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_013.jpg" alt="Figure 4.13 – Visualizing a scatter plot with overlapping points" width="1069" height="717"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.13 – Visualizing a scatter plot with overlapping points</p>&#13;
			<p class="list-inset">Let us adjust the position of the overlapping points so that they are visually separable, giving us a sense of how many such points line up on a single spot. Note that jittering means adding random positional adjustments to the points in <span class="No-Break">this case.</span></p>&#13;
			<ol>&#13;
				<li value="4">Jitter the points using <strong class="source-inline">geom_jitter()</strong>, <span class="No-Break">like so:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(factor(cyl), mpg)) +&#13;
  geom_jitter() +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"))</pre><p class="list-inset">Running this <a id="_idIndexMarker399"/>command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.14</em>, where the points along each category of <strong class="source-inline">cyl</strong> are now separated from each other instead of aligning on the same line. Adding random jitters thus helps visually separate the overlapping points using <span class="No-Break">random perturbations:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer036" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_014.jpg" alt="Figure 4.14 – Randomly jittering the overlapping points" width="1074" height="714"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.14 – Randomly jittering the overlapping points</p>&#13;
			<p>Next, we will look at the geometry of graphics that determines the visual elements shown in <span class="No-Break">the plot.</span></p>&#13;
			<h1 id="_idParaDest-82"><a id="_idTextAnchor083"/>Geometries in graphics</h1>&#13;
			<p>The previous section mostly covered scatter plots. In this section, we will go over two additional common types of plots: bar charts and line plots. We will discuss different ways to construct these plots, focusing on the geometries that can be used to control layer-specific visual properties of <span class="No-Break">the graph.</span></p>&#13;
			<h2 id="_idParaDest-83"><a id="_idTextAnchor084"/>Understanding geometry in scatter plots</h2>&#13;
			<p>Let us revisit the <a id="_idIndexMarker400"/>scatter plot and zoom in on the geometry layer. The<a id="_idIndexMarker401"/> geometry layer determines how the plot actually looks, which is an essential layer in our visual communication. At the time of writing, there are over 50 geometries we can choose from, all of which start with the <span class="No-Break"><strong class="source-inline">geom_</strong></span><span class="No-Break"> keyword.</span></p>&#13;
			<p>Some overall guidelines apply when deciding which type of geometry to use. For example, the following list contains the possible kinds of applicable geometries for a typical <span class="No-Break">scatter plot:</span></p>&#13;
			<ul>&#13;
				<li><strong class="bold">Point</strong>, which <a id="_idIndexMarker402"/>visualizes the data <span class="No-Break">as points</span></li>&#13;
				<li><strong class="bold">Jitter</strong>, which <a id="_idIndexMarker403"/>adds positional jittering to a <span class="No-Break">scatter plot</span></li>&#13;
				<li><strong class="bold">Abline</strong>, which <a id="_idIndexMarker404"/>adds a line on the <span class="No-Break">scatter plot</span></li>&#13;
				<li><strong class="bold">Smooth</strong>, which smooths the<a id="_idIndexMarker405"/> plot by fitting a trend line along with the confidence bounds to help identify a particular pattern in <span class="No-Break">the data</span></li>&#13;
				<li><strong class="bold">Count</strong>, which counts and <a id="_idIndexMarker406"/>shows the number of observations at each location in the <span class="No-Break">scatter plot</span></li>&#13;
			</ul>&#13;
			<p>Each geometry layer is associated with its own aesthetic configurations, including both compulsory and optional settings. For example, the <strong class="source-inline">geom_point()</strong> function requires <strong class="source-inline">x</strong> and <strong class="source-inline">y</strong> as mandatory arguments to uniquely locate points on the plot and allows optional settings such as the <strong class="source-inline">alpha</strong> parameter to control the level of transparency, as well as <strong class="source-inline">color</strong> and <strong class="source-inline">fill</strong> to manage the coloring of the points, along with their <strong class="source-inline">shape</strong> and <strong class="source-inline">size</strong> parameters, and <span class="No-Break">so on.</span></p>&#13;
			<p>Since the geometry layer provides layer-specific control, we can set some of the visual properties in either the aesthetics layer or the geometry layer. For example, the following code generates the same plot as the one shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.15</em>, where the coloring can be set in either the base <strong class="source-inline">ggplot()</strong> function or the layer-specific <span class="No-Break"><strong class="source-inline">geom_point()</strong></span><span class="No-Break"> function:</span></p>&#13;
			<pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(hp, mpg, color=factor(cyl))) +&#13;
  geom_point() +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(hp, mpg)) +&#13;
  geom_point(aes(col=factor(cyl))) +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre>			<p>That <a id="_idIndexMarker407"/>produces<a id="_idIndexMarker408"/> the <span class="No-Break">following plot:</span></p>&#13;
			<div>&#13;
				<div id="_idContainer037" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_015.jpg" alt="Figure 4.15 – Generating the same scatter plot using layer-specific geometry control" width="1065" height="717"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.15 – Generating the same scatter plot using layer-specific geometry control</p>&#13;
			<p>The<a id="_idIndexMarker409"/> flexibility from layer-specific control manifests when we have more than one layer (not necessarily a different type) to display in the plot. We will see how multiple geometry<a id="_idIndexMarker410"/> layers can be used together in the <span class="No-Break">following exercise.</span></p>&#13;
			<h3>Exercise 4.6 – Using multiple geometry layers</h3>&#13;
			<p>In this exercise, we will <a id="_idIndexMarker411"/>display the average <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong> values across different groups of <strong class="source-inline">cyl</strong> on top of the previous scatter plot. Once obtained from the raw <strong class="source-inline">mtcars</strong> dataset, extra mean statistics can be added by overlaying another geometry layer, taking the same type of scatter plot. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Calculate the average values for all columns for each group of <strong class="source-inline">cyl</strong> using the <strong class="source-inline">dplyr</strong> library and store the result in a variable <span class="No-Break">called </span><span class="No-Break"><strong class="source-inline">tmp</strong></span><span class="No-Break">:</span><pre class="source-code">&#13;
&gt;&gt;&gt; library(dplyr)&#13;
&gt;&gt;&gt; tmp = mtcars %&gt;%&#13;
  group_by(factor(cyl)) %&gt;%&#13;
  summarise_all(mean)&#13;
&gt;&gt;&gt; tmp&#13;
# A tibble: 3 × 12&#13;
  `factor(cyl)`   mpg   cyl  disp    hp  drat    wt  qsec&#13;
  &lt;fct&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;&#13;
1 4              26.7     4  105.  82.6  4.07  2.29  19.1&#13;
2 6              19.7     6  183. 122.   3.59  3.12  18.0&#13;
3 8              15.1     8  353. 209.   3.23  4.00  16.8&#13;
# … with 4 more variables: vs &lt;dbl&gt;, am &lt;dbl&gt;,&#13;
#   gear &lt;dbl&gt;, carb &lt;dbl&gt;</pre><p class="list-inset">We can see that the summary statistics on the average of all columns are obtained using the <strong class="source-inline">summarize_all()</strong> function, a utility function that applies the input function across all columns for each group. Here, we pass the <strong class="source-inline">mean</strong> function to calculate the average of a column. The resulting <strong class="source-inline">tibble</strong> object, stored in <strong class="source-inline">tmp</strong>, contains <a id="_idIndexMarker412"/>the average value for all variables across three groups <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">cyl</strong></span><span class="No-Break">.</span></p><p class="list-inset">It is important to note that upon adding an extra geometry layer, the base aesthetics layer expects the same column names in each geometry layer. The base aesthetics layer in the <strong class="source-inline">ggplot()</strong> function applies to all geometry layers. Let us see how to add an extra geometry layer as a scatter plot to show the average <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong> values across different groups <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">cyl</strong></span><span class="No-Break">.</span></p></li>				<li>Add an extra layer of scatter plot to show the average <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong> values as big squares for each group <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">cyl</strong></span><span class="No-Break">:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=hp, y=mpg, color=factor(cyl))) +&#13;
  geom_point() +&#13;
  geom_point(data=tmp, shape=15, size=6) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.16</em>, where the big squares (obtained by setting <strong class="source-inline">shape=15</strong> and <strong class="source-inline">size=6</strong> in the second <strong class="source-inline">geom_point</strong> layer) are sourced from the <strong class="source-inline">tmp</strong> dataset, as specified by the <strong class="source-inline">data</strong> parameter in the additional <span class="No-Break">geometry layer.</span></p><p class="list-inset">Note that the average <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong> values are automatically left-joined into the existing dataset, which shows different values of <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong> for each group of <strong class="source-inline">cyl</strong>. To ensure the two geometry layers are compatible with each other when plotted together, we need to ensure all matching coordinates (the <strong class="source-inline">x</strong> and <strong class="source-inline">y</strong> arguments) exist in <a id="_idIndexMarker413"/>the corresponding <span class="No-Break">raw datasets:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer038" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_016.jpg" alt="Figure 4.16 – Visualizing the average hp and mpg values for each group of cyl" width="1055" height="719"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.16 – Visualizing the average hp and mpg values for each group of cyl</p>&#13;
			<p>This plot consists of two geometry layers, where the first layer plots each observation as small circles, and the second layer plots the average values as big boxes for <strong class="source-inline">hp</strong> and <strong class="source-inline">mpg</strong> for each group of <strong class="source-inline">cyl</strong>. Adding extra layers follows the same principle, as long as the data source for each layer contains the column names as specified in the base <span class="No-Break">aesthetics layer.</span></p>&#13;
			<p>To further illustrate the need for matching coordinates for multiple layers, let us try typing the following command in the console, where we only select the <strong class="source-inline">mpg</strong> and <strong class="source-inline">disp</strong> columns in the raw data passed to the second geometry layer. As you can see from the output, the <strong class="source-inline">hp</strong> column<a id="_idIndexMarker414"/> is expected, without which an error <span class="No-Break">is thrown:</span></p>&#13;
			<pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=hp, y=mpg, color=factor(cyl))) +&#13;
  geom_point() +&#13;
  geom_point(data=tmp[,c("mpg","disp")], shape=15, size=6)&#13;
Error in FUN(X[[i]], ...) : object 'hp' not found</pre>			<p>In the next section, we will look at a new type of plot: a bar chart, along with its associated <span class="No-Break">geometry layer.</span></p>&#13;
			<h2 id="_idParaDest-84"><a id="_idTextAnchor085"/>Introducing bar charts</h2>&#13;
			<p>A bar chart displays<a id="_idIndexMarker415"/> certain statistics (such as frequency or proportion) of a categorical or continuous variable in the form of bars. Among multiple types of bar charts, a histogram is a special type of bar chart that shows the binned distribution of a single continuous variable. Therefore, plotting a histogram is always in terms of one continuous input variable, achieved using the <strong class="source-inline">geom_histogram()</strong> function and only specifying the <strong class="source-inline">x</strong> argument. Under the hood, the function first cuts the continuous input variable into discrete bins. It then uses the internally calculated <strong class="source-inline">count</strong> variable to indicate the number of observations in each bin to be passed to the <span class="No-Break"><strong class="source-inline">y</strong></span><span class="No-Break"> argument.</span></p>&#13;
			<p>Let us look at how to build a histogram in the <span class="No-Break">following exercise.</span></p>&#13;
			<h3>Exercise 4.7 – Building a histogram</h3>&#13;
			<p>In this exercise, we will look at <a id="_idIndexMarker416"/>different ways to apply positional adjustments when displaying a histogram. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Build a histogram of the <strong class="source-inline">hp</strong> variable using the <strong class="source-inline">geom_histogram()</strong> layer, <span class="No-Break">like so:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=hp)) +&#13;
  geom_histogram() +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"))&#13;
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</pre><p class="list-inset">Running this <a id="_idIndexMarker417"/>command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.17</em>, along with the warning message on the binning. This is because the default binning value is not suitable since there are multiple gaps between the bars, making it difficult to interpret for a continuous variable. We will need to fine-tune the width of each bin using the <span class="No-Break"><strong class="source-inline">binwidth</strong></span><span class="No-Break"> argument:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer039" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_017.jpg" alt="Figure 4.17 – Plotting a histogram for hp" width="1070" height="713"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.17 – Plotting a histogram for hp</p>&#13;
			<ol>&#13;
				<li value="2">Adjust the <strong class="source-inline">binwidth</strong> argument<a id="_idIndexMarker418"/> to make the histogram continuous and remove the warning message, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=hp)) +&#13;
  geom_histogram(binwidth=40) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"))</pre><p class="list-inset">This produces the <span class="No-Break">following output:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer040" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_018.jpg" alt="Figure 4.18 – Displaying a continuous histogram" width="1075" height="711"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.18 – Displaying a continuous histogram</p>&#13;
			<p class="list-inset">Making a <a id="_idIndexMarker419"/>continuous-looking histogram is data-dependent and requires trial and error. In this case, setting <strong class="source-inline">binwidth=40</strong> seems to be working <span class="No-Break">for us.</span></p>&#13;
			<p class="list-inset">Next, we will introduce grouping to the previous histogram by changing the coloring of <span class="No-Break">the bars.</span></p>&#13;
			<ol>&#13;
				<li value="3">Fill in the bars with different colors using the <strong class="source-inline">fill</strong> argument based on the <span class="No-Break">factored </span><span class="No-Break"><strong class="source-inline">cyl</strong></span><span class="No-Break">:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=hp, fill=factor(cyl))) +&#13;
  geom_histogram(binwidth=40) +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.19</em>, where each bar represents different groups of <strong class="source-inline">cyl</strong>. However, a shrewd reader may immediately find that, for some bars with two colors, it is difficult to discern whether they are overlapping or stacked on top of one another. Indeed, the default setting for the histogram is <strong class="source-inline">position="stack"</strong>, meaning the bars are stacked by default. To remove such confusion, we can explicitly show the bars side <span class="No-Break">by</span><span class="No-Break"><a id="_idIndexMarker420"/></span><span class="No-Break"> side:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer041" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_019.jpg" alt="Figure 4.19 – Coloring the bars in the histogram" width="1066" height="714"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.19 – Coloring the bars in the histogram</p>&#13;
			<ol>&#13;
				<li value="4">Display the bars side by side by setting <strong class="source-inline">position="dodge"</strong>, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=hp, fill=factor(cyl))) +&#13;
  geom_histogram(binwidth=40, position="dodge") +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this<a id="_idIndexMarker421"/> command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.20</em>, where the bars are now shown side by side. We can further adjust the <strong class="source-inline">binwidth</strong> parameter to reduce the gaps <span class="No-Break">in between:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer042" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_020.jpg" alt="Figure 4.20 – Side-by-side bar chart" width="1064" height="713"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.20 – Side-by-side bar chart</p>&#13;
			<p class="list-inset">Finally, we can also show the statistics as proportions instead <span class="No-Break">of counts.</span></p>&#13;
			<ol>&#13;
				<li value="5">Show the previous histogram of <strong class="source-inline">hp</strong> by <strong class="source-inline">cyl</strong> as proportions by executing the <span class="No-Break">following code:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=hp, fill=factor(cyl))) +&#13;
  geom_histogram(binwidth=40, position="fill") +&#13;
  ylab("Proportion") +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.21</em>, where the <strong class="source-inline">ylab()</strong> function is used to change the label of the <em class="italic">y</em> axis. Since the proportion of each bin needs to sum to <strong class="source-inline">1</strong>, the plot contains bars of equal height, each containing one or more groups. For each bin with multiple groups, the height of each color represents the proportion of observations falling in this group of <strong class="source-inline">cyl</strong> within the specific bin. Such a plot is often used when we only care about the relative percentage<a id="_idIndexMarker422"/> of each group instead of the <span class="No-Break">absolute count:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer043" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_021.jpg" alt="Figure 4.21 – Showing the bar chart as proportions" width="1070" height="714"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.21 – Showing the bar chart as proportions</p>&#13;
			<p>As mentioned earlier, a histogram is a special type of bar chart. A classical bar chart contains a categorical variable on the <em class="italic">x</em> axis, where each position represents the count of the number of observations falling into that particular category. A bar chart can be generated using the <strong class="source-inline">geom_bar()</strong> function, which allows the same positional adjustment <a id="_idIndexMarker423"/>as <strong class="source-inline">geom_histogram()</strong>. Let us go through the following exercise to learn <span class="No-Break">its usage.</span></p>&#13;
			<h3>Exercise 4.8 – Building a bar chart</h3>&#13;
			<p>In this exercise, we will <a id="_idIndexMarker424"/>visualize the count of observations by <strong class="source-inline">cyl</strong> and <strong class="source-inline">gear</strong> as a bar chart. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Plot the count of observations for each unique combination of <strong class="source-inline">cyl</strong> and <strong class="source-inline">gear</strong> in a stacked bar chart, using <strong class="source-inline">cyl</strong> as the <span class="No-Break"><em class="italic">x</em></span><span class="No-Break"> axis:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=factor(cyl), fill=factor(gear))) +&#13;
  geom_bar(position="stack") +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.22</em>, where the height of the bar represents the count of observations for the particular combination of <strong class="source-inline">cyl</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">gear</strong></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer044" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_022.jpg" alt="Figure 4.22 – Stacked bar chart by cyl and gear" width="1066" height="712"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.22 – Stacked bar chart by cyl and gear</p>&#13;
			<p class="list-inset">We can also <a id="_idIndexMarker425"/>represent the bar chart using the proportion/percentage of observations in the <span class="No-Break">respective group.</span></p>&#13;
			<ol>&#13;
				<li value="2">Convert the bar chart to a percentage-based plot to show the distribution of each combination, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=factor(cyl), fill=factor(gear))) +&#13;
  geom_bar(position="fill") +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><span class="No-Break"><em class="italic">.23</em></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer045" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_023.jpg" alt="Figure 4.23 – Visualizing a bar chart as proportions" width="1072" height="715"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.23 – Visualizing a bar chart as proportions</p>&#13;
			<p class="list-inset">As before, we<a id="_idIndexMarker426"/> can also convert the bar chart from stacked to side <span class="No-Break">by side.</span></p>&#13;
			<ol>&#13;
				<li value="3">Visualize the previous information in a side-by-side bar chart, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=factor(cyl), fill=factor(gear))) +&#13;
  geom_bar(position="dodge") +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><span class="No-Break"><em class="italic">.24</em></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer046" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_024.jpg" alt="Figure 4.24 – A side-by-side bar chart" width="1070" height="716"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.24 – A side-by-side bar chart</p>&#13;
			<p>We can also customize<a id="_idIndexMarker427"/> the bar chart so that the bars partially overlap with each other. This is achieved using the <strong class="source-inline">position_dodge()</strong> function as follows, where we adjust the <strong class="source-inline">width</strong> parameter to jitter the overlapping bars to a <span class="No-Break">certain extent:</span></p>&#13;
			<pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(mtcars, aes(x=factor(cyl), fill=factor(gear))) +&#13;
  geom_bar(position = position_dodge(width=0.2)) +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre>			<p>Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><span class="No-Break"><em class="italic">.25</em></span><span class="No-Break">:</span></p>&#13;
			<div>&#13;
				<div id="_idContainer047" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_025.jpg" alt="Figure 4.25 – Adjusting overlapping bars in a bar chart" width="1069" height="715"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.25 – Adjusting overlapping bars in a bar chart</p>&#13;
			<p>Next, we will look at another popular type of plot: a <span class="No-Break">line plot.</span></p>&#13;
			<h2 id="_idParaDest-85"><a id="_idTextAnchor086"/>Introducing line plots</h2>&#13;
			<p>A <strong class="bold">line plot</strong> displays the <a id="_idIndexMarker428"/>value of one variable as the other variable changes. As with a scatter plot, a line plot can be considered scattered points connected via a line. It is mainly used to depict the relationship between two variables. For example, when two variables are positively correlated with each other, increasing one variable would lead to a seemingly proportionate increase in the other variable. Visualizing such a relationship on a line plot could result in a trend line between the two variables with a <span class="No-Break">positive slope.</span></p>&#13;
			<p>One of the most widely used types of line plots is the time series plot, where the value of a particular metric (such as stock price) is shown as a function of time (such as daily). In the following exercise, we will look at the quarterly earnings of Johnson &amp; Johnson between 1960 and 1981, using the <strong class="source-inline">JohnsonJohnson</strong> dataset provided by base R. We will explore different ways to visualize the line chart, along with a little bit of data processing specific to time <span class="No-Break">series data.</span></p>&#13;
			<h3>Exercise 4.9 – Building a time series plot</h3>&#13;
			<p>In this exercise, we will look at visualizing the <a id="_idIndexMarker429"/>time series data as a line plot. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Examine the structure of the <strong class="source-inline">JohnsonJohnson</strong> dataset by executing the <span class="No-Break">following code:</span><pre class="source-code">&#13;
&gt;&gt;&gt; str(JohnsonJohnson)&#13;
Time-Series [1:84] from 1960 to 1981: 0.71 0.63 0.85 0.44 0.61 0.69 0.92 0.55 0.72 0.77 ...</pre><p class="list-inset">The output suggests that the dataset is a univariate (meaning a single variable) time series ranging from <strong class="source-inline">1960</strong> to <strong class="source-inline">1981</strong>. Printing out its contents (only showing the top five rows) also tells us that the frequency is quarterly, using year-quarter as a unique index for each data point in the <span class="No-Break">time series:</span></p><pre class="source-code">&gt;&gt;&gt; JohnsonJohnson&#13;
      Qtr1  Qtr2  Qtr3  Qtr4&#13;
1960  0.71  0.63  0.85  0.44&#13;
1961  0.61  0.69  0.92  0.55&#13;
1962  0.72  0.77  0.92  0.60&#13;
1963  0.83  0.80  1.00  0.77&#13;
1964  0.92  1.00  1.24  1.00</pre><p class="list-inset">Let us convert it to our familiar DataFrame format to ease <span class="No-Break">data manipulation.</span></p></li>				<li>Convert it to a DataFrame called <strong class="source-inline">JohnsonJohnson2</strong> with two columns: <strong class="source-inline">qtr_earning</strong> to store the quarterly time series, and <strong class="source-inline">date</strong> to store the <span class="No-Break">approximate date:</span><pre class="source-code">&#13;
&gt;&gt;&gt; library(zoo)&#13;
&gt;&gt;&gt; JohnsonJohnson2 = data.frame(qtr_earning=as.matrix(JohnsonJohnson),&#13;
           date=as.Date(as.yearmon(time(JohnsonJohnson))))&#13;
&gt;&gt;&gt; head(JohnsonJohnson2, n=3)&#13;
  qtr_earning       date&#13;
1        0.71 1960-01-01&#13;
2        0.63 1960-04-01&#13;
3        0.85 1960-07-01</pre><p class="list-inset">The <strong class="source-inline">date</strong> column is obtained by extracting the <strong class="source-inline">time</strong> index from the <strong class="source-inline">JohnsonJohnson</strong> time series object, displaying as the year-month format using <strong class="source-inline">as.yearmon()</strong>, and then converting to a date format <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">as.Date()</strong></span><span class="No-Break">.</span></p><p class="list-inset">We will also add two extra indicator columns for plotting <span class="No-Break">purposes later.</span></p></li>				<li>Add an <strong class="source-inline">ind</strong> indicator <a id="_idIndexMarker430"/>column that takes the value of <strong class="source-inline">TRUE</strong> if the date is equal to or beyond <strong class="source-inline">1975-01-01</strong>, and <strong class="source-inline">FALSE</strong> otherwise. Also, extract the quarter from the <strong class="source-inline">date</strong> variable and store it in the <span class="No-Break"><strong class="source-inline">qtr</strong></span><span class="No-Break"> variable:</span><pre class="source-code">&#13;
&gt;&gt;&gt; JohnsonJohnson2 = JohnsonJohnson2 %&gt;%&#13;
  mutate(ind = if_else(date &gt;= as.Date("1975-01-01"), TRUE, FALSE),&#13;
         qtr = quarters(date))&#13;
&gt;&gt;&gt; head(JohnsonJohnson2, n=3)&#13;
  qtr_earning       date   ind qtr&#13;
1        0.71 1960-01-01 FALSE  Q1&#13;
2        0.63 1960-04-01 FALSE  Q2&#13;
3        0.85 1960-07-01 FALSE  Q3</pre><p class="list-inset">In this command, we used the <strong class="source-inline">quarters()</strong> function to extract the quarter from a date-formatted field. Next, we will plot the quarterly earnings as a <span class="No-Break">time series.</span></p></li>				<li>Plot <strong class="source-inline">qtr_earning</strong> as a<a id="_idIndexMarker431"/> function of <strong class="source-inline">date</strong> using a line plot, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(JohnsonJohnson2, aes(x=date, y=qtr_earning)) +&#13;
         geom_line() +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"))</pre><p class="list-inset">Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.26</em>, where we specify the <strong class="source-inline">date</strong> column as the <em class="italic">x</em> axis and <strong class="source-inline">qtr_earning</strong> as the <em class="italic">y</em> axis, followed by the <span class="No-Break"><strong class="source-inline">geom_line()</strong></span><span class="No-Break"> layer:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer048" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_026.jpg" alt="Figure 4.26 – Time series plot of quarterly earnings" width="1067" height="711"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.26 – Time series plot of quarterly earnings</p>&#13;
			<p class="list-inset">The line chart for the <a id="_idIndexMarker432"/>quarterly earnings displays a long-term increasing trend and short-term fluctuations. The subject of time series forecasting focuses on using these structural components (such as trend and seasonality) to predict <span class="No-Break">future values.</span></p>&#13;
			<p class="list-inset">In addition, we can color code the time series so that different line segments display a different color according to another <span class="No-Break">grouping variable.</span></p>&#13;
			<ol>&#13;
				<li value="5">Specify the color of the line plot according to the <strong class="source-inline">ind</strong> column, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(JohnsonJohnson2, aes(x=date, y=qtr_earning,&#13;
                            color=ind)) +&#13;
  geom_line() +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.27</em>, where we set <strong class="source-inline">color=ind</strong> in the base aesthetics layer to change the coloring. Note that the two line segments are disconnected since they are essentially separate time series plotted on <span class="No-Break">the chart:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer049" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_027.jpg" alt="Figure 4.27 – Two line charts of different colors" width="1066" height="711"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.27 – Two line charts of different colors</p>&#13;
			<p class="list-inset">We can also plot <a id="_idIndexMarker433"/>multiple lines when there are multiple categories in the grouping variable, each of which will assume a <span class="No-Break">different color.</span></p>&#13;
			<ol>&#13;
				<li value="6">Plot the time series for each quarter respectively, <span class="No-Break">like so:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(JohnsonJohnson2, aes(x=date, y=qtr_earning,&#13;
                            color=qtr)) +&#13;
  geom_line() +&#13;
  theme(axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running the preceding command will generate the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.28</em>, where <strong class="bold">Q1</strong> seems to be outperforming others as it <span class="No-Break">approaches </span><span class="No-Break"><strong class="source-inline">1980</strong></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<div>&#13;
				<div id="_idContainer050" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_028.jpg" alt="Figure 4.28 – Yearly times series plot for each quarter" width="1067" height="712"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.28 – Yearly times series plot for each quarter</p>&#13;
			<p>In the next section, we will look at the theme layer, which controls the stylistic elements of <span class="No-Break">a plot.</span></p>&#13;
			<h1 id="_idParaDest-86"><a id="_idTextAnchor087"/>Controlling themes in graphics</h1>&#13;
			<p>The theme layer specifies all <a id="_idIndexMarker434"/>non-data-related properties on the plot, such as the background, legend, axis labels, and so on. Proper control of the themes in the plot could aid visual communication by highlighting critical information and directing users’ attention to the intended message we would like <span class="No-Break">to convey.</span></p>&#13;
			<p>There are three types of visual elements controlled by the theme layer, <span class="No-Break">as follows:</span></p>&#13;
			<ul>&#13;
				<li><strong class="bold">Text</strong>, used to specify the <a id="_idIndexMarker435"/>textual display (for example, color) of the <span class="No-Break">axis label</span></li>&#13;
				<li><strong class="bold">Line</strong>, used to<a id="_idIndexMarker436"/> specify the visual properties of the axes such as color and <span class="No-Break">line type</span></li>&#13;
				<li><strong class="bold">Rectangle</strong>, used to <a id="_idIndexMarker437"/>control the borders and backgrounds of <span class="No-Break">the plot</span></li>&#13;
			</ul>&#13;
			<p>All three types are specified using functions that start with <strong class="source-inline">element_</strong>, including examples such as <strong class="source-inline">element_text()</strong> and <strong class="source-inline">element_line()</strong>. We will go over these functions in the <span class="No-Break">following section.</span></p>&#13;
			<h2 id="_idParaDest-87"><a id="_idTextAnchor088"/>Adjusting themes</h2>&#13;
			<p>The theme layer can be easily <a id="_idIndexMarker438"/>applied as an additional layer on the existing graph. Let us go through an exercise on how this can <span class="No-Break">be achieved.</span></p>&#13;
			<h3>Exercise 4.10 – Applying themes</h3>&#13;
			<p>In this exercise, we will look at <a id="_idIndexMarker439"/>how to tweak the theme-related elements of the previous time series plot, including moving the legend and changing the properties of the axes. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Display the legend of the previous time series plot at the bottom by overlaying a theme layer with its <strong class="source-inline">legend.position</strong> argument specified as <strong class="source-inline">"bottom"</strong>. Also, enlarge the font size of the text along the axes <span class="No-Break">and legend:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(JohnsonJohnson2, aes(x=date, y=qtr_earning,&#13;
                            color=qtr)) +&#13;
  geom_line() +&#13;
  theme(legend.position="bottom",&#13;
        axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.29</em>, where the legend is now moved to the bottom of <span class="No-Break">the plot:</span></p></li>			</ol>&#13;
			<p class="IMG---Figure"> </p>&#13;
			<div>&#13;
				<div id="_idContainer051" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_029.jpg" alt="Figure 4.29 – Displaying the legend at the bottom" width="983" height="712"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.29 – Displaying the legend at the bottom</p>&#13;
			<p class="list-inset">We can also position the <a id="_idIndexMarker440"/>legend anywhere within the plot by providing the coordinate information to the <strong class="source-inline">legend.position</strong> argument. The coordinates start at the lower-left corner with a value of <strong class="source-inline">(0,0)</strong> and span all the way to the upper-right corner, taking the value of <strong class="source-inline">(1,1)</strong>. Since the upper-left part of the plot seems vacant, we may consider moving the legend there to save some <span class="No-Break">extra space.</span></p>&#13;
			<ol>&#13;
				<li value="2">Move the legend to the upper-left corner by supplying a pair of <span class="No-Break">proper coordinates:</span><pre class="source-code">&#13;
&gt;&gt;&gt; tmp = ggplot(JohnsonJohnson2, aes(x=date, y=qtr_earning,&#13;
                            color=qtr)) +&#13;
  geom_line() +&#13;
  theme(legend.position=c(0.1,0.8),&#13;
        axis.text=element_text(size=18),&#13;
       axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))&#13;
&gt;&gt;&gt; tmp</pre><p class="list-inset">Here, we specified the<a id="_idIndexMarker441"/> legend’s position to be <strong class="source-inline">(0.1, 0.8)</strong>. In general, configuring a proper position using the coordinate system requires trial and error. We have also saved the result in a variable called <strong class="source-inline">tmp</strong>, which will be used later. The generated plot is shown in <span class="No-Break"><em class="italic">Figure 4</em></span><span class="No-Break"><em class="italic">.30</em></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<p class="IMG---Figure"> </p>&#13;
			<div>&#13;
				<div id="_idContainer052" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_030.jpg" alt="Figure 4.30 – Coordinate-based positional adjustment for the legend" width="979" height="711"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.30 – Coordinate-based positional adjustment for the legend</p>&#13;
			<p class="list-inset">Next, we will adjust the properties of <span class="No-Break">the axes.</span></p>&#13;
			<ol>&#13;
				<li value="3">Based on the previous<a id="_idIndexMarker442"/> plot, change the color of the axes’ titles to blue using the <strong class="source-inline">element_text()</strong> function on the <strong class="source-inline">axis.title</strong> property. Also, make the axes’ lines solid black using the <strong class="source-inline">element_line()</strong> function on the <span class="No-Break"><strong class="source-inline">axis.line</strong></span><span class="No-Break"> property:</span><pre class="source-code">&#13;
&gt;&gt;&gt; tmp = tmp +&#13;
  theme(&#13;
    axis.title=element_text(color="blue"),&#13;
    axis.line = element_line(color = "black", linetype = "solid")&#13;
  )&#13;
&gt;&gt;&gt; tmp</pre><p class="list-inset">Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.31</em>, where we used the <strong class="source-inline">element_text()</strong> and <strong class="source-inline">element_line()</strong> functions to adjust the visual properties (<strong class="source-inline">color</strong> and <strong class="source-inline">linetype</strong>) of the title (<strong class="source-inline">axis.title</strong>) and the lines (<strong class="source-inline">axis.line</strong>) for <span class="No-Break">the axes:</span></p></li>			</ol>&#13;
			<p class="IMG---Figure"> </p>&#13;
			<div>&#13;
				<div id="_idContainer053" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_031.jpg" alt="Figure 4.31 – Changing the titles and lines of the axes" width="983" height="712"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.31 – Changing the titles and lines of the axes</p>&#13;
			<p class="list-inset">Finally, we can change the <a id="_idIndexMarker443"/>default background and grids <span class="No-Break">as well.</span></p>&#13;
			<ol>&#13;
				<li value="4">Remove the default grids and background in the previous plot by executing the <span class="No-Break">following code:</span><pre class="source-code">&#13;
&gt;&gt;&gt; tmp = tmp +&#13;
  theme(&#13;
    panel.grid.major = element_blank(),&#13;
    panel.grid.minor = element_blank(),&#13;
    panel.background = element_blank()&#13;
  )&#13;
&gt;&gt;&gt; tmp</pre><p class="list-inset">Here, we used <strong class="source-inline">panel.grid.major</strong> and <strong class="source-inline">panel.grid.minor</strong> to access the grid properties and <strong class="source-inline">panel.background</strong> to access the background property of the plot. The <strong class="source-inline">element_blank()</strong> removes all existing configurations and is specified for<a id="_idIndexMarker444"/> all these three properties. The result is shown in <span class="No-Break"><em class="italic">Figure 4</em></span><span class="No-Break"><em class="italic">.32</em></span><span class="No-Break">:</span></p></li>			</ol>&#13;
			<p class="IMG---Figure"> </p>&#13;
			<div>&#13;
				<div id="_idContainer054" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_032.jpg" alt="Figure 4.32 – Removing the grids and background setting" width="983" height="712"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.32 – Removing the grids and background setting</p>&#13;
			<p>Note that we can also save the theme layer in a variable and apply it as an overlay to other plots. We treat the whole plot or a specific layer configuration as a variable, making it convenient to scale to <span class="No-Break">multiple plots.</span></p>&#13;
			<p>Besides creating our own themes, we can also utilize the built-in theme layers provided by <strong class="source-inline">ggplot2</strong>. As listed here, these built-in themes provide off-the-shelf solutions to <span class="No-Break">facilitate plotting:</span></p>&#13;
			<ul>&#13;
				<li><strong class="source-inline">theme_gray()</strong>, the default theme we <span class="No-Break">used earlier</span></li>&#13;
				<li><strong class="source-inline">theme_classic()</strong>, the traditional theme mostly used in <span class="No-Break">scientific plotting</span></li>&#13;
				<li><strong class="source-inline">theme_void()</strong>, which removes all <span class="No-Break">non-data-related properties</span></li>&#13;
				<li><strong class="source-inline">theme_bw()</strong>, mostly used when the transparency level <span class="No-Break">is configured</span></li>&#13;
			</ul>&#13;
			<p>For example, we can <a id="_idIndexMarker445"/>use the <strong class="source-inline">theme_classic()</strong> function to generate a similar plot as before, as shown in the following <span class="No-Break">code snippet:</span></p>&#13;
			<pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(JohnsonJohnson2, aes(x=date, y=qtr_earning,&#13;
                            color=qtr)) +&#13;
  geom_line() +&#13;
  theme_classic() +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre>			<p>Running this command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><span class="No-Break"><em class="italic">.33</em></span><span class="No-Break">:</span></p>&#13;
			<p class="IMG---Figure"> </p>&#13;
			<div>&#13;
				<div id="_idContainer055" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_033.jpg" alt="Figure 4.33 – Using out-of-the-box theme setting" width="976" height="709"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.33 – Using out-of-the-box theme setting</p>&#13;
			<p>Other than the built-in<a id="_idIndexMarker446"/> themes, the <strong class="source-inline">ggthemes</strong> package provides additional themes that further extend our choices of available themes. Let us explore this package in the <span class="No-Break">next section.</span></p>&#13;
			<h2 id="_idParaDest-88"><a id="_idTextAnchor089"/>Exploring ggthemes</h2>&#13;
			<p>The <strong class="source-inline">ggthemes</strong> package <a id="_idIndexMarker447"/>contains multiple pre-built themes. Just as using <strong class="source-inline">dplyr</strong> could significantly accelerate our data processing task, using the pre-built themes could also ease our graphing efforts compared with ground-up development. Let us look at a few available themes in <span class="No-Break">this package.</span></p>&#13;
			<h3>Exercise 4.11 – Exploring themes</h3>&#13;
			<p>In this exercise, we will explore a few <a id="_idIndexMarker448"/>additional out-of-the-box themes provided by <strong class="source-inline">ggthemes</strong>. Remember to download and load this package before continuing with the following code examples. We will cover two theme functions. Proceed <span class="No-Break">as follows:</span></p>&#13;
			<ol>&#13;
				<li>Apply the <strong class="source-inline">theme_fivethirtyeight</strong> theme on the previous plot, <span class="No-Break">as follows:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(JohnsonJohnson2, aes(x=date, y=qtr_earning,&#13;
                            color=qtr)) +&#13;
  geom_line() +&#13;
  theme_fivethirtyeight() +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this command <a id="_idIndexMarker449"/>generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.34</em>, where the legend is placed at <span class="No-Break">the bottom:</span></p></li>			</ol>&#13;
			<p class="IMG---Figure"> </p>&#13;
			<div>&#13;
				<div id="_idContainer056" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_034.jpg" alt="Figure 4.34 – Applying the theme_fivethirtyeight theme" width="975" height="695"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.34 – Applying the theme_fivethirtyeight theme</p>&#13;
			<ol>&#13;
				<li value="2">Apply the <strong class="source-inline">theme_tufte()</strong> theme, <span class="No-Break">like so:</span><pre class="source-code">&#13;
&gt;&gt;&gt; ggplot(JohnsonJohnson2, aes(x=date, y=qtr_earning,&#13;
                            color=qtr)) +&#13;
  geom_line() +&#13;
  theme_tufte() +&#13;
  theme(axis.text=element_text(size=18),&#13;
        axis.title=element_text(size=18,face="bold"),&#13;
        legend.text = element_text(size=20))</pre><p class="list-inset">Running this <a id="_idIndexMarker450"/>command generates the output shown in <span class="No-Break"><em class="italic">Figure 4</em></span><em class="italic">.35</em>, the type of plot commonly used in scientific papers. Note that the plots in academic papers recommend only showing essential information. This means that additional configurations such as background are discouraged. Real-life plots, on the other hand, prefer a decent balance between usefulness <span class="No-Break">and beauty:</span></p></li>			</ol>&#13;
			<p class="IMG---Figure"> </p>&#13;
			<div>&#13;
				<div id="_idContainer057" class="IMG---Figure">&#13;
					<img src="Images/B18680_04_035.jpg" alt="Figure 4.35 – Applying the theme_tufte theme" width="950" height="696"/>&#13;
				</div>&#13;
			</div>&#13;
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.35 – Applying the theme_tufte theme</p>&#13;
			<p>Throughout this section, we looked at controlling theme-related elements in a graph, which gives us great flexibility when it comes to fine-tuning and customizing <span class="No-Break">a graph.</span></p>&#13;
			<h1 id="_idParaDest-89"><a id="_idTextAnchor090"/>Summary</h1>&#13;
			<p>In this chapter, we introduced essential graphics techniques based on the <strong class="source-inline">ggplot2</strong> package. We started by going over the basic scatter plot and learned the grammar of developing layers in a plot. To build, edit, and improve a plot, we need to specify three essential layers: data, aesthetics, and geometries. For example, the <strong class="source-inline">geom_point()</strong> function used to build a scatter plot allows us to control the size, shape, and color of the points on a graph. We can also display them as text in addition to presenting points using the <span class="No-Break"><strong class="source-inline">geom_text()</strong></span><span class="No-Break"> function.</span></p>&#13;
			<p>We also covered the layer-specific control provided by the geometry layer and showed examples using bar charts and line plots. A bar chart can help represent the frequency distribution of categorical variables and the histogram of continuous variables. A line chart supports time series data and can help identify trends and patterns if <span class="No-Break">appropriately plotted.</span></p>&#13;
			<p>Finally, we also covered the theme layer, which allows us to control all non-data-related visual aspects of a graph. Coupled with the built-in themes by base R and off-the-shelf themes by <strong class="source-inline">ggthemes</strong>, we have many options to choose from and accelerate the <span class="No-Break">graphing effort.</span></p>&#13;
			<p>In the next chapter, we will cover <strong class="bold">exploratory data analysis</strong> (<strong class="bold">EDA</strong>), a common and essential step in many data analytics and <span class="No-Break">modeling tasks.</span></p>&#13;
		</div>&#13;
	</div></body></html>
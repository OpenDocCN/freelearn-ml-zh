<html><head></head><body>
		<div id="_idContainer151">
			<h1 id="_idParaDest-113" class="chapter-number"><a id="_idTextAnchor139"/>8</h1>
			<h1 id="_idParaDest-114"><a id="_idTextAnchor140"/>Building Unsupervised Models with K-Means Clustering</h1>
			<p><a id="_idTextAnchor141"/>So far, we have learned about building <strong class="bold">machine learning</strong> (<strong class="bold">ML</strong>) models where data is supplied with labels. In this chapter, we will learn about building ML models on a dataset without any labels by <a id="_idIndexMarker385"/>using the <strong class="bold">K-means clustering algorithm</strong>. Unlike <strong class="bold">supervised models</strong>, where predictions are made at the observation level, K-means clustering groups observations into clusters where they share a commonality – for example, similar demographics or <span class="No-Break">reading habits.</span></p>
			<p>This chapter will provide detailed examples of business problems that can be solved with these modeling techniques. By the end of this chapter, you will be in a position to identify a business problem that an <strong class="bold">unsupervised modeling technique</strong> can be applied to. You will also learn how to build, train, and evaluate K-means <span class="No-Break">model performance.</span></p>
			<p>In this chapter, we will cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Grouping data through <span class="No-Break">cluster analysis</span></li>
				<li>Creating a K-means <span class="No-Break">ML model</span></li>
				<li>Evaluating the results of <span class="No-Break">K-means clustering</span><a id="_idTextAnchor142"/></li>
			</ul>
			<h1 id="_idParaDest-115"><a id="_idTextAnchor143"/>Technical requirements</h1>
			<p>This chapter requires a web browser and access to <span class="No-Break">the following:</span></p>
			<ul>
				<li>An <span class="No-Break">AWS account</span></li>
				<li>An Amazon Redshift <span class="No-Break">Serverless endpoint</span></li>
				<li>Amazon Redshift Query <span class="No-Break">Editor v2</span></li>
				<li>Complete the <em class="italic">Getting started with Amazon Redshift Serverless</em> section in <a href="B19071_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic">Chapter 1</em></span></a></li>
			</ul>
			<p>You can find the code used in this chapter <span class="No-Break">here: </span><a href="https://github.com/PacktPublishing/Serverless-Machine-Learning-with-Amazon-Redshift/blob/main/CodeFiles/chapter8/chapter8.sql"><span class="No-Break">https://github.com/PacktPublishing/Serverless-Machine-Learning-with-Amazon-Redshift/blob/main/CodeFiles/chapter8/chapter8.sq<span id="_idTextAnchor144"/>l</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-116"><a id="_idTextAnchor145"/>Grouping data through cluster analysis</h1>
			<p>So far, we <a id="_idIndexMarker386"/>have explored datasets that contained input and target variables, and we trained a model with a set of input variables and a target variable. This is called supervised learning. However, how do you address a dataset that does not contain a label to supervise the training? <strong class="bold">Amazon Redshift ML</strong> supports<a id="_idIndexMarker387"/> unsupervised learning using the cluster analysis method, also known as the K-means algorithm. In <strong class="bold">cluster analysis</strong>, the ML algorithm<a id="_idIndexMarker388"/> automatically discovers the grouping of data points. For example, if you have a population of 1,000 people, a clustering algorithm can group them based on height, weight, <span class="No-Break">or age.</span></p>
			<p>Unlike supervised learning, where an ML model predicts an outcome based on a label, unsupervised models use unlabeled data. One type of unsupervised learning is clustering, where unlabeled data is grouped based on its similarity or differences. From a dataset with demographic information about individuals, you can create clusters based on young, adult, and elderly populations, underweight, normal weight, and overweight populations, and so on. These groups are calculated based on values – for example, if two people are young, then <a id="_idIndexMarker389"/>they are grouped together. These groups are called <strong class="bold">clusters</strong>. In the following diagram, you can see that input variables (<strong class="bold">Age</strong>, <strong class="bold">Height</strong>, and <strong class="bold">Weight</strong>) are grouped into <strong class="bold">young</strong>, <strong class="bold">adult</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="bold">elder</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer138" class="IMG---Figure">
					<img src="image/B19071_08_01.jpg" alt="Figure 8.1 – A simple cluster example"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – A simple cluster example</p>
			<p>In the preceding <a id="_idIndexMarker390"/>diagram, each individual data point is placed in a cluster, based on the distance from the center of the cluster, called the <strong class="bold">centroid</strong>. The<a id="_idIndexMarker391"/> distance from the centroid for each data point is calculated using<a id="_idIndexMarker392"/> the <strong class="bold">Euclidean distance formula</strong>. Data points that are closest to a given centroid have similarities and belong to the same group. In real-world situations, it is very common to find data points with overlapping clusters and too many of them. When you encounter too many clusters, then it is a challenge to identify the right number of clusters for <span class="No-Break">your dataset.</span></p>
			<p>Common<a id="_idIndexMarker393"/> use cases for a K-means cluster include <span class="No-Break">the following:</span></p>
			<ul>
				<li><strong class="bold">E-commerce</strong>: Grouping customers by <span class="No-Break">purchase history</span></li>
				<li><strong class="bold">Healthcare</strong>: Detecting patterns <span class="No-Break">of diseases</span></li>
				<li><strong class="bold">Finance</strong>: Grouping purchases into abnormal <span class="No-Break">versus normal</span></li>
			</ul>
			<p>Next, we will show you one of the common methods to help you determine how many clusters you <span class="No-Break">should use.</span></p>
			<h1 id="_idParaDest-117"><a id="_idTextAnchor146"/>Determining the optimal number of clusters</h1>
			<p>One popular<a id="_idIndexMarker394"/> method that is frequently adopted is <a id="_idIndexMarker395"/>the <strong class="bold">Elbow method</strong>. The idea of the Elbow method is to run K-means algorithms with different values of K – for example, from 1 cluster all the way to 10 – and for each value of K, calculate the sum of squared errors. Then, plot a chart of <a id="_idIndexMarker396"/>the <strong class="bold">sum of squared deviation</strong> (<strong class="bold">SSD</strong>) values. SSD is the sum of the squared difference and is used to measure variance. If the line chart looks like an arm, then the <em class="italic">elbow</em> on the arm is the value of K that is the best among the various K values. The method behind this approach is that SSD usually tends to decrease as the value of K is increased, and the goal of the evaluation method is also to aim for <a id="_idIndexMarker397"/>lower SSD or <strong class="bold">mean squared deviation</strong> (<strong class="bold">MSD</strong>) values. The elbow represents a starting point, where SSD starts to have diminishing returns when the K <span class="No-Break">value increases.</span></p>
			<p>In the following chart, you can see that the MSD value, when charted over different K values, represents an arm, and the <em class="italic">elbow</em> is at value <strong class="bold">6</strong>. After <strong class="bold">6</strong>, there is no significant decrease in the MSD value, so we can pick <em class="italic">6</em> as the best cluster value in the <span class="No-Break">following scenario:</span></p>
			<div>
				<div id="_idContainer139" class="IMG---Figure">
					<img src="image/B19071_08_02.jpg" alt="Figure 8.2 – MSD values when charted over different ﻿K values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – MSD values when charted over different K values</p>
			<p>Next, let’s see how we can create a K-means clustering model with Amazon <span class="No-Break">Redshift ML.</span></p>
			<h1 id="_idParaDest-118"><a id="_idTextAnchor147"/>Creating a K-means ML model</h1>
			<p>In this section, we <a id="_idIndexMarker398"/>will walk through the process with the help of a use case. In this use case, assume you are a data analyst for an e-commerce company specializing in home improvement goods. You have been tasked with classifying economic segments in different regions, based on income, so that you can better target customers, based on various factors, such as median home value. We will use this dataset from <a id="_idIndexMarker399"/><span class="No-Break">Kaggle: </span><a href="https://www.kaggle.com/datasets/camnugent/california-housing-prices"><span class="No-Break">https://www.kaggle.com/datasets/camnugent/california-housing-prices</span></a><span class="No-Break">.</span></p>
			<p>From this dataset, you will use the <strong class="source-inline">median_income</strong>, <strong class="source-inline">latitude</strong>, and <strong class="source-inline">longitude</strong> attributes so that you can create clusters based on <strong class="source-inline">location</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">income</strong></span><span class="No-Break">.</span></p>
			<p>The syntax to create a K-means model is slightly different from what you will have used up to this point, so let’s dive <span class="No-Break">into that.</span></p>
			<h2 id="_idParaDest-119"><a id="_idTextAnchor148"/>Creating a model syntax overview for K-means clustering</h2>
			<p>Here is <a id="_idIndexMarker400"/>the basic syntax to create a <span class="No-Break">K-means model:</span></p>
			<pre class="source-code">
CREATE model model_name
FROM (Select_statement)
FUNCTION  function_name
IAM_ROLE default
<strong class="bold">AUTO OFF</strong>
<strong class="bold">MODEL_TYPE KMEANS</strong>
<strong class="bold">PREPROCESSORS (StandardScaler', 'MinMax', 'NumericPassthrough')</strong>
<strong class="bold">HYPERPARAMETERS DEFAULT EXCEPT (K '2')</strong>
<strong class="bold">SETTINGS (S3_BUCKET 'bucket name');</strong></pre>
			<p>A couple of key things to note in the preceding code snippet are the lines in bold, as they are required when creating <span class="No-Break">K-means models:</span></p>
			<ul>
				<li><strong class="source-inline">AUTO OFF</strong>: This must be turned off, since Amazon SageMaker Autopilot is not used <span class="No-Break">for K-means</span></li>
				<li><strong class="source-inline">MODEL_TYPE</strong> <strong class="source-inline">KMEANS</strong>: You must set <strong class="source-inline">MODEL_TYPE</strong>, as there is no auto-discovery <span class="No-Break">for K-means</span></li>
				<li><strong class="source-inline">HYPERPARAMETERS DEFAULT EXCEPT (K '2')</strong>: This tells SageMaker how many clusters to create in <span class="No-Break">this model</span></li>
			</ul>
			<p>Also, note <a id="_idIndexMarker401"/>that there are three optional preprocessors available with K-means. We will explore that in more detail when we create <span class="No-Break">the model.</span></p>
			<p>You can refer to this link for more details on the<a id="_idIndexMarker402"/> K-means parameters <span class="No-Break">available: </span><a href="https://docs.aws.amazon.com/redshift/latest/dg/r_create_model_use_cases.html#r_k-means-create-model-parameters"><span class="No-Break">https://docs.aws.amazon.com/redshift/latest/dg/r_create_model_use_cases.html#r_k-means-create-model-parameters</span></a><span class="No-Break">.</span></p>
			<p>Now, we will load our dataset in preparation for creating <span class="No-Break">our model.</span></p>
			<h2 id="_idParaDest-120"><a id="_idTextAnchor149"/>Uploading and analyzing the data</h2>
			<p>For this use case, we <a id="_idIndexMarker403"/>will use a file that contains housing price information and summary stats, based on <span class="No-Break">census data.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Data is stored in the following <a id="_idIndexMarker404"/>S3 <span class="No-Break">location: </span><span class="No-Break"><strong class="source-inline">s3://packt-serverless-ml-redshift/chapter08/housinghousing_prices.csv</strong></span><span class="No-Break">.</span></p>
			<p>After successfully<a id="_idIndexMarker405"/> connecting to Redshift as an admin or database developer, load data into Amazon Redshift and follow the steps <span class="No-Break">outlined here.</span></p>
			<ol>
				<li>Navigate to Redshift <strong class="bold">query editor </strong><strong class="bold">v</strong><strong class="bold">2</strong>, connect to the <strong class="bold">Serverless: default</strong> endpoint, and then connect to the <span class="No-Break"><strong class="bold">dev</strong></span><span class="No-Break"> database.</span></li>
			</ol>
			<div>
				<div id="_idContainer140" class="IMG---Figure">
					<img src="image/B19071_08_03.jpg" alt="Figure 8.3 – Connecting via ﻿Redshift query editor v2"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – Connecting via Redshift query editor v2</p>
			<ol>
				<li value="2">Execute<a id="_idIndexMarker406"/> the <a id="_idIndexMarker407"/>following steps to create the schema and customer table and load <span class="No-Break">the data:</span><pre class="source-code">
create schema chapter8_kmeans_clustering;</pre><pre class="source-code">
create table chapter8_kmeans_clustering.housing_prices (</pre><pre class="source-code">
    longitude decimal(10,2),</pre><pre class="source-code">
    latitude decimal(10,2),</pre><pre class="source-code">
    housing_median_age integer,</pre><pre class="source-code">
    total_rooms integer,</pre><pre class="source-code">
    total_bedrooms integer,</pre><pre class="source-code">
    population integer,</pre><pre class="source-code">
    households integer,</pre><pre class="source-code">
    median_income decimal(10,6),</pre><pre class="source-code">
    median_house_value integer,</pre><pre class="source-code">
    ocean_proximity character varying (50)</pre><pre class="source-code">
)</pre><pre class="source-code">
diststyle auto;</pre><pre class="source-code">
copy chapter8_kmeans_clustering.housing_prices from 's3://packt-serverless-ml-redshift/chapter08/kmeans/housing_prices.csv'</pre><pre class="source-code">
iam_role default format as csv delimiter ',' quote '"' ignoreheader 1 region as 'eu-west-1';</pre></li>
			</ol>
			<p>This dataset contains 2,064,020,640 records. We will use <strong class="source-inline">longitude</strong>, <strong class="source-inline">latitude</strong>, and <strong class="source-inline">median_income</strong> in <span class="No-Break">our model.</span></p>
			<ol>
				<li value="3">Run <a id="_idIndexMarker408"/>the <a id="_idIndexMarker409"/>following query to examine some <span class="No-Break">sample data:</span><pre class="source-code">
select * from chapter8_kmeans_clustering.housing_prices</pre><pre class="source-code">
limit 10;</pre></li>
			</ol>
			<p>You should get the <span class="No-Break">following result:</span></p>
			<div>
				<div id="_idContainer141" class="IMG---Figure">
					<img src="image/B19071_08_04.jpg" alt="Figure 8.4 – Housing prices data"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4 – Housing prices data</p>
			<p>Now that the data is loaded, we are ready to create <span class="No-Break">the model.</span></p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor150"/>Creating the K-means model</h2>
			<p>Let’s create our<a id="_idIndexMarker410"/> model and cluster based on <strong class="source-inline">median_income</strong>, <strong class="source-inline">longitude</strong>, <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">latitude</strong></span><span class="No-Break">.</span></p>
			<p>We will create a few models and then use the elbow method to determine the optimal number <span class="No-Break">of clusters.</span></p>
			<p>To begin with, let’s create our first model with two clusters using the following SQL. You can then experiment <a id="_idIndexMarker411"/>by creating different models by changing the K value, and then you can learn how the MSD value diminishes over different <span class="No-Break">K values.</span></p>
			<h3>Creating two clusters with a K value of 2</h3>
			<p>Let’s run the <a id="_idIndexMarker412"/>following SQL in Query Editor v2 to create a model with <span class="No-Break">two clusters:</span></p>
			<pre class="source-code">
create model chapter8_kmeans_clustering.housing_segments_k2
from(select
            median_income,
            latitude,
            longitude
from chapter8_kmeans_clustering.housing_prices)
function  get_housing_segment_k2
iam_role default
auto off
model_type kmeans
preprocessors '[
      {
        "columnset": [ "median_income", "latitude","longitude" ],
        "transformers": [ "standardscaler" ]
      }
    ]'
hyperparameters default except (k '2')
settings (s3_bucket '&lt;your s3 bucket&gt;');</pre>
			<p>You can see in this model that we supply values for the <strong class="source-inline">preprocessors</strong> parameter. We chose to do this because K-means is sensitive to scale, so we can normalize with the <strong class="source-inline">standardscaler</strong> transformer. <strong class="source-inline">standardscalar</strong> moves the mean and scale to <span class="No-Break">unit variance.</span></p>
			<p>The <a id="_idIndexMarker413"/><strong class="source-inline">hyperparameters</strong> parameter is where we specify <strong class="source-inline">(K '2')</strong> to create two clusters. Remember to add your S3 bucket, where the created model artifacts are stored. You will find the model artifacts in <strong class="source-inline">s3: s3://&lt;your-s3-bucket&gt;/redshift-ml/housing_segments_k2/</strong>. Redshift ML will automatically append <strong class="source-inline">'redshift-ml'/'your model name'</strong> to your S3 bucket. Now, check the status of the model, using the <strong class="source-inline">SHOW MODEL</strong> command in Query <span class="No-Break">Editor v2:</span></p>
			<pre class="source-code">
SHOW MODEL chapter8_kmeans_clustering.housing_segments_k2;</pre>
			<p>You will see the <span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer142" class="IMG---Figure">
					<img src="image/B19071_08_05.jpg" alt="Fi﻿gure 8.5 – Two clusters"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Fi<a id="_idTextAnchor151"/>gure 8.5 – Two clusters</p>
			<p>The key things to note are <strong class="bold">Model State</strong>, which indicates that the model is ready, and <strong class="bold">train:msd</strong>, which is the objective metric. This represents the mean squared distances between each record in our input dataset and the closest center of the model. The <strong class="bold">MSD</strong> value is <strong class="bold">1.088200</strong>, wh<a id="_idTextAnchor152"/>ich is a <span class="No-Break">good score.</span></p>
			<p>Let’s <a id="_idIndexMarker414"/>run a query to get the number of data points in <span class="No-Break">each cluster:</span></p>
			<pre class="source-code">
  select chapter8_kmeans_clustering.get_housing_segment_k2 (median_income, latitude, longitude) as cluster, count(*) as count from FROM chapter8_kmeans_clustering.housing_prices group byGROUP BY 1 order byORDER BY 1;</pre>
			<p>Th<a id="_idTextAnchor153"/>e output is <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer143" class="IMG---Figure">
					<img src="image/B19071_08_06.jpg" alt="Figure 8.6 – The data points"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.6 – The data points</p>
			<p>Clusters are numbered from <strong class="source-inline">0</strong> to <strong class="source-inline">n</strong>. Our first cluster has <strong class="bold">8719</strong> data points, and the second cluster has <strong class="bold">11921</strong> <span class="No-Break">data points.</span></p>
			<p>In our use case, we want to further segment our customers. Let’s create a few more models with different numbers of clusters. We can then evaluate all the SSD values and apply the Elbow method to help us choose the optimal number of clusters to use for <span class="No-Break">our analysis.</span></p>
			<h3>Creating three clusters with a K value of 3</h3>
			<p>Let’s run <a id="_idIndexMarker415"/>the following SQL in Query Editor v2 to create a model with <span class="No-Break">three clusters:</span></p>
			<pre class="source-code">
CREATE model chapter8_kmeans_clustering.housing_segments_k3
FROM(Select
            median_income,
            latitude,
            longitude
From chapter8_kmeans_clustering.housing_prices)
FUNCTION  get_housing_segment_k3
IAM_ROLE default
AUTO OFF
MODEL_TYPE KMEANS
PREPROCESSORS '[
      {
        "ColumnSet": [ "median_income", "latitude","longitude" ],
        "Transformers": [ "StandardScaler" ]
      }
    ]'
HYPERPARAMETERS DEFAULT EXCEPT (K '3')
SETTINGS (S3_BUCKET '&lt;your s3 bucket&gt;');</pre>
			<h3>Creating the remaining models with clusters 4, 5, and 6</h3>
			<p>Repeat the <a id="_idIndexMarker416"/>preceding code 3 more <a id="_idIndexMarker417"/>times to create models <a id="_idIndexMarker418"/>with 4, 5, and 6 clusters, respectively. You will find the code <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Serverless-Machine-Learning-with-Amazon-Redshift/blob/main/CodeFiles/chapter8/chapter8.sql"><span class="No-Break">https://github.com/PacktPublishing/Serverless-Machine-Learning-with-Amazon-Redshift/blob/main/CodeFiles/chapter8/chapter8.sql</span></a><span class="No-Break">.</span></p>
			<p>It will take ~15 minutes for all the models to finish training. Then, run the <strong class="source-inline">SHOW MODEL</strong> command, including the one for the model where <strong class="source-inline">K = 2</strong>, as <span class="No-Break">shown here:</span></p>
			<pre class="source-code">
SHOW MODEL chapter8_kmeans_clustering.housing_segments_k2;
SHOW MODEL chapter8_kmeans_clustering.housing_segments_k3;
SHOW MODEL chapter8_kmeans_clustering.housing_segments_k4;
SHOW MODEL chapter8_kmeans_clustering.housing_segments_k5;
SHOW MODEL chapter8_kmeans_clustering.housing_segments_k6;</pre>
			<p>Now, let’s find <span class="No-Break">the elbow!</span></p>
			<h3>Gathering inputs to chart the elbow</h3>
			<p>Now, from<a id="_idIndexMarker419"/> the output of each <strong class="source-inline">SHOW MODEL</strong> command, note the value for <strong class="source-inline">test:msd</strong> and build a <strong class="source-inline">Select</strong> statement, as shown in the following code snippet. Change the value for MSD using the <strong class="source-inline">test:mds</strong> value for <span class="No-Break">each model.</span></p>
			<p>As an example, we will use the value <strong class="source-inline">1.088200,</strong> which we saw earlier for <strong class="source-inline">train:msd</strong>, for the model with <span class="No-Break">two clusters.</span></p>
			<p>Our other output from <strong class="source-inline">train:mds</strong> from the <strong class="source-inline">SHOW MODEL</strong> output is <span class="No-Break">as follows:</span></p>
			<ul>
				<li>Two clusters: <strong class="source-inline">train:msd</strong> – <span class="No-Break"><strong class="source-inline">1.088200</strong></span></li>
				<li>Three clusters: <strong class="source-inline">train:msd</strong> – <span class="No-Break"><strong class="source-inline">0.775993</strong></span></li>
				<li>Four clusters: <strong class="source-inline">train:msd</strong> – <span class="No-Break"><strong class="source-inline">0.532355</strong></span></li>
				<li>Five clusters: <strong class="source-inline">train:msd</strong> – <span class="No-Break"><strong class="source-inline">0.437294</strong></span></li>
				<li>Six clusters: <strong class="source-inline">train:msd</strong> – <span class="No-Break"><strong class="source-inline">0.373781</strong></span></li>
			</ul>
			<p>Note that your numbers may be <span class="No-Break">slightly different:</span></p>
			<pre class="source-code">
Select 2 as K, 1.088200  as MSD
Union
Select 3 as K,  0.775993 as MSD
Union
Select 4 as K,  0.532355 as MSD
Union
Select 5 as K,  0.437294 as MSD
Union
Select 6 as K,  0.373781 as MSD;</pre>
			<p>Run the <a id="_idIndexMarker420"/>preceding SQL command in Query <span class="No-Break">Editor v2.</span></p>
			<p>By observing the output, we can see that the MSD value is highest for two clusters and gradually decreases as the number of <span class="No-Break">clusters increases:</span></p>
			<div>
				<div id="_idContainer144" class="IMG---Figure">
					<img src="image/B19071_08_07.jpg" alt="Figure 8.7 – msd"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.7 – msd</p>
			<p>In the <strong class="bold">Result</strong> window, click on the <strong class="bold">Chart</strong> option, as <span class="No-Break">shown here:</span></p>
			<div>
				<div id="_idContainer145" class="IMG---Figure">
					<img src="image/B19071_08_08.jpg" alt="Figure 8.8 – Creating a chart"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.8 – Creating a chart</p>
			<p>By choosing <strong class="source-inline">k</strong> as the <strong class="source-inline">X</strong> value and <strong class="source-inline">msd</strong> as the <strong class="source-inline">Y</strong> value, you will get the <span class="No-Break">following output:</span></p>
			<div>
				<div id="_idContainer146" class="IMG---Figure">
					<img src="image/B19071_08_09.jpg" alt="Figure 8.9 – The elbow method chart"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.9 – The elbow method chart</p>
			<p>From the<a id="_idIndexMarker421"/> chart, we can see that when MSD is charted over a line graph, an arm is formed, and the elbow is at <strong class="bold">3</strong>. This means that there is little difference in the MSD value with <strong class="bold">4</strong> clusters compared to <strong class="bold">3</strong> clusters . We can see that after <strong class="bold">3</strong>, the curve is very smooth, and the difference between the MSD value does not drastically change compared to the beginning of <span class="No-Break">the line.</span></p>
			<p>Let’s see how data points are clustered when we use a function deployed for our model with <span class="No-Break">three clusters:</span></p>
			<pre class="source-code">
select chapter8_kmeans_clustering.get_housing_segment_k3 (median_income, latitude, longitude) as cluster, count(*) as count from chapter8_kmeans_clustering.housing_prices group by 1 order by 1;</pre>
			<p>We can see the following output from Query Editor v2. The counts represent the number of data points assigned to <span class="No-Break">each cluster:</span></p>
			<div>
				<div id="_idContainer147" class="IMG---Figure">
					<img src="image/B19071_08_10.jpg" alt="Figure 8.10 – Three clusters"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.10 – Three clusters</p>
			<p>We can also<a id="_idIndexMarker422"/> chart this by clicking on the <strong class="bold">Chart</strong> button and observing the cluster counts <span class="No-Break">represented visually:</span></p>
			<div>
				<div id="_idContainer148" class="IMG---Figure">
					<img src="image/B19071_08_11.jpg" alt="Figure 8.11 – The cluster data points"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.11 – The cluster data points</p>
			<p>Now, let’s see how we can use our model to help make business decisions based on <span class="No-Break">the clusters.</span></p>
			<h1 id="_idParaDest-122"><a id="_idTextAnchor154"/>Evaluating the results of the K-means clustering</h1>
			<p>Now that<a id="_idIndexMarker423"/> you have segmented your clusters with the K-means algorithm, you are ready to perform various analyses using the model <span class="No-Break">you created.</span></p>
			<p>Here is an example query you can run to get the average median house value <span class="No-Break">by cluster:</span></p>
			<pre class="source-code">
select avg(median_house_value) as avg_median_house_value,
chapter8_kmeans_clustering
.get_housing_segment_k3(median_income, latitude, longitude) as cluster
from chapter8_kmeans_clustering
.housing_prices
group by 2
order by 1;</pre>
			<p>The output will look <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer149" class="IMG---Figure">
					<img src="image/B19071_08_12.jpg" alt="Figure 8.12 – Average median house values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.12 – Average median house values</p>
			<p>You can also run a query to see whether higher median incomes correspond to the same clusters with higher home values. Run the <span class="No-Break">following query:</span></p>
			<pre class="source-code">
select avg(median_income) as median_income,
chapter8_kmeans_clustering.get_housing_segment_k3(
    median_income, latitude, longitude) as cluster
from chapter8_kmeans_clustering.housing_prices
group by 2
order by 1;</pre>
			<p>The output <a id="_idIndexMarker424"/>will look <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer150" class="IMG---Figure">
					<img src="image/B19071_08_13.jpg" alt="Figure 8.13 – median_income"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.13 – median_income</p>
			<p>When we established our use case, we said this was for an e-commerce retailer specializing in home improvement products. Another way you could use this information is to create different marketing campaigns and tailor your product offerings, based on home values in a <span class="No-Break">given cluster.</span></p>
			<h1 id="_idParaDest-123"><a id="_idTextAnchor155"/>Summary</h1>
			<p>In this chapter, we discussed how to do unsupervised learning with the <span class="No-Break">K-means algorithm.</span></p>
			<p>You are now able to explain what the K-means algorithm is and what use cases it is appropriate for. Also, you can use Amazon Redshift ML to create a K-means model, determine the appropriate number of clusters, and draw conclusions by analyzing the clusters to help make <span class="No-Break">business decisions.</span></p>
			<p>In the next chapter, we will show you how to use the multi-layer perceptron algorithm to perform deep learning with Amazon <span class="No-Break">Redshift ML.</span></p>
		</div>
	

		<div id="_idContainer152" class="Content">
			<h1 id="_idParaDest-124" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor156"/>Part 3:<span xml:lang="en-GB">Deploying Models</span> with Redshift ML</h1>
			<p><em class="italic">Part 3</em> introduces you to more ways to leverage Amazon Redshift ML. You will learn about deep learning algorithms, how to train a customized model, and how you can use models trained outside of Amazon Redshift to run inference queries in your <span class="No-Break">data warehouse.</span></p>
			<p>This part closes with an introduction to time-series forecasting, how to use it with Amazon Redshift ML, and how you can optimize and easily re-train <span class="No-Break">your models.</span></p>
			<p>This part comprises the <span class="No-Break">following chapters:</span></p>
			<ul>
				<li><a href="B19071_09.xhtml#_idTextAnchor157"><em class="italic">Chapter 9</em></a>, <em class="italic">Deep Learning with Redshift ML</em></li>
				<li><a href="B19071_10.xhtml#_idTextAnchor178"><em class="italic">Chapter 10</em></a>, <em class="italic">Creating Custom ML Models with XGBoost</em></li>
				<li><a href="B19071_11.xhtml#_idTextAnchor192"><em class="italic">Chapter 11</em></a>, <em class="italic">Bring Your Own Models for In-Database Inference</em></li>
				<li><a href="B19071_12.xhtml#_idTextAnchor217"><em class="italic">Chapter 12</em></a>, <em class="italic">Time-Series Forecasting in Your Data Warehouse</em></li>
				<li><a href="B19071_13.xhtml#_idTextAnchor233"><em class="italic">Chapter 13</em></a>, <em class="italic">Operationalizing and Optimizing Amazon Redshift ML Models</em></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer153">
			</div>
		</div>
		<div>
			<div id="_idContainer154">
			</div>
		</div>
		<div>
			<div id="_idContainer155">
			</div>
		</div>
		<div>
			<div id="_idContainer156">
			</div>
		</div>
		<div>
			<div id="_idContainer157">
			</div>
		</div>
		<div>
			<div id="_idContainer158" class="Basic-Graphics-Frame">
			</div>
		</div>
		<div>
			<div id="_idContainer159">
			</div>
		</div>
		<div>
			<div id="_idContainer160">
			</div>
		</div>
	</body></html>
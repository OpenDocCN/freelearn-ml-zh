<html><head></head><body>
<div id="_idContainer042">
<h1 class="chapter-number" id="_idParaDest-58"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.1.1" xmlns:="http://www.w3.org/1999/xhtml">2</span></h1>
<h1 id="_idParaDest-59"><a id="_idTextAnchor183"/><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.2.1" xmlns:="http://www.w3.org/1999/xhtml">Encoding Categorical Variables</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.3.1" xmlns:="http://www.w3.org/1999/xhtml">Categorical variables</span></strong><span class="koboSpan" id="kobo.4.1" xmlns:="http://www.w3.org/1999/xhtml"> are those </span><a id="_idIndexMarker107"/><span class="koboSpan" id="kobo.5.1" xmlns:="http://www.w3.org/1999/xhtml">whose values are selected from a group of categories or labels. </span><span class="koboSpan" id="kobo.5.2" xmlns:="http://www.w3.org/1999/xhtml">For example, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.6.1" xmlns:="http://www.w3.org/1999/xhtml">Home owner</span></strong><span class="koboSpan" id="kobo.7.1" xmlns:="http://www.w3.org/1999/xhtml"> variable with the values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.8.1" xmlns:="http://www.w3.org/1999/xhtml">owner</span></strong><span class="koboSpan" id="kobo.9.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.10.1" xmlns:="http://www.w3.org/1999/xhtml">non-owner</span></strong><span class="koboSpan" id="kobo.11.1" xmlns:="http://www.w3.org/1999/xhtml"> is categorical, and so is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.12.1" xmlns:="http://www.w3.org/1999/xhtml">Marital status</span></strong><span class="koboSpan" id="kobo.13.1" xmlns:="http://www.w3.org/1999/xhtml"> variable with the values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.14.1" xmlns:="http://www.w3.org/1999/xhtml">never married</span></strong><span class="koboSpan" id="kobo.15.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.16.1" xmlns:="http://www.w3.org/1999/xhtml">married</span></strong><span class="koboSpan" id="kobo.17.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.18.1" xmlns:="http://www.w3.org/1999/xhtml">divorced</span></strong><span class="koboSpan" id="kobo.19.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.20.1" xmlns:="http://www.w3.org/1999/xhtml">widowed</span></strong><span class="koboSpan" id="kobo.21.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.21.2" xmlns:="http://www.w3.org/1999/xhtml">In some categorical variables, the labels have an intrinsic order; for example, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.22.1" xmlns:="http://www.w3.org/1999/xhtml">Student's grade</span></strong><span class="koboSpan" id="kobo.23.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, the values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.24.1" xmlns:="http://www.w3.org/1999/xhtml">A</span></strong><span class="koboSpan" id="kobo.25.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.26.1" xmlns:="http://www.w3.org/1999/xhtml">B</span></strong><span class="koboSpan" id="kobo.27.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.28.1" xmlns:="http://www.w3.org/1999/xhtml">C</span></strong><span class="koboSpan" id="kobo.29.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.30.1" xmlns:="http://www.w3.org/1999/xhtml">Fail</span></strong><span class="koboSpan" id="kobo.31.1" xmlns:="http://www.w3.org/1999/xhtml"> are ordered, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.32.1" xmlns:="http://www.w3.org/1999/xhtml">A</span></strong><span class="koboSpan" id="kobo.33.1" xmlns:="http://www.w3.org/1999/xhtml"> being the highest grade and </span><strong class="source-inline"><span class="koboSpan" id="kobo.34.1" xmlns:="http://www.w3.org/1999/xhtml">Fail</span></strong><span class="koboSpan" id="kobo.35.1" xmlns:="http://www.w3.org/1999/xhtml"> being the lowest. </span><span class="koboSpan" id="kobo.35.2" xmlns:="http://www.w3.org/1999/xhtml">These </span><a id="_idIndexMarker108"/><span class="koboSpan" id="kobo.36.1" xmlns:="http://www.w3.org/1999/xhtml">are called </span><strong class="bold"><span class="koboSpan" id="kobo.37.1" xmlns:="http://www.w3.org/1999/xhtml">ordinal categorical variables</span></strong><span class="koboSpan" id="kobo.38.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.38.2" xmlns:="http://www.w3.org/1999/xhtml">Variables in </span><a id="_idIndexMarker109"/><span class="koboSpan" id="kobo.39.1" xmlns:="http://www.w3.org/1999/xhtml">which the categories do not have an intrinsic order </span><a id="_idIndexMarker110"/><span class="koboSpan" id="kobo.40.1" xmlns:="http://www.w3.org/1999/xhtml">are called </span><strong class="bold"><span class="koboSpan" id="kobo.41.1" xmlns:="http://www.w3.org/1999/xhtml">nominal categorical variables</span></strong><span class="koboSpan" id="kobo.42.1" xmlns:="http://www.w3.org/1999/xhtml">, such</span><a id="_idIndexMarker111"/><span class="koboSpan" id="kobo.43.1" xmlns:="http://www.w3.org/1999/xhtml"> as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.44.1" xmlns:="http://www.w3.org/1999/xhtml">City</span></strong><span class="koboSpan" id="kobo.45.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, with the values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.46.1" xmlns:="http://www.w3.org/1999/xhtml">London</span></strong><span class="koboSpan" id="kobo.47.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1" xmlns:="http://www.w3.org/1999/xhtml">Manchester</span></strong><span class="koboSpan" id="kobo.49.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.50.1" xmlns:="http://www.w3.org/1999/xhtml">Bristol</span></strong><span class="koboSpan" id="kobo.51.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1" xmlns:="http://www.w3.org/1999/xhtml">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.53.1" xmlns:="http://www.w3.org/1999/xhtml">The values of categorical variables are often encoded as strings. </span><span class="koboSpan" id="kobo.53.2" xmlns:="http://www.w3.org/1999/xhtml">To train most machine learning models, we need to transform those strings into numbers. </span><span class="koboSpan" id="kobo.53.3" xmlns:="http://www.w3.org/1999/xhtml">The act of replacing strings </span><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.54.1" xmlns:="http://www.w3.org/1999/xhtml">with numbers is </span><a id="_idIndexMarker112"/><span class="koboSpan" id="kobo.55.1" xmlns:="http://www.w3.org/1999/xhtml">called </span><strong class="bold"><span class="koboSpan" id="kobo.56.1" xmlns:="http://www.w3.org/1999/xhtml">categorical encoding</span></strong><span class="koboSpan" id="kobo.57.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.57.2" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will discuss multiple categorical </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1" xmlns:="http://www.w3.org/1999/xhtml">encoding methods.</span></span></p>
<p><span class="koboSpan" id="kobo.59.1" xmlns:="http://www.w3.org/1999/xhtml">This chapter will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1" xmlns:="http://www.w3.org/1999/xhtml">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.61.1" xmlns:="http://www.w3.org/1999/xhtml">Creating binary variables through </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1" xmlns:="http://www.w3.org/1999/xhtml">one-hot encoding</span></span></li>
<li><span class="koboSpan" id="kobo.63.1" xmlns:="http://www.w3.org/1999/xhtml">Performing one-hot encoding of </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1" xmlns:="http://www.w3.org/1999/xhtml">frequent categories</span></span></li>
<li><span class="koboSpan" id="kobo.65.1" xmlns:="http://www.w3.org/1999/xhtml">Replacing categories with counts or the frequency </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1" xmlns:="http://www.w3.org/1999/xhtml">of observations</span></span></li>
<li><span class="koboSpan" id="kobo.67.1" xmlns:="http://www.w3.org/1999/xhtml">Replacing categories with </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1" xmlns:="http://www.w3.org/1999/xhtml">ordinal numbers</span></span></li>
<li><span class="koboSpan" id="kobo.69.1" xmlns:="http://www.w3.org/1999/xhtml">Performing ordinal encoding based on the </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1" xmlns:="http://www.w3.org/1999/xhtml">target value</span></span></li>
<li><span class="koboSpan" id="kobo.71.1" xmlns:="http://www.w3.org/1999/xhtml">Implementing target </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1" xmlns:="http://www.w3.org/1999/xhtml">mean encoding</span></span></li>
<li><span class="koboSpan" id="kobo.73.1" xmlns:="http://www.w3.org/1999/xhtml">Encoding with the Weight </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1" xmlns:="http://www.w3.org/1999/xhtml">of Evidence</span></span></li>
<li><span class="koboSpan" id="kobo.75.1" xmlns:="http://www.w3.org/1999/xhtml">Grouping rare or </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1" xmlns:="http://www.w3.org/1999/xhtml">infrequent categories</span></span></li>
<li><span class="koboSpan" id="kobo.77.1" xmlns:="http://www.w3.org/1999/xhtml">Performing </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1" xmlns:="http://www.w3.org/1999/xhtml">binary en</span><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.79.1" xmlns:="http://www.w3.org/1999/xhtml">c</span><a id="_idTextAnchor187"/><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.80.1" xmlns:="http://www.w3.org/1999/xhtml">oding</span></span></li>
</ul>
<h1 id="_idParaDest-60"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.81.1" xmlns:="http://www.w3.org/1999/xhtml">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.82.1" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1" xmlns:="http://www.w3.org/1999/xhtml">Matplotlib</span></strong><span class="koboSpan" id="kobo.84.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.85.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.86.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1" xmlns:="http://www.w3.org/1999/xhtml">NumPy</span></strong><span class="koboSpan" id="kobo.88.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.89.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.90.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.92.1" xmlns:="http://www.w3.org/1999/xhtml">, and Category Encoders Python libraries. </span><span class="koboSpan" id="kobo.92.2" xmlns:="http://www.w3.org/1999/xhtml">If you need to install Python, the free Anaconda Python distribution (</span><a href="https://www.anaconda.com/"><span class="koboSpan" id="kobo.93.1" xmlns:="http://www.w3.org/1999/xhtml">https://www.anaconda.com/</span></a><span class="koboSpan" id="kobo.94.1" xmlns:="http://www.w3.org/1999/xhtml">) includes most numerical </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1" xmlns:="http://www.w3.org/1999/xhtml">computing libraries.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.96.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.97.1" xmlns:="http://www.w3.org/1999/xhtml"> can be installed </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.99.1" xmlns:="http://www.w3.org/1999/xhtml">pip</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.100.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.101.1" xmlns:="http://www.w3.org/1999/xhtml">
pip install feature-engine</span></pre> <p><span class="koboSpan" id="kobo.102.1" xmlns:="http://www.w3.org/1999/xhtml">If you use Anaconda, you can install </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.104.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.105.1" xmlns:="http://www.w3.org/1999/xhtml">conda</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.106.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.107.1" xmlns:="http://www.w3.org/1999/xhtml">
conda install -c conda-forge feature_engine</span></pre> <p><span class="koboSpan" id="kobo.108.1" xmlns:="http://www.w3.org/1999/xhtml">To install Category Encoders, use </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1" xmlns:="http://www.w3.org/1999/xhtml">pip</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.110.1" xmlns:="http://www.w3.org/1999/xhtml">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.111.1" xmlns:="http://www.w3.org/1999/xhtml">
pip install category_encoders</span></pre> <p><span class="koboSpan" id="kobo.112.1" xmlns:="http://www.w3.org/1999/xhtml">We will use the </span><strong class="bold"><span class="koboSpan" id="kobo.113.1" xmlns:="http://www.w3.org/1999/xhtml">Credit Approval</span></strong><span class="koboSpan" id="kobo.114.1" xmlns:="http://www.w3.org/1999/xhtml"> dataset from the </span><em class="italic"><span class="koboSpan" id="kobo.115.1" xmlns:="http://www.w3.org/1999/xhtml">UCI Machine Learning Repository</span></em><span class="koboSpan" id="kobo.116.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span><a href="https://archive.ics.uci.edu/"><span class="koboSpan" id="kobo.117.1" xmlns:="http://www.w3.org/1999/xhtml">https://archive.ics.uci.edu/</span></a><span class="koboSpan" id="kobo.118.1" xmlns:="http://www.w3.org/1999/xhtml">), licensed under the CC BY 4.0 creative commons attribution: </span><a href="https://creativecommons.org/licenses/by/4.0/legalcode"><span class="koboSpan" id="kobo.119.1" xmlns:="http://www.w3.org/1999/xhtml">https://creativecommons.org/licenses/by/4.0/legalcode</span></a><span class="koboSpan" id="kobo.120.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.120.2" xmlns:="http://www.w3.org/1999/xhtml">You’ll find the dataset at this </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1" xmlns:="http://www.w3.org/1999/xhtml">link: </span></span><a href="http://archive.ics.uci.edu/dataset/27/credit+approval"><span class="No-Break"><span class="koboSpan" id="kobo.122.1" xmlns:="http://www.w3.org/1999/xhtml">http://archive.ics.uci.edu/dataset/27/credit+approval</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.123.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.124.1" xmlns:="http://www.w3.org/1999/xhtml">I downloaded and modified the data as shown in this </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1" xmlns:="http://www.w3.org/1999/xhtml">notebook: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/credit-approval-dataset.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.126.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/credit-approval-dataset.ipynb</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.127.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.128.1" xmlns:="http://www.w3.org/1999/xhtml">You’ll find a copy of the modified data set in the accompanying GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/"><span class="No-Break"><span class="koboSpan" id="kobo.130.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.131.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.132.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.133.1" xmlns:="http://www.w3.org/1999/xhtml">Before encoding categorical variables, you might want to impute their missing data. </span><span class="koboSpan" id="kobo.133.2" xmlns:="http://www.w3.org/1999/xhtml">Check out the imputation methods for categorical variables in </span><a href="B22396_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.134.1" xmlns:="http://www.w3.org/1999/xhtml">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.135.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><em class="italic"><span class="koboSpan" id="kobo.136.1" xmlns:="http://www.w3.org/1999/xhtml">Imputing </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.137.1" xmlns:="http://www.w3.org/1999/xhtml">Missing </span><a id="_idTextAnchor190"/><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.138.1" xmlns:="http://www.w3.org/1999/xhtml">Data</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.139.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-61"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.140.1" xmlns:="http://www.w3.org/1999/xhtml">Creating binary variables through one-hot encoding</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.141.1" xmlns:="http://www.w3.org/1999/xhtml">One-hot encoding</span></strong><span class="koboSpan" id="kobo.142.1" xmlns:="http://www.w3.org/1999/xhtml"> is a </span><a id="_idIndexMarker113"/><span class="koboSpan" id="kobo.143.1" xmlns:="http://www.w3.org/1999/xhtml">method used to represent categorical data, where each category is represented by a binary variable. </span><span class="koboSpan" id="kobo.143.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.144.1" xmlns:="http://www.w3.org/1999/xhtml">binary variable</span><a id="_idIndexMarker114"/><span class="koboSpan" id="kobo.145.1" xmlns:="http://www.w3.org/1999/xhtml"> takes a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.147.1" xmlns:="http://www.w3.org/1999/xhtml"> if the category is present, or </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.148.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.149.1" xmlns:="http://www.w3.org/1999/xhtml"> otherwise.</span></span></p>
<p><span class="koboSpan" id="kobo.150.1" xmlns:="http://www.w3.org/1999/xhtml">The following</span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.151.1" xmlns:="http://www.w3.org/1999/xhtml"> table shows the one-hot encoded representation of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1" xmlns:="http://www.w3.org/1999/xhtml">Smoker</span></strong><span class="koboSpan" id="kobo.153.1" xmlns:="http://www.w3.org/1999/xhtml"> variable with the categories of </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1" xmlns:="http://www.w3.org/1999/xhtml">Smoker</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.155.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.156.1" xmlns:="http://www.w3.org/1999/xhtml">Non-Smoker</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.157.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.158.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.1 – One-hot encoded representation of the Smoker variable" src="image/B22396_02_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.159.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.1 – One-hot encoded representation of the Smoker variable</span></p>
<p><span class="koboSpan" id="kobo.160.1" xmlns:="http://www.w3.org/1999/xhtml">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.161.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.162.1" xmlns:="http://www.w3.org/1999/xhtml">.1</span></em><span class="koboSpan" id="kobo.163.1" xmlns:="http://www.w3.org/1999/xhtml">, from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1" xmlns:="http://www.w3.org/1999/xhtml">Smoker</span></strong><span class="koboSpan" id="kobo.165.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, we can derive a binary variable for </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1" xmlns:="http://www.w3.org/1999/xhtml">Smoker</span><a id="_idTextAnchor194"/></strong><span class="koboSpan" id="kobo.167.1" xmlns:="http://www.w3.org/1999/xhtml">, which shows the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.169.1" xmlns:="http://www.w3.org/1999/xhtml"> for smokers,</span><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.170.1" xmlns:="http://www.w3.org/1999/xhtml"> or the binary variable for </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1" xmlns:="http://www.w3.org/1999/xhtml">Non-Smoker</span></strong><span class="koboSpan" id="kobo.172.1" xmlns:="http://www.w3.org/1999/xhtml">, which takes the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.174.1" xmlns:="http://www.w3.org/1999/xhtml"> for those who do </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1" xmlns:="http://www.w3.org/1999/xhtml">not smoke.</span></span></p>
<p><span class="koboSpan" id="kobo.176.1" xmlns:="http://www.w3.org/1999/xhtml">For the </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1" xmlns:="http://www.w3.org/1999/xhtml">Color</span></strong><span class="koboSpan" id="kobo.178.1" xmlns:="http://www.w3.org/1999/xhtml"> categorical variable with the values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1" xmlns:="http://www.w3.org/1999/xhtml">red</span></strong><span class="koboSpan" id="kobo.180.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.182.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1" xmlns:="http://www.w3.org/1999/xhtml">green</span></strong><span class="koboSpan" id="kobo.184.1" xmlns:="http://www.w3.org/1999/xhtml">, we can create three variables called </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1" xmlns:="http://www.w3.org/1999/xhtml">red</span></strong><span class="koboSpan" id="kobo.186.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.187.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.188.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1" xmlns:="http://www.w3.org/1999/xhtml">green</span></strong><span class="koboSpan" id="kobo.190.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.190.2" xmlns:="http://www.w3.org/1999/xhtml">These variables will be assigned a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.192.1" xmlns:="http://www.w3.org/1999/xhtml"> if the observation corresponds to the respective color, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.194.1" xmlns:="http://www.w3.org/1999/xhtml"> if it </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1" xmlns:="http://www.w3.org/1999/xhtml">does not.</span></span></p>
<p><span class="koboSpan" id="kobo.196.1" xmlns:="http://www.w3.org/1999/xhtml">A categorical variable with </span><em class="italic"><span class="koboSpan" id="kobo.197.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.198.1" xmlns:="http://www.w3.org/1999/xhtml"> unique categories can be encoded using </span><em class="italic"><span class="koboSpan" id="kobo.199.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em><span class="koboSpan" id="kobo.200.1" xmlns:="http://www.w3.org/1999/xhtml"> binary variables. </span><span class="koboSpan" id="kobo.200.2" xmlns:="http://www.w3.org/1999/xhtml">For </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1" xmlns:="http://www.w3.org/1999/xhtml">Smoker</span></strong><span class="koboSpan" id="kobo.202.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><em class="italic"><span class="koboSpan" id="kobo.203.1" xmlns:="http://www.w3.org/1999/xhtml">k </span></em><span class="koboSpan" id="kobo.204.1" xmlns:="http://www.w3.org/1999/xhtml">is </span><em class="italic"><span class="koboSpan" id="kobo.205.1" xmlns:="http://www.w3.org/1999/xhtml">2</span></em><span class="koboSpan" id="kobo.206.1" xmlns:="http://www.w3.org/1999/xhtml"> as it contains two labels (</span><strong class="source-inline"><span class="koboSpan" id="kobo.207.1" xmlns:="http://www.w3.org/1999/xhtml">Smoker</span></strong><span class="koboSpan" id="kobo.208.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.209.1" xmlns:="http://www.w3.org/1999/xhtml">Non-Smoker</span></strong><span class="koboSpan" id="kobo.210.1" xmlns:="http://www.w3.org/1999/xhtml">), so we only need one binary variable (</span><em class="italic"><span class="koboSpan" id="kobo.211.1" xmlns:="http://www.w3.org/1999/xhtml">k - 1 = 1</span></em><span class="koboSpan" id="kobo.212.1" xmlns:="http://www.w3.org/1999/xhtml">) to capture all the information. </span><span class="koboSpan" id="kobo.212.2" xmlns:="http://www.w3.org/1999/xhtml">For the </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1" xmlns:="http://www.w3.org/1999/xhtml">Color</span></strong><span class="koboSpan" id="kobo.214.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, which has 3 categories (</span><em class="italic"><span class="koboSpan" id="kobo.215.1" xmlns:="http://www.w3.org/1999/xhtml">k = 3</span></em><span class="koboSpan" id="kobo.216.1" xmlns:="http://www.w3.org/1999/xhtml">; </span><strong class="source-inline"><span class="koboSpan" id="kobo.217.1" xmlns:="http://www.w3.org/1999/xhtml">red</span></strong><span class="koboSpan" id="kobo.218.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.220.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1" xmlns:="http://www.w3.org/1999/xhtml">green</span></strong><span class="koboSpan" id="kobo.222.1" xmlns:="http://www.w3.org/1999/xhtml">), we need 2 (</span><em class="italic"><span class="koboSpan" id="kobo.223.1" xmlns:="http://www.w3.org/1999/xhtml">k - 1 = 2</span></em><span class="koboSpan" id="kobo.224.1" xmlns:="http://www.w3.org/1999/xhtml">) binary </span><a id="_idIndexMarker116"/><span class="koboSpan" id="kobo.225.1" xmlns:="http://www.w3.org/1999/xhtml">variables to capture all the information so that the </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1" xmlns:="http://www.w3.org/1999/xhtml">following occurs:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.227.1" xmlns:="http://www.w3.org/1999/xhtml">If the observation is red, it will be captured by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1" xmlns:="http://www.w3.org/1999/xhtml">red</span></strong><span class="koboSpan" id="kobo.229.1" xmlns:="http://www.w3.org/1999/xhtml"> variable (</span><strong class="source-inline"><span class="koboSpan" id="kobo.230.1" xmlns:="http://www.w3.org/1999/xhtml">red</span></strong><span class="koboSpan" id="kobo.231.1" xmlns:="http://www.w3.org/1999/xhtml"> = </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.233.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.235.1" xmlns:="http://www.w3.org/1999/xhtml"> = </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.236.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.237.1" xmlns:="http://www.w3.org/1999/xhtml">)</span></span></li>
<li><span class="koboSpan" id="kobo.238.1" xmlns:="http://www.w3.org/1999/xhtml">If the observation is blue, it will be captured by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.240.1" xmlns:="http://www.w3.org/1999/xhtml"> variable (</span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1" xmlns:="http://www.w3.org/1999/xhtml">red</span></strong><span class="koboSpan" id="kobo.242.1" xmlns:="http://www.w3.org/1999/xhtml"> = </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.244.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.246.1" xmlns:="http://www.w3.org/1999/xhtml"> = </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.247.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.248.1" xmlns:="http://www.w3.org/1999/xhtml">)</span></span></li>
<li><span class="koboSpan" id="kobo.249.1" xmlns:="http://www.w3.org/1999/xhtml">If the observation is green, it will be captured by the combination of </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1" xmlns:="http://www.w3.org/1999/xhtml">red</span></strong><span class="koboSpan" id="kobo.251.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.253.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1" xmlns:="http://www.w3.org/1999/xhtml">red</span></strong><span class="koboSpan" id="kobo.255.1" xmlns:="http://www.w3.org/1999/xhtml"> = </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.257.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.259.1" xmlns:="http://www.w3.org/1999/xhtml"> = </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.260.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.261.1" xmlns:="http://www.w3.org/1999/xhtml">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.262.1" xmlns:="http://www.w3.org/1999/xhtml">Encoding</span><a id="_idIndexMarker117"/><span class="koboSpan" id="kobo.263.1" xmlns:="http://www.w3.org/1999/xhtml"> into </span><em class="italic"><span class="koboSpan" id="kobo.264.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em><span class="koboSpan" id="kobo.265.1" xmlns:="http://www.w3.org/1999/xhtml"> binary variables is well suited for linear models. </span><span class="koboSpan" id="kobo.265.2" xmlns:="http://www.w3.org/1999/xhtml">There are a few occasions in which we may prefer to encode the categorical variables with </span><em class="italic"><span class="koboSpan" id="kobo.266.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.267.1" xmlns:="http://www.w3.org/1999/xhtml">binary variables:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.268.1" xmlns:="http://www.w3.org/1999/xhtml">When training decision trees, since they do not evaluate the entire feature space at the </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1" xmlns:="http://www.w3.org/1999/xhtml">same time</span></span></li>
<li><span class="koboSpan" id="kobo.270.1" xmlns:="http://www.w3.org/1999/xhtml">When selecting </span><span class="No-Break"><span class="koboSpan" id="kobo.271.1" xmlns:="http://www.w3.org/1999/xhtml">features recursively</span></span></li>
<li><span class="koboSpan" id="kobo.272.1" xmlns:="http://www.w3.org/1999/xhtml">When determining the importance of each category within </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1" xmlns:="http://www.w3.org/1999/xhtml">a variable</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.274.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will compare the one-hot encoding implementations of </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.276.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.278.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.280.1" xmlns:="http://www.w3.org/1999/xhtml">featur</span><a id="_idTextAnchor196"/><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.281.1" xmlns:="http://www.w3.org/1999/xhtml">e-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.282.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.283.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.284.1" xmlns:="http://www.w3.org/1999/xhtml">Fir</span><a id="_idTextAnchor199"/><span class="koboSpan" id="kobo.285.1" xmlns:="http://www.w3.org/1999/xhtml">st, let’s make a few imports an</span><a id="_idTextAnchor200"/><span class="koboSpan" id="kobo.286.1" xmlns:="http://www.w3.org/1999/xhtml">d get the </span><span class="No-Break"><span class="koboSpan" id="kobo.287.1" xmlns:="http://www.w3.org/1999/xhtml">data ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.288.1" xmlns:="http://www.w3.org/1999/xhtml">Import </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.290.1" xmlns:="http://www.w3.org/1999/xhtml"> and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1" xmlns:="http://www.w3.org/1999/xhtml">train_test_split</span></strong><span class="koboSpan" id="kobo.292.1" xmlns:="http://www.w3.org/1999/xhtml"> function </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1" xmlns:="http://www.w3.org/1999/xhtml">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.294.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.295.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.296.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split</span></pre></li> <li><span class="koboSpan" id="kobo.297.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the Credit </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1" xmlns:="http://www.w3.org/1999/xhtml">Approval dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.299.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")</span></pre></li> <li><span class="koboSpan" id="kobo.300.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s separate the data into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.302.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.303.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker118"/><span class="koboSpan" id="kobo.304.1" xmlns:="http://www.w3.org/1999/xhtml">inspect the unique categories</span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.305.1" xmlns:="http://www.w3.org/1999/xhtml"> of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.306.1" xmlns:="http://www.w3.org/1999/xhtml">A4</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.307.1" xmlns:="http://www.w3.org/1999/xhtml"> variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.308.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train["A4"].unique()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.309.1" xmlns:="http://www.w3.org/1999/xhtml">We can see the unique values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1" xmlns:="http://www.w3.org/1999/xhtml">A4</span></strong><span class="koboSpan" id="kobo.311.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.313.1" xmlns:="http://www.w3.org/1999/xhtml">array(['u', 'y', 'Missing', 'l'], dtype=obje</span><a id="_idTextAnchor201"/><span class="koboSpan" id="kobo.314.1" xmlns:="http://www.w3.org/1999/xhtml">ct)</span></strong></pre></li> <li><span class="koboSpan" id="kobo.315.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s encode </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1" xmlns:="http://www.w3.org/1999/xhtml">A4</span></strong><span class="koboSpan" id="kobo.317.1" xmlns:="http://www.w3.org/1999/xhtml"> into</span><a id="_idTextAnchor202"/> <em class="italic"><span class="koboSpan" id="kobo.318.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em><span class="koboSpan" id="kobo.319.1" xmlns:="http://www.w3.org/1999/xhtml"> binary variables using </span><strong class="source-inline"><span class="koboSpan" id="kobo.320.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.321.1" xmlns:="http://www.w3.org/1999/xhtml"> and then inspect the first five rows of the </span><span class="No-Break"><span class="koboSpan" id="kobo.322.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.323.1" xmlns:="http://www.w3.org/1999/xhtml">
dummies = pd.get_dummies(
    X_train["A4"], drop_first=True)
dummies.head()</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.324.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.325.1" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.327.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1" xmlns:="http://www.w3.org/1999/xhtml">get_dummies()</span></strong><span class="koboSpan" id="kobo.329.1" xmlns:="http://www.w3.org/1999/xhtml">, we can either ignore or encode missing data through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1" xmlns:="http://www.w3.org/1999/xhtml">dummy_na</span></strong><span class="koboSpan" id="kobo.331.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter. </span><span class="koboSpan" id="kobo.331.2" xmlns:="http://www.w3.org/1999/xhtml">By setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1" xmlns:="http://www.w3.org/1999/xhtml">dummy_na=True</span></strong><span class="koboSpan" id="kobo.333.1" xmlns:="http://www.w3.org/1999/xhtml">, missing data will be encoded in a new binary variable. </span><span class="koboSpan" id="kobo.333.2" xmlns:="http://www.w3.org/1999/xhtml">To encode the variable into </span><em class="italic"><span class="koboSpan" id="kobo.334.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.335.1" xmlns:="http://www.w3.org/1999/xhtml"> dummies, use </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.336.1" xmlns:="http://www.w3.org/1999/xhtml">drop_first=False</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.337.1" xmlns:="http://www.w3.org/1999/xhtml"> instead.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.338.1" xmlns:="http://www.w3.org/1999/xhtml">Here, we can see the output of </span><em class="italic"><span class="koboSpan" id="kobo.339.1" xmlns:="http://www.w3.org/1999/xhtml">Step 5</span></em><span class="koboSpan" id="kobo.340.1" xmlns:="http://www.w3.org/1999/xhtml">, where each label is now a </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1" xmlns:="http://www.w3.org/1999/xhtml">binary variable:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.342.1" xmlns:="http://www.w3.org/1999/xhtml">      Missing        l        u        y</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.343.1" xmlns:="http://www.w3.org/1999/xhtml">596     False</span></strong><strong class="bold"><span class="koboSpan" id="kobo.344.1" xmlns:="http://www.w3.org/1999/xhtml">  False   True  False</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.345.1" xmlns:="http://www.w3.org/1999/xhtml">303     False  False   True  False</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.346.1" xmlns:="http://www.w3.org/1999/xhtml">204     False  False  </span></strong><strong class="bold"><span class="koboSpan" id="kobo.347.1" xmlns:="http://www.w3.org/1999/xhtml">False   True</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.348.1" xmlns:="http://www.w3.org/1999/xhtml">351     False  False  False   True</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.349.1" xmlns:="http://www.w3.org/1999/xhtml">118     False  False   True  False</span></strong></pre> <ol>
<li value="6"><span class="koboSpan" id="kobo.350.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.351.1" xmlns:="http://www.w3.org/1999/xhtml">encode </span><a id="_idIndexMarker121"/><span class="koboSpan" id="kobo.352.1" xmlns:="http://www.w3.org/1999/xhtml">all the categorical variables into </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.353.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.354.1" xmlns:="http://www.w3.org/1999/xhtml"> binaries:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.355.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = pd.get_dummies(X_train, drop_first=True)
X_test_enc = pd.get_dummies(X_test, drop_first=True)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.356.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.357.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.358.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1" xmlns:="http://www.w3.org/1999/xhtml">get_dummies()</span></strong><span class="koboSpan" id="kobo.360.1" xmlns:="http://www.w3.org/1999/xhtml">will encode all variables of the object, string, or category type by default. </span><span class="koboSpan" id="kobo.360.2" xmlns:="http://www.w3.org/1999/xhtml">To encode a subset of the variables, pass the variable names in a list to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.361.1" xmlns:="http://www.w3.org/1999/xhtml">columns</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.362.1" xmlns:="http://www.w3.org/1999/xhtml"> par</span><a id="_idTextAnchor203"/><span class="koboSpan" id="kobo.363.1" xmlns:="http://www.w3.org/1999/xhtml">ameter.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.364.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the first</span><a id="_idTextAnchor204"/><span class="koboSpan" id="kobo.365.1" xmlns:="http://www.w3.org/1999/xhtml"> five rows of the </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.367.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc.head()</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.368.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.369.1" xmlns:="http://www.w3.org/1999/xhtml">When encoding more than one variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1" xmlns:="http://www.w3.org/1999/xhtml">get_dummies()</span></strong><span class="koboSpan" id="kobo.371.1" xmlns:="http://www.w3.org/1999/xhtml"> captures the variable name – say, </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1" xmlns:="http://www.w3.org/1999/xhtml">A1</span></strong><span class="koboSpan" id="kobo.373.1" xmlns:="http://www.w3.org/1999/xhtml"> – and places an underscore followed by the category name to identify the resulting </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1" xmlns:="http://www.w3.org/1999/xhtml">binary variables.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.375.1" xmlns:="http://www.w3.org/1999/xhtml">We can see the binary variables in the </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1" xmlns:="http://www.w3.org/1999/xhtml">follo</span><a id="_idTextAnchor205"/><span class="koboSpan" id="kobo.377.1" xmlns:="http://www.w3.org/1999/xhtml">wing output:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.378.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.2 – A transformed DataFrame showing the numerical variables followed by the one-hot encoded representation of the categorical variables" src="image/B22396_02_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.379.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.2 – A transformed DataFrame showing the numerical variables followed by the one-hot encoded representation of the categorical variables</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.380.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.381.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.382.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1" xmlns:="http://www.w3.org/1999/xhtml">get_dummies()</span></strong><span class="koboSpan" id="kobo.384.1" xmlns:="http://www.w3.org/1999/xhtml">will create one binary variable per category seen in a DataFrame. </span><span class="koboSpan" id="kobo.384.2" xmlns:="http://www.w3.org/1999/xhtml">Hence, if there are more categories in the train set than in the test set, </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1" xmlns:="http://www.w3.org/1999/xhtml">get_dummies()</span></strong><span class="koboSpan" id="kobo.386.1" xmlns:="http://www.w3.org/1999/xhtml"> will return more columns in the transformed train set than in the transformed test set, and vice versa. </span><span class="koboSpan" id="kobo.386.2" xmlns:="http://www.w3.org/1999/xhtml">To avoid this, it is better to carry out one-hot encoding with </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.388.1" xmlns:="http://www.w3.org/1999/xhtml">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.389.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.390.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.391.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s do one-hot encoding using </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.392.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.393.1" xmlns:="http://www.w3.org/1999/xhtml"> instead.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.394.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.395.1" xmlns:="http://www.w3.org/1999/xhtml">import the encoder</span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.396.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.398.1" xmlns:="http://www.w3.org/1999/xhtml">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.399.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.400.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.401.1" xmlns:="http://www.w3.org/1999/xhtml">
from sklearn.preprocessing import OneHotEncoder
from sklearn.compose import ColumnTransformer</span></pre></li> <li><span class="koboSpan" id="kobo.402.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a list with the names of the </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.404.1" xmlns:="http://www.w3.org/1999/xhtml">
cat_vars = X_train.select_dtypes(
    include="O").columns.to_list()</span></pre></li> <li><span class="koboSpan" id="kobo.405.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the encoder to create </span><em class="italic"><span class="koboSpan" id="kobo.406.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.407.1" xmlns:="http://www.w3.org/1999/xhtml">binary variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.408.1" xmlns:="http://www.w3.org/1999/xhtml">
encoder = OneHotEncoder(drop="first",
    sparse_output=False)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.409.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.410.1" xmlns:="http://www.w3.org/1999/xhtml">To encode variables into </span><em class="italic"><span class="koboSpan" id="kobo.411.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.412.1" xmlns:="http://www.w3.org/1999/xhtml"> dummies, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.413.1" xmlns:="http://www.w3.org/1999/xhtml">drop</span></strong><span class="koboSpan" id="kobo.414.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.416.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.416.2" xmlns:="http://www.w3.org/1999/xhtml">To encode only binary variables into </span><em class="italic"><span class="koboSpan" id="kobo.417.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em><span class="koboSpan" id="kobo.418.1" xmlns:="http://www.w3.org/1999/xhtml">, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.419.1" xmlns:="http://www.w3.org/1999/xhtml">drop</span></strong><span class="koboSpan" id="kobo.420.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1" xmlns:="http://www.w3.org/1999/xhtml">if_binary</span></strong><span class="koboSpan" id="kobo.422.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.422.2" xmlns:="http://www.w3.org/1999/xhtml">The latter is useful because encoding binary variables into </span><em class="italic"><span class="koboSpan" id="kobo.423.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.424.1" xmlns:="http://www.w3.org/1999/xhtml"> dummies </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1" xmlns:="http://www.w3.org/1999/xhtml">is redundant.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.426.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.427.1" xmlns:="http://www.w3.org/1999/xhtml">restrict the encoding to the </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.429.1" xmlns:="http://www.w3.org/1999/xhtml">
ct = ColumnTransformer(
    [("encoder", encoder, cat_vars)],
    remainder="passthrough",
    force_int_remainder_cols=False,
).set_output(transform="pandas")</span></pre></li> <li><span class="koboSpan" id="kobo.430.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit </span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.431.1" xmlns:="http://www.w3.org/1999/xhtml">the encoder so that it identifies the categories </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1" xmlns:="http://www.w3.org/1999/xhtml">to encode:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.433.1" xmlns:="http://www.w3.org/1999/xhtml">
ct.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.434.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the categories that will be represented with </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1" xmlns:="http://www.w3.org/1999/xhtml">binary variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.436.1" xmlns:="http://www.w3.org/1999/xhtml">
ct.named_transformers_["encoder"].categories_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.437.1" xmlns:="http://www.w3.org/1999/xhtml">The transformer will add binary variables for the </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1" xmlns:="http://www.w3.org/1999/xhtml">follow</span><a id="_idTextAnchor206"/><span class="koboSpan" id="kobo.439.1" xmlns:="http://www.w3.org/1999/xhtml">ing categories:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer019">
<span class="koboSpan" id="kobo.440.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.3 – Arrays with the categories that will be encoded into binary variables (one array per variable)" src="image/B22396_02_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.441.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.3 – Arrays with the categories that will be encoded into binary variables (one array per variable)</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.442.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.443.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.444.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.445.1" xmlns:="http://www.w3.org/1999/xhtml">OneHotEncoder()</span></strong><span class="koboSpan" id="kobo.446.1" xmlns:="http://www.w3.org/1999/xhtml"> will only encode the categories learned from the train set. </span><span class="koboSpan" id="kobo.446.2" xmlns:="http://www.w3.org/1999/xhtml">If there are new categories in the test set, we can instruct the encoder to ignore them, return an error, or replace them with an infrequent category, by setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.447.1" xmlns:="http://www.w3.org/1999/xhtml">handle_unknown</span></strong><span class="koboSpan" id="kobo.448.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.449.1" xmlns:="http://www.w3.org/1999/xhtml">ignore</span></strong><span class="koboSpan" id="kobo.450.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.451.1" xmlns:="http://www.w3.org/1999/xhtml">error</span></strong><span class="koboSpan" id="kobo.452.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1" xmlns:="http://www.w3.org/1999/xhtml">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.454.1" xmlns:="http://www.w3.org/1999/xhtml">infrequent_if</span><a id="_idTextAnchor207"/><span class="koboSpan" id="kobo.455.1" xmlns:="http://www.w3.org/1999/xhtml">_exists</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.456.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.457.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.458.1" xmlns:="http://www.w3.org/1999/xhtml">encode the </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.460.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = ct.transform(X_train)
X_test_enc = ct.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.461.1" xmlns:="http://www.w3.org/1999/xhtml">Make sure to inspect the result by </span><span class="No-Break"><span class="koboSpan" id="kobo.462.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.463.1" xmlns:="http://www.w3.org/1999/xhtml">X_test_enc.head()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.464.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.465.1" xmlns:="http://www.w3.org/1999/xhtml">To get</span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.466.1" xmlns:="http://www.w3.org/1999/xhtml"> familiar with the output, let’s print the variable names of the </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.468.1" xmlns:="http://www.w3.org/1999/xhtml">
ct.get_feature_names_out()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.469.1" xmlns:="http://www.w3.org/1999/xhtml">In the following image, we see the names of the variables in the </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1" xmlns:="http://www.w3.org/1999/xhtml">transf</span><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.471.1" xmlns:="http://www.w3.org/1999/xhtml">ormed DataFrame:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer020">
<span class="koboSpan" id="kobo.472.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.4 – Arrays with the names of the variables in the resulting DataFrame" src="image/B22396_02_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.473.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.4 – Arrays with the names of the variables in the resulting DataFrame</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.474.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.475.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.476.1" xmlns:="http://www.w3.org/1999/xhtml"> changes the name and order of the variables during the transformation. </span><span class="koboSpan" id="kobo.476.2" xmlns:="http://www.w3.org/1999/xhtml">If the variable was encoded, it will append the </span><strong class="source-inline"><span class="koboSpan" id="kobo.477.1" xmlns:="http://www.w3.org/1999/xhtml">encoder</span></strong><span class="koboSpan" id="kobo.478.1" xmlns:="http://www.w3.org/1999/xhtml"> prefix and if the variable was not modified, it will append the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.479.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.480.1" xmlns:="http://www.w3.org/1999/xhtml"> prefix.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.481.1" xmlns:="http://www.w3.org/1999/xhtml">To wrap up the recipe, let’s perform one-hot encoding </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.483.1" xmlns:="http://www.w3.org/1999/xhtml">featu</span><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.484.1" xmlns:="http://www.w3.org/1999/xhtml">re-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.485.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="16"><span class="koboSpan" id="kobo.486.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.487.1" xmlns:="http://www.w3.org/1999/xhtml"> import </span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.488.1" xmlns:="http://www.w3.org/1999/xhtml">the encoder </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1" xmlns:="http://www.w3.org/1999/xhtml">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.490.1" xmlns:="http://www.w3.org/1999/xhtml">f</span></strong></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.491.1" xmlns:="http://www.w3.org/1999/xhtml">eature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.492.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.493.1" xmlns:="http://www.w3.org/1999/xhtml">
from feature_engine.encoding import O</span><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.494.1" xmlns:="http://www.w3.org/1999/xhtml">neHotEncoder</span></pre></li> <li><span class="koboSpan" id="kobo.495.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the encoder so that it returns </span><em class="italic"><span class="koboSpan" id="kobo.496.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.497.1" xmlns:="http://www.w3.org/1999/xhtml">binary variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.498.1" xmlns:="http://www.w3.org/1999/xhtml">
ohe_enc = OneHotEncoder(drop_last=True)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.499.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.500.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.501.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1" xmlns:="http://www.w3.org/1999/xhtml">OneHotEncoder()</span></strong><span class="koboSpan" id="kobo.503.1" xmlns:="http://www.w3.org/1999/xhtml"> encodes all categorical variables by default. </span><span class="koboSpan" id="kobo.503.2" xmlns:="http://www.w3.org/1999/xhtml">To encode a subset of the variables, pass the variable names in a list: </span><strong class="source-inline"><span class="koboSpan" id="kobo.504.1" xmlns:="http://www.w3.org/1999/xhtml">OneHotEncoder(variables=["A1", "A4"]</span></strong><span class="koboSpan" id="kobo.505.1" xmlns:="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.505.2" xmlns:="http://www.w3.org/1999/xhtml">To encode numerical variables, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.506.1" xmlns:="http://www.w3.org/1999/xhtml">ignore_format</span></strong><span class="koboSpan" id="kobo.507.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.508.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.509.1" xmlns:="http://www.w3.org/1999/xhtml"> or cast the variables </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1" xmlns:="http://www.w3.org/1999/xhtml">as objects.</span></span></p>
<ol>
<li value="18"><span class="koboSpan" id="kobo.511.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the encoder to the train set so that it learns the categories and variables </span><span class="No-Break"><span class="koboSpan" id="kobo.512.1" xmlns:="http://www.w3.org/1999/xhtml">to encode:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.513.1" xmlns:="http://www.w3.org/1999/xhtml">
ohe_enc.fit(X_train)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.514.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.515.1" xmlns:="http://www.w3.org/1999/xhtml">To encode binary variables into </span><em class="italic"><span class="koboSpan" id="kobo.516.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em><span class="koboSpan" id="kobo.517.1" xmlns:="http://www.w3.org/1999/xhtml">, and other categorical variables into </span><em class="italic"><span class="koboSpan" id="kobo.518.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.519.1" xmlns:="http://www.w3.org/1999/xhtml"> dummies, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1" xmlns:="http://www.w3.org/1999/xhtml">drop_last_binary</span></strong><span class="koboSpan" id="kobo.521.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter </span><span class="No-Break"><span class="koboSpan" id="kobo.522.1" xmlns:="http://www.w3.org/1999/xhtml">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.523.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.524.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="19"><span class="koboSpan" id="kobo.525.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s explore the variables that will </span><span class="No-Break"><span class="koboSpan" id="kobo.526.1" xmlns:="http://www.w3.org/1999/xhtml">be encoded:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.527.1" xmlns:="http://www.w3.org/1999/xhtml">
ohe_enc.variables_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.528.1" xmlns:="http://www.w3.org/1999/xhtml">The transformer found and stored the variables of the object or categorical type, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.529.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.530.1" xmlns:="http://www.w3.org/1999/xhtml">['A1', 'A4', 'A5', 'A6', 'A7', 'A9', 'A10', 'A12', 'A</span><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.531.1" xmlns:="http://www.w3.org/1999/xhtml">13']</span></pre></li> <li><span class="koboSpan" id="kobo.532.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.533.1" xmlns:="http://www.w3.org/1999/xhtml"> explore the c</span><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.534.1" xmlns:="http://www.w3.org/1999/xhtml">ategories for which dummy variables will </span><span class="No-Break"><span class="koboSpan" id="kobo.535.1" xmlns:="http://www.w3.org/1999/xhtml">be created:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.536.1" xmlns:="http://www.w3.org/1999/xhtml">
ohe_enc.encoder_dict_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.537.1" xmlns:="http://www.w3.org/1999/xhtml">The</span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.538.1" xmlns:="http://www.w3.org/1999/xhtml"> following dictionary contains the categories that will be encoded in </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1" xmlns:="http://www.w3.org/1999/xhtml">each variable:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.540.1" xmlns:="http://www.w3.org/1999/xhtml"> {'A1': ['a', 'b'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.541.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A4': ['u', 'y', 'Missing'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.542.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A5': ['g', 'p', 'Missing'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.543.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A6': ['c', 'q', 'w', 'ff', 'm', 'i', 'e', 'cc', 'x', 'd', 'k', 'j', 'Missing', 'aa'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.544.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A7': ['v', 'ff', 'h', 'dd', 'z', 'bb', 'j', 'Missing', 'n'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.545.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A9': ['t'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.546.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A10': ['t'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.547.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A12': ['t'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.548.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A13': ['g', 's']}</span></strong></pre></li> <li><span class="koboSpan" id="kobo.549.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s encode the categorical variables in train and </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.551.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = ohe_enc.transform(X_train)
X_test_enc = ohe_enc.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.552.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.553.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc.head()</span></strong><span class="koboSpan" id="kobo.554.1" xmlns:="http://www.w3.org/1999/xhtml">, we will see the </span><span class="No-Break"><span class="koboSpan" id="kobo.555.1" xmlns:="http://www.w3.org/1999/xhtml">f</span><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.556.1" xmlns:="http://www.w3.org/1999/xhtml">ollowing DataFrame:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer021">
<span class="koboSpan" id="kobo.557.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.5 – Transformed DataFrame with numerical variables followed by the one-hot encoded representation of the categorical variables" src="image/B22396_02_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.558.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.5 – Transformed DataFrame with numerical variables followed by the one-hot encoded representation of the categorical variables</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.559.1" xmlns:="http://www.w3.org/1999/xhtml">Note </span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.560.1" xmlns:="http://www.w3.org/1999/xhtml">how the </span><strong class="source-inline"><span class="koboSpan" id="kobo.561.1" xmlns:="http://www.w3.org/1999/xhtml">A4</span></strong><span class="koboSpan" id="kobo.562.1" xmlns:="http://www.w3.org/1999/xhtml"> cate</span><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.563.1" xmlns:="http://www.w3.org/1999/xhtml">gorical </span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.564.1" xmlns:="http://www.w3.org/1999/xhtml">variable was replaced with </span><strong class="source-inline"><span class="koboSpan" id="kobo.565.1" xmlns:="http://www.w3.org/1999/xhtml">A4_u</span></strong><span class="koboSpan" id="kobo.566.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.567.1" xmlns:="http://www.w3.org/1999/xhtml">A4_y</span></strong><span class="koboSpan" id="kobo.568.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1" xmlns:="http://www.w3.org/1999/xhtml">so on.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.570.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.571.1" xmlns:="http://www.w3.org/1999/xhtml">We can get the names of all the variables in the transformed dataset by </span><span class="No-Break"><span class="koboSpan" id="kobo.572.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.573.1" xmlns:="http://www.w3.org/1999/xhtml">ohe_enc.get</span><a id="_idTextAnchor215"/><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.574.1" xmlns:="http://www.w3.org/1999/xhtml">_feature_names_out()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.575.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-63"><a id="_idTextAnchor217"/><span class="koboSpan" id="kobo.576.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.577.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we performed a one-hot encoding of categorical variables using </span><strong class="source-inline"><span class="koboSpan" id="kobo.578.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.579.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.580.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.581.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.582.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.583.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.584.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.585.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.586.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.587.1" xmlns:="http://www.w3.org/1999/xhtml">get_dummies()</span></strong><span class="koboSpan" id="kobo.588.1" xmlns:="http://www.w3.org/1999/xhtml"> replaced the categorical variables with a set of binary variables representing each of the categories. </span><span class="koboSpan" id="kobo.588.2" xmlns:="http://www.w3.org/1999/xhtml">When used on the entire dataset, it returned the numerical variables, followed by the one-hot encoded representation of each seen category in every variable of type object, string, </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1" xmlns:="http://www.w3.org/1999/xhtml">or categorical.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.590.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.591.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.592.1" xmlns:="http://www.w3.org/1999/xhtml"> will return binary variables for every category seen in a dataset. </span><span class="koboSpan" id="kobo.592.2" xmlns:="http://www.w3.org/1999/xhtml">In practice, to avoid data leakage and anticipate deployment eventualities, we want to return dummy variables for categories seen in a training set only. </span><span class="koboSpan" id="kobo.592.3" xmlns:="http://www.w3.org/1999/xhtml">So, it is safer to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.594.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.595.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.596.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.597.1" xmlns:="http://www.w3.org/1999/xhtml">OneHotEncoder()</span></strong><span class="koboSpan" id="kobo.598.1" xmlns:="http://www.w3.org/1999/xhtml"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.600.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.602.1" xmlns:="http://www.w3.org/1999/xhtml"> learned the categories that should be represented by binary variables from the train set when we applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.604.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.604.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.605.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.606.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.607.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.608.1" xmlns:="http://www.w3.org/1999/xhtml"> returned just the binary variables, whereas </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.610.1" xmlns:="http://www.w3.org/1999/xhtml"> returned the numerical variables followed by the one-hot encoded representation of the </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1" xmlns:="http://www.w3.org/1999/xhtml">categorical ones.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.612.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.613.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.614.1" xmlns:="http://www.w3.org/1999/xhtml">OneHotEncoder()</span></strong><span class="koboSpan" id="kobo.615.1" xmlns:="http://www.w3.org/1999/xhtml"> encodes all variables by default. </span><span class="koboSpan" id="kobo.615.2" xmlns:="http://www.w3.org/1999/xhtml">To restrict the encoding to </span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.616.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables, we </span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.617.1" xmlns:="http://www.w3.org/1999/xhtml">used </span><strong class="source-inline"><span class="koboSpan" id="kobo.618.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.619.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.619.2" xmlns:="http://www.w3.org/1999/xhtml">We set the output of </span><strong class="source-inline"><span class="koboSpan" id="kobo.620.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.621.1" xmlns:="http://www.w3.org/1999/xhtml">to </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.623.1" xmlns:="http://www.w3.org/1999/xhtml"> to obtain the resulting data as </span><span class="No-Break"><span class="koboSpan" id="kobo.624.1" xmlns:="http://www.w3.org/1999/xhtml">a DataFrame.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.625.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.626.1" xmlns:="http://www.w3.org/1999/xhtml">One-hot encoding is suitable for linear models. </span><span class="koboSpan" id="kobo.626.2" xmlns:="http://www.w3.org/1999/xhtml">It also expands the feature space. </span><span class="koboSpan" id="kobo.626.3" xmlns:="http://www.w3.org/1999/xhtml">If your dataset contains many categorical variables or highly cardinal variables, you can restrict the number of binary variables by encoding the most frequent categories only. </span><span class="koboSpan" id="kobo.626.4" xmlns:="http://www.w3.org/1999/xhtml">You can do this automatically with both </span><strong class="source-inline"><span class="koboSpan" id="kobo.627.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.628.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.630.1" xmlns:="http://www.w3.org/1999/xhtml"> as we describe in the </span><em class="italic"><span class="koboSpan" id="kobo.631.1" xmlns:="http://www.w3.org/1999/xhtml">Performing one-hot encoding of freq</span><a id="_idTextAnchor218"/><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.632.1" xmlns:="http://www.w3.org/1999/xhtml">uent </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.633.1" xmlns:="http://www.w3.org/1999/xhtml">categories</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.634.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<h2 id="_idParaDest-64"><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.635.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more...</span></h2>
<p><span class="koboSpan" id="kobo.636.1" xmlns:="http://www.w3.org/1999/xhtml">We can also perform one-hot encoding using the Category Encoders Python </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1" xmlns:="http://www.w3.org/1999/xhtml">library: </span></span><a href="https://contrib.scikit-learn.org/category_encoders/onehot.html"><span class="No-Break"><span class="koboSpan" id="kobo.638.1" xmlns:="http://www.w3.org/1999/xhtml">https://</span></span><span class="No-Break"><span class="koboSpan" id="kobo.639.1" xmlns:="http://www.w3.org/1999/xhtml">contrib.scikit-learn.org/category_encoders/onehot.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.640.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.641.1" xmlns:="http://www.w3.org/1999/xhtml">To limit the number of binary variables, we can choose which categories to encode and which to ignore; check out a Python demo in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1" xmlns:="http://www.w3.org/1999/xhtml">article: </span></span><span class="No-Break"><span class="koboSpan" id="kobo.643.1" xmlns:="http://www.w3.org/1999/xhtml">https://www.blog.trainindata.com/one-hot-encoding-</span><a id="_idTextAnchor221"/><a id="_idTextAnchor222"/><span class="koboSpan" id="kobo.644.1" xmlns:="http://www.w3.org/1999/xhtml">categorical-variables</span></span><span class="No-Break"><span class="P---URL"><span class="koboSpan" id="kobo.645.1" xmlns:="http://www.w3.org/1999/xhtml">/</span></span></span><span class="No-Break"><span class="koboSpan" id="kobo.646.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-65"><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.647.1" xmlns:="http://www.w3.org/1999/xhtml">Performing one-hot encoding of frequent categories</span></h1>
<p><span class="koboSpan" id="kobo.648.1" xmlns:="http://www.w3.org/1999/xhtml">One-hot encoding </span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.649.1" xmlns:="http://www.w3.org/1999/xhtml">represents each variable’s category with a binary variable.</span><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.650.1" xmlns:="http://www.w3.org/1999/xhtml"> Hence, one-hot encoding of highly cardinal variables or datasets with multiple categorical features can expand the feature space dramatically. </span><span class="koboSpan" id="kobo.650.2" xmlns:="http://www.w3.org/1999/xhtml">This, in turn, may increase the computational cost of using machine learning models or deteriorate their performance. </span><span class="koboSpan" id="kobo.650.3" xmlns:="http://www.w3.org/1999/xhtml">To reduce the number of binary variables, we can perform one-hot encoding of the most frequent categories. </span><span class="koboSpan" id="kobo.650.4" xmlns:="http://www.w3.org/1999/xhtml">One-hot encoding </span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.651.1" xmlns:="http://www.w3.org/1999/xhtml">the top categories is equivalent to treating the remaining, less frequent categories as a single, </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1" xmlns:="http://www.w3.org/1999/xhtml">unique category.</span></span></p>
<p><span class="koboSpan" id="kobo.653.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will implement one-hot encoding of the most popular categories using </span><strong class="source-inline"><span class="koboSpan" id="kobo.654.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.655.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.656.1" xmlns:="http://www.w3.org/1999/xhtml">Scikit-l</span><a id="_idTextAnchor225"/><a id="_idTextAnchor226"/><span class="koboSpan" id="kobo.657.1" xmlns:="http://www.w3.org/1999/xhtml">earn</span></strong><span class="koboSpan" id="kobo.658.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.659.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.660.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.661.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-66"><a id="_idTextAnchor227"/><span class="koboSpan" id="kobo.662.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.663.1" xmlns:="http://www.w3.org/1999/xhtml">First, let’s import </span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.664.1" xmlns:="http://www.w3.org/1999/xhtml">the necessary </span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.665.1" xmlns:="http://www.w3.org/1999/xhtml">Python libraries and get the </span><span class="No-Break"><span class="koboSpan" id="kobo.666.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.667.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required Python libraries, functions, </span><span class="No-Break"><span class="koboSpan" id="kobo.668.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.669.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split</span></pre></li> <li><span class="koboSpan" id="kobo.670.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the Credit Approval dataset and divide it into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.671.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.672.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.673.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.674.1" xmlns:="http://www.w3.org/1999/xhtml">The most frequent categories need to be determined in the train set. </span><span class="koboSpan" id="kobo.674.2" xmlns:="http://www.w3.org/1999/xhtml">This is to avoid </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1" xmlns:="http://www.w3.org/1999/xhtml">data leakage.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.676.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the unique categories of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.677.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.678.1" xmlns:="http://www.w3.org/1999/xhtml"> variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.679.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train["A6"].unique()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.680.1" xmlns:="http://www.w3.org/1999/xhtml">The unique values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.681.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong><span class="koboSpan" id="kobo.682.1" xmlns:="http://www.w3.org/1999/xhtml"> are displayed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.684.1" xmlns:="http://www.w3.org/1999/xhtml">array(['c', 'q', 'w', 'ff', 'm', 'i', 'e', 'cc', 'x', 'd', 'k', 'j', 'Missing, 'aa', 'r']</span><a id="_idTextAnchor228"/><span class="koboSpan" id="kobo.685.1" xmlns:="http://www.w3.org/1999/xhtml">, dtype=object)</span></strong></pre></li> <li><span class="koboSpan" id="kobo.686.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s count </span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.687.1" xmlns:="http://www.w3.org/1999/xhtml">the number of observations per category of </span><strong class="source-inline"><span class="koboSpan" id="kobo.688.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong><span class="koboSpan" id="kobo.689.1" xmlns:="http://www.w3.org/1999/xhtml">, sort them in decreasing order, and then display the five most </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1" xmlns:="http://www.w3.org/1999/xhtml">frequent categories:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.691.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train["A6"].value_counts().sort_values(
    ascending=False).head(5)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.692.1" xmlns:="http://www.w3.org/1999/xhtml">We can</span><a id="_idIndexMarker141"/><span class="koboSpan" id="kobo.693.1" xmlns:="http://www.w3.org/1999/xhtml"> see the five most frequent categories and the number of observations per category in the </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.695.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.696.1" xmlns:="http://www.w3.org/1999/xhtml">c      93</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.697.1" xmlns:="http://www.w3.org/1999/xhtml">q      56</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.698.1" xmlns:="http://www.w3.org/1999/xhtml">w      48</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.699.1" xmlns:="http://www.w3.org/1999/xhtml">i      41</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.700.1" xmlns:="http://www.w3.org/1999/xhtml">ff     38</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.701.1" xmlns:="http://www.w3.org/1999/xhtml">Name: count, dtype: int64</span></strong></pre></li> <li><span class="koboSpan" id="kobo.702.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s capture the most frequent categories of </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong><span class="koboSpan" id="kobo.704.1" xmlns:="http://www.w3.org/1999/xhtml"> in a list by using the code in </span><em class="italic"><span class="koboSpan" id="kobo.705.1" xmlns:="http://www.w3.org/1999/xhtml">Step 4</span></em><span class="koboSpan" id="kobo.706.1" xmlns:="http://www.w3.org/1999/xhtml"> inside a </span><span class="No-Break"><span class="koboSpan" id="kobo.707.1" xmlns:="http://www.w3.org/1999/xhtml">list comprehension:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.708.1" xmlns:="http://www.w3.org/1999/xhtml">
top_5 = [x for x in X_train[
</span><strong class="bold"><span class="koboSpan" id="kobo.709.1" xmlns:="http://www.w3.org/1999/xhtml">      </span></strong><span class="koboSpan" id="kobo.710.1" xmlns:="http://www.w3.org/1999/xhtml">" A6"].value_counts().sort_values(
</span><strong class="bold"><span class="koboSpan" id="kobo.711.1" xmlns:="http://www.w3.org/1999/xhtml">          </span></strong><span class="koboSpan" id="kobo.712.1" xmlns:="http://www.w3.org/1999/xhtml">ascending=False).head(5).index
]</span></pre></li> <li><span class="koboSpan" id="kobo.713.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s add a binary variable per top category to a copy of the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.715.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = X_train.copy()
X_test_enc = X_test.copy()
for label in top_5:
    X_train_enc[f"A6_{label}"] = np.where(
        X_train["A6"] == label, 1, 0)
    X_test_enc[f"A6_{label}"] = np.where(
        X_test["A6"] </span><a id="_idTextAnchor229"/><span class="koboSpan" id="kobo.716.1" xmlns:="http://www.w3.org/1999/xhtml">== label, 1, 0)</span></pre></li> <li><span class="koboSpan" id="kobo.717.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s display</span><a id="_idIndexMarker142"/><span class="koboSpan" id="kobo.718.1" xmlns:="http://www.w3.org/1999/xhtml"> the top </span><strong class="source-inline"><span class="koboSpan" id="kobo.719.1" xmlns:="http://www.w3.org/1999/xhtml">10</span></strong><span class="koboSpan" id="kobo.720.1" xmlns:="http://www.w3.org/1999/xhtml"> rows </span><a id="_idIndexMarker143"/><span class="koboSpan" id="kobo.721.1" xmlns:="http://www.w3.org/1999/xhtml">of the original and encoded variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong><span class="koboSpan" id="kobo.723.1" xmlns:="http://www.w3.org/1999/xhtml">, in the </span><span class="No-Break"><span class="koboSpan" id="kobo.724.1" xmlns:="http://www.w3.org/1999/xhtml">train set:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.725.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc[["A6"] + [f"A6_{
    label}" for label in top_5]].head(10)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.726.1" xmlns:="http://www.w3.org/1999/xhtml">In the output of </span><em class="italic"><span class="koboSpan" id="kobo.727.1" xmlns:="http://www.w3.org/1999/xhtml">Step 7</span></em><span class="koboSpan" id="kobo.728.1" xmlns:="http://www.w3.org/1999/xhtml">, we can see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong><span class="koboSpan" id="kobo.730.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, followed by the </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1" xmlns:="http://www.w3.org/1999/xhtml">binary variables:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.732.1" xmlns:="http://www.w3.org/1999/xhtml">      A6  A6_c  A6_q  </span></strong><strong class="bold"><span class="koboSpan" id="kobo.733.1" xmlns:="http://www.w3.org/1999/xhtml">A6_w  A6_i  A6_ff</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.734.1" xmlns:="http://www.w3.org/1999/xhtml">596   c      1      0      0      0        0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.735.1" xmlns:="http://www.w3.org/1999/xhtml">303   q      </span></strong><strong class="bold"><span class="koboSpan" id="kobo.736.1" xmlns:="http://www.w3.org/1999/xhtml">0      1      0      0        0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.737.1" xmlns:="http://www.w3.org/1999/xhtml">204   w      0      0      1      0        </span></strong><strong class="bold"><span class="koboSpan" id="kobo.738.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.739.1" xmlns:="http://www.w3.org/1999/xhtml">351  ff      0      0      0      0        1</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.740.1" xmlns:="http://www.w3.org/1999/xhtml">118   m      0      </span></strong><strong class="bold"><span class="koboSpan" id="kobo.741.1" xmlns:="http://www.w3.org/1999/xhtml">0      0      0        0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.742.1" xmlns:="http://www.w3.org/1999/xhtml">247   q      0      1      0      0        0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.743.1" xmlns:="http://www.w3.org/1999/xhtml">652</span></strong><strong class="bold"><span class="koboSpan" id="kobo.744.1" xmlns:="http://www.w3.org/1999/xhtml">   i      0      0      0      1        0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.745.1" xmlns:="http://www.w3.org/1999/xhtml">513   e      0      0      </span></strong><strong class="bold"><span class="koboSpan" id="kobo.746.1" xmlns:="http://www.w3.org/1999/xhtml">0      0        0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.747.1" xmlns:="http://www.w3.org/1999/xhtml">230  cc      0      0      0      0        0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.748.1" xmlns:="http://www.w3.org/1999/xhtml">250   </span></strong><strong class="bold"><span class="koboSpan" id="kobo.749.1" xmlns:="http://www.w3.org/1999/xhtml">e      0      0      0      0        0</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.750.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s now automate one-hot encoding of frequent categories </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.752.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.753.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.754.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><span class="No-Break"><span class="koboSpan" id="kobo.755.1" xmlns:="http://www.w3.org/1999/xhtml">the encoder:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.756.1" xmlns:="http://www.w3.org/1999/xhtml">
from sklearn.preprocessing import OneHotEncoder</span></pre></li> <li><span class="koboSpan" id="kobo.757.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set </span><a id="_idIndexMarker144"/><span class="koboSpan" id="kobo.758.1" xmlns:="http://www.w3.org/1999/xhtml">up the encoder to encode categories shown in at least </span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1" xmlns:="http://www.w3.org/1999/xhtml">39</span></strong><span class="koboSpan" id="kobo.760.1" xmlns:="http://www.w3.org/1999/xhtml"> observations and limit the number of categories to encode </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1" xmlns:="http://www.w3.org/1999/xhtml">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.762.1" xmlns:="http://www.w3.org/1999/xhtml">5</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.763.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.764.1" xmlns:="http://www.w3.org/1999/xhtml">
encoder = OneHotEncoder(
    min_frequency=39,
    max_categories=5,
    sparse_output=False,
).set_output(transform="pandas")</span></pre></li> <li><span class="koboSpan" id="kobo.765.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s</span><a id="_idIndexMarker145"/><span class="koboSpan" id="kobo.766.1" xmlns:="http://www.w3.org/1999/xhtml"> fit the transformer to the two high cardinal variables and then transform </span><span class="No-Break"><span class="koboSpan" id="kobo.767.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.768.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = encoder.fit_transform(X_train[
    ['A6', 'A7']])
X_test_enc = encoder.transform(X_test[['A6', 'A7']])</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.769.1" xmlns:="http://www.w3.org/1999/xhtml">If you execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.770.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc.head()</span></strong><span class="koboSpan" id="kobo.771.1" xmlns:="http://www.w3.org/1999/xhtml"> you’ll see the </span><span class="No-Break"><span class="koboSpan" id="kobo.772.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer022">
<span class="koboSpan" id="kobo.773.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.6 – Transformed DataFrame containing binary variables for those categories with at least 39 observations and an additional binary representing all remaining categories" src="image/B22396_02_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.774.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.6 – Transformed DataFrame containing binary variables for those categories with at least 39 observations and an additional binary representing all remaining categories</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.775.1" xmlns:="http://www.w3.org/1999/xhtml">To wrap up the recipe, let’s encode the most frequent categories </span><span class="No-Break"><span class="koboSpan" id="kobo.776.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.777.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.778.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.779.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up</span><a id="_idIndexMarker146"/><span class="koboSpan" id="kobo.780.1" xmlns:="http://www.w3.org/1999/xhtml"> the one-hot encoder to encode the five most frequent categories of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.781.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong><span class="koboSpan" id="kobo.782.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.783.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.784.1" xmlns:="http://www.w3.org/1999/xhtml"> variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.785.1" xmlns:="http://www.w3.org/1999/xhtml">
From feature_engine.encoding import OneHotEncoder
ohe_enc = OneHotEncoder(
    top_categories=5,
    variables=["A6", "A7"]
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.786.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.787.1" xmlns:="http://www.w3.org/1999/xhtml">The number of frequent categories to encode is arbitrarily dete</span><a id="_idTextAnchor230"/><span class="koboSpan" id="kobo.788.1" xmlns:="http://www.w3.org/1999/xhtml">rmined by </span><span class="No-Break"><span class="koboSpan" id="kobo.789.1" xmlns:="http://www.w3.org/1999/xhtml">the user.</span></span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.790.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit</span><a id="_idIndexMarker147"/><span class="koboSpan" id="kobo.791.1" xmlns:="http://www.w3.org/1999/xhtml"> the encoder to the train set so that it learns and stores the most frequent categories of </span><strong class="source-inline"><span class="koboSpan" id="kobo.792.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.793.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.794.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.795.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.796.1" xmlns:="http://www.w3.org/1999/xhtml">
ohe_enc.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.797.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s encode </span><strong class="source-inline"><span class="koboSpan" id="kobo.798.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong><span class="koboSpan" id="kobo.799.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.800.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.801.1" xmlns:="http://www.w3.org/1999/xhtml"> in the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.802.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.803.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = ohe_enc.transform(X_train)
X_test_enc = ohe_enc.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.804.1" xmlns:="http://www.w3.org/1999/xhtml">You can view the new binary variables in the transformed DataFrame by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.805.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc.head()</span></strong><span class="koboSpan" id="kobo.806.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.806.2" xmlns:="http://www.w3.org/1999/xhtml">You can also find the top five categories learned by the encoder b</span><a id="_idTextAnchor231"/><a id="_idTextAnchor232"/><span class="koboSpan" id="kobo.807.1" xmlns:="http://www.w3.org/1999/xhtml">y </span><span class="No-Break"><span class="koboSpan" id="kobo.808.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.809.1" xmlns:="http://www.w3.org/1999/xhtml">ohe_enc.encoder_dict_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.810.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> </ol>
<h2 id="_idParaDest-67"><a id="_idTextAnchor233"/><span class="koboSpan" id="kobo.811.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.812.1" xmlns:="http://www.w3.org/1999/xhtml">In the first </span><a id="_idIndexMarker148"/><span class="koboSpan" id="kobo.813.1" xmlns:="http://www.w3.org/1999/xhtml">part of this recipe, we worked with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.814.1" xmlns:="http://www.w3.org/1999/xhtml">A6</span></strong><span class="koboSpan" id="kobo.815.1" xmlns:="http://www.w3.org/1999/xhtml"> categorical variable. </span><span class="koboSpan" id="kobo.815.2" xmlns:="http://www.w3.org/1999/xhtml">We inspected its unique categories with </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.817.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.818.1" xmlns:="http://www.w3.org/1999/xhtml">unique()</span></strong><span class="koboSpan" id="kobo.819.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.819.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we counted the number of observations per category using </span><strong class="source-inline"><span class="koboSpan" id="kobo.820.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.821.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.822.1" xmlns:="http://www.w3.org/1999/xhtml">value_counts()</span></strong><span class="koboSpan" id="kobo.823.1" xmlns:="http://www.w3.org/1999/xhtml">, which returned a </span><strong class="source-inline"><span class="koboSpan" id="kobo.824.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.825.1" xmlns:="http://www.w3.org/1999/xhtml"> series with the categories as the index and the number of observations as values. </span><span class="koboSpan" id="kobo.825.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we sorted the categories from the one with the most to the one with the least observations using </span><strong class="source-inline"><span class="koboSpan" id="kobo.826.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.827.1" xmlns:="http://www.w3.org/1999/xhtml">’</span><a id="_idTextAnchor234"/> <strong class="source-inline"><span class="koboSpan" id="kobo.828.1" xmlns:="http://www.w3.org/1999/xhtml">sort_values()</span></strong><span class="koboSpan" id="kobo.829.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.829.2" xmlns:="http://www.w3.org/1999/xhtml">We then reduced the series to the five most popular categories by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.830.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.831.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.832.1" xmlns:="http://www.w3.org/1999/xhtml">head()</span></strong><span class="koboSpan" id="kobo.833.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.833.2" xmlns:="http://www.w3.org/1999/xhtml">We used this series in a list comprehension to capture the names of the most frequent categories. </span><span class="koboSpan" id="kobo.833.3" xmlns:="http://www.w3.org/1999/xhtml">After that, we looped over each category, and with NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1" xmlns:="http://www.w3.org/1999/xhtml">where()</span></strong><span class="koboSpan" id="kobo.835.1" xmlns:="http://www.w3.org/1999/xhtml">, we created binary variables by placing a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.837.1" xmlns:="http://www.w3.org/1999/xhtml"> if the observation showed the category, or </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.838.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.839.1" xmlns:="http://www.w3.org/1999/xhtml"> otherwise.</span></span></p>
<p><span class="koboSpan" id="kobo.840.1" xmlns:="http://www.w3.org/1999/xhtml">We discussed how to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.841.1" xmlns:="http://www.w3.org/1999/xhtml">OneHotEncoder()</span></strong><span class="koboSpan" id="kobo.842.1" xmlns:="http://www.w3.org/1999/xhtml"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.843.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.844.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.845.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.846.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><em class="italic"><span class="koboSpan" id="kobo.847.1" xmlns:="http://www.w3.org/1999/xhtml">Creating binary variables through one-hot encoding</span></em><span class="koboSpan" id="kobo.848.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe. </span><span class="koboSpan" id="kobo.848.2" xmlns:="http://www.w3.org/1999/xhtml">Here, I will only highlight the parameters needed to encode the most </span><span class="No-Break"><span class="koboSpan" id="kobo.849.1" xmlns:="http://www.w3.org/1999/xhtml">frequent categories.</span></span></p>
<p><span class="koboSpan" id="kobo.850.1" xmlns:="http://www.w3.org/1999/xhtml">To encode</span><a id="_idIndexMarker149"/><span class="koboSpan" id="kobo.851.1" xmlns:="http://www.w3.org/1999/xhtml"> frequent categories with </span><strong class="source-inline"><span class="koboSpan" id="kobo.852.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.853.1" xmlns:="http://www.w3.org/1999/xhtml">, we set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.854.1" xmlns:="http://www.w3.org/1999/xhtml">min_frequency</span></strong><span class="koboSpan" id="kobo.855.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.856.1" xmlns:="http://www.w3.org/1999/xhtml">39</span></strong><span class="koboSpan" id="kobo.857.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.857.2" xmlns:="http://www.w3.org/1999/xhtml">Hence, categories shown in less than </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1" xmlns:="http://www.w3.org/1999/xhtml">39</span></strong><span class="koboSpan" id="kobo.859.1" xmlns:="http://www.w3.org/1999/xhtml"> observations were grouped into an additional binary variable </span><span class="No-Break"><span class="koboSpan" id="kobo.860.1" xmlns:="http://www.w3.org/1999/xhtml">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.861.1" xmlns:="http://www.w3.org/1999/xhtml">infrequent_sklearn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.862.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.863.1" xmlns:="http://www.w3.org/1999/xhtml">To encode frequent categories with </span><strong class="source-inline"><span class="koboSpan" id="kobo.864.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.865.1" xmlns:="http://www.w3.org/1999/xhtml">, we set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.866.1" xmlns:="http://www.w3.org/1999/xhtml">top_categories</span></strong><span class="koboSpan" id="kobo.867.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.868.1" xmlns:="http://www.w3.org/1999/xhtml">5</span></strong><span class="koboSpan" id="kobo.869.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.869.2" xmlns:="http://www.w3.org/1999/xhtml">Hence, the transformer created binary variables for the 5 most frequent categories only. </span><span class="koboSpan" id="kobo.869.3" xmlns:="http://www.w3.org/1999/xhtml">Less frequent categories will s</span><a id="_idTextAnchor235"/><a id="_idTextAnchor236"/><span class="koboSpan" id="kobo.870.1" xmlns:="http://www.w3.org/1999/xhtml">how a </span><strong class="source-inline"><span class="koboSpan" id="kobo.871.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.872.1" xmlns:="http://www.w3.org/1999/xhtml"> in all the </span><span class="No-Break"><span class="koboSpan" id="kobo.873.1" xmlns:="http://www.w3.org/1999/xhtml">binary variables.</span></span></p>
<h2 id="_idParaDest-68"><a id="_idTextAnchor237"/><span class="koboSpan" id="kobo.874.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more...</span></h2>
<p><span class="koboSpan" id="kobo.875.1" xmlns:="http://www.w3.org/1999/xhtml">This recipe is based on the winning solution of the </span><strong class="bold"><span class="koboSpan" id="kobo.876.1" xmlns:="http://www.w3.org/1999/xhtml">Knowledge Discovery and Data </span></strong><span class="koboSpan" id="kobo.877.1" xmlns:="http://www.w3.org/1999/xhtml">(</span><strong class="bold"><span class="koboSpan" id="kobo.878.1" xmlns:="http://www.w3.org/1999/xhtml">KDD</span></strong><span class="koboSpan" id="kobo.879.1" xmlns:="http://www.w3.org/1999/xhtml">) 2009 mining cup, </span><em class="italic"><span class="koboSpan" id="kobo.880.1" xmlns:="http://www.w3.org/1999/xhtml">Winning the KDD Cup Orange Challenge with Ensemble Selection</span></em><span class="koboSpan" id="kobo.881.1" xmlns:="http://www.w3.org/1999/xhtml"> (http://proceedings.mlr.press/v7/niculescu09/niculescu09.pdf), where the author's limited one-hot encoding to the 10 most f</span><a id="_idTextAnchor238"/><a id="_idTextAnchor239"/><span class="koboSpan" id="kobo.882.1" xmlns:="http://www.w3.org/1999/xhtml">requent categories of </span><span class="No-Break"><span class="koboSpan" id="kobo.883.1" xmlns:="http://www.w3.org/1999/xhtml">each variable.</span></span></p>
<h1 id="_idParaDest-69"><span class="koboSpan" id="kobo.884.1" xmlns:="http://www.w3.org/1999/xhtml">Replacing categories with counts or th</span><a id="_idTextAnchor240"/><span class="koboSpan" id="kobo.885.1" xmlns:="http://www.w3.org/1999/xhtml">e frequency of observations</span></h1>
<p><span class="koboSpan" id="kobo.886.1" xmlns:="http://www.w3.org/1999/xhtml">In count </span><a id="_idIndexMarker150"/><span class="koboSpan" id="kobo.887.1" xmlns:="http://www.w3.org/1999/xhtml">with counts or frequency of observatio</span><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.888.1" xmlns:="http://www.w3.org/1999/xhtml">ns” or frequency encoding, we replace the categories with the count or the fraction of observations showing that category. </span><span class="koboSpan" id="kobo.888.2" xmlns:="http://www.w3.org/1999/xhtml">That is, if 10 out of 100 observations show the </span><strong class="source-inline"><span class="koboSpan" id="kobo.889.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.890.1" xmlns:="http://www.w3.org/1999/xhtml"> category for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.891.1" xmlns:="http://www.w3.org/1999/xhtml">Color</span></strong><span class="koboSpan" id="kobo.892.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, we would replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.893.1" xmlns:="http://www.w3.org/1999/xhtml">blue</span></strong><span class="koboSpan" id="kobo.894.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.895.1" xmlns:="http://www.w3.org/1999/xhtml">10</span></strong><span class="koboSpan" id="kobo.896.1" xmlns:="http://www.w3.org/1999/xhtml"> when doing count encoding, or with </span><strong class="source-inline"><span class="koboSpan" id="kobo.897.1" xmlns:="http://www.w3.org/1999/xhtml">0.1</span></strong><span class="koboSpan" id="kobo.898.1" xmlns:="http://www.w3.org/1999/xhtml"> if performing frequency encoding. </span><span class="koboSpan" id="kobo.898.2" xmlns:="http://www.w3.org/1999/xhtml">These encoding methods are useful when there is a relationship between the category frequency and the target. </span><span class="koboSpan" id="kobo.898.3" xmlns:="http://www.w3.org/1999/xhtml">For example, in sales, the frequency of a product may indicate </span><span class="No-Break"><span class="koboSpan" id="kobo.899.1" xmlns:="http://www.w3.org/1999/xhtml">its popularity.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.900.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.901.1" xmlns:="http://www.w3.org/1999/xhtml">If two different categories are present in the same number of observations, they will be replaced by the same value, which may lead to </span><span class="No-Break"><span class="koboSpan" id="kobo.902.1" xmlns:="http://www.w3.org/1999/xhtml">information loss.</span></span></p>
<p><span class="koboSpan" id="kobo.903.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will perform count and frequency enco</span><a id="_idTextAnchor242"/><a id="_idTextAnchor243"/><span class="koboSpan" id="kobo.904.1" xmlns:="http://www.w3.org/1999/xhtml">ding using </span><strong class="source-inline"><span class="koboSpan" id="kobo.905.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.906.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.907.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.908.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-70"><a id="_idTextAnchor244"/><span class="koboSpan" id="kobo.909.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.910.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll start by encoding one variable with </span><strong class="source-inline"><span class="koboSpan" id="kobo.911.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.912.1" xmlns:="http://www.w3.org/1999/xhtml"> and then we’ll automate the process </span><span class="No-Break"><span class="koboSpan" id="kobo.913.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.914.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.915.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.916.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s start with </span><span class="No-Break"><span class="koboSpan" id="kobo.917.1" xmlns:="http://www.w3.org/1999/xhtml">the imports:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.918.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split
from feature_engine.encoding import CountFrequencyEncoder</span></pre></li> <li><span class="koboSpan" id="kobo.919.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the Credit Approval dataset and divide it into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.920.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.921.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.922.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker151"/><span class="koboSpan" id="kobo.923.1" xmlns:="http://www.w3.org/1999/xhtml">with counts or frequency of observations” capture the number of observations per category of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.925.1" xmlns:="http://www.w3.org/1999/xhtml"> variable in </span><span class="No-Break"><span class="koboSpan" id="kobo.926.1" xmlns:="http://www.w3.org/1999/xhtml">a dictionary:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.927.1" xmlns:="http://www.w3.org/1999/xhtml">
counts = X_train["A7"].value_counts().to_dict()</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.928.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.929.1" xmlns:="http://www.w3.org/1999/xhtml">To find the frequency instead, </span><span class="No-Break"><span class="koboSpan" id="kobo.930.1" xmlns:="http://www.w3.org/1999/xhtml">execute </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.931.1" xmlns:="http://www.w3.org/1999/xhtml">X_train["A7"].value_counts(normalize=True).to_dict()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.932.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.933.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1" xmlns:="http://www.w3.org/1999/xhtml">print(counts)</span></strong><span class="koboSpan" id="kobo.935.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the count of observations per category </span><span class="No-Break"><span class="koboSpan" id="kobo.936.1" xmlns:="http://www.w3.org/1999/xhtml">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.937.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.938.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.939.1" xmlns:="http://www.w3.org/1999/xhtml">{'v': 277, 'h': 101, 'ff': 41, 'bb': 39, 'z': 7, 'dd': 5, 'j': 5, 'Missing': 4, 'n': 3, 'o': 1}</span></strong></pre> <ol>
<li value="4"><span class="koboSpan" id="kobo.940.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s replace the categories in </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.942.1" xmlns:="http://www.w3.org/1999/xhtml"> with the counts in a copy of the </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1" xmlns:="http://www.w3.org/1999/xhtml">data sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.944.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = X_train.copy()
X_test_enc = X_test.copy()
X_train_enc["A7"] = X_train_enc["A7"].map(counts)
X_test_enc["A7"] = X_test_enc["A7"].map(counts)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.945.1" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and inspect the data by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.946.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc.head()</span></strong><span class="koboSpan" id="kobo.947.1" xmlns:="http://www.w3.org/1999/xhtml"> to corroborate that the categories have been replaced by </span><span class="No-Break"><span class="koboSpan" id="kobo.948.1" xmlns:="http://www.w3.org/1999/xhtml">the counts.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.949.1" xmlns:="http://www.w3.org/1999/xhtml">To apply this procedure to multiple variables, we can </span><span class="No-Break"><span class="koboSpan" id="kobo.950.1" xmlns:="http://www.w3.org/1999/xhtml">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.951.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.952.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.953.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the encoder so that it encodes all categorical variables with the count </span><span class="No-Break"><span class="koboSpan" id="kobo.954.1" xmlns:="http://www.w3.org/1999/xhtml">of observations:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.955.1" xmlns:="http://www.w3.org/1999/xhtml">
count_enc = CountFrequencyEncoder(
    encoding_method="count", variables=None,
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.956.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.957.1" xmlns:="http://www.w3.org/1999/xhtml">CountFrequencyEncoder()</span></strong><span class="koboSpan" id="kobo.958.1" xmlns:="http://www.w3.org/1999/xhtml"> will automatically find and encode all categorical variables in the train set. </span><span class="koboSpan" id="kobo.958.2" xmlns:="http://www.w3.org/1999/xhtml">To encode only a subset of the variables, pass the variable names in a list to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.959.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.960.1" xmlns:="http://www.w3.org/1999/xhtml"> argument. </span><span class="koboSpan" id="kobo.960.2" xmlns:="http://www.w3.org/1999/xhtml">To encode with the frequency instead, </span><span class="No-Break"><span class="koboSpan" id="kobo.961.1" xmlns:="http://www.w3.org/1999/xhtml">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.962.1" xmlns:="http://www.w3.org/1999/xhtml">encoding_method="frequency"</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.963.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.964.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the</span><a id="_idIndexMarker152"/><span class="koboSpan" id="kobo.965.1" xmlns:="http://www.w3.org/1999/xhtml"> encoder to the train set so that it stores the number of observations per category </span><span class="No-Break"><span class="koboSpan" id="kobo.966.1" xmlns:="http://www.w3.org/1999/xhtml">per variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.967.1" xmlns:="http://www.w3.org/1999/xhtml">
count_enc.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.968.1" xmlns:="http://www.w3.org/1999/xhtml">The encoder found the categorical variables automatically. </span><span class="koboSpan" id="kobo.968.2" xmlns:="http://www.w3.org/1999/xhtml">Let’s check </span><span class="No-Break"><span class="koboSpan" id="kobo.969.1" xmlns:="http://www.w3.org/1999/xhtml">them out:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.970.1" xmlns:="http://www.w3.org/1999/xhtml">
count_enc.variables_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.971.1" xmlns:="http://www.w3.org/1999/xhtml">The previous command returns the names of the categorical variables in the </span><span class="No-Break"><span class="koboSpan" id="kobo.972.1" xmlns:="http://www.w3.org/1999/xhtml">train set:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.973.1" xmlns:="http://www.w3.org/1999/xhtml">['A1', 'A4', 'A5', 'A6', 'A7', 'A9', 'A10', 'A12', 'A13']</span></strong></pre></li> <li><span class="koboSpan" id="kobo.974.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s print the count of observations per category </span><span class="No-Break"><span class="koboSpan" id="kobo.975.1" xmlns:="http://www.w3.org/1999/xhtml">per variable:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.976.1" xmlns:="http://www.w3.org/1999/xhtml">count_enc.encoder_dict_</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.977.1" xmlns:="http://www.w3.org/1999/xhtml">The previous attribute stores the mappings that will be used to replace </span><span class="No-Break"><span class="koboSpan" id="kobo.978.1" xmlns:="http://www.w3.org/1999/xhtml">the categories:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer023">
<span class="koboSpan" id="kobo.979.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.7 – Dictionary containing the number of observations per category, for each variable; these values will be used to encode the categorical variables" src="image/B22396_02_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.980.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.7 – Dictionary containing the number of observations per category, for each variable; these values will be used to encode the categorical variables</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.981.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s </span><a id="_idIndexMarker153"/><span class="koboSpan" id="kobo.982.1" xmlns:="http://www.w3.org/1999/xhtml">with counts or frequency of observations” replace the categories with counts in the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.983.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.984.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = count_enc.transform(X_train)
X_test_enc = count_enc.transform(X_test)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.985.1" xmlns:="http://www.w3.org/1999/xhtml">Check out the result by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.986.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc.head()</span></strong><span class="koboSpan" id="kobo.987.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.987.2" xmlns:="http://www.w3.org/1999/xhtml">The encoder returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.988.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.989.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrames with the strings of the categorical variables replaced with the counts of observations, leaving the variables r</span><a id="_idTextAnchor245"/><a id="_idTextAnchor246"/><span class="koboSpan" id="kobo.990.1" xmlns:="http://www.w3.org/1999/xhtml">eady to use in machine </span><span class="No-Break"><span class="koboSpan" id="kobo.991.1" xmlns:="http://www.w3.org/1999/xhtml">learning models.</span></span></p>
<h2 id="_idParaDest-71"><a id="_idTextAnchor247"/><span class="koboSpan" id="kobo.992.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.993.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we replaced categories with the count of observations using </span><strong class="source-inline"><span class="koboSpan" id="kobo.994.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.995.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.996.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.997.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.998.1" xmlns:="http://www.w3.org/1999/xhtml">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.999.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1000.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1001.1" xmlns:="http://www.w3.org/1999/xhtml">value_counts()</span></strong><span class="koboSpan" id="kobo.1002.1" xmlns:="http://www.w3.org/1999/xhtml">, we determined the number of observations per category of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1003.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1004.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, and with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1005.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1006.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1007.1" xmlns:="http://www.w3.org/1999/xhtml">to_dict()</span></strong><span class="koboSpan" id="kobo.1008.1" xmlns:="http://www.w3.org/1999/xhtml">, we captured these values in a </span><a id="_idIndexMarker154"/><span class="koboSpan" id="kobo.1009.1" xmlns:="http://www.w3.org/1999/xhtml">with counts or frequency of observations” dictionary, where each key was a unique category, and each value the number of observations for that category. </span><span class="koboSpan" id="kobo.1009.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1010.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1011.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1012.1" xmlns:="http://www.w3.org/1999/xhtml">map()</span></strong><span class="koboSpan" id="kobo.1013.1" xmlns:="http://www.w3.org/1999/xhtml"> and using this dictionary, we replaced the categories with the observation counts in both the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1014.1" xmlns:="http://www.w3.org/1999/xhtml">test sets.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1015.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1016.1" xmlns:="http://www.w3.org/1999/xhtml">The count of observations for the encoding should be obtained from the train set to avoid data leakage. </span><span class="koboSpan" id="kobo.1016.2" xmlns:="http://www.w3.org/1999/xhtml">Note that new categories in the test set will not have a corresponding mapping and hence will be replaced by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.1018.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1018.2" xmlns:="http://www.w3.org/1999/xhtml">To avoid this, use f</span><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1" xmlns:="http://www.w3.org/1999/xhtml">eature-engine</span></strong><span class="koboSpan" id="kobo.1020.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1020.2" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, you can replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1021.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1022.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1023.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1025.1" xmlns:="http://www.w3.org/1999/xhtml">To perform count encoding with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1026.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1027.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1" xmlns:="http://www.w3.org/1999/xhtml">CountFrequencyEncoder()</span></strong><span class="koboSpan" id="kobo.1029.1" xmlns:="http://www.w3.org/1999/xhtml"> and set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1030.1" xmlns:="http://www.w3.org/1999/xhtml">encoding_method</span></strong><span class="koboSpan" id="kobo.1031.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1032.1" xmlns:="http://www.w3.org/1999/xhtml">'count'</span></strong><span class="koboSpan" id="kobo.1033.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1033.2" xmlns:="http://www.w3.org/1999/xhtml">We left the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1035.1" xmlns:="http://www.w3.org/1999/xhtml"> argument set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1036.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1037.1" xmlns:="http://www.w3.org/1999/xhtml"> so that the encoder automatically finds all the categorical variables in the dataset. </span><span class="koboSpan" id="kobo.1037.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1038.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1039.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer found the categorical variables and stored the observation counts per category in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1040.1" xmlns:="http://www.w3.org/1999/xhtml">encoder_dict_</span></strong><span class="koboSpan" id="kobo.1041.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.1041.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1042.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1043.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer replaced the categories with the counts, returning a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1044.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1045.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrame.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1046.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1047.1" xmlns:="http://www.w3.org/1999/xhtml">If there are categories in the test set that were not present in the train set, the encoder will raise an error by default. </span><span class="koboSpan" id="kobo.1047.2" xmlns:="http://www.w3.org/1999/xhtml">You can make it ignore them, in which case they will appear as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1048.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.1049.1" xmlns:="http://www.w3.org/1999/xhtml">, or encode them </span><span class="No-Break"><span class="koboSpan" id="kobo.1050.1" xmlns:="http://www.w3.org/1999/xhtml">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1051.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1052.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-72"><a id="_idTextAnchor248"/><span class="koboSpan" id="kobo.1053.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.1054.1" xmlns:="http://www.w3.org/1999/xhtml">You can also carry out count and frequency encoding with the Python library Category </span><span class="No-Break"><span class="koboSpan" id="kobo.1055.1" xmlns:="http://www.w3.org/1999/xhtml">Encoders: </span></span><a href="https://contrib.scikit-learn.org/category_encoders/count.html"><span class="No-Break"><span class="koboSpan" id="kobo.1056.1" xmlns:="http://www.w3.org/1999/xhtml">https://contrib.scikit-learn.org/category_encoders/count.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1057.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1058.1" xmlns:="http://www.w3.org/1999/xhtml">For some useful applications of count encoding, check out this </span><span class="No-Break"><span class="koboSpan" id="kobo.1059.1" xmlns:="http://www.w3.org/1999/xhtml">article: </span></span><a href="https://letsdatascience.com/frequency-encoding/"><span class="No-Break"><span class="koboSpan" id="kobo.1060.1" xmlns:="http://www.w3.org/1999/xhtml">https://</span><span id="_idTextAnchor249"/><span id="_idTextAnchor250"/><span class="koboSpan" id="kobo.1061.1" xmlns:="http://www.w3.org/1999/xhtml">letsdatascience.com/frequency-encoding/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1062.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-73"><a id="_idTextAnchor251"/><span class="koboSpan" id="kobo.1063.1" xmlns:="http://www.w3.org/1999/xhtml">Replacing categories with ordinal numbers</span></h1>
<p><span class="koboSpan" id="kobo.1064.1" xmlns:="http://www.w3.org/1999/xhtml">Ordinal encoding </span><a id="_idIndexMarker155"/><span class="koboSpan" id="kobo.1065.1" xmlns:="http://www.w3.org/1999/xhtml">consists of replacing the categories with digits from </span><em class="italic"><span class="koboSpan" id="kobo.1066.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></em><span class="koboSpan" id="kobo.1067.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><em class="italic"><span class="koboSpan" id="kobo.1068.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.1069.1" xmlns:="http://www.w3.org/1999/xhtml"> (or </span><em class="italic"><span class="koboSpan" id="kobo.1070.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></em><span class="koboSpan" id="kobo.1071.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><em class="italic"><span class="koboSpan" id="kobo.1072.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em><span class="koboSpan" id="kobo.1073.1" xmlns:="http://www.w3.org/1999/xhtml">, depending on the implementation), where </span><em class="italic"><span class="koboSpan" id="kobo.1074.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.1075.1" xmlns:="http://www.w3.org/1999/xhtml"> is the number of distinct categories of the variable. </span><span class="koboSpan" id="kobo.1075.2" xmlns:="http://www.w3.org/1999/xhtml">The numbers are assigned arbitrarily. </span><span class="koboSpan" id="kobo.1075.3" xmlns:="http://www.w3.org/1999/xhtml">Ordinal encoding is better suited for non-linear machine learning models, which can navigate through arbitrarily assigned numbers to find patterns that relate to </span><span class="No-Break"><span class="koboSpan" id="kobo.1076.1" xmlns:="http://www.w3.org/1999/xhtml">the target.</span></span></p>
<p><span class="koboSpan" id="kobo.1077.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will </span><a id="_idIndexMarker156"/><span class="koboSpan" id="kobo.1078.1" xmlns:="http://www.w3.org/1999/xhtml">perform ordinal encoding using</span><a id="_idTextAnchor252"/><a id="_idTextAnchor253"/> <strong class="source-inline"><span class="koboSpan" id="kobo.1079.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1080.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1082.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1083.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1084.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1085.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-74"><a id="_idTextAnchor254"/><span class="koboSpan" id="kobo.1086.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1087.1" xmlns:="http://www.w3.org/1999/xhtml">First, let’s make the import and prepare </span><span class="No-Break"><span class="koboSpan" id="kobo.1088.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1089.1" xmlns:="http://www.w3.org/1999/xhtml">Import </span><strong class="source-inline"><span class="koboSpan" id="kobo.1090.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1091.1" xmlns:="http://www.w3.org/1999/xhtml"> and the data </span><span class="No-Break"><span class="koboSpan" id="kobo.1092.1" xmlns:="http://www.w3.org/1999/xhtml">split function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1093.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split</span></pre></li> <li><span class="koboSpan" id="kobo.1094.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the Credit Approval dataset and divide it into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1095.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1096.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1097.1" xmlns:="http://www.w3.org/1999/xhtml">To </span><a id="_idIndexMarker157"/><span class="koboSpan" id="kobo.1098.1" xmlns:="http://www.w3.org/1999/xhtml">encode the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1100.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, let’s make a dictionary of </span><span class="No-Break"><span class="koboSpan" id="kobo.1101.1" xmlns:="http://www.w3.org/1999/xhtml">category-to-integer pairs:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1102.1" xmlns:="http://www.w3.org/1999/xhtml">
ordinal_mapping = {k: i for i, k in enumerate(
    X_train["A7"].unique(), 0)
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1103.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1104.1" xmlns:="http://www.w3.org/1999/xhtml">print(ordinal_mapping)</span></strong><span class="koboSpan" id="kobo.1105.1" xmlns:="http://www.w3.org/1999/xhtml">, we will see the digits that will replace </span><span class="No-Break"><span class="koboSpan" id="kobo.1106.1" xmlns:="http://www.w3.org/1999/xhtml">each category:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1107.1" xmlns:="http://www.w3.org/1999/xhtml">{'v': 0, 'ff': 1, 'h': 2, 'dd': 3, 'z': 4, 'bb': 5, 'j': 6, 'Missing': 7, 'n': 8, 'o': 9}</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1108.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker158"/><span class="koboSpan" id="kobo.1109.1" xmlns:="http://www.w3.org/1999/xhtml">replace the categories in a copy of </span><span class="No-Break"><span class="koboSpan" id="kobo.1110.1" xmlns:="http://www.w3.org/1999/xhtml">the DataFrames:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1111.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = X_train.copy()
X_test_enc = X_test.copy()
X_train_enc["A7"] = X_train_enc["A7"].map(ordinal_mapping)
X_test_enc["A7"] = X_test_enc["A7"].map(ordinal_mapping)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1112.1" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1113.1" xmlns:="http://www.w3.org/1999/xhtml">print(X_train["A7"].head())</span></strong><span class="koboSpan" id="kobo.1114.1" xmlns:="http://www.w3.org/1999/xhtml"> to see the result of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1115.1" xmlns:="http://www.w3.org/1999/xhtml">previous operation.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.1116.1" xmlns:="http://www.w3.org/1999/xhtml">Next, we’ll carry out ordinal encoding </span><span class="No-Break"><span class="koboSpan" id="kobo.1117.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1118.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1119.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.1120.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the </span><span class="No-Break"><span class="koboSpan" id="kobo.1121.1" xmlns:="http://www.w3.org/1999/xhtml">required classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1122.1" xmlns:="http://www.w3.org/1999/xhtml">
from sklearn.preprocessing import OrdinalEncoder
from sklearn.compose import ColumnTransformer</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1123.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1124.1" xmlns:="http://www.w3.org/1999/xhtml">Do not confuse </span><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1126.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1127.1" xmlns:="http://www.w3.org/1999/xhtml">LabelEncoder()</span></strong><span class="koboSpan" id="kobo.1128.1" xmlns:="http://www.w3.org/1999/xhtml"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1130.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1130.2" xmlns:="http://www.w3.org/1999/xhtml">The former is intended to encode predictive features, whereas the latter is intended to modify the </span><span class="No-Break"><span class="koboSpan" id="kobo.1131.1" xmlns:="http://www.w3.org/1999/xhtml">target variable.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1132.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set</span><a id="_idIndexMarker159"/><span class="koboSpan" id="kobo.1133.1" xmlns:="http://www.w3.org/1999/xhtml"> up </span><span class="No-Break"><span class="koboSpan" id="kobo.1134.1" xmlns:="http://www.w3.org/1999/xhtml">the encoder:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1135.1" xmlns:="http://www.w3.org/1999/xhtml">
enc = OrdinalEncoder()</span></pre></li> <li><span class="koboSpan" id="kobo.1136.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s make a list containing the categorical variables </span><span class="No-Break"><span class="koboSpan" id="kobo.1137.1" xmlns:="http://www.w3.org/1999/xhtml">to encode:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1138.1" xmlns:="http://www.w3.org/1999/xhtml">
cat_vars = X_train.select_dtypes(include="O").columns.to_list()</span></pre></li> <li><span class="koboSpan" id="kobo.1139.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s restrict </span><a id="_idIndexMarker160"/><span class="koboSpan" id="kobo.1140.1" xmlns:="http://www.w3.org/1999/xhtml">the encoding to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1141.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1142.1" xmlns:="http://www.w3.org/1999/xhtml">
ct = ColumnTransformer(
    [("encoder", enc, cat_vars)],
    remainder="passthrough",
    force_int_remainder_cols=False,
).set_output(transform="pandas")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1143.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1144.1" xmlns:="http://www.w3.org/1999/xhtml">Remember to set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1145.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong><span class="koboSpan" id="kobo.1146.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1" xmlns:="http://www.w3.org/1999/xhtml">"passthrough"</span></strong><span class="koboSpan" id="kobo.1148.1" xmlns:="http://www.w3.org/1999/xhtml"> to make the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1149.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.1150.1" xmlns:="http://www.w3.org/1999/xhtml"> return the un-transformed variables </span><span class="No-Break"><span class="koboSpan" id="kobo.1151.1" xmlns:="http://www.w3.org/1999/xhtml">as well.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.1152.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the encoder to the train set so that it creates and stores representations of categories </span><span class="No-Break"><span class="koboSpan" id="kobo.1153.1" xmlns:="http://www.w3.org/1999/xhtml">to digits:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1154.1" xmlns:="http://www.w3.org/1999/xhtml">
ct.fit(X_train)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1155.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1156.1" xmlns:="http://www.w3.org/1999/xhtml">By executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1157.1" xmlns:="http://www.w3.org/1999/xhtml">ct.named_transformers_["encoder"].categories_</span></strong><span class="koboSpan" id="kobo.1158.1" xmlns:="http://www.w3.org/1999/xhtml">, you can visualize the unique categories </span><span class="No-Break"><span class="koboSpan" id="kobo.1159.1" xmlns:="http://www.w3.org/1999/xhtml">per variable.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.1160.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s encode the categorical variables in the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1161.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1162.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = ct.transform(X_train)
X_test_enc = ct.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1163.1" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc.head()</span></strong><span class="koboSpan" id="kobo.1165.1" xmlns:="http://www.w3.org/1999/xhtml"> to check out the </span><span class="No-Break"><span class="koboSpan" id="kobo.1166.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1167.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1168.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.1169.1" xmlns:="http://www.w3.org/1999/xhtml"> will mark the encoded variables by appending </span><strong class="source-inline"><span class="koboSpan" id="kobo.1170.1" xmlns:="http://www.w3.org/1999/xhtml">encoder</span></strong><span class="koboSpan" id="kobo.1171.1" xmlns:="http://www.w3.org/1999/xhtml"> to the variable name. </span><span class="koboSpan" id="kobo.1171.2" xmlns:="http://www.w3.org/1999/xhtml">The variables that were not modified show the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1173.1" xmlns:="http://www.w3.org/1999/xhtml"> prefix.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1174.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s do</span><a id="_idIndexMarker161"/><span class="koboSpan" id="kobo.1175.1" xmlns:="http://www.w3.org/1999/xhtml"> ordinal encoding </span><a id="_idIndexMarker162"/><span class="No-Break"><span class="koboSpan" id="kobo.1176.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1178.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.1179.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><span class="No-Break"><span class="koboSpan" id="kobo.1180.1" xmlns:="http://www.w3.org/1999/xhtml">the encoder:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1181.1" xmlns:="http://www.w3.org/1999/xhtml">
from feature_engine.encoding import OrdinalEncoder</span></pre></li> <li><span class="koboSpan" id="kobo.1182.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the encoder so that it replaces categories with arbitrary integers in the categorical variables specified in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1183.1" xmlns:="http://www.w3.org/1999/xhtml">Step 7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1184.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1185.1" xmlns:="http://www.w3.org/1999/xhtml">
enc = OrdinalEncoder(
    encoding_method="arbitrary",
    variables=cat_vars,
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1186.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1187.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1188.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1189.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1190.1" xmlns:="http://www.w3.org/1999/xhtml"> automatically finds and encodes all categorical variables if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1191.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1192.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1193.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1194.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1194.2" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, it will encode the variables indicated in the list. </span><span class="koboSpan" id="kobo.1194.3" xmlns:="http://www.w3.org/1999/xhtml">In addition, it can assign the integers according to the target mean value (see the </span><em class="italic"><span class="koboSpan" id="kobo.1195.1" xmlns:="http://www.w3.org/1999/xhtml">Performing ordinal encoding based on the target </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1196.1" xmlns:="http://www.w3.org/1999/xhtml">value</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1197.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe).</span></span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.1198.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the</span><a id="_idIndexMarker163"/><span class="koboSpan" id="kobo.1199.1" xmlns:="http://www.w3.org/1999/xhtml"> encoder to the train set so </span><a id="_idIndexMarker164"/><span class="koboSpan" id="kobo.1200.1" xmlns:="http://www.w3.org/1999/xhtml">that it learns and stores the </span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1" xmlns:="http://www.w3.org/1999/xhtml">category-to-integer mappings:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1202.1" xmlns:="http://www.w3.org/1999/xhtml">
enc.fit(X_train)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1203.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1204.1" xmlns:="http://www.w3.org/1999/xhtml">The category to integer mappings are stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1205.1" xmlns:="http://www.w3.org/1999/xhtml">encoder_dict_</span></strong><span class="koboSpan" id="kobo.1206.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute and can be accessed by </span><span class="No-Break"><span class="koboSpan" id="kobo.1207.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1208.1" xmlns:="http://www.w3.org/1999/xhtml">enc.encoder_dict_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1209.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.1210.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s encode the categorical variables in the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1211.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1212.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = enc.transform(X_train)
X_test_enc = enc.transform(X_test)</span></pre></li> </ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1213.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1214.1" xmlns:="http://www.w3.org/1999/xhtml"> returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.1215.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1216.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrames where the values of the original variables are replaced with numbers, leaving the </span><a id="_idTextAnchor255"/><a id="_idTextAnchor256"/><span class="koboSpan" id="kobo.1217.1" xmlns:="http://www.w3.org/1999/xhtml">DataFrame ready to use in machine </span><span class="No-Break"><span class="koboSpan" id="kobo.1218.1" xmlns:="http://www.w3.org/1999/xhtml">learning models.</span></span></p>
<h2 id="_idParaDest-75"><a id="_idTextAnchor257"/><span class="koboSpan" id="kobo.1219.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1220.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we replaced categories with integers </span><span class="No-Break"><span class="koboSpan" id="kobo.1221.1" xmlns:="http://www.w3.org/1999/xhtml">assigned arbitrarily.</span></span></p>
<p><span class="koboSpan" id="kobo.1222.1" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1223.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1224.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1225.1" xmlns:="http://www.w3.org/1999/xhtml">unique()</span></strong><span class="koboSpan" id="kobo.1226.1" xmlns:="http://www.w3.org/1999/xhtml"> to find the unique categories of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1227.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1228.1" xmlns:="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.1228.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we created a dictionary of category-to-integer and passed it to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1229.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1230.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1231.1" xmlns:="http://www.w3.org/1999/xhtml">map()</span></strong><span class="koboSpan" id="kobo.1232.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace the strings in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1233.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1234.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><span class="No-Break"><span class="koboSpan" id="kobo.1235.1" xmlns:="http://www.w3.org/1999/xhtml">the integers.</span></span></p>
<p><span class="koboSpan" id="kobo.1236.1" xmlns:="http://www.w3.org/1999/xhtml">Next, we carried out ordinal encoding using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1237.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1238.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1239.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder() </span></strong><span class="koboSpan" id="kobo.1240.1" xmlns:="http://www.w3.org/1999/xhtml">and used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1241.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.1242.1" xmlns:="http://www.w3.org/1999/xhtml"> to restrict the encoding to categorical variables. </span><span class="koboSpan" id="kobo.1242.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1243.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1244.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer created the category-to-integer mappings based on the categories in the train set. </span><span class="koboSpan" id="kobo.1244.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1245.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1246.1" xmlns:="http://www.w3.org/1999/xhtml">, the categories were replaced with integers. </span><span class="koboSpan" id="kobo.1246.2" xmlns:="http://www.w3.org/1999/xhtml">By setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1247.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong><span class="koboSpan" id="kobo.1248.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1249.1" xmlns:="http://www.w3.org/1999/xhtml">passthrough</span></strong><span class="koboSpan" id="kobo.1250.1" xmlns:="http://www.w3.org/1999/xhtml">, we made </span><strong class="source-inline"><span class="koboSpan" id="kobo.1251.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.1252.1" xmlns:="http://www.w3.org/1999/xhtml"> concatenate the variables that are not encoded at the back of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1253.1" xmlns:="http://www.w3.org/1999/xhtml">encoded features.</span></span></p>
<p><span class="koboSpan" id="kobo.1254.1" xmlns:="http://www.w3.org/1999/xhtml">To perform ordinal encoding with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1255.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1256.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1257.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1258.1" xmlns:="http://www.w3.org/1999/xhtml">, indicating that the integers should be assigned arbitrarily through </span><strong class="source-inline"><span class="koboSpan" id="kobo.1259.1" xmlns:="http://www.w3.org/1999/xhtml">encoding_method</span></strong><span class="koboSpan" id="kobo.1260.1" xmlns:="http://www.w3.org/1999/xhtml">, and passed a list with the variables to encode in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1261.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1262.1" xmlns:="http://www.w3.org/1999/xhtml"> argument. </span><span class="koboSpan" id="kobo.1262.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1263.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1264.1" xmlns:="http://www.w3.org/1999/xhtml">, the encoder assigned integers to each variable’s categories, which </span><a id="_idIndexMarker165"/><span class="koboSpan" id="kobo.1265.1" xmlns:="http://www.w3.org/1999/xhtml">were stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1266.1" xmlns:="http://www.w3.org/1999/xhtml">encoder_dict_</span></strong><span class="koboSpan" id="kobo.1267.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.1267.2" xmlns:="http://www.w3.org/1999/xhtml">These</span><a id="_idIndexMarker166"/><span class="koboSpan" id="kobo.1268.1" xmlns:="http://www.w3.org/1999/xhtml"> mappings were then used by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1269.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1270.1" xmlns:="http://www.w3.org/1999/xhtml"> method to replace the categories in the train and test sets, </span><span class="No-Break"><span class="koboSpan" id="kobo.1271.1" xmlns:="http://www.w3.org/1999/xhtml">returning DataFrames.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1272.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1273.1" xmlns:="http://www.w3.org/1999/xhtml">When a category in the test set is not present in the training set, it will not have a mapping to a digit. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1274.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1275.1" xmlns:="http://www.w3.org/1999/xhtml"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1276.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1277.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1278.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1279.1" xmlns:="http://www.w3.org/1999/xhtml"> will raise an error by default. </span><span class="koboSpan" id="kobo.1279.2" xmlns:="http://www.w3.org/1999/xhtml">However, they have the option to replace unseen categories with a user-defined value or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1280.1" xmlns:="http://www.w3.org/1999/xhtml">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1281.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1282.1" xmlns:="http://www.w3.org/1999/xhtml">, respectively.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1283.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1284.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1285.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1286.1" xmlns:="http://www.w3.org/1999/xhtml"> can restrict the encoding to those categories with a minimum frequency. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1287.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1288.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1289.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1290.1" xmlns:="http://www.w3.org/1999/xhtml"> can assign the numbers based on the target</span><a id="_idTextAnchor258"/><a id="_idTextAnchor259"/><span class="koboSpan" id="kobo.1291.1" xmlns:="http://www.w3.org/1999/xhtml"> mean value, as we will see in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1292.1" xmlns:="http://www.w3.org/1999/xhtml">following recipe.</span></span></p>
<h2 id="_idParaDest-76"><a id="_idTextAnchor260"/><span class="koboSpan" id="kobo.1293.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more...</span></h2>
<p><span class="koboSpan" id="kobo.1294.1" xmlns:="http://www.w3.org/1999/xhtml">You can also carry out ordinal encoding with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1295.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1296.1" xmlns:="http://www.w3.org/1999/xhtml"> from Category Encoders. </span><span class="koboSpan" id="kobo.1296.2" xmlns:="http://www.w3.org/1999/xhtml">Check it out </span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1" xmlns:="http://www.w3.org/1999/xhtml">at </span></span><a href="http://contrib.scikit-learn.org/category_encoders/ordinal.html"><span class="No-Break"><span class="koboSpan" id="kobo.1298.1" xmlns:="http://www.w3.org/1999/xhtml">http://cont</span><span id="_idTextAnchor261"/><span class="koboSpan" id="kobo.1299.1" xmlns:="http://www.w3.org/1999/xhtml">rib.scikit-l</span><span id="_idTextAnchor262"/><span id="_idTextAnchor263"/><span id="_idTextAnchor264"/><span class="koboSpan" id="kobo.1300.1" xmlns:="http://www.w3.org/1999/xhtml">earn.org/category_encoders/ordinal.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1301.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-77"><a id="_idTextAnchor265"/><span class="koboSpan" id="kobo.1302.1" xmlns:="http://www.w3.org/1999/xhtml">Performing ordinal encoding based on the target value</span></h1>
<p><span class="koboSpan" id="kobo.1303.1" xmlns:="http://www.w3.org/1999/xhtml">In the previous</span><a id="_idIndexMarker167"/><span class="koboSpan" id="kobo.1304.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe, we replaced categories with integers, which were assigned arbitrarily. </span><span class="koboSpan" id="kobo.1304.2" xmlns:="http://www.w3.org/1999/xhtml">We can also assign integers to the categories given the target values. </span><span class="koboSpan" id="kobo.1304.3" xmlns:="http://www.w3.org/1999/xhtml">To do this, first, we calculate the mean value of the target per category. </span><span class="koboSpan" id="kobo.1304.4" xmlns:="http://www.w3.org/1999/xhtml">Next, we order the categories from the one with the lowest to the one with the highest target mean value. </span><span class="koboSpan" id="kobo.1304.5" xmlns:="http://www.w3.org/1999/xhtml">Finally, we assign digits to the ordered categories, starting with </span><em class="italic"><span class="koboSpan" id="kobo.1305.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></em><span class="koboSpan" id="kobo.1306.1" xmlns:="http://www.w3.org/1999/xhtml"> to the first category up to </span><em class="italic"><span class="koboSpan" id="kobo.1307.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em><span class="koboSpan" id="kobo.1308.1" xmlns:="http://www.w3.org/1999/xhtml"> to the last category, where </span><em class="italic"><span class="koboSpan" id="kobo.1309.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.1310.1" xmlns:="http://www.w3.org/1999/xhtml"> is the number of </span><span class="No-Break"><span class="koboSpan" id="kobo.1311.1" xmlns:="http://www.w3.org/1999/xhtml">distinct categories.</span></span></p>
<p><span class="koboSpan" id="kobo.1312.1" xmlns:="http://www.w3.org/1999/xhtml">This encoding method creates a monotonic relationship between the categorical variable and the response and therefore makes the variables more adequate for use in </span><span class="No-Break"><span class="koboSpan" id="kobo.1313.1" xmlns:="http://www.w3.org/1999/xhtml">linear models.</span></span></p>
<p><span class="koboSpan" id="kobo.1314.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will</span><a id="_idIndexMarker168"/><span class="koboSpan" id="kobo.1315.1" xmlns:="http://www.w3.org/1999/xhtml"> encode categories while follo</span><a id="_idTextAnchor266"/><a id="_idTextAnchor267"/><span class="koboSpan" id="kobo.1316.1" xmlns:="http://www.w3.org/1999/xhtml">wing the target value using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1317.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1318.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1319.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1320.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-78"><a id="_idTextAnchor268"/><span class="koboSpan" id="kobo.1321.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1322.1" xmlns:="http://www.w3.org/1999/xhtml">First, let’s import the necessary Python libraries and get the </span><span class="No-Break"><span class="koboSpan" id="kobo.1323.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1324.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required Python libraries, functions, </span><span class="No-Break"><span class="koboSpan" id="kobo.1325.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1326.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split</span></pre></li> <li><span class="koboSpan" id="kobo.1327.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the Credit Approval dataset and divide it into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1328.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1329.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1330.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s determine the mean target value per category in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1331.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1332.1" xmlns:="http://www.w3.org/1999/xhtml">, then sort the categories from that with the lowest to that with the highest </span><span class="No-Break"><span class="koboSpan" id="kobo.1333.1" xmlns:="http://www.w3.org/1999/xhtml">target value:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1334.1" xmlns:="http://www.w3.org/1999/xhtml">
y_train.groupby(X_train["A7"]).mean().sort_values()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1335.1" xmlns:="http://www.w3.org/1999/xhtml">The following is the output of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1336.1" xmlns:="http://www.w3.org/1999/xhtml">preceding command:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1337.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1338.1" xmlns:="http://www.w3.org/1999/xhtml">o          0.000000</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1339.1" xmlns:="http://www.w3.org/1999/xhtml">ff         0.146341</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1340.1" xmlns:="http://www.w3.org/1999/xhtml">j          0.200000</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1341.1" xmlns:="http://www.w3.org/1999/xhtml">dd         0.400000</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1342.1" xmlns:="http://www.w3.org/1999/xhtml">v          0.418773</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1343.1" xmlns:="http://www.w3.org/1999/xhtml">bb         0.512821</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1344.1" xmlns:="http://www.w3.org/1999/xhtml">h          0.603960</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1345.1" xmlns:="http://www.w3.org/1999/xhtml">n          0.666667</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1346.1" xmlns:="http://www.w3.org/1999/xhtml">z          0.714286</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1347.1" xmlns:="http://www.w3.org/1999/xhtml">Missing    1.000000</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1348.1" xmlns:="http://www.w3.org/1999/xhtml">Name: target, dtype: float64</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1349.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker169"/><span class="koboSpan" id="kobo.1350.1" xmlns:="http://www.w3.org/1999/xhtml">repeat the computation in </span><em class="italic"><span class="koboSpan" id="kobo.1351.1" xmlns:="http://www.w3.org/1999/xhtml">Step 3</span></em><span class="koboSpan" id="kobo.1352.1" xmlns:="http://www.w3.org/1999/xhtml">, but this time, let’s retain the ordered </span><span class="No-Break"><span class="koboSpan" id="kobo.1353.1" xmlns:="http://www.w3.org/1999/xhtml">category names:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1354.1" xmlns:="http://www.w3.org/1999/xhtml">
ordered_labels = y_train.groupby(
    X_train["A7"]).mean().sort_values().index</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1355.1" xmlns:="http://www.w3.org/1999/xhtml">To display the output of the preceding command, we can execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1356.1" xmlns:="http://www.w3.org/1999/xhtml">print(ordered_labels)</span></strong><span class="koboSpan" id="kobo.1357.1" xmlns:="http://www.w3.org/1999/xhtml">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1358.1" xmlns:="http://www.w3.org/1999/xhtml">Index(['o', 'ff', 'j', 'dd', 'v', 'bb', 'h', 'n', 'z', 'Missing'], </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1359.1" xmlns:="http://www.w3.org/1999/xhtml">dtype='object', name='A7')</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1360.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.1361.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a dictionary of category-to-integer pairs, using the ordered list we created in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1362.1" xmlns:="http://www.w3.org/1999/xhtml">Step 4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1363.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1364.1" xmlns:="http://www.w3.org/1999/xhtml">
ordinal_mapping = {
    k: i for i, k in enumerate(ordered_labels, 0)
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1365.1" xmlns:="http://www.w3.org/1999/xhtml">We can visualize the result of the preceding code by </span><span class="No-Break"><span class="koboSpan" id="kobo.1366.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1367.1" xmlns:="http://www.w3.org/1999/xhtml">print(ordinal_mapping)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1368.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1369.1" xmlns:="http://www.w3.org/1999/xhtml">{'o': 0, 'ff': 1, 'j': 2, 'dd': 3, 'v': 4, 'bb': 5, 'h': 6, 'n': 7, 'z': 8, 'Missing': 9}</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1370.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s use</span><a id="_idIndexMarker170"/><span class="koboSpan" id="kobo.1371.1" xmlns:="http://www.w3.org/1999/xhtml"> the dictionary we created in </span><em class="italic"><span class="koboSpan" id="kobo.1372.1" xmlns:="http://www.w3.org/1999/xhtml">Step 5</span></em><span class="koboSpan" id="kobo.1373.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace the categories in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1374.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1375.1" xmlns:="http://www.w3.org/1999/xhtml"> in a copy of </span><span class="No-Break"><span class="koboSpan" id="kobo.1376.1" xmlns:="http://www.w3.org/1999/xhtml">the datasets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1377.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = X_train.copy()
X_test_enc = X_test.copy()
X_train_enc["A7"] = X_train_enc["A7"].map(
    ordinal_mapping)
X_test_enc["A7"] = X_test_enc["A7"].map(
    ordinal_mapping)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1378.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1379.1" xmlns:="http://www.w3.org/1999/xhtml">If the test set contains a category that is not present in the train set, the preceding code will </span><span class="No-Break"><span class="koboSpan" id="kobo.1380.1" xmlns:="http://www.w3.org/1999/xhtml">introduce </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1381.1" xmlns:="http://www.w3.org/1999/xhtml">np.nan</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1382.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1383.1" xmlns:="http://www.w3.org/1999/xhtml">To visualize the effect of this encoding, let’s plot the relationship of the categories of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1384.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1385.1" xmlns:="http://www.w3.org/1999/xhtml"> variable with the target before and after </span><span class="No-Break"><span class="koboSpan" id="kobo.1386.1" xmlns:="http://www.w3.org/1999/xhtml">the encoding.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1387.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s plot the mean target response per category of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1388.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1389.1" xmlns:="http://www.w3.org/1999/xhtml"> variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1390.1" xmlns:="http://www.w3.org/1999/xhtml">
y_train.groupby(X_train["A7"]).mean().plot()
plt.title("Relationship between A7 and the target")
plt.ylabel("Mean of target")
plt.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1391.1" xmlns:="http://www.w3.org/1999/xhtml">We can see the non-monotonic relationship between</span><a id="_idTextAnchor269"/><span class="koboSpan" id="kobo.1392.1" xmlns:="http://www.w3.org/1999/xhtml"> categories of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1393.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1394.1" xmlns:="http://www.w3.org/1999/xhtml"> and the target in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1395.1" xmlns:="http://www.w3.org/1999/xhtml">following plot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer024">
<span class="koboSpan" id="kobo.1396.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.8 – Mean target value per category of A7 before the encoding" src="image/B22396_02_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1397.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.8 – Mean target value per category of A7 before the encoding</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.1398.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s plot</span><a id="_idIndexMarker171"/><span class="koboSpan" id="kobo.1399.1" xmlns:="http://www.w3.org/1999/xhtml"> the mean target value per category in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1400.1" xmlns:="http://www.w3.org/1999/xhtml">encoded variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1401.1" xmlns:="http://www.w3.org/1999/xhtml">
y_train.groupby(X_train_enc["A7"]).mean().plot()
plt.title("Relationship between A7 and the target")
plt.ylabel("Mean of target")
plt.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1402.1" xmlns:="http://www.w3.org/1999/xhtml">The encoded variable shows a monotonic relationship with the target – the higher the mean targe</span><a id="_idTextAnchor270"/><span class="koboSpan" id="kobo.1403.1" xmlns:="http://www.w3.org/1999/xhtml">t value, the higher the digit assigned to </span><span class="No-Break"><span class="koboSpan" id="kobo.1404.1" xmlns:="http://www.w3.org/1999/xhtml">the category:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer025">
<span class="koboSpan" id="kobo.1405.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.9 – Mean target value per category of A7 after the encoding." src="image/B22396_02_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1406.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.9 – Mean target value per category of A7 after the encoding.</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1407.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker172"/><span class="koboSpan" id="kobo.1408.1" xmlns:="http://www.w3.org/1999/xhtml">perform ordered ordinal encoding </span><span class="No-Break"><span class="koboSpan" id="kobo.1409.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1410.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1411.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.1412.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><span class="No-Break"><span class="koboSpan" id="kobo.1413.1" xmlns:="http://www.w3.org/1999/xhtml">the encoder:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1414.1" xmlns:="http://www.w3.org/1999/xhtml">
from f</span><a id="_idTextAnchor271"/><span class="koboSpan" id="kobo.1415.1" xmlns:="http://www.w3.org/1999/xhtml">eature_engine.encoding import OrdinalEncoder</span></pre></li> <li><span class="koboSpan" id="kobo.1416.1" xmlns:="http://www.w3.org/1999/xhtml">Next, let’s set up the encoder so that it assigns integers based on the target mean value to all categorical variables in </span><span class="No-Break"><span class="koboSpan" id="kobo.1417.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1418.1" xmlns:="http://www.w3.org/1999/xhtml">
ordinal_enc = OrdinalEncoder(
    encoding_method="ordered",
    variables=None)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1419.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1420.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1421.1" xmlns:="http://www.w3.org/1999/xhtml"> will find and encode all categorical variables automatically. </span><span class="koboSpan" id="kobo.1421.2" xmlns:="http://www.w3.org/1999/xhtml">To restrict the encoding to a subset of variables, pass their names in a list to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1422.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1423.1" xmlns:="http://www.w3.org/1999/xhtml"> argument. </span><span class="koboSpan" id="kobo.1423.2" xmlns:="http://www.w3.org/1999/xhtml">To encode numerical variables, </span><span class="No-Break"><span class="koboSpan" id="kobo.1424.1" xmlns:="http://www.w3.org/1999/xhtml">set </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1425.1" xmlns:="http://www.w3.org/1999/xhtml">ignore_format=True</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1426.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.1427.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the encoder to the train set so that it finds the categorical variables, and then stores the </span><a id="_idIndexMarker173"/><span class="koboSpan" id="kobo.1428.1" xmlns:="http://www.w3.org/1999/xhtml">category and </span><span class="No-Break"><span class="koboSpan" id="kobo.1429.1" xmlns:="http://www.w3.org/1999/xhtml">integer m</span><a id="_idTextAnchor272"/><span class="koboSpan" id="kobo.1430.1" xmlns:="http://www.w3.org/1999/xhtml">appings:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1431.1" xmlns:="http://www.w3.org/1999/xhtml">
ordinal_enc.fit(X_train, y_train)</span></pre></li> <li><span class="koboSpan" id="kobo.1432.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s replace the categories with numbers in the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1433.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1434.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = ordinal_enc.transform(X_train)
X_test_enc = ordinal_enc.transform(X_test)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1435.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1436.1" xmlns:="http://www.w3.org/1999/xhtml">You’ll find the digits that will replace each category in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1437.1" xmlns:="http://www.w3.org/1999/xhtml">encoder_dict_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1438.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute.</span></span></p>
<p><span class="koboSpan" id="kobo.1439.1" xmlns:="http://www.w3.org/1999/xhtml">Check out the outp</span><a id="_idTextAnchor273"/><a id="_idTextAnchor274"/><span class="koboSpan" id="kobo.1440.1" xmlns:="http://www.w3.org/1999/xhtml">ut of the transformation by </span><span class="No-Break"><span class="koboSpan" id="kobo.1441.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1442.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc.head()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1443.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-79"><a id="_idTextAnchor275"/><span class="koboSpan" id="kobo.1444.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1445.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we replaced the categories with integers according to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1446.1" xmlns:="http://www.w3.org/1999/xhtml">target mean.</span></span></p>
<p><span class="koboSpan" id="kobo.1447.1" xmlns:="http://www.w3.org/1999/xhtml">In the first part of this recipe, we worked with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1448.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1449.1" xmlns:="http://www.w3.org/1999/xhtml"> categorical variable. </span><span class="koboSpan" id="kobo.1449.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1450.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1451.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1452.1" xmlns:="http://www.w3.org/1999/xhtml">groupby()</span></strong><span class="koboSpan" id="kobo.1453.1" xmlns:="http://www.w3.org/1999/xhtml">, we grouped the data based on the categories of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1454.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.1455.1" xmlns:="http://www.w3.org/1999/xhtml">, and with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1456.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1457.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1458.1" xmlns:="http://www.w3.org/1999/xhtml">mean()</span></strong><span class="koboSpan" id="kobo.1459.1" xmlns:="http://www.w3.org/1999/xhtml">, we determined the mean value of the target for each of those categories. </span><span class="koboSpan" id="kobo.1459.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we ordered the categories with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1460.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1461.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1462.1" xmlns:="http://www.w3.org/1999/xhtml">sort_values()</span></strong><span class="koboSpan" id="kobo.1463.1" xmlns:="http://www.w3.org/1999/xhtml"> from the ones with the lowest to the ones with the highest target mean response. </span><span class="koboSpan" id="kobo.1463.2" xmlns:="http://www.w3.org/1999/xhtml">The output of this operation was a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1464.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1465.1" xmlns:="http://www.w3.org/1999/xhtml"> series, with the categories as indices and the target mean as values. </span><span class="koboSpan" id="kobo.1465.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1466.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1467.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1468.1" xmlns:="http://www.w3.org/1999/xhtml">index</span></strong><span class="koboSpan" id="kobo.1469.1" xmlns:="http://www.w3.org/1999/xhtml">, we captured the ordered categories in an array; then, with Python dictionary comprehension, we created a dictionary of category-to-integer pairs. </span><span class="koboSpan" id="kobo.1469.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, we used this dictionary to replace the category with integers using </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1470.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1471.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1472.1" xmlns:="http://www.w3.org/1999/xhtml">map()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1473.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1474.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1475.1" xmlns:="http://www.w3.org/1999/xhtml">To avoid data leakage, we determine the ca</span><a id="_idTextAnchor276"/><span class="koboSpan" id="kobo.1476.1" xmlns:="http://www.w3.org/1999/xhtml">tegory-to-integer mappings from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1477.1" xmlns:="http://www.w3.org/1999/xhtml">train set.</span></span></p>
<p><span class="koboSpan" id="kobo.1478.1" xmlns:="http://www.w3.org/1999/xhtml">To perform the encoding with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1479.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1480.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1481.1" xmlns:="http://www.w3.org/1999/xhtml">OrdinalEncoder()</span></strong><span class="koboSpan" id="kobo.1482.1" xmlns:="http://www.w3.org/1999/xhtml">, setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1483.1" xmlns:="http://www.w3.org/1999/xhtml">encoding_method</span></strong><span class="koboSpan" id="kobo.1484.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1485.1" xmlns:="http://www.w3.org/1999/xhtml">ordered</span></strong><span class="koboSpan" id="kobo.1486.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1486.2" xmlns:="http://www.w3.org/1999/xhtml">We left the argument variables set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1487.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1488.1" xmlns:="http://www.w3.org/1999/xhtml"> so that the encoder automatically detects all categorical variables in the dataset. </span><span class="koboSpan" id="kobo.1488.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1489.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1490.1" xmlns:="http://www.w3.org/1999/xhtml">, the encoder</span><a id="_idIndexMarker174"/><span class="koboSpan" id="kobo.1491.1" xmlns:="http://www.w3.org/1999/xhtml"> found the categorical variables and assigned digits to their categories according to the target mean value. </span><span class="koboSpan" id="kobo.1491.2" xmlns:="http://www.w3.org/1999/xhtml">The categorical variables’ names and dictionaries with category-to-digit pairs were stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1492.1" xmlns:="http://www.w3.org/1999/xhtml">variables_</span></strong><span class="koboSpan" id="kobo.1493.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1494.1" xmlns:="http://www.w3.org/1999/xhtml">encoder_dict_</span></strong><span class="koboSpan" id="kobo.1495.1" xmlns:="http://www.w3.org/1999/xhtml"> attributes, respectively. </span><span class="koboSpan" id="kobo.1495.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1496.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1497.1" xmlns:="http://www.w3.org/1999/xhtml">, we replaced the categories with digit</span><a id="_idTextAnchor277"/><a id="_idTextAnchor278"/><span class="koboSpan" id="kobo.1498.1" xmlns:="http://www.w3.org/1999/xhtml">s in the train and test sets, returning </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1499.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1500.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrames.</span></span></p>
<h2 id="_idParaDest-80"><a id="_idTextAnchor279"/><span class="koboSpan" id="kobo.1501.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.1502.1" xmlns:="http://www.w3.org/1999/xhtml">For an implementation of this recipe with Category Encoders, visit this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.1503.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-05-Ordered-ordinal-encoding.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.1504.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-cate</span><span id="_idTextAnchor280"/><span id="_idTextAnchor281"/><span class="koboSpan" id="kobo.1505.1" xmlns:="http://www.w3.org/1999/xhtml">gorical-encoding/Recipe-05-Ordered-ordinal-encod</span><span id="_idTextAnchor282"/><span class="koboSpan" id="kobo.1506.1" xmlns:="http://www.w3.org/1999/xhtml">ing.ipynb</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1507.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-81"><a id="_idTextAnchor283"/><span class="koboSpan" id="kobo.1508.1" xmlns:="http://www.w3.org/1999/xhtml">Implementing target mean encoding</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.1509.1" xmlns:="http://www.w3.org/1999/xhtml">Mean encoding</span></strong><span class="koboSpan" id="kobo.1510.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><strong class="bold"><span class="koboSpan" id="kobo.1511.1" xmlns:="http://www.w3.org/1999/xhtml">target encoding</span></strong><span class="koboSpan" id="kobo.1512.1" xmlns:="http://www.w3.org/1999/xhtml"> maps </span><a id="_idIndexMarker175"/><span class="koboSpan" id="kobo.1513.1" xmlns:="http://www.w3.org/1999/xhtml">each category to the probability estimate of the target attribute. </span><span class="koboSpan" id="kobo.1513.2" xmlns:="http://www.w3.org/1999/xhtml">If the target is binary, the numerical mapping is the posterior probability of the target conditioned to the value of the category. </span><span class="koboSpan" id="kobo.1513.3" xmlns:="http://www.w3.org/1999/xhtml">If the target is continuous, the numerical representation is given by the expected value of the target given the value of </span><span class="No-Break"><span class="koboSpan" id="kobo.1514.1" xmlns:="http://www.w3.org/1999/xhtml">the category.</span></span></p>
<p><span class="koboSpan" id="kobo.1515.1" xmlns:="http://www.w3.org/1999/xhtml">In its simplest form, the</span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.1516.1" xmlns:="http://www.w3.org/1999/xhtml"> numerical representation for each category is given by the mean value of the target variable for a particular category group. </span><span class="koboSpan" id="kobo.1516.2" xmlns:="http://www.w3.org/1999/xhtml">For example, if we have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1517.1" xmlns:="http://www.w3.org/1999/xhtml">City</span></strong><span class="koboSpan" id="kobo.1518.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, with the categories of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1519.1" xmlns:="http://www.w3.org/1999/xhtml">London</span></strong><span class="koboSpan" id="kobo.1520.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1521.1" xmlns:="http://www.w3.org/1999/xhtml">Manchester</span></strong><span class="koboSpan" id="kobo.1522.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1523.1" xmlns:="http://www.w3.org/1999/xhtml">Bristol</span></strong><span class="koboSpan" id="kobo.1524.1" xmlns:="http://www.w3.org/1999/xhtml">, and we want to predict the default rate (the target takes values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1525.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.1526.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1527.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.1528.1" xmlns:="http://www.w3.org/1999/xhtml">); if the default rate for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1529.1" xmlns:="http://www.w3.org/1999/xhtml">London</span></strong><span class="koboSpan" id="kobo.1530.1" xmlns:="http://www.w3.org/1999/xhtml"> is 30%, we replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.1531.1" xmlns:="http://www.w3.org/1999/xhtml">London</span></strong><span class="koboSpan" id="kobo.1532.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1533.1" xmlns:="http://www.w3.org/1999/xhtml">0.3</span></strong><span class="koboSpan" id="kobo.1534.1" xmlns:="http://www.w3.org/1999/xhtml">; if the default rate for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1535.1" xmlns:="http://www.w3.org/1999/xhtml">Manchester</span></strong><span class="koboSpan" id="kobo.1536.1" xmlns:="http://www.w3.org/1999/xhtml"> is 20%, we replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.1537.1" xmlns:="http://www.w3.org/1999/xhtml">Manchester</span></strong><span class="koboSpan" id="kobo.1538.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><a id="_idTextAnchor284"/><strong class="source-inline"><span class="koboSpan" id="kobo.1539.1" xmlns:="http://www.w3.org/1999/xhtml">0.2</span></strong><span class="koboSpan" id="kobo.1540.1" xmlns:="http://www.w3.org/1999/xhtml">; and so on. </span><span class="koboSpan" id="kobo.1540.2" xmlns:="http://www.w3.org/1999/xhtml">If the target is continuous – say we want to predict income – then we would replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.1541.1" xmlns:="http://www.w3.org/1999/xhtml">London</span></strong><span class="koboSpan" id="kobo.1542.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1543.1" xmlns:="http://www.w3.org/1999/xhtml">Manchester</span></strong><span class="koboSpan" id="kobo.1544.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1545.1" xmlns:="http://www.w3.org/1999/xhtml">Bristol</span></strong><span class="koboSpan" id="kobo.1546.1" xmlns:="http://www.w3.org/1999/xhtml"> with the mean income earned in </span><span class="No-Break"><span class="koboSpan" id="kobo.1547.1" xmlns:="http://www.w3.org/1999/xhtml">each city.</span></span></p>
<p><span class="koboSpan" id="kobo.1548.1" xmlns:="http://www.w3.org/1999/xhtml">In mathematical terms, if the target is binary, the replacement value, </span><em class="italic"><span class="koboSpan" id="kobo.1549.1" xmlns:="http://www.w3.org/1999/xhtml">S</span></em><span class="koboSpan" id="kobo.1550.1" xmlns:="http://www.w3.org/1999/xhtml">, is determined </span><span class="No-Break"><span class="koboSpan" id="kobo.1551.1" xmlns:="http://www.w3.org/1999/xhtml">like so:</span></span></p>
<p><span class="koboSpan" id="kobo.1552.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot; display=&quot;block&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;S&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;i&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;mml:mo&gt;=&lt;/mml:mo&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;n&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;i&lt;/mml:mi&gt;&lt;mml:mo&gt;(&lt;/mml:mo&gt;&lt;mml:mi&gt;y&lt;/mml:mi&gt;&lt;mml:mo&gt;=&lt;/mml:mo&gt;&lt;mml:mn&gt;1&lt;/mml:mn&gt;&lt;mml:mo&gt;)&lt;/mml:mo&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;mml:mo&gt;/&lt;/mml:mo&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;n&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;i&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/1.png" style="vertical-align:-0.483em;height:1.147em;width:5.200em"/></span></p>
<p><span class="koboSpan" id="kobo.1553.1" xmlns:="http://www.w3.org/1999/xhtml">Here, the numerator is the number of observations with a target value of </span><em class="italic"><span class="koboSpan" id="kobo.1554.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></em><span class="koboSpan" id="kobo.1555.1" xmlns:="http://www.w3.org/1999/xhtml"> for category </span><em class="italic"><span class="koboSpan" id="kobo.1556.1" xmlns:="http://www.w3.org/1999/xhtml">i</span></em><span class="koboSpan" id="kobo.1557.1" xmlns:="http://www.w3.org/1999/xhtml"> and the denominator is the number of observations with a category value </span><span class="No-Break"><span class="koboSpan" id="kobo.1558.1" xmlns:="http://www.w3.org/1999/xhtml">of </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1559.1" xmlns:="http://www.w3.org/1999/xhtml">i</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1560.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1561.1" xmlns:="http://www.w3.org/1999/xhtml">If the target is continuous, </span><em class="italic"><span class="koboSpan" id="kobo.1562.1" xmlns:="http://www.w3.org/1999/xhtml">S</span></em><span class="koboSpan" id="kobo.1563.1" xmlns:="http://www.w3.org/1999/xhtml">, this is determined by the </span><span class="No-Break"><span class="koboSpan" id="kobo.1564.1" xmlns:="http://www.w3.org/1999/xhtml">following formula:</span></span></p>
<p><span class="koboSpan" id="kobo.1565.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;∑&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/2.png" style="vertical-align:-0.568em;height:1.834em;width:2.732em"/></span></p>
<p><span class="koboSpan" id="kobo.1566.1" xmlns:="http://www.w3.org/1999/xhtml">Here, the</span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.1567.1" xmlns:="http://www.w3.org/1999/xhtml"> numerator is the sum of the target across observations in category </span><em class="italic"><span class="koboSpan" id="kobo.1568.1" xmlns:="http://www.w3.org/1999/xhtml">i</span></em><span class="koboSpan" id="kobo.1569.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><span class="koboSpan" id="kobo.1570.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;n&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;i&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/3.png" style="vertical-align:-0.340em;height:0.788em;width:0.655em"/></span><span class="koboSpan" id="kobo.1571.1" xmlns:="http://www.w3.org/1999/xhtml"> is the total number of observations in </span><span class="No-Break"><span class="koboSpan" id="kobo.1572.1" xmlns:="http://www.w3.org/1999/xhtml">category </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1573.1" xmlns:="http://www.w3.org/1999/xhtml">i</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1574.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1575.1" xmlns:="http://www.w3.org/1999/xhtml">These formulas provide a good approximation of the target estimate if there is a sufficiently large number of observations with each category value – in other words, if </span><span class="koboSpan" id="kobo.1576.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;n&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;i&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/4.png" style="vertical-align:-0.340em;height:0.788em;width:0.701em"/></span><span class="koboSpan" id="kobo.1577.1" xmlns:="http://www.w3.org/1999/xhtml"> is large. </span><span class="koboSpan" id="kobo.1577.2" xmlns:="http://www.w3.org/1999/xhtml">However, in many datasets, there will be categories present in a few observations. </span><span class="koboSpan" id="kobo.1577.3" xmlns:="http://www.w3.org/1999/xhtml">In these cases, target estimates derived from the precedent formulas can </span><span class="No-Break"><span class="koboSpan" id="kobo.1578.1" xmlns:="http://www.w3.org/1999/xhtml">be unreliable.</span></span></p>
<p><span class="koboSpan" id="kobo.1579.1" xmlns:="http://www.w3.org/1999/xhtml">To mitigate poor estimates returned for rare categories, the target estimates can be determined as a mixture of two probabilities: those returned by the preceding formulas and the prior probability of the target based on the entire training. </span><span class="koboSpan" id="kobo.1579.2" xmlns:="http://www.w3.org/1999/xhtml">The two probabilities are </span><em class="italic"><span class="koboSpan" id="kobo.1580.1" xmlns:="http://www.w3.org/1999/xhtml">blended</span></em><span class="koboSpan" id="kobo.1581.1" xmlns:="http://www.w3.org/1999/xhtml"> using a weighting factor, which is a function of the category </span><span class="No-Break"><span class="koboSpan" id="kobo.1582.1" xmlns:="http://www.w3.org/1999/xhtml">group size:</span></span></p>
<p><span class="koboSpan" id="kobo.1583.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/5.png" style="vertical-align:-0.651em;height:1.810em;width:9.447em"/></span></p>
<p><span class="koboSpan" id="kobo.1584.1" xmlns:="http://www.w3.org/1999/xhtml">In this formula, </span><span class="koboSpan" id="kobo.1585.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;n&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi mathvariant=&quot;normal&quot;&gt;λ&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/6.png" style="vertical-align:-0.340em;height:0.788em;width:0.817em"/></span><span class="koboSpan" id="kobo.1586.1" xmlns:="http://www.w3.org/1999/xhtml"> is the total number of cases where the target takes a value of </span><em class="italic"><span class="koboSpan" id="kobo.1587.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></em><span class="koboSpan" id="kobo.1588.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><em class="italic"><span class="koboSpan" id="kobo.1589.1" xmlns:="http://www.w3.org/1999/xhtml">N</span></em><span class="koboSpan" id="kobo.1590.1" xmlns:="http://www.w3.org/1999/xhtml"> is the size of the train set, and </span><em class="italic"><span class="koboSpan" id="kobo.1591.1" xmlns:="http://www.w3.org/1999/xhtml">𝜆</span></em><span class="koboSpan" id="kobo.1592.1" xmlns:="http://www.w3.org/1999/xhtml"> is the </span><span class="No-Break"><span class="koboSpan" id="kobo.1593.1" xmlns:="http://www.w3.org/1999/xhtml">weighting factor.</span></span></p>
<p><span class="koboSpan" id="kobo.1594.1" xmlns:="http://www.w3.org/1999/xhtml">When the category group is large, </span><em class="italic"><span class="koboSpan" id="kobo.1595.1" xmlns:="http://www.w3.org/1999/xhtml">𝜆</span></em><span class="koboSpan" id="kobo.1596.1" xmlns:="http://www.w3.org/1999/xhtml"> tends to </span><em class="italic"><span class="koboSpan" id="kobo.1597.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></em><span class="koboSpan" id="kobo.1598.1" xmlns:="http://www.w3.org/1999/xhtml">, so more weight is given to the first term of the equation. </span><span class="koboSpan" id="kobo.1598.2" xmlns:="http://www.w3.org/1999/xhtml">When the category </span><a id="_idTextAnchor285"/><span class="koboSpan" id="kobo.1599.1" xmlns:="http://www.w3.org/1999/xhtml">group size is small, then </span><em class="italic"><span class="koboSpan" id="kobo.1600.1" xmlns:="http://www.w3.org/1999/xhtml">𝜆</span></em><span class="koboSpan" id="kobo.1601.1" xmlns:="http://www.w3.org/1999/xhtml"> tends to </span><em class="italic"><span class="koboSpan" id="kobo.1602.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></em><span class="koboSpan" id="kobo.1603.1" xmlns:="http://www.w3.org/1999/xhtml">, so the estimate is mostly driven by the second term of the equation – that is, the target’s prior probability. </span><span class="koboSpan" id="kobo.1603.2" xmlns:="http://www.w3.org/1999/xhtml">In other words, if the group size is small, knowing the value of the category does not tell us anything about the value of </span><span class="No-Break"><span class="koboSpan" id="kobo.1604.1" xmlns:="http://www.w3.org/1999/xhtml">the target.</span></span></p>
<p><span class="koboSpan" id="kobo.1605.1" xmlns:="http://www.w3.org/1999/xhtml">The weighting factor, </span><em class="italic"><span class="koboSpan" id="kobo.1606.1" xmlns:="http://www.w3.org/1999/xhtml">𝜆</span></em><span class="koboSpan" id="kobo.1607.1" xmlns:="http://www.w3.org/1999/xhtml">, is determined differently in different open-source implementations. </span><span class="koboSpan" id="kobo.1607.2" xmlns:="http://www.w3.org/1999/xhtml">In Category Encoders, </span><em class="italic"><span class="koboSpan" id="kobo.1608.1" xmlns:="http://www.w3.org/1999/xhtml">𝜆</span></em><span class="koboSpan" id="kobo.1609.1" xmlns:="http://www.w3.org/1999/xhtml"> is a function of the group size, </span><em class="italic"><span class="koboSpan" id="kobo.1610.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.1611.1" xmlns:="http://www.w3.org/1999/xhtml">, and a smoothing parameter, </span><em class="italic"><span class="koboSpan" id="kobo.1612.1" xmlns:="http://www.w3.org/1999/xhtml">f</span></em><span class="koboSpan" id="kobo.1613.1" xmlns:="http://www.w3.org/1999/xhtml">, which controls the rate of transition between the first </span><a id="_idTextAnchor286"/><span class="koboSpan" id="kobo.1614.1" xmlns:="http://www.w3.org/1999/xhtml">and second term of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1615.1" xmlns:="http://www.w3.org/1999/xhtml">preceding equation:</span></span></p>
<p><span class="koboSpan" id="kobo.1616.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/7.png" style="vertical-align:-0.543em;height:1.508em;width:4.858em"/></span></p>
<p><span class="koboSpan" id="kobo.1617.1" xmlns:="http://www.w3.org/1999/xhtml">Here, </span><em class="italic"><span class="koboSpan" id="kobo.1618.1" xmlns:="http://www.w3.org/1999/xhtml">k</span></em><span class="koboSpan" id="kobo.1619.1" xmlns:="http://www.w3.org/1999/xhtml"> is half of the minimal size for which we </span><em class="italic"><span class="koboSpan" id="kobo.1620.1" xmlns:="http://www.w3.org/1999/xhtml">fully trust</span></em><span class="koboSpan" id="kobo.1621.1" xmlns:="http://www.w3.org/1999/xhtml"> the first term of the equation. </span><span class="koboSpan" id="kobo.1621.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><em class="italic"><span class="koboSpan" id="kobo.1622.1" xmlns:="http://www.w3.org/1999/xhtml">f</span></em><span class="koboSpan" id="kobo.1623.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter is selected by the user either arbitrarily or </span><span class="No-Break"><span class="koboSpan" id="kobo.1624.1" xmlns:="http://www.w3.org/1999/xhtml">with optimization.</span></span></p>
<p><span class="koboSpan" id="kobo.1625.1" xmlns:="http://www.w3.org/1999/xhtml">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.1626.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1627.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1628.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1629.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><em class="italic"><span class="koboSpan" id="kobo.1630.1" xmlns:="http://www.w3.org/1999/xhtml">𝜆</span></em><span class="koboSpan" id="kobo.1631.1" xmlns:="http://www.w3.org/1999/xhtml"> is a function of the target variance for the entire dataset and within the category, and is determined </span><span class="No-Break"><span class="koboSpan" id="kobo.1632.1" xmlns:="http://www.w3.org/1999/xhtml">as follows:</span></span></p>
<p><span class="koboSpan" id="kobo.1633.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;λ&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;×&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;×&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/8.png" style="vertical-align:-0.451em;height:1.430em;width:4.673em"/></span></p>
<p><span class="koboSpan" id="kobo.1634.1" xmlns:="http://www.w3.org/1999/xhtml">Here, </span><em class="italic"><span class="koboSpan" id="kobo.1635.1" xmlns:="http://www.w3.org/1999/xhtml">t</span></em><span class="koboSpan" id="kobo.1636.1" xmlns:="http://www.w3.org/1999/xhtml"> is the target</span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.1637.1" xmlns:="http://www.w3.org/1999/xhtml"> variance in the entire dataset and </span><em class="italic"><span class="koboSpan" id="kobo.1638.1" xmlns:="http://www.w3.org/1999/xhtml">s</span></em><span class="koboSpan" id="kobo.1639.1" xmlns:="http://www.w3.org/1999/xhtml"> is the target variance within the category. </span><span class="koboSpan" id="kobo.1639.2" xmlns:="http://www.w3.org/1999/xhtml">Both implementations are equivalent, but it is important to know the equations because they will help you set up the parameters in </span><span class="No-Break"><span class="koboSpan" id="kobo.1640.1" xmlns:="http://www.w3.org/1999/xhtml">the transformers.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1641.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1642.1" xmlns:="http://www.w3.org/1999/xhtml">Mean encoding was designed to encode highly cardinal categorical variables without expanding the feature space. </span><span class="koboSpan" id="kobo.1642.2" xmlns:="http://www.w3.org/1999/xhtml">For more details, check out the following article: Micci-Barreca D. </span><span class="koboSpan" id="kobo.1642.3" xmlns:="http://www.w3.org/1999/xhtml">A., </span><em class="italic"><span class="koboSpan" id="kobo.1643.1" xmlns:="http://www.w3.org/1999/xhtml">Preprocessing Scheme for High-Cardinality Categorical Attributes in Classification and Prediction Problems</span></em><span class="koboSpan" id="kobo.1644.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1644.2" xmlns:="http://www.w3.org/1999/xhtml">ACM SIGKDD Explorations </span><span class="No-Break"><span class="koboSpan" id="kobo.1645.1" xmlns:="http://www.w3.org/1999/xhtml">Newsletter, 2001.</span></span></p>
<p><span class="koboSpan" id="kobo.1646.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will perf</span><a id="_idTextAnchor287"/><a id="_idTextAnchor288"/><span class="koboSpan" id="kobo.1647.1" xmlns:="http://www.w3.org/1999/xhtml">orm mean encoding using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1648.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1649.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1650.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1651.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-82"><a id="_idTextAnchor289"/><span class="koboSpan" id="kobo.1652.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1653.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin with </span><span class="No-Break"><span class="koboSpan" id="kobo.1654.1" xmlns:="http://www.w3.org/1999/xhtml">this recipe:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1655.1" xmlns:="http://www.w3.org/1999/xhtml">Import </span><strong class="source-inline"><span class="koboSpan" id="kobo.1656.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1657.1" xmlns:="http://www.w3.org/1999/xhtml"> and the data </span><span class="No-Break"><span class="koboSpan" id="kobo.1658.1" xmlns:="http://www.w3.org/1999/xhtml">split function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1659.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split</span></pre></li> <li><span class="koboSpan" id="kobo.1660.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the Credit Approval dataset and divide it into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1661.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1662.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1663.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the transformers </span><span class="No-Break"><span class="koboSpan" id="kobo.1664.1" xmlns:="http://www.w3.org/1999/xhtml">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1665.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1666.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1667.1" xmlns:="http://www.w3.org/1999/xhtml">
from sklearn.preprocessing import TargetEncoder
from sklearn.compose import ColumnTransformer</span></pre></li> <li><span class="koboSpan" id="kobo.1668.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.1669.1" xmlns:="http://www.w3.org/1999/xhtml">make a list with the names of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1670.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1671.1" xmlns:="http://www.w3.org/1999/xhtml">
cat_vars = X_train.select_dtypes(
    include="O").columns.to_list()</span></pre></li> <li><span class="koboSpan" id="kobo.1672.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the encoder to use the target variance to determine the weighting factor, as described at the beginning of </span><span class="No-Break"><span class="koboSpan" id="kobo.1673.1" xmlns:="http://www.w3.org/1999/xhtml">the recipe:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1674.1" xmlns:="http://www.w3.org/1999/xhtml">
enc = TargetEncoder(smooth="auto", random_state=9)</span></pre></li> <li><span class="koboSpan" id="kobo.1675.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s restrict the imputation to </span><span class="No-Break"><span class="koboSpan" id="kobo.1676.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1677.1" xmlns:="http://www.w3.org/1999/xhtml">
ct = ColumnTransformer(
    [("encoder", enc, cat_vars)],
    remainder="passthrough",
).set_output(transform="pandas")</span></pre></li> <li><span class="koboSpan" id="kobo.1678.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the encoder and transform </span><span class="No-Break"><span class="koboSpan" id="kobo.1679.1" xmlns:="http://www.w3.org/1999/xhtml">the datasets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1680.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = ct.fit_transform(X_train, y_train)
X_test_enc = ct.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1681.1" xmlns:="http://www.w3.org/1999/xhtml">Check out the result by </span><span class="No-Break"><span class="koboSpan" id="kobo.1682.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1683.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc.head()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1684.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1685.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1686.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1687.1" xmlns:="http://www.w3.org/1999/xhtml">fit_transform()</span></strong><span class="koboSpan" id="kobo.1688.1" xmlns:="http://www.w3.org/1999/xhtml"> method of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1689.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1690.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1691.1" xmlns:="http://www.w3.org/1999/xhtml">TargetEncoder()</span></strong><span class="koboSpan" id="kobo.1692.1" xmlns:="http://www.w3.org/1999/xhtml"> is not equivalent to applying </span><strong class="source-inline"><span class="koboSpan" id="kobo.1693.1" xmlns:="http://www.w3.org/1999/xhtml">fit().transform()</span></strong><span class="koboSpan" id="kobo.1694.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1694.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1695.1" xmlns:="http://www.w3.org/1999/xhtml">fit_transform()</span></strong><span class="koboSpan" id="kobo.1696.1" xmlns:="http://www.w3.org/1999/xhtml">, the resulting dataset is encoded based on partial fits over the training folds of a cross-validation scheme. </span><span class="koboSpan" id="kobo.1696.2" xmlns:="http://www.w3.org/1999/xhtml">This functionality was intentionally designed to prevent overfitting the machine learning model to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1697.1" xmlns:="http://www.w3.org/1999/xhtml">train set.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1698.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s perform target encoding </span><span class="No-Break"><span class="koboSpan" id="kobo.1699.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1700.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1701.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.1702.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import</span><a id="_idIndexMarker180"/> <span class="No-Break"><span class="koboSpan" id="kobo.1703.1" xmlns:="http://www.w3.org/1999/xhtml">the encoder:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1704.1" xmlns:="http://www.w3.org/1999/xhtml">
from feature_engine.encoding import MeanEncoder</span></pre></li> <li><span class="koboSpan" id="kobo.1705.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the target mean encoder to encode all categorical variables while </span><span class="No-Break"><span class="koboSpan" id="kobo.1706.1" xmlns:="http://www.w3.org/1999/xhtml">applying smoothing:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1707.1" xmlns:="http://www.w3.org/1999/xhtml">
mean_enc = MeanEncoder(smoothing="auto",
    variables=None)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1708.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1709.1" xmlns:="http://www.w3.org/1999/xhtml">MeanEncoder()</span></strong><span class="koboSpan" id="kobo.1710.1" xmlns:="http://www.w3.org/1999/xhtml"> does not apply smoothing by default. </span><span class="koboSpan" id="kobo.1710.2" xmlns:="http://www.w3.org/1999/xhtml">Make sure you set it to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1711.1" xmlns:="http://www.w3.org/1999/xhtml">auto</span></strong><span class="koboSpan" id="kobo.1712.1" xmlns:="http://www.w3.org/1999/xhtml"> or to an integer to control the blend b</span><a id="_idTextAnchor290"/><span class="koboSpan" id="kobo.1713.1" xmlns:="http://www.w3.org/1999/xhtml">etween prior and posterior </span><span class="No-Break"><span class="koboSpan" id="kobo.1714.1" xmlns:="http://www.w3.org/1999/xhtml">target estimates.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.1715.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the transformer to the train set so that it learns and stores the mean target value per category </span><span class="No-Break"><span class="koboSpan" id="kobo.1716.1" xmlns:="http://www.w3.org/1999/xhtml">per variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1717.1" xmlns:="http://www.w3.org/1999/xhtml">
mean_enc.fit(X_train, y_train)</span></pre></li> <li><span class="koboSpan" id="kobo.1718.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s encode the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1719.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1720.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = mean_enc.transform(X_train)
X_test_enc = mean_enc.transform(X_test)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1721.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1722.1" xmlns:="http://www.w3.org/1999/xhtml">The category-to-number pairs are stored as a dictionary of dictionaries in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1723.1" xmlns:="http://www.w3.org/1999/xhtml">encoder_dict_</span></strong><span class="koboSpan" id="kobo.1724.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.1724.2" xmlns:="http://www.w3.org/1999/xhtml">To disp</span><a id="_idTextAnchor291"/><a id="_idTextAnchor292"/><span class="koboSpan" id="kobo.1725.1" xmlns:="http://www.w3.org/1999/xhtml">lay the stored parameters, </span><span class="No-Break"><span class="koboSpan" id="kobo.1726.1" xmlns:="http://www.w3.org/1999/xhtml">execute </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1727.1" xmlns:="http://www.w3.org/1999/xhtml">mean_enc.encoder_dict_.</span></strong></span></p>
<h2 id="_idParaDest-83"><a id="_idTextAnchor293"/><span class="koboSpan" id="kobo.1728.1" xmlns:="http://www.w3.org/1999/xhtml">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.1729.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we</span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.1730.1" xmlns:="http://www.w3.org/1999/xhtml"> replaced the categories with the mean target value using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1731.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1732.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1733.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1734.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1735.1" xmlns:="http://www.w3.org/1999/xhtml">To encode with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1736.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1737.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1738.1" xmlns:="http://www.w3.org/1999/xhtml">TargetEncoder()</span></strong><span class="koboSpan" id="kobo.1739.1" xmlns:="http://www.w3.org/1999/xhtml">, leaving the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1740.1" xmlns:="http://www.w3.org/1999/xhtml">smooth</span></strong><span class="koboSpan" id="kobo.1741.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to its default value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1742.1" xmlns:="http://www.w3.org/1999/xhtml">auto</span></strong><span class="koboSpan" id="kobo.1743.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1743.2" xmlns:="http://www.w3.org/1999/xhtml">Like this, the transformer used the target variance to determine the weighting factor for the blend of probabilities. </span><span class="koboSpan" id="kobo.1743.3" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1744.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1745.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer learned the value it should use to replace the categories, and with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1746.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1747.1" xmlns:="http://www.w3.org/1999/xhtml">, it replaced </span><span class="No-Break"><span class="koboSpan" id="kobo.1748.1" xmlns:="http://www.w3.org/1999/xhtml">the categories.</span></span></p>
<p><span class="koboSpan" id="kobo.1749.1" xmlns:="http://www.w3.org/1999/xhtml">Note that for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1750.1" xmlns:="http://www.w3.org/1999/xhtml">TargetEncoder()</span></strong><span class="koboSpan" id="kobo.1751.1" xmlns:="http://www.w3.org/1999/xhtml">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1752.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1753.1" xmlns:="http://www.w3.org/1999/xhtml"> method followed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1754.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1755.1" xmlns:="http://www.w3.org/1999/xhtml"> do not return the same dataset as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1756.1" xmlns:="http://www.w3.org/1999/xhtml">fit_transform()</span></strong><span class="koboSpan" id="kobo.1757.1" xmlns:="http://www.w3.org/1999/xhtml">method. </span><span class="koboSpan" id="kobo.1757.2" xmlns:="http://www.w3.org/1999/xhtml">The latter encodes the training set based on mappings found with cross-validation. </span><span class="koboSpan" id="kobo.1757.3" xmlns:="http://www.w3.org/1999/xhtml">The idea is to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1758.1" xmlns:="http://www.w3.org/1999/xhtml">fit_transform()</span></strong><span class="koboSpan" id="kobo.1759.1" xmlns:="http://www.w3.org/1999/xhtml"> within a pipeline, so the machine learning model does not overfit. </span><span class="koboSpan" id="kobo.1759.2" xmlns:="http://www.w3.org/1999/xhtml">However, and here is where it gets confusing, the mappings stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1760.1" xmlns:="http://www.w3.org/1999/xhtml">encodings_</span></strong><span class="koboSpan" id="kobo.1761.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute are the same after </span><strong class="source-inline"><span class="koboSpan" id="kobo.1762.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1763.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1764.1" xmlns:="http://www.w3.org/1999/xhtml">fit_transform()</span></strong><span class="koboSpan" id="kobo.1765.1" xmlns:="http://www.w3.org/1999/xhtml">, and this is done intentionally so that when we apply </span><strong class="source-inline"><span class="koboSpan" id="kobo.1766.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1767.1" xmlns:="http://www.w3.org/1999/xhtml"> to a new dataset, we obtain the same result regardless of whether we apply </span><strong class="source-inline"><span class="koboSpan" id="kobo.1768.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1769.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1770.1" xmlns:="http://www.w3.org/1999/xhtml">fit_transform()</span></strong><span class="koboSpan" id="kobo.1771.1" xmlns:="http://www.w3.org/1999/xhtml">to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1772.1" xmlns:="http://www.w3.org/1999/xhtml">training set.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1773.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1774.1" xmlns:="http://www.w3.org/1999/xhtml">Unseen categories are encoded with the target mean by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1775.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1776.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1777.1" xmlns:="http://www.w3.org/1999/xhtml">TargetEncoder()</span></strong><span class="koboSpan" id="kobo.1778.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1779.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1780.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1781.1" xmlns:="http://www.w3.org/1999/xhtml">MeanEncoder()</span></strong><span class="koboSpan" id="kobo.1782.1" xmlns:="http://www.w3.org/1999/xhtml"> can either return an error, replace the unseen categories with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1783.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.1784.1" xmlns:="http://www.w3.org/1999/xhtml">, or with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1785.1" xmlns:="http://www.w3.org/1999/xhtml">target mean.</span></span></p>
<p><span class="koboSpan" id="kobo.1786.1" xmlns:="http://www.w3.org/1999/xhtml">To perform the target encoding with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1787.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1788.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1789.1" xmlns:="http://www.w3.org/1999/xhtml">MeanEncoder(),</span></strong><span class="koboSpan" id="kobo.1790.1" xmlns:="http://www.w3.org/1999/xhtml"> setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1791.1" xmlns:="http://www.w3.org/1999/xhtml">smoothing</span></strong><span class="koboSpan" id="kobo.1792.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1793.1" xmlns:="http://www.w3.org/1999/xhtml">auto</span></strong><span class="koboSpan" id="kobo.1794.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1794.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1795.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1796.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer found and stored the categorical variables and the values to encode each category. </span><span class="koboSpan" id="kobo.1796.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1797.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1798.1" xmlns:="http://www.w3.org/1999/xhtml">, it replace</span><a id="_idTextAnchor294"/><a id="_idTextAnchor295"/><span class="koboSpan" id="kobo.1799.1" xmlns:="http://www.w3.org/1999/xhtml">d the categories with numbers, returning </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1800.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1801.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrames.</span></span></p>
<h2 id="_idParaDest-84"><a id="_idTextAnchor296"/><span class="koboSpan" id="kobo.1802.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.1803.1" xmlns:="http://www.w3.org/1999/xhtml">If you want to implement target encoding with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1804.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1805.1" xmlns:="http://www.w3.org/1999/xhtml"> or Category Encoders, check out the notebook in the accompanying GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.1806.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-06-Target-mean-encoding.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.1807.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-06-Target-mean-encoding.ipynb</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1808.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1809.1" xmlns:="http://www.w3.org/1999/xhtml">There is an alternative way to return </span><em class="italic"><span class="koboSpan" id="kobo.1810.1" xmlns:="http://www.w3.org/1999/xhtml">better</span></em><span class="koboSpan" id="kobo.1811.1" xmlns:="http://www.w3.org/1999/xhtml"> target estimates when the category groups are small. </span><span class="koboSpan" id="kobo.1811.2" xmlns:="http://www.w3.org/1999/xhtml">The replacement valu</span><a id="_idTextAnchor297"/><span class="koboSpan" id="kobo.1812.1" xmlns:="http://www.w3.org/1999/xhtml">e for each category is determined </span><span class="No-Break"><span class="koboSpan" id="kobo.1813.1" xmlns:="http://www.w3.org/1999/xhtml">as follows:</span></span></p>
<p><span class="koboSpan" id="kobo.1814.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mfenced open=&quot;(&quot; close=&quot;)&quot;&gt;&lt;mrow&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/9.png" style="vertical-align:-0.600em;height:1.884em;width:6.799em"/></span></p>
<p><span class="koboSpan" id="kobo.1815.1" xmlns:="http://www.w3.org/1999/xhtml">Here, </span><span class="koboSpan" id="kobo.1816.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/10.png" style="vertical-align:-0.415em;height:0.863em;width:2.452em"/></span><span class="koboSpan" id="kobo.1817.1" xmlns:="http://www.w3.org/1999/xhtml">is the target mean for category </span><em class="italic"><span class="koboSpan" id="kobo.1818.1" xmlns:="http://www.w3.org/1999/xhtml">i</span></em><span class="koboSpan" id="kobo.1819.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><span class="koboSpan" id="kobo.1820.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;n&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;i&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/11.png" style="vertical-align:-0.340em;height:0.788em;width:0.672em"/></span><span class="koboSpan" id="kobo.1821.1" xmlns:="http://www.w3.org/1999/xhtml"> is the number of observations with category </span><em class="italic"><span class="koboSpan" id="kobo.1822.1" xmlns:="http://www.w3.org/1999/xhtml">i</span></em><span class="koboSpan" id="kobo.1823.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1823.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.1824.1" xmlns:="http://www.w3.org/1999/xhtml">target prior is given by </span><em class="italic"><span class="koboSpan" id="kobo.1825.1" xmlns:="http://www.w3.org/1999/xhtml">pY</span></em><span class="koboSpan" id="kobo.1826.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><em class="italic"><span class="koboSpan" id="kobo.1827.1" xmlns:="http://www.w3.org/1999/xhtml">m</span></em><span class="koboSpan" id="kobo.1828.1" xmlns:="http://www.w3.org/1999/xhtml"> is the weighting factor. </span><span class="koboSpan" id="kobo.1828.2" xmlns:="http://www.w3.org/1999/xhtml">With this adjustment, the only parameter that we have </span><a id="_idTextAnchor298"/><span class="koboSpan" id="kobo.1829.1" xmlns:="http://www.w3.org/1999/xhtml">to set is the weight, </span><em class="italic"><span class="koboSpan" id="kobo.1830.1" xmlns:="http://www.w3.org/1999/xhtml">m</span></em><span class="koboSpan" id="kobo.1831.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1831.2" xmlns:="http://www.w3.org/1999/xhtml">If </span><em class="italic"><span class="koboSpan" id="kobo.1832.1" xmlns:="http://www.w3.org/1999/xhtml">m</span></em><span class="koboSpan" id="kobo.1833.1" xmlns:="http://www.w3.org/1999/xhtml"> is large, then more importance is given to the target’s prior probability. </span><span class="koboSpan" id="kobo.1833.2" xmlns:="http://www.w3.org/1999/xhtml">This adjustment affects target estimates for all categories but mostly for those with fewer observations because, in such cases, </span><em class="italic"><span class="koboSpan" id="kobo.1834.1" xmlns:="http://www.w3.org/1999/xhtml">m</span></em><span class="koboSpan" id="kobo.1835.1" xmlns:="http://www.w3.org/1999/xhtml"> could be much larger than </span><span class="koboSpan" id="kobo.1836.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;n&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;i&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/12.png" style="vertical-align:-0.340em;height:0.788em;width:0.683em"/></span><span class="koboSpan" id="kobo.1837.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1838.1" xmlns:="http://www.w3.org/1999/xhtml">formula’s denominator.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1839.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1840.1" xmlns:="http://www.w3.org/1999/xhtml">This method is a good alternative to Category Encoders’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1841.1" xmlns:="http://www.w3.org/1999/xhtml">TargetEncoder()</span></strong><span class="koboSpan" id="kobo.1842.1" xmlns:="http://www.w3.org/1999/xhtml"> because, in Category Encoders’ implementation of target encoding, we need to optimize two parameters instead of one (as we did with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1843.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1844.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1845.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1846.1" xmlns:="http://www.w3.org/1999/xhtml">) to control </span><span class="No-Break"><span class="koboSpan" id="kobo.1847.1" xmlns:="http://www.w3.org/1999/xhtml">the smoothing.</span></span></p>
<p><span class="koboSpan" id="kobo.1848.1" xmlns:="http://www.w3.org/1999/xhtml">For an implementation of this encoding method using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1849.1" xmlns:="http://www.w3.org/1999/xhtml">MEstimateEncoder()</span></strong><span class="koboSpan" id="kobo.1850.1" xmlns:="http://www.w3.org/1999/xhtml">, visit this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.1851.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-06-Target-mean-encoding.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.1852.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-06-Target-mean-encoding.ipynb</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1853.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-85"><span class="koboSpan" id="kobo.1854.1" xmlns:="http://www.w3.org/1999/xhtml">E</span><a id="_idTextAnchor299"/><span class="koboSpan" id="kobo.1855.1" xmlns:="http://www.w3.org/1999/xhtml">ncoding with Weight of E</span><a id="_idTextAnchor300"/><span class="koboSpan" id="kobo.1856.1" xmlns:="http://www.w3.org/1999/xhtml">vidence</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.1857.1" xmlns:="http://www.w3.org/1999/xhtml">Weight of Evidence</span></strong><span class="koboSpan" id="kobo.1858.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1859.1" xmlns:="http://www.w3.org/1999/xhtml">WoE</span></strong><span class="koboSpan" id="kobo.1860.1" xmlns:="http://www.w3.org/1999/xhtml">) was</span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.1861.1" xmlns:="http://www.w3.org/1999/xhtml"> developed primarily for credit and financial industries to facilitate variable screening and exploratory </span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.1862.1" xmlns:="http://www.w3.org/1999/xhtml">analysis and to build more predictive linear models to evaluate the risk of </span><span class="No-Break"><span class="koboSpan" id="kobo.1863.1" xmlns:="http://www.w3.org/1999/xhtml">loan defaults.</span></span></p>
<p><span class="koboSpan" id="kobo.1864.1" xmlns:="http://www.w3.org/1999/xhtml">The WoE is computed from the basic </span><span class="No-Break"><span class="koboSpan" id="kobo.1865.1" xmlns:="http://www.w3.org/1999/xhtml">odds ratio:</span></span></p>
<p><span class="koboSpan" id="kobo.1866.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;WoE&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/13.png" style="vertical-align:-0.675em;height:1.858em;width:14.321em"/></span></p>
<p><span class="koboSpan" id="kobo.1867.1" xmlns:="http://www.w3.org/1999/xhtml">Here, positive and negative refer to the values of the target being </span><em class="italic"><span class="koboSpan" id="kobo.1868.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></em><span class="koboSpan" id="kobo.1869.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><em class="italic"><span class="koboSpan" id="kobo.1870.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></em><span class="koboSpan" id="kobo.1871.1" xmlns:="http://www.w3.org/1999/xhtml">, respectively. </span><span class="koboSpan" id="kobo.1871.2" xmlns:="http://www.w3.org/1999/xhtml">The proportion of positive cases per category is determined as the sum of positive cases per category group divided by the total positive cases in the training set. </span><span class="koboSpan" id="kobo.1871.3" xmlns:="http://www.w3.org/1999/xhtml">The proportion of negative </span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.1872.1" xmlns:="http://www.w3.org/1999/xhtml">cases per category is determined as the sum of negative cases per category group divided by the total number of negative observations in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1873.1" xmlns:="http://www.w3.org/1999/xhtml">training set.</span></span></p>
<p><span class="koboSpan" id="kobo.1874.1" xmlns:="http://www.w3.org/1999/xhtml">WoE has the </span><span class="No-Break"><span class="koboSpan" id="kobo.1875.1" xmlns:="http://www.w3.org/1999/xhtml">following characteristics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1876.1" xmlns:="http://www.w3.org/1999/xhtml">WoE = </span><em class="italic"><span class="koboSpan" id="kobo.1877.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></em><span class="koboSpan" id="kobo.1878.1" xmlns:="http://www.w3.org/1999/xhtml"> if </span><em class="italic"><span class="koboSpan" id="kobo.1879.1" xmlns:="http://www.w3.org/1999/xhtml">p(positive)</span></em><span class="koboSpan" id="kobo.1880.1" xmlns:="http://www.w3.org/1999/xhtml"> / </span><em class="italic"><span class="koboSpan" id="kobo.1881.1" xmlns:="http://www.w3.org/1999/xhtml">p(negative)</span></em><span class="koboSpan" id="kobo.1882.1" xmlns:="http://www.w3.org/1999/xhtml"> = </span><em class="italic"><span class="koboSpan" id="kobo.1883.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></em><span class="koboSpan" id="kobo.1884.1" xmlns:="http://www.w3.org/1999/xhtml">; that is, if the outcome </span><span class="No-Break"><span class="koboSpan" id="kobo.1885.1" xmlns:="http://www.w3.org/1999/xhtml">is random</span></span></li>
<li><span class="koboSpan" id="kobo.1886.1" xmlns:="http://www.w3.org/1999/xhtml">WoE &gt; </span><em class="italic"><span class="koboSpan" id="kobo.1887.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></em><span class="koboSpan" id="kobo.1888.1" xmlns:="http://www.w3.org/1999/xhtml"> if </span><em class="italic"><span class="koboSpan" id="kobo.1889.1" xmlns:="http://www.w3.org/1999/xhtml">p(positive)</span></em><span class="koboSpan" id="kobo.1890.1" xmlns:="http://www.w3.org/1999/xhtml"> &gt; </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1891.1" xmlns:="http://www.w3.org/1999/xhtml">p(negative)</span></em></span></li>
<li><span class="koboSpan" id="kobo.1892.1" xmlns:="http://www.w3.org/1999/xhtml">WoE &lt; </span><em class="italic"><span class="koboSpan" id="kobo.1893.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></em><span class="koboSpan" id="kobo.1894.1" xmlns:="http://www.w3.org/1999/xhtml"> if </span><em class="italic"><span class="koboSpan" id="kobo.1895.1" xmlns:="http://www.w3.org/1999/xhtml">p(negative)</span></em><span class="koboSpan" id="kobo.1896.1" xmlns:="http://www.w3.org/1999/xhtml"> &gt; </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1897.1" xmlns:="http://www.w3.org/1999/xhtml">p(positive)</span></em></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1898.1" xmlns:="http://www.w3.org/1999/xhtml">This allows us to directly visualize the predictive power of the category in the variable: the higher the WoE, the more likely the event will occur. </span><span class="koboSpan" id="kobo.1898.2" xmlns:="http://www.w3.org/1999/xhtml">If the WoE is positive, the event is likely </span><span class="No-Break"><span class="koboSpan" id="kobo.1899.1" xmlns:="http://www.w3.org/1999/xhtml">to occur.</span></span></p>
<p><span class="koboSpan" id="kobo.1900.1" xmlns:="http://www.w3.org/1999/xhtml">Logistic regression models a binary response, </span><em class="italic"><span class="koboSpan" id="kobo.1901.1" xmlns:="http://www.w3.org/1999/xhtml">Y</span></em><span class="koboSpan" id="kobo.1902.1" xmlns:="http://www.w3.org/1999/xhtml">, based on </span><em class="italic"><span class="koboSpan" id="kobo.1903.1" xmlns:="http://www.w3.org/1999/xhtml">X</span></em><span class="koboSpan" id="kobo.1904.1" xmlns:="http://www.w3.org/1999/xhtml"> predictor variables, assuming that there is a linear relationship between </span><em class="italic"><span class="koboSpan" id="kobo.1905.1" xmlns:="http://www.w3.org/1999/xhtml">X</span></em><span class="koboSpan" id="kobo.1906.1" xmlns:="http://www.w3.org/1999/xhtml"> and the log of odds </span><span class="No-Break"><span class="koboSpan" id="kobo.1907.1" xmlns:="http://www.w3.org/1999/xhtml">of </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1908.1" xmlns:="http://www.w3.org/1999/xhtml">Y</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1909.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<p><span class="koboSpan" id="kobo.1910.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mfenced open=&quot;(&quot; close=&quot;)&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mfenced open=&quot;(&quot; close=&quot;)&quot;&gt;&lt;mrow&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mfenced open=&quot;(&quot; close=&quot;)&quot;&gt;&lt;mrow&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfenced&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mfenced&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/14.png" style="vertical-align:-0.756em;height:2.039em;width:16.998em"/></span></p>
<p><span class="koboSpan" id="kobo.1911.1" xmlns:="http://www.w3.org/1999/xhtml">Here, </span><em class="italic"><span class="koboSpan" id="kobo.1912.1" xmlns:="http://www.w3.org/1999/xhtml">log (p(Y=1)/p(Y=0))</span></em><span class="koboSpan" id="kobo.1913.1" xmlns:="http://www.w3.org/1999/xhtml"> is the log of odds. </span><span class="koboSpan" id="kobo.1913.2" xmlns:="http://www.w3.org/1999/xhtml">As you can see, the WoE encodes the categories in the same scale – that is, the log of odds – as the outcome of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1914.1" xmlns:="http://www.w3.org/1999/xhtml">logistic regression.</span></span></p>
<p><span class="koboSpan" id="kobo.1915.1" xmlns:="http://www.w3.org/1999/xhtml">Therefore, by using WoE, the predictors are prepared and coded on the same scale, and the parameters in the logistic regression model – that is, the coefficients – can be </span><span class="No-Break"><span class="koboSpan" id="kobo.1916.1" xmlns:="http://www.w3.org/1999/xhtml">directly compared.</span></span></p>
<p><span class="koboSpan" id="kobo.1917.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe</span><a id="_idTextAnchor301"/><a id="_idTextAnchor302"/><span class="koboSpan" id="kobo.1918.1" xmlns:="http://www.w3.org/1999/xhtml">, we will perform WoE encoding using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1919.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1920.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1921.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1922.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-86"><a id="_idTextAnchor303"/><span class="koboSpan" id="kobo.1923.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1924.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by making some imports and preparing </span><span class="No-Break"><span class="koboSpan" id="kobo.1925.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1926.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.1927.1" xmlns:="http://www.w3.org/1999/xhtml">and functions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1928.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split</span></pre></li> <li><span class="koboSpan" id="kobo.1929.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load </span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.1930.1" xmlns:="http://www.w3.org/1999/xhtml">the Credit Approval dataset and divide it into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1931.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1932.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1933.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s get the inverse of the target values to be able to calculate the </span><span class="No-Break"><span class="koboSpan" id="kobo.1934.1" xmlns:="http://www.w3.org/1999/xhtml">negative cases:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1935.1" xmlns:="http://www.w3.org/1999/xhtml">
neg_y_train = pd.Series(
    np.where(y_train == 1, 0, 1),
    index=y_train.index
)</span></pre></li> <li><span class="koboSpan" id="kobo.1936.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s determine the number of observations where the target variable takes a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1937.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1938.1" xmlns:="http://www.w3.org/1999/xhtml">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1939.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1940.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1941.1" xmlns:="http://www.w3.org/1999/xhtml">
to</span><a id="_idTextAnchor304"/><span class="koboSpan" id="kobo.1942.1" xmlns:="http://www.w3.org/1999/xhtml">tal_pos = y_train.sum()
total_neg = neg_y_train.sum()</span></pre></li> <li><span class="koboSpan" id="kobo.1943.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s calculate the numerator and denominator of the WoE’s formula, which we discussed earlier in </span><span class="No-Break"><span class="koboSpan" id="kobo.1944.1" xmlns:="http://www.w3.org/1999/xhtml">this recipe:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1945.1" xmlns:="http://www.w3.org/1999/xhtml">
pos = y_train.groupby(
    X_train["A1"]).sum() / total_pos
neg = neg_y_train.groupby(
    X_train["A1"]).sum() / total_neg</span></pre></li> <li><span class="koboSpan" id="kobo.1946.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s</span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.1947.1" xmlns:="http://www.w3.org/1999/xhtml"> calculate the WoE </span><span class="No-Break"><span class="koboSpan" id="kobo.1948.1" xmlns:="http://www.w3.org/1999/xhtml">per category:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1949.1" xmlns:="http://www.w3.org/1999/xhtml">
woe = np.log(pos/neg)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1950.1" xmlns:="http://www.w3.org/1999/xhtml">We can display the series with the category to WoE pairs by </span><span class="No-Break"><span class="koboSpan" id="kobo.1951.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1952.1" xmlns:="http://www.w3.org/1999/xhtml">print(woe)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1953.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1954.1" xmlns:="http://www.w3.org/1999/xhtml">A1</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1955.1" xmlns:="http://www.w3.org/1999/xhtml">Missing    0.203599</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1956.1" xmlns:="http://www.w3.org/1999/xhtml">a          0.092373</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1957.1" xmlns:="http://www.w3.org/1999/xhtml">b         -0.042410</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1958.1" xmlns:="http://www.w3.org/1999/xhtml">dtype: float64</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1959.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s replace the categories of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1960.1" xmlns:="http://www.w3.org/1999/xhtml">A1</span></strong><span class="koboSpan" id="kobo.1961.1" xmlns:="http://www.w3.org/1999/xhtml"> with the WoE in a copy of </span><span class="No-Break"><span class="koboSpan" id="kobo.1962.1" xmlns:="http://www.w3.org/1999/xhtml">the datasets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1963.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = X_train.copy()
X_test_enc = X_test.copy()
X_train_enc["A1"] = X_train_enc["A1"].map(woe)
X_test_enc["A1"] = X_test_enc["A1"].map(woe)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1964.1" xmlns:="http://www.w3.org/1999/xhtml">You can inspect the e</span><a id="_idTextAnchor305"/><span class="koboSpan" id="kobo.1965.1" xmlns:="http://www.w3.org/1999/xhtml">ncoded variable by </span><span class="No-Break"><span class="koboSpan" id="kobo.1966.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1967.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_enc["A1"].head()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1968.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.1969.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s perform WoE encoding </span><span class="No-Break"><span class="koboSpan" id="kobo.1970.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1971.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1972.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.1973.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><span class="No-Break"><span class="koboSpan" id="kobo.1974.1" xmlns:="http://www.w3.org/1999/xhtml">the encoder:</span></span><pre class="source-code">
<strong class="source-inline"><span class="koboSpan" id="kobo.1975.1" xmlns:="http://www.w3.org/1999/xhtml">from feature_engine.encoding import WoEEncoder</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1976.1" xmlns:="http://www.w3.org/1999/xhtml">Next, let’s set up the encoder to encode three </span><span class="No-Break"><span class="koboSpan" id="kobo.1977.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1978.1" xmlns:="http://www.w3.org/1999/xhtml">
woe_enc = WoEEncoder(variables = ["A1", "A9", "A12"])</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1979.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1980.1" xmlns:="http://www.w3.org/1999/xhtml">For rare categories, it might happen that </span><strong class="source-inline"><span class="koboSpan" id="kobo.1981.1" xmlns:="http://www.w3.org/1999/xhtml">p(0)=0</span></strong><span class="koboSpan" id="kobo.1982.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1983.1" xmlns:="http://www.w3.org/1999/xhtml">p(1)=0</span></strong><span class="koboSpan" id="kobo.1984.1" xmlns:="http://www.w3.org/1999/xhtml">, and then the division or the logarithm is not defined. </span><span class="koboSpan" id="kobo.1984.2" xmlns:="http://www.w3.org/1999/xhtml">To avoid this, group infrequent categories as shown in the </span><em class="italic"><span class="koboSpan" id="kobo.1985.1" xmlns:="http://www.w3.org/1999/xhtml">Grouping rare or infrequent </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1986.1" xmlns:="http://www.w3.org/1999/xhtml">categories</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1987.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.1988.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the</span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.1989.1" xmlns:="http://www.w3.org/1999/xhtml"> transformer to the train set so that it learns and stores the WoE of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1990.1" xmlns:="http://www.w3.org/1999/xhtml">different categories:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1991.1" xmlns:="http://www.w3.org/1999/xhtml">
woe_enc.fit(X_train, y_train)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1992.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1993.1" xmlns:="http://www.w3.org/1999/xhtml">We can display the dictionaries with the categori</span><a id="_idTextAnchor306"/><span class="koboSpan" id="kobo.1994.1" xmlns:="http://www.w3.org/1999/xhtml">es to WoE pairs by </span><span class="No-Break"><span class="koboSpan" id="kobo.1995.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1996.1" xmlns:="http://www.w3.org/1999/xhtml">woe_enc.encoder_dict_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1997.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.1998.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s encode the three categorical variables in the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1999.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2000.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = woe_enc.transform(X_train)
X_test_enc = woe_enc.transform(X_test)</span></pre></li> </ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2001.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.2002.1" xmlns:="http://www.w3.org/1999/xhtml"> returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.2003.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.2004.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrames, which contain the enco</span><a id="_idTextAnchor307"/><a id="_idTextAnchor308"/><span class="koboSpan" id="kobo.2005.1" xmlns:="http://www.w3.org/1999/xhtml">ded categorical variables ready to use in machine </span><span class="No-Break"><span class="koboSpan" id="kobo.2006.1" xmlns:="http://www.w3.org/1999/xhtml">learning models.</span></span></p>
<h2 id="_idParaDest-87"><a id="_idTextAnchor309"/><span class="koboSpan" id="kobo.2007.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.2008.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we encoded categorical variables using the WoE with </span><strong class="source-inline"><span class="koboSpan" id="kobo.2009.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2010.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2011.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2012.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.2013.1" xmlns:="http://www.w3.org/1999/xhtml">We combined the use of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2014.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.2015.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.2016.1" xmlns:="http://www.w3.org/1999/xhtml">sum()</span></strong><span class="koboSpan" id="kobo.2017.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2018.1" xmlns:="http://www.w3.org/1999/xhtml">groupby()</span></strong><span class="koboSpan" id="kobo.2019.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2020.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong><span class="koboSpan" id="kobo.2021.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.2022.1" xmlns:="http://www.w3.org/1999/xhtml">log()</span></strong><span class="koboSpan" id="kobo.2023.1" xmlns:="http://www.w3.org/1999/xhtml"> to determine the WoE as we described at the beginning of </span><span class="No-Break"><span class="koboSpan" id="kobo.2024.1" xmlns:="http://www.w3.org/1999/xhtml">this recipe.</span></span></p>
<p><span class="koboSpan" id="kobo.2025.1" xmlns:="http://www.w3.org/1999/xhtml">Next, we automated the procedure with </span><strong class="source-inline"><span class="koboSpan" id="kobo.2026.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.2027.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2027.2" xmlns:="http://www.w3.org/1999/xhtml">We used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2028.1" xmlns:="http://www.w3.org/1999/xhtml">WoEEncoder()</span></strong><span class="koboSpan" id="kobo.2029.1" xmlns:="http://www.w3.org/1999/xhtml">, which learned the WoE per category with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2030.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.2031.1" xmlns:="http://www.w3.org/1999/xhtml"> method, and then used </span><strong class="source-inline"><span class="koboSpan" id="kobo.2032.1" xmlns:="http://www.w3.org/1999/xhtml">tra</span><a id="_idTextAnchor310"/><a id="_idTextAnchor311"/><span class="koboSpan" id="kobo.2033.1" xmlns:="http://www.w3.org/1999/xhtml">nsform()</span></strong><span class="koboSpan" id="kobo.2034.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace the categories with the </span><span class="No-Break"><span class="koboSpan" id="kobo.2035.1" xmlns:="http://www.w3.org/1999/xhtml">corresponding numbers.</span></span></p>
<h2 id="_idParaDest-88"><a id="_idTextAnchor312"/><span class="koboSpan" id="kobo.2036.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.2037.1" xmlns:="http://www.w3.org/1999/xhtml">For an implementation of WoE with Category Encoders, visit this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.2038.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch02-categorical-encoding/Recipe-07-Weight-of-evidence.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.2039.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/m</span><span id="_idTextAnchor313"/><span id="_idTextAnchor314"/><span class="koboSpan" id="kobo.2040.1" xmlns:="http://www.w3.org/1999/xhtml">ain/ch02-categorical-encoding/Recipe-07-Weight-of-evidence.ipynb</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.2041.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-89"><a id="_idTextAnchor315"/><span class="koboSpan" id="kobo.2042.1" xmlns:="http://www.w3.org/1999/xhtml">Grouping rare or infrequent categories</span></h1>
<p><span class="koboSpan" id="kobo.2043.1" xmlns:="http://www.w3.org/1999/xhtml">Rare categories are those </span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.2044.1" xmlns:="http://www.w3.org/1999/xhtml">presen</span><a id="_idTextAnchor316"/><span class="koboSpan" id="kobo.2045.1" xmlns:="http://www.w3.org/1999/xhtml">t only in a small fraction of the observations. </span><span class="koboSpan" id="kobo.2045.2" xmlns:="http://www.w3.org/1999/xhtml">There is no rule of thumb to determine how small a small fraction is, b</span><a id="_idTextAnchor317"/><span class="koboSpan" id="kobo.2046.1" xmlns:="http://www.w3.org/1999/xhtml">ut typically, any value below 5% can be </span><span class="No-Break"><span class="koboSpan" id="kobo.2047.1" xmlns:="http://www.w3.org/1999/xhtml">considered rare.</span></span></p>
<p><span class="koboSpan" id="kobo.2048.1" xmlns:="http://www.w3.org/1999/xhtml">Infrequent labels often</span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.2049.1" xmlns:="http://www.w3.org/1999/xhtml"> appear only on the train set or only on the test set, thus making the algorithms prone to overfitting or being unable to score an observation. </span><span class="koboSpan" id="kobo.2049.2" xmlns:="http://www.w3.org/1999/xhtml">In addition, when encoding categories to numbers, we only create mappings for those categories observed in the train set, so we won’t know how to encode new labels. </span><span class="koboSpan" id="kobo.2049.3" xmlns:="http://www.w3.org/1999/xhtml">T</span><a id="_idTextAnchor318"/><span class="koboSpan" id="kobo.2050.1" xmlns:="http://www.w3.org/1999/xhtml">o avoid these complications, we can group infrequent categories into a single category called </span><strong class="source-inline"><span class="koboSpan" id="kobo.2051.1" xmlns:="http://www.w3.org/1999/xhtml">Rare</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2052.1" xmlns:="http://www.w3.org/1999/xhtml">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2053.1" xmlns:="http://www.w3.org/1999/xhtml">Other</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2054.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.2055.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, </span><a id="_idTextAnchor319"/><a id="_idTextAnchor320"/><span class="koboSpan" id="kobo.2056.1" xmlns:="http://www.w3.org/1999/xhtml">we will group infrequent categories using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2057.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2058.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2059.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2060.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-90"><a id="_idTextAnchor321"/><span class="koboSpan" id="kobo.2061.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.2062.1" xmlns:="http://www.w3.org/1999/xhtml">First, let’s import the necessary Python libraries and get the </span><span class="No-Break"><span class="koboSpan" id="kobo.2063.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2064.1" xmlns:="http://www.w3.org/1999/xhtml">Import the necessary Python libraries, functions, </span><span class="No-Break"><span class="koboSpan" id="kobo.2065.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2066.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from feature_engine.encoding import RareLabelEncoder</span></pre></li> <li><span class="koboSpan" id="kobo.2067.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the Credit Approval dataset and divide it into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.2068.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2069.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
    da</span><a id="_idTextAnchor322"/><span class="koboSpan" id="kobo.2070.1" xmlns:="http://www.w3.org/1999/xhtml">ta["target"],
    test_size=0</span><a id="_idTextAnchor323"/><span class="koboSpan" id="kobo.2071.1" xmlns:="http://www.w3.org/1999/xhtml">.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.2072.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.2073.1" xmlns:="http://www.w3.org/1999/xhtml">capture the fraction of observations per category in </span><strong class="source-inline"><span class="koboSpan" id="kobo.2074.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.2075.1" xmlns:="http://www.w3.org/1999/xhtml"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.2076.1" xmlns:="http://www.w3.org/1999/xhtml">a variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2077.1" xmlns:="http://www.w3.org/1999/xhtml">
freqs = X_train["A7"].value_counts(normalize=True)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.2078.1" xmlns:="http://www.w3.org/1999/xhtml">We can see the percentage of observations per category of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2079.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.2080.1" xmlns:="http://www.w3.org/1999/xhtml">, expressed as decimals, in the following output after </span><span class="No-Break"><span class="koboSpan" id="kobo.2081.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2082.1" xmlns:="http://www.w3.org/1999/xhtml">print(freqs)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2083.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.2084.1" xmlns:="http://www.w3.org/1999/xhtml">v 0.573499</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2085.1" xmlns:="http://www.w3.org/1999/xhtml">h 0.209110</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2086.1" xmlns:="http://www.w3.org/1999/xhtml">ff 0.084886</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2087.1" xmlns:="http://www.w3.org/1999/xhtml">bb 0.080745</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2088.1" xmlns:="http://www.w3.org/1999/xhtml">z 0.014493</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2089.1" xmlns:="http://www.w3.org/1999/xhtml">dd 0.010352</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2090.1" xmlns:="http://www.w3.org/1999/xhtml">j 0.010352</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2091.1" xmlns:="http://www.w3.org/1999/xhtml">Missing 0.008282</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2092.1" xmlns:="http://www.w3.org/1999/xhtml">n 0.006211</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2093.1" xmlns:="http://www.w3.org/1999/xhtml">o 0.002070</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2094.1" xmlns:="http://www.w3.org/1999/xhtml">Name: A7, dtype: float64</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.2095.1" xmlns:="http://www.w3.org/1999/xhtml">If we consider those labels present in less than 5% of the observations as rar</span><a id="_idTextAnchor324"/><span class="koboSpan" id="kobo.2096.1" xmlns:="http://www.w3.org/1999/xhtml">e, then </span><strong class="source-inline"><span class="koboSpan" id="kobo.2097.1" xmlns:="http://www.w3.org/1999/xhtml">z</span></strong><span class="koboSpan" id="kobo.2098.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2099.1" xmlns:="http://www.w3.org/1999/xhtml">dd</span></strong><span class="koboSpan" id="kobo.2100.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2101.1" xmlns:="http://www.w3.org/1999/xhtml">j</span></strong><span class="koboSpan" id="kobo.2102.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2103.1" xmlns:="http://www.w3.org/1999/xhtml">Missing</span></strong><span class="koboSpan" id="kobo.2104.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2105.1" xmlns:="http://www.w3.org/1999/xhtml">n</span></strong><span class="koboSpan" id="kobo.2106.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2107.1" xmlns:="http://www.w3.org/1999/xhtml">o</span><a id="_idTextAnchor325"/></strong><span class="koboSpan" id="kobo.2108.1" xmlns:="http://www.w3.org/1999/xhtml"> are </span><span class="No-Break"><span class="koboSpan" id="kobo.2109.1" xmlns:="http://www.w3.org/1999/xhtml">rare categories.</span></span></p></li> <li><span class="koboSpan" id="kobo.2110.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a list containing the names of the categories present in more than 5% of </span><span class="No-Break"><span class="koboSpan" id="kobo.2111.1" xmlns:="http://www.w3.org/1999/xhtml">the observations:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2112.1" xmlns:="http://www.w3.org/1999/xhtml">
frequent_cat = [
    x for x in freqs.loc[freqs &gt; 0.05].index.values]</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.2113.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.2114.1" xmlns:="http://www.w3.org/1999/xhtml">print(frequent_cat)</span></strong><span class="koboSpan" id="kobo.2115.1" xmlns:="http://www.w3.org/1999/xhtml">, we will see the frequent categories </span><span class="No-Break"><span class="koboSpan" id="kobo.2116.1" xmlns:="http://www.w3.org/1999/xhtml">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2117.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2118.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.2119.1" xmlns:="http://www.w3.org/1999/xhtml">['v', 'h', 'ff', 'bb'].</span></strong></pre></li> <li><span class="koboSpan" id="kobo.2120.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.2121.1" xmlns:="http://www.w3.org/1999/xhtml">replace rare labels – that is, those present in &lt;= 5% of the observations – with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2122.1" xmlns:="http://www.w3.org/1999/xhtml">Rare</span></strong><span class="koboSpan" id="kobo.2123.1" xmlns:="http://www.w3.org/1999/xhtml"> string in a copy of </span><span class="No-Break"><span class="koboSpan" id="kobo.2124.1" xmlns:="http://www.w3.org/1999/xhtml">the datasets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2125.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = X_train.copy()
X_test_enc = X_test.copy()
X_train_enc["A7"] = np.where(X_train["A7"].isin(
    frequent_cat), X_train["A7"], "Rare")
X_test_enc["A7"] = np.where(X_test["A7"].isin(
    frequent_cat), X_test["A7"], "Rare")</span></pre></li> <li><span class="koboSpan" id="kobo.2126.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s determine the percentage of observations in the </span><span class="No-Break"><span class="koboSpan" id="kobo.2127.1" xmlns:="http://www.w3.org/1999/xhtml">encoded variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2128.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train["A7"].value_counts(normalize=True)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.2129.1" xmlns:="http://www.w3.org/1999/xhtml">We can see that the infrequent labels have now been re-grouped into the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2130.1" xmlns:="http://www.w3.org/1999/xhtml">Rare</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2131.1" xmlns:="http://www.w3.org/1999/xhtml"> category:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.2132.1" xmlns:="http://www.w3.org/1999/xhtml">v       0.573499</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2133.1" xmlns:="http://www.w3.org/1999/xhtml">h       0.209110</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2134.1" xmlns:="http://www.w3.org/1999/xhtml">ff      0.084886</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2135.1" xmlns:="http://www.w3.org/1999/xhtml">bb      0.080745</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2136.1" xmlns:="http://www.w3.org/1999/xhtml">Rare    0.051760</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.2137.1" xmlns:="http://www.w3.org/1999/xhtml">Name: A7, dtype: f</span><a id="_idTextAnchor326"/><span class="koboSpan" id="kobo.2138.1" xmlns:="http://www.w3.org/1999/xhtml">loat64</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.2139.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s group rare labe</span><a id="_idTextAnchor327"/><span class="koboSpan" id="kobo.2140.1" xmlns:="http://www.w3.org/1999/xhtml">ls </span><span class="No-Break"><span class="koboSpan" id="kobo.2141.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2142.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2143.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.2144.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.2145.1" xmlns:="http://www.w3.org/1999/xhtml"> create a rare label encoder that groups categories present in less than 5% of the observations, provided that the categorical variable has more than four </span><span class="No-Break"><span class="koboSpan" id="kobo.2146.1" xmlns:="http://www.w3.org/1999/xhtml">distinct values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2147.1" xmlns:="http://www.w3.org/1999/xhtml">
rare_encoder = RareLabelEncoder(tol=0.05,
    n_categories=4)</span></pre></li> <li><span class="koboSpan" id="kobo.2148.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the encoder so that it finds the categorical variables and then learns their most </span><span class="No-Break"><span class="koboSpan" id="kobo.2149.1" xmlns:="http://www.w3.org/1999/xhtml">frequent categories:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2150.1" xmlns:="http://www.w3.org/1999/xhtml">
rare_encoder.fit(X_train)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.2151.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2152.1" xmlns:="http://www.w3.org/1999/xhtml">Upon fitting, the transformer will raise warnings, indicating that many categorical variables have less than four categories, thus their values will not be grouped. </span><span class="koboSpan" id="kobo.2152.2" xmlns:="http://www.w3.org/1999/xhtml">The transformer just lets you know that this </span><span class="No-Break"><span class="koboSpan" id="kobo.2153.1" xmlns:="http://www.w3.org/1999/xhtml">is happening.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.2154.1" xmlns:="http://www.w3.org/1999/xhtml">We can display the frequent categories per variable by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.2155.1" xmlns:="http://www.w3.org/1999/xhtml">rare_encoder.encoder_dict_</span></strong><span class="koboSpan" id="kobo.2156.1" xmlns:="http://www.w3.org/1999/xhtml">, as well as the variables that will be encoded by </span><span class="No-Break"><span class="koboSpan" id="kobo.2157.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2158.1" xmlns:="http://www.w3.org/1999/xhtml">rare_encoder.variables_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2159.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.2160.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s group rare labels in the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.2161.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2162.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc = rare_encoder.transform(X_train)
X_test_enc = rare_encoder.transform(X_test)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.2163.1" xmlns:="http://www.w3.org/1999/xhtml">Now that we have grouped rare labels, we are ready to encode the catego</span><a id="_idTextAnchor328"/><a id="_idTextAnchor329"/><span class="koboSpan" id="kobo.2164.1" xmlns:="http://www.w3.org/1999/xhtml">rical variables, as we’ve done in the previous recipes in </span><span class="No-Break"><span class="koboSpan" id="kobo.2165.1" xmlns:="http://www.w3.org/1999/xhtml">this chapter.</span></span></p>
<h2 id="_idParaDest-91"><a id="_idTextAnchor330"/><span class="koboSpan" id="kobo.2166.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.2167.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we grouped infrequent categories using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2168.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2169.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2170.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2171.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.2172.1" xmlns:="http://www.w3.org/1999/xhtml">We determined</span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.2173.1" xmlns:="http://www.w3.org/1999/xhtml"> the fraction of observations per category of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2174.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.2175.1" xmlns:="http://www.w3.org/1999/xhtml"> variable using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2176.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.2177.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.2178.1" xmlns:="http://www.w3.org/1999/xhtml">value_counts()</span></strong><span class="koboSpan" id="kobo.2179.1" xmlns:="http://www.w3.org/1999/xhtml"> by setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2180.1" xmlns:="http://www.w3.org/1999/xhtml">normalize</span></strong><span class="koboSpan" id="kobo.2181.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2182.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.2183.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2183.2" xmlns:="http://www.w3.org/1999/xhtml">Using list comprehension, we captured the names of the variables present in more than 5% of the observations. </span><span class="koboSpan" id="kobo.2183.3" xmlns:="http://www.w3.org/1999/xhtml">Finally, u</span><a id="_idTextAnchor331"/><span class="koboSpan" id="kobo.2184.1" xmlns:="http://www.w3.org/1999/xhtml">sing NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.2185.1" xmlns:="http://www.w3.org/1999/xhtml">where()</span></strong><span class="koboSpan" id="kobo.2186.1" xmlns:="http://www.w3.org/1999/xhtml">, we searched each row of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2187.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.2188.1" xmlns:="http://www.w3.org/1999/xhtml">, and if </span><a id="_idTextAnchor332"/><span class="koboSpan" id="kobo.2189.1" xmlns:="http://www.w3.org/1999/xhtml">the observation was one of the frequent categories in the list, which we checked using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2190.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.2191.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.2192.1" xmlns:="http://www.w3.org/1999/xhtml">isin()</span></strong><span class="koboSpan" id="kobo.2193.1" xmlns:="http://www.w3.org/1999/xhtml">, its value was kept; otherwise, it was replaced </span><span class="No-Break"><span class="koboSpan" id="kobo.2194.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2195.1" xmlns:="http://www.w3.org/1999/xhtml">Rare</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2196.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.2197.1" xmlns:="http://www.w3.org/1999/xhtml">We automated the preceding steps for multiple categorical variables using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2198.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.2199.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.2200.1" xmlns:="http://www.w3.org/1999/xhtml">RareLabelEncoder()</span></strong><span class="koboSpan" id="kobo.2201.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2201.2" xmlns:="http://www.w3.org/1999/xhtml">By setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.2202.1" xmlns:="http://www.w3.org/1999/xhtml">tol</span></strong><span class="koboSpan" id="kobo.2203.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2204.1" xmlns:="http://www.w3.org/1999/xhtml">0.05</span></strong><span class="koboSpan" id="kobo.2205.1" xmlns:="http://www.w3.org/1999/xhtml">, we retained categories present in more than 5% of the observations. </span><span class="koboSpan" id="kobo.2205.2" xmlns:="http://www.w3.org/1999/xhtml">By setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.2206.1" xmlns:="http://www.w3.org/1999/xhtml">n_categories</span></strong><span class="koboSpan" id="kobo.2207.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2208.1" xmlns:="http://www.w3.org/1999/xhtml">4</span></strong><span class="koboSpan" id="kobo.2209.1" xmlns:="http://www.w3.org/1999/xhtml">, we only grouped categories in variables with more than four unique values. </span><span class="koboSpan" id="kobo.2209.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.2210.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.2211.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer identified the categorical variables and then learned and stored their frequent categories. </span><span class="koboSpan" id="kobo.2211.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.2212.1" xmlns:="http://www.w3.org/1999/xhtml">transform</span><a id="_idTextAnchor333"/><a id="_idTextAnchor334"/><span class="koboSpan" id="kobo.2213.1" xmlns:="http://www.w3.org/1999/xhtml">()</span></strong><span class="koboSpan" id="kobo.2214.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer replaced infrequent categories with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2215.1" xmlns:="http://www.w3.org/1999/xhtml">Rare</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2216.1" xmlns:="http://www.w3.org/1999/xhtml"> string.</span></span></p>
<h1 id="_idParaDest-92"><span class="koboSpan" id="kobo.2217.1" xmlns:="http://www.w3.org/1999/xhtml">Performing b</span><a id="_idTextAnchor335"/><span class="koboSpan" id="kobo.2218.1" xmlns:="http://www.w3.org/1999/xhtml">inary encoding</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.2219.1" xmlns:="http://www.w3.org/1999/xhtml">Binary encoding</span></strong><span class="koboSpan" id="kobo.2220.1" xmlns:="http://www.w3.org/1999/xhtml"> uses </span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.2221.1" xmlns:="http://www.w3.org/1999/xhtml">binary code – that is, a sequence of zeroes and ones – to represent the different categories of the variable. </span><span class="koboSpan" id="kobo.2221.2" xmlns:="http://www.w3.org/1999/xhtml">How does it work? </span><span class="koboSpan" id="kobo.2221.3" xmlns:="http://www.w3.org/1999/xhtml">First, the categories </span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.2222.1" xmlns:="http://www.w3.org/1999/xhtml">are arbitrarily replaced with ordinal numbers, as shown in the intermediate step of the following table. </span><span class="koboSpan" id="kobo.2222.2" xmlns:="http://www.w3.org/1999/xhtml">Then, those numbers are converted into binary code. </span><span class="koboSpan" id="kobo.2222.3" xmlns:="http://www.w3.org/1999/xhtml">For example, integer </span><strong class="source-inline"><span class="koboSpan" id="kobo.2223.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.2224.1" xmlns:="http://www.w3.org/1999/xhtml"> can be represented with the sequence of </span><strong class="source-inline"><span class="koboSpan" id="kobo.2225.1" xmlns:="http://www.w3.org/1999/xhtml">1-0</span></strong><span class="koboSpan" id="kobo.2226.1" xmlns:="http://www.w3.org/1999/xhtml">, integer </span><strong class="source-inline"><span class="koboSpan" id="kobo.2227.1" xmlns:="http://www.w3.org/1999/xhtml">2</span></strong><span class="koboSpan" id="kobo.2228.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.2229.1" xmlns:="http://www.w3.org/1999/xhtml">0-1</span></strong><span class="koboSpan" id="kobo.2230.1" xmlns:="http://www.w3.org/1999/xhtml">, integer </span><strong class="source-inline"><span class="koboSpan" id="kobo.2231.1" xmlns:="http://www.w3.org/1999/xhtml">3</span></strong><span class="koboSpan" id="kobo.2232.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.2233.1" xmlns:="http://www.w3.org/1999/xhtml">1-1</span></strong><span class="koboSpan" id="kobo.2234.1" xmlns:="http://www.w3.org/1999/xhtml">, and integer </span><strong class="source-inline"><span class="koboSpan" id="kobo.2235.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.2236.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.2237.1" xmlns:="http://www.w3.org/1999/xhtml">0-0</span></strong><span class="koboSpan" id="kobo.2238.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2238.2" xmlns:="http://www.w3.org/1999/xhtml">The digits in the two positions of the binary string become the</span><a id="_idTextAnchor336"/><span class="koboSpan" id="kobo.2239.1" xmlns:="http://www.w3.org/1999/xhtml"> columns, which are the encoded representations of the </span><span class="No-Break"><span class="koboSpan" id="kobo.2240.1" xmlns:="http://www.w3.org/1999/xhtml">original variable:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer040">
<span class="koboSpan" id="kobo.2241.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.10 – Table showing the steps required for binary encoding the color variable" src="image/B22396_02_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2242.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.10 – Table showing the steps required for binary encoding the color variable</span></p>
<p><span class="koboSpan" id="kobo.2243.1" xmlns:="http://www.w3.org/1999/xhtml">Binary encoding </span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.2244.1" xmlns:="http://www.w3.org/1999/xhtml">encodes the data in fewer dimensions than one-hot encoding. </span><span class="koboSpan" id="kobo.2244.2" xmlns:="http://www.w3.org/1999/xhtml">In our example, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2245.1" xmlns:="http://www.w3.org/1999/xhtml">Color</span></strong><span class="koboSpan" id="kobo.2246.1" xmlns:="http://www.w3.org/1999/xhtml"> variable would be encoded into </span><em class="italic"><span class="koboSpan" id="kobo.2247.1" xmlns:="http://www.w3.org/1999/xhtml">k-1</span></em><span class="koboSpan" id="kobo.2248.1" xmlns:="http://www.w3.org/1999/xhtml"> categories by one-hot encoding – that is, three variables – but with binary encoding, we can represent the variable with only two features. </span><span class="koboSpan" id="kobo.2248.2" xmlns:="http://www.w3.org/1999/xhtml">More generally, we determine the number of binary features needed to encode a variable as </span><em class="italic"><span class="koboSpan" id="kobo.2249.1" xmlns:="http://www.w3.org/1999/xhtml">log2(number of distinct</span><a id="_idTextAnchor337"/><span class="koboSpan" id="kobo.2250.1" xmlns:="http://www.w3.org/1999/xhtml"> categories)</span></em><span class="koboSpan" id="kobo.2251.1" xmlns:="http://www.w3.org/1999/xhtml">; in our example, </span><em class="italic"><span class="koboSpan" id="kobo.2252.1" xmlns:="http://www.w3.org/1999/xhtml">log2(4) = 2</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.2253.1" xmlns:="http://www.w3.org/1999/xhtml">binary features.</span></span></p>
<p><span class="koboSpan" id="kobo.2254.1" xmlns:="http://www.w3.org/1999/xhtml">Binary encoding is an alternative method to one-hot encoding where we do not lose information about the variable, yet we obtain fewer features after the encoding. </span><span class="koboSpan" id="kobo.2254.2" xmlns:="http://www.w3.org/1999/xhtml">This is particularly useful when we have highly cardinal variables. </span><span class="koboSpan" id="kobo.2254.3" xmlns:="http://www.w3.org/1999/xhtml">For example, if a variable contains 128 unique categories, with one-hot encoding, we would need 127 features to encode the variable, whereas with binary encoding, we will only need </span><em class="italic"><span class="koboSpan" id="kobo.2255.1" xmlns:="http://www.w3.org/1999/xhtml">7 (log2(128)=7)</span></em><span class="koboSpan" id="kobo.2256.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.2256.2" xmlns:="http://www.w3.org/1999/xhtml">Thus, this encoding prevents the feature space from exploding. </span><span class="koboSpan" id="kobo.2256.3" xmlns:="http://www.w3.org/1999/xhtml">In addition, binary-encoded features are also suitable for linear models. </span><span class="koboSpan" id="kobo.2256.4" xmlns:="http://www.w3.org/1999/xhtml">On the downside, the derived binary features lack human interpretability, so if we need to interpret the decisions made by our models, this encoding method may not be a </span><span class="No-Break"><span class="koboSpan" id="kobo.2257.1" xmlns:="http://www.w3.org/1999/xhtml">suitable option.</span></span></p>
<p><span class="koboSpan" id="kobo.2258.1" xmlns:="http://www.w3.org/1999/xhtml">In this rec</span><a id="_idTextAnchor338"/><a id="_idTextAnchor339"/><span class="koboSpan" id="kobo.2259.1" xmlns:="http://www.w3.org/1999/xhtml">ipe, we will learn how to perform binary encoding using </span><span class="No-Break"><span class="koboSpan" id="kobo.2260.1" xmlns:="http://www.w3.org/1999/xhtml">Category Encoders.</span></span></p>
<h2 id="_idParaDest-93"><a id="_idTextAnchor340"/><span class="koboSpan" id="kobo.2261.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.2262.1" xmlns:="http://www.w3.org/1999/xhtml">First, let’s import the necessary Python libraries and get the </span><span class="No-Break"><span class="koboSpan" id="kobo.2263.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.2264.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required Python libraries, functions, </span><span class="No-Break"><span class="koboSpan" id="kobo.2265.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2266.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split
from category_encoders.binary import BinaryEncoder</span></pre></li> <li><span class="koboSpan" id="kobo.2267.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the Credit Approval dataset and divide it into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.2268.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2269.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop(labels=["target"], axis=1),
</span><a id="_idTextAnchor341"/><span class="koboSpan" id="kobo.2270.1" xmlns:="http://www.w3.org/1999/xhtml">    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.2271.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect</span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.2272.1" xmlns:="http://www.w3.org/1999/xhtml"> the unique categories </span><span class="No-Break"><span class="koboSpan" id="kobo.2273.1" xmlns:="http://www.w3.org/1999/xhtml">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2274.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2275.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2276.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train["A7"].unique()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.2277.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we can see that </span><strong class="source-inline"><span class="koboSpan" id="kobo.2278.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.2279.1" xmlns:="http://www.w3.org/1999/xhtml"> has 10 </span><span class="No-Break"><span class="koboSpan" id="kobo.2280.1" xmlns:="http://www.w3.org/1999/xhtml">different categories:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.2281.1" xmlns:="http://www.w3.org/1999/xhtml">array(['v', 'ff', 'h', 'dd', 'z', 'bb', 'j', 'Missing', 'n', 'o'], dtype=object)</span></strong></pre></li> <li><span class="koboSpan" id="kobo.2282.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a binary encoder to </span><span class="No-Break"><span class="koboSpan" id="kobo.2283.1" xmlns:="http://www.w3.org/1999/xhtml">encode </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2284.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2285.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2286.1" xmlns:="http://www.w3.org/1999/xhtml">
encoder = BinaryEncoder(cols=["A7"],
    drop_invariant=True)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.2287.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.2288.1" xmlns:="http://www.w3.org/1999/xhtml">BinaryEncoder()</span></strong><span class="koboSpan" id="kobo.2289.1" xmlns:="http://www.w3.org/1999/xhtml">, as well as other encoders from the Category Encoders package, allow us to select the variables to encode. </span><span class="koboSpan" id="kobo.2289.2" xmlns:="http://www.w3.org/1999/xhtml">We simply pass the column names in a list to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2290.1" xmlns:="http://www.w3.org/1999/xhtml">cols</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2291.1" xmlns:="http://www.w3.org/1999/xhtml"> argument.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.2292.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the transformer to the train set so that it calculates how many binary variables it needs and creates the variable-to-binary </span><span class="No-Break"><span class="koboSpan" id="kobo.2293.1" xmlns:="http://www.w3.org/1999/xhtml">code representations:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2294.1" xmlns:="http://www.w3.org/1999/xhtml">
encoder.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.2295.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s encode </span><strong class="source-inline"><span class="koboSpan" id="kobo.2296.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.2297.1" xmlns:="http://www.w3.org/1999/xhtml"> in the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.2298.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.2299.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_enc</span><a id="_idTextAnchor342"/><span class="koboSpan" id="kobo.2300.1" xmlns:="http://www.w3.org/1999/xhtml"> = encoder.transform(X_train)
X_test_enc = encoder.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.2301.1" xmlns:="http://www.w3.org/1999/xhtml">We can</span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.2302.1" xmlns:="http://www.w3.org/1999/xhtml"> display the top rows of the transformed train set </span><a id="_idTextAnchor343"/><span class="koboSpan" id="kobo.2303.1" xmlns:="http://www.w3.org/1999/xhtml">by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.2304.1" xmlns:="http://www.w3.org/1999/xhtml">print(X_train_enc.head())</span></strong><span class="koboSpan" id="kobo.2305.1" xmlns:="http://www.w3.org/1999/xhtml">, which returns the </span><span class="No-Break"><span class="koboSpan" id="kobo.2306.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer041">
<span class="koboSpan" id="kobo.2307.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 2.11 – DataFrame with the variables after binary encoding" src="image/B22396_02_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2308.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 2.11 – DataFrame with the variables after binary encoding</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.2309.1" xmlns:="http://www.w3.org/1999/xhtml">Binary encoding returned four binary variables for </span><strong class="source-inline"><span class="koboSpan" id="kobo.2310.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.2311.1" xmlns:="http://www.w3.org/1999/xhtml">, which are </span><strong class="source-inline"><span class="koboSpan" id="kobo.2312.1" xmlns:="http://www.w3.org/1999/xhtml">A7_0</span></strong><span class="koboSpan" id="kobo.2313.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2314.1" xmlns:="http://www.w3.org/1999/xhtml">A7_1</span></strong><span class="koboSpan" id="kobo.2315.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2316.1" xmlns:="http://www.w3.org/1999/xhtml">A7_2</span></strong><span class="koboSpan" id="kobo.2317.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2318.1" xmlns:="http://www.w3.org/1999/xhtml">A</span><a id="_idTextAnchor344"/><a id="_idTextAnchor345"/><span class="koboSpan" id="kobo.2319.1" xmlns:="http://www.w3.org/1999/xhtml">7_3</span></strong><span class="koboSpan" id="kobo.2320.1" xmlns:="http://www.w3.org/1999/xhtml">, instead of the nine that would have been returned by </span><span class="No-Break"><span class="koboSpan" id="kobo.2321.1" xmlns:="http://www.w3.org/1999/xhtml">one-hot encoding.</span></span></p>
<h2 id="_idParaDest-94"><a id="_idTextAnchor346"/><span class="koboSpan" id="kobo.2322.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.2323.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we performed binary encoding using the Category Encoders package. </span><span class="koboSpan" id="kobo.2323.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.2324.1" xmlns:="http://www.w3.org/1999/xhtml">BinaryEncoder()</span></strong><span class="koboSpan" id="kobo.2325.1" xmlns:="http://www.w3.org/1999/xhtml"> to encode the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2326.1" xmlns:="http://www.w3.org/1999/xhtml">A</span><a id="_idTextAnchor347"/><span class="koboSpan" id="kobo.2327.1" xmlns:="http://www.w3.org/1999/xhtml">7</span></strong><span class="koboSpan" id="kobo.2328.1" xmlns:="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.2328.2" xmlns:="http://www.w3.org/1999/xhtml">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2329.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.2330.1" xmlns:="http://www.w3.org/1999/xhtml"> method, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2331.1" xmlns:="http://www.w3.org/1999/xhtml">BinaryEncoder()</span></strong><span class="koboSpan" id="kobo.2332.1" xmlns:="http://www.w3.org/1999/xhtml"> created a mapping from a category to a set of binary columns, and with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2333.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong> <a id="_idTextAnchor348"/><a id="_idTextAnchor349"/><a id="_idTextAnchor350"/><span class="koboSpan" id="kobo.2334.1" xmlns:="http://www.w3.org/1999/xhtml">method, the encoder encoded the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2335.1" xmlns:="http://www.w3.org/1999/xhtml">A7</span></strong><span class="koboSpan" id="kobo.2336.1" xmlns:="http://www.w3.org/1999/xhtml"> variable in both the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.2337.1" xmlns:="http://www.w3.org/1999/xhtml">test sets.</span></span></p>
</div>
</body></html>
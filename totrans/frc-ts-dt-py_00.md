# 前言

2017年，Facebook（现在是Meta）发布了其Prophet软件作为开源。这个强大的工具是由Facebook工程师开发的，因为其分析师被经理们要求的大量业务预测所淹没。Prophet的开发者希望同时解决两个问题：1）完全自动化的预测技术太脆弱、太不灵活，无法处理额外的知识，2）能够持续产生高质量预测的分析师很少，并且需要广泛的专长。Prophet成功地解决了这两个问题。

Prophet被设计成，使用没有任何参数调整或其他优化的预测通常质量非常高。尽管如此，只需一点训练，任何人都可以直观地调整模型并显著提高性能。

从最基本模型开始，逐步深入到Prophet内部工作的最复杂技术，这本书将教你关于Prophet的一切知识。这里讨论了许多连官方文档都没有涵盖的高级功能，并为每个主题提供了完整的示例。这本书的目的不是让你从头开始构建Prophet的克隆，但它会教你如何使用Prophet，甚至可能比Meta自己高度训练的工程师还要好。

自从这本书的第一版出版以来，世界发生了巨大的变化。全球COVID大流行打乱了每一个预测者的预测，我们都还在努力学习如何在这个新世界中预测。本书的第二版包括了对如何在这些意外事件期间进行预测的理解更新。

此外，自第一版以来，Prophet经历了许多更新，包括从测试版毕业并发布官方版本1！我们更新了本书的每个部分和代码块，包括自第一版发布以来Prophet的所有新功能和变化。

近年来，其他几家公司的数据科学团队也开源了他们自己的预测包，我们包括了对NeuralProphet、LinkedIn的Greykite和Uber的Orbit的新讨论，以及与Prophet相比它们的优缺点。由于第一版众多读者的鼓励反馈，我们撰写了一个全新的章节，全部关于Prophet背后的数学。这个新章节将使你对如何为你的领域构建最佳的预测有更深入的理解，并提供知识来向利益相关者解释你的预测是如何开发的。

这第二版与第一版相比是一个很大的更新，我迫不及待地想听听你们关于预测工作的反馈！

# 这本书面向谁

本书面向希望使用 Python 或 R 构建时间序列预测的商业经理、数据科学家、数据分析师、机器学习工程师和软件工程师。为了最大限度地利用本书，您应该对时间序列数据有基本的了解，并能够将其与其他类型的数据区分开来。对预测技术的了解是加分项。

# 本书涵盖的内容

[*第一章*](B19630_01.xhtml#_idTextAnchor031)，*时间序列预测的历史与发展*，将向您介绍理解时间序列数据的最早努力以及迄今为止的主要算法发展。

[*第二章*](B19630_02.xhtml#_idTextAnchor104)，*Prophet 入门*，将带您了解如何在您的机器上运行 Prophet 的过程，然后通过构建您的第一个模型来测试您的安装。

[*第三章*](B19630_03.xhtml#_idTextAnchor176)，*Prophet 的工作原理*，将讨论为什么 Facebook（现在称为 Meta）决定构建自己的预测包，以及“分析师在循环”预测哲学如何应用于 Prophet。本章还将介绍 Prophet 中预测算法背后的数学方程式。

[*第四章*](B19630_04.xhtml#_idTextAnchor197)，*处理非每日数据*，将涵盖如何修改在 [*第二章*](B19630_02.xhtml#_idTextAnchor104)，*Prophet 入门* 中采用的方法，以便处理记录在除每日以外的规模上的数据，这样您就可以准备好在后续章节中处理所有示例。

[*第五章*](B19630_05.xhtml#_idTextAnchor254)，*处理季节性*，将讨论在 Prophet 中控制季节性的所有方法。季节性是 Prophet 模型的基础之一，包含最多的控制参数，因此这一章是最长的，也是最重要的一章。

[*第六章*](B19630_06.xhtml#_idTextAnchor375)，*预测假日效应*，将教您如何将假日效应添加到您的预测中。您将学习如何包括一组基本默认假日，如何为不同地区更改该组，如何添加您自己的自定义假日，以及如何控制效应的强度。

[*第七章*](B19630_07.xhtml#_idTextAnchor453)，*控制增长模式*，将描述 Prophet 中趋势线可以遵循的三个增长模式：线性、逻辑和水平。您将学习将这些模式应用于哪些场景，以及它们对未来预测有何影响。

[*第八章*](B19630_08.xhtml#_idTextAnchor537)，*影响趋势变化点*，将讨论如何控制最终模型的刚性。您将学习如何创建一个可以经常改变方向的灵活模型或遵循恒定线的刚性模型，为什么您可能选择其中之一，以及这对您在未来的数据上使用模型的不确定性有何影响。

[*第9章*](B19630_09.xhtml#_idTextAnchor599), *包含额外的回归因子*，将教你如何在模型中包含额外的数据列。与多元回归类似，Prophet能够结合多个输入向量进行预测性预报。

[*第10章*](B19630_10.xhtml#_idTextAnchor641), *处理异常值和特殊事件*，将展示异常值在Prophet模型中可能引起的两种类型的问题，并教你几种自动化的技术来识别异常值以及如何使用Prophet处理它们。

[*第11章*](B19630_11.xhtml#_idTextAnchor728), *管理不确定性区间*，将涵盖如何使用不同的统计方法量化模型中的不确定性，每种方法的优缺点，以及如何可视化模型中的风险量。

[*第12章*](B19630_12.xhtml#_idTextAnchor794), *执行交叉验证*，将教你如何在Prophet中执行交叉验证。你可能已经熟悉机器学习中的交叉验证技术，但在时间序列数据中，需要不同的方法。本章将教你这种方法以及如何在Prophet中实现它。

[*第13章*](B19630_13.xhtml#_idTextAnchor839), *评估性能指标*，将在前一章的基础上介绍Prophet的特性性能指标。你将学习如何将交叉验证与所选性能指标结合，进行网格搜索并优化你的模型以获得最高的预测准确性。

[*第14章*](B19630_14.xhtml#_idTextAnchor927), *将Prophet投入生产*，是最后一章，将教你一些在生产环境中使用Prophet时非常有用的额外技术。你将学习如何保存模型以供以后使用，如何随着新数据的到来更新模型，以及如何使用Prophet的Plotly绘图函数构建高度交互式的图表，适合在基于网络的仪表板上共享。

# 为了充分利用这本书

要运行本书中的代码示例，你需要安装Python 3.x。本书中的所有示例都是使用Prophet版本1.1在Jupyter笔记本中制作的。macOS、Windows和Linux都受到支持。尽管本书中的所有示例都将使用Python编写，但所有内容也与R语言完全兼容，如果你更喜欢使用R语言，你也可以使用它，尽管本书不会涵盖R语言的语法。请参考官方Prophet文档了解R语言的语法（[https://facebook.github.io/prophet/](https://facebook.github.io/prophet/))）。

[*第2章*](B19630_02.xhtml#_idTextAnchor104)，*使用Prophet入门*，将指导您安装Prophet，并且强烈建议安装Anaconda或Miniconda以正确安装Prophet的所有依赖项。虽然可以在不使用Anaconda的情况下安装Prophet，但这取决于您的机器的具体配置，可能会非常困难，本书假设将使用Anaconda。

为了跟随示例，您至少需要熟悉用于数据处理的数据处理库`pandas`和用于制作图表的Matplotlib。在少数情况下，将使用`numpy`库来模拟随机数据，但跟随示例不需要您了解NumPy语法。所有这些库都将作为Prophet依赖项自动安装，如果尚未安装。本书中使用的所有数据集都托管在此书的GitHub仓库中，并可在此处下载：[https://github.com/PacktPublishing/Forecasting-Time-Series-Data-with-Prophet-Second-Edition](https://github.com/PacktPublishing/Forecasting-Time-Series-Data-with-Prophet-Second-Edition)。

| **本书中涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| Prophet | Windows、macOS或Linux（任何） |
| Python 3.7+ |

Prophet支持与Dask的并行化，但设置Prophet在Dask集群上运行的内容将涵盖，安装和使用Dask超出了本书的范围。如果您感兴趣，我鼓励您参考Dask文档：[https://docs.dask.org/en/stable/](https://docs.dask.org/en/stable/)。同样，本书将涵盖如何在Plotly中构建交互式Prophet可视化，但将这些内容组合成Dash仪表板将留给读者在其他地方学习。Dash文档：[https://dash.plotly.com/](https://dash.plotly.com/)是一个很好的起点。

如果您正在使用这本书的数字版，我们建议您亲自输入代码或通过GitHub仓库（下一节中提供链接）访问代码。这样做将帮助您避免与复制/粘贴代码相关的任何潜在错误。

# 下载示例代码文件

您可以从GitHub下载本书的示例代码文件：[https://github.com/PacktPublishing/Forecasting-Time-Series-Data-with-Prophet-Second-Edition](https://github.com/PacktPublishing/Forecasting-Time-Series-Data-with-Prophet-Second-Edition)。如果代码有更新，它将在现有的GitHub仓库中更新。

我们还有其他来自我们丰富图书和视频目录的代码包，可在[https://github.com/PacktPublishing/](https://github.com/PacktPublishing/)找到。查看它们吧！

# 使用的约定

本书中使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟URL、用户输入和Twitter昵称。以下是一个示例：“要控制Prophet的自动变化点检测，您可以在模型实例化期间使用`n_changepoints`和`changepoint_range`参数修改这两个值。”

代码块设置如下：

[PRE0]

当我们希望将您的注意力引到代码块的一部分时，相关的行或项目将以粗体显示：

[PRE1]

任何命令行输入或输出都应如下编写：

[PRE2]

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词在文本中显示如下。以下是一个示例：“在以下季节性图中，我使用了工具栏中的**切换峰值线**和**比较数据**按钮来添加更多到悬停工具提示的信息。”

小贴士或重要注意事项

显示如下。

# 联系我们

我们始终欢迎读者的反馈。

`customercare@packtpub.com`。

**勘误表**：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在此书中发现错误，我们将非常感谢您向我们报告。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)，选择您的书籍，点击**勘误提交表单**链接，并输入详细信息。

请通过`copyright@packt.com`发送链接到该材料。

**如果您有兴趣成为作者**：如果您在某个主题上具有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了《使用Prophet预测时间序列数据》，我们非常乐意听到您的想法！请[点击此处直接转到此书的亚马逊评论页面](https://packt.link/r/1-837-63041-0)并分享您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载此书的免费PDF副本。

感谢您购买此书！

您喜欢在路上阅读，但无法携带您的印刷书籍到处走吗？

您的电子书购买是否与您选择的设备不兼容？

别担心，现在，每购买一本Packt书籍，您都可以免费获得该书的DRM免费PDF版本。

在任何地方、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠远不止于此，您还可以获得独家折扣、时事通讯和每日免费内容的每日邮箱访问权限。

按照以下简单步骤获取优惠：

1.  扫描下面的二维码或访问以下链接

![](img/B19630_QR_Free_PDF.jpg)

[https://packt.link/free-ebook/9781837630417](https://packt.link/free-ebook/9781837630417)

1.  提交您的购买证明

1.  就这样！我们将直接将您的免费PDF和其他优惠发送到您的邮箱。

# 第一部分：Prophet 入门

本书的第一部分将向您介绍导致 Prophet 诞生的时序预测技术的历史发展，然后指导您进行程序的安装。本节接着将带您了解一个基本的 Prophet 预测模型，并介绍此类模型产生的输出。*第一部分*以对 Prophet 构建预测所使用的数学方法的描述结束。

本节包括以下章节：

+   [*第一章*](B19630_01.xhtml#_idTextAnchor031), *时间序列预测的历史与发展*

+   [*第二章*](B19630_02.xhtml#_idTextAnchor104), *Prophet 入门*

+   [*第三章*](B19630_03.xhtml#_idTextAnchor176), *Prophet 的工作原理*

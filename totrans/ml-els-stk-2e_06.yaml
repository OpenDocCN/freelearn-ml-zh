- en: '*Chapter 4*: Forecasting'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第四章*: 预测'
- en: '**Forecasting** is a natural extension of the time series modeling of Elastic
    ML. Since very expressive models are built behind the scenes and describe how
    data has behaved historically, it is therefore possible to project that information
    forward in time and predict how something should behave at a future time.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '**预测**是Elastic ML的时间序列建模的自然扩展。由于在幕后构建了非常表达性的模型，并描述了数据的历史行为，因此可以预测这些信息在时间上的前进，并预测某物在未来某个时间点应该如何表现。'
- en: We will spend time learning the concepts behind forecasting, as well as stepping
    through some practical examples.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将花时间学习预测背后的概念，以及通过一些实际示例进行操作。
- en: 'Specifically, this chapter will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 具体来说，本章将涵盖以下主题：
- en: Contrasting forecasting with prophesying
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对比预测与预言
- en: Forecasting use cases
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测用例
- en: Forecasting theory of operation
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运营预测理论
- en: Single time series forecasting
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单个时间序列预测
- en: Looking at forecasting results
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看预测结果
- en: Multiple time series forecasting
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多个时间序列预测
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: The information and examples demonstrated in this chapter are relevant as of
    v7.11 of the Elastic Stack.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中展示的信息和示例与Elastic Stack的v7.11版本相关。
- en: Contrasting forecasting with prophesying
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 对比预测与预言
- en: '*Past performance is not indicative of future results.* This disclaimer is
    used by financial companies when they reference the performance of products such
    as mutual funds. But this disclaimer is a bit of an odd contradiction, because
    the past is all that we have to work with. If the companies that comprise the
    mutual fund have had consistently positive quarterly results for the last eight
    quarters straight, does that guarantee that they will also have a positive set
    of results for the next eight quarters and that their public valuation will continue
    to rise? Probability could be on the side of that being the case, but that might
    not be the whole story. And, before we get too wishful in thinking that Elastic
    ML’s ability to forecast is our key to making a fortune in the stock market, we
    should be realistic about one key caveat—there are always uncontrollable factors.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '*过去的表现并不能预示未来的结果*。这个免责声明是金融公司在引用如共同基金等产品表现时所使用的。但这个免责声明有点自相矛盾，因为过去是我们唯一可以工作的东西。如果构成共同基金的这些公司在过去八个季度中一直有持续的正季度业绩，这能保证他们接下来八个季度也会有正面的业绩组合，并且他们的公开估值会持续上升吗？概率可能支持这种情况，但这可能不是全部的故事。在我们过于乐观地认为Elastic
    ML的预测能力是我们股市发财的关键之前，我们应该对以下关键警告保持现实——总有一些不可控的因素。'
- en: The reason financial companies use the preceding disclaimer is that there are
    often unknown, uncontrollable factors that emerge and that can be very influential
    on the trajectory of something. For example, the government could change regulations
    or trade policies that greatly help or hinder a company’s ability to operate and
    be profitable, or there could be an internal fraudulent accounting scandal in
    which the executives conspired to falsify corporate performance, which becomes
    untenable to maintain and ultimately bankrupts the company.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 金融公司使用上述免责声明的原因是，通常存在一些未知、不可控的因素出现，并且这些因素可能对某物的轨迹产生非常大的影响。例如，政府可能会改变法规或贸易政策，这可能会极大地帮助或阻碍公司的运营和盈利能力，或者可能发生内部欺诈会计丑闻，其中高管密谋伪造公司业绩，这最终变得难以维持并最终导致公司破产。
- en: 'These factors are deemed unknown and external because of the following reasons:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 由于以下原因，这些因素被认为是未知的外部因素：
- en: They are outside of the control of the entity itself (as in the example of the
    government dictating policies independently of a company’s activities).
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们超出了实体的控制范围（例如，政府独立于公司的活动制定政策）。
- en: They are hidden from the available information about a system (an outside investor,
    in real time, only has access to publicly available performance reports, and not
    to knowledge of fraudulent activities that may be fabricating those performance
    reports).
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们被隐藏在关于系统的可用信息中（例如，外部投资者在实时情况下只能访问公开的性能报告，而无法了解可能伪造这些性能报告的欺诈活动）。
- en: As such, predictions are only as good as the information you have and your ability
    to eliminate or mitigate external unknown factors that will affect your prediction.
    The same is true in the world of **Information Technology** (**IT**) data. It’s
    not always possible to predict a trend or a failure if an unknown, external factor
    is at play (someone incorrectly making a configuration change, a failing piece
    of hardware, and so on). However, we can use probabilistic analysis to give us
    our best guess at the future, aside from those possible external factors. Understanding
    this caveat allows us to satisfy some good forecasting use cases without getting
    hung up on the expectation of prophecy. Let’s now turn our focus to how we can
    use forecasting in a practical way.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，预测的准确性仅取决于你所拥有的信息和消除或减轻影响预测的外部未知因素的能力。在信息技术（IT）数据的世界中也是如此。如果存在未知的外部因素（例如，有人错误地进行了配置更改、硬件故障等），则可能无法预测趋势或故障。然而，我们可以使用概率分析来给出我们对未来的最佳猜测，除了那些可能的外部因素之外。理解这个注意事项使我们能够在不陷入预言期望的情况下满足一些良好的预测用例。现在，让我们将重点转向如何以实际的方式使用预测。
- en: Forecasting use cases
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测用例
- en: 'In the context of Elastic ML, there are really just two—somewhat similar—use
    cases in which someone would use forecasting. These are outlined here:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在Elastic ML的背景下，实际上只有两种——有些相似——的使用场景，人们会使用预测。这些场景在此概述：
- en: '**Value-focused**: This is where you extrapolate a time series into the future
    to understand a probable future value. This would be akin to answering questions
    such as: *“How many widgets will I sell per day 2 months from now?”*'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**价值导向**：这是将时间序列外推到未来，以了解可能的未来值。这类似于回答以下问题：“两个月后我每天将卖出多少个部件？”'
- en: '**Time-focused**: This is where you understand the likely time at which an
    expected value is to be reached. This would answer questions similar to: *“Do
    I expect to reach 80% utilization in the next week?”*'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**时间导向**：这是理解预期值可能达到的时间。这将回答类似以下问题：“我预计在下周达到80%的利用率吗？”'
- en: The differences between these two use cases might not just be how a question
    is asked (how the data is searched), but also how you interpret the output. However,
    before we delve into a few examples of how to use the forecasting feature, let’s
    take a little time to discuss how it works logistically.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这两种使用场景之间的差异可能不仅仅是提问方式（如何搜索数据），还包括你如何解释输出。然而，在我们深入探讨如何使用预测功能的一些示例之前，让我们花点时间讨论一下它在逻辑上的工作方式。
- en: Forecasting theory of operation
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测操作理论
- en: 'The first thing to realize is that the act of invoking a forecast on data is
    that it is an extension of an existing Anomaly Detection job. In other words,
    you need to have an Anomaly Detection job configured, and that job needs to have
    analyzed historical data before you can forecast on that data. This is because
    the forecasting process uses the models that are created by the Anomaly Detection
    job. To forecast the data, you need to follow the same steps that were used to
    create an Anomaly Detection job as described in other chapters. If anomalies were
    generated by the execution of that job, you can disregard them if your only purpose
    is to execute forecasting. Once the job has learned on some historical data, the
    model or models (if the job is configured to analyze data from more than one time
    series) associated with that job are current and up to date, as represented in
    the following diagram:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 首先要认识到，对数据进行预测的行为实际上是对现有异常检测工作的扩展。换句话说，你需要配置一个异常检测工作，并且该工作需要在预测数据之前分析历史数据。这是因为预测过程使用了异常检测工作创建的模型。要预测数据，你需要遵循在其他章节中描述的创建异常检测工作所使用的相同步骤。如果该工作执行过程中生成了异常，你可以忽略它们，如果你的唯一目的是执行预测。一旦工作在历史数据上学习完毕，与该工作关联的模型或模型（如果工作配置为分析来自多个时间序列的数据）就是当前的和最新的，如下面的图所示：
- en: '![Figure 4.1 – A symbolic representation of models gleaned from historical
    learning'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.1 – 从历史学习中获得模型的象征性表示](img/Figure_4.1.jpg)'
- en: '](img/B17040_04_1.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 B17040_04_1.jpg](img/B17040_04_1.jpg)'
- en: Figure 4.1 – A symbolic representation of models gleaned from historical learning
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.1 – 从历史学习中获得模型的象征性表示
- en: 'We’ll consider the time before **now** as **historical learning**—the time
    over which the models have learned on actual data. When the user wishes to invoke
    a forecast at a particular time, a copy of the model(s) is created, and a separate
    process is used to take those models and extrapolate them into the “future.” This
    process is run in parallel to not interfere with the original models and their
    evolution. This is represented in the following diagram:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将考虑现在之前的时间作为**历史学习**——模型在真实数据上学习的时间。当用户希望在特定时间调用预测时，会创建模型的一个副本，并使用一个独立的过程来将这些模型外推到“未来”。这个过程与原始模型及其演变并行运行，以避免干扰。以下图表展示了这一过程：
- en: '![Figure 4.2 – A symbolic representation of models copied for forecasting into
    the future'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.2 – 将模型复制用于未来预测的符号表示]'
- en: '](img/B17040_04_2.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片 B17040_04_2.jpg]'
- en: Figure 4.2 – A symbolic representation of models copied for forecasting into
    the future
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.2 – 将模型复制用于未来预测的符号表示]'
- en: The forecast values are written to the same results index as Anomaly Detection
    but as a special type of result (more detail on this later), and will be available
    for viewing in the **user interface** (**UI**) or accessible via the **application
    programming interface** (**API**).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 预测值将写入与异常检测相同的索引，但作为特殊类型的结果（稍后将有更多细节），并且可以在**用户界面**（**UI**）中查看或通过**应用程序编程接口**（**API**）访问。
- en: 'It’s important to note that the normal path of the **machine learning** (**ML**)
    job analyzing the actual real data will continue (if it is running in real time),
    and therefore after an amount of time there could be a difference between the
    predicted value for a future time (made at the time of the forecast) and the actual
    value when that time arrives, as shown in the following diagram:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要注意，分析实际真实数据的**机器学习**（**ML**）作业的正常路径将继续（如果它在实时运行），因此经过一段时间后，预测值（在预测时做出的）和到达该时间时的实际值之间可能会有差异，如下面的图表所示：
- en: '![Figure 4.3 – A symbolic representation of a forecasting error'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片 B17040_04_3.jpg]'
- en: '](img/B17040_04_3.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.3 – 预测误差的符号表示]'
- en: Figure 4.3 – A symbolic representation of a forecasting error
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.3 – 预测误差的符号表示]'
- en: This forecasting error is to be expected, but hopefully it will be minimal.
    The differential between the two is not currently used by Elastic ML, but perhaps
    in the future it could inform the models about more accurate subsequent forecasts.
    Surely it is also possible that an unknown external factor (as described earlier)
    could lead to a certain number of forecasting errors.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这种预测误差是可以预见的，但希望它将是微小的。两者之间的差异目前没有被Elastic ML使用，但也许在未来它可以向模型提供关于更准确后续预测的信息。当然，也有可能未知的外部因素（如前所述）会导致一定数量的预测误差。
- en: Another (perhaps simpler) way to think about uncertainty in predictions is to
    think about predicting the outcome of a coin toss. You could observe a sequence
    of prior coin flips, but if you are not taking into account the physics of the
    coin flip (speed, height, rotations, and so on) and are only relying on the outcome
    of past observations, then you’ll never get better than a 50/50 prediction on
    the outcome. Additionally, it is likely Elastic ML didn’t see behaviorally perfectly
    consistent data during the learning period. As such, with a certain amount of
    noise in the data, we should also expect a certain amount of variation or uncertainty
    in the forecast.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种（可能更简单）思考预测不确定性的方法是考虑预测抛硬币的结果。你可以观察一系列之前的抛硬币，但如果你不考虑抛硬币的物理特性（速度、高度、旋转等）并且只依赖于过去观察的结果，那么你永远无法在结果上做出超过50/50的预测。此外，Elastic
    ML在学习期间可能没有看到行为上完全一致的数据。因此，在数据中存在一定量的噪声的情况下，我们也应该预期预测中存在一定量的变化或不确定性。
- en: 'There can also be multiple forecasts made by the user at other times. These
    will be stored separately, as represented in the following diagram:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 用户还可以在其他时间做出多个预测。这些预测将被分别存储，如下面的图表所示：
- en: '![Figure 4.4 – A symbolic representation of invoking multiple forecasts at
    different times'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.4 – 在不同时间调用多个预测的符号表示]'
- en: '](img/B17040_04_4.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片 B17040_04_4.jpg]'
- en: Figure 4.4 – A symbolic representation of invoking multiple forecasts at different
    times
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.4 – 在不同时间调用多个预测的符号表示]'
- en: 'The distinction between **forecast #1** and **forecast #2** will be keyed off
    with an internal unique ID for each forecast instance. This will become apparent
    later when we look at how the forecast results are stored in the index.'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '**预测#1**和**预测#2**之间的区别将基于每个预测实例的内部唯一ID。当我们查看预测结果在索引中的存储方式时，这一点将变得明显。'
- en: Now that we have a base understanding of the logistical operation of the forecasting
    process, let’s walk through an example of how to use Elastic ML for forecasting
    on a single time series.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们对预测过程的物流操作有了基本了解，让我们通过一个例子来了解如何使用Elastic ML对单一时间序列进行预测。
- en: Single time series forecasting
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 单一时间序列预测
- en: To illustrate the procedure of forecasting, we will start with a dataset that
    is a single time series. While this dataset is generic, you could imagine that
    it could represent a system performance metric, the number of transactions processed
    by a system, or even sales revenue data. The important aspect of this dataset
    is that it contains several distinct time-based trends—a daily trend, a weekly
    trend, and an overall increasing trend. Elastic ML will discover all three trends
    and will effectively predict those into the future. It is good to note that the
    dataset also contains some anomalies, but (of course) future anomalies cannot
    be predicted as they are surprise events by definition. Since our discussion here
    is purely focused on forecasting, we will ignore the existence of any anomalies
    found in our dataset while building the models for forecasting.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明预测过程，我们将从一个单一时间序列的数据集开始。虽然这个数据集是通用的，你可以想象它可能代表一个系统性能指标、系统处理的交易数量，甚至销售收入的统计数据。这个数据集的重要之处在于它包含几个不同的基于时间的变化趋势——日趋势、周趋势和整体增长趋势。Elastic
    ML将发现所有这三个趋势，并将有效地预测它们到未来。值得注意的是，数据集还包含一些异常值，但（当然）未来的异常值无法预测，因为它们按定义是意外事件。由于我们在这里的讨论纯粹是关于预测，因此我们在构建预测模型时将忽略数据集中发现的任何异常值。
- en: 'With that said, let’s jump into an example by using the `forecast_example`
    dataset from the GitHub repository. Once downloaded, the data can be easily imported
    into your Kibana via Elastic ML’s Data Visualizer. Let’s proceed, as follows:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，让我们通过使用GitHub仓库中的`forecast_example`数据集来举一个例子。一旦下载，数据就可以通过Elastic ML的数据可视化器轻松导入到您的Kibana中。我们继续如下操作：
- en: To upload the sample data, from the Kibana home screen, click on the **Upload
    a file** button, as shown in the following screenshot:![Figure 4.5 – The option
    to upload a file in Kibana
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要上传示例数据，从Kibana主屏幕点击**上传文件**按钮，如下截图所示：![图4.5 – 在Kibana中上传文件的选项
- en: '](img/B17040_04_5.jpg)'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B17040_04_5.jpg)'
- en: Figure 4.5 – The option to upload a file in Kibana
  id: totrans-51
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图4.5 – 在Kibana中上传文件的选项
- en: Choose the `forecast_example.json` file from your local machine. Data Visualizer
    will then display the first 1,000 lines of the file to give you a preview of what
    the file contains, as well as a breakdown of the different fields. This is represented
    in the following screenshot:![Figure 4.6 – Previewing the contents of the file
    to upload
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从您的本地机器中选择`forecast_example.json`文件。数据可视化器将显示文件的前1000行，以供您预览文件内容，以及不同字段的分解。这体现在以下截图中：![图4.6
    – 预览要上传的文件内容
- en: '](img/B17040_04_6.jpg)'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B17040_04_6.jpg)'
- en: Figure 4.6 – Previewing the contents of the file to upload
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图4.6 – 预览要上传的文件内容
- en: Click on the **Import** button, then name the destination index for the data
    to be uploaded to, as illustrated in the following screenshot:![Figure 4.7 – Naming
    the destination index to upload to
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**导入**按钮，然后为要上传的数据指定目标索引名称，如下截图所示：![图4.7 – 为上传的目标索引命名
- en: '](img/B17040_04_7.jpg)'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B17040_04_7.jpg)'
- en: Figure 4.7 – Naming the destination index to upload to
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图4.7 – 为上传的目标索引命名
- en: Provide a name for your destination index, make sure the **Create index pattern**
    option is checked if this is your first time uploading, and click on the **Import**
    button again to complete the upload. You should see the successful completion
    of the upload, as shown in the next screenshot:![Figure 4.8 – Upload completed
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为您的目标索引提供一个名称，如果这是您第一次上传，请确保勾选**创建索引模式**选项，然后再次点击**导入**按钮以完成上传。您应该看到上传成功的提示，如下截图所示：![图4.8
    – 上传完成
- en: '](img/B17040_04_8.jpg)'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B17040_04_8.jpg)'
- en: Figure 4.8 – Upload completed
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图4.8 – 上传完成
- en: Once the data has been uploaded, navigate to **Machine Learning** and create
    an Anomaly Detection job, selecting the index pattern of the index name you created
    in the previous step. This is represented in the following screenshot:![Figure
    4.9 – Creating an Anomaly Detection job first
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据上传完成后，导航到**机器学习**并创建一个异常检测作业，选择你在上一步中创建的索引模式的索引名称。这在上面的屏幕截图中表示：![图 4.9 – 首先创建一个异常检测作业
- en: '](img/B17040_04_9.jpg)'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 4.12 – 选择在时间上对金额字段求和作为我们的检测](img/B17040_04_9.jpg)'
- en: Figure 4.9 – Creating an Anomaly Detection job first
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.9 – 首先创建一个异常检测作业
- en: This particular dataset is only a single, time-series metric (a field called
    `amount`), so we will simply use the **Single metric** job wizard to build the
    job, as illustrated in the following screenshot:![Figure 4.10 – Selecting the
    Single metric job wizard for this data
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这个特定的数据集仅包含一个单一的时间序列指标（一个名为`amount`的字段），因此我们将简单地使用**单个指标**作业向导来构建作业，如以下屏幕截图所示：![图
    4.10 – 为此数据选择“单个指标作业向导”
- en: '](img/B17040_04_10.jpg)'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 4.10 – 为此数据选择“单个指标作业向导”](img/B17040_04_10.jpg)'
- en: Figure 4.10 – Selecting the Single metric job wizard for this data
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.10 – 为此数据选择“单个指标作业向导”
- en: On the next screen and for this example, we will want to only analyze up to
    March 1, 2017 @ 00:00:00.000 in order to leave us some data to compare our forecast
    against later. You can accomplish this by first clicking the **Use full forecast_example
    data** button but then manually changing the ending date to match what is shown
    in the following screenshot:![Figure 4.11 – Selecting to use only data up to a
    certain date
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一屏幕和此示例中，我们只想分析到 2017 年 3 月 1 日 00:00:00.000，以便为我们留下一些数据来比较我们的预测。你可以通过首先点击**使用完整的
    forecast_example 数据**按钮，然后手动更改结束日期以匹配以下屏幕截图所示的内容：![图 4.11 – 选择只使用到特定日期的数据
- en: '](img/B17040_04_11.jpg)'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.12 – 选择在时间上对金额字段求和作为我们的检测
- en: Figure 4.11 – Selecting to use only data up to a certain date
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.11 – 选择只使用到特定日期的数据
- en: Note
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意
- en: This example dataset logs data from January 31, 2017 to March 1, 2017\. Despite
    being from the past, we can contrive a scenario in which we are pretending to
    be in that time frame, and we will declare that today’s date is March 1, 2017\.
    We therefore want to have an ML job analyze the data between January 31 and “today”,
    and then use ML to forecast that data 10 days into the future. We will later see
    how accurate our forecast is against the remainder of the data. If your Kibana
    time zone is set to your local time, the dates in this chapter may look slightly
    different, as the screenshots were taken with a version of Kibana that’s been
    set to the Eastern time zone of the **United States** (**US**).
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此示例数据集记录了从 2017 年 1 月 31 日到 2017 年 3 月 1 日的数据。尽管这些数据来自过去，我们可以设想一个场景，即我们假装处于那个时间段，并宣布今天的日期是
    2017 年 3 月 1 日。因此，我们希望有一个机器学习作业分析 1 月 31 日到“今天”之间的数据，然后使用机器学习预测未来 10 天的数据。我们稍后将看到我们的预测与剩余数据的准确性。如果你的
    Kibana 时区设置为本地时间，本章中的日期可能看起来略有不同，因为截图是在将 Kibana 设置为美国东部时区版本的 Kibana 上拍摄的。（**美国**）（**US**）
- en: Now, click the **Next** button to advance to the next step in the configuration
    wizard.
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在，点击**下一步**按钮以进入配置向导的下一步。
- en: After clicking the `amount` field is simply a numerical value over time. This
    is represented in the following screenshot:![Figure 4.12 – Selecting to sum the
    amount field over time as our detection
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“金额”字段后，它只是一个随时间变化的数值。这在上面的屏幕截图中表示：![图 4.12 – 选择在时间上对金额字段求和作为我们的检测
- en: '](img/B17040_04_12.jpg)'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 4.12 – 选择在时间上对金额字段求和作为我们的检测](img/B17040_04_14.jpg)'
- en: Figure 4.12 – Selecting to sum the amount field over time as our detection
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 4.12 – 选择在时间上对金额字段求和作为我们的检测](img/B17040_04_12.jpg)'
- en: Click the **Next** button to proceed, leaving the other options as their defaults
    for now.
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 点击**下一步**按钮继续，暂时保留其他选项为默认设置。
- en: Now, we need to name our Anomaly Detection job—in the `forecast_example` was
    used:![Figure 4.13 – Naming the Anomaly Detection job
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们需要命名我们的异常检测作业——在`forecast_example`中使用：![图 4.13 – 命名异常检测作业
- en: '](img/B17040_04_13.jpg)'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 4.12 – 选择在时间上对金额字段求和作为我们的检测](img/B17040_04_13.jpg)'
- en: Figure 4.13 – Naming the Anomaly Detection job
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.13 – 命名异常检测作业
- en: Again, leave the other options as their defaults and click the **Next** button.
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 再次，保留其他选项为默认设置，并点击**下一步**按钮。
- en: A validation step takes place to ensure that everything is properly set up for
    the analysis to work, as illustrated in the following screenshot:![Figure 4.14
    – Job validation step
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进行验证步骤以确保一切设置正确，以便分析可以正常工作，如以下屏幕截图所示：![图 4.14 – 作业验证步骤
- en: '](img/B17040_04_14.jpg)'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 4.11 – 选择只使用到特定日期的数据](img/B17040_04_11.jpg)'
- en: Figure 4.14 – Job validation step
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.14 – 作业验证步骤
- en: Click the **Next** button to proceed.
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 点击**下一步**按钮继续。
- en: At this point, the job is ready to be created, as shown in the following screenshot:![Figure
    4.15 – Anomaly Detection job ready to be created
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此阶段，工作已准备好创建，如下截图所示：![图 4.15 – 准备创建的异常检测工作
- en: '](img/B17040_04_15.jpg)'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B17040_04_15.jpg)'
- en: Figure 4.15 – Anomaly Detection job ready to be created
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.15 – 准备创建的异常检测工作
- en: After the **Create job** button is clicked, you will see an animated preview
    of the results superimposed on top of the data, as illustrated in the following
    screenshot:![Figure 4.16 – Results preview of job execution displayed
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建工作**按钮后，您将看到结果动画预览叠加在数据上方，如下述截图所示：![图 4.16 – 显示作业执行结果预览
- en: '](img/B17040_04_16.jpg)'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B17040_04_16.jpg)'
- en: Figure 4.16 – Results preview of job execution displayed
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.16 – 显示作业执行结果预览
- en: 'To access the ability to forecast, we need to click the **View Results** button,
    which will take us to **Single Metric Viewer**. In **Single Metric Viewer**, we
    can see the overall dataset and can appreciate the shape and complexity of the
    way this data behaves; there are both daily and weekly periodic components, as
    well as a gradual positive slope/trend that causes the data to drift up over time.
    This is depicted in the following screenshot:'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要访问预测功能，我们需要点击**查看结果**按钮，这将带我们到**单指标查看器**。在**单指标查看器**中，我们可以看到整体数据集，并可以欣赏到数据的行为方式及其形状和复杂性；既有日周期成分，也有周周期成分，以及一个逐渐上升的正斜率/趋势，导致数据随时间上升。这在下述截图中有展示：
- en: '![Figure 4.17 – Results with annotations displayed'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 4.17 – 显示注释的结果'
- en: '](img/B17040_04_17.jpg)'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B17040_04_17.jpg)'
- en: Figure 4.17 – Results with annotations displayed
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 4.17 – 显示注释的结果
- en: If we expose and explore the annotations, we actually see exactly where Elastic
    ML has detected different trends in the data. Also, remember that despite the
    fact we may only be interested in forecasting on this data, the job will still
    point out anomalies throughout the data’s history. We can simply ignore them in
    this case if we so choose.
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果我们暴露并探索注释，我们实际上可以看到 Elastic ML 在数据中检测到的不同趋势的确切位置。此外，请记住，尽管我们可能只对在此数据上预测感兴趣，但工作仍会在数据的历史中指出来异常。在这种情况下，如果我们选择，我们可以简单地忽略它们。
- en: 'To invoke a forecast on this data, click the `10d`), as illustrated in the
    following screenshot:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在此数据上调用预测，请点击`10d`），如下述截图所示：
- en: '![Figure 4.18 – Initiating a new 10-day forecast'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.18 – 启动新的 10 天预测'
- en: '](img/B17040_04_18.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B17040_04_18.jpg)'
- en: Figure 4.18 – Initiating a new 10-day forecast
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.18 – 启动新的 10 天预测
- en: Note
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: You should not attempt to ask for a forecasting duration that is longer than
    the duration of the data that the ML job has analyzed. In other words, don’t ask
    for a 2-week forecast if the ML job has only ever seen 1 week of data. At least
    have a one-to-one ratio of historical data to the amount that you want to forecast
    (and, ideally, you would have a higher ratio of historical data). Lastly, supply
    enough consistent data to learn about the principal patterns. For example, a minimum
    of three cycles of a periodic pattern is used to achieve the best possible predictions.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 不应尝试请求比 ML 工作已分析的数据持续时间更长的预测持续时间。换句话说，如果 ML 工作只看到一周的数据，就不要请求两周的预测。至少历史数据与想要预测的数量的比例应该是一对一（理想情况下，历史数据的比例会更高）。最后，提供足够一致的数据来了解主要模式。例如，使用至少三个周期性的模式循环来达到最佳预测效果。
- en: 'After clicking the **Run** button shown in *Figure 4.18*, the forecast will
    be invoked and run in the background. We can see the results of our forecast almost
    immediately, as illustrated in the following screenshot:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 点击*图 4.18*中显示的**运行**按钮后，预测将在后台调用并运行。我们可以几乎立即看到预测结果，如下述截图所示：
- en: '![Figure 4.19 – Forecast results'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 4.19 – 预测结果'
- en: '](img/B17040_04_19.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B17040_04_19.jpg)'
- en: Figure 4.19 – Forecast results
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.19 – 预测结果
- en: The shaded area around the forecast/predicted zone is the 95th percentile confidence
    interval. In other words, Elastic ML has estimated that there is a 95% chance
    that the future values will be within this range (and, likewise, only a 2.5% chance
    that the future values will be either above or below the confidence interval).
    The 95th percentile range is currently a fixed value and is not yet settable by
    the user.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 预测/预测区域周围的阴影区域是 95% 置信区间。换句话说，Elastic ML 估计未来值有 95% 的可能性将在这个范围内（同样，只有 2.5% 的可能性未来值将高于或低于置信区间）。目前
    95% 的置信区间是一个固定值，用户尚不能设置。
- en: Now that we have the ability to create simple forecasts from the UI, let’s explore
    the results of the forecast in more depth before moving on to a more complicated
    example.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了从UI创建简单预测的能力，在继续更复杂的示例之前，让我们更深入地探索预测的结果。
- en: Looking at forecast results
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查看预测结果
- en: 'Now that we have run a forecast, we can look in more depth at the results that
    are generated by the forecasting process. We can view the results of a previously
    created forecast at any time in the UI via one of two methods. The first way is
    to click the **Forecast** button in **Single Metric Viewer** to reveal a list
    of previous forecasts, like so:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经运行了一个预测，我们可以更深入地查看预测过程生成的结果。我们可以在UI中通过两种方法查看之前创建的预测的结果。第一种方法是点击**单指标查看器**中的**预测**按钮，以显示之前预测的列表，如下所示：
- en: '![Figure 4.20 – Viewing previously created forecasts from Single Metric Viewer'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.20 – 在单指标查看器中查看之前创建的预测'
- en: '](img/B17040_04_20.jpg)'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B17040_04_20.jpg)'
- en: Figure 4.20 – Viewing previously created forecasts from Single Metric Viewer
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.20 – 在单指标查看器中查看之前创建的预测
- en: 'Alternatively, you can view them in the **Job Management** page under the **Forecasts**
    tab for that job, as illustrated in the following screenshot:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，您可以在该作业的**预测**选项卡下的**作业管理**页面中查看它们，如下面的截图所示：
- en: '![Figure 4.21 – Viewing previously created forecasts from the Job Management
    page'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.21 – 在作业管理页面查看之前创建的预测'
- en: '](img/B17040_04_21.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B17040_04_21.jpg)'
- en: Figure 4.21 – Viewing previously created forecasts from the Job Management page
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.21 – 在作业管理页面查看之前创建的预测
- en: Note
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Forecast results built in Kibana have a default lifespan of 14 days. After that,
    the forecast results are deleted permanently. If a different expiration duration
    is desired, then the forecast will have to be invoked via the `_forecast` API
    endpoint, which will be discussed later but is documented at [https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-forecast.html](https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-forecast.html).
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在Kibana中构建的预测结果默认寿命为14天。之后，预测结果将被永久删除。如果需要不同的过期持续时间，则必须通过`_forecast` API端点调用预测，这将在稍后讨论，但已在[https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-forecast.html](https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-forecast.html)中记录。
- en: 'When viewing the forecast results in **Single Metric Viewer**, notice that
    when you hover your mouse over the forecast data points, a pop-up display will
    list three key pieces of information about the data point—the prediction value,
    the upper-bound value, and the lower-bound value, as illustrated in the following
    screenshot:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在**单指标查看器**中查看预测结果时，注意当你将鼠标悬停在预测数据点上时，一个弹出显示将列出关于该数据点的三个关键信息——预测值、上限值和下限值，如下面的截图所示：
- en: '![Figure 4.22 – Information revealed in the forecast’s pop-up display'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.22 – 预测弹出显示中显示的信息'
- en: '](img/B17040_04_22.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B17040_04_22.jpg)'
- en: Figure 4.22 – Information revealed in the forecast’s pop-up display
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.22 – 预测弹出显示中显示的信息
- en: 'Recall that the upper and lower bounds define a range of 95th percentile confidence.
    The prediction value is the value with the highest likelihood (probability). These
    three key values are stored in the `.ml-anomalies-*` results indices with the
    following names:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 回想一下，上限和下限定义了一个95%置信区间的范围。预测值是最有可能的值（概率）。这三个关键值存储在`.ml-anomalies-*`结果索引中，以下列名称：
- en: '`forecast_prediction`'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`forecast_prediction`'
- en: '`forecast_upper`'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`forecast_upper`'
- en: '`forecast_lower`'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`forecast_lower`'
- en: In [*Chapter 5*](B17040_05_Epub_AM.xhtml#_idTextAnchor090), *Interpreting Results*,
    we will learn how we can query the `.ml-anomalies-*` indices to locate information
    for forecasts and how we can leverage that information for other purposes, such
    as for dashboards or alerts.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在[*第五章*](B17040_05_Epub_AM.xhtml#_idTextAnchor090) *解释结果* 中，我们将学习如何查询`.ml-anomalies-*`索引以定位预测信息，以及我们如何利用这些信息用于其他目的，例如仪表板或警报。
- en: 'If we want to see how well Elastic ML’s forecasting did compared to the actual
    next 10 days of the dataset (remember—the ML job’s models haven’t yet actually
    seen those days), we can return to the **Job Management** page and start the data
    feed of the job to continue on and analyze the remainder of the data. To do so,
    click on the **Start datafeed** link from the menu on the right-hand side, as
    illustrated in the following screenshot:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想看看Elastic ML的预测与数据集接下来的10天实际数据相比做得如何（记住——机器学习作业的模型还没有真正看到那些天），我们可以回到**作业管理**页面并开始作业的数据馈送以继续并分析剩余的数据。为此，点击右侧菜单中的**启动数据馈送**链接，如图下所示：
- en: '![Figure 4.23 – Starting the data feed from the Job Management page'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.23 – 从作业管理页面开始数据馈送'
- en: '](img/B17040_04_23.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B17040_04_23.jpg]'
- en: Figure 4.23 – Starting the data feed from the Job Management page
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.23 – 从作业管理页面开始数据馈送
- en: 'Once the dialog comes up, set the **Search start time** field to **Continue
    from 2017-03-01 00:00:00** (or whatever it says it is for your local time zone),
    and specify the **Search end time** field to be March 11, 2017 at 12:00 AM, as
    illustrated in the following screenshot:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦弹出对话框，将**搜索开始时间**字段设置为**从2017-03-01 00:00:00继续**（或它显示的您本地时区的时间），并将**搜索结束时间**字段指定为2017年3月11日午夜12:00，如图下所示：
- en: '![Figure 4.24 – Continuing the data feed from where it previously left off'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.24 – 从上次停止的地方继续数据馈送'
- en: '](img/B17040_04_24.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B17040_04_24.jpg]'
- en: Figure 4.24 – Continuing the data feed from where it previously left off
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.24 – 从上次停止的地方继续数据馈送
- en: 'Once you have done this, return to **Single Metric Viewer** for the job, ensure
    that you are viewing the correct range of time with the Kibana time picker, and
    click on the **Forecast** button to view the previously created forecast, as described
    earlier in this chapter. You will now be able to see the forecast values superimposed
    over the actual values from the data, as illustrated in the following screenshot:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作后，返回作业的**单一度量查看器**，确保您使用Kibana时间选择器查看正确的时间范围，然后点击**预测**按钮查看本章前面描述的先前创建的预测。现在您将能够看到预测值叠加在数据实际值上，如图下所示：
- en: '![Figure 4.25 – Comparing the forecast to the actual data'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '![图4.25 – 将预测与实际数据比较'
- en: '](img/B17040_04_25.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B17040_04_25.jpg]'
- en: Figure 4.25 – Comparing the forecast to the actual data
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.25 – 将预测与实际数据比较
- en: As described earlier in this chapter, there will be a slight discrepancy between
    the Elastic ML prediction of the data and the actual value that arrives in the
    future. This is because the predictions are probabilistic, and with probability
    comes a certain level of uncertainty. However, this does not diminish the usefulness
    of the forecasts. Combined with proactive alerting (as described in [*Chapter
    6*](B17040_06_Epub_AM.xhtml#_idTextAnchor117), *Alerting on ML Analysis*), we
    could have been alerted to the possibility of a breach. This proactive notification
    is especially useful when users cannot track hundreds or thousands of entities
    individually. In the next section, we’ll see how multi-metric forecasting allows
    us to track those entities automatically.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 如本章前面所述，Elastic ML对数据的预测与未来到达的实际值之间将存在轻微的差异。这是因为预测是概率性的，而概率伴随着一定的不确定性。然而，这并不减少预测的有用性。结合主动警报（如[*第6章*](B17040_06_Epub_AM.xhtml#_idTextAnchor117)，*在机器学习分析上进行警报*）中所述），我们可能会被警告有违规的可能性。这种主动通知在用户无法单独跟踪数百或数千个实体时特别有用。在下一节中，我们将看到多度量预测如何使我们能够自动跟踪这些实体。
- en: Multiple time series forecasting
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多时间序列预测
- en: 'To invoke forecasting on multiple time series, you simply just need an ML job
    that is modeling multiple time series. Let’s assume that we have an ML job that
    has analyzed web requests per country. In fact, using the built-in sample web
    logs (`kibana_sample_data_logs`) we used in [*Chapter 3*](B17040_03_Epub_AM.xhtml#_idTextAnchor049),
    *Anomaly Detection*, we could easily create a multi-metric job that counts events,
    split on the source country code of the request (the field is called `geo.src`),
    as illustrated in the following screenshot:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 要在多个时间序列上调用预测，您只需要一个正在建模多个时间序列的机器学习作业。让我们假设我们有一个分析了按国家划分的Web请求的机器学习作业。实际上，使用我们在[*第3章*](B17040_03_Epub_AM.xhtml#_idTextAnchor049)，*异常检测*中使用的内置样本网络日志（`kibana_sample_data_logs`），我们可以轻松创建一个多度量作业，该作业按请求的源国家代码（该字段称为`geo.src`）分割事件计数，如图下所示：
- en: '![Figure 4.26 – Creating a multi-metric job for forecasting'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B17040_04_26.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.26 – Creating a multi-metric job for forecasting
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: 'There are 183 unique source countries in this dataset. After creating and running
    this Anomaly Detection job in order to build baseline models for all 183 countries,
    we are now in a position to invoke a forecast. If we approach the invocation of
    a forecast in the same way as we did before (via **Single Metric Viewer**), we
    might erroneously think that a forecast will only be executed for the series displayed,
    as illustrated in the following screenshot:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 4.27 – Invoking a multi-metric forecast from Single Metric Viewer'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B17040_04_27.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.27 – Invoking a multi-metric forecast from Single Metric Viewer
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: In the preceding screenshot (although it might be a little difficult to see
    in the faded background behind the popup), we can see that the country code selected
    for the `geo.src` field is `CN` (China). But, as pointed out in the warning message
    of the **Forecasting** popup, clicking on the **Run** button will invoke the forecast
    and will run for all partitions present in the job (here, it knows that there
    are more than 100 partitions).
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: 'Alternatively, we can use the `_forecast` API endpoint to invoke the forecast.
    To do so, in the **Dev Tools** console, we could issue this request:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Note
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: The Anomaly Detection job must be in an “open” state before you can invoke a
    forecast via the API.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
- en: 'The immediate response from the API call is as follows:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The results of our forecast request will be available for viewing either in
    **Single Metric Viewer** or programmatically by querying the results indices,
    to be described in [*Chapter 5*](B17040_05_Epub_AM.xhtml#_idTextAnchor090), *Interpreting
    Results*. With **Single Metric Viewer**, we can see the forecast for any country
    by clicking on the **Forecast** button, selecting our previously run forecast,
    then selecting the country code of our choice, as illustrated in the following
    screenshot:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 4.28 – Viewing a single partition’s forecast from a multi-metric forecast'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: '](img/B17040_04_28.jpg)'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4.28 – Viewing a single partition’s forecast from a multi-metric forecast
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: Viewing the results of a multi-metric forecast in **Single Metric Viewer** isn’t
    exactly ideal as of v7.10\. This is because the view only shows partitions that
    have anomalies recorded for them. This feature will be added in v7.11.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
- en: Forecasting across multiple time series could be extremely useful for capacity
    planning use cases, where hundreds or possibly thousands of entities need to be
    analyzed, and forecasting to see if any pending breaches in the near future are
    possible.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Elastic ML has an additional feature over and above anomaly detection: the
    ability to take and extrapolate time series models into the future for forecasting
    purposes. With use cases that include advanced breach detection and capacity planning,
    this feature alleviates the human burden of manually charting, tracking, and predicting
    where things are going in the future, based upon how they have behaved in the
    past.'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 弹性机器学习（Elastic ML）在异常检测功能之上，还具备一项额外特性：能够将时间序列模型外推到未来，用于预测目的。这一特性涵盖了包括高级入侵检测和容量规划在内的用例，减轻了人们手动绘制图表、跟踪和预测未来趋势的负担，这些趋势是基于过去的行为来预测的。
- en: In the next chapter, we’ll go deeper into the results that anomaly detection
    and forecasting give us, and we will set up a better understanding of how to leverage
    those results for dashboards and proactive alerts.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将更深入地探讨异常检测和预测为我们带来的结果，并更好地理解如何利用这些结果来构建仪表板和主动警报。

- en: '*Chapter 8*: Forecasting Using Time Series'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第 8 章*：使用时间序列进行预测'
- en: Predicting future trends using historical data is one of the most fascinating
    activities that we can do with machine learning.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 使用历史数据预测未来趋势是我们可以用机器学习做的最迷人的活动之一。
- en: Making predictions based on historical data points and time series is particularly
    interesting and can be very useful in different industries. Forecasting can help
    us in predicting the future, but also in identifying anomalies in data that don't
    respect the expected pattern.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 基于历史数据点和时间序列进行预测特别有趣，并且可以在不同行业中非常有用。预测可以帮助我们预测未来，也可以帮助我们识别不遵守预期模式的数据异常。
- en: In this chapter, we'll focus on time series forecasting by using the ARIMA Plus
    algorithm. This technique can be used to predict numerical values in different
    fields, such as the sales of a company, the customers in a restaurant, stock prices,
    and the electricity consumption of a building.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将通过使用 ARIMA Plus 算法来专注于时间序列预测。这项技术可以用于预测不同领域的数值，例如公司的销售额、餐厅的顾客数量、股票价格和建筑的电力消耗。
- en: 'To understand how we can use BigQuery ML to forecast trends and to effectively
    present our results, we''ll go through the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解我们如何使用 BigQuery ML 来预测趋势以及有效地展示我们的结果，我们将讨论以下主题：
- en: Introducing the business scenario
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: Discovering time series forecasting
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现时间序列预测
- en: Exploring and understanding the dataset
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索和理解数据集
- en: Training the time series forecasting model
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 训练时间序列预测模型
- en: Evaluating the time series forecasting model
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估时间序列预测模型
- en: Using the time series forecasting model
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用时间序列预测模型
- en: Presenting the forecast
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 展示预测结果
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter requires you to access a web browser and to have the possibility
    to leverage the following:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章要求你访问网络浏览器，并能够利用以下功能：
- en: A GCP account to access Google Cloud Console
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 GCP 账户以访问 Google Cloud Console
- en: A GCP project to host the BigQuery datasets
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 GCP 项目来托管 BigQuery 数据集
- en: Now, that we're ready with the technical requirements, let's dive into the analysis
    and development of our BigQuery ML forecasting model.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们已经准备好了技术要求，让我们深入分析和开发我们的 BigQuery ML 预测模型。
- en: 'Check out the following video to see the Code in Action: [https://bit.ly/2QY0Qlp](https://bit.ly/2QY0Qlp)'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下视频以查看代码的实际应用：[https://bit.ly/2QY0Qlp](https://bit.ly/2QY0Qlp)
- en: Introducing the business scenario
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: Imagine being a business analyst who works for the state of Iowa. The state
    monitors the retail distribution of liquors and spirits by collecting data from
    every shop in the territory. Controlling liquor sales is particularly important
    for monitoring citizen health and for checking tax income.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下你是一名为爱荷华州工作的商业分析师。该州通过收集领土内每个商店的数据来监控酒类和烈酒的零售分销。控制酒类销售对于监控公民健康和检查税收收入尤为重要。
- en: 'In the following screenshot, you can see a picture of typical shelves of liquors
    and spirits in a shop:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，你可以看到一家商店中典型的酒类和烈酒货架的图片：
- en: '![Figure 8.1 – The shelves in a liquor shop'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 8.1 – 酒店货架'
- en: '](img/B16722_08_001.jpg)'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_08_001.jpg)'
- en: Figure 8.1 – The shelves in a liquor shop
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.1 – 酒店货架
- en: For our business scenario, we can imagine that the state of Iowa wants to predict
    the number of liters that will be sold in the first 30 days of 2020 leveraging
    the historical data collected in the previous years.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的业务场景，我们可以想象爱荷华州想要利用前几年收集的历史数据来预测 2020 年前 30 天将售出的升数。
- en: Your manager may ask you to predict the number of liters that will be sold by
    all the shops in the state by leveraging the time series data that was already
    collected in the database.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 你的经理可能会要求你利用数据库中已经收集的时间序列数据来预测该州所有商店将售出的升数。
- en: As a business analyst, your job is to find the best algorithm to forecast the
    sales volumes and to present the results in a graphical way to the governor's
    staff.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一名商业分析师，你的任务是找到最佳的算法来预测销售量，并以图形方式向州长的工作人员展示结果。
- en: Now that we've explained and understood the problem statement, let's take a
    look at the machine learning technique that we can use to forecast the sales,
    by using historical data.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经解释并理解了问题陈述，让我们看看我们可以用来使用历史数据预测销售的机器学习技术。
- en: Discovering time series forecasting
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发现时间序列预测
- en: A **time series** is a sequence of data points mapped at a certain time frequency.
    For example, it can contain the price of a stock collected at regular intervals,
    the sales volumes of each day in a specific timeframe, or the temperature measured
    by an **Internet of Things** (**IoT**) sensor during the day.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '**时间序列**是一系列按一定时间频率映射的数据点。例如，它可以包含定期收集的股票价格，特定时间段内每天的销售量，或**物联网**（**IoT**）传感器在白天测量的温度。'
- en: 'In the following diagram, you can see a time series graph of the data collected
    by a temperature sensor in the first 15 days of 2020:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下图中，您可以看到2020年前15天由温度传感器收集的数据的时间序列图：
- en: '![Figure 8.2 – Example of time series generated by a temperature sensor'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '![图8.2 – 温度传感器生成的时间序列示例'
- en: '](img/B16722_08_002.jpg)'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_08_002.jpg)'
- en: Figure 8.2 – Example of time series generated by a temperature sensor
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.2 – 温度传感器生成的时间序列示例
- en: '**Forecasting** using time series analysis comprises the use of machine learning
    models to predict the future values of a specific measure by leveraging the known
    past data.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '**使用时间序列分析进行预测**包括使用机器学习模型通过利用已知的历史数据来预测特定测量的未来值。'
- en: 'BigQuery ML provides a specific machine learning algorithm to forecast numerical
    values using time series data. The algorithm is designed and developed to do the
    following:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: BigQuery ML提供了一种特定的机器学习算法，用于使用时间序列数据预测数值。该算法旨在执行以下操作：
- en: Automatically clean and adjust the training data to overcome the data quality
    issues, for example, missing or duplicated values and spikes.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动清理和调整训练数据以克服数据质量问题，例如缺失或重复的值和峰值。
- en: Compensate for variations caused by specific periods, such as holidays.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 补偿由特定时期（如节假日）引起的变异。
- en: Decompose trends using the Seasonal and Trend Decomposition Loess algorithm.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用季节性和趋势分解Loess算法分解趋势。
- en: Extrapolate the seasonality from the data.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从数据中推断季节性。
- en: And finally, apply the trend modeling of the **Autoregressive Integrated Moving
    Average** (**ARIMA**) model to predict future numerical values using historical
    ones.
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，应用**自回归积分移动平均**（**ARIMA**）模型的趋势建模，使用历史数据预测未来的数值。
- en: You can use ARIMA models to discover hidden patterns in time series data or
    to forecast the future values of a specific measure.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用ARIMA模型来发现时间序列数据中的隐藏模式或预测特定测量的未来值。
- en: In this section, we've learned the basics of time series forecasting. Now let's
    take a look at the dataset that we'll use to build our BigQuery ML model.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了时间序列预测的基础知识。现在让我们看看我们将用于构建BigQuery ML模型的数据集。
- en: Exploring and understanding the dataset
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索和理解数据集
- en: Before starting the development of the machine learning model, we'll start looking
    at the dataset and its structure.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始开发机器学习模型之前，我们将开始查看数据集及其结构。
- en: Let's start by getting a clear understanding of the time series data that we
    have in the BigQuery public dataset to build our forecasting model in the next
    section.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从对BigQuery公共数据集中我们拥有的时间序列数据进行清晰理解开始，以便在下一节构建我们的预测模型。
- en: Understanding the data
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解数据
- en: In this section, we'll analyze the structure of the data to identify the fields
    to use for the machine learning model creation.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将分析数据的结构以确定用于创建机器学习模型的字段。
- en: 'To start exploring the data, we need to do the following:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始探索数据，我们需要做以下几步：
- en: Log into our Google Cloud Console and access the **BigQuery** user interface
    from the navigation menu.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录我们的Google Cloud控制台，并通过导航菜单访问**BigQuery**用户界面。
- en: Create a new dataset under the project that we created in [*Chapter 2*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039),
    *Setting Up Your GCP and BigQuery Environment*. For this use case, we'll create
    the dataset `08_sales_forecasting` with the default options.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们创建的[*第2章*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039)，“设置您的GCP和BigQuery环境”中创建一个新的数据集。对于此用例，我们将使用默认选项创建名为`08_sales_forecasting`的数据集。
- en: Open the GCP project `iowa_liquor_sales`.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开GCP项目`iowa_liquor_sales`。
- en: 'As seen in the following screenshot, the BigQuery public dataset contains only
    one table that hosts the data collected from the liquor shops in Iowa:'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如以下截图所示，BigQuery公共数据集仅包含一个表，该表托管了爱荷华州酒类商店收集的数据：
- en: '![Figure 8.3 – The Iowa liquor sales public dataset contains the sales of all
    the liquor shops in Iowa'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图8.3 – 爱荷华州酒类销售公共数据集包含爱荷华州所有酒类商店的销售数据'
- en: '](img/B16722_08_003.jpg)'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_08_003.jpg)'
- en: Figure 8.3 – The Iowa liquor sales public dataset contains the sales of all
    the liquor shops in Iowa
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.3 – 爱荷华州酒类销售公共数据集包含爱荷华州所有酒类商店的销售数据
- en: We'll use the table **sales** to build our forecasting model. This table contains
    all the information about the liquor sold in the state of Iowa since 2012.
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们将使用**sales**表来构建我们的预测模型。这个表包含了自2012年以来爱荷华州州内所有酒类销售的信息。
- en: Let's click on the table name **sales** in the BigQuery navigation menu to access
    the schema of the table:![Figure 8.4 – The structure of the table lists all the
    information collected in the table
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们点击BigQuery导航菜单中的表名**sales**以访问表的模式：![图8.4 – 表的结构列出了表中收集的所有信息
- en: '](img/B16722_08_004.jpg)'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_08_004.jpg)'
- en: Figure 8.4 – The structure of the table lists all the information collected
    in the table
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.4 – 表的结构列出了表中收集的所有信息
- en: Each field is well described in the **Description** column.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每个字段都在**描述**列中有很好的描述。
- en: The table contains the column **date**, which represents the day of the sale.
    For our purposes, we'll try to forecast the total number of liters sold on a specific
    day. For this reason, we can notice the presence of the field **volume_sold_liters**.
    This numeric field expresses the quantity of liquor sold during each transaction.
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 表包含**date**列，它代表销售的日子。为了我们的目的，我们将尝试预测特定一天销售的总体积。因此，我们可以注意到**volume_sold_liters**字段的
    presence。这个数值字段表示每次交易中销售的酒类数量。
- en: In this section, we've analyzed the metadata of the **sales** table and understood
    which fields are interesting to build our forecasting model on. Next, it's time
    to look at the actual data and start querying it.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们已经分析了**sales**表的元数据，并了解了哪些字段对我们构建预测模型感兴趣。接下来，是时候查看实际数据并开始查询了。
- en: Checking the data quality
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 检查数据质量
- en: In this section, we'll apply some data quality checks to analyze the completeness
    of our training dataset.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将应用一些数据质量检查来分析我们的训练数据集的完整性。
- en: 'Let''s start analyzing the table that will be used to build our BigQuery ML
    model:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始分析将要用于构建我们的BigQuery ML模型的表格：
- en: 'In order to identify the timeframe of our dataset, let''s extract the minimum
    and maximum value of the `date` field from the `` `bigquery-public-data.iowa_liquor_sales.sales`
    `` table:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了确定数据集的时间范围，让我们从`bigquery-public-data.iowa_liquor_sales.sales`表提取`date`字段的最低值和最高值：
- en: '[PRE0]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: By executing this SQL statement, we can notice that the data goes from 2012
    to the end of November 2020.
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通过执行这个SQL语句，我们可以注意到数据从2012年开始，到2020年11月底结束。
- en: 'The result of the query is presented in the following screenshot:'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询结果如下所示：
- en: '![Figure 8.5 – The result of the query shows the timeframe of the dataset'
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图8.5 – 查询结果显示数据集的时间范围'
- en: '](img/B16722_08_005.jpg)'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_08_005.jpg)'
- en: Figure 8.5 – The result of the query shows the timeframe of the dataset
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.5 – 查询结果显示数据集的时间范围
- en: For our purposes, we can focus our attention on the sales that occurred in 2018
    and 2019 to forecast the first 30 days of 2020.
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了我们的目的，我们可以专注于2018年和2019年的销售，以预测2020年最初的30天。
- en: 'In the second step, we''ll analyze the number of distinct dates that we can
    find in the chosen timeframe:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第二步中，我们将分析在选定时间段内可以找到的唯一日期数量：
- en: '[PRE1]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The query `COUNT` and the `DISTINCT` values available in the field `date`. With
    the expression `EXTRACT (year from date)`, the SQL statement considers only the
    sales that happened in `2018` and `2019`.
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询`COUNT`和字段`date`中可用的`DISTINCT`值。使用表达式`EXTRACT (year from date)`，SQL语句仅考虑发生在`2018`年和`2019`年的销售。
- en: 'The result of the query is presented in the following screenshot:'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询结果如下所示：
- en: '![Figure 8.6 – The result of the query shows the distinct dates in the dataset'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '![图8.6 – 查询结果显示数据集中的唯一日期'
- en: '](img/B16722_08_006.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_08_006.jpg)'
- en: Figure 8.6 – The result of the query shows the distinct dates in the dataset
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.6 – 查询结果显示数据集中的唯一日期
- en: From the results, it's clear that the dataset doesn't contain the information
    for each day of the 2 years. This is probably caused by missing values due to
    public holidays and store closures. This is not a big issue because BigQuery ML
    will automatically manage the missing values during the training phase.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 从结果来看，数据集不包含两年中每一天的信息。这可能是由于公共假日和商店关闭导致的缺失值造成的。这不是一个大问题，因为BigQuery ML将在训练阶段自动管理缺失值。
- en: Now that we've performed some SQL queries to better understand our dataset,
    let's focus on creating our training dataset.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经执行了一些SQL查询以更好地了解我们的数据集，让我们专注于创建我们的训练数据集。
- en: Creating the training dataset
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建训练数据集
- en: In this section, we'll create a table to store the data points that will be
    used to train the forecasting model in the next section. Before training the model,
    we'll also use Data Studio to graphically analyze the time series.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将创建一个表格来存储将在下一节中用于训练预测模型的数据点。在训练模型之前，我们还将使用数据工作室来图形化分析时间序列。
- en: 'To train our model, we''ll create a specific table that will host the historical
    data points of our time series:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 为了训练我们的模型，我们将创建一个特定的表格，该表格将托管我们时间序列的历史数据点：
- en: 'Let''s create a table that contains only two fields. The first one is `date`
    and the second one is `total_sold_liters`:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们创建一个只包含两个字段的表格。第一个是`date`，第二个是`total_sold_liters`：
- en: '[PRE2]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The query creates the table `iowa_liquor_sales` in the dataset `08_sales_forecasting`.
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 该查询在数据集`08_sales_forecasting`中创建表`iowa_liquor_sales`。
- en: 'The table contains two different fields: the `date` column represents when
    the transaction happened and the second field is calculated as the `SUM` of the
    liquor quantities sold in a day. `total_sold_liters` is an aggregated value calculated
    on the `GROUP BY date` clause and for each day of the years `2018` and `2019`.'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 该表包含两个不同的字段：`date`列表示交易发生的时间，第二个字段是计算一天内销售的酒类数量的`SUM`。`total_sold_liters`是一个基于`GROUP
    BY date`子句的聚合值，并且对于`2018`年和`2019`年的每一天。
- en: The second step will be to graphically analyze the data stored in the table
    `iowa_liquor_sales`.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第二步将是图形化分析存储在`iowa_liquor_sales`表中的数据。
- en: 'As shown in the following screenshot, from the BigQuery navigation menu on
    the left, let''s select the dataset `08_sales_forecasting` and then the table
    `iowa_liquor_sales`:'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如以下截图所示，从左侧的大查询导航菜单中，让我们选择数据集`08_sales_forecasting`然后选择表`iowa_liquor_sales`：
- en: '![Figure 8.7 – The training table iowa_liquor_sales is visible in the BigQuery
    navigation menu'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图8.7 – 训练表iowa_liquor_sales在BigQuery导航菜单中可见'
- en: '](img/B16722_08_007.jpg)'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_08_007.jpg]'
- en: Figure 8.7 – The training table iowa_liquor_sales is visible in the BigQuery
    navigation menu
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.7 – 训练表iowa_liquor_sales在BigQuery导航菜单中可见
- en: After that, let's click on **EXPORT** and then **Explore with Data Studio**
    as presented in the following screenshot:![Figure 8.8 – From BigQuery, it's possible
    to open Data Studio
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后，让我们点击**导出**然后点击**使用数据工作室探索**，如下截图所示：![图8.8 – 从BigQuery中，可以打开数据工作室
- en: '](img/B16722_08_008.jpg)'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_08_008.jpg]'
- en: Figure 8.8 – From BigQuery, it's possible to open Data Studio
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.8 – 从BigQuery中，可以打开数据工作室
- en: '**Data Studio** is a free data visualization tool provided by Google and natively
    integrated with BigQuery that can be easily used to plot data in reports and diagrams.'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**数据工作室**是由Google提供的一个免费数据可视化工具，与BigQuery原生集成，可以轻松用于在报告和图表中绘制数据。'
- en: In Data Studio, we can select **Time series chart** as the chart type as shown
    in the following screenshot:![Figure 8.9 – In Data Studio, it's possible to select
    Time series chart to visualize the data
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在数据工作室中，我们可以选择**时间序列图表**作为图表类型，如下截图所示：![图8.9 – 在数据工作室中，可以选择时间序列图表来可视化数据
- en: '](img/B16722_08_009.jpg)'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_08_009.jpg]'
- en: Figure 8.9 – In Data Studio, it's possible to select Time series chart to visualize
    the data
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.9 – 在数据工作室中，可以选择时间序列图表来可视化数据
- en: Then, we can choose the field **date** for **Dimension** and **total_sold_liters**
    for **Metric**, as is presented in the following screenshot:![Figure 8.10 – In
    Data Studio, it's possible to select Dimension and Metric settings to draw the
    diagram
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们可以选择**日期**字段作为**维度**，以及**总销售升数**作为**度量**，如下截图所示：![图8.10 – 在数据工作室中，可以选择维度和度量设置来绘制图表
- en: '](img/B16722_08_010.jpg)'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_08_010.jpg]'
- en: Figure 8.10 – In Data Studio, it's possible to select Dimension and Metric settings
    to draw the diagram
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.10 – 在数据工作室中，可以选择维度和度量设置来绘制图表
- en: After that, we can move to the **Style** tab and select **Linear interpolation**
    in the **Missing Data** combo box:![Figure 8.11 – The Linear interpolation option
    allows to improve the visualization
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后，我们可以转到**样式**选项卡，并在**缺失数据**组合框中选择**线性插值**：![图8.11 – 线性插值选项允许改善可视化
- en: of the diagram in case of missing values
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 的图表在缺失值的情况下
- en: '](img/B16722_08_011.jpg)'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_08_011.jpg]'
- en: Figure 8.11 – The Linear interpolation option allows to improve the visualization
    of the diagram in case of missing values
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.11 – 线性插值选项允许在存在缺失值的情况下改善图表的可视化
- en: 'After these configurations, we can visualize the diagram drawn by Data Studio
    that represents the trend line of the liquor quantities sold in the selected period:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这些配置之后，我们可以可视化Data Studio绘制的图表，该图表表示所选期间销售的酒类数量的趋势线：
- en: '![Figure 8.12 – The time series is shown in Data Studio with a blue line on
    the chart'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '![图8.12 – 时间序列以图表上的蓝色线条在Data Studio中显示'
- en: '](img/B16722_08_012.jpg)'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_08_012.jpg)'
- en: Figure 8.12 – The time series is shown in Data Studio with a blue line on the
    chart
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.12 – 时间序列以图表上的蓝色线条在Data Studio中显示
- en: Now that we've created the table on which our forecasting model will be trained
    and visualized the data in a diagram, let's dive into the creation of the machine
    learning model.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经创建了我们的预测模型将进行训练和可视化的表，并在图表中显示了数据，让我们深入了解机器学习模型的创建。
- en: Training the time series forecasting model
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 训练时间序列预测模型
- en: In this section, we'll train the BigQuery ML time series forecasting model.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将训练BigQuery ML时间序列预测模型。
- en: 'Let''s start training the machine learning model `liquor_forecasting`, executing
    the following SQL statement:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始训练机器学习模型 `liquor_forecasting`，执行以下SQL语句：
- en: '[PRE3]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The SQL statement is composed of the following parts:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: SQL语句由以下部分组成：
- en: The first lines of the query start with the keywords `CREATE OR REPLACE MODEL`,
    followed by the identifier of the machine learning model, `` `08_sales_forecasting.liquor_forecasting`
    ``, and by `OPTIONS`.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查询的前几行以关键字 `CREATE OR REPLACE MODEL` 开头，后面跟着机器学习模型的标识符 `` `08_sales_forecasting.liquor_forecasting`
    ``，以及 `OPTIONS`。
- en: Now let's focus on the options that we've used to train our machine learning
    model. The selected model type is `'ARIMA'`. This option describes the algorithm
    that we're using to train the BigQuery ML forecasting model.
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 现在，让我们专注于我们用来训练机器学习模型的选项。选定的模型类型是 `'ARIMA'`。此选项描述了我们用来训练BigQuery ML预测模型的算法。
- en: '`time_series_timestamp_col = ''date''` specifies the column that is used to
    host the time of the data points in the time series.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`time_series_timestamp_col = ''date''` 指定了用于在时间序列中存储数据点时间的列。'
- en: The next option selects the column `total_sold_liters` as the column that stores
    the value of each data point and it's represented by the clause `time_series_data_col
    = 'total_sold_liters'`.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下一个选项选择 `total_sold_liters` 列作为存储每个数据点值的列，并由子句 `time_series_data_col = 'total_sold_liters'`
    表示。
- en: The property `auto_arima`, set to `TRUE`, allows BigQuery ML to automatically
    identify the parameters `p`, `d`, and `q` of the model.
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 属性 `auto_arima` 设置为 `TRUE`，允许BigQuery ML自动识别模型的参数 `p`、`d` 和 `q`。
- en: With the last parameter, `'AUTO_FREQUENCY'`, BigQuery automatically infers the
    frequency of the time series. In this case, the frequency is daily. The other
    options are `'HOURLY'`, `'DAILY'`, `'WEEKLY'`, `'MONTHLY'`, `'QUARTERLY'`, and
    `'YEARLY'`.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后一个参数 `'AUTO_FREQUENCY'`，BigQuery自动推断时间序列的频率。在这种情况下，频率是每日的。其他选项有 `'HOURLY'`、`'DAILY'`、`'WEEKLY'`、`'MONTHLY'`、`'QUARTERLY'`
    和 `'YEARLY'`。
- en: The final part of the SQL statement is composed of the `SELECT` statement applied
    on the training table `iowa_liquor_sales`.
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SQL语句的最后部分由对训练表 `iowa_liquor_sales` 应用 `SELECT` 语句组成。
- en: Now that we've trained the time series forecasting model based on the ARIMA
    algorithm, let's take a look at how we can evaluate it with the BigQuery ML syntax
    and the BigQuery UI.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经基于ARIMA算法训练了时间序列预测模型，让我们看看如何使用BigQuery ML语法和BigQuery UI来评估它。
- en: Evaluating the time series forecasting model
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估时间序列预测模型
- en: In this section, we'll evaluate the performance of the machine learning model
    that we trained in the previous one.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将评估我们在前一节中训练的机器学习模型的性能。
- en: The evaluation stage of a time series model can be performed by using the `ML.EVALUATE`
    BigQuery ML function.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列模型的评估阶段可以通过使用 `ML.EVALUATE` BigQuery ML函数来完成。
- en: 'Let''s execute the following query to extract all the evaluation parameters
    that characterize the ARIMA model:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下查询以提取所有表征ARIMA模型的评估参数：
- en: '[PRE4]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The results of the query are visualized in the following screenshot:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 查询的结果在以下屏幕截图中进行了可视化：
- en: '![Figure 8.13 – The records extracted from the evaluation of the time series
    forecasting model'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '![图8.13 – 从时间序列预测模型评估中提取的记录'
- en: '](img/B16722_08_013.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_08_013.jpg)'
- en: Figure 8.13 – The records extracted from the evaluation of the time series forecasting
    model
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.13 – 从时间序列预测模型评估中提取的记录
- en: 'Each row defines each non-seasonal ARIMA model classified as an **ARIMA(p,d,q)**
    model. For each row, we can notice the following:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 每一行定义了一个被分类为 **ARIMA(p,d,q)** 模型的非季节性 ARIMA 模型。对于每一行，我们可以注意到以下内容：
- en: The field **non_seasonal_p** represents the parameter **p** of the ARIMA model.
    The value of the row is the number of autoregressive terms used for the prediction.
    It indicates the number of observations used to predict the next value of the
    time series.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 字段 **non_seasonal_p** 代表 ARIMA 模型的参数 **p**。行值是用于预测的自回归项的数量。它表示用于预测时间序列下一个值的观测值数量。
- en: The field **non_seasonal_d** represents the parameter **d** of the ARIMA model.
    The value of the row indicates how many times it's necessary to apply the difference
    between one data point and the previous one to mitigate the seasonality of the
    dataset.
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 字段 **non_seasonal_d** 代表 ARIMA 模型的参数 **d**。行值表示需要将一个数据点与前一个数据点之间的差值应用多少次，以减轻数据集的季节性。
- en: '**non_seasonal_q** represents the parameter **q** of the ARIMA model. It indicates
    the number of observations to calculate the moving average that is used to predict
    the next value of the time series.'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**non_seasonal_q** 代表 ARIMA 模型的参数 **q**。它表示用于预测时间序列下一个值的移动平均数所计算的观测值数量。'
- en: '**has_drift** shows if a drift constant was applied to the model.'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**has_drift** 显示是否对模型应用了漂移常数。'
- en: '**log_likelihood** is a parameter that measures the level of fit of a statistical
    model to a specific dataset.'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**log_likelihood** 是一个参数，用于衡量统计模型与特定数据集的拟合程度。'
- en: '**AIC** represents the **Akaike Information Criterion**. This value is used
    to evaluate the goodness of the model. Lower values of AIC are generally better.
    For this reason, we can consider the first model the best.'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AIC** 代表 **Akaike 信息准则**。此值用于评估模型的好坏。AIC 的值越低，通常越好。因此，我们可以认为第一个模型是最好的。'
- en: '**variance** measures how far the data points are from the average value of
    the series.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**variance** 衡量数据点与序列平均值之间的距离。'
- en: The **seasonal_periods** column expresses the seasonal patterns in our data.
    In this case, BigQuery ML has identified a **WEEKLY** and **YEARLY** pattern in
    the sales time series.
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**seasonal_periods** 列表示我们数据中的季节性模式。在这种情况下，BigQuery ML 已经在销售时间序列中识别出 **WEEKLY**
    和 **YEARLY** 模式。'
- en: Now that we've presented the performance indicators of our time series forecasting
    model, let's try using it to forecast the first 30 days of 2020.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经介绍了我们时间序列预测模型的性能指标，让我们尝试使用它来预测 2020 年前 30 天的数据。
- en: Using the time series forecasting model
  id: totrans-146
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用时间序列预测模型
- en: To use our BigQuery ML model, we'll use the `ML.FORECAST` function to specify
    the parameters for the prediction.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用我们的 BigQuery ML 模型，我们将使用 `ML.FORECAST` 函数来指定预测的参数。
- en: 'The query will extract all the fields produced by the forecast function that
    accepts the following parameters:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 查询将提取由接受以下参数的预测函数生成的所有字段：
- en: The model name, `` `08_sales_forecasting.liquor_forecasting` ``, preceded by
    the keyword `MODEL`.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模型名称 `08_sales_forecasting.liquor_forecasting`，前面有 `MODEL` 关键字。
- en: 'A `STRUCT` that includes the `horizon` of the forecast: `30` days and the `confidence_level`
    chosen for the prediction – in this case, 80%:'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个包含预测的 `horizon`：`30` 天和选择的 `confidence_level` – 在这种情况下，80% 的 `STRUCT`：
- en: '[PRE5]'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The execution of the query generates the records shown in the following screenshot:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 查询的执行将生成以下屏幕截图所示的记录：
- en: '![Figure 8.14 – The results generated by the forecast function'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 8.14 – 预测函数生成的结果'
- en: '](img/B16722_08_014.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_08_014.jpg)'
- en: Figure 8.14 – The results generated by the forecast function
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.14 – 预测函数生成的结果
- en: We can notice in *Figure 8.14* that the predictions are chronologically ordered
    according to the date in the field `confidence_level` value of 0.8 means that
    80% of the predicted values should fall into the prediction interval identified
    by the fields **prediction_interval_lower_bound** and **prediction_interval_upper_bound**.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在 *图 8.14* 中注意到，预测是按照 `confidence_level` 字段中的日期按时间顺序排列的。值为 0.8 表示 80% 的预测值应落在由字段
    **prediction_interval_lower_bound** 和 **prediction_interval_upper_bound** 确定的预测区间内。
- en: Now that we've applied our model, let's understand how we can effectively present
    the results using Data Studio.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经应用了我们的模型，让我们了解如何有效地使用 Data Studio 展示结果。
- en: Presenting the forecast
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 展示预测结果
- en: In this section, we'll create a time series diagram with Data Studio in order
    to graphically present the forecast results.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用数据工作室创建一个时间序列图，以便图形化地展示预测结果。
- en: 'Using the following query, we can create a table that contains both the historical
    and forecasted values:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下查询，我们可以创建一个包含历史值和预测值的表格：
- en: '[PRE6]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The execution of the SQL statement generates the table `iowa_liquor_sales_forecast`,
    which is composed of the following:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 执行SQL语句生成`iowa_liquor_sales_forecast`表，该表由以下内容组成：
- en: All the records are from the training table, `iowa_liquor_sales`, from which
    we have extracted `history_date` and `history_value` of the time series. We've
    also added some `NULL` fields to standardize the schema with the second part of
    the query separated by `UNION ALL`.
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有记录都来自训练表`iowa_liquor_sales`，我们从其中提取了时间序列的`history_date`和`history_value`。我们还添加了一些`NULL`字段，以通过查询的第二部分与`UNION
    ALL`分隔的标准模式。
- en: All the forecasted records generated by the `ML.FORECAST` function were already
    applied in the previous section, *Using the time series forecasting model*. It's
    particularly interesting to notice that we don't extract only `forecast_value`,
    but also the lower and upper bounds of our predictions represented by the fields
    `prediction_interval_lower_bound` and `prediction_interval_upper_bound`.
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由`ML.FORECAST`函数生成的所有预测记录已在上一节*使用时间序列预测模型*中应用。特别值得注意的是，我们不仅提取了`forecast_value`，还提取了预测的下限和上限，分别由字段`prediction_interval_lower_bound`和`prediction_interval_upper_bound`表示。
- en: The presence of the `CAST` function, applied to the column `forecast_timestamp`,
    is necessary to change the data type from `TIMESTAMP` to `DATE` according to the
    schema of the training table.
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在`CAST`函数，应用于`forecast_timestamp`列，这是必要的，以便根据训练表的模式将数据类型从`TIMESTAMP`更改为`DATE`。
- en: 'As we''ve already done in the section *Creating the training dataset*, we can
    now do the following:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在*创建训练数据集*部分所做的那样，我们现在可以执行以下操作：
- en: Select from the BigQuery navigation menu the `iowa_liquor_sales_forecast` table
    that we just created.
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从BigQuery导航菜单中选择我们刚刚创建的`iowa_liquor_sales_forecast`表。
- en: Click on **Export** and then **Explore with Data Studio** to access the reporting
    tool.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**导出**然后**使用数据工作室探索**以访问报告工具。
- en: From the **chart** panel, choose **Time series chart**.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**图表**面板中选择**时间序列图表**。
- en: Drag and drop **history_value**, **forecast_value**, **prediction_interval_lower_bound**,
    and **prediction_interval_upper_bound** into the **Metric** panel as shown in
    the following screenshot:![Figure 8.15 – The DATA panel allows us to customize
    the metrics of the chart
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照以下截图所示，将**历史值**、**预测值**、**预测区间下限**和**预测区间上限**拖放到**指标**面板中：![图8.15 – 数据面板允许我们自定义图表的指标
- en: '](img/B16722_08_015.jpg)'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_08_015.jpg)'
- en: Figure 8.15 – The DATA panel allows us to customize the metrics of the chart
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.15 – 数据面板允许我们自定义图表的指标
- en: Move to the **Style** panel and scroll down until we find the **Missing Data**
    section. Here, we select **Linear interpolation**.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 移动到**样式**面板，向下滚动直到找到**缺失数据**部分。在这里，我们选择**线性插值**。
- en: Then, at the top of the screen, we can apply a filter on the **date** column
    to focus our chart only on the period that goes from the first of **December 2019**
    until the thirtieth of **January 2020**:![Figure 8.16 – Application of the filter
    on the date column
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，在屏幕顶部，我们可以对**日期**列应用过滤器，以便我们的图表仅关注从2019年12月1日到2020年1月30日的期间：![图8.16 – 在日期列上应用过滤器
- en: '](img/B16722_08_016.jpg)'
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_08_016.jpg)'
- en: Figure 8.16 – Application of the filter on the date column
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图8.16 – 在日期列上应用过滤器
- en: 'Clicking on **APPLY**, the chart will be finally visualized as shown in the
    following screenshot:'
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**应用**，图表最终将如图所示可视化：![图8.15 – 数据面板允许我们自定义图表的指标
- en: '![Figure 8.17 – Time series chart in Data Studio'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '![图8.17 – 数据工作室中的时间序列图表'
- en: '](img/B16722_08_017.jpg)'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_08_017.jpg)'
- en: Figure 8.17 – Time series chart in Data Studio
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.17 – 数据工作室中的时间序列图表
- en: Looking at the legend of the diagram, we can visualize the historical and the
    forecasted values represented by different colors. We can also notice that the
    **forecast_value** line is always included in the prediction interval.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 观察图表的图例，我们可以通过不同的颜色可视化历史值和预测值。我们还可以注意到，**预测值**线始终包含在预测区间内。
- en: Summary
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we've built our time series forecasting machine learning model.
    After the introduction of the business scenario, we discovered what time series
    forecasting is, and in particular, the ARIMA algorithm that is used to predict
    values from historical data points.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们构建了我们的时间序列预测机器学习模型。在介绍业务场景之后，我们发现了时间序列预测是什么，特别是用于从历史数据点预测值的 ARIMA 算法。
- en: Before diving into the development of the BigQuery ML model, we applied some
    analyses on the data collected by the state of Iowa related to liquor sales in
    the shops of the territory. For this purpose, we introduced the use of the reporting
    tool Data Studio, which can be easily accessed by the BigQuery UI and be leveraged
    to draw a time series chart.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入开发 BigQuery ML 模型之前，我们对爱荷华州收集的与该地区商店酒类销售相关的数据进行了分析。为此，我们引入了报告工具 Data Studio
    的使用，它可以通过 BigQuery UI 容易地访问，并利用它绘制时间序列图表。
- en: We then created our training table, which includes the time series of historical
    data, and trained our BigQuery ML model on it. Then, we evaluated the time series
    forecasting model by leveraging the BigQuery ML SQL syntax.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们创建了我们的训练表，其中包含历史数据的时间序列，并在其上训练了我们的 BigQuery ML 模型。然后，我们通过利用 BigQuery ML
    SQL 语法评估了时间序列预测模型。
- en: In the last step, we forecasted the quantity of liquor sold in Iowa with a horizon
    of 30 days and drew the results in a Data Studio dashboard that could be presented
    to non-technical people.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一步，我们使用 30 天的预测范围预测了爱荷华州销售的酒类数量，并在 Data Studio 仪表板上绘制了结果，该仪表板可以向非技术人员展示。
- en: In the next chapter, we'll introduce the matrix factorization algorithm to build
    recommendation engines.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍矩阵分解算法来构建推荐引擎。
- en: Further resources
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步资源
- en: '**Iowa Liquor Retail Sales Public Dataset**: [https://console.cloud.google.com/marketplace/product/iowa-department-of-commerce/iowa-liquor-sales](https://console.cloud.google.com/marketplace/product/iowa-department-of-commerce/iowa-liquor-sales)'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**爱荷华州酒类零售销售公共数据集**: [https://console.cloud.google.com/marketplace/product/iowa-department-of-commerce/iowa-liquor-sales](https://console.cloud.google.com/marketplace/product/iowa-department-of-commerce/iowa-liquor-sales)'
- en: '**BigQuery ML Create Model**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 创建模型**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)'
- en: '**BigQuery ML Evaluate Model**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 评估模型**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
- en: '**BigQuery ML Forecast**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-forecast](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-forecast)'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 预测**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-forecast](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-forecast)'
- en: '**BigQuery ML Time Series Forecasting example**: [https://cloud.google.com/bigquery-ml/docs/arima-single-timeseries-forecasting-tutorial](https://cloud.google.com/bigquery-ml/docs/arima-single-timeseries-forecasting-tutorial)'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 时间序列预测示例**: [https://cloud.google.com/bigquery-ml/docs/arima-single-timeseries-forecasting-tutorial](https://cloud.google.com/bigquery-ml/docs/arima-single-timeseries-forecasting-tutorial)'

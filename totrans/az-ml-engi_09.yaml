- en: '9'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '9'
- en: Productionizing Your Workload with MLOps
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用MLOps生产化您的负载
- en: '**MLOps** is a concept that enables **machine learning** (**ML**) workloads
    to scale through the automation of model training, model evaluation, and model
    deployment. MLOps enables traceability with code, data, and models. MLOps allows
    data scientists and ML professionals to make predictions available to business
    users at scale with the **Azure Machine Learning** (**AML**) services.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '**MLOps**是一个概念，它通过自动化模型训练、模型评估和模型部署，使**机器学习**（**ML**）工作负载能够进行扩展。MLOps通过代码、数据和模型实现可追溯性。MLOps允许数据科学家和ML专业人士通过**Azure
    Machine Learning**（**AML**）服务以规模化的方式将预测结果提供给商业用户。'
- en: MLOps is built on the concepts of **CI/CD**. CI/CD is a term that stands for
    **continuous integration/ continuous delivery** and has been used for software
    development for decades. CI/CD enables companies to scale their applications and
    by leveraging those same concepts, we can scale our ML projects, which will rely
    on CI/CD practices for our MLOps implementation.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: MLOps建立在**CI/CD**的概念之上。CI/CD代表**持续集成/持续交付**，这个术语在软件开发中已经使用了数十年。CI/CD使公司能够扩展其应用程序，通过利用这些相同的概念，我们可以扩展我们的ML项目，这些项目将依赖于CI/CD实践来实施MLOps。
- en: One of the challenges of this domain is its complexity. In this chapter, we
    will go through the scenario of retrieving data, transforming data, building a
    model, evaluating the model, deploying a model, then pending approval, registering
    it to a higher environment, and publishing the model as a managed online endpoint,
    routing traffic to the latest version of the model. This process will leverage
    Azure DevOps, AML SDK v2, and v2 of the CLI.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 这个领域的挑战之一是其复杂性。在本章中，我们将探讨以下场景：检索数据、转换数据、构建模型、评估模型、部署模型，然后等待批准，将其注册到更高环境，并将模型作为托管在线端点发布，将流量路由到模型的最新版本。这个过程将利用Azure
    DevOps、AML SDK v2和CLI的v2。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Understanding the MLOps implementation
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解MLOps实现
- en: Preparing your MLOps environment
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备您的MLOps环境
- en: Running an Azure DevOps pipeline
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行Azure DevOps管道
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To proceed with this chapter, the following are the requirements:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 要继续本章，以下是需要满足的要求：
- en: Two AML workspaces
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两个AML工作区
- en: An Azure DevOps organization, or the ability to create one
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个Azure DevOps组织，或者有创建一个的能力
- en: An Azure DevOps project within an Azure DevOps organization, or the ability
    to create one
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Azure DevOps组织中有一个Azure DevOps项目，或者有创建一个的能力
- en: The ability to assign permissions in the AML-deployed key vaults
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在AML部署的关键保管库中分配权限的能力
- en: The ability to create Azure DevOps variable groups
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建Azure DevOps变量组的能力
- en: Permission to link an Azure DevOps variable group to Azure key vault
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将Azure DevOps变量组链接到Azure关键保管库的权限
- en: Two service principals, or permissions to create service principals
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两个服务主体，或者有创建服务主体的权限
- en: Two service connections, one for each environment, or permissions to create
    service connections
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两个服务连接，每个环境一个，或者有创建服务连接的权限
- en: The ability to create an Azure DevOps pipeline within an Azure DevOps project
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Azure DevOps项目中创建Azure DevOps管道的能力
- en: The ability to create an environment within an Azure DevOps project
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Azure DevOps项目中创建环境的能力
- en: Understanding the MLOps implementation
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解MLOps实现
- en: As mentioned, MLOps is a concept, not an implementation. We will provide an
    implementation of MLOps as the foundation for this chapter. We will establish
    an Azure DevOps pipeline to orchestrate an AML pipeline for transforming data
    in the `dev` environment, create a model leveraging MLflow, and evaluate whether
    the model is performing better or equal to the existing model. Following this
    pipeline, if a new model is registered, we will deploy this new model in the `dev`
    environment leveraging `dev` environment, we will trigger an approval process
    to then register and deploy the new model into the `qa` environment, which will
    leverage blue/green deployments as well.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，MLOps是一个概念，而不是一个实现。我们将提供MLOps的实现作为本章的基础。我们将建立一个Azure DevOps管道来编排AML管道，以在`dev`环境中转换数据，利用MLflow创建模型，并评估模型是否比现有模型表现更好或相等。在此管道之后，如果注册了新模型，我们将利用`dev`环境部署此新模型，然后触发一个审批流程，将新模型注册和部署到`qa`环境，该环境将利用蓝/绿部署。
- en: Some organizations would choose not to register a model if it was performing
    just as well as the existing model, especially if the training data had not changed,
    but this will allow us to see how powerfully AML can handle updating a managed
    online endpoint. After a solid foundation has been applied, you can update the
    code to only register a model when it performs better than the existing model,
    but improving a model is an exercise left to you.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 一些组织可能会选择不注册表现与现有模型一样好的模型，尤其是如果训练数据没有变化，但这将使我们能够看到AML如何强大地处理更新托管在线端点。在打下坚实基础之后，您可以更新代码，仅在模型表现优于现有模型时才注册模型，但改进模型是留给您的一项练习。
- en: In this chapter, we will leverage an AML pipeline with AML SDK v2, v2 of the
    CLI, Azure DevOps organizations, and Azure DevOps projects, and take advantage
    of Azure Key Vault, which has been automatically deployed for you when deploying
    your environment. You will leverage two AML workspaces. For this chapter, we will
    refer to them as `dev` and `qa`.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将利用AML SDK v2、CLI v2、Azure DevOps组织和Azure DevOps项目中的AML管道，并利用在部署环境时自动为您部署的Azure
    Key Vault。您将利用两个AML工作区。对于本章，我们将称它们为`dev`和`qa`。
- en: 'In order to break down the MLOps implementation, the following diagram represents
    the flow that we will create for your MLOps implementation:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 为了分解MLOps的实施过程，以下图表展示了我们将为您创建的MLOps实施流程：
- en: '![Figure 9.1 – MLOps implementation](img/B18003_09_001.jpg)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![图9.1 – MLOps实施](img/B18003_09_001.jpg)'
- en: Figure 9.1 – MLOps implementation
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.1 – MLOps实施
- en: In the preceding figure, Azure DevOps is the orchestrator. When code is checked
    into the **main** branch, Azure DevOps will trigger off the Azure DevOps pipeline.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的图中，Azure DevOps是协调器。当代码被检入**主**分支时，Azure DevOps将触发Azure DevOps管道。
- en: We will create an Azure DevOps pipeline that consists of two stages. One stage
    is `dev stage`, and one will be `qa stage`. In `dev stage`, we will leverage the
    AML CLI to first get the initial model version and place it into a variable in
    the DevOps pipeline. After retrieving the model version, we will run the AML pipeline
    that handles the model creation and registration. After running the AML pipeline,
    we will retrieve the model version again in the Azure DevOps pipeline. If the
    model version has not changed, we know that no new model has been registered.
    If the model version has increased, then we know we want to deploy this model
    in the `dev` environment through Azure DevOps and proceed to deploy this model
    to the `qa` environment. Given the `qa` environment is a higher environment, we
    will include an approval process. The registration and deployment into the `qa`
    environment must first be approved. Once it is approved, the registration and
    deployment into the `qa` environment will proceed.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将创建一个包含两个阶段的Azure DevOps管道。一个阶段是`dev阶段`，另一个是`qa阶段`。在`dev阶段`，我们将利用AML CLI首先获取初始模型版本并将其放置到DevOps管道中的一个变量中。在检索模型版本后，我们将运行处理模型创建和注册的AML管道。在运行AML管道后，我们将在Azure
    DevOps管道中再次检索模型版本。如果模型版本没有变化，我们知道没有新模型被注册。如果模型版本增加，那么我们知道我们想要通过Azure DevOps在`dev`环境中部署此模型，并继续将此模型部署到`qa`环境。鉴于`qa`环境是一个更高环境，我们将包括一个审批流程。注册和部署到`qa`环境必须首先获得批准。一旦获得批准，注册和部署到`qa`环境将进行。
- en: As part of the managed online endpoint, we can deploy a new model to an existing
    managed online endpoint through blue/green deployments. When a model is first
    deployed to a managed online endpoint, we set the traffic to 100%. In the case
    of a new version of a model being deployed, we initially set the traffic to 0
    for the new model, wait for it to be successfully deployed, and for the given
    managed online endpoint, we will then swap the traffic to the latest version of
    the model to 100% and delete the old model deployment. This ensures the uptime
    for a given managed online endpoint. Users of the rest endpoint will not be interrupted
    during the model deployment process once a managed online endpoint is deployed.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 作为托管在线端点的一部分，我们可以通过蓝绿部署将新模型部署到现有的托管在线端点。当一个模型首次部署到托管在线端点时，我们将流量设置为100%。在部署模型的新版本时，我们最初将新模型的流量设置为0，等待其成功部署，然后对于给定的托管在线端点，我们将流量切换到最新版本的模型，设置为100%，并删除旧模型部署。这确保了给定托管在线端点的正常运行时间。一旦部署了托管在线端点，在模型部署过程中，其他端点的用户不会受到干扰。
- en: To set up our MLOps pipeline we will leverage several key resources. During
    the MLOps automation pipeline, we will leverage a `dev` AML workspace, and one
    for connecting to the `qa` AML workspace. In addition to the service connections,
    we will leverage the **key vaults** for each of the environments storing sensitive
    information. We will link these key vaults using **variable groups** in Azure
    DevOps. This will keep our Azure DevOps pipelines clean and easy to understand.
    Refer to *Figure 9**.1* for a visual overview of the resources we are going to
    leverage.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 为了设置我们的 MLOps 管道，我们将利用几个关键资源。在 MLOps 自动化管道中，我们将利用一个 `dev` AML 工作区，以及一个用于连接到
    `qa` AML 工作区的工作区。除了服务连接外，我们还将利用每个环境中存储敏感信息的**密钥保管库**。我们将使用 Azure DevOps 中的**变量组**链接这些密钥保管库。这将使我们的
    Azure DevOps 管道保持清洁且易于理解。请参阅*图 9**.1*以了解我们将利用的资源概述。
- en: This chapter is an opportunity to leverage your understanding of the functionality
    implemented so far in this book and put it all into practice. Let us get started
    looking at the technical requirements for a successful MLOps pipeline implementation
    leveraging the AML CLI v2 and SDK v2 with Azure DevOps.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 本章是利用你对本书中迄今为止实现的功能的理解并将其付诸实践的机会。让我们开始查看成功利用 AML CLI v2 和 SDK v2 以及 Azure DevOps
    实现的 MLOps 管道的技术要求。
- en: Preparing your MLOps environment
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备你的 MLOps 环境
- en: 'In this section, we will go through ensuring that the technical requirements
    are fulfilled, given you have permission to do so. To prepare your environment,
    we will be doing the following:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将确保技术要求得到满足，前提是你有权限这样做。为了准备你的环境，我们将执行以下操作：
- en: Creating a second AML workspace
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建第二个 AML 工作区
- en: Creating an Azure DevOps Organization and Project
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 Azure DevOps 组织和项目
- en: Confirming the code in the `dev` AML workspace
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认 `dev` AML 工作区中的代码
- en: Moving the code to your Azure DevOps Repo
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将代码移动到你的 Azure DevOps 仓库
- en: Setting up variables in Azure Key Vault
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Azure Key Vault 中设置变量
- en: Setting up Azure DevOps environment variable groups
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置 Azure DevOps 环境变量组
- en: Creating an Azure DevOps environment
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 Azure DevOps 环境
- en: Setting your Azure DevOps service connections
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置你的 Azure DevOps 服务连接
- en: Creating an Azure DevOps pipeline
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 Azure DevOps 管道
- en: Running an Azure DevOps pipeline
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 Azure DevOps 管道
- en: Creating a second AML workspace
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建第二个 AML 工作区
- en: 'Up to this point, you have been working in a single AML workspace. With our
    MLOps pipeline implementation, we will be using two workspaces. For information
    on deploying a second AML workspace, see [*Chapter 1*](B18003_01.xhtml#_idTextAnchor020),
    *Introducing the Azure Machine Learning Service*. After you have created a second
    AML workspace, continue to the next step: *Creating an Azure DevOps organization*
    *and project*.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你一直在单个 AML 工作区中工作。通过我们的 MLOps 管道实现，我们将使用两个工作区。有关部署第二个 AML 工作区的信息，请参阅[*第
    1 章*](B18003_01.xhtml#_idTextAnchor020)，*介绍 Azure 机器学习服务*。在创建第二个 AML 工作区后，继续下一步：*创建
    Azure DevOps 组织* *和项目*。
- en: Creating an Azure DevOps organization and project
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 Azure DevOps 组织和项目
- en: An Azure DevOps pipeline is held within an **Azure DevOps project**. An Azure
    DevOps project is held within an **Azure DevOps organization**. You will be required
    to have an Azure DevOps project to host your code repository that you can write
    code to and create Azure DevOps pipelines, create service connections, create
    variable groups, and link to your key vaults. You may already have an Azure DevOps
    organization set up. Your administrator will have chosen either to have a single
    project in an Azure DevOps organization that supports many repositories and many
    Azure DevOps pipelines or to have many projects with one or many repositories
    in an Azure DevOps organization. If your administrator has already created an
    Azure DevOps organization, you can either request a new Azure DevOps project within
    the Azure DevOps organization, or access to an existing Azure DevOps project with
    a repository to hold your code, and the ability to create Azure DevOps pipelines.
    If you already have an Azure DevOps organization and project, continue to the
    next subsection, *Confirming code in the dev* *AML workspace*.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: Azure DevOps管道位于**Azure DevOps项目**中。Azure DevOps项目位于**Azure DevOps组织**中。您将需要一个Azure
    DevOps项目来托管您的代码存储库，您可以在其中编写代码并创建Azure DevOps管道，创建服务连接，创建变量组，并将它们链接到您的密钥保管库。您可能已经设置了Azure
    DevOps组织。您的管理员可以选择在Azure DevOps组织中有一个支持多个存储库和多个Azure DevOps管道的单个项目，或者有多个项目，每个项目有一个或多个存储库。如果您的管理员已经创建了Azure
    DevOps组织，您可以在Azure DevOps组织中请求一个新的Azure DevOps项目，或者访问一个现有的Azure DevOps项目，该项目包含存储库以保存您的代码，并具有创建Azure
    DevOps管道的能力。如果您已经有一个Azure DevOps组织和项目，请继续下一小节，*确认dev AML工作区中的代码*。
- en: We will continue with setting up an Azure DevOps organization through the web
    portal. An Azure DevOps organization will host your project, and a project will
    hold your source code in a repository, as well as Azure DevOps pipelines for automating
    your MLOps pipeline.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过Web门户继续设置Azure DevOps组织。Azure DevOps组织将托管您的项目，而项目将在存储库中保存您的源代码，以及用于自动化MLOps管道的Azure
    DevOps管道。
- en: 'If you do not have an Azure DevOps organization, please follow the following
    steps to create one:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有Azure DevOps组织，请按照以下步骤创建一个：
- en: Sign in to Azure DevOps at [https://dev.azure.com/](https://dev.azure.com/).
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在[https://dev.azure.com/](https://dev.azure.com/)登录Azure DevOps。
- en: 'In the left-hand menu, select **New organization** as shown in the following
    screenshot:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧菜单中，选择如图所示**新建组织**：
- en: '![Figure 9.2 – New organization](img/B18003_09_002.jpg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![图9.2 – 新组织](img/B18003_09_002.jpg)'
- en: Figure 9.2 – New organization
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.2 – 新组织
- en: This will bring up a new window for getting started with the process of creating
    an Azure DevOps organization. Then, click on the **Continue** button.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将打开一个新窗口，用于开始创建Azure DevOps组织的流程。然后，点击**继续**按钮。
- en: '![Figure 9.3 – Get started with Azure DevOps](img/B18003_09_003.jpg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![图9.3 – 开始使用Azure DevOps](img/B18003_09_003.jpg)'
- en: Figure 9.3 – Get started with Azure DevOps
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.3 – 开始使用Azure DevOps
- en: 'This brings you to the next screen for creating your Azure DevOps organization:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将带您进入创建Azure DevOps组织的下一屏幕：
- en: '![Figure 9.4 – Creating your Azure DevOps organization](img/B18003_09_004.jpg)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![图9.4 – 创建您的Azure DevOps组织](img/B18003_09_004.jpg)'
- en: Figure 9.4 – Creating your Azure DevOps organization
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.4 – 创建您的Azure DevOps组织
- en: 'Azure DevOps organizations are required to be unique, so you need to create
    yours with a name that has not already been taken. As shown in *Figure 9**.4*,
    populate the following information:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: Azure DevOps组织必须是唯一的，因此您需要使用尚未被占用的名称创建自己的组织。如图*图9.4*所示，填写以下信息：
- en: Name your organization. A unique organization is required. In the preceding
    example, we have opted for `mmxdevops`.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 命名您的组织。需要一个唯一的组织。在先前的示例中，我们选择了`mmxdevops`。
- en: The location at which to host your projects – we have selected **Central US**.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 存储项目的位置 – 我们已选择**美国中部**。
- en: Enter the characters you see on the screen – we have typed `Dp5Ls` for validation.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入屏幕上显示的字符 – 我们已输入`Dp5Ls`进行验证。
- en: Click on the **Continue** button.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**继续**按钮。
- en: The next screen will ask you to fill in the **Project name** field for where
    your code and MLOps pipelines will be held. As shown in *Figure 9**.5*, we have
    selected a **Private** project. If you are working in an organization, you may
    see an option for an **Enterprise** project. If this option is not available to
    you, create a **Private** project. Creating a **Public** project will allow public
    access to your project. A private project will give you the ability to add users
    that you choose to your project if you would like to share it. Finally, click
    on the **+ Create** **project** button.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一屏将要求您填写**项目名称**字段，您的代码和MLOps管道将在此处存放。如图9.5*所示，我们已选择**私有**项目。如果您在组织中工作，您可能会看到一个**企业**项目的选项。如果此选项对您不可用，请创建一个**私有**项目。创建**公共**项目将允许公众访问您的项目。私有项目将允许您添加您选择的用户到项目中，如果您想分享它。最后，点击**+
    创建项目**按钮。
- en: '![Figure 9.5 – Creating an Azure DevOps organization](img/B18003_09_005.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![图9.5 – 创建Azure DevOps组织](img/B18003_09_005.jpg)'
- en: Figure 9.5 – Creating an Azure DevOps organization
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.5 – 创建Azure DevOps组织
- en: Now that your project has been created, you will have a place to hold key resources
    required for MLOps.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您的项目已经创建，您将有一个地方来存放MLOps所需的关键资源。
- en: 'The Azure DevOps project includes the following two key components:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: Azure DevOps项目包括以下两个关键组件：
- en: '**Repos**: A place to store your code'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Repos**：存储您的代码的地方'
- en: '**Pipelines**: A place to create your MLOps pipeline automation'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Pipelines**：创建您的MLOps管道自动化的地方'
- en: 'We will leverage these as shown in *Figure 9**.6*:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将利用这些，如图9.6*所示：
- en: '![Figure 9.6 – Creating an Azure DevOps organization](img/B18003_09_006.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![图9.6 – 创建Azure DevOps组织](img/B18003_09_006.jpg)'
- en: Figure 9.6 – Creating an Azure DevOps organization
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.6 – 创建Azure DevOps组织
- en: We will explore leveraging both **Repos** and **Pipelines** later in the chapter.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章后面探索利用**Repos**和**Pipelines**。
- en: Congratulations – you have set up an Azure DevOps organization and project.
    Now it is time to dig into creating the repository for holding your code.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜您 – 您已设置好Azure DevOps组织和项目。现在，是时候深入创建用于存放代码的仓库了。
- en: 'In *Figure 9**.6*, you can see that **Repos** is one of the menu options. Select
    this to enter the repository section of your Azure DevOps project as shown in
    *Figure 9**.7*:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图9.6*中，你可以看到**Repos**是菜单选项之一。选择此选项即可进入Azure DevOps项目的仓库部分，如图9.7*所示：
- en: '![Figure 9.7 – Empty repository](img/B18003_09_007.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![图9.7 – 空仓库](img/B18003_09_007.jpg)'
- en: Figure 9.7 – Empty repository
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.7 – 空仓库
- en: There are three important items that we will copy and save for future use. Selecting
    the copy button, as shown in *Figure 9**.7* marked as **a**, will copy the URL
    to your Git repository. Selecting the **Generate Git Credentials** button, marked
    as **b** in the figure, will give you a user and password. We will provide the
    information to link the code in your AML workspace to your Azure DevOps repository
    in the AML terminal.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 有三个重要项目我们将复制并保存以供将来使用。选择复制按钮，如图9.7*中标记为**a**所示，将复制Git仓库的URL。选择**生成Git凭据**按钮，如图中标记为**b**所示，将为您提供用户名和密码。我们将在AML终端中提供这些信息，以将AML工作区中的代码链接到您的Azure
    DevOps仓库。
- en: Tip
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: 'At any time, to head to your DevOps Project, you can enter the following URL:
    `https://dev.azure.com/<organization_name>/<project_name>`.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何时候，要前往您的DevOps项目，您可以输入以下URL：`https://dev.azure.com/<组织名称>/<项目名称>`.
- en: Now that we have copied the URL, the user, and the password for connecting to
    your Azure DevOps project, we are ready to review the next requirement for your
    AML workspace.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经复制了连接到您的Azure DevOps项目的URL、用户名和密码，我们已准备好审查您AML工作区下一个要求。
- en: Connecting to your AML workspace
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连接到您的AML工作区
- en: In addition to your Azure DevOps organization and project, we will need to connect
    to your AML workspace to leverage SDK v2 and the AML CLI v2 to implement an MLOps
    pipeline, as done in previous chapters.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 除了您的Azure DevOps组织和项目，我们还需要连接到您的AML工作区，以便利用SDK v2和AML CLI v2实现MLOps管道，正如前几章所做的那样。
- en: 'In the previous chapter, we cloned the Git repository. If you have not already
    done so, continue to follow the steps provided ahead. If you have already cloned
    the repository, skip ahead to the next section:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一章中，我们克隆了Git仓库。如果您还没有这样做，请继续按照前面提供的步骤操作。如果您已经克隆了仓库，请跳到下一节：
- en: 'Open the terminal on your **Compute** instance. Note that the path will include
    your user in the directory. Type the following into the terminal to clone the
    sample notebooks into your working directory:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的 **Compute** 实例上打开终端。请注意，路径将包括您的用户目录。在终端中输入以下内容以将示例笔记本克隆到您的工作目录：
- en: '[PRE0]'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Clicking on the refresh icon will update and refresh the notebooks displayed
    on your screen.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击刷新图标将更新并刷新屏幕上显示的笔记本。
- en: 'Review the notebooks in your `Azure-Machine-Learning-Engineering` directory.
    This will display the files cloned into your working directory as shown in *Figure
    9**.8*:'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查您的 `Azure-Machine-Learning-Engineering` 目录中的笔记本。这将显示克隆到您工作目录中的文件，如图 *图9.8*
    所示：
- en: '![Figure 9.8 – Azure-Machine-Learning-Engineering directory](img/B18003_09_008.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![图9.8 – Azure-Machine-Learning-Engineering目录](img/B18003_09_008.jpg)'
- en: Figure 9.8 – Azure-Machine-Learning-Engineering directory
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.8 – Azure-Machine-Learning-Engineering目录
- en: Now that your code is in your `dev` AML environment, you are ready to move your
    code to your Azure DevOps repo. At this point, the code required to build your
    MLOps pipeline is in your AMLS workspace. In the next subsection, we will move
    your code from the AML workspace into the DevOps repo in your Azure DevOps project.
    This connection will simulate the work a data scientist or MLOps engineer would
    do. Write code in your AML workspace, and commit that code to your Azure DevOps
    repo.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您的代码已经在您的 `dev` AML环境中，您已经准备好将代码移动到您的Azure DevOps仓库。在此阶段，构建MLOps管道所需的代码已经在您的ALMS工作空间中。在下一个小节中，我们将把您的代码从AML工作空间移动到Azure
    DevOps项目中的DevOps仓库。这种连接将模拟数据科学家或MLOps工程师的工作。在AML工作空间中编写代码，并将该代码提交到您的Azure DevOps仓库。
- en: Moving code to the Azure DevOps repo
  id: totrans-95
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将代码移动到Azure DevOps仓库
- en: We already have your code in our first AML workspace, which is referred to as
    our `dev` AML workspace. Now, we will move your code over to our Azure DevOps
    repo.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在我们的第一个AML工作空间中有了您的代码，该工作空间被称为我们的 `dev` AML工作空间。现在，我们将把您的代码移动到我们的Azure DevOps仓库中。
- en: 'Navigate to a terminal session in your `dev` AML workspace:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 导航到您的 `dev` AML工作空间中的终端会话：
- en: 'In your terminal, navigate to your `Azure-Machine-Learning-Engineering` folder
    as follows:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的终端中，按照以下步骤导航到您的 `Azure-Machine-Learning-Engineering` 文件夹：
- en: '[PRE1]'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'First, we will need to specify that the directory is safe by typing the following
    command:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要通过输入以下命令来指定目录是安全的：
- en: '[PRE2]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'We will want to update your origin, which specifies the remote location your
    code resides in, into a repository in your Azure DevOps project. In the following
    command, we will replace the URL with that of your Azure DevOps repo. This will
    be the URL you copied from *Figure 9**.7*. The command to do this, in general,
    is the following:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们希望更新您的源，它指定了代码所在的远程位置，到Azure DevOps项目中的仓库。在以下命令中，我们将用您的Azure DevOps仓库的URL替换它。这将是从
    *图9.7* 复制的URL。一般而言，执行此操作的命令如下：
- en: '[PRE3]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To review that your origin has been set correctly, you can type the following
    command in your terminal:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了检查您的源设置是否正确，您可以在终端中输入以下命令：
- en: '[PRE4]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'To enable your Git user information to be saved, you can set the following:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要使您的Git用户信息被保存，您可以设置以下：
- en: '[PRE5]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Next, we will set the Git user information as follows:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将按照以下方式设置Git用户信息：
- en: '[PRE6]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'To push to the origin, which is the repo in your Azure DevOps project, you
    can type the following command:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将代码推送到源，即Azure DevOps项目中的仓库，您可以输入以下命令：
- en: '[PRE9]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '[PRE11]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This will prompt a password, which was provided when you clicked on the credentials
    for your Azure DevOps project, referred to in *Figure 9**.9*.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将提示输入密码，该密码是在您点击Azure DevOps项目凭据时提供的，如图 *图9.9* 所示。
- en: 'After using the preceding command, the code will now be copied from your AML
    workspace, over to the repo in your Azure DevOps project as shown in the following
    screenshot:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 使用前面的命令后，代码现在将从您的AML工作空间复制到Azure DevOps项目中的仓库，如图中所示以下截图：
- en: '![Figure 9.9 – Azure DevOps MLOps project](img/B18003_09_009.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![图9.9 – Azure DevOps MLOps项目](img/B18003_09_009.jpg)'
- en: Figure 9.9 – Azure DevOps MLOps project
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.9 – Azure DevOps MLOps项目
- en: At this stage, you have successfully moved your code over to your Azure DevOps
    repository. Changes made to the code on an AML compute resource that are committed
    to your repository will be reflected and updated in your Azure DevOps repository.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在此阶段，您已成功将代码移动到您的Azure DevOps仓库。对AML计算资源上的代码所做的更改，如果提交到您的仓库，将在您的Azure DevOps仓库中反映和更新。
- en: In the next subsection, we will be setting up variables in Azure Key Vault for
    each of the AML workspace environments.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个小节中，我们将为每个AML工作空间环境在Azure Key Vault中设置变量。
- en: Setting up variables in Azure Key Vault
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Azure密钥保管库中设置变量
- en: 'When your AML workspace was deployed, Azure Key Vault was also deployed for
    each of your workspaces. We will leverage each key vault to store sensitive information
    related to each workspace so Azure DevOps can connect and run the AML pipeline
    and AML CLI v2 commands on an Azure DevOps build agent. We could have chosen not
    to leverage the default key vaults deployed with the AML workspace and spun up
    two separate key vaults for this task, but given the resources are already available,
    we will choose to continue with leveraging the default deployed key vaults. To
    set up variables in Azure Key Vault, follow these steps:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 当您的AML工作空间部署时，Azure密钥保管库也会为您的每个工作空间部署。我们将利用每个密钥保管库来存储与每个工作空间相关的敏感信息，以便Azure
    DevOps可以连接并运行Azure DevOps构建代理上的AML管道和AML CLI v2命令。我们本可以选择不利用与AML工作空间一起部署的默认密钥保管库，并为这项任务启动两个单独的密钥保管库，但鉴于资源已经可用，我们将选择继续利用默认部署的密钥保管库。要在Azure密钥保管库中设置变量，请按照以下步骤操作：
- en: 'Head over to the Azure portal by going to [https://portal.azure.com/](https://portal.azure.com/)
    and locate your AML workspace. Click on the resource, as shown in the following
    figure:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过访问[https://portal.azure.com/](https://portal.azure.com/)进入Azure门户，找到您的AML工作空间。点击资源，如图所示：
- en: '![Figure 9.10 – AML workspace icon in the Azure portal](img/B18003_09_010.jpg)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![图9.10 – Azure门户中的AML工作空间图标](img/B18003_09_010.jpg)'
- en: Figure 9.10 – AML workspace icon in the Azure portal
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.10 – Azure门户中的AML工作空间图标
- en: 'Clicking on the resource, we can see the overview of the AML workspace includes
    **Key** **Vault** information:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击资源，我们可以看到AML工作空间的概览包括**密钥** **保管库**信息：
- en: '![Figure 9.11 – AML workspace overview](img/B18003_09_011.jpg)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![图9.11 – AML工作空间概览](img/B18003_09_011.jpg)'
- en: Figure 9.11 – AML workspace overview
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.11 – AML工作空间概览
- en: 'Clicking on the **Key Vault** name will bring us directly to the Azure key
    vault, as shown here:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**密钥保管库**名称将直接带我们到Azure密钥保管库，如图所示：
- en: '![Figure 9.12 – Azure Key Vault overview](img/B18003_09_012.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![图9.12 – Azure密钥保管库概览](img/B18003_09_012.jpg)'
- en: Figure 9.12 – Azure Key Vault overview
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.12 – Azure密钥保管库概览
- en: 'Currently, you are not authorized to view **Secrets**, so click on the **Access
    polices** menu on the left as shown in the preceding figure. This will bring up
    the **Access policies** options as shown here:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 目前，您没有权限查看**机密**，因此请点击左侧的**访问策略**菜单，如图所示。这将显示**访问策略**选项，如图所示：
- en: '![Figure 9.13 – Azure Key Vault access policies](img/B18003_09_013.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![图9.13 – Azure密钥保管库访问策略](img/B18003_09_013.jpg)'
- en: Figure 9.13 – Azure Key Vault access policies
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.13 – Azure密钥保管库访问策略
- en: 'Clicking on **+ Create** as shown in *Figure 9**.14* will present you with
    options for assigning permissions. Under **Secret permissions**, check **Get**,
    **List**, **Set**, and **Delete**, and click on **Next**:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击如图*图9.14*所示的**+ 创建**将提供分配权限的选项。在**机密权限**下，勾选**获取**、**列出**、**设置**和**删除**，然后点击**下一步**：
- en: '![Figure 9.14 – Setting secret permission options](img/B18003_09_014.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![图9.14 – 设置机密权限选项](img/B18003_09_014.jpg)'
- en: Figure 9.14 – Setting secret permission options
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.14 – 设置机密权限选项
- en: 'You will then search for yourself either by name or email address to assign
    yourself the permissions, as shown in the following figure:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，您可以通过名称或电子邮件地址自行搜索以分配权限，如图所示：
- en: '![Figure 9.15 – Searching by email to assign Azure Key Vault selected permissions](img/B18003_09_015.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![图9.15 – 通过电子邮件搜索以分配Azure密钥保管库所选权限](img/B18003_09_015.jpg)'
- en: Figure 9.15 – Searching by email to assign Azure Key Vault selected permissions
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.15 – 通过电子邮件搜索以分配Azure密钥保管库所选权限
- en: 'In the text box shown in *Figure 9**.16*, type your email address and find
    yourself to assign access:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在如图*图9.16*所示的文本框中，输入您的电子邮件地址并找到自己以分配访问权限：
- en: '![Figure 9.16 – Locating your email address](img/B18003_09_016.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![图9.16 – 定位您的电子邮件地址](img/B18003_09_016.jpg)'
- en: Figure 9.16 – Locating your email address
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.16 – 定位您的电子邮件地址
- en: After you have found yourself, select your name, and click on the **Next** button.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到您自己后，选择您的名称，然后点击**下一步**按钮。
- en: You will then be given the option to select an application – do not select anything
    in the **Application (optional)** section and click **Next**.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，您将获得选择应用程序的选项 - 在**应用程序（可选）**部分不要选择任何内容，然后点击**下一步**。
- en: '![Figure 9.17 – Skipping Application (optional)](img/B18003_09_017.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![图9.17 – 跳过应用程序（可选）](img/B18003_09_017.jpg)'
- en: Figure 9.17 – Skipping Application (optional)
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.17 – 跳过应用程序（可选）
- en: Finally, click on the **Create** button under the **Review +** **create** section.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，在**审查+创建**部分下点击**创建**按钮。
- en: '![Figure 9.18 – Creating Azure Key Vault permissions](img/B18003_09_018.jpg)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.18 – 创建 Azure 密钥保管库权限](img/B18003_09_018.jpg)'
- en: Figure 9.18 – Creating Azure Key Vault permissions
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.18 – 创建 Azure 密钥保管库权限
- en: 'Now that you have permission to view and create secrets, head to the **Secrets**
    option in the left-hand menu:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您有权限查看和创建密钥，请转到左侧菜单中的**密钥**选项：
- en: '![Figure 9.19 – Secrets option in the left-hand menu](img/B18003_09_019.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.19 – 左侧菜单中的“密钥”选项](img/B18003_09_019.jpg)'
- en: Figure 9.19 – Secrets option in the left-hand menu
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.19 – 左侧菜单中的“密钥”选项
- en: 'Click on the **+ Generate/Import** button, as shown here:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击此处所示的**+ 生成/导入**按钮：
- en: '![Figure 9.20 – Generating a new secret](img/B18003_09_020.jpg)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.20 – 生成新的密钥](img/B18003_09_020.jpg)'
- en: Figure 9.20 – Generating a new secret
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.20 – 生成新的密钥
- en: 'This brings up the screen for **Create a secret**, as shown in the following
    figure:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将显示创建**密钥**的屏幕，如图下所示：
- en: '![Figure 9.21 – Create a secret](img/B18003_09_021.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.21 – 创建密钥](img/B18003_09_021.jpg)'
- en: Figure 9.21 – Create a secret
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.21 – 创建密钥
- en: 'Populate a secret and click on the **Create** button for each of the values
    listed in the following table, as they will be leveraged by your Azure DevOps
    pipeline. The table provided here gives you sample information in the **Value**
    column. This sample information should be taken from the overview of your AML
    workspace as shown in *Figure 9**.11*, except for the location. Based on where
    your AML workspace is deployed, the location value can be found here – [https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations](https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations):'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 为以下表格中列出的每个值填充密钥并点击**创建**按钮，因为它们将被您的 Azure DevOps 管道利用。这里提供的表格在**值**列中提供了示例信息。此示例信息应从您的
    AML 工作区的概述中获取，如图 9**.11** 所示，除了位置。根据您的 AML 工作区部署的位置，位置值可以在以下位置找到 – [https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations](https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations)：
- en: '| **Key** **Vault variable** | **Value** |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '| **密钥** **保管库变量** | **值** |'
- en: '| `resourceGroup` | `aml-dev-rg` |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| `resourceGroup` | `aml-dev-rg` |'
- en: '| `wsName` | `aml-dev` |'
  id: totrans-165
  prefs: []
  type: TYPE_TB
  zh: '| `wsName` | `aml-dev` |'
- en: '| `location` | `eastus` |'
  id: totrans-166
  prefs: []
  type: TYPE_TB
  zh: '| `location` | `eastus` |'
- en: Figure 9.22 – Azure key vault variables for the dev Azure key vault
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.22 – 开发 Azure 密钥保管库变量
- en: 'Now that you have set up the Azure key vault for your first AML workspace,
    we will follow the same *steps 1 to 13* to set up the Azure key vault and values
    for your second AML workspace. This information should be taken from the overview
    of your second `qa` AML workspace, as shown in *Figure 9**.11*:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经为您的第一个 AML 工作区设置了 Azure 密钥保管库，我们将按照相同的**步骤 1 到 13**来设置第二个 AML 工作区的 Azure
    密钥保管库和值。此信息应从您的第二个 `qa` AML 工作区的概述中获取，如图 9**.11** 所示：
- en: '| **Key** **Vault variable** | **Value** |'
  id: totrans-169
  prefs: []
  type: TYPE_TB
  zh: '| **密钥** **保管库变量** | **值** |'
- en: '| `resourceGroup` | `aml-qa-rg` |'
  id: totrans-170
  prefs: []
  type: TYPE_TB
  zh: '| `resourceGroup` | `aml-qa-rg` |'
- en: '| `wsName` | `aml-qa` |'
  id: totrans-171
  prefs: []
  type: TYPE_TB
  zh: '| `wsName` | `aml-qa` |'
- en: '| `location` | `eastus` |'
  id: totrans-172
  prefs: []
  type: TYPE_TB
  zh: '| `location` | `eastus` |'
- en: Figure 9.23 – Azure key vault variables for the qa Azure key vault
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.23 – qa Azure 密钥保管库变量
- en: Note
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: In a real scenario, we would typically see either a non-prod and prod environment,
    or `dev`, `qa`, and `prod`. This code can be extended to support *n* number of
    environments.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在实际场景中，我们通常会看到非生产环境和生产环境，或者`dev`、`qa`和`prod`。此代码可以扩展以支持*n*个环境。
- en: Once you have completed this for both environments, you are ready to move on
    to the next step – setting up your environment variable groups.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这两个环境后，您就可以继续下一步 – 设置您的环境变量组。
- en: Setting up environment variable groups
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置环境变量组
- en: Now that your variables are securely in Azure Key Vault, we will set up variable
    group to hold your settings to be leveraged inside your Azure DevOps pipeline.
    An variable group is a collection of variables that are leveraged together in
    an Azure DevOps pipeline task. This means that each task can use variables that
    specify whether we are going to the `dev` environment with the `dev` service connection
    or connecting in the `qa` environment, leveraging the `qa` service connection.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您的变量已安全存储在Azure密钥保管库中，我们将设置变量组以保存您在Azure DevOps管道中使用的设置。变量组是一组在Azure DevOps管道任务中一起使用的变量。这意味着每个任务都可以使用指定我们将使用`dev`服务连接访问`dev`环境或利用`qa`服务连接连接到`qa`环境的变量。
- en: 'We will be creating two variable groups, `devops-variable-group-dev` and `devops-variable-group-qa`,
    to simulate moving from one environment to another:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将创建两个变量组，`devops-variable-group-dev`和`devops-variable-group-qa`，以模拟从一个环境移动到另一个环境：
- en: 'From the left-hand menu, select the **Pipelines** blue rocket icon, and select
    the **Library** option as shown:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧菜单中选择**管道**蓝色火箭图标，并选择**库**选项，如下所示：
- en: '![Figure 9.24 – Library option](img/B18003_09_024.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![图9.24 – 库选项](img/B18003_09_024.jpg)'
- en: Figure 9.24 – Library option
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.24 – 库选项
- en: 'Selecting the **Library** option, you will be prompted to create a new variable
    group as shown here:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**库**选项，您将提示创建一个新的变量组，如下所示：
- en: '![Figure 9.25 – New variable group](img/B18003_09_025.jpg)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![图9.25 – 新变量组](img/B18003_09_025.jpg)'
- en: Figure 9.25 – New variable group
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.25 – 新变量组
- en: 'Clicking on the `devops-variable-group-dev`, and enable the **Link secrets
    from an Azure key vault as variables** option, as shown in the following screenshot:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击`devops-variable-group-dev`，并启用**从Azure密钥保管库链接机密作为变量**选项，如下截图所示：
- en: '![Figure 9.26 – Variable group creation](img/B18003_09_026.jpg)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![图9.26 – 变量组创建](img/B18003_09_026.jpg)'
- en: Figure 9.26 – Variable group creation
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.26 – 变量组创建
- en: You will need to click on the **Authorize** button for your Azure subscription.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您需要点击您的Azure订阅的**授权**按钮。
- en: When selecting the Azure key vault to link with your variable group, make sure
    that you link the `dev` key vault with the `devops-variable-group-dev` variable
    group, and the `qa` key vault with the `devops-variable-group-qa` variable group.
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当选择要链接到变量组的Azure密钥保管库时，请确保将`dev`密钥保管库与`devops-variable-group-dev`变量组链接，以及将`qa`密钥保管库与`devops-variable-group-qa`变量组链接。
- en: '![Figure 9.27 – Variable group link to Azure Key Vault](img/B18003_09_027.jpg)'
  id: totrans-191
  prefs: []
  type: TYPE_IMG
  zh: '![图9.27 – 变量组链接到Azure密钥保管库](img/B18003_09_027.jpg)'
- en: Figure 9.27 – Variable group link to Azure Key Vault
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.27 – 变量组链接到Azure密钥保管库
- en: 'After the authorization for the key vault has been completed, click on the
    **+ Add** icon to add the secrets from your key vault into your Azure DevOps variable
    group shown as follows:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成密钥保管库的授权后，点击**+ 添加**图标，将您的密钥保管库中的机密添加到您的Azure DevOps变量组中，如下所示：
- en: '![Figure 9.28 – Adding variables to the Azure DevOps variable group](img/B18003_09_028.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![图9.28 – 向Azure DevOps变量组添加变量](img/B18003_09_028.jpg)'
- en: Figure 9.28 – Adding variables to the Azure DevOps variable group
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.28 – 向Azure DevOps变量组添加变量
- en: 'Clicking on the **+ Add** icon, you will be prompted to select secrets from
    the Azure key vault you have linked to the variable group, as shown here:'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**+ 添加**图标，您将提示从已链接到变量组的Azure密钥保管库中选择机密，如下所示：
- en: '![Figure 9.29 – Selecting Azure key vault variables](img/B18003_09_029.jpg)'
  id: totrans-197
  prefs: []
  type: TYPE_IMG
  zh: '![图9.29 – 选择Azure密钥保管库变量](img/B18003_09_029.jpg)'
- en: Figure 9.29 – Selecting Azure key vault variables
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.29 – 选择Azure密钥保管库变量
- en: Select the three variables you populated from *Figure 9**.22* and *Figure 9**.23*,
    and click on the `devops-variable-group-dev` should be linked to your `dev` Azure
    key vault, and `devops-variable-group-qa` should be linked to your `qa` Azure
    key vault.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 从**图9.22**和**图9.23**中选择您填充的三个变量，并点击`devops-variable-group-dev`应链接到您的`dev` Azure密钥保管库，而`devops-variable-group-qa`应链接到您的`qa`
    Azure密钥保管库。
- en: 'Do remember to click on the **Save** icon for each of your variable groups:'
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请务必点击每个变量组的**保存**图标：
- en: '![Figure 9.30 – Saving an Azure DevOps variable group](img/B18003_09_030.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![图9.30 – 保存Azure DevOps变量组](img/B18003_09_030.jpg)'
- en: Figure 9.30 – Saving an Azure DevOps variable group
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.30 – 保存Azure DevOps变量组
- en: At this point, you should ensure you have linked two variable groups, and each
    variable group should be linked to the key vault specific to that environment.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您应该确保已链接两个变量组，并且每个变量组应链接到特定环境的密钥保管库。
- en: 'Clicking on the **Library** icon in the left-hand menu within Azure DevOps
    will bring up **Variable groups** that you have populated as shown here:'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Azure DevOps 左侧菜单中的 **库** 图标将弹出您已填充的 **变量组**，如下所示：
- en: '![Figure 9.31 – Azure DevOps variable groups](img/B18003_09_031.jpg)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.31 – Azure DevOps 变量组](img/B18003_09_031.jpg)'
- en: Figure 9.31 – Azure DevOps variable groups
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.31 – Azure DevOps 变量组
- en: Congratulations – you have set up two variable groups pointing to two different
    key vaults, each holding information regarding the specific workspace. Note that
    this is very extensible. Any variable that holds sensitive information that you
    would like to pass to your pipeline can leverage a secret in Key Vault stored
    in a variable group. Azure Key Vault provides you with the flexibility to have
    unique secure information per AML workspace in your MLOps pipeline.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜您 – 您已设置两个变量组，分别指向两个不同的密钥保管库，每个密钥保管库都包含有关特定工作区的信息。请注意，这非常灵活。任何包含您希望传递到管道中的敏感信息的变量都可以利用变量组中存储在密钥保管库中的密钥。Azure
    Key Vault 为您提供了在 MLOps 管道中为每个 AML 工作区提供独特安全信息的灵活性。
- en: The next Azure DevOps component we will set up is the environment for providing
    approval for the model registration and model deployment in the `qa` AML workspace.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个我们将设置的 Azure DevOps 组件是为 `qa` AML 工作空间中的模型注册和模型部署提供审批的环境。
- en: Creating an Azure DevOps environment
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 Azure DevOps 环境
- en: 'In this subsection, we will create an Azure DevOps environment called `qa`
    so we can apply governance to the model deployment in the `qa` environment. An
    Azure DevOps environment requires approvers. We will be able to reference this
    environment in our Azure DevOps pipeline as we progress to the `qa` environment:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在本小节中，我们将创建一个名为 `qa` 的 Azure DevOps 环境，以便我们可以对 `qa` 环境中的模型部署进行治理。Azure DevOps
    环境需要审批者。随着我们向 `qa` 环境的进展，我们将在 Azure DevOps 管道中引用此环境：
- en: In the **Pipeline**s section in the left-hand pane in your Azure DevOps project,
    select the **Environments** icon, and select **New environment**.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Azure DevOps 项目的左侧面板中的 **管道** 部分选择 **环境** 图标，然后选择 **新建环境**。
- en: 'This will pull up a new popup, as shown in this screenshot:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 这将弹出一个新的弹出窗口，如下截图所示：
- en: '![Figure 9.32 – Azure DevOps environment](img/B18003_09_032.jpg)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.32 – Azure DevOps 环境](img/B18003_09_032.jpg)'
- en: Figure 9.32 – Azure DevOps environment
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.32 – Azure DevOps 环境
- en: For the name, type `qa`, leave Resource set to **None**, and select the **Create**
    button.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于名称，键入 `qa`，将资源设置为 **无**，然后选择 **创建** 按钮。
- en: 'On the top-right side of the environment, you will see an **Add resource**
    button with three dots next to it, shown in the following figure. Click on the
    three dots:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在环境的右上角，您将看到一个带有三个点的 **添加资源** 按钮，如下图所示。点击三个点：
- en: '![Figure 9.33 – Add resource](img/B18003_09_033.jpg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.33 – 添加资源](img/B18003_09_033.jpg)'
- en: Figure 9.33 – Add resource
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.33 – 添加资源
- en: 'Clicking on the three dots, go to **Approvals and checks**, as shown in the
    following screenshot:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击三个点，转到 **审批和检查**，如下截图所示：
- en: '![Figure 9.34 – Approvals and checks](img/B18003_09_034.jpg)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.34 – 审批和检查](img/B18003_09_034.jpg)'
- en: Figure 9.34 – Approvals and checks
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.34 – 审批和检查
- en: After clicking on the **Approvals and checks** option, a new screen will be
    displayed that will allow you to enter your approvers.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **审批和检查** 选项后，将显示一个新屏幕，允许您输入您的审批者。
- en: 'A screen will be displayed, **Add your first check**, as shown here:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 将显示一个屏幕，**添加第一个检查**，如下所示：
- en: '![Figure 9.35 – Approvals and checks](img/B18003_09_035.jpg)'
  id: totrans-224
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.35 – 审批和检查](img/B18003_09_035.jpg)'
- en: Figure 9.35 – Approvals and checks
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.35 – 审批和检查
- en: 'Select **Approvals**, which will bring up the **Approvals** configuration shown
    here:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 **审批**，这将弹出如下的 **审批** 配置：
- en: '![Figure 9.36 – Setting approvers](img/B18003_09_036.jpg)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.36 – 设置审批者](img/B18003_09_036.jpg)'
- en: Figure 9.36 – Setting approvers
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.36 – 设置审批者
- en: Add yourself to **Approvals**, ensure under that **Advanced**, you have checked
    **Allow approvers to approve their own runs**, and select **Create**.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将自己添加到 **审批** 中，确保在 **高级** 下已勾选 **允许审批者审批自己的运行**，然后选择 **创建**。
- en: Now that you have created your Azure DevOps environment, we are ready to create
    an Azure DevOps service connection.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经创建了 Azure DevOps 环境，我们准备创建 Azure DevOps 服务连接。
- en: Setting your Azure DevOps service connections
  id: totrans-231
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置您的 Azure DevOps 服务连接
- en: An Azure DevOps service connection uses a service principal to connect and gain
    access to run code on your behalf. The service connection will run your Azure
    DevOps pipeline as the service principal specified in the service connection.
    An AML service connection allows you to connect Azure DevOps to your workspace.
    This means that we will create two service connections, one for each AML workspace.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: Azure DevOps 服务连接使用服务主体来连接并代表您运行代码。服务连接将以服务连接中指定的服务主体身份运行您的 Azure DevOps 管道。AML
    服务连接允许您将 Azure DevOps 连接到您的工作区。这意味着我们将创建两个服务连接，每个 AML 工作区一个。
- en: There is a special kind of service connection that specifies that it is an ML
    workspace service connection. This extension is not required, so if there is an
    administrator for your Azure DevOps organization, they can provide you with a
    service principal and not use this extension, but it is ideal, as it indicates
    what the service principal will be leveraged for.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 有一种特殊类型的服务连接，指定它是一个 ML 工作区服务连接。此扩展不是必需的，所以如果您的 Azure DevOps 组织有管理员，他们可以为您提供服务主体而不使用此扩展，但这很理想，因为它表明服务主体将被用于什么。
- en: 'We will begin by installing an AML extension for your Azure DevOps organization.
    To install this into your Azure DevOps environment, perform the following steps:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先为您在 Azure DevOps 组织中安装一个 AML 扩展。要将此扩展安装到您的 Azure DevOps 环境中，请执行以下步骤：
- en: 'Navigate to [https://marketplace.visualstudio.com/](https://marketplace.visualstudio.com/),
    and select the `Azure Machine Learning`, as shown in the following screenshot:'
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 [https://marketplace.visualstudio.com/](https://marketplace.visualstudio.com/)，并选择“Azure
    Machine Learning”，如图下截图所示：
- en: '![Figure 9.37 – Visual Studio Marketplace](img/B18003_09_037.jpg)'
  id: totrans-236
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.37 – Visual Studio 商店](img/B18003_09_037.jpg)'
- en: Figure 9.37 – Visual Studio Marketplace
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.37 – Visual Studio 商店
- en: 'This will bring up the AML Azure DevOps extension shown as follows:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将显示以下 AML Azure DevOps 扩展：
- en: '![Figure 9.38 – Azure DevOps ML extension](img/B18003_09_038.jpg)'
  id: totrans-239
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.38 – Azure DevOps ML 扩展](img/B18003_09_038.jpg)'
- en: Figure 9.38 – Azure DevOps ML extension
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.38 – Azure DevOps ML 扩展
- en: Clicking on the icon shown in *Figure 9**.38* will bring up detailed information
    about the extension.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击如图 9.38 所示的图标将显示有关扩展的详细信息。
- en: 'Click on the **Get it free** button to begin the installation process. This
    will bring you to the next screen where it is verifying that you have permission
    to install the extension in your Azure DevOps organization, as shown in the following
    screenshot:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“免费获取”按钮开始安装过程。这将带您进入下一个屏幕，其中正在验证您是否有权限在您的 Azure DevOps 组织中安装扩展，如图下截图所示：
- en: '![Figure 9.39 – Verifying installation permissions](img/B18003_09_039.jpg)'
  id: totrans-243
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.39 – 验证安装权限](img/B18003_09_039.jpg)'
- en: Figure 9.39 – Verifying installation permissions
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.39 – 验证安装权限
- en: 'After the permissions have been confirmed, you will be prompted to install
    for your Azure DevOps organization, as shown here:'
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 权限确认后，您将被提示为您的 Azure DevOps 组织安装，如图所示：
- en: '![Figure 9.40 – Install option](img/B18003_09_040.jpg)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.40 – 安装选项](img/B18003_09_040.jpg)'
- en: Figure 9.40 – Install option
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.40 – 安装选项
- en: 'Click on the **Install** button and you will be prompted to head over to your
    Azure DevOps organization now that the extension has been installed, as shown
    in the following screenshot:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“**安装**”按钮，您将被提示现在前往您的 Azure DevOps 组织，如图下截图所示：
- en: '![Figure 9.41 – Installation confirmation](img/B18003_09_041.jpg)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.41 – 安装确认](img/B18003_09_041.jpg)'
- en: Figure 9.41 – Installation confirmation
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.41 – 安装确认
- en: Click on the **Proceed to organization** button, as shown in the preceding screenshot.
    This will bring you to your Azure DevOps organization.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击前面的截图所示的“**进入组织**”按钮。这将带您进入您的 Azure DevOps 组织。
- en: 'Then, click on your project inside your Azure DevOps organization as shown
    in the following screenshot:'
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，点击您在 Azure DevOps 组织中的项目，如图下截图所示：
- en: '![Figure 9.42 – Azure DevOps project](img/B18003_09_042.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.42 – Azure DevOps 项目](img/B18003_09_042.jpg)'
- en: Figure 9.42 – Azure DevOps project
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.42 – Azure DevOps 项目
- en: Inside your project, in the left-hand menu, you can see **Project settings**
    in the menu. Click on the **Project** **settings** icon.
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的项目中，在左侧菜单中，您可以在菜单中看到“**项目设置**”。点击“**项目** **设置**”图标。
- en: Clicking on **Project settings**, you will see **Service Connections** in the
    menu. Click on the icon for **Service Connections**.
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“**项目设置**”，您将在菜单中看到“**服务连接**”。点击“**服务连接**”图标。
- en: 'Click on the **Create service connection** icon on the top left of your screen;
    this will bring up the **New service connection** window, as shown in the following
    screenshot:'
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击屏幕左上角的**创建服务连接**图标；这将打开如图所示的**新服务连接**窗口：
- en: '![Figure 9.43 – New service connection](img/B18003_09_043.jpg)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.43 – 新服务连接](img/B18003_09_043.jpg)'
- en: Figure 9.43 – New service connection
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.43 – 新服务连接
- en: Click on the **Azure Resource Manager** option here, scroll to the bottom, and
    click **Next**.
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这里点击**Azure 资源管理器**选项，滚动到页面底部，然后点击**下一步**。
- en: 'This will bring up another screen, as follows:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 这将打开另一个屏幕，如下所示：
- en: '![Figure 9.44 – Automatic creation of a service principal](img/B18003_09_044.jpg)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.44 – 自动创建服务主体](img/B18003_09_044.jpg)'
- en: Figure 9.44 – Automatic creation of a service principal
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.44 – 自动创建服务主体
- en: 'In order to leverage the **Service principal (automatic)** option, you will
    be required to have the authorization in your Azure subscription to create **Service
    Principal** instances. If you are working in an environment where this option
    is not authorized, you will be able to request a service principal from your Azure
    subscription administrator, and they can provide you with the information required
    to create a service connection manually. Refer to the following screenshot:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 为了利用**服务主体（自动）**选项，你需要在你的 Azure 订阅中拥有创建**服务主体**实例的授权。如果你在一个此选项未被授权的环境中工作，你将能够从你的
    Azure 订阅管理员那里请求一个服务主体，他们可以提供你创建服务连接所需的信息。请参考以下截图：
- en: '![Figure 9.45 – Service connection information](img/B18003_09_045.jpg)'
  id: totrans-265
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.45 – 服务连接信息](img/B18003_09_045.jpg)'
- en: Figure 9.45 – Service connection information
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.45 – 服务连接信息
- en: 'Populate the information on the screen as shown in *Figure 9**.45*. The **Subscription
    Id**, **Subscription Name**, **Resource Group**, and **ML Workspace Name** information
    is all available on the AML resource overview screen shown in *Figure 9**.11*.
    **ML Workspace Location** is based on where the resource is deployed. To confirm
    that you use the right value, a table is available here: [https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations](https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations).'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照如图 9**.45**所示的屏幕上的信息进行填写。**订阅 ID**、**订阅名称**、**资源组**和**ML 工作区名称**信息都在如图 9**.11**所示的
    AML 资源概览屏幕上。**ML 工作区位置**基于资源部署的位置。为了确认你使用的是正确的值，这里有一个表格：[https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations](https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations)。
- en: Be sure to check **Grant access permission to all pipelines** before hitting
    **save** on your Azure service connection.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 在点击你的 Azure 服务连接上的**保存**按钮之前，务必检查**授予所有管道访问权限**。
- en: The `.yml` file that defines your Azure DevOps pipeline will expect certain
    values for the service connection. Create your service connection to the `dev`
    environment as `aml-dev`, and your service connection to the `qa` environment
    as `aml-qa`.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 定义你的 Azure DevOps 管道的`.yml`文件将期望服务连接的某些值。将你的服务连接到`dev`环境作为`aml-dev`，并将你的服务连接到`qa`环境作为`aml-qa`。
- en: Congratulations – you have set up two service connections, one pointing to your
    `dev` AML workspace, and one pointing to your `qa` AML workspace. We will continue
    to the next subsection on creating your Azure DevOps pipeline.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜你 – 你已经设置了两个服务连接，一个指向你的`dev` AML 工作区，另一个指向你的`qa` AML 工作区。我们将继续到下一个子节，创建你的
    Azure DevOps 管道。
- en: Creating an Azure DevOps pipeline
  id: totrans-271
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 Azure DevOps 管道
- en: To setup your Azure DevOps pipeline, we are going to generate some code. Recall
    that your code is in your `dev` AML workspace. In order to walk you through creating
    the Azure DevOps pipeline, we have created a sample notebook in `Chapter 09`,
    `Chapter 9` `MLOps.ipynb`, shown in the following screenshot.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置你的 Azure DevOps 管道，我们将生成一些代码。回想一下，你的代码在你的`dev` AML 工作区中。为了指导你创建 Azure DevOps
    管道，我们在`第 09 章`、`第 9 章` `MLOps.ipynb`中创建了一个示例笔记本，如下截图所示。
- en: 'Inside your `dev` instance of your AML workspace, you will see the notebook
    as follows:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的 AML 工作区的`dev`实例中，你会看到如下笔记本：
- en: '![Figure 9.46 – Chapter 9 MLOps notebook](img/B18003_09_046.jpg)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.46 – 第 9 章 MLOps 笔记本](img/B18003_09_046.jpg)'
- en: Figure 9.46 – Chapter 9 MLOps notebook
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.46 – 第 9 章 MLOps 笔记本
- en: Open the notebook and slowly walk yourself through the code, executing each
    cell and creating the required files for your MLOps pipeline.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 打开笔记本，并逐步通过代码，执行每个单元格，并为你的MLOps流水线创建所需的文件。
- en: We start with the notebook by connecting to our AML workspace and ensuring our
    data is ready to be leveraged by our MLOps pipeline. Often, demos include the
    data that you are going to be leveraging as part of the pipeline, but in a real-world
    pipeline, your data is going to reside somewhere that is not in your MLOps folder,
    so we will take the data from the folder and register it if it is not registered
    already.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先通过连接到我们的AML工作区并确保我们的数据准备好被我们的MLOps流水线利用来开始笔记本。通常，演示包括你将作为流水线一部分利用的数据，但在现实世界的流水线中，你的数据将驻留在不在你的MLOps文件夹中的某个地方，因此我们将从文件夹中获取数据，并在尚未注册的情况下进行注册。
- en: We are going to create an AML pipeline, to facilitate that, we create separate
    folders for each of the steps in the pipeline. We are going to create a step for
    data preparation, model training, and model evaluation. We will leverage our Azure
    DevOps pipeline to handle the deployment, but we will create a `.yml` file definition
    for the AML pipeline, and we also create a folder to hold that pipeline definition,
    as well as a folder to hold our `conda` environment `.``yml` file.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将创建一个AML流水线，为了实现这一点，我们为流水线中的每个步骤创建单独的文件夹。我们将创建一个数据准备、模型训练和模型评估的步骤。我们将利用我们的Azure
    DevOps流水线来处理部署，但我们将创建AML流水线的`.yml`文件定义，并且我们还创建一个文件夹来存放该流水线定义，以及一个文件夹来存放我们的`conda`环境`.yml`文件。
- en: We will create a compute cluster for the AML pipeline to leverage. We could
    argue that this should have been included in the MLOps pipeline, but this resource
    will automatically scale up and down as required by our pipelines, so we left
    this resource outside of the Azure DevOps pipeline – however, you certainly can
    take this pipeline and extend it to include this functionality.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将为AML流水线创建一个计算集群以利用它。我们可以争论说这应该包含在MLOps流水线中，但这个资源将根据我们的流水线需求自动扩展和缩减，因此我们将这个资源留在了Azure
    DevOps流水线之外——然而，你当然可以将这个流水线扩展以包括这个功能。
- en: After creating the `conda` `.yml` file to handle the environment, and a script
    for each step in the AML pipeline, we stitch the code together in an AML pipeline
    job, which was covered in [*Chapter 7*](B18003_07.xhtml#_idTextAnchor102), *Deploying
    ML Models for* *Batch Scoring*.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建用于处理环境的`conda` `.yml`文件以及AML流水线中每个步骤的脚本之后，我们在AML流水线作业中将代码拼接在一起，这在[*第7章*](B18003_07.xhtml#_idTextAnchor102)中有所介绍，*部署ML模型进行*
    *批量评分*。
- en: 'Here’s the script for creating the environment for the pipeline to leverage:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 这是创建流水线利用环境的脚本：
- en: '![Figure 9.47 – conda .yml file for the environment information](img/B18003_09_047.jpg)'
  id: totrans-282
  prefs: []
  type: TYPE_IMG
  zh: '![图9.47 – 环境信息conda .yml文件](img/B18003_09_047.jpg)'
- en: Figure 9.47 – conda .yml file for the environment information
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.47 – 环境信息conda .yml文件
- en: Review each step in the pipeline and the code in the notebook of this chapter,
    as it creates an AML job pipeline to create a model and register the model.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 复习本章中流水线中的每个步骤以及笔记本中的代码，因为它创建了一个AML作业流水线来创建模型并注册模型。
- en: 'Note that the first step will expect the raw data parameter that will tell
    the code where to find the `titanic.csv` file. In addition to the source location,
    the pipeline definition indicates where the data will be stored. This script is
    quite helpful in providing a generic solution for your pipeline to leverage data.
    Each step within the AML pipeline has a set of defined input and output parameters
    that are captured within the pipeline definition `.yml` file, `aml_train_and_eval_pipeline.yml`,
    which the notebook generates in the pipeline directory under `src` in the chapter
    folder directory. Reviewing this code, you can see how the inputs and outputs
    in the script are specified in the pipe definition:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，第一步将期望一个原始数据参数，这将告诉代码在哪里找到`titanic.csv`文件。除了源位置外，流水线定义还指示数据将存储的位置。这个脚本对于为你的流水线提供通用的数据利用解决方案非常有帮助。AML流水线中的每个步骤都有一组定义好的输入和输出参数，这些参数在流水线定义`.yml`文件中捕获，该文件由笔记本在章节文件夹目录下的`src`目录中的流水线目录生成。通过审查此代码，你可以看到脚本中的输入和输出是如何在管道定义中指定的：
- en: '![Figure 9.48 – AML pipeline definition](img/B18003_09_048.jpg)'
  id: totrans-286
  prefs: []
  type: TYPE_IMG
  zh: '![图9.48 – AML流水线定义](img/B18003_09_048.jpg)'
- en: Figure 9.48 – AML pipeline definition
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.48 – AML流水线定义
- en: Note
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: 'Pipeline job definitions include great flexibility. The schema for defining
    a job can be reviewed here: [https://azuremlschemas.azureedge.net/latest/commandJob.schema.json](https://azuremlschemas.azureedge.net/latest/commandJob.schema.json).'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 管道作业定义具有很大的灵活性。定义作业的架构可以在此处查看：[https://azuremlschemas.azureedge.net/latest/commandJob.schema.json](https://azuremlschemas.azureedge.net/latest/commandJob.schema.json)。
- en: In the pipeline definition here, we have specified the type for the prep job
    as `command` as per the schema definition. We have specified where the code can
    be found for the step. For the command itself, we specify to run Python and provide
    the file and the parameters that will be passed to the Python script from our
    defined inputs and outputs. We can see that the input was defined as `ro_mount`,
    or a read-only mount to the specified file, and the output was defined as `rw_mount`,
    or a read-write mount with a specified file location. In addition, the environment
    was specified as the `conda` `.yml` file generated, and an Ubuntu image is also
    specified.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里的管道定义中，我们根据架构定义指定了预处理器作业的类型为`command`。我们指定了代码可以找到的位置。对于命令本身，我们指定运行Python并提供文件以及将从我们的定义输入和输出传递给Python脚本的参数。我们可以看到输入被定义为`ro_mount`，或对指定文件的只读挂载，输出被定义为`rw_mount`，或对指定文件位置的读写挂载。此外，环境被指定为生成的`conda`
    `.yml`文件，并且还指定了一个Ubuntu镜像。
- en: This initial `prep_job` combined with a `train_job` and an `eval_job` make up
    the AML pipeline.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 这个初始的`prep_job`与`train_job`和`eval_job`一起构成了AML管道。
- en: Now that we have reviewed the AML pipeline, we will look at the files required
    for the model deployment in both the `dev` and `qa` environments.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经审查了AML管道，我们将查看`dev`和`qa`环境中模型部署所需的文件。
- en: Note
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Managed online endpoint names must be unique in each Azure region.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 托管在线端点名称必须在每个Azure区域中是唯一的。
- en: In addition to the AML pipeline definition, the notebook also generates files
    for handling the managed online endpoint deployment. When running the notebook,
    be sure to update the `name` value for `create-endpoint.yml` and the `name` value
    for `create-endpoint-dev.yml`; in `model_deployment.yml`, provide the `endpoint_name`
    value as the one you specified in `create-endpoint.yml`; and in `model_deployment-dev.yml`,
    provide the `endpoint_name` value you specified in the `create-endpoint-dev.yml`
    file.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 除了AML管道定义之外，笔记本还会生成用于处理托管在线端点部署的文件。在运行笔记本时，请务必更新`create-endpoint.yml`和`create-endpoint-dev.yml`中的`name`值；在`model_deployment.yml`中，提供与`create-endpoint.yml`中指定的`endpoint_name`值相同的值；在`model_deployment-dev.yml`中，提供在`create-endpoint-dev.yml`文件中指定的`endpoint_name`值。
- en: 'Here is a screenshot of the `create-endpoint-dev.yml` file:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是`create-endpoint-dev.yml`文件的截图：
- en: '![Figure 9.49 – dev AML workspace managed online endpoint .yml file](img/B18003_09_049.jpg)'
  id: totrans-297
  prefs: []
  type: TYPE_IMG
  zh: '![图9.49 – dev AML工作区托管在线端点.yml文件](img/B18003_09_049.jpg)'
- en: Figure 9.49 – dev AML workspace managed online endpoint .yml file
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.49 – dev AML工作区托管在线端点.yml文件
- en: This file shown here provides the name and authorization mode that your managed
    online endpoint will leverage during deployment in the `dev` environment. Be sure
    to update **line 3**, as the name must be unique in the Azure region into which
    the AML workspace is deployed.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 这里显示的文件提供了在`dev`环境中部署时托管在线端点将使用的名称和授权模式。请务必更新**第3行**，因为名称必须在部署AML工作区的Azure区域中是唯一的。
- en: 'The following is a screenshot of the `model_deployment-dev.yml` file used for
    the deployment to the managed online endpoint. The `endpoint_name` value here
    should match the name specified for the managed online endpoint:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的截图显示了用于部署到托管在线端点的`model_deployment-dev.yml`文件。这里的`endpoint_name`值应与托管在线端点指定的名称匹配：
- en: '![Figure 9.50 – dev AML workspace deployment to the managed online endpoint
    yml file](img/B18003_09_050.jpg)'
  id: totrans-301
  prefs: []
  type: TYPE_IMG
  zh: '![图9.50 – dev AML工作区部署到托管在线端点的yml文件](img/B18003_09_050.jpg)'
- en: Figure 9.50 – dev AML workspace deployment to the managed online endpoint yml
    file
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.50 – 将dev AML工作区部署到托管在线端点的yml文件
- en: Just as the names should match for the managed online deployment in the `dev`
    environment, they also need to match up in the `qa` environment.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 正如`dev`环境中的托管在线部署名称应该匹配一样，它们在`qa`环境中也需要匹配。
- en: 'Here is a screenshot of the `create-endpoint.yml` file. This is the file used
    to create the managed online endpoint deployment in the `qa` AML workspace:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是`create-endpoint.yml`文件的截图。这是用于在`qa` AML工作区中创建托管在线端点部署的文件：
- en: '![Figure 9.51 – qa AML workspace Managed Online Endpoint .yml file](img/B18003_09_051.jpg)'
  id: totrans-305
  prefs: []
  type: TYPE_IMG
  zh: '![图9.51 – qa AML工作空间托管在线端点.yml文件](img/B18003_09_051.jpg)'
- en: Figure 9.51 – qa AML workspace Managed Online Endpoint .yml file
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.51 – qa AML工作空间托管在线端点.yml文件
- en: As shown in the figure here, `qa` environment and the `dev` environment.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 如图中所示，`qa`环境和`dev`环境。
- en: 'Here is a screenshot of the `model_deployment.yml` file:'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是`model_deployment.yml`文件的截图：
- en: '![Figure 9.52 – qa AML workspace deployment to managed online endpoint yml
    file](img/B18003_09_052.jpg)'
  id: totrans-309
  prefs: []
  type: TYPE_IMG
  zh: '![图9.52 – qa AML工作空间部署到托管在线端点yml文件](img/B18003_09_052.jpg)'
- en: Figure 9.52 – qa AML workspace deployment to managed online endpoint yml file
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.52 – qa AML工作空间部署到托管在线端点yml文件
- en: As shown in the figure here, this file will be leveraged for online deployment
    in the `qa` environment, and it will go to `endpoint_name` to create a deployment,
    so be sure to update `create-endpoint.yml` file.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 如图中所示，此文件将在`qa`环境的在线部署中使用，并将转到`endpoint_name`以创建部署，因此务必更新`create-endpoint.yml`文件。
- en: These files are leveraged within the Azure DevOps pipeline definition, which
    we will discuss next.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 这些文件在Azure DevOps管道定义中被利用，我们将在下一节讨论。
- en: 'The following is a snippet of the `AzureDevOpsPipeline.yml` file that orchestrates
    the MLOps pipeline:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是从`AzureDevOpsPipeline.yml`文件中摘录的片段，该文件协调MLOps管道：
- en: '![Figure 9.53 – Azure DevOpsPipeline.yml file definition](img/B18003_09_053.jpg)'
  id: totrans-314
  prefs: []
  type: TYPE_IMG
  zh: '![图9.53 – Azure DevOpsPipeline.yml文件定义](img/B18003_09_053.jpg)'
- en: Figure 9.53 – Azure DevOpsPipeline.yml file definition
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.53 – Azure DevOpsPipeline.yml文件定义
- en: The `AzureDevOpsPipeline.yml` file starts by specifying the image that an Azure
    DevOps build agent will leverage. The pipeline will trigger when there is a code
    change to `main`. The pipeline is leveraging both `devops-variable-group-dev`
    and `devops-variable-group-qa`, which we set up earlier.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: '`AzureDevOpsPipeline.yml`文件首先指定Azure DevOps构建代理将利用的镜像。当`main`分支有代码更改时，管道将被触发。该管道利用了之前设置的`devops-variable-group-dev`和`devops-variable-group-qa`。'
- en: In this `.yml` file, be sure to update the value for `ENDPT_NAME` to be the
    value you specified in `create-endpoint.yml` and `endpoint_name` in your `model_deployment.yml`
    files.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个`.yml`文件中，务必更新`ENDPT_NAME`的值，使其与你在`create-endpoint.yml`和`model_deployment.yml`文件中指定的`endpoint_name`值一致。
- en: Be sure to also update `DEV_ENDPT_NAME` to be the value for the `name` variable
    you specified in your `create-endpoint-dev.yml` file and the `endpoint_name` `model_deployment-dev.yml`
    file.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 还务必更新`DEV_ENDPT_NAME`，使其与你在`create-endpoint-dev.yml`文件中指定的`name`变量值以及`model_deployment-dev.yml`文件中的`endpoint_name`值一致。
- en: 'The code here shows that in the `AzureDevOpsPipeline.yml` file, the values
    that will need to be replaced for your MLOps deployment:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的代码显示了在`AzureDevOpsPipeline.yml`文件中，需要替换的用于MLOps部署的值：
- en: '![Figure 9.54 – Azure DevOps pipeline variable replacement](img/B18003_09_054.jpg)'
  id: totrans-320
  prefs: []
  type: TYPE_IMG
  zh: '![图9.54 – Azure DevOps管道变量替换](img/B18003_09_054.jpg)'
- en: Figure 9.54 – Azure DevOps pipeline variable replacement
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.54 – Azure DevOps管道变量替换
- en: The DevOps pipeline is broken into two stages – one stage for the `dev` environment
    pipeline run and model deployment in the `dev` environment, and the second stage
    for the model promotion and deployment into the `qa` environment.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: DevOps管道分为两个阶段 – 一个阶段用于在`dev`环境中运行管道和部署模型，另一个阶段用于将模型提升和部署到`qa`环境。
- en: 'Inside the Azure DevOps stages, we leverage a set of jobs, which are CLI tasks
    that leverage v2 of the AML CLI for retrieving the initial model version in the
    `dev` environment, running the AML pipeline, and then retrieving the final model
    version. This final model version indicates whether a model should be registered
    in the `qa` environment:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure DevOps阶段内部，我们利用一组作业，这些作业是利用AML CLI v2检索`dev`环境中的初始模型版本、运行AML管道，然后检索最终模型版本的CLI任务。这个最终模型版本指示模型是否应该在`qa`环境中注册：
- en: '[PRE13]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The preceding code is retrieved from the first stage and the first step within
    your Azure DevOps pipeline. Running this with Azure DevOps, we will retrieve the
    latest version of the model with the model name specified by the variable that
    is defined in your Azure DevOps pipeline as shown in the figure here. As you can
    see in the code, not only do we leverage the variable groups but we can also leverage
    variables defined directly in an Azure DevOps pipeline, as is the case with the
    `model_name` variable. Given this value does not change on the basis of the environment,
    we have added it to the pipeline definition itself, but we could have included
    it in the key vaults and retrieved it through our Azure DevOps variable groups
    as well.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码是从您的Azure DevOps管道的第一个阶段和第一个步骤中检索的。使用Azure DevOps运行此代码，我们将检索由您在Azure DevOps管道中定义的变量指定的模型名称的最新版本，如图所示。正如您在代码中所见，我们不仅利用了变量组，还可以直接在Azure
    DevOps管道中定义变量，例如`model_name`变量。鉴于此值不基于环境而改变，我们将其添加到管道定义本身，但也可以将其包含在密钥保管库中，并通过我们的Azure
    DevOps变量组检索它。
- en: 'The command run in Azure DevOps is modified slightly when placed into the Azure
    DevOps pipeline `yml` file, shown as follows:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure DevOps管道`yml`文件中放置时，在Azure DevOps中运行的命令略有修改，如下所示：
- en: '![Figure 9.55 – Checking whether the model exists](img/B18003_09_055.jpg)'
  id: totrans-327
  prefs: []
  type: TYPE_IMG
  zh: '![图9.55 – 检查模型是否存在](img/B18003_09_055.jpg)'
- en: Figure 9.55 – Checking whether the model exists
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.55 – 检查模型是否存在
- en: Inside our Azure CLI task in the Azure DevOps pipeline, we are checking whether
    the result of querying for the model in the workspace comes back as an empty string,
    and then we set the `modelversion` variable to `0`; otherwise, we retrieve it
    and set the `modeldeversion` variable in the Azure DevOps pipeline.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure DevOps管道中的Azure CLI任务内部，我们正在检查查询工作区中的模型的结果是否返回空字符串，然后我们将`modelversion`变量设置为`0`；否则，我们检索它并在Azure
    DevOps管道中设置`modeldeversion`变量。
- en: 'This will place the model version into an Azure DevOps variable that can be
    evaluated later in the pipeline, by running the following command:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 这将把模型版本放入一个Azure DevOps变量中，可以在管道的后续步骤中评估，通过运行以下命令：
- en: '[PRE14]'
  id: totrans-331
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'After setting the initial model version, we run the AML workspace pipeline
    from the Azure DevOps pipeline by leveraging the following code:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 在设置初始模型版本后，我们通过以下代码从Azure DevOps管道运行AML工作区管道：
- en: '[PRE15]'
  id: totrans-333
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Note that we set `force_rerun` to `True` here. AML knows the data has not changed,
    and if the code has not changed, then it reuses steps instead of rerunning them,
    which is great in a production workload. However, in a demo for updating a model,
    we would like to see the model version consistently updating, so we have set that
    value to `True`.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们在此将`force_rerun`设置为`True`。AML知道数据没有变化，如果代码没有变化，则它将重用步骤而不是重新运行它们，这在生产负载中非常好。然而，在更新模型的演示中，我们希望看到模型版本持续更新，因此我们将该值设置为`True`。
- en: 'In the first stage, we check whether the final model version and the initial
    model version are equal or not. The code here depicts checking the model version
    and setting an output variable, `runme`, to either `true` or `false`:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个阶段，我们检查最终模型版本和初始模型版本是否相等。此处的代码描述了检查模型版本并将输出变量`runme`设置为`true`或`false`：
- en: '![Figure 9.56 – Checking the model version](img/B18003_09_056.jpg)'
  id: totrans-336
  prefs: []
  type: TYPE_IMG
  zh: '![图9.56 – 检查模型版本](img/B18003_09_056.jpg)'
- en: Figure 9.56 – Checking the model version
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.56 – 检查模型版本
- en: 'If they are different, then we would like to deploy the new model in the `dev`
    environment, and we deploy the model with the AML CLI command:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 如果它们不同，那么我们希望在`dev`环境中部署新模型，我们使用AML CLI命令部署模型：
- en: '[PRE16]'
  id: totrans-339
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'In the code here, we reference the endpoint `.yml` file, the resource group,
    the workspace name, and the endpoint name. After the endpoint is created, we can
    create an online deployment, as shown here:'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 在此代码中，我们引用了`.yml`端点文件、资源组、工作区名称和端点名称。端点创建后，我们可以创建在线部署，如下所示：
- en: '[PRE17]'
  id: totrans-341
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Finally, we can update the traffic to the endpoint to be 100% by leveraging
    the following command:'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们可以通过以下命令将端点的流量更新为100%：
- en: '[PRE18]'
  id: totrans-343
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Note that we are tagging the endpoint with the deployment. By tagging the endpoint,
    we can quickly see which deployment is being used by our endpoint. This means
    the next time a new model is registered, we can create a new deployment to an
    existing managed online endpoint, ramp up its traffic, and then delete the old
    deployment.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们正在用部署标签端点。通过标记端点，我们可以快速看到端点正在使用哪个部署。这意味着下次注册新模型时，我们可以创建一个新的部署到现有的托管在线端点，增加其流量，然后删除旧部署。
- en: 'In the Azure DevOps pipeline, before handling the deployment, we check whether
    an endpoint already exists with our specified name by leveraging this command:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 在Azure DevOps管道中，在处理部署之前，我们通过使用此命令检查是否已存在具有我们指定名称的端点：
- en: '[PRE19]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Therefore, the second time, the endpoint will exist, and we will not create
    an endpoint, but we will still deploy an endpoint.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，第二次，端点将存在，我们不会创建端点，但我们仍然会部署端点。
- en: 'The second stage in the pipeline is the `QAPromoteModel` pipeline. It connects
    to the `dev` AML workspace and retrieves the model, downloads it, and then uses
    it in the `qa` environment. Once the model is downloaded onto the Azure DevOps
    build agent, we can register that in the `qa` AML workspace:'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 管道中的第二阶段是`QAPromoteModel`管道。它连接到`dev` AML工作区并检索模型，下载它，然后在`qa`环境中使用。一旦模型下载到Azure
    DevOps构建代理上，我们就可以在`qa` AML工作区中注册它：
- en: '[PRE20]'
  id: totrans-349
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Once the model is registered in the `qa` environment, we can check whether
    a managed online endpoint exists in the `qa` environment. If it has not yet been
    deployed, an online endpoint will be created leveraging the `create-endpoint.yml`
    file through the use of the AML CLI v2 as shown in the following code:'
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦模型在`qa`环境中注册，我们就可以检查`qa`环境中是否存在托管在线端点。如果尚未部署，将通过使用AML CLI v2的`create-endpoint.yml`文件创建在线端点，如下面的代码所示：
- en: '[PRE21]'
  id: totrans-351
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: If this managed online endpoint does exist, then we will then use `az ml online-deployment`
    to create a deployment in the managed online endpoint to leverage the model. After
    it is deployed, we can set the traffic on the managed online endpoint deployment
    to 100% traffic for our new deployment.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这个托管在线端点确实存在，那么我们将使用`az ml online-deployment`在托管在线端点中创建一个部署以利用该模型。部署完成后，我们可以将托管在线端点部署的流量设置为100%以供我们的新部署使用。
- en: If the model has already been deployed in this environment, there is no need
    to deploy the managed online endpoint, but we will want to swap from the previous
    deployment to our new deployment. This means we should create a new online deployment,
    and update a tag on the managed online endpoint that specifies which deployment
    is being used. This allows us to consistently create new deployments and swap
    from the previous online deployment to our next deployment, updating the traffic
    and then deleting the old deployment in the `qa` environment, as was done in the
    `dev` environment.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 如果模型已经在这个环境中部署，则不需要部署托管在线端点，但我们将想要从以前的部署切换到我们的新部署。这意味着我们应该创建一个新的在线部署，并在托管在线端点上更新一个标签，指定正在使用的部署。这允许我们持续创建新的部署，并从先前的在线部署切换到我们的下一个部署，更新流量，然后在`qa`环境中删除旧部署。
- en: Once you run your pipelines, you will be able to see the tag information for
    your managed online endpoint in the `dev` or `qa` environment from its details
    as shown in this figure.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦运行您的管道，您将能够从其详细信息中看到托管在线端点的标签信息，如图所示。
- en: '![Figure 9.57 – Managed online endpoint tag](img/B18003_09_057.jpg)'
  id: totrans-355
  prefs: []
  type: TYPE_IMG
  zh: '![图9.57 – 托管在线端点标签](img/B18003_09_057.jpg)'
- en: Figure 9.57 – Managed online endpoint tag
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.57 – 托管在线端点标签
- en: 'Each time this code runs, a new deployment name is generated, leveraging the
    epoch of the deployment time. This ensures that we have a unique name for a given
    deployment. Having this unique name ensures no conflicts will occur when deploying
    your online deployment. After the online deployment succeeds, we update the traffic
    to the latest online deployment, and then delete the old online deployment. This
    figure shows a deployment to a managed online endpoint:'
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 每次运行此代码时，都会根据部署时间的纪元生成一个新的部署名称。这确保了对于给定的部署有一个唯一的名称。拥有这个唯一的名称可以确保在部署在线部署时不会发生冲突。在线部署成功后，我们将流量更新到最新的在线部署，然后删除旧的在线部署。此图显示了将部署到托管在线端点的情况：
- en: '![Figure 9.58 – Deployment to a managed online endpoint](img/B18003_09_058.jpg)'
  id: totrans-358
  prefs: []
  type: TYPE_IMG
  zh: '![图9.58 – 将部署到托管在线端点](img/B18003_09_058.jpg)'
- en: Figure 9.58 – Deployment to a managed online endpoint
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.58 – 将部署到托管在线端点
- en: Note that in the figure, in the name after deployment, we include the model
    version number before **v** to quickly identify the model version for a given
    deployment.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，在图中，在部署名称之后，我们在**v**之前包含模型版本号，以便快速识别给定部署的模型版本。
- en: 'Now that you have reviewed the code and executed the notebook, generating the
    files needed for the Azure DevOps pipeline, a check-in of your code to the remote
    origin now pointing to your Azure DevOps repository will ensure the proper files
    are in place to create your Azure DevOps pipeline, which is our next step in the
    process. To check this code in, you can run the following commands:'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已审查了代码并执行了笔记本，生成了Azure DevOps管道所需的文件，将您的代码检入到远程origin（现在指向您的Azure DevOps仓库）将确保适当的文件已就位以创建您的Azure
    DevOps管道，这是我们流程中的下一步。要检入此代码，您可以运行以下命令：
- en: '[PRE22]'
  id: totrans-362
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Congratulations – your Azure DevOps environment is now linked with your AML
    workspaces. You have made it through the required steps for preparing your MLOps
    environment. You created an Azure DevOps organization and project. You moved your
    code into Azure DevOps, set up your Azure key vault, and linked it to your Azure
    DevOps variable groups. You also created an Azure DevOps environment to handle
    the approval process. You created your Azure DevOps service connections and, finally,
    committed the code required to create and run an Azure DevOps pipeline. In the
    next section, you will set up your Azure DevOps pipeline, which will trigger running
    an Azure DevOps pipeline.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜您 – 您的Azure DevOps环境现在已与您的AML工作区链接。您已成功完成准备MLOps环境所需的步骤。您创建了一个Azure DevOps组织和项目。您将代码移动到Azure
    DevOps，设置了Azure密钥保管库，并将其链接到您的Azure DevOps变量组。您还创建了一个Azure DevOps环境来处理审批流程。您创建了Azure
    DevOps服务连接，最后，提交了创建和运行Azure DevOps管道所需的代码。在下一节中，您将设置Azure DevOps管道，这将触发运行Azure
    DevOps管道。
- en: Running an Azure DevOps pipeline
  id: totrans-364
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 运行Azure DevOps管道
- en: 'We will start this section by creating an Azure DevOps pipeline. Your Azure
    DevOps pipeline will be kicked off any time you make a change to your code and
    push it to the **main** branch:'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从这个部分开始创建一个Azure DevOps管道。您的Azure DevOps管道将在您对代码进行更改并将其推送到**main**分支时启动：
- en: 'Inside Azure DevOps on the left-hand pane, select **Pipelines** and you will
    see the following screen:'
  id: totrans-366
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Azure DevOps的左侧面板中，选择**管道**，您将看到以下屏幕：
- en: '![Figure 9.59 – Creating your first Azure DevOps Pipeline](img/B18003_09_059.jpg)'
  id: totrans-367
  prefs: []
  type: TYPE_IMG
  zh: '![图9.59 – 创建您的第一个Azure DevOps管道](img/B18003_09_059.jpg)'
- en: Figure 9.59 – Creating your first Azure DevOps Pipeline
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.59 – 创建您的第一个Azure DevOps管道
- en: 'Click on the **Create Pipeline** button to begin the process, which will bring
    up the following window:'
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建管道**按钮开始过程，这将弹出一个窗口：
- en: '![Figure 9.60 – Selecting where your code is located](img/B18003_09_060.jpg)'
  id: totrans-370
  prefs: []
  type: TYPE_IMG
  zh: '![图9.60 – 选择您的代码位置](img/B18003_09_060.jpg)'
- en: Figure 9.60 – Selecting where your code is located
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.60 – 选择您的代码位置
- en: In the previous section, *Preparing your MLOps environment*, you placed your
    code into a code repository in Azure DevOps. Select the **Azure Repos Git** option
    from the preceding screenshot and this will ask you to select your repository,
    as shown in the following screenshot. Select your **mlops** repository here.
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在上一节*准备您的MLOps环境*中，您将代码放入了Azure DevOps中的代码仓库。从前面的屏幕截图中选择**Azure Repos Git**选项，这将要求您选择您的仓库，如图下所示。在此处选择您的**mlops**仓库。
- en: '![Figure 9.61 – Selecting your repository](img/B18003_09_061.jpg)'
  id: totrans-373
  prefs: []
  type: TYPE_IMG
  zh: '![图9.61 – 选择您的仓库](img/B18003_09_061.jpg)'
- en: Figure 9.61 – Selecting your repository
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.61 – 选择您的仓库
- en: 'Next, select the **Existing Azure Pipelines YAML file** option to use the pipeline
    you created by running your notebook and checking it into your Git repository:'
  id: totrans-375
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择**现有Azure管道YAML文件**选项，以使用您通过运行笔记本并将其检入Git仓库创建的管道：
- en: '![Figure 9.62 – Configure your pipeline](img/B18003_09_062.jpg)'
  id: totrans-376
  prefs: []
  type: TYPE_IMG
  zh: '![图9.62 – 配置您的管道](img/B18003_09_062.jpg)'
- en: Figure 9.62 – Configure your pipeline
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.62 – 配置您的管道
- en: 'Selecting this will take you to the next screen, as shown here:'
  id: totrans-378
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择此选项将带您进入下一个屏幕，如图所示：
- en: '![Figure 9.63 – Selecting your YAML file](img/B18003_09_063.jpg)'
  id: totrans-379
  prefs: []
  type: TYPE_IMG
  zh: '![图9.63 – 选择您的YAML文件](img/B18003_09_063.jpg)'
- en: Figure 9.63 – Selecting your YAML file
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.63 – 选择您的YAML文件
- en: 'In the **Path** dropdown, navigate to the **/Chapter09/src/AzureDevOpsPipeline.yml**
    file as shown here:'
  id: totrans-381
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**路径**下拉菜单中，导航到**/Chapter09/src/AzureDevOpsPipeline.yml**文件，如图所示：
- en: '![Figure 9.64 – Retrieving the path of AzureDevOpsPipeline.yml file](img/B18003_09_064.jpg)'
  id: totrans-382
  prefs: []
  type: TYPE_IMG
  zh: '![图9.64 – 获取AzureDevOpsPipeline.yml文件的路径](img/B18003_09_064.jpg)'
- en: Figure 9.64 – Retrieving the path of AzureDevOpsPipeline.yml file
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.64 – 获取AzureDevOpsPipeline.yml文件的路径
- en: 'Click on the **Continue** option after selecting the **AzureDevOpsPipeline.yml**
    file. This will bring up the source code for the Azure DevOps pipeline, as follows:'
  id: totrans-384
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在选择**AzureDevOpsPipeline.yml**文件后，点击**继续**选项。这将显示Azure DevOps管道的源代码，如下所示：
- en: '![Figure 9.65 – Retrieving your YAML](img/B18003_09_065.jpg)'
  id: totrans-385
  prefs: []
  type: TYPE_IMG
  zh: '![图9.65 – 获取你的YAML](img/B18003_09_065.jpg)'
- en: Figure 9.65 – Retrieving your YAML
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.65 – 获取你的YAML
- en: In the preceding screenshot, click on the **Run** button. When this pipeline
    runs, it will leverage your service connections. To use your service connections,
    you will need to provide permission for them to run.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的截图中，点击**运行**按钮。当此管道运行时，它将利用你的服务连接。要使用你的服务连接，你需要提供运行权限。
- en: 'Click on the `aml-dev` service connection:'
  id: totrans-388
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击`aml-dev`服务连接：
- en: '![Figure 9.66 – Providing Azure DevOps with permission](img/B18003_09_066.jpg)'
  id: totrans-389
  prefs: []
  type: TYPE_IMG
  zh: '![图9.66 – 向Azure DevOps提供权限](img/B18003_09_066.jpg)'
- en: Figure 9.66 – Providing Azure DevOps with permission
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.66 – 向Azure DevOps提供权限
- en: 'After clicking on the **View** option, you will provide permission for the
    pipeline to run. Click on the **Permit** button, as shown in the following screenshot:'
  id: totrans-391
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在点击**查看**选项后，你将为管道运行提供权限。点击以下截图所示的**允许**按钮：
- en: '![Figure 9.67 – Permitting the pipeline to use the service connection](img/B18003_09_067.jpg)'
  id: totrans-392
  prefs: []
  type: TYPE_IMG
  zh: '![图9.67 – 允许管道使用服务连接](img/B18003_09_067.jpg)'
- en: Figure 9.67 – Permitting the pipeline to use the service connection
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.67 – 允许管道使用服务连接
- en: Provide the appropriate permissions so the pipeline can execute by selecting
    **Permit** for each of the permissions needed as the pipeline progresses.
  id: totrans-394
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过在管道进展过程中为每个所需的权限选择**允许**，提供适当的权限，以便管道可以执行。
- en: 'As the pipeline executes, you can see the icons displaying that the workload
    is progressing, as shown in the following screenshot:'
  id: totrans-395
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当管道执行时，你可以看到显示工作负载正在进行的图标，如下截图所示：
- en: '![Figure 9.68 – Pipeline execution](img/B18003_09_068.jpg)'
  id: totrans-396
  prefs: []
  type: TYPE_IMG
  zh: '![图9.68 – 管道执行](img/B18003_09_068.jpg)'
- en: Figure 9.68 – Pipeline execution
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.68 – 管道执行
- en: 'Clicking on the **DevTrainingPipeline** stage will bring you to the details
    of the run, as shown here:'
  id: totrans-398
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**DevTrainingPipeline**阶段将带你到运行详情，如下所示：
- en: '![Figure 9.69 – Pipeline details](img/B18003_09_069.jpg)'
  id: totrans-399
  prefs: []
  type: TYPE_IMG
  zh: '![图9.69 – 管道详情](img/B18003_09_069.jpg)'
- en: Figure 9.69 – Pipeline details
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.69 – 管道详情
- en: 'As the initial pipeline kicks off, the model named `mmchapter9titanic` may
    not exist yet, depending on whether you ran the pipeline from your AML workspace.
    In this case, inside Azure DevOps, if you click on the **Get Initial Model Version**
    task, you will see the following error message:'
  id: totrans-401
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当初始管道启动时，名为`mmchapter9titanic`的模型可能尚不存在，这取决于你是否从AML工作区运行了管道。在这种情况下，在Azure DevOps中，如果你点击**获取初始模型版本**任务，你会看到以下错误消息：
- en: '![Figure 9.70 – Initial model find](img/B18003_09_070.jpg)'
  id: totrans-402
  prefs: []
  type: TYPE_IMG
  zh: '![图9.70 – 初始模型查找](img/B18003_09_070.jpg)'
- en: Figure 9.70 – Initial model find
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.70 – 初始模型查找
- en: This is correct given the model does not yet exist. In this case, we set the
    model version to `0` in the pipeline to continue a successful pipeline run.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 由于模型尚不存在，这是正确的。在这种情况下，我们在管道中将模型版本设置为`0`以继续成功的管道运行。
- en: 'Note that as `dev` instance of your AML workspace as a pipeline as shown in
    the following screenshot:'
  id: totrans-405
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意，以下截图显示了将你的AML工作区的`dev`实例作为一个管道：
- en: '![Figure 9.71 – AML pipeline run](img/B18003_09_071.jpg)'
  id: totrans-406
  prefs: []
  type: TYPE_IMG
  zh: '![图9.71 – AML管道运行](img/B18003_09_071.jpg)'
- en: Figure 9.71 – AML pipeline run
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.71 – AML管道运行
- en: As your Azure DevOps pipeline hits `deploydevmodel`, if it fails, it will likely
    be due to the fact your endpoint name in your region is already taken. If you
    have a failed task on the `deploydevmodel` task, look at the contents of the message
    in Azure DevOps. It is likely to say, **There is already an endpoint with this
    name, Endpoint name needs to be unique within a region. Try some** **other name.**
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的Azure DevOps管道遇到`deploydevmodel`时，如果失败，可能是因为你所在区域的端点名称已被占用。如果你在`deploydevmodel`任务上有失败的作业，请查看Azure
    DevOps中的消息内容。它可能会说，**已经存在具有此名称的端点，端点名称必须在区域内唯一。尝试一些** **其他名称**。**
- en: If that is the case, update your `.yml` files to leverage a different endpoint
    name.
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 如果是这样，更新你的`.yml`文件以利用不同的端点名称。
- en: After the model deployment completes in the `dev` environment, the pipeline
    will request approval to promote the model to the next environment.
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 在`dev`环境中模型部署完成后，管道将请求批准将模型提升到下一个环境。
- en: 'Once the `dev` stage is complete, approval will be requested, as shown here:'
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦`dev`阶段完成，将请求批准，如下所示：
- en: '![Figure 9.72 – Azure DevOps pipeline request for permission](img/B18003_09_072.jpg)'
  id: totrans-412
  prefs: []
  type: TYPE_IMG
  zh: '![图9.72 – Azure DevOps管道请求权限](img/B18003_09_072.jpg)'
- en: Figure 9.72 – Azure DevOps pipeline request for permission
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.72 – Azure DevOps管道请求权限
- en: Clicking on `QAPromote` model stage to retrieve the pending stage and approve
    or reject moving the model to the `qa` environment.
  id: totrans-414
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击`QAPromote`模型阶段以检索待处理阶段并批准或拒绝将模型移动到`qa`环境。
- en: '![Figure 9.73 – Pending QA promotion approval](img/B18003_09_073.jpg)'
  id: totrans-415
  prefs: []
  type: TYPE_IMG
  zh: '![图9.73 – 待批准的QA推广批准](img/B18003_09_073.jpg)'
- en: Figure 9.73 – Pending QA promotion approval
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.73 – 待批准的QA推广
- en: 'Clicking on the **Review** button, you will be able to either select **Reject**
    or **Approve** for the model promotion, as shown here:'
  id: totrans-417
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**审查**按钮，您可以选择为模型推广选择**拒绝**或**批准**，如下所示：
- en: '![Figure 9.74 – QA promotion approval](img/B18003_09_074.jpg)'
  id: totrans-418
  prefs: []
  type: TYPE_IMG
  zh: '![图9.74 – QA推广批准](img/B18003_09_074.jpg)'
- en: Figure 9.74 – QA promotion approval
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.74 – QA推广批准
- en: Once the QA promotion is approved, the model can be deployed to the `qa` environment.
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦QA推广获得批准，模型就可以部署到`qa`环境中。
- en: '![Figure 9.75 – qa environment deployment](img/B18003_09_075.jpg)'
  id: totrans-421
  prefs: []
  type: TYPE_IMG
  zh: '![图9.75 – qa环境部署](img/B18003_09_075.jpg)'
- en: Figure 9.75 – qa environment deployment
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.75 – qa环境部署
- en: 'As your pipeline runs, you can review the model registered in your `dev` AML
    workspace. As the pipeline executes, head over to your `qa` AML workspace and
    you will see a registered model, shown as follows:'
  id: totrans-423
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 随着您的管道运行，您可以在您的`dev` AML工作区中审查注册的模型。随着管道的执行，前往您的`qa` AML工作区，您将看到一个注册的模型，如下所示：
- en: '![Figure 9.76 – Registered model for the qa environment](img/B18003_09_076.jpg)'
  id: totrans-424
  prefs: []
  type: TYPE_IMG
  zh: '![图9.76 – qa环境的注册模型](img/B18003_09_076.jpg)'
- en: Figure 9.76 – Registered model for the qa environment
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.76 – qa环境的注册模型
- en: 'In addition to the registered model, you can review your managed online endpoint,
    as follows:'
  id: totrans-426
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 除了注册的模型外，您还可以按以下方式审查您的管理在线端点：
- en: '![Figure 9.77 –  Deployed online endpoint for the qa environment](img/B18003_09_077.jpg)'
  id: totrans-427
  prefs: []
  type: TYPE_IMG
  zh: '![图9.77 – qa环境的已部署在线端点](img/B18003_09_077.jpg)'
- en: Figure 9.77 – Deployed online endpoint for the qa environment
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.77 – qa环境的已部署在线端点
- en: The figure here demonstrates reviewing the managed online endpoint in the `qa`
    environment. Clicking on the name on the screen provides you with detailed information
    about the managed online endpoint.
  id: totrans-429
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此图展示了在`qa`环境中审查管理的在线端点。点击屏幕上的名称可以为您提供有关管理在线端点的详细信息。
- en: 'Inside the managed online endpoint, you will see the deployed instance of your
    model as shown here:'
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 在管理在线端点内部，您将看到您的模型部署实例，如下所示：
- en: '![Figure 9.78 – Managed online endpoint deployment in a qa environment](img/B18003_09_078.jpg)'
  id: totrans-431
  prefs: []
  type: TYPE_IMG
  zh: '![图9.78 – qa环境中的管理在线端点部署](img/B18003_09_078.jpg)'
- en: Figure 9.78 – Managed online endpoint deployment in a qa environment
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.78 – 在qa环境中管理的在线端点部署
- en: 'The deployment name is based on the epoch. Each time a model is deployed in
    the `qa` AML workspace, it checked the tag property:'
  id: totrans-433
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 部署名称基于纪元。每次在`qa` AML工作区中部署模型时，都会检查标签属性：
- en: '![Figure 9.79 – Tag property of the managed online endpoint](img/B18003_09_079.jpg)'
  id: totrans-434
  prefs: []
  type: TYPE_IMG
  zh: '![图9.79 – 管理在线端点的标签属性](img/B18003_09_079.jpg)'
- en: Figure 9.79 – Tag property of the managed online endpoint
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.79 – 管理在线端点的标签属性
- en: Provided there is a model deployed, it creates a new deployment, updates the
    tag, and deletes the old deployment. This ensures that users will experience minimal
    interruption as the new endpoint is deployed.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 如果已部署了模型，它将创建一个新的部署，更新标签，并删除旧部署。这确保了用户在新的端点部署时将经历最小的中断。
- en: In this chapter, you set up your MLOps pipeline by leveraging Azure DevOps to
    automate the orchestration of data preparation, model development, and model evaluation
    and registration; deploying the model by leveraging blue/green deployments; and
    promoting it from one environment to the next.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您通过利用Azure DevOps来自动化数据准备、模型开发和模型评估及注册的编排；通过利用蓝/绿部署来部署模型；并将其从一个环境推广到下一个环境。
- en: You are encouraged to leverage your `dev` AML workspace, make code modifications
    and review the process of your Azure DevOps pipeline, kick off your `dev` AML
    workspace pipeline, register the model in the `qa` environment, and update the
    managed online endpoints. Now that you have deployed managed online endpoints
    through an MLOps pipeline, take caution, as the endpoints are leveraging compute.
    You should delete the endpoints when you are not using them to keep your costs
    down. Congratulations – you have successfully implemented an MLOps pipeline!
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 鼓励您利用您的`dev` AML工作区，进行代码修改并审查您的Azure DevOps管道流程，启动您的`dev` AML工作区管道，在`qa`环境中注册模型，并更新托管在线端点。现在您已经通过MLOps管道部署了托管在线端点，请注意，端点正在使用计算资源。您在不使用它们时应该删除端点以降低成本。恭喜您
    – 您已成功实施了一个MLOps管道！
- en: Summary
  id: totrans-439
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, the focus was on deploying your model as a managed online endpoint
    to support real-time inferencing use cases in an automated fashion.
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，重点是自动以管理方式部署您的模型作为在线端点以支持实时推理用例。
- en: This chapter brought together the concepts that you learned about in previous
    chapters, as well as introducing you to Azure DevOps and the orchestration it
    makes possible. Leveraging Azure DevOps, code and deployments are traceable. Azure
    DevOps pipelines automate triggering the orchestration of the `dev` environment
    pipeline, moving the registered model to the higher environment. Leveraging Azure
    Key Vault, we can securely hold information to support multiple environments,
    linking those to your Azure DevOps environment groups. With MLflow integration,
    metrics are captured for the model generated in the `dev` environment, and that
    model number is registered in a higher environment and then added to the managed
    online endpoint. We implemented an MLOps pipeline to automate data transformation,
    model creation, evaluation, and model deployment.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 本章汇集了您在前几章中学到的概念，并介绍了Azure DevOps及其所提供的编排。利用Azure DevOps，代码和部署是可追踪的。Azure DevOps管道自动化触发`dev`环境管道的编排，将注册的模型移动到更高环境。利用Azure
    Key Vault，我们可以安全地保存信息以支持多个环境，并将这些环境链接到您的Azure DevOps环境组。通过MLflow集成，捕获了在`dev`环境中生成的模型的指标，并将该模型编号注册到更高环境，然后添加到托管在线端点。我们实施了一个MLOps管道来自动化数据转换、模型创建、评估和模型部署。
- en: In the next chapter, we will explore leveraging Deep Learning in your AML workspace.
    This will be a guide to leveraging object detection with AutoML to solve your
    object detection objectives.
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨在您的AML工作区中利用深度学习。这将是一个利用AutoML进行目标检测以解决您的目标检测目标的指南。
- en: Further reading
  id: totrans-443
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'As mentioned, in this chapter, we tried to provide a basis for creating your
    own MLOps pipeline. We encourage you to check out two additional resources for
    building your MLOps pipelines with AML:'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，在本章中，我们试图为您创建自己的MLOps管道提供一个基础。我们鼓励您查看两个额外的资源，以使用AML构建您的MLOps管道：
- en: '[https://github.com/Azure/mlops-v2](https://github.com/Azure/mlops-v2)'
  id: totrans-445
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/Azure/mlops-v2](https://github.com/Azure/mlops-v2)'
- en: '[https://github.com/microsoft/MLOpsPython](https://github.com/microsoft/MLOpsPython)'
  id: totrans-446
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/microsoft/MLOpsPython](https://github.com/microsoft/MLOpsPython)'
- en: 'Part 3: Productionizing Your Workload with MLOps'
  id: totrans-447
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第三部分：使用MLOps生产化您的作业
- en: In this section, readers will learn how to integrate AMLS jobs with Azure DevOps
    and Github to achieve an MLOps solution.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，读者将学习如何将AMLS作业与Azure DevOps和Github集成以实现MLOps解决方案。
- en: 'This section has the following chapters:'
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 本节包含以下章节：
- en: '[*Chapter 10*](B18003_10.xhtml#_idTextAnchor196), *Using Deep Learning in Azure
    Machine Learning*'
  id: totrans-450
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第10章*](B18003_10.xhtml#_idTextAnchor196), *在Azure机器学习中使用深度学习*'
- en: '[*Chapter 11*](B18003_11.xhtml#_idTextAnchor204), *Using Distributed Training
    in AMLS*'
  id: totrans-451
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第11章*](B18003_11.xhtml#_idTextAnchor204), *在AMLS中使用分布式训练*'

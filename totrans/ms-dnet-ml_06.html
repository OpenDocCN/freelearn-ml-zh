<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;6.&#xA0;AdventureWorks Redux &#x2013; k-NN and Na&#xEF;ve Bayes Classifiers" id="164MG1-a18db0be6c20485ba81f22e43ca13055"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06" class="calibre1"/>Chapter 6. AdventureWorks Redux – k-NN and Naïve Bayes Classifiers</h1></div></div></div><p class="calibre6">Let's jump back to AdventureWorks and put our software engineer hat back on. A couple weeks after your successful implementation of a model to improve high-margin bike sales to individual customers, the CEO comes to your desk and says, "Can you help us with a problem? If you were not aware, we started out as a bike-only company. Then, in May of 2013, we added additional merchandise to our product offering. Although it went well in the beginning, we seem to have plateaued. We want to try to push a bit harder in this area. Through some basic PowerBI reporting, we see that anywhere from 86 percent to 88 percent of the customers who buy a bike also buy additional merchandise at the time of purchase."</p><div class="informalexample"><table border="1" class="calibre19"><colgroup class="calibre20"><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/></colgroup><thead class="calibre22"><tr class="calibre23"><th valign="bottom" class="calibre24">
<p class="calibre25">Year Month</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Cross</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Solo</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Total</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">%Cross</p>
</th></tr></thead><tbody class="calibre26"><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201305</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">25</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">295</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">320</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">7.8%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201306</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">429</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">69</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">498</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">86.1%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201307</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">441</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">56</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">497</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">88.7%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201308</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">525</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">83</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">608</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">86.3%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201309</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">536</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">68</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">604</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">88.7%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201310</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">649</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">100</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">749</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">86.6%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201311</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">868</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">136</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1,004</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">86.5%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201312</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">698</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">99</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">797</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">87.6%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201401</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">800</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">97</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">897</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">89.2%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201402</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">702</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">96</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">798</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">88.0%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201403</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">891</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">135</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1,026</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">86.8%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201404</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">965</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">121</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1,086</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">88.9%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">201405</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1,034</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">152</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1,186</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">87.2%</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">TOTAL</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">8,563</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1,507</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">10,070</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">85.0%</p>
</td></tr></tbody></table></div><div class="mediaobject"><img src="../images/00077.jpeg" alt="AdventureWorks Redux – k-NN and Naïve Bayes Classifiers" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">The CEO continues, "We would love to be able to get that up above 90 percent. We launched an expensive marketing campaign, but it really didn't move the needle. Is there any way you can help us be more focused and identify those people on the fence for cross-selling opportunities?"</p><p class="calibre6">You say, "Sure," and immediately start thinking of a way to implement her instructions. Perhaps if you could identify some unique characteristics of those customers who buy additional merchandise compared to those customers who do not, a more targeted method might be implemented to get more people to buy additional merchandise. You immediately think <a id="id298" class="calibre1"/>of classification models like <span class="strong"><strong class="calibre7">K-Nearest Neighbor</strong></span> (<span class="strong"><strong class="calibre7">k-NN</strong></span>) and <span class="strong"><strong class="calibre7">Naïve Bayes</strong></span>. Since you are <a id="id299" class="calibre1"/>not sure which one might work, you decide to try them both out.</p></div>

<div class="book" title="Chapter&#xA0;6.&#xA0;AdventureWorks Redux &#x2013; k-NN and Na&#xEF;ve Bayes Classifiers" id="164MG1-a18db0be6c20485ba81f22e43ca13055">
<div class="book" title="k-Nearest Neighbors (k-NN)"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch06lvl1sec33" class="calibre1"/>k-Nearest Neighbors (k-NN)</h1></div></div></div><p class="calibre6">k-NN stands for k-Nearest Neighbors and is one of the most basic classification models available. Since a picture is worth a thousand words, let's take a look at k-NN from a graphical perspective. Consider a group of students who spent <a id="id300" class="calibre1"/>some amount of time studying and also drinking beers the night before the exam. On a graph, it looks like this:</p><div class="mediaobject"><img src="../images/00078.jpeg" alt="k-Nearest Neighbors (k-NN)" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">If I added a seventh student to the graph like this, would you think that the student passed or failed the exam?</p><div class="mediaobject"><img src="../images/00079.jpeg" alt="k-Nearest Neighbors (k-NN)" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">You would likely say they are a star—they passed the exam. If I asked you why, you would probably say that are more like the other stars. This kind of mental processing is very much how our minds work—if everyone in your neighborhood buys a Japanese car and thinks it has high quality, you are more likely to buy one too if you are looking for a high quality car. In<a id="id301" class="calibre1"/> fact, much of marketing is based on the k-NN theory.</p><p class="calibre6">Unlike the brain, which makes associations effortlessly, k-NN actually uses some math to classify. Going back to our seventh student, k-NN would put them in the passing students' group because the distance it is from the other passing students is short relative to the distance from the failing students:</p><div class="mediaobject"><img src="../images/00080.jpeg" alt="k-Nearest Neighbors (k-NN)" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">In fact, one of the simplest k-NN implementations is to take the average of all of the items of the category (five hours of studies and drinking one beer for the stars, on average) and measure<a id="id302" class="calibre1"/> that distance to the new item. Hopefully, the name k-NN makes sense now—for a given new item K, what are its nearest neighbors?</p></div></div>

<div class="book" title="Chapter&#xA0;6.&#xA0;AdventureWorks Redux &#x2013; k-NN and Na&#xEF;ve Bayes Classifiers" id="164MG1-a18db0be6c20485ba81f22e43ca13055">
<div class="book" title="k-Nearest Neighbors (k-NN)">
<div class="book" title="k-NN example"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec51" class="calibre1"/>k-NN example</h2></div></div></div><p class="calibre6">Let's take a look at k-NN in<a id="id303" class="calibre1"/> action using <span class="strong"><strong class="calibre7">Accord.NET</strong></span>. Open up Visual Studio and create a new Visual F# Windows Library project called <code class="literal">Classification</code>:</p><div class="mediaobject"><img src="../images/00081.jpeg" alt="k-NN example" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">Go into the <code class="literal">Script.fsx</code> file and remove all of its contents. Rename <code class="literal">Scipt.fsx</code> to <code class="literal">k-NNAccord.fsx</code>. Open up <span class="strong"><strong class="calibre7">NuGet Package Manager</strong></span> console and enter this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">PM&gt; install-package Accord.MachineLearning</strong></span>
</pre></div><p class="calibre6">Go back to your<a id="id304" class="calibre1"/> script and enter in the following code:</p><div class="informalexample"><pre class="programlisting">#r "../packages/Accord.3.0.2/lib/net40/Accord.dll"
#r "../packages/Accord.Math.3.0.2/lib/net40/Accord.Math.dll"
#r "../packages/Accord.MachineLearning.3.0.2/lib/net40/Accord.MachineLearning.dll"

open Accord
open Accord.Math
open Accord.MachineLearning

let inputs = [|[|5.0;1.0|];[|4.5;1.5|];[|5.1;0.75|];[|1.0;3.5|];[|0.5;4.0|];[|1.25;4.0|]|]
let outputs = [|1;1;1;0;0;0|]

let classes = 2
let k = 3
let knn = new KNearestNeighbors(k, classes, inputs, outputs)</pre></div><p class="calibre6">Send this to the REPL to see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val inputs : float [] [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|[|5.0; 1.0|]; [|4.5; 1.5|]; [|5.1; 0.75|]; [|1.0; 3.5|]; [|0.5; 4.0|];</strong></span>
<span class="strong"><strong class="calibre7">    [|1.25; 4.0|]|]</strong></span>
<span class="strong"><strong class="calibre7">val outputs : int [] = [|1; 1; 1; 0; 0; 0|]</strong></span>
<span class="strong"><strong class="calibre7">val classes : int = 2</strong></span>
<span class="strong"><strong class="calibre7">val k : int = 3</strong></span>
<span class="strong"><strong class="calibre7">val knn : KNearestNeighbors</strong></span>
</pre></div><p class="calibre6">Most of this code<a id="id305" class="calibre1"/> should look familiar to you by now. The inputs represent six students with two characteristics: how many hours they spent studying the night before an exam and how much beer they drank. The outputs represent whether they passed the exam: <code class="literal">1</code> if they passed, <code class="literal">0</code> if they did not. The class's value tells Accord that there are two types of values to consider. In this case, those values are the hours spent in studying and the quantity of beer consumed. The <code class="literal">k</code> value tells Accord how many data points we want to use for the calculation for each class. If we changed that to <code class="literal">4</code>, then we would have included one failing student with the three passing students (and vice versa), which would have watered down our result.</p><p class="calibre6">Go back to the script and enter these lines that represent the seventh student:</p><div class="informalexample"><pre class="programlisting">let input = [|5.0;0.5|]
let output = knn.Compute input</pre></div><p class="calibre6">When you send it to the FSI, you will see that student number <code class="literal">7</code> will most likely pass the exam:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val input : float [] = [|5.0; 0.5|]</strong></span>
<span class="strong"><strong class="calibre7">val output : int = 1</strong></span>
</pre></div><p class="calibre6">As I mentioned earlier, k-NN is one of the most basic machine learning models you can use, but in certain circumstances it can be surprisingly powerful. One of the more common adjustments to k-NN is weighing the distance from the neighbors. The closer a point is to the neighbors, the more weight that distance gets. The biggest criticism of k-NN is that it can overweigh if there are many observations that center around one point, so it is important to have a balanced dataset, if possible.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Na&#xEF;ve Bayes"><div class="book" id="173722-a18db0be6c20485ba81f22e43ca13055"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec34" class="calibre1"/>Naïve Bayes</h1></div></div></div><p class="calibre6">Naïve Bayes is a <a id="id306" class="calibre1"/>classification model that attempts to predict if an entity belongs to a series of predefined sets. When you aggregate all the sets together, you have a pretty good estimation of the final result. In order to illustrate, let's go back to the tennis example that we used when talking about decision trees.</p><p class="calibre6">We have the following observations for two weeks:</p><div class="informalexample"><table border="1" class="calibre19"><colgroup class="calibre20"><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/></colgroup><thead class="calibre22"><tr class="calibre23"><th valign="bottom" class="calibre24">
<p class="calibre25">Day</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Outlook</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Temperature</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Humidity</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Wind</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">PlayTennis?</p>
</th></tr></thead><tbody class="calibre26"><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">sunny</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Hot</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">High</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">No</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">sunny</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Hot</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">High</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">No</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">overcast</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Hot</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">High</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">3</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">rain</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Mild</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">High</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">4</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">rain</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Cool</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">5</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">rain</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Cool</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">No</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">6</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">overcast</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Cool</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">7</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">sunny</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Mild</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">High</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">No</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">8</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">sunny</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Cool</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">9</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">rain</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Mild</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">10</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">sunny</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Mild</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">11</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">overcast</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Mild</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">High</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">12</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">overcast</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Hot</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">yes</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">13</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">rain</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Mild</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">High</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">no</p>
</td></tr></tbody></table></div><p class="calibre6">For each one of the<a id="id307" class="calibre1"/> classes, let's break down whether they wound up playing tennis that day and then do a percentage for each possibility:</p><div class="informalexample"><table border="1" class="calibre19"><colgroup class="calibre20"><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/></colgroup><thead class="calibre22"><tr class="calibre23"><th valign="bottom" class="calibre24">
<p class="calibre25">ID</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Outlook</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">Yes</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">No</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">% Yes</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">% No</p>
</th></tr></thead><tbody class="calibre26"><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">sunny</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">3</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.22</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.60</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">overcast</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">4</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.44</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.00</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">rain</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">3</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.33</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.40</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Total</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">9</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">5</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1.00</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1.00</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td></tr><tr class="calibre23"><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">ID</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Temperature</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Yes</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">No</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">% Yes</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">% No</strong></span></p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">hot</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.22</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.40</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">mild</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">4</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.44</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.40</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">cool</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">3</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.33</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.20</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Total</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">9</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">5</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1.00</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1.00</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td></tr><tr class="calibre23"><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">ID</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Humidity</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Yes</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">No</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">% Yes</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">% No</strong></span></p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">high</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">3</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">4</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.33</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.80</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">6</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.67</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.20</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Total</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">9</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">5</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1.00</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1.00</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td></tr><tr class="calibre23"><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">ID</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Wind</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Yes</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">No</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">% Yes</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">% No</strong></span></p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">6</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.67</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.40</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">3</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">3</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.33</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.60</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Total</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">9</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">5</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1.00</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1.00</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td></tr><tr class="calibre23"><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">ID</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Final</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Yes</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">No</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">% Yes</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">% No</strong></span></p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">Play</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">9</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">5</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.64</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.36</p>
</td></tr></tbody></table></div><p class="calibre6">With these grids available, we can then predict if a person will or will not play tennis for a series of conditions. For <a id="id308" class="calibre1"/>example, will a person play on a sunny, cool day with high humidity and strong winds? We can pull the percentages from each grid:</p><div class="informalexample"><table border="1" class="calibre19"><colgroup class="calibre20"><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/><col class="calibre21"/></colgroup><thead class="calibre22"><tr class="calibre23"><th valign="bottom" class="calibre24"> </th><th valign="bottom" class="calibre24"> </th><th valign="bottom" class="calibre24">
<p class="calibre25">Yes</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">No</p>
</th></tr></thead><tbody class="calibre26"><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Outlook</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">sunny</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.222</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.600</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Temperature</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">cool</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.333</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.200</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Humidity</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">high</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.333</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.800</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Wind</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.333</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.600</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">final</strong></span></p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.643</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0.357</p>
</td></tr></tbody></table></div><p class="calibre6">And then the values can be multiplied together for each possibility:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Probability of Yes = 0.222 * 0.333 * 0.333 * 0.333 * 0.643 = 0.005</li><li class="listitem">Probability of No = 0.600 * 0.200 * 0.800 * 0.600 * 0.357 = 0.021</li></ul></div><p class="calibre6">You can see that there is a higher percentage not playing than playing. We can also take the two percentages and compare them to each other like this:</p><p class="calibre6"><span class="strong"><em class="calibre11">0.005 + 0.021 = 0.026</em></span></p><p class="calibre6"><span class="strong"><em class="calibre11">0.005/0.026 = 0.205 and 0.021/0.026 = 0.795</em></span></p><p class="calibre6">There is about a 20 percent chance of playing tennis and 80 percent chance of not playing.</p></div>

<div class="book" title="Na&#xEF;ve Bayes">
<div class="book" title="Naïve Bayes in action"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec52" class="calibre1"/>Naïve Bayes in action</h2></div></div></div><p class="calibre6">Let's see how Accord.NET calculates a Naïve Bayes model. Go to Visual Studio and add a new script file <a id="id309" class="calibre1"/>called <code class="literal">NaiveBayesAccord.fsx</code>:</p><p class="calibre6">In that script, add the following code:</p><div class="informalexample"><pre class="programlisting">#r "../packages/Accord.3.0.2/lib/net40/Accord.dll"
#r "../packages/Accord.Math.3.0.2/lib/net40/Accord.Math.dll"
#r "../packages/Accord.Statistics.3.0.2/lib/net40/Accord.Statistics.dll"
#r "../packages/Accord.MachineLearning.3.0.2/lib/net40/Accord.MachineLearning.dll"

open Accord
open Accord.Math
open Accord.Statistics
open Accord.MachineLearning.Bayes

let inputs = [|[|0;0;0;0|];[|0;0;0;1|];[|1;0;0;0|];
               [|2;1;0;0|];[|2;2;1;0|];[|2;2;1;1|];
               [|1;2;1;1|];[|0;1;0;0|];[|0;2;1;0|];
               [|2;1;1;0|];[|0;2;1;1|];[|1;1;0;1|];
               [|1;0;1;0|];[|2;1;0;1|]|]

let outputs = [|0;0;1;1;1;0;1;0;1;1;1;1;1;0|]

let symbols = [|3;3;2;2|]</pre></div><p class="calibre6">When you send them to the FSI, you will see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val inputs : int [] [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|[|0; 0; 0; 0|]; [|0; 0; 0; 1|]; [|1; 0; 0; 0|]; [|2; 1; 0; 0|];</strong></span>
<span class="strong"><strong class="calibre7">    [|2; 2; 1; 0|]; [|2; 2; 1; 1|]; [|1; 2; 1; 1|]; [|0; 1; 0; 0|];</strong></span>
<span class="strong"><strong class="calibre7">    [|0; 2; 1; 0|]; [|2; 1; 1; 0|]; [|0; 2; 1; 1|]; [|1; 1; 0; 1|];</strong></span>
<span class="strong"><strong class="calibre7">    [|1; 0; 1; 0|]; [|2; 1; 0; 1|]|]</strong></span>

<span class="strong"><strong class="calibre7">&gt;</strong></span>

<span class="strong"><strong class="calibre7">val outputs : int [] = [|0; 0; 1; 1; 1; 0; 1; 0; 1; 1; 1; 1; 1; 0|]</strong></span>

<span class="strong"><strong class="calibre7">&gt;</strong></span>

<span class="strong"><strong class="calibre7">val symbols : int [] = [|3; 3; 2; 2|]</strong></span>
</pre></div><p class="calibre6">The inputs are the values<a id="id310" class="calibre1"/> turned into integers. Consider the following example:</p><div class="informalexample"><table border="1" class="calibre19"><colgroup class="calibre20"><col class="calibre21"/><col class="calibre21"/></colgroup><thead class="calibre22"><tr class="calibre23"><th valign="bottom" class="calibre24">
<p class="calibre25">Outlook</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">ID</p>
</th></tr></thead><tbody class="calibre26"><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Sunny</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Overcast</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Rain</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td></tr><tr class="calibre23"><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Temperature</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">ID</strong></span></p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Hot</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Mild</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Cool</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">2</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td></tr><tr class="calibre23"><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Humidity</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">ID</strong></span></p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">High</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Normal</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27"> </td><td valign="top" class="calibre27"> </td></tr><tr class="calibre23"><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">Wind</strong></span></p>
</td><td valign="bottom" class="calibre27">
<p class="calibre25"><span><strong class="calibre29">ID</strong></span></p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Weak</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Strong</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td></tr></tbody></table></div><p class="calibre6">The position in each array is <span class="strong"><em class="calibre11">[outlook;temperature;humidity;wind]</em></span>.</p><p class="calibre6">The outputs are the result values turned into integers:</p><div class="informalexample"><table border="1" class="calibre19"><colgroup class="calibre20"><col class="calibre21"/><col class="calibre21"/></colgroup><thead class="calibre22"><tr class="calibre23"><th valign="bottom" class="calibre24">
<p class="calibre25">Play</p>
</th><th valign="bottom" class="calibre24">
<p class="calibre25">ID</p>
</th></tr></thead><tbody class="calibre26"><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">No</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">0</p>
</td></tr><tr class="calibre23"><td valign="top" class="calibre27">
<p class="calibre25">Yes</p>
</td><td valign="top" class="calibre27">
<p class="calibre25">1</p>
</td></tr></tbody></table></div><p class="calibre6">The symbols value is an array that tells Accord the total number of possible values for each feature. For example, the first position is for outlook and there are three possible values: (0, 1, 2).</p><p class="calibre6">Go back to the script and add in the Naïve Bayes calculation:</p><div class="informalexample"><pre class="programlisting">let bayes = new Accord.MachineLearning.Bayes.NaiveBayes(4,symbols)
let error = bayes.Estimate(inputs, outputs)</pre></div><p class="calibre6">Sending to the REPL gives the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val bayes : Bayes.NaiveBayes</strong></span>
<span class="strong"><strong class="calibre7">val error : float = 0.1428571429</strong></span>
</pre></div><p class="calibre6">The error is <a id="id311" class="calibre1"/>calculated by Accord re-running its estimate several times and comparing the actual to the expected. A good way of interpreting the error is that the lower the number is better, and the domain dictates if the actual number is "good enough". For example, a 14 percent error is great for social experiments, where humans are capable for random and unpredictable behaviors. Conversely, a 14 percent error rate for predicting airplane engine failure would not be considered acceptable.</p><p class="calibre6">Finally, let's see a prediction for sunny outlook, mild temperature, normal humidity, and weak wind. Go to the script and add this:</p><div class="informalexample"><pre class="programlisting">let input = [|0;1;1;0|]
let output = bayes.Compute(input)</pre></div><p class="calibre6">Sending to the REPL gives us the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val input : int [] = [|0; 1; 1; 0|]</strong></span>
<span class="strong"><strong class="calibre7">val output : int = 1</strong></span>
</pre></div><p class="calibre6">So we will be playing tennis on that day.</p></div></div>

<div class="book" title="Na&#xEF;ve Bayes">
<div class="book" title="One thing to keep in mind while using Naïve Bayes"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec53" class="calibre1"/>One thing to keep in mind while using Naïve Bayes</h2></div></div></div><p class="calibre6">Created in the 1950s, Naïve Bayes is a highly <a id="id312" class="calibre1"/>effective classification model that has stood the test of time. In fact, many spam filters today still use, in part, Naïve Bayes. The biggest advantages of using Naïve Bayes are its simplicity and its ability to, well, be right. The biggest downside is the key assumption that every <span class="strong"><em class="calibre11">x</em></span> variable is completely and utterly independent. If there is any chance that the <span class="strong"><em class="calibre11">x</em></span> variables are collinear, Naïve Bayes breaks down. Also, Naïve Bayes, historically, has been applied to datasets that are Gaussian—that it follows a bell curve. If you are not familiar with a bell curve, it is a distribution of data where the most observations occur in the middle values with the outliers to both sides of the middle having roughly the same number of observations. Here is an example:</p><div class="mediaobject"><img src="../images/00082.jpeg" alt="One thing to keep in mind while using Naïve Bayes" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">In contrast, a skewed distribution<a id="id313" class="calibre1"/> has the most observations at one end or the other:</p><div class="mediaobject"><img src="../images/00083.jpeg" alt="One thing to keep in mind while using Naïve Bayes" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">When you use Naïve Bayes, you will have to make sure the distribution you select matches your data. Let's now see if k-NN and/or Naïve Bayes can help us with AdventureWorks.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="AdventureWorks"><div class="book" id="181NK2-a18db0be6c20485ba81f22e43ca13055"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec35" class="calibre1"/>AdventureWorks</h1></div></div></div><p class="calibre6">In this section, we are<a id="id314" class="calibre1"/> going to take the knowledge that we gained in <a class="calibre1" title="Chapter 5. Time Out – Obtaining Data" href="part0036_split_000.html#12AK81-a18db0be6c20485ba81f22e43ca13055">Chapter 5</a>, <span class="strong"><em class="calibre11">Time Out – Obtaining Data</em></span>, to extract and transform data and apply both k-NN and Naïve Bayes machine learning models. Let's see if none, one, or both methodologies will help us increase cross-sales.</p></div>

<div class="book" title="AdventureWorks">
<div class="book" title="Getting the data ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec54" class="calibre1"/>Getting the data ready</h2></div></div></div><p class="calibre6">Go into Visual Studio and add another script called <code class="literal">AdventureWorks.fsx</code>. Open up the script, remove all of the<a id="id315" class="calibre1"/> contents, and open <span class="strong"><strong class="calibre7">NuGet Package Manager</strong></span> console. In the package manager, run the following lines:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">PM&gt; Install-Package FSharp.EntityFramework.MicrosoftSqlServer –Pre</strong></span>
<span class="strong"><strong class="calibre7">PM&gt; Install-Package fslab</strong></span>
<span class="strong"><strong class="calibre7">PM&gt; Install-Package FSharp.Data.SqlClient</strong></span>
<span class="strong"><strong class="calibre7">PM&gt; Install-Package Microsoft.SqlServer.Types</strong></span>
</pre></div><p class="calibre6">Go back to the script file and add the following references:</p><div class="informalexample"><pre class="programlisting">#I "../packages"

#r "EntityFramework.Core.7.0.0-rc1-final/lib/net451/EntityFramework.Core.dll"
#r "EntityFramework.MicrosoftSqlServer.7.0.0-rc1-final/lib/net451/EntityFramework.MicrosoftSqlServer.dll"
#r "EntityFramework.Relational.7.0.0-rc1-final/lib/net451/EntityFramework.Relational.dll"
#r "Inflector.1.0.0.0/lib/net45/Inflector.dll"
#r "Microsoft.Extensions.Caching.Abstractions.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.Caching.Abstractions.dll"
#r "Microsoft.Extensions.Caching.Memory.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.Caching.Memory.dll"
#r "Microsoft.Extensions.Configuration.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.Configuration.dll"
#r "Microsoft.Extensions.Configuration.Abstractions.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.Configuration.Abstractions.dll"
#r "Microsoft.Extensions.Configuration.Binder.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.Configuration.Binder.dll"
#r "Microsoft.Extensions.DependencyInjection.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.DependencyInjection.dll"
#r "Microsoft.Extensions.Logging.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.Logging.dll"
#r "Microsoft.Extensions.Logging.Abstractions.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.Logging.Abstractions.dll"
#r "Microsoft.Extensions.OptionsModel.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.OptionsModel.dll"
#r "Microsoft.Extensions.Primitives.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.Primitives.dll"
#r "Remotion.Linq.2.0.1/lib/net45/Remotion.Linq.dll"
#r "System.Collections.Immutable.1.1.36/lib/portable-net45+win8+wp8+wpa81/System.Collections.Immutable.dll"
#r "System.Diagnostics.DiagnosticSource.4.0.0-beta-23516/lib/dotnet5.2/System.Diagnostics.DiagnosticSource.dll"
#r "System.Xml.Linq.dll"
#r "Ix-Async.1.2.5/lib/net45/System.Interactive.Async.dll"
#r "FSharp.EntityFramework.MicrosoftSqlServer.0.0.2.0-alpha/lib/net451/FSharp.EntityFramework.MicrosoftSqlServer.dll"

#r "../packages/Microsoft.Extensions.DependencyInjection.Abstractions.1.0.0-rc1-final/lib/net451/Microsoft.Extensions.DependencyInjection.Abstractions.dll"
#r "../packages/FSharp.Data.SqlClient.1.7.7/lib/net40/FSharp.Data.SqlClient.dll"
#r "../packages/Microsoft.SqlServer.Types.11.0.2/lib/net20/Microsoft.SqlServer.Types.dll"
#r "../packages/FSharp.Data.2.2.5/lib/net40/FSharp.Data.dll"

#r "../packages/Accord.3.0.2/lib/net40/Accord.dll"
#r "../packages/Accord.Math.3.0.2/lib/net40/Accord.Math.dll"
#r "../packages/Accord.MachineLearning.3.0.2/lib/net40/Accord.MachineLearning.dll"
#r "../packages/Accord.Statistics.3.0.2/lib/net40/Accord.Statistics.dll"

open System
open FSharp.Data
open FSharp.Data.Entity
open Microsoft.Data.Entity

open Accord
open Accord.Math
open Accord.Statistics
open Accord.MachineLearning
open Accord.Statistics.Filters
open Accord.Statistics.Analysis
open Accord.MachineLearning.Bayes
open Accord.Statistics.Models.Regression
open Accord.Statistics.Models.Regression.Fitting</pre></div><p class="calibre6">Next add the<a id="id316" class="calibre1"/> following lines of code:</p><div class="informalexample"><pre class="programlisting">[&lt;Literal&gt;]
let connectionString = "data source=nc54a9m5kk.database.windows.net;initial catalog=AdventureWorks2014;user id=PacktReader;password=P@cktM@chine1e@rning;"
type AdventureWorks = SqlServer&lt;connectionString, Pluralize = true&gt;
let context = new AdventureWorks()</pre></div><p class="calibre6">If you remember from <a class="calibre1" title="Chapter 5. Time Out – Obtaining Data" href="part0036_split_000.html#12AK81-a18db0be6c20485ba81f22e43ca13055">Chapter 5</a>, <span class="strong"><em class="calibre11">Time Out – Obtaining Data</em></span>, this is creating our type provider to pull data from the database. Send everything so far to the REPL to see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">    nested type Sales.SalesTerritoryHistory</strong></span>
<span class="strong"><strong class="calibre7">    nested type Sales.ShoppingCartItem</strong></span>
<span class="strong"><strong class="calibre7">    nested type Sales.SpecialOffer</strong></span>
<span class="strong"><strong class="calibre7">    nested type Sales.SpecialOfferProduct</strong></span>
<span class="strong"><strong class="calibre7">    nested type Sales.Store</strong></span>
<span class="strong"><strong class="calibre7">    nested type dbo.AWBuildVersion</strong></span>
<span class="strong"><strong class="calibre7">    nested type dbo.DatabaseLog</strong></span>
<span class="strong"><strong class="calibre7">    nested type dbo.ErrorLog</strong></span>
<span class="strong"><strong class="calibre7">  end</strong></span>
<span class="strong"><strong class="calibre7">val context : AdventureWorks</strong></span>
</pre></div><p class="calibre6">Go back to the <a id="id317" class="calibre1"/>script and add this:</p><div class="informalexample"><pre class="programlisting">let (|=|) id a = Array.contains id a
let productSubcategories = [|new System.Nullable&lt;int&gt;(1); new System.Nullable&lt;int&gt;(2); new System.Nullable&lt;int&gt;(3)|]</pre></div><p class="calibre6">Sending this to the FSI gives the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val ( |=| ) : id:'a -&gt; a:'a [] -&gt; bool when 'a : equality</strong></span>
<span class="strong"><strong class="calibre7">val productSubcategories : Nullable&lt;int&gt; [] = [|1; 2; 3|]</strong></span>
</pre></div><p class="calibre6">This is also from <a class="calibre1" title="Chapter 5. Time Out – Obtaining Data" href="part0036_split_000.html#12AK81-a18db0be6c20485ba81f22e43ca13055">Chapter 5</a>, <span class="strong"><em class="calibre11">Time Out – Obtaining Data</em></span>; we are overriding the <code class="literal">in</code> operator to handle null values in the database.</p><p class="calibre6">Go back to the script and add the following code:</p><div class="informalexample"><pre class="programlisting">let orderCustomers = 
    query { for soh in context.``Sales.SalesOrderHeaders`` do
            join sod in context.``Sales.SalesOrderDetails`` on (soh.SalesOrderID = sod.SalesOrderID)
            join p in context.``Production.Products`` on (sod.ProductID = p.ProductID)
            join c in context.``Sales.Customers`` on (soh.CustomerID = c.CustomerID)
            where (soh.OrderDate &gt; DateTime(2013,5,1) &amp;&amp; p.ProductSubcategoryID |=| productSubcategories &amp;&amp; c.StoreID  = System.Nullable&lt;int&gt;())
            select(soh.SalesOrderID,c.CustomerID)} |&gt; Seq.toArray</pre></div><p class="calibre6">Sending this to the REPL, we get:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val orderCustomers : (int * int) [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|(50788, 27575); (50789, 13553); (50790, 21509); (50791, 15969);</strong></span>
<span class="strong"><strong class="calibre7">    (50792, 15972); (50793, 14457); (50794, 27488); (50795, 27489);</strong></span>
<span class="strong"><strong class="calibre7">    (50796, 27490); (50797, 17964); (50798, 17900); (50799, 21016);</strong></span>
<span class="strong"><strong class="calibre7">    (50800, 11590); (50801, 15989); (50802, 14494); (50803, 15789);</strong></span>
<span class="strong"><strong class="calibre7">    (50804, 24466); (50805, 14471); (50806, 17980); (50807, 11433);</strong></span>
<span class="strong"><strong class="calibre7">    (50808, 115</strong></span>
</pre></div><p class="calibre6">Even though we haven't seen this exact code before, we have seen code that is pretty close. In this block, we are creating a computational expression. We are joining together the <code class="literal">SalesOrderHeader</code>, <code class="literal">SalesOrderDetail</code>, <code class="literal">Products</code>, and <code class="literal">Customer</code> tables so we can select only the records we are interested in for this analysis. This would be: all bike sales to individual customers after May 1, 2013. Notice that we are returning two integers as a tuple: the <code class="literal">SalesOrderId</code> and the <code class="literal">CustomerId</code>.</p><p class="calibre6">Go back to the <a id="id318" class="calibre1"/>script and add the following code block:</p><div class="informalexample"><pre class="programlisting">let salesOrderIds = orderCustomers |&gt; Array.distinctBy(fun (soid,coid) -&gt; soid)
                                   |&gt; Array.map(fun (soid,cid) -&gt; soid)</pre></div><p class="calibre6">Sending this to the FSI gives us the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val salesOrderIds : int [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|50788; 50789; 50790; 50791; 50792; 50793; 50794; 50795; 50796; 50797;</strong></span>
<span class="strong"><strong class="calibre7">    50798; 50799; 50800; 50801; 50802; 50803; 50804; 50805; 50806; 50807;</strong></span>
<span class="strong"><strong class="calibre7">    50808; 50809</strong></span>
</pre></div><p class="calibre6">As you can probably tell, this creates an array of unique <code class="literal">CustomerIds</code>. Since a customer might have bought two bikes, they might have two <code class="literal">SalesOrderIds</code> so we need to call the <code class="literal">distinctBy</code> high-ordered function.</p><p class="calibre6">Go back to the script and enter this:</p><div class="informalexample"><pre class="programlisting">let orderDetailCounts = 
    query { for soh in context.``Sales.SalesOrderHeaders`` do
            join sod in context.``Sales.SalesOrderDetails`` on (soh.SalesOrderID = sod.SalesOrderID)
            join p in context.``Production.Products`` on (sod.ProductID = p.ProductID)
            join c in context.``Sales.Customers`` on (soh.CustomerID = c.CustomerID)
            where (sod.SalesOrderID |=| salesOrderIds)
            select(sod.SalesOrderID, sod.SalesOrderDetailID)} 
            |&gt; Seq.countBy(fun (soid, sodid) -&gt; soid)
            |&gt; Seq.toArray</pre></div><p class="calibre6">Send this to the FSI to get this (it takes a couple of seconds):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val orderDetailCounts : (int * int) [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|(50788, 1); (50789, 1); (50790, 1); (50791, 1); (50792, 1); (50793, 1);</strong></span>
<span class="strong"><strong class="calibre7">    (50794, 1); (50795, 1); (50796, 1); (50797, 1); (50798, 1); (50799, 1);</strong></span>
<span class="strong"><strong class="calibre7">    (50800, 1); (50801, 1); (50802, 1); (50803, 1); (50804, 1); (50805, 1);</strong></span>
<span class="strong"><strong class="calibre7">    (50806, 1); (50807</strong></span>
</pre></div><p class="calibre6">This is a similar query to the first one. Here we are joining together the same four tables and then selecting both the <code class="literal">SalesOrderId</code> and the <code class="literal">SalesOrderDetailId</code> for the customers we have already identified. We then apply the <code class="literal">countBy</code> high-order function to count up all of the details for each order. If there is only one <code class="literal">OrderDetailId</code>, then only the bike was purchased. If there is more than one, then the customer purchased items along with the bike.</p><p class="calibre6">We now have to <a id="id319" class="calibre1"/>pull individual details for a given customer. Since the database is in third normal form, these details are scattered across many tables. Instead of generating a pretty nasty expression, let's use the built-in view that has already been created in the database: <code class="literal">vIndividualCustomer</code>.</p><p class="calibre6">The catch is that the EF type provider cannot handle views at the time of this writing. The answer to this problem is another type provider.</p><p class="calibre6">Go to the script and enter this:</p><div class="informalexample"><pre class="programlisting">[&lt;Literal&gt;]
let commandText = "Select * from [Sales].[vIndividualCustomer]"
let command = new SqlCommandProvider&lt;commandText,connectionString&gt;()
let output = command.Execute() 
let customers = output |&gt; Seq.toArray</pre></div><p class="calibre6">Sending this to the REPL, you can see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val commandText : string = "Select * from [Sales].[vIndividualCustomer]"</strong></span>
<span class="strong"><strong class="calibre7">val command : SqlCommandProvider&lt;...&gt;</strong></span>
<span class="strong"><strong class="calibre7">val output : Collections.Generic.IEnumerable&lt;SqlCommandProvider&lt;...&gt;.Record&gt;</strong></span>
<span class="strong"><strong class="calibre7">val customers : SqlCommandProvider&lt;...&gt;.Record [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|{ BusinessEntityID = 9196; Title = None; FirstName = "Calvin"; MiddleName = Some "A"; LastName = "Raji"; Suffix = None; PhoneNumber = Some "230-555-0191"; PhoneNumberType = Some "Cell"; EmailAddress = Some "calvin20@adventure-works.com"; EmailPromotion = 2; AddressType = "Shipping"; AddressLine1 = "5415 San Gabriel Dr."; AddressLine2 = None; City = "Bothell"; StateProvinceName = "Washington"; PostalCode = "98011"; CountryRegionName = "United States"; Demographics = Some</strong></span>
<span class="strong"><strong class="calibre7">  "&lt;IndividualSurvey &gt;&lt;TotalPurchaseYTD&gt;-13.5&lt;/TotalPurchaseYTD&gt;&lt;DateFirstPurchase&gt;2003-02-06Z&lt;/DateFirstPurchase&gt;&lt;BirthDate&gt;1963-06-14Z&lt;/BirthDate&gt;&lt;MaritalStatus&gt;M&lt;/MaritalStatus&gt;&lt;YearlyIncome&gt;50001-75000&lt;/YearlyIncome&gt;&lt;Gender&gt;M&lt;/Gender&gt;&lt;TotalChildren&gt;4&lt;/TotalChildren&gt;&lt;NumberChildrenAtHome&gt;2&lt;/NumberChildrenAtHome&gt;&lt;Education&gt;Bachelors &lt;/Education&gt;&lt;Occupation&gt;Professional&lt;/Occupation&gt;&lt;HomeOwnerFlag&gt;1&lt;/HomeOwnerFlag&gt;&lt;NumberCarsOwned&gt;2&lt;/NumberCarsOwned&gt;&lt;CommuteDistance&gt;2-5 Miles&lt;/CommuteDistance&gt;&lt;/IndividualSurvey&gt;" };</strong></span>
<span class="strong"><strong class="calibre7">    { BusinessEntityID</strong></span>
</pre></div><p class="calibre6">Each record is a beast! It looks like the database has a field called <code class="literal">IndividualSurvey</code> that contains data <a id="id320" class="calibre1"/>about some of the customers that was collected on a survey. Interestingly, they decide to store it as XML. I think this proves the axiom that if given a datatype, developers will use it, whether it make sense or not. In any event, how are we going to parse this XML? I'll give you a hint: it rhymes with <span class="strong"><em class="calibre11">hype divider</em></span>. That's right, the XML type provider. Go back to the script and add this code:</p><div class="informalexample"><pre class="programlisting">[&lt;Literal&gt;]
let sampleXml = """&lt;IndividualSurvey &gt;&lt;TotalPurchaseYTD&gt;-13.5&lt;/TotalPurchaseYTD&gt;&lt;DateFirstPurchase&gt;2003-02-06Z&lt;/DateFirstPurchase&gt;&lt;BirthDate&gt;1963-06-14Z&lt;/BirthDate&gt;&lt;MaritalStatus&gt;M&lt;/MaritalStatus&gt;&lt;YearlyIncome&gt;50001-75000&lt;/YearlyIncome&gt;&lt;Gender&gt;M&lt;/Gender&gt;&lt;TotalChildren&gt;4&lt;/TotalChildren&gt;&lt;NumberChildrenAtHome&gt;2&lt;/NumberChildrenAtHome&gt;&lt;Education&gt;Bachelors &lt;/Education&gt;&lt;Occupation&gt;Professional&lt;/Occupation&gt;&lt;HomeOwnerFlag&gt;1&lt;/HomeOwnerFlag&gt;&lt;NumberCarsOwned&gt;2&lt;/NumberCarsOwned&gt;&lt;CommuteDistance&gt;2-5 Miles&lt;/CommuteDistance&gt;&lt;/IndividualSurvey&gt;"""
#r "System.Xml.Linq.dll"
type IndividualSurvey = XmlProvider&lt;sampleXml&gt;

let getIndividualSurvey (demographic:Option&lt;string&gt;) =
    match demographic.IsSome with
    | true -&gt; Some (IndividualSurvey.Parse(demographic.Value))
    | false -&gt; None</pre></div><p class="calibre6">Sending this to the REPL gives us the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">type IndividualSurvey = XmlProvider&lt;...&gt;</strong></span>
<span class="strong"><strong class="calibre7">val getIndividualSurvey :</strong></span>
<span class="strong"><strong class="calibre7">  demographic:Option&lt;string&gt; -&gt; XmlProvider&lt;...&gt;.IndividualSurvey option</strong></span>
</pre></div><p class="calibre6">The XML type provider takes a representative sample to generate the types. In this case, <code class="literal">sampleXML</code> is being used to generate the types. With this type provider handling the heavy lifting of parsing the<a id="id321" class="calibre1"/> XML for us, we can now create a data structure for each <code class="literal">CustomerId</code> and their demographic information in an easy-to-use format.</p><p class="calibre6">Go back to the script and enter this:</p><div class="informalexample"><pre class="programlisting">let customerDemos = customers |&gt; Array.map(fun c -&gt; c.BusinessEntityID,getIndividualSurvey(c.Demographics))
                              |&gt; Array.filter(fun (id,s) -&gt; s.IsSome)
                              |&gt; Array.map(fun (id,s) -&gt; id, s.Value)
                              |&gt; Array.distinctBy(fun (id,s) -&gt; id)</pre></div><p class="calibre6">Sending this to the FSI gives us the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">&lt;/IndividualSurvey&gt;);</strong></span>
<span class="strong"><strong class="calibre7">    (2455,</strong></span>
<span class="strong"><strong class="calibre7">     &lt;IndividualSurvey &gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;TotalPurchaseYTD&gt;26.24&lt;/TotalPurchaseYTD&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;DateFirstPurchase&gt;2004-01-24Z&lt;/DateFirstPurchase&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;BirthDate&gt;1953-04-10Z&lt;/BirthDate&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;MaritalStatus&gt;M&lt;/MaritalStatus&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;YearlyIncome&gt;25001-50000&lt;/YearlyIncome&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Gender&gt;F&lt;/Gender&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;TotalChildren&gt;2&lt;/TotalChildren&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;NumberChildrenAtHome&gt;0&lt;/NumberChildrenAtHome&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Education&gt;Bachelors &lt;/Education&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Occupation&gt;Management&lt;/Occupation&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;HomeOwnerFlag&gt;1&lt;/HomeOwnerFlag&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;NumberCarsOwned&gt;1&lt;/NumberCarsOwned&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;CommuteDistance&gt;5-10 Miles&lt;/CommuteDistance&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;/IndividualSurvey&gt;);</strong></span>
<span class="strong"><strong class="calibre7">    ...|]</strong></span>
</pre></div><p class="calibre6">There is not much new code here. Since we have to take into account customers that do not have demographic information recorded, we are using <code class="literal">Option</code> types. If there is demographic information, a <code class="literal">Some</code> is returned with the values. If not, a <code class="literal">None</code> is returned. We then filter that to only give us the customers with demographic records and distinct is called to make sure that we have only one record per customer.</p><p class="calibre6">With the customer demographic ready, we can now build a final data frame that contains all of the information we need. Go back to the script file and enter this:</p><div class="informalexample"><pre class="programlisting">let getDemoForCustomer customerId =
    let exists = Array.exists(fun (id,d) -&gt; id = customerId) customerDemos
    match exists with
    | true -&gt; Some (customerDemos 
                    |&gt; Array.find(fun (id,d) -&gt; id = customerId)
                    |&gt; snd)
    | false -&gt; None 

let orderCustomerDemo = 
    orderCustomers 
    |&gt; Array.map(fun oc -&gt; oc, getDemoForCustomer(snd oc))
                               |&gt; Array.map(fun (oc,d) -&gt; fst oc, snd oc, d)
                               |&gt; Array.filter(fun (oid,cid,d) -&gt; d.IsSome)
                               |&gt; Array.map(fun (oid,cid,d) -&gt; oid,cid,d.Value) </pre></div><p class="calibre6">Sending this to the<a id="id322" class="calibre1"/> FSI, you can see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">&lt;/IndividualSurvey&gt;);</strong></span>
<span class="strong"><strong class="calibre7">    (50949, 19070,</strong></span>
<span class="strong"><strong class="calibre7">     &lt;IndividualSurvey &gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;TotalPurchaseYTD&gt;27.7&lt;/TotalPurchaseYTD&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;DateFirstPurchase&gt;2003-08-20Z&lt;/DateFirstPurchase&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;BirthDate&gt;1966-07-08Z&lt;/BirthDate&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;MaritalStatus&gt;S&lt;/MaritalStatus&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;YearlyIncome&gt;greater than 100000&lt;/YearlyIncome&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Gender&gt;F&lt;/Gender&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;TotalChildren&gt;2&lt;/TotalChildren&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;NumberChildrenAtHome&gt;2&lt;/NumberChildrenAtHome&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Education&gt;Bachelors &lt;/Education&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Occupation&gt;Management&lt;/Occupation&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;HomeOwnerFlag&gt;0&lt;/HomeOwnerFlag&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;NumberCarsOwned&gt;4&lt;/NumberCarsOwned&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;CommuteDistance&gt;0-1 Miles&lt;/CommuteDistance&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;/IndividualSurvey&gt;);</strong></span>
<span class="strong"><strong class="calibre7">    ...|]</strong></span>
</pre></div><p class="calibre6">We now have a tuple with three elements: <code class="literal">OrderId</code>, <code class="literal">CustomerId</code>, and the demographic information. Note that the output still shows the demographic information as XML though we will be able to see in a second that indeed, those elements are part of the demographic type.</p><p class="calibre6">Go into the script file and enter this:</p><div class="informalexample"><pre class="programlisting">let getMultiOrderIndForOrderId orderId =
    orderDetailCounts 
    |&gt; Array.find(fun (oid,c) -&gt; oid = orderId)
    |&gt; snd &gt; 1

let orders = 
    orderCustomerDemo 
    |&gt; Array.map(fun (oid,cid,d) -&gt; oid, getMultiOrderIndForOrderId(oid), d)</pre></div><p class="calibre6">Sending this to the<a id="id323" class="calibre1"/> REPL gives us the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">    (50949, false,</strong></span>
<span class="strong"><strong class="calibre7">     &lt;IndividualSurvey &gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;TotalPurchaseYTD&gt;27.7&lt;/TotalPurchaseYTD&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;DateFirstPurchase&gt;2003-08-20Z&lt;/DateFirstPurchase&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;BirthDate&gt;1966-07-08Z&lt;/BirthDate&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;MaritalStatus&gt;S&lt;/MaritalStatus&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;YearlyIncome&gt;greater than 100000&lt;/YearlyIncome&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Gender&gt;F&lt;/Gender&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;TotalChildren&gt;2&lt;/TotalChildren&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;NumberChildrenAtHome&gt;2&lt;/NumberChildrenAtHome&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Education&gt;Bachelors &lt;/Education&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;Occupation&gt;Management&lt;/Occupation&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;HomeOwnerFlag&gt;0&lt;/HomeOwnerFlag&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;NumberCarsOwned&gt;4&lt;/NumberCarsOwned&gt;</strong></span>
<span class="strong"><strong class="calibre7">  &lt;CommuteDistance&gt;0-1 Miles&lt;/CommuteDistance&gt;</strong></span>
<span class="strong"><strong class="calibre7">&lt;/IndividualSurvey&gt;);</strong></span>
<span class="strong"><strong class="calibre7">    ...|]</strong></span>
</pre></div><p class="calibre6"><code class="literal">getMultiOrderIndForOrderId</code> is a function that takes in the <code class="literal">orderId</code> and finds the record in the <code class="literal">orderDetailsCounts</code> frame. If there is more than one, it returns <code class="literal">true</code>. If there is only one order (just the bike), it returns <code class="literal">false</code>.</p><p class="calibre6">With that function, we can create a tuple that has <code class="literal">orderId</code>, <code class="literal">multiOrderind</code>, and the demographics. I think we are ready to start doing some modeling! Before we start, we need to ask ourselves one question: what values do we want to use? The <span class="strong"><em class="calibre11">y</em></span> variable is clear—the <code class="literal">multiOrderInd</code>. But which one of the demographic values do we want to plug into our model as <span class="strong"><em class="calibre11">x</em></span> variables? Since we want to change our website to account for the model results, we probably need variables that are usable on the site. Some features like <code class="literal">BirthDate</code> are available if the person logs into our site via their Facebook or Google accounts, those accounts have that information accurately populated and the user agrees to let our site access that information. Those are big <span class="strong"><em class="calibre11">ifs</em></span>. Alternatively, we might be able to use the inferred analytics via the cookies that advertisers place on the user's device, but that is also an imprecise measure, depending on the feature used. It is better to design our model assuming that any information that will be input to the model will be accurately self-reported, and let's give the user an incentive to accurately self-report. This means education, yearly<a id="id324" class="calibre1"/> income, and other sensitive measures are out. Let's look at the gender and marital status, which we should be able to get from the user, if asked correctly. So our model will be <span class="strong"><em class="calibre11">MultiOrder =  Gender + MartialStatus + E</em></span>.</p><p class="calibre6">Go to the script and enter this:</p><div class="informalexample"><pre class="programlisting">let getValuesForMartialStatus martialStatus =
    match martialStatus with
    | "S" -&gt; 0.0
    | _ -&gt; 1.0

let getValuesForGender gender =
    match gender with
    | "M" -&gt; 0.0
    | _ -&gt; 1.0

let getValuesForMultiPurchaseInd multiPurchaseInd =
    match multiPurchaseInd with
    | true -&gt; 1
    | false -&gt; 0</pre></div><p class="calibre6">Sending this to the REPL, we see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val getValuesForMartialStatus : martialStatus:string -&gt; float</strong></span>
<span class="strong"><strong class="calibre7">val getValuesForGender : gender:string -&gt; float</strong></span>
<span class="strong"><strong class="calibre7">val getValuesForMultiPurchaseInd : multiPurchaseInd:bool -&gt; int</strong></span>
</pre></div><p class="calibre6">Since Accord deals with input <code class="literal">float</code> values and output <code class="literal">int</code> values, we need a function to convert the features of our attributes (current as strings) to those types. If you want to make sure we have all of the cases covered, you can also send this to the FSI:</p><div class="informalexample"><pre class="programlisting">orders |&gt; Array.distinctBy(fun (oid,ind,d) -&gt; d.Gender)
       |&gt; Array.map(fun (oid,ind,d) -&gt; d.Gender)
//val it : string [] = [|"M"; "F"|]

orders |&gt; Array.distinctBy(fun (oid,ind,d) -&gt; d.MaritalStatus)
       |&gt; Array.map(fun (oid,ind,d) -&gt; d.MaritalStatus)
//val it : string [] = [|"M"; "S"|]</pre></div><p class="calibre6">There is one danger with how the <code class="literal">getValues</code> function is written. If you remember from the previous chapter, dealing with missing values is an ongoing concern when doing any kind of modeling. The<a id="id325" class="calibre1"/> functions deal with the null issue by running away from it. Consider the <code class="literal">getValuesForGender</code> function:</p><div class="informalexample"><pre class="programlisting">let getValuesForGender gender =
    match gender with
    | "M" -&gt; 0.0
    | _ -&gt; 1.0</pre></div><p class="calibre6">If a gender code comes in as <code class="literal">UNK</code>, <code class="literal">YOMAMA</code>, null, or any other string, it gets assigned the female code. This means we would be over reporting the number of females in our model. We can get away with that with this dataset because every record had values <code class="literal">M</code> or <code class="literal">F</code>, but if they did not, we would need a way to handle the incorrect values. In this case, I would create some code like this:</p><div class="informalexample"><pre class="programlisting">let mutable lastGender = "M"
let getValuesForGender gender =
    match gender, lastGender with
    | "M",_ -&gt; 0.0
    | "F",_ -&gt; 1.0
    | _,"M" -&gt; lastGender = "F"
               1.0
    | _,_ -&gt; lastGender = "M"
             0.0</pre></div><p class="calibre6">This would balance the inferred values equally across males and females. In any event, let's get to modeling.</p></div></div>

<div class="book" title="AdventureWorks">
<div class="book" title="k-NN and AdventureWorks data"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec55" class="calibre1"/>k-NN and AdventureWorks data</h2></div></div></div><p class="calibre6">Go <a id="id326" class="calibre1"/>back to the script and enter this:</p><div class="informalexample"><pre class="programlisting">let inputs = orders |&gt; Array.map(fun (oid,ind,d) -&gt; [|getValuesForMartialStatus(d.MaritalStatus);getValuesForGender(d.Gender)|])
let outputs = orders |&gt; Array.map(fun (oid,ind,d) -&gt; getValuesForMultiPurchaseInd(ind))

let classes = 2
let k = 3
let knn = new KNearestNeighbors(k, classes, inputs, outputs)</pre></div><p class="calibre6">Sending this to<a id="id327" class="calibre1"/> the REPL gives us the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">    ...|]</strong></span>
<span class="strong"><strong class="calibre7">val classes : int = 2</strong></span>
<span class="strong"><strong class="calibre7">val k : int = 3</strong></span>
<span class="strong"><strong class="calibre7">val knn : KNearestNeighbors</strong></span>
</pre></div><p class="calibre6">Now that we have our model set up, let's pass in the four possible scenarios. Go to the script and enter this:</p><div class="informalexample"><pre class="programlisting">knn.Compute([|0.0;0.0|])
knn.Compute([|1.0;0.0|])
knn.Compute([|0.0;1.0|])
knn.Compute([|1.0;1.0|])</pre></div><p class="calibre6">Sending this to the FSI give us the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val it : int = 1</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val it : int = 1</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val it : int = 0</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val it : int = 1</strong></span>
</pre></div><p class="calibre6">So it looks like single <a id="id328" class="calibre1"/>women are NOT buying multiple<a id="id329" class="calibre1"/> items.</p></div></div>

<div class="book" title="AdventureWorks">
<div class="book" title="Naïve Bayes and AdventureWorks data"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch06lvl2sec56" class="calibre1"/>Naïve Bayes and AdventureWorks data</h2></div></div></div><p class="calibre6">Go back to the script and <a id="id330" class="calibre1"/>enter this:</p><div class="informalexample"><pre class="programlisting">let inputs' = orders |&gt; Array.map(fun (oid,ind,d) -&gt; [|int(getValuesForMartialStatus(d.MaritalStatus)); 
                                                       int(getValuesForGender(d.Gender));|])
let outputs' = orders |&gt; Array.map(fun (oid,ind,d) -&gt; getValuesForMultiPurchaseInd(ind))

let symbols = [|2;2|]

let bayes = new Accord.MachineLearning.Bayes.NaiveBayes(2,symbols)
let error = bayes.Estimate(inputs', outputs')</pre></div><p class="calibre6">Sending that to the FSI gives us the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">    ...|]</strong></span>
<span class="strong"><strong class="calibre7">val symbols : int [] = [|2; 2|]</strong></span>
<span class="strong"><strong class="calibre7">val bayes : NaiveBayes</strong></span>
<span class="strong"><strong class="calibre7">val error : float = 0.148738812</strong></span>
</pre></div><p class="calibre6">So we have a Naïve Bayes with a 15 percent error. Not great, but let's press on. Enter in the same four options for <code class="literal">gender</code>/<code class="literal">martialStatus</code> in the script file:</p><div class="informalexample"><pre class="programlisting">bayes.Compute([|0;0|])
bayes.Compute([|1;0|])
bayes.Compute([|0;1|])
bayes.Compute([|1;1|])</pre></div><p class="calibre6">When you send it to the REPL, you will get the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val it : int = 1</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val it : int = 1</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val it : int = 1</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val it : int = 1</strong></span>
<span class="strong"><strong class="calibre7">&gt;</strong></span>
</pre></div><p class="calibre6">Rut Row Raggy. Looks like we have a problem. In fact, we do. If you remember the previous description<a id="id331" class="calibre1"/> of using the Naïve Bayes model, it needs to have the values distributed along a bell curve to be effective. 90 percent of the bike purchases have a cross-sale—which means we are heavily skewed. No matter what kind of tweaks you do to the model, you can't get around the fact that you are multiplying by 0.9 to Yes for <code class="literal">multiPurchase</code>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Making use of our discoveries" id="190861-a18db0be6c20485ba81f22e43ca13055"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec36" class="calibre1"/>Making use of our discoveries</h1></div></div></div><p class="calibre6">What should we do? We have a k-NN telling us that single women are not buying additional items and we have Naïve Bayes being no help at all. We could do some more classification models, but let's assume we feel good enough about our analysis and want to go to production with this model. How should we do that? A key issue to consider is that the model is based on some static data in one of our database tables that is not updated via the <a id="id332" class="calibre1"/>normal transactions of the company. This means we really don't need to retrain the model frequently. Another problem we have is that we need to figure out the gender and marital status of the people ordering our bikes. Perhaps we are asking the wrong question. Instead of asking how to get the gender and marital status of the user, what if we already knew it? You may be thinking that we don't know because we haven't asked yet. But we might—based on the bike selected for purchase!</p></div>

<div class="book" title="Making use of our discoveries" id="190861-a18db0be6c20485ba81f22e43ca13055">
<div class="book" title="Getting the data ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec57" class="calibre1"/>Getting the data ready</h2></div></div></div><p class="calibre6">Go back<a id="id333" class="calibre1"/> into the script and enter this code block:</p><div class="informalexample"><pre class="programlisting">let customerProduct = 
    query { for soh in context.``Sales.SalesOrderHeaders`` do
            join sod in context.``Sales.SalesOrderDetails`` on (soh.SalesOrderID = sod.SalesOrderID)
            join p in context.``Production.Products`` on (sod.ProductID = p.ProductID)
            join c in context.``Sales.Customers`` on (soh.CustomerID = c.CustomerID)
            where (sod.SalesOrderID |=| salesOrderIds)
            select(c.CustomerID, sod.ProductID)} 
    |&gt; Seq.toArray</pre></div><p class="calibre6">Sending this to the REPL, we see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val customerProduct : (int * int) [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|(27575, 780); (13553, 779); (21509, 759); (15969, 769); (15972, 760);</strong></span>
<span class="strong"><strong class="calibre7">    (14457, 798); (27488, 763); (27489, 761); (27490, 770); (17964, 793);</strong></span>
<span class="strong"><strong class="calibre7">    (17900,</strong></span>
</pre></div><p class="calibre6">Hopefully, this code should look pretty boring to you by now. It is creating a tuple of <code class="literal">customerId</code> and <code class="literal">ProductId</code> from all of the bike sales.</p><p class="calibre6">Go back to<a id="id334" class="calibre1"/> the script and enter this:</p><div class="informalexample"><pre class="programlisting">let getProductId customerId =
    customerProduct |&gt; Array.find(fun (cid,pid) -&gt; cid = customerId)
                    |&gt; snd

let getSingleFemaleInd (martialStatus:string, gender:string) =
    match martialStatus, gender with
    | "S", "F" -&gt; 1
    | _, _ -&gt; 0

let customerDemo = orderCustomerDemo |&gt; Array.map(fun (oid,cid,d) -&gt; cid, getSingleFemaleInd(d.MaritalStatus, d.Gender))
                                     |&gt; Array.map(fun (cid,sfInd) -&gt; cid, getProductId(cid),sfInd)</pre></div><p class="calibre6">Sending this to the REPL, we can see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val getProductId : customerId:int -&gt; int</strong></span>
<span class="strong"><strong class="calibre7">val getSingleFemaleInd : martialStatus:string * gender:string -&gt; int</strong></span>
<span class="strong"><strong class="calibre7">val customerDemo : (int * int * int) [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|(13553, 779, 0); (15969, 769, 0); (15972, 760, 0); (14457, 798, 0);</strong></span>
<span class="strong"><strong class="calibre7">    (17964, 793, 0);</strong></span>
</pre></div><p class="calibre6">This code block is shaping our data for Accord by creating a frame of tuples of <code class="literal">customerId</code>, <code class="literal">productId</code>, and <code class="literal">singleFemaleInd</code>. We are almost ready to throw this data at a model, but we still need to determine which model we want to use. We are trying to determine the probability of a customer being a single female based on the bike purchased. This seems like a question that is well-suited for a logistic regression (<a class="calibre1" title="Chapter 3. More AdventureWorks Regression" href="part0029_split_000.html#RL0A2-a18db0be6c20485ba81f22e43ca13055">Chapter 3</a>, <span class="strong"><em class="calibre11">More AdventureWorks Regression</em></span>). The issue is that each bike needs to become a feature in this regression:</p><p class="calibre6"><span class="strong"><em class="calibre11">singleFemale = BikeId0 + BikeId1 + BikeId2 + BikeIdN + E</em></span></p><p class="calibre6">If you throw this code into your script and send it to the FSI, you will see we have 80 different bike IDs:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">let numberOfBikeIds = customerDemo |&gt; Array.map (fun (cid,pid,sfInd) -&gt; pid)</strong></span>
<span class="strong"><strong class="calibre7">                                   |&gt; Array.distinct</strong></span>
<span class="strong"><strong class="calibre7">                                   |&gt; Array.length</strong></span>
<span class="strong"><strong class="calibre7">val numberOfBikeIds : int = 80</strong></span>
</pre></div><p class="calibre6">So how do we create an input of 80 features from the original frame? Certainly not by hand. Let's see<a id="id335" class="calibre1"/> if Accord can help us.</p></div></div>

<div class="book" title="Making use of our discoveries" id="190861-a18db0be6c20485ba81f22e43ca13055">
<div class="book" title="Expanding features"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec58" class="calibre1"/>Expanding features</h2></div></div></div><p class="calibre6">Open up the script <a id="id336" class="calibre1"/>you were using from the previous section and enter this:</p><div class="informalexample"><pre class="programlisting">let inputs'' = customerDemo |&gt; Array.map(fun (cid,pid,sfInd) -&gt; pid)
let outputs'' = customerDemo |&gt; Array.map(fun (cid,pid,sfInd) -&gt; (float)sfInd)

let expandedInputs = Tools.Expand(inputs'')</pre></div><p class="calibre6">Sending this to the REPL, we see the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val expandedInputs : float [] [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|[|0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;</strong></span>
<span class="strong"><strong class="calibre7">      0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;</strong></span>
<span class="strong"><strong class="calibre7">      0.0; 0.0</strong></span>
</pre></div><p class="calibre6">What we are doing is taking the <code class="literal">customerDemo</code> frame and selecting the <code class="literal">productId</code>. We are then sending that array to Accord's <code class="literal">Tools.Expand</code> method that explodes the array so that each value becomes its own feature. Graphically, it looks like this:</p><div class="mediaobject"><img src="../images/00084.jpeg" alt="Expanding features" class="calibre8"/></div><p class="calibre9"> </p><p class="calibre6">As you can guess after reading <a class="calibre1" title="Chapter 5. Time Out – Obtaining Data" href="part0036_split_000.html#12AK81-a18db0be6c20485ba81f22e43ca13055">Chapter 5</a>, <span class="strong"><em class="calibre11">Time Out – Obtaining Data</em></span>, this is considered a sparse data<a id="id337" class="calibre1"/> frame. With the input and output ready, go back to the script file and enter this:</p><div class="informalexample"><pre class="programlisting">let analysis = new LogisticRegressionAnalysis(expandedInputs, outputs'')
analysis.Compute() |&gt; ignore
let pValue = analysis.ChiSquare.PValue
let coefficients = analysis.CoefficientValues
let coefficients' = coefficients |&gt; Array.mapi(fun i c -&gt; i,c)
                                 |&gt; Array.filter(fun (i,c) -&gt; c &gt; 5.0)</pre></div><p class="calibre6">Before you send this to the REPL, let me warn you. The reason we identify a sparse frame is that computing a regression on 80 features takes a while. So hit <span class="strong"><em class="calibre11">ALT</em></span> + <span class="strong"><em class="calibre11">ENTER</em></span> and go get a cup of coffee. From Starbucks. Across town. Eventually, you will get this back:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">val analysis : Analysis.LogisticRegressionAnalysis</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val it : unit = ()</strong></span>
<span class="strong"><strong class="calibre7">&gt; </strong></span>
<span class="strong"><strong class="calibre7">val pValue : float = 1.0</strong></span>
<span class="strong"><strong class="calibre7">val coefficients : float [] =</strong></span>
<span class="strong"><strong class="calibre7">  [|-3.625805913; 1.845275228e-10; 7.336791927e-11; 1.184805489e-10;</strong></span>
<span class="strong"><strong class="calibre7">    -8.762459325e-11; -2.16833771e-10; -7.952785344e-12; 1.992174635e-10;</strong></span>
<span class="strong"><strong class="calibre7">    2.562929393e-11; -2.957572867e-11; 2.060678611e-10; -2.103176298e-11;</strong></span>
<span class="strong"><strong class="calibre7">    -2.3</strong></span>
</pre></div><p class="calibre6">And when we filter at the coefficient table, we can see that there is one bike model that is favored by single women. Add this to your script file and send to the FSI:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">let coefficients' = coefficients |&gt; Array.mapi(fun i c -&gt; i,c)</strong></span>
<span class="strong"><strong class="calibre7">                                 |&gt; Array.filter(fun (i,c) -&gt; c &gt; 5.0)</strong></span>

<span class="strong"><strong class="calibre7">val coefficients' : (int * float) [] = [|(765, 15.85774698)|]</strong></span>

<span class="strong"><strong class="calibre7">&gt;</strong></span>
</pre></div><p class="calibre6">So perhaps when<a id="id338" class="calibre1"/> a person purchases item number <code class="literal">765</code>, we try to give them an incentive to buy other products, either via a coupon or a really slick website experience. This is where an excellent UX person with a knowledgeable marketing person can pay dividends. Since I am neither, I will leave that exercise to the reader.</p></div></div>
<div class="book" title="Summary" id="19UOO1-a18db0be6c20485ba81f22e43ca13055"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec37" class="calibre1"/>Summary</h1></div></div></div><p class="calibre6">In this chapter, we took a look at two common machine learning classifiers: k-Nearest Neighbors and Naïve Bayes. We saw them both in action with our AdventureWorks dataset to see if we can increase cross sales. We saw that k-NN had some limited success and Naïve Bayes was not useful. We then used our old friend logistic regression to help us narrow down a specific bike model that can be used to promote cross sales. Finally, we considered that since the data is ad hoc, we can't implement any real-time training on our website. We would want to periodically run this analysis to see if our original findings continued to hold.</p><p class="calibre6">In the next chapter, we are going to take off our software engineer hat and put on our data scientist hat to see if we can do anything with that traffic stop data. We are going to look at augmenting the original dataset with another dataset and then using a couple of clustering models: k-means and PCA. See you on the next page!</p></div></body></html>
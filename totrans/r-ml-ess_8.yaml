- en: Chapter 8. Machine Learning Examples Applicable to Businesses
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第8章：适用于商业的机器学习示例
- en: The purpose of this chapter is to show you how machine learning helps in solving
    a business problem. Most of the techniques have already been explored in the previous
    chapter, so the pace of this chapter is fast. The techniques are about unsupervised
    and supervised learning. Unsupervised algorithms extract hidden structures from
    data and supervised techniques forecast an attribute. This chapter solves a business
    challenge using techniques belonging to the two branches.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的目的是向您展示机器学习如何帮助解决商业问题。大多数技术已在上一章中探讨过，因此本章的节奏很快。技术涉及无监督学习和监督学习。无监督算法从数据中提取隐藏结构，监督技术预测属性。本章使用两个分支的技术解决商业挑战。
- en: 'In this chapter, you will learn how to:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将学习如何：
- en: Apply the machine learning approach to a business problem
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将机器学习方法应用于商业问题
- en: Segment the customer base of a bank
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对银行的客户群进行细分
- en: Identify the target of a marketing campaign
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别营销活动的目标
- en: Choose the technique performing better
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择表现更好的技术
- en: Overview of the problem
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题概述
- en: A Portuguese banking institution launches a phone call marketing campaign. The
    institution has limited resources, so it needs to choose the target clients. Starting
    from the data about a past campaign, we can give some support to the company using
    machine learning techniques. The data shows personal details of the clients and
    information about previous marketing campaigns. The target of machine learning
    algorithms is to identify the clients that are more likely to subscribe. Starting
    from the data, the algorithms need to understand how to use new clients' data
    to predict how likely each of them will subscribe.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 一家葡萄牙银行机构发起了一项电话营销活动。该机构资源有限，因此需要选择目标客户。从过去活动的数据开始，我们可以使用机器学习技术为公司提供一些支持。数据显示了客户的个人细节以及以前营销活动的信息。机器学习算法的目标是识别更有可能订阅的客户。从数据开始，算法需要理解如何使用新客户的数据来预测每个客户订阅的可能性。
- en: Data overview
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据概述
- en: The data consists of approximately more than 2,500 clients affected by a marketing
    campaign consisting of one or more phone calls. We have some details about the
    clients and we know who subscribed.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 数据包括大约超过2,500名受营销活动影响的客户，该活动包括一个或多个电话呼叫。我们有一些关于客户的信息，并且我们知道谁已经订阅。
- en: 'Each row of the table corresponds to a client and there is a column displaying
    the output that is `yes` if the client subscribed and `no` otherwise. The other
    columns are features describing the clients and they are:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 表格的每一行对应一个客户，其中有一列显示输出，如果客户已订阅则显示`yes`，否则显示`no`。其他列是描述客户的特征，它们是：
- en: '**Personal details**: This incudes details such as age, job, marital status,
    education, credit default, average yearly balance, housing, and personal loan'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**个人详情**：这包括诸如年龄、工作、婚姻状况、教育、信用违约、平均年度余额、住房和个人贷款等详细信息。'
- en: '**Communication with the company**: This incudes details such as contact type,
    last contact month and weekday, last call duration, and number of contacts'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**与公司的沟通**：这包括诸如联系方式、最后联系月份和星期几、最后通话时长和联系次数等详细信息。'
- en: '**Previous campaigns**: This incudes details such as number of days before
    the previous campaign, number of past contacts, and past outcomes'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**以前的营销活动**：这包括诸如上次营销活动前的天数、过去联系次数和过去结果等详细信息。'
- en: This is a sample of the table. The `y` column displays the attribute to predict
    `yes` if the client subscribed and `no` otherwise.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这是表格的一个示例。`y`列显示预测属性，如果客户已订阅则显示`yes`，否则显示`no`。
- en: '| Age | Job | Marital status | ... | Contact | … | y |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| 年龄 | 工作 | 婚姻状况 | ... | 联系方式 | … | y |'
- en: '| --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | --- |'
- en: '| 30 | services | married |   | cellular |   | no |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| 30 | services | married |   | cellular |   | no |'
- en: '| 33 | management | single |   | telephone |   | yes |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| 33 | management | single |   | telephone |   | yes |'
- en: '| 41 | blue-collar | single |   | unknown |   | no |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| 41 | blue-collar | single |   | unknown |   | no |'
- en: '| 35 | self-employed | married |   | telephone |   | no |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| 35 | self-employed | married |   | telephone |   | no |'
- en: 'The data is stored in `bank.csv` and we can load them into R building a data
    table. The `sep='';''` field specifies that the fields in the file are separated
    by a semicolon, as follows:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 数据存储在`bank.csv`文件中，我们可以通过在R中构建数据表来加载它们。`sep=';'`字段指定文件中的字段由分号分隔，如下所示：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The `duration` feature displays the number of seconds in the final call. The
    target of our analysis is to define which clients to call and we cannot know the
    duration before contacting the client. In addition, after knowing a call duration,
    we already know whether the client has subscribed or not, so it is pointless to
    use this attribute to predict the outcome. For these reasons, we removed the `duration`
    feature, as follows:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '`duration`特征显示最终通话的秒数。我们分析的目标是定义哪些客户需要联系，我们在联系客户之前无法知道通话时长。此外，在知道通话时长后，我们已经知道客户是否订阅了，因此使用此属性来预测结果是没有意义的。因此，我们移除了`duration`特征，如下所示：'
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The next step is to explore the data in order to understand the context.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是探索数据以了解上下文。
- en: Exploring the output
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 探索输出
- en: In this subsection, we quickly explore and transform the data.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在本小节中，我们快速探索并转换数据。
- en: 'The `y` output is categoric and the possible outcomes are `yes` and `no` and
    our target is to visualize the proportions. For this purpose, we can build a pie
    chart using these steps:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '`y`输出是分类的，可能的输出结果为`yes`和`no`，我们的目标是可视化比例。为此，我们可以使用以下步骤构建饼图：'
- en: 'Count how many clients subscribed and how many didn''t using `table`:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`table`统计订阅和未订阅的客户数量：
- en: '[PRE2]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Determine the percentage of clients subscribing and not subscribing:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定订阅和未订阅客户的百分比：
- en: '[PRE3]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Build a function determining the percentages starting from the proportions:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从比例开始构建一个确定百分比的函数：
- en: '[PRE4]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Determine the percentages:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定百分比：
- en: '[PRE5]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Look at the help of `barplot` that is the R function building bar charts:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看R函数`barplot`的帮助，该函数用于构建条形图：
- en: '[PRE6]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Define the barplot input:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义条形图输入：
- en: '[PRE7]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Build the barplot:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建条形图：
- en: '[PRE8]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The plot obtained is as follows:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 获得的图表如下：
- en: '![Exploring the output](img/7740OS_08_01.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![探索输出](img/7740OS_08_01.jpg)'
- en: Only 12 percent of the clients subscribed, so the output values are not equally
    distributed. The next step is to explore all the data.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 只有12%的客户订阅了，因此输出值分布不均。下一步是探索所有数据。
- en: Exploring and transforming features
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 探索和转换特征
- en: 'Similar to the output, we can build some charts to explore the features. Let''s
    first take a look at them using `str`:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 与输出类似，我们可以构建一些图表来探索特征。让我们首先使用`str`查看它们：
- en: '[PRE9]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The features belong to two data types:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 特征属于两种数据类型：
- en: '**Categoric**: This data type stores features in the factor format'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分类**：这种数据类型以因子格式存储特征'
- en: '**Numeric**: This data type stores features in the integer format'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数值**：这种数据类型以整数格式存储特征'
- en: 'The charts for the categoric features are different from the numeric ones,
    so we need to split the features in two groups. We can define a vector containing
    the categoric features and another vector for the numeric features by using the
    following steps:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 对于分类特征和数值特征的图表是不同的，因此我们需要将特征分为两组。我们可以通过以下步骤定义一个包含分类特征的向量以及一个包含数值特征的向量：
- en: 'Define each column class using `lapply`:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`lapply`定义每一列的类：
- en: '[PRE10]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Remove the `y` column containing the output:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 移除包含输出的`y`列：
- en: '[PRE11]'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Determine the categoric features:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定分类特征：
- en: '[PRE12]'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Determine the numeric features:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定数值特征：
- en: '[PRE13]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Similar to the output, we can build a pie chart for each of the nine categoric
    features. In order to avoid having too many charts, we can put three pies in the
    same chart. The R function is `par` and it allows a grid of charts to be defined:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 与输出类似，我们可以为九个分类特征中的每一个构建饼图。为了避免图表过多，我们可以将三个饼图放在同一个图表中。R函数是`par`，它允许定义图表网格：
- en: '[PRE14]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The input that we need is:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要的输入是：
- en: '`mfcol`: This is a vector containing the number of columns and rows. For each
    feature, we build a chart with the pie and one with its legend. We put the pie
    charts on the bottom row and the legends on the top. Then, we have two rows and
    three columns.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mfcol`：这是一个包含列数和行数的向量。对于每个特征，我们构建一个饼图和一个包含其图例的图表。我们将饼图放在底部行，图例放在顶部。然后，我们有两行三列。'
- en: '`mar`: This is a vector defining the plot margins:'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mar`：这是一个定义图表边距的向量：'
- en: '[PRE15]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Now, we can build the histograms using a `for` loop:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以使用`for`循环构建直方图：
- en: '[PRE16]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Perform the following steps inside the `for` loop:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在`for`循环内执行以下步骤：
- en: 'Define the pie chart input:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义饼图输入：
- en: '[PRE17]'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Define a new plot with the legend consisting of the feature names matched with
    their color. We add the feature name as the legend title:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义一个新的图表，其图例由特征名称与其颜色匹配组成。我们将特征名称作为图例标题：
- en: '[PRE18]'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Build the histogram that will be displayed on the bottom row:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建将在底部行显示的直方图：
- en: '[PRE19]'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'We built three charts containing three categoric features each. Let''s take
    a look at the first one:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们构建了包含三个分类特征的三个图表。让我们看看第一个：
- en: '![Exploring and transforming features](img/7740OS_08_02.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![探索和转换特征](img/7740OS_08_02.jpg)'
- en: 'The `job` attribute has different levels and some of them have a significant
    number of clients. Then, we can define a dummy variable for each relevant job
    and ignore the others. In order to identify the most relevant jobs, we determine
    the percentage of people belonging to each level. Then, we set a threshold and
    ignore all levels whose percentage is below the threshold. In this case, the threshold
    is 0.08, that is, 8 percent. After defining the new dummy columns, we remove `job`:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '`job` 属性有不同的级别，其中一些级别拥有大量的客户。然后，我们可以为每个相关的职位定义一个虚拟变量，并忽略其他职位。为了确定最相关的职位，我们计算属于每个级别的百分比。然后，我们设置一个阈值，并忽略所有低于阈值的级别。在这种情况下，阈值是
    0.08，即 8%。在定义新的虚拟列之后，我们移除 `job`：'
- en: '[PRE20]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Here, `marital`, defining the marital status, has three levels out of which
    `divorced` and `single` have a smaller, although significant, slice. We can define
    two dummy variables defining the three levels:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`marital`，定义婚姻状况，有三个级别，其中 `divorced` 和 `single` 占有较小的，尽管是显著的，部分。我们可以定义两个虚拟变量来定义三个级别：
- en: '[PRE21]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'With regard to `education`, more than half of the clients received a secondary
    education, so we can assume that the 4 percent of `unknown` are `secondary`. Then,
    we have three attributes and we can define two dummy variables:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 `education`，超过一半的客户接受了中等教育，因此我们可以假设 `unknown` 的 4% 是 `secondary`。然后，我们有三个属性，我们可以定义两个虚拟变量：
- en: '[PRE22]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The plot obtained is as follows:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 得到的图如下：
- en: '![Exploring and transforming features](img/7740OS_08_03.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![探索和转换特征](img/7740OS_08_03.jpg)'
- en: 'The **default**, **housing**, and **loan** attributes have two different levels,
    so they can be converted into numerical form using `as.numeric`. In order to have
    `0` if the attribute was `no` and `1` if the attribute was `yes`, we subtract
    `1`, as follows:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**默认**、**住房**和**贷款**属性有两个不同的级别，因此可以使用 `as.numeric` 将它们转换为数值形式。为了在属性为 `no` 时得到
    `0`，在属性为 `yes` 时得到 `1`，我们减去 `1`，如下所示：'
- en: '[PRE23]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'The histogram obtained is as follows:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 得到的直方图如下：
- en: '![Exploring and transforming features](img/7740OS_08_04.jpg)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![探索和转换特征](img/7740OS_08_04.jpg)'
- en: 'Here, **contact** has three options out of which one is **unknown**. All the
    options have a significant slice, so we can define two dummy variables, as follows:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，**contact** 有三个选项，其中一个是 **unknown**。所有选项都有一个显著的份额，因此我们可以定义两个虚拟变量，如下所示：
- en: '[PRE24]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'We can convert `month` into a numeric variable in which January corresponds
    to `1` and December to `12`. The feature values are the month names abbreviated
    without a capital letter, for example, `jan` for `January`. In order to define
    the numeric feature, we define a vector whose first element is `jan`, second element
    is `feb`, and so on. Then, using `which`, we can identify the corresponding element
    of the vector. For instance, `apr` is the fourth element of the vector, so using
    `which` we obtain `4`. In order to build the vector with the ordered month names,
    we use `month.abb` containing the abbreviated month names and `tolower` to uncapitalize
    the first letter, as follows:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将 `month` 转换为一个数值变量，其中一月对应于 `1`，十二月对应于 `12`。特征值是月份名称的缩写，不带大写字母，例如，`jan`
    对应于 `January`。为了定义数值特征，我们定义一个向量，其第一个元素是 `jan`，第二个元素是 `feb`，依此类推。然后，使用 `which`，我们可以识别向量中的对应元素。例如，`apr`
    是向量的第四个元素，因此使用 `which` 我们得到 `4`。为了构建有序月份名称的向量，我们使用包含缩写月份名称的 `month.abb` 和 `tolower`
    来取消首字母大写，如下所示：
- en: '[PRE25]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'In `poutcome`, `success` and `failure` have a small portion of the clients.
    However, they are very relevant, so we define two dummy variables:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `poutcome` 中，`success` 和 `failure` 占有少量客户。然而，它们非常相关，因此我们定义了两个虚拟变量：
- en: '[PRE26]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: We converted all the categoric features into the numeric format. The next step
    is to explore the numeric features and transform them if necessary.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将所有分类特征转换为数值格式。下一步是探索数值特征并在必要时进行转换。
- en: 'There are six numeric features and we can build a plot about each of them.
    The chart is a histogram showing how the values of the feature are distributed.
    In order to visualize all the figures in the same charts, we can put them in a
    3 x 2 grid using `par`. The arguments are as follows:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 有六个数值特征，我们可以为每个特征构建一个图表。图表是一个直方图，显示特征值的分布。为了在同一图表中可视化所有图形，我们可以使用 `par` 将它们放在一个
    3 x 2 的网格中。参数如下：
- en: '`mfrow`: Similar to `mfcol`, it defines a grid of figures. The difference is
    just the order in which we add the figures to the grid.'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mfrow`：与`mfcol`类似，它定义了一个图形网格。区别只是我们将图形添加到网格的顺序。'
- en: '`mar`: We set the margins to their default, that is, `c(5, 4, 4, 2) + 0.1`,
    as follows:'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mar`：我们将边距设置为默认值，即`c(5, 4, 4, 2) + 0.1`，如下所示：'
- en: '[PRE27]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'We can build the histograms using `hist`. The input is as follows:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`hist`构建直方图。输入如下：
- en: '`x`: This is the vector with the data'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`x`：这是包含数据的向量'
- en: '`main`: This is the plot title'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`main`：这是图表标题'
- en: '`xlab`: This is the label under the x-axis'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`xlab`：这是x轴下的标签'
- en: 'We can use `hist` directly inside the data table square brackets. In order
    to build all the charts in one step, we use a `for` loop:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以直接在数据表方括号内使用`hist`。为了一步构建所有图表，我们使用一个`for`循环：
- en: '[PRE28]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'The histogram obtained is as follows:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 获得的直方图如下：
- en: '![Exploring and transforming features](img/7740OS_08_05.jpg)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![探索和转换特征](img/7740OS_08_05.jpg)'
- en: Here, **age** and **day** are evenly distributed across their possible values,
    so they don't require any treatment. The remaining features are concentrated in
    the small values, so we need to transform them. The function that we use to define
    the transformed feature is the logarithm and it allows us to have more spreaded
    values. The logarithm works on features having values greater than 0, so we need
    to remove the negative values from the feature.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，**年龄**和**天数**在其可能值上是均匀分布的，因此它们不需要任何处理。其余特征集中在较小的值上，因此我们需要对它们进行转换。我们用来定义转换特征的函数是对数，它允许我们拥有更分散的值。对数适用于具有大于0值的特征，因此我们需要从特征中移除负值。
- en: In order to avoid zeros, add `1` to the feature before computing the logarithm.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免零值，在计算对数之前将特征加`1`。
- en: 'Accordingly with the data description, `pdays` is equal to `-1` if the institution
    has not contacted the client before. In order to identify the clients contacted
    for the first time, we can define a new dummy variable that is `1` if `pdays`
    is equal to `-1`. Then, we replace all the negative values with `0`, as follows:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 根据数据描述，如果机构之前没有联系过客户，则`pdays`等于`-1`。为了识别首次联系的客户，我们可以定义一个新的虚拟变量，如果`pdays`等于`-1`，则该变量为`1`。然后，我们将所有负值替换为`0`，如下所示：
- en: '[PRE29]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'The `balance` feature represents the past balance and we can define a dummy
    variable that is `1`, if the balance is negative. Then, we replace the negative
    balances with `0`:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '`balance`特征表示过去的余额，我们可以定义一个虚拟变量，如果余额为负，则该变量为`1`。然后，我们将负余额替换为`0`：'
- en: '[PRE30]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Now, we can compute the logarithm to all the features. Since the input of a
    logarithm must be positive and some features are equal to `0`, we add `1` to each
    feature before computing the logarithm:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以计算所有特征的对数。由于对数的输入必须是正数，而一些特征等于`0`，我们在计算对数之前将每个特征加`1`：
- en: '[PRE31]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'We have converted all the features into the numeric format. Now, we can take
    a look at the new features table:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经将所有特征转换为数值格式。现在，我们可以看一下新的特征表：
- en: '[PRE32]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'The only column that is not numeric or integer is the output `y`. We can convert
    it into the numeric format and change its name to output:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 唯一不是数值或整数的列是输出`y`。我们可以将其转换为数值格式，并将其名称更改为output：
- en: '[PRE33]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: We loaded and cleaned the data. Now we are ready to build the machine learning
    models.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已加载数据并进行了清理。现在我们准备构建机器学习模型。
- en: Clustering the clients
  id: totrans-123
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 聚类客户
- en: In order to address the next marketing campaign, we need to identify the clients
    that are more likely to subscribe. Since it's hard to evaluate the clients one
    by one, we can determine homogeneous groups of clients and identify the most promising
    groups.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 为了应对下一场营销活动，我们需要识别更有可能订阅的客户。由于难以逐个评估客户，我们可以确定同质客户群体，并识别最有希望的群体。
- en: Starting from the past data, we cluster the clients on the basis of their personal
    details. Then, given a new client, we identify the most similar group and associate
    the new client to it. We don't have information about the customer behavior of
    the new clients, so clustering is based on the personal attributes only.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 从历史数据开始，我们根据客户的个人详细信息对客户进行聚类。然后，给定一个新客户，我们识别最相似的群体并将新客户关联到该群体。我们没有新客户客户行为的信息，因此聚类仅基于个人属性。
- en: 'There are different techniques performing clustering and in this section we
    use a relevant algorithm that is hierarchical clustering. A parameter of hierarchical
    clustering is linkage, which is the way of computing the distance between two
    groups. The main options are:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 有不同的技术执行聚类，在本节中我们使用一个相关的算法，即层次聚类。层次聚类的参数之一是链接，它是计算两组之间距离的方式。主要选项包括：
- en: '**Single linkage**: This is the minimum distance between an object of the first
    group and an object of the second group'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**单链接**：这是第一组中的一个对象与第二组中的一个对象之间的最小距离'
- en: '**Complete linkage**: This is the maximum distance between an object of the
    first group and an object of the second group'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**完全链接**：这是第一组中的一个对象与第二组中的一个对象之间的最大距离'
- en: '**Average linkage**: This is the average distance between an object of the
    first group and an object of the second group'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平均链接**：这是第一组中的一个对象与第二组中的一个对象之间的平均距离'
- en: In our case, we choose the average linkage and this choice comes from testing
    the three options.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的案例中，我们选择了平均链接，这个选择来自于测试三个选项。
- en: 'We define `dtPers` containing the personal features only, as follows:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 我们定义`dtPers`只包含个人特征，如下所示：
- en: '[PRE34]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Now, we can apply hierarchical clustering and the steps are as follows:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以应用层次聚类，步骤如下：
- en: 'Define the dissimilarity matrix:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义距离矩阵：
- en: '[PRE35]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Build the hierarchical clustering model:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建层次聚类模型：
- en: '[PRE36]'
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Visualize the dendrogram. The `par` method defines the plot layout that in
    this case contains just one chart and `plot` contains an argument improving the
    appearance. The `labels` and `hang` features avoid having a messy chart in the
    bottom and the other arguments specify the plot title and the axis labels, as
    shown:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可视化树状图。`par`方法定义了绘图布局，在这种情况下，它只包含一个图表，而`plot`包含一个改进外观的参数。`labels`和`hang`功能避免了底部图表的杂乱，其他参数指定了图表标题和坐标轴标签，如下所示：
- en: '[PRE37]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The histogram obtained is as follows:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 得到的直方图如下：
- en: '![Clustering the clients](img/7740OS_08_06.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![聚类客户](img/7740OS_08_06.jpg)'
- en: 'We can identify three clusters cutting the dendrogram around the height of
    **40**. There is also another option that is cutting the dendrogram at a lower
    level (around 18), identifying seven clusters. We can explore both the options
    and visualize the two splits on the dendrogram using `rect.hclust`, as follows:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在树状图的高度**40**处切割树状图来识别三个集群。还有另一种选择，即在较低的水平（约18）切割树状图，识别七个集群。我们可以探索这两种选择，并使用`rect.hclust`在树状图上可视化这两个分割，如下所示：
- en: '[PRE38]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'The histogram obtained is as follows:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 得到的直方图如下：
- en: '![Clustering the clients](img/7740OS_08_07.jpg)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![聚类客户](img/7740OS_08_07.jpg)'
- en: 'In order to identify the most successful cluster, we can display the proportion
    of clients that subscribed using a pie chart putting as its title the number of
    clients in the cluster. Let''s see the chart for the three clusters of the first
    split. The steps to build the pie charts are similar to the steps we performed
    earlier:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确定最成功的集群，我们可以使用饼图显示订阅客户的比例，并在饼图的标题中放置集群中的客户数量。让我们看看第一次分割的三个集群的图表。构建饼图的步骤与我们之前执行的步骤类似：
- en: 'Define a data table containing the output attribute:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义包含输出属性的数据表：
- en: '[PRE39]'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Add two columns defining clusters to the data table. Each column corresponds
    to a different number of clusters:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在数据表中添加定义集群的两列。每一列对应不同的集群数量：
- en: '[PRE40]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Define the plot layout with one row and three columns. The `oma` argument defines
    the outer margins:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义一个包含一行三列的绘图布局。`oma`参数定义了外部边距：
- en: '[PRE41]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Using commands similar to the data exploration, build three histograms showing
    the percentage of clients subscribing or not to each cluster:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用与数据探索类似的命令，构建三个直方图，显示每个集群订阅或不订阅客户的百分比：
- en: '[PRE42]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Add the title of the charts:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加图表的标题：
- en: '[PRE43]'
  id: totrans-156
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'The histogram obtained is as follows:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 得到的直方图如下：
- en: '![Clustering the clients](img/7740OS_08_08.jpg)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![聚类客户](img/7740OS_08_08.jpg)'
- en: The first and second clusters contain the majority of clients and the campaign
    hasn't been particularly successful on them. The third cluster is smaller and
    a significantly higher percentage of its clients subscribed. Then, we can start
    the marketing campaign targeting new clients similar to the third cluster.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 第一和第二集群包含大多数客户，并且在这两个集群上的活动并没有特别成功。第三集群较小，其客户订阅的比例显著更高。然后，我们可以开始针对与第三集群类似的新客户的营销活动。
- en: 'Using the same R commands, we can visualize the same charts for the seven clusters
    identified by the second split, as follows:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 使用相同的R命令，我们可以可视化由第二次分割确定的七个簇的相同图表，如下所示：
- en: 'Define the plot layout with two rows and four columns:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义具有两行四列的绘图布局：
- en: '[PRE44]'
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Build the histograms:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建直方图：
- en: '[PRE45]'
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Add the title of the charts:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加图表标题：
- en: '[PRE46]'
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'The histogram obtained is as follows:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 获得的直方图如下：
- en: '![Clustering the clients](img/7740OS_08_09.jpg)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![聚类客户](img/7740OS_08_09.jpg)'
- en: The first three clusters contain most of the clients and the marketing campaign
    hasn't been particularly effective on them. The fourth and fifth cluster has a
    significantly higher percentage of clients subscribing. The last two clusters
    are very successful although they are very small. The marketing campaign will
    start addressing all the new clients similar to the last two clusters and it will
    target a part of the clients of clusters four and five.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 前三个簇包含大多数客户，营销活动对它们的成效并不特别显著。第四和第五簇的订阅客户百分比显著更高。最后两个簇虽然规模很小，但非常成功。营销活动将开始针对与最后两个簇相似的所有新客户，并将针对第四和第五簇的一部分客户。
- en: In conclusion, using clustering, we identified small groups of customers upon
    which the campaign has been very successful. However, most of the customers belong
    to a big cluster about which we don't have enough information. The reason is that
    the campaign is successful on a few customers with specific features.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 总之，使用聚类，我们识别出一些小客户群体，在这些群体上营销活动非常成功。然而，大多数客户属于一个大簇，我们对其了解不足。原因是营销活动在具有特定特征的少数客户上取得了成功。
- en: Predicting the output
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测输出
- en: 'The past marketing campaign targeted part of the customer base. Among other
    1,000 clients, how do we identify the 100 that are keener to subscribe? We can
    build a model that learns from the data and estimates which clients are more similar
    to the ones that subscribed in the previous campaign. For each client, the model
    estimates a score that is higher if the client is more likely to subscribe. There
    are different machine learning models determining the scores and we use two well-performing
    techniques, as follows:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 过去的营销活动针对了一部分客户群。在1000名客户中，我们如何识别出那些更愿意订阅的100名客户？我们可以构建一个从数据中学习并估计哪些客户与之前营销活动中订阅的客户更相似的模型。对于每个客户，模型估计一个分数，如果客户更有可能订阅，则分数更高。有不同机器学习模型确定分数，我们使用两种表现良好的技术，如下所示：
- en: '**Logistic regression**: This is a variation of the linear regression to predict
    a binary output'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**逻辑回归**：这是线性回归的一种变体，用于预测二元输出'
- en: '**Random forest**: This is an ensemble based on a decision tree that works
    well in presence of many features'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**随机森林**：这是一种基于决策树的集成方法，在存在许多特征的情况下表现良好'
- en: In the end, we need to choose one out of the two techniques. There are cross-validation
    methods that allow us to estimate model accuracy (see [Chapter 6](ch06.html "Chapter 6. Step
    3 – Validating the Results"), *Step 3 – Validating the Results*). Starting from
    that, we can measure the accuracy of both the options and pick the one performing
    better.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要从两种技术中选择一种。有一些交叉验证方法允许我们估计模型精度（见[第6章](ch06.html "第6章。步骤3 – 验证结果")，*步骤3
    – 验证结果*）。从那时起，我们可以测量两种选项的精度，并选择表现更好的一个。
- en: After choosing the most proper machine learning algorithm, we can optimize it
    using cross validation. However, in order to avoid overcomplicating the model
    building, we don't perform any feature selection or parameter optimization.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择最合适的机器学习算法后，我们可以使用交叉验证来优化它。然而，为了避免过度复杂化模型构建，我们不执行任何特征选择或参数优化。
- en: 'These are the steps to build and evaluate the models:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是构建和评估模型的步骤：
- en: 'Load the `randomForest` package containing the random forest algorithm:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载包含随机森林算法的 `randomForest` 包：
- en: '[PRE47]'
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Define the formula defining the output and the variable names. The formula
    is in the format `output ~ feature1 + feature2 + ...`:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义输出和变量名的公式。公式格式为 `output ~ feature1 + feature2 + ...`：
- en: '[PRE48]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Initialize the table containing all the testing sets:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 初始化包含所有测试集的表格：
- en: '[PRE49]'
  id: totrans-183
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Define the number of iterations:'
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义迭代次数：
- en: '[PRE50]'
  id: totrans-185
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Start a `for` loop:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 开始一个 `for` 循环：
- en: '[PRE51]'
  id: totrans-187
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Define the training and the test datasets:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义训练集和测试集：
- en: '[PRE52]'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Select a subset from the test set in such a way that we have the same number
    of `output == 0` and `output == 1`. First, we split `dtTest` in two parts (`dtTest0`
    and `dtTest1`) on the basis of the output and we count the number of rows of each
    part (`n0` and `n1`). Then, as `dtTest0` has more rows, we randomly select `n1`
    rows. In the end, we redefine `dtTest` binding `dtTest0` and `dtTest1`, as follows:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从测试集中选择一个子集，使得我们有相同数量的`output == 0`和`output == 1`。首先，根据输出将`dtTest`分成两部分（`dtTest0`和`dtTest1`），并计算每部分的行数（`n0`和`n1`）。然后，由于`dtTest0`有更多的行，我们随机选择`n1`行。最后，我们重新定义`dtTest`，将`dtTest0`和`dtTest1`绑定，如下所示：
- en: '[PRE53]'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Build the random forest model using `randomForest`. The formula argument defines
    the relationship between variables and the data argument defines the training
    dataset. In order to avoid overcomplicating the model, all the other parameters
    are left as their defaults:'
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`randomForest`构建随机森林模型。公式参数定义了变量与数据之间的关系，数据参数定义了训练数据集。为了避免模型过于复杂，所有其他参数都保留为默认值：
- en: '[PRE54]'
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Build the logistic regression model using `glm`, which is a function used to
    build **Generalized Linear Models** (**GLM**). GLMs are a generalization of the
    linear regression and they allow to define a link function that connects the linear
    predictor with the outputs. The input is the same as the random forest, with the
    addition of `family = binomial(logit)` defining that the regression is logistic:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`glm`构建逻辑回归模型，这是一个用于构建**广义线性模型**（**GLM**）的函数。GLMs是线性回归的推广，允许定义一个将线性预测器与输出连接的链接函数。输入与随机森林相同，增加`family
    = binomial(logit)`定义回归为逻辑回归：
- en: '[PRE55]'
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Predict the output of the random forest. The function is `predict` and its
    main arguments are `object` defining the model and `newdata` defining the test
    set, as follows:'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`predict`函数预测随机森林的输出。该函数的主要参数是`object`定义模型和`newdata`定义测试集，如下所示：
- en: '[PRE56]'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Predict the output of the logistic regression, using `predict` similar to the
    random forest. The other argument is `type=''response''` and it is necessary in
    the case of the logistic regression:'
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`predict`函数预测逻辑回归的输出，类似于随机森林。另一个参数是`type='response'`，在逻辑回归的情况下是必要的：
- en: '[PRE57]'
  id: totrans-199
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Add the new test set to `dtTestBinded`:'
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将新的测试集添加到`dtTestBinded`：
- en: '[PRE58]'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'End the `for` loop:'
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结束`for`循环：
- en: '[PRE59]'
  id: totrans-203
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: We built `dtTestBinded` containing the `output` column that defines which clients
    subscribed and the scores estimated by the models. Comparing the scores with the
    real output, we can validate the model performances.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 我们构建了包含`output`列的`dtTestBinded`，该列定义了哪些客户订阅以及模型估计的得分。通过比较得分与实际输出，我们可以验证模型性能：
- en: 'In order to explore `dtTestBinded`, we can build a chart showing how the scores
    of the non-subscribing clients are distributed. Then, we add the distribution
    of the subscribing clients to the chart and compare them. In this way, we can
    see the difference between the scores of the two groups. Since we use the same
    chart for the random forest and for the logistic regression, we define a function
    building the chart by following the given steps:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 为了探索`dtTestBinded`，我们可以构建一个图表，显示非订阅客户得分的分布情况。然后，我们将订阅客户的分布添加到图表中，并进行比较。这样，我们可以看到两组得分之间的差异。由于我们使用相同的图表进行随机森林和逻辑回归，我们定义了一个按照给定步骤构建图表的函数：
- en: 'Define the function and its input that includes the data table and the name
    of the score column:'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义函数及其输入，包括数据表和得分列的名称：
- en: '[PRE60]'
  id: totrans-207
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Compute the distribution density for the clients that didn''t subscribe. With
    `output == 0`, we extract the clients not subscribing, and using `density`, we
    define a `density` object. The adjust parameter defines the smoothing bandwidth
    that is a parameter of the way we build the curve starting from the data. The
    bandwidth can be interpreted as the level of detail:'
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算未订阅客户的分布密度。当`output == 0`时，我们提取未订阅的客户，并使用`density`定义一个`density`对象。调整参数定义了从数据开始构建曲线的平滑带宽，带宽可以理解为细节级别：
- en: '[PRE61]'
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Compute the distribution density for the clients that subscribed:'
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算已订阅客户的分布密度：
- en: '[PRE62]'
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Define the colors in the chart using `rgb`. The colors are transparent red
    and transparent blue:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`rgb`定义图表中的颜色。颜色是透明的红色和透明的蓝色：
- en: '[PRE63]'
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Build the plot with the density of the clients not subscribing. Here, `polygon`
    is a function that adds the area to the chart:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`polygon`函数构建显示未订阅客户得分分布的密度图。在这里，`polygon`函数用于向图表添加面积：
- en: '[PRE64]'
  id: totrans-215
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Add the clients that subscribed to the chart:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将已订阅的客户添加到图表中：
- en: '[PRE65]'
  id: totrans-217
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Add the legend:'
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加图例：
- en: '[PRE66]'
  id: totrans-219
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'End the function:'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结束函数：
- en: '[PRE67]'
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Now, we can use `plotDistributions` on the random forest output:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以使用`plotDistributions`在随机森林输出上：
- en: '[PRE68]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'The histogram obtained is as follows:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 获得的直方图如下：
- en: '![Predicting the output](img/7740OS_08_10.jpg)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![预测输出](img/7740OS_08_10.jpg)'
- en: The x-axis represents the score and the y-axis represents the density that is
    proportional to the number of clients that subscribed for similar scores. Since
    we don't have a client for each possible score, assuming a level of detail of
    0.01, the density curve is smoothed in the sense that the density of each score
    is the average between the data with a similar score.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: x轴代表得分，y轴代表与订阅了相似得分的客户数量成比例的密度。由于我们并没有每个可能得分的客户，假设细节级别为0.01，密度曲线在意义上是平滑的，即每个得分的密度是相似得分数据的平均值。
- en: The red and blue areas represent the non-subscribing and subscribing clients
    respectively. As can be easily noticed, the violet area comes from the overlapping
    of the two curves. For each score, we can identify which density is higher. If
    the highest curve is red, the client will be more likely to subscribe, and vice
    versa.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 红色和蓝色区域分别代表未订阅和订阅客户。很容易注意到，紫色区域来自两条曲线的叠加。对于每个得分，我们可以识别哪个密度更高。如果最高曲线是红色，客户更有可能订阅，反之亦然。
- en: For the random forest, most of the non-subscribing client scores are between
    `0` and `0.2` and the density peak is around `0.05`. The subscribing clients have
    a more spread score, although higher, and their peak is around `0.1`. The two
    distributions overlap a lot, so it's not easy to identify which clients will subscribe
    starting from their scores. However, if the marketing campaign targets all customers
    with a score higher than 0.3, they will likely belong to the blue cluster. In
    conclusion, using random forest, we are able to identify a small set of customers
    that will subscribe very likely.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 对于随机森林，大多数未订阅客户的得分在`0`到`0.2`之间，密度峰值在`0.05`左右。订阅客户的得分分布更广，尽管更高，但峰值在`0.1`左右。两个分布重叠很多，因此很难从得分开始识别哪些客户会订阅。然而，如果营销活动针对得分高于0.3的所有客户，他们很可能属于蓝色簇。总之，使用随机森林，我们能够识别出一小部分很可能订阅的客户。
- en: 'In order to get a comparison, we can build the same chart about the logistic
    regression output, as shown here:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进行比较，我们可以构建关于逻辑回归输出的相同图表，如下所示：
- en: '[PRE69]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'The histogram obtained is as follows:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 获得的直方图如下：
- en: '![Predicting the output](img/7740OS_08_11.jpg)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![预测输出](img/7740OS_08_11.jpg)'
- en: For the logistic regression, the two distributions overlap a bit, but they clearly
    cover two different regions and their peaks are very distant. The clients whose
    score is higher than 0.8 will very likely subscribe, so we can choose a small
    set of clients. We are also able to identify a bigger set of clients that will
    likely subscribe, if we choose the ones that scored above 0.5 or 0.6.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 对于逻辑回归，两个分布略有重叠，但它们明显覆盖了两个不同的区域，并且它们的峰值相距很远。得分高于0.8的客户很可能订阅，因此我们可以选择一小部分客户。如果我们选择得分高于0.5或0.6的客户，我们也能够识别出一大批可能订阅的客户。
- en: In conclusion, the logistic regression seems to have performed better. However,
    the distribution charts are good to just explore the performance and don't provide
    with a clear evaluation. The next step is to define how to evaluate the model
    using an index.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，逻辑回归似乎表现更好。然而，分布图仅用于探索性能，并不能提供明确的评估。下一步是定义如何使用指标来评估模型。
- en: 'The validation index that we will use is the AUC and it depends on another
    chart that is the **Receiver Operating Characteristic** (**ROC**). After building
    the classification model, we define a threshold and assume that the customers
    with a score above the threshold will subscribe. The ROC shows the model accuracy
    depending on the threshold. The curve dimensions are:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用的验证指标是AUC，它依赖于另一个图表，即**接收者操作特征**（**ROC**）。在构建分类模型后，我们定义一个阈值，并假设得分高于阈值的客户将订阅。ROC显示了模型精度随阈值的变化。曲线维度为：
- en: '**True positive rate**: This index shows out of the subscribing customers,
    which percentage has a score above the threshold. This index should be as high
    as possible.'
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**真正率**：此指标显示在订阅客户中，有多少百分比的客户得分高于阈值。此指标应尽可能高。'
- en: '**False positive rate**: This index shows out of the non-subscribing customers,
    which percentage has a score above the threshold. This index should be as low
    as possible.'
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**假正率**：此指标显示在非订阅客户中，有多少百分比的客户得分高于阈值。此指标应尽可能低。'
- en: The **Area Under Curve** (**AUC**) is the area under the ROC. Given a random
    client that subscribed and another random client that did not subscribe, the AUC
    represents the probability that the score of the client that subscribed is higher
    than the other.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: '**曲线下面积**（**AUC**）是ROC曲线下的面积。给定一个订阅了服务的随机客户和另一个未订阅的随机客户，AUC表示订阅客户的得分高于其他客户的概率。'
- en: 'We can define a function that builds the chart and computes the AUC index:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以定义一个函数来构建图表并计算AUC指数：
- en: 'Load the `ROCR` package containing the function used to cross validate the
    model:'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载包含用于交叉验证模型的函数的`ROCR`包：
- en: '[PRE70]'
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Define the function and its input that includes the data table and the name
    of the score column:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义函数及其输入，包括数据表和得分列的名称：
- en: '[PRE71]'
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 'Define a prediction object that is the starting point to build the ROC chart.
    The function is `prediction` and it is provided by the `ROCR` package:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义一个预测对象，它是构建ROC图表的起点。该函数是`prediction`，由`ROCR`包提供：
- en: '[PRE72]'
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'Build the ROC chart. The function provided by the `ROCR` package is `performance`
    and it allows you to evaluate the prediction in different ways. In this case,
    we want to build a chart with the `true` and `false` positive rates, so the input
    is **true positive rate** (**tpr**) and **false positive rate** (**fpr**):'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建ROC图表。由`ROCR`包提供的函数是`performance`，它允许以不同的方式评估预测。在这种情况下，我们想要构建一个包含`true`和`false`正率的图表，因此输入是**真正率**（**tpr**）和**假正率**（**fpr**）：
- en: '[PRE73]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'Compute the AUC index using `performance`. The input is `auc` and it defines
    that we are computing the AUC index:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`performance`计算AUC指数。输入是`auc`，它定义了我们在计算AUC指数：
- en: '[PRE74]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'Return the AUC index as the function output:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将AUC指数作为函数输出：
- en: '[PRE75]'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Using `plotPerformance`, we can build the chart about the random forest and
    we compute the `auc` index that we store in `aucRf`:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`plotPerformance`，我们可以构建关于随机森林的图表，并计算存储在`aucRf`中的`auc`指数：
- en: '[PRE76]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'The histogram obtained is as follows:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 获得的直方图如下：
- en: '![Predicting the output](img/7740OS_08_13.jpg)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
  zh: '![预测输出](img/7740OS_08_13.jpg)'
- en: As anticipated, the chart displays the tpr and the fpr respectively. When the
    threshold is `1`, no clients have a rate higher than it, so there are no positives
    (clients that are predicted to subscribe). In this situation, we are in the top-right
    corner and both the indices are equal to 100 percent. As the threshold decreases,
    we have more positive customers, so tpr and fpr decrease. In the end, when the
    threshold is `0`, tpr and fpr are equal to `0` and we are in the bottom-left corner.
    In an ideal situation, tpr is equal to `1` and fpr is equal to `0` (top-left corner).
    Then, the closest the curve is to the top-left corner, the better.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期，图表显示了tpr和fpr。当阈值是`1`时，没有客户的比率高于它，因此没有正例（预测为订阅的客户）。在这种情况下，我们处于右上角，两个指数都等于100%。随着阈值的降低，我们有更多的正客户，因此tpr和fpr降低。最后，当阈值是`0`时，tpr和fpr都等于`0`，我们处于左下角。在一个理想的情况下，tpr等于`1`，fpr等于`0`（左上角）。然后，曲线越接近左上角，越好。
- en: 'Similar to the random forest, we build the chart and compute the AUC index
    for the logistic regression:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 与随机森林类似，我们构建图表并计算逻辑回归的AUC指数：
- en: '[PRE77]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'The histogram obtained is as follows:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 获得的直方图如下：
- en: '![Predicting the output](img/7740OS_08_14.jpg)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![预测输出](img/7740OS_08_14.jpg)'
- en: The chart for the logistic regression is similar to the one for the random forest.
    Looking at the details, we can notice that the curve in the bottom-left is steeper
    and at the top-right it is less steep, so the area under the curve, defining the
    AUC, is higher.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 逻辑回归的图表与随机森林的图表相似。观察细节，我们可以注意到左下角的曲线更陡峭，右上角的曲线则不那么陡峭，因此定义AUC的曲线下面积更大。
- en: The cross validation contains a random component, so the AUC indices might vary
    a bit. Setting `nIter = 100`, the last time I executed the script the AUC was
    around 73 percent for the random forest and around the 79 percent for the logistic
    regression. We can conclude that the logistic regression performed better, so
    we should use it to build the model.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 交叉验证包含一个随机成分，因此AUC指数可能会有所变化。设置`nIter = 100`，我上次执行脚本时，随机森林的AUC大约为73%，逻辑回归的AUC大约为79%。我们可以得出结论，逻辑回归表现更好，因此我们应该使用它来构建模型。
- en: In this section, we learned how to build a model that provides a score for the
    customers. This algorithm allows the company to identify the customers that are
    more likely to subscribe and it is also possible to estimate its accuracy. A continuation
    of this chapter would be selecting a feature subset and optimizing the parameters
    in order to achieve better performances.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了如何构建一个为顾客提供评分的模型。此算法允许公司识别出更有可能订阅的客户，并且还可以估计其准确性。本章的延续将是选择特征子集和优化参数，以实现更好的性能。
- en: Summary
  id: totrans-264
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned how to explore and transform the data related to
    a business problem. You used a clustering technique to segment the customer base
    of a bank and a supervised learning technique to identify a score ranking the
    clients. After building the machine learning model, you were able to cross validate
    it visualizing the ROC curve and computing the AUC index. In this way, you have
    been able to choose the most proper technique.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了如何探索和转换与商业问题相关的数据。你使用聚类技术来细分银行的客户群，并使用监督学习技术来识别对客户进行评分的排名。在构建机器学习模型后，你能够通过可视化ROC曲线和计算AUC指数来交叉验证它。这样，你就有能力选择最合适的技巧。
- en: This book showed how machine learning models can solve business problems. Rather
    than just a tutorial, the book is a path showing the importance of machine learning,
    how to develop a solution, and how to solve a business problem using the techniques.
    I hope that the book has transmitted not only the machine learning concepts, but
    also the passion for a field that is at the same time valuable and fascinating.
    I'd like to thank you for following this path. I hope it is just the start of
    a wonderful journey.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 本书展示了机器学习模型如何解决商业问题。这本书不仅仅是一个教程，它是一条道路，展示了机器学习的重要性，如何开发解决方案，以及如何使用这些技术来解决商业问题。我希望这本书不仅传达了机器学习概念，还传达了对一个既有价值又迷人的领域的热情。我想感谢你跟随这条道路。我希望这只是美好旅程的开始。
- en: Please don't hesitate to contact me if you have any queries.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有任何疑问，请随时联系我。

<html><head></head><body>
<div id="_idContainer062">
<h1 class="chapter-number" id="_idParaDest-95"><a id="_idTextAnchor351"/><span class="koboSpan" id="kobo.1.1" xmlns:="http://www.w3.org/1999/xhtml">3</span></h1>
<h1 id="_idParaDest-96"><a id="_idTextAnchor352"/><a id="_idTextAnchor353"/><span class="koboSpan" id="kobo.2.1" xmlns:="http://www.w3.org/1999/xhtml">Transforming Numerical Variables</span></h1>
<p><span class="koboSpan" id="kobo.3.1" xmlns:="http://www.w3.org/1999/xhtml">The statistical methods that are used in data analysis make certain assumptions about the data. </span><span class="koboSpan" id="kobo.3.2" xmlns:="http://www.w3.org/1999/xhtml">For example, in the general linear model, it is assumed that the values of the dependent variable (the target) are independent, that there is a linear relationship between the target and the independent (predictor) variables, and that the residuals – that is, the difference between the predictions and the real values of the target – are normally distributed and centered at </span><strong class="source-inline"><span class="koboSpan" id="kobo.4.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.5.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.5.2" xmlns:="http://www.w3.org/1999/xhtml">When these assumptions are not met, the resulting probabilistic statements might not be accurate. </span><span class="koboSpan" id="kobo.5.3" xmlns:="http://www.w3.org/1999/xhtml">To correct for failure in the assumptions and thus improve the performance of the models, we can transform variables before </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1" xmlns:="http://www.w3.org/1999/xhtml">the analysis.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1" xmlns:="http://www.w3.org/1999/xhtml">When we transform a variable, we replace its original values with a function of that variable. </span><span class="koboSpan" id="kobo.7.2" xmlns:="http://www.w3.org/1999/xhtml">Transforming variables with mathematical functions helps reduce variable skewness, improves the value spread, and sometimes unmasks linear and additive relationships between predictors and the target. </span><span class="koboSpan" id="kobo.7.3" xmlns:="http://www.w3.org/1999/xhtml">Commonly used mathematical transformations include the logarithm, reciprocal, power, and square and cube root transformations, as well as the Box-Cox and Yeo-Johnson transformations. </span><span class="koboSpan" id="kobo.7.4" xmlns:="http://www.w3.org/1999/xhtml">This set of transformations </span><a id="_idTextAnchor354"/><span class="koboSpan" id="kobo.8.1" xmlns:="http://www.w3.org/1999/xhtml">is commonly referred</span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.9.1" xmlns:="http://www.w3.org/1999/xhtml"> to as </span><strong class="bold"><span class="koboSpan" id="kobo.10.1" xmlns:="http://www.w3.org/1999/xhtml">variance stabilizing transformations</span></strong><span class="koboSpan" id="kobo.11.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.11.2" xmlns:="http://www.w3.org/1999/xhtml">Variance stabilizing transformations intend to bring the distribution of the variable to a more symmetric – that is, Gaussian – shape. </span><span class="koboSpan" id="kobo.11.3" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will discuss when to use each transformation and then implement them using NumPy, scikit-learn, </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1" xmlns:="http://www.w3.org/1999/xhtml">and Feature-engine.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1" xmlns:="http://www.w3.org/1999/xhtml">This chapter contains the </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1" xmlns:="http://www.w3.org/1999/xhtml">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.15.1" xmlns:="http://www.w3.org/1999/xhtml">Transforming variables with the </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1" xmlns:="http://www.w3.org/1999/xhtml">logarithm function</span></span></li>
<li><span class="koboSpan" id="kobo.17.1" xmlns:="http://www.w3.org/1999/xhtml">Transforming variables with the </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1" xmlns:="http://www.w3.org/1999/xhtml">reciprocal function</span></span></li>
<li><span class="koboSpan" id="kobo.19.1" xmlns:="http://www.w3.org/1999/xhtml">Using the square root to </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1" xmlns:="http://www.w3.org/1999/xhtml">transform variables</span></span></li>
<li><span class="koboSpan" id="kobo.21.1" xmlns:="http://www.w3.org/1999/xhtml">Using </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1" xmlns:="http://www.w3.org/1999/xhtml">power transformations</span></span></li>
<li><span class="koboSpan" id="kobo.23.1" xmlns:="http://www.w3.org/1999/xhtml">Performing </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1" xmlns:="http://www.w3.org/1999/xhtml">Box-Cox transformatio</span><a id="_idTextAnchor355"/><span class="koboSpan" id="kobo.25.1" xmlns:="http://www.w3.org/1999/xhtml">ns</span></span></li>
<li><span class="koboSpan" id="kobo.26.1" xmlns:="http://www.w3.org/1999/xhtml">Performing </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1" xmlns:="http://www.w3.org/1999/xhtml">Yeo-Johnson transformatio</span><a id="_idTextAnchor356"/><span class="koboSpan" id="kobo.28.1" xmlns:="http://www.w3.org/1999/xhtml">ns</span></span><a id="_idTextAnchor357"/><a id="_idTextAnchor358"/></li>
</ul>
<h1 id="_idParaDest-97"><a id="_idTextAnchor359"/><span class="koboSpan" id="kobo.29.1" xmlns:="http://www.w3.org/1999/xhtml">Transforming variables with the logarithm function</span></h1>
<p><span class="koboSpan" id="kobo.30.1" xmlns:="http://www.w3.org/1999/xhtml">The</span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.31.1" xmlns:="http://www.w3.org/1999/xhtml"> logarithm function is a</span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.32.1" xmlns:="http://www.w3.org/1999/xhtml"> powerful transformation for dealing with positive data wi</span><a id="_idTextAnchor360"/><span class="koboSpan" id="kobo.33.1" xmlns:="http://www.w3.org/1999/xhtml">th a right-skewed distribution (observations accumulate at lower values of the variable). </span><span class="koboSpan" id="kobo.33.2" xmlns:="http://www.w3.org/1999/xhtml">A comm</span><a id="_idTextAnchor361"/><span class="koboSpan" id="kobo.34.1" xmlns:="http://www.w3.org/1999/xhtml">on example is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.35.1" xmlns:="http://www.w3.org/1999/xhtml">income</span></strong><span class="koboSpan" id="kobo.36.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, with a heavy accumulation of values toward lower salaries. </span><span class="koboSpan" id="kobo.36.2" xmlns:="http://www.w3.org/1999/xhtml">The logarithm transformation has a strong effect on the shape of the </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1" xmlns:="http://www.w3.org/1999/xhtml">variable distribution.</span></span></p>
<p><span class="koboSpan" id="kobo.38.1" xmlns:="http://www.w3.org/1999/xhtml">In this </span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.39.1" xmlns:="http://www.w3.org/1999/xhtml">recipe, we will perform logarithmic transformation using NumPy, scikit-learn, and Feature-engine. </span><span class="koboSpan" id="kobo.39.2" xmlns:="http://www.w3.org/1999/xhtml">We will also create a diagnostic plot function to evaluate the effect of the transformation on the </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1" xmlns:="http://www.w3.org/1999/xhtml">variable distributi</span><a id="_idTextAnchor362"/><a id="_idTextAnchor363"/><span class="koboSpan" id="kobo.41.1" xmlns:="http://www.w3.org/1999/xhtml">on.</span></span></p>
<h2 id="_idParaDest-98"><a id="_idTextAnchor364"/><span class="koboSpan" id="kobo.42.1" xmlns:="http://www.w3.org/1999/xhtml">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.43.1" xmlns:="http://www.w3.org/1999/xhtml">To evaluate the variable distribution and understand whether a transformation improves value spread and stabilizes the variance, we can visually inspect the data w</span><a id="_idTextAnchor365"/><span class="koboSpan" id="kobo.44.1" xmlns:="http://www.w3.org/1999/xhtml">ith histograms and </span><strong class="bold"><span class="koboSpan" id="kobo.45.1" xmlns:="http://www.w3.org/1999/xhtml">Quantile-Quantile</span></strong><span class="koboSpan" id="kobo.46.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span><strong class="bold"><span class="koboSpan" id="kobo.47.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q</span></strong><span class="koboSpan" id="kobo.48.1" xmlns:="http://www.w3.org/1999/xhtml">) plots. </span><span class="koboSpan" id="kobo.48.2" xmlns:="http://www.w3.org/1999/xhtml">A Q-Q plot helps us determine whether two</span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.49.1" xmlns:="http://www.w3.org/1999/xhtml"> variables show a similar distribution. </span><span class="koboSpan" id="kobo.49.2" xmlns:="http://www.w3.org/1999/xhtml">In a Q-Q plot, we plot the quantiles of one variable against the quantiles of the second variable. </span><span class="koboSpan" id="kobo.49.3" xmlns:="http://www.w3.org/1999/xhtml">If we plot the quantiles of the variable of interest against the expected quantiles of the normal distribution, then we can determine whether our variable is also normally distributed. </span><span class="koboSpan" id="kobo.49.4" xmlns:="http://www.w3.org/1999/xhtml">If the variable is normally distributed, the points in the Q-Q plot will fall along a </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1" xmlns:="http://www.w3.org/1999/xhtml">45-degree diagonal.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.51.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.52.1" xmlns:="http://www.w3.org/1999/xhtml">A quantile is the value below which there is a certain fraction of data points in the distribution. </span><span class="koboSpan" id="kobo.52.2" xmlns:="http://www.w3.org/1999/xhtml">Thus, the 20th quantile is the point in the distribution at which 20% of the observations fall below and 80% above </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1" xmlns:="http://www.w3.org/1999/xhtml">that va</span><a id="_idTextAnchor366"/><a id="_idTextAnchor367"/><span class="koboSpan" id="kobo.54.1" xmlns:="http://www.w3.org/1999/xhtml">lue.</span></span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor368"/><span class="koboSpan" id="kobo.55.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.56.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s b</span><a id="_idTextAnchor369"/><span class="koboSpan" id="kobo.57.1" xmlns:="http://www.w3.org/1999/xhtml">egin</span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.58.1" xmlns:="http://www.w3.org/1999/xhtml"> by importing the libr</span><a id="_idTextAnchor370"/><span class="koboSpan" id="kobo.59.1" xmlns:="http://www.w3.org/1999/xhtml">aries and getting the </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.61.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required Python libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1" xmlns:="http://www.w3.org/1999/xhtml">and dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.63.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import scipy.stats as stats
from sklearn.datasets import fetch_california_housing</span></pre></li> <li><span class="koboSpan" id="kobo.64.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.65.1" xmlns:="http://www.w3.org/1999/xhtml"> load the California housing dataset into a </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1" xmlns:="http://www.w3.org/1999/xhtml">pandas DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.67.1" xmlns:="http://www.w3.org/1999/xhtml">
X, y = fetch_california_housing(return_X_y=True,
    as_frame=True)</span></pre></li> <li><span class="koboSpan" id="kobo.68.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s explore the distributions of all the variables in the dataset by plotting histograms </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1" xmlns:="http://www.w3.org/1999/xhtml">with pandas:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.70.1" xmlns:="http://www.w3.org/1999/xhtml">
X.hist(bins=30, figsize=(12, 12))
plt.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.71.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we can see that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.73.1" xmlns:="http://www.w3.org/1999/xhtml"> variable shows </span><a id="_idTextAnchor371"/><span class="koboSpan" id="kobo.74.1" xmlns:="http://www.w3.org/1999/xhtml">a mild right-skewed distribution, var</span><a id="_idTextAnchor372"/><span class="koboSpan" id="kobo.75.1" xmlns:="http://www.w3.org/1999/xhtml">iables such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1" xmlns:="http://www.w3.org/1999/xhtml">AveRooms</span></strong><span class="koboSpan" id="kobo.77.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.78.1" xmlns:="http://www.w3.org/1999/xhtml">Population</span></strong><span class="koboSpan" id="kobo.79.1" xmlns:="http://www.w3.org/1999/xhtml"> are heavily right-skewed, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.80.1" xmlns:="http://www.w3.org/1999/xhtml">HouseAge</span></strong><span class="koboSpan" id="kobo.81.1" xmlns:="http://www.w3.org/1999/xhtml"> variable shows an even spread of values across </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1" xmlns:="http://www.w3.org/1999/xhtml">its </span><a id="_idTextAnchor373"/><span class="koboSpan" id="kobo.83.1" xmlns:="http://www.w3.org/1999/xhtml">range:</span></span></p></li> </ol>
<p class="IMG---Figure"><span class="koboSpan" id="kobo.84.1" xmlns:="http://www.w3.org/1999/xhtml">figure 3</span></p>
<div>
<div class="IMG---Figure" id="_idContainer043">
<span class="koboSpan" id="kobo.85.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.1 – Histograms with the distribution of the numerical variables" src="image/B22396_03_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.86.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.1 – Histograms with the distribution of the numerical variables</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.87.1" xmlns:="http://www.w3.org/1999/xhtml">To </span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.88.1" xmlns:="http://www.w3.org/1999/xhtml">evaluate</span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.89.1" xmlns:="http://www.w3.org/1999/xhtml"> the effect of the transformation on the variable distribution</span><a id="_idTextAnchor374"/><span class="koboSpan" id="kobo.90.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll create a f</span><a id="_idTextAnchor375"/><span class="koboSpan" id="kobo.91.1" xmlns:="http://www.w3.org/1999/xhtml">unction that takes a DataFrame and a variable name as inputs and plots a histogram next to a </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plot:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.93.1" xmlns:="http://www.w3.org/1999/xhtml">
def diagnostic_plots(df, variable):
    plt.figure(figsize=(15,6))
    plt.subplot(1, 2, 1)
    df[variable].hist(bins=30)
    plt.title(f"Histogram of {variable}")
    plt.subplot(1, 2, 2)
    stats.probplot(df[variable], dist="norm",
        plot=plt)
    plt.title(f"Q-Q plot of {variable}")
    plt.show()</span></pre></li> <li><span class="koboSpan" id="kobo.94.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.95.1" xmlns:="http://www.w3.org/1999/xhtml">plot the</span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.96.1" xmlns:="http://www.w3.org/1999/xhtml"> distribution of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.98.1" xmlns:="http://www.w3.org/1999/xhtml"> variable with the function from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.99.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.100.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.101.1" xmlns:="http://www.w3.org/1999/xhtml">
diagnostic_plots(X, "MedInc")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.102.1" xmlns:="http://www.w3.org/1999/xhtml">The following output shows that </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.104.1" xmlns:="http://www.w3.org/1999/xhtml"> has a </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1" xmlns:="http://www.w3.org/1999/xhtml">right-skewed distr</span><a id="_idTextAnchor376"/><span class="koboSpan" id="kobo.106.1" xmlns:="http://www.w3.org/1999/xhtml">ibution:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer044">
<span class="koboSpan" id="kobo.107.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.2 – A histogram and Q-Q plot of the MedInc variable" src="image/B22396_03_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.108.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.2 – A histogram and Q-Q plot of the MedInc variable</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.109.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s transform the data with </span><span class="No-Break"><span class="koboSpan" id="kobo.110.1" xmlns:="http://www.w3.org/1999/xhtml">the logarithm:</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.111.1" xmlns:="http://www.w3.org/1999/xhtml">Firs</span><a id="_idTextAnchor377"/><span class="koboSpan" id="kobo.112.1" xmlns:="http://www.w3.org/1999/xhtml">t, let’s mak</span><a id="_idTextAnchor378"/><span class="koboSpan" id="kobo.113.1" xmlns:="http://www.w3.org/1999/xhtml">e a copy of the </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1" xmlns:="http://www.w3.org/1999/xhtml">original DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.115.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = X.copy()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.116.1" xmlns:="http://www.w3.org/1999/xhtml">We’ve </span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.117.1" xmlns:="http://www.w3.org/1999/xhtml">created a copy so that we can modify the values in the copy and not in the original DataFrame, which we need for the rest of </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1" xmlns:="http://www.w3.org/1999/xhtml">this recipe.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.119.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.120.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1" xmlns:="http://www.w3.org/1999/xhtml">X_tf = X</span></strong><span class="koboSpan" id="kobo.122.1" xmlns:="http://www.w3.org/1999/xhtml"> instead of using pandas’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1" xmlns:="http://www.w3.org/1999/xhtml">copy()</span></strong><span class="koboSpan" id="kobo.124.1" xmlns:="http://www.w3.org/1999/xhtml">function, </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1" xmlns:="http://www.w3.org/1999/xhtml">X_tf</span></strong><span class="koboSpan" id="kobo.126.1" xmlns:="http://www.w3.org/1999/xhtml"> will not be a copy of the DataFrame; instead, it will be another view of the same data. </span><span class="koboSpan" id="kobo.126.2" xmlns:="http://www.w3.org/1999/xhtml">Therefore, changes made in </span><strong class="source-inline"><span class="koboSpan" id="kobo.127.1" xmlns:="http://www.w3.org/1999/xhtml">X_tf</span></strong><span class="koboSpan" id="kobo.128.1" xmlns:="http://www.w3.org/1999/xhtml"> will be reflected in </span><strong class="source-inline"><span class="koboSpan" id="kobo.129.1" xmlns:="http://www.w3.org/1999/xhtml">X</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.130.1" xmlns:="http://www.w3.org/1999/xhtml">as well.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.131.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.132.1" xmlns:="http://www.w3.org/1999/xhtml">make a list with the variables that we want </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1" xmlns:="http://www.w3.org/1999/xhtml">to transform:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.134.1" xmlns:="http://www.w3.org/1999/xhtml">
vars = ["MedInc", "AveRooms", "AveBedrms",
    "Populati</span><a id="_idTextAnchor379"/><span class="koboSpan" id="kobo.135.1" xmlns:="http://www.w3.org/1999/xhtml">on"]</span></pre></li> <li><span class="koboSpan" id="kobo.136.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s apply the logarithmic transformation with NumPy to the variables from </span><em class="italic"><span class="koboSpan" id="kobo.137.1" xmlns:="http://www.w3.org/1999/xhtml">step 7</span></em><span class="koboSpan" id="kobo.138.1" xmlns:="http://www.w3.org/1999/xhtml"> a</span><a id="_idTextAnchor380"/><span class="koboSpan" id="kobo.139.1" xmlns:="http://www.w3.org/1999/xhtml">nd capture the transformed variables in the </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1" xmlns:="http://www.w3.org/1999/xhtml">new DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.141.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf[vars] = np.log(X[vars])</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.142.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.143.1" xmlns:="http://www.w3.org/1999/xhtml">Remember that the logarithm transformation can only be applied to strictly positive variables. </span><span class="koboSpan" id="kobo.143.2" xmlns:="http://www.w3.org/1999/xhtml">If the variables have zero or negative values, sometimes, it is useful to add a constant to make those values positive. </span><span class="koboSpan" id="kobo.143.3" xmlns:="http://www.w3.org/1999/xhtml">We could add a constant value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1" xmlns:="http://www.w3.org/1999/xhtml">1 </span></strong><span class="koboSpan" id="kobo.145.1" xmlns:="http://www.w3.org/1999/xhtml">using </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1" xmlns:="http://www.w3.org/1999/xhtml">X_tf[vars] = np.log(X[vars] + </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.147.1" xmlns:="http://www.w3.org/1999/xhtml">1)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.148.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.149.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s check the distribution of </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.151.1" xmlns:="http://www.w3.org/1999/xhtml"> after the transformation with the diagnostic function from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.152.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.153.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.154.1" xmlns:="http://www.w3.org/1999/xhtml">
diagnostic_plots(X_tf, "MedInc")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.155.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we can see that the logarithmic transformation returned a more evenly distributed variable that better approximates the theoretical normal distribution in the </span><a id="_idTextAnchor381"/><span class="No-Break"><span class="koboSpan" id="kobo.156.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.157.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.3 – A histogram and Q-Q plot of the MedInc variable after the logarithm transformation﻿" src="image/B22396_03_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.158.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.3 – A histogram and Q-Q plot of the MedInc variable after the logarithm transformation</span><a id="_idTextAnchor382"/></p>
<p class="list-inset"><span class="koboSpan" id="kobo.159.1" xmlns:="http://www.w3.org/1999/xhtml">Go ahead </span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.160.1" xmlns:="http://www.w3.org/1999/xhtml">an</span><a id="_idTextAnchor383"/><span class="koboSpan" id="kobo.161.1" xmlns:="http://www.w3.org/1999/xhtml">d plot the other transformed variables to familiarize yourself with the effect of the logarithm transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1" xmlns:="http://www.w3.org/1999/xhtml">on distributions.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.163.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.164.1" xmlns:="http://www.w3.org/1999/xhtml">apply the logarithmic transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.166.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.167.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.168.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1" xmlns:="http://www.w3.org/1999/xhtml">import </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.170.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.171.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.172.1" xmlns:="http://www.w3.org/1999/xhtml">
from sklearn.preprocessing import FunctionTransformer</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.173.1" xmlns:="http://www.w3.org/1999/xhtml">Before we proceed, we need to take a copy of the original dataset, as we did in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.174.1" xmlns:="http://www.w3.org/1999/xhtml">step 6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.175.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.176.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll set up the transformer to apply the logarithm and to be able to revert the transformed variable to its </span><span class="No-Break"><span class="koboSpan" id="kobo.177.1" xmlns:="http://www.w3.org/1999/xhtml">original representation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.178.1" xmlns:="http://www.w3.org/1999/xhtml">
transformer = FunctionTransformer(np.log,
    inverse_func=np.exp)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.179.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.180.1" xmlns:="http://www.w3.org/1999/xhtml">If we set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.182.1" xmlns:="http://www.w3.org/1999/xhtml"> with the default parameter, </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1" xmlns:="http://www.w3.org/1999/xhtml">validate=False</span></strong><span class="koboSpan" id="kobo.184.1" xmlns:="http://www.w3.org/1999/xhtml">, we don’t need to fit the transformer before transforming the data. </span><span class="koboSpan" id="kobo.184.2" xmlns:="http://www.w3.org/1999/xhtml">If we set </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1" xmlns:="http://www.w3.org/1999/xhtml">validate</span></strong><span class="koboSpan" id="kobo.186.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.187.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.188.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer will check the data input to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1" xmlns:="http://www.w3.org/1999/xhtml">fit</span></strong><span class="koboSpan" id="kobo.190.1" xmlns:="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.190.2" xmlns:="http://www.w3.org/1999/xhtml">The latter is useful when fitting the transformer with a DataFrame so that it learns and stores the </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1" xmlns:="http://www.w3.org/1999/xhtml">variable n</span><a id="_idTextAnchor384"/><span class="koboSpan" id="kobo.192.1" xmlns:="http://www.w3.org/1999/xhtml">ames.</span></span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.193.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s tr</span><a id="_idTextAnchor385"/><span class="koboSpan" id="kobo.194.1" xmlns:="http://www.w3.org/1999/xhtml">ansform the positive variables from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.195.1" xmlns:="http://www.w3.org/1999/xhtml">step 7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.196.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.197.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf[vars] = transformer.transform(X[vars])</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.198.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.199.1" xmlns:="http://www.w3.org/1999/xhtml">Scikit-learn transformers return NumPy arrays and transform the entire DataFrame by default. </span><span class="koboSpan" id="kobo.199.2" xmlns:="http://www.w3.org/1999/xhtml">In this case, we assigned the results of the array directly to our existing DataFrame. </span><span class="koboSpan" id="kobo.199.3" xmlns:="http://www.w3.org/1999/xhtml">We can change the returned format through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.200.1" xmlns:="http://www.w3.org/1999/xhtml">set_output</span></strong><span class="koboSpan" id="kobo.201.1" xmlns:="http://www.w3.org/1999/xhtml"> method and we can restrict the variables to transform </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.203.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.204.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.205.1" xmlns:="http://www.w3.org/1999/xhtml">Check </span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.206.1" xmlns:="http://www.w3.org/1999/xhtml">the results of the transformation</span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.207.1" xmlns:="http://www.w3.org/1999/xhtml"> with the diagnostic function from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.208.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.209.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.210.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s now revert the transformation to the original </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1" xmlns:="http://www.w3.org/1999/xhtml">variable representation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.212.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf[vars] = transformer.inverse_transform(X_tf[vars])</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.213.1" xmlns:="http://www.w3.org/1999/xhtml">If you check the distribution by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1" xmlns:="http://www.w3.org/1999/xhtml">diagnostic_plots(X_tf, "MedInc")</span></strong><span class="koboSpan" id="kobo.215.1" xmlns:="http://www.w3.org/1999/xhtml">, you should see a plot that is identical to that returned by </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.216.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.217.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.218.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.219.1" xmlns:="http://www.w3.org/1999/xhtml">To add a constant value to the variables, in case they are not strictly positive, use </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1" xmlns:="http://www.w3.org/1999/xhtml">transformer = FunctionTransformer(lambda x: np.log(x + </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.221.1" xmlns:="http://www.w3.org/1999/xhtml">1)</span><a id="_idTextAnchor386"/><span class="koboSpan" id="kobo.222.1" xmlns:="http://www.w3.org/1999/xhtml">)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.223.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.224.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s apply the logarithm transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1" xmlns:="http://www.w3.org/1999/xhtml">with Feature-</span><a id="_idTextAnchor387"/><span class="koboSpan" id="kobo.226.1" xmlns:="http://www.w3.org/1999/xhtml">engine.</span></span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.227.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1" xmlns:="http://www.w3.org/1999/xhtml">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.229.1" xmlns:="http://www.w3.org/1999/xhtml">LogTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.230.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.231.1" xmlns:="http://www.w3.org/1999/xhtml">
from feature_engine.transformation import LogTransformer</span></pre></li> <li><span class="koboSpan" id="kobo.232.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll set up the transformer to transform the variables from </span><em class="italic"><span class="koboSpan" id="kobo.233.1" xmlns:="http://www.w3.org/1999/xhtml">step 7</span></em><span class="koboSpan" id="kobo.234.1" xmlns:="http://www.w3.org/1999/xhtml"> and then fit the transformer to </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.236.1" xmlns:="http://www.w3.org/1999/xhtml">
lt = LogTransformer(variables = vars)
lt.fit(X)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.237.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.238.1" xmlns:="http://www.w3.org/1999/xhtml">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.240.1" xmlns:="http://www.w3.org/1999/xhtml"> argument is left as </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.242.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1" xmlns:="http://www.w3.org/1999/xhtml">LogTransformer()</span></strong><span class="koboSpan" id="kobo.244.1" xmlns:="http://www.w3.org/1999/xhtml"> applies the logarithm to all the numerical variables found during </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.246.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.246.2" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, we can indicate which variables to modify, as we did in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.247.1" xmlns:="http://www.w3.org/1999/xhtml">step 15</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.248.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="16"><span class="koboSpan" id="kobo.249.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s</span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.250.1" xmlns:="http://www.w3.org/1999/xhtml"> transform</span><a id="_idIndexMarker218"/> <span class="No-Break"><span class="koboSpan" id="kobo.251.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.252.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = lt.transform(X)</span></pre><p class="list-inset"><strong class="source-inline"><span class="koboSpan" id="kobo.253.1" xmlns:="http://www.w3.org/1999/xhtml">X_tf</span></strong><span class="koboSpan" id="kobo.254.1" xmlns:="http://www.w3.org/1999/xhtml"> is a copy of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1" xmlns:="http://www.w3.org/1999/xhtml">X</span></strong><span class="koboSpan" id="kobo.256.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrame, where the variables from </span><em class="italic"><span class="koboSpan" id="kobo.257.1" xmlns:="http://www.w3.org/1999/xhtml">step 7</span></em><span class="koboSpan" id="kobo.258.1" xmlns:="http://www.w3.org/1999/xhtml"> are transformed with </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1" xmlns:="http://www.w3.org/1999/xhtml">the logarithm.</span></span></p></li> <li><span class="koboSpan" id="kobo.260.1" xmlns:="http://www.w3.org/1999/xhtml">We can also revert </span><a id="_idTextAnchor388"/><span class="koboSpan" id="kobo.261.1" xmlns:="http://www.w3.org/1999/xhtml">the transformed variables to their </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1" xmlns:="http://www.w3.org/1999/xhtml">original representation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.263.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = lt.inverse_transfo</span><a id="_idTextAnchor389"/><span class="koboSpan" id="kobo.264.1" xmlns:="http://www.w3.org/1999/xhtml">rm(X_tf)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.265.1" xmlns:="http://www.w3.org/1999/xhtml">If you check the distribution of the variables after </span><em class="italic"><span class="koboSpan" id="kobo.266.1" xmlns:="http://www.w3.org/1999/xhtml">step 17</span></em><span class="koboSpan" id="kobo.267.1" xmlns:="http://www.w3.org/1999/xhtml">, they should be identical to those of the </span><span class="No-Break"><span class="koboSpan" id="kobo.268.1" xmlns:="http://www.w3.org/1999/xhtml">original data.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.269.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.270.1" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine has a dedicated transformer that adds constant values to the variables before the applying the logarithm transformation. </span><span class="koboSpan" id="kobo.270.2" xmlns:="http://www.w3.org/1999/xhtml">Check the </span><em class="italic"><span class="koboSpan" id="kobo.271.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more…</span></em><span class="koboSpan" id="kobo.272.1" xmlns:="http://www.w3.org/1999/xhtml"> section later in this recipe fo</span><a id="_idTextAnchor390"/><a id="_idTextAnchor391"/><span class="koboSpan" id="kobo.273.1" xmlns:="http://www.w3.org/1999/xhtml">r </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1" xmlns:="http://www.w3.org/1999/xhtml">more details.</span></span></p>
<h2 id="_idParaDest-100"><a id="_idTextAnchor392"/><span class="koboSpan" id="kobo.275.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.276.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we applied the logarithm transformation to a subset of positive variables using NumPy, scikit-learn, </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1" xmlns:="http://www.w3.org/1999/xhtml">and Feature-engine.</span></span></p>
<p><span class="koboSpan" id="kobo.278.1" xmlns:="http://www.w3.org/1999/xhtml">To compare</span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.279.1" xmlns:="http://www.w3.org/1999/xhtml"> the effect of the transformation on the variable distribution, we created a diagnostic function to plot a histogram next to a Q-Q plot. </span><span class="koboSpan" id="kobo.279.2" xmlns:="http://www.w3.org/1999/xhtml">To create the Q-Q plot, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1" xmlns:="http://www.w3.org/1999/xhtml">scipy.stats.probplot()</span></strong><span class="koboSpan" id="kobo.281.1" xmlns:="http://www.w3.org/1999/xhtml">, which plotted the quantiles of the variable of interest in the </span><em class="italic"><span class="koboSpan" id="kobo.282.1" xmlns:="http://www.w3.org/1999/xhtml">y</span></em><span class="koboSpan" id="kobo.283.1" xmlns:="http://www.w3.org/1999/xhtml"> axis versus the quantiles of a theoretical normal distribution, which we indicated by setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1" xmlns:="http://www.w3.org/1999/xhtml">dist</span></strong><span class="koboSpan" id="kobo.285.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1" xmlns:="http://www.w3.org/1999/xhtml">norm</span></strong><span class="koboSpan" id="kobo.287.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><em class="italic"><span class="koboSpan" id="kobo.288.1" xmlns:="http://www.w3.org/1999/xhtml">x</span></em><span class="koboSpan" id="kobo.289.1" xmlns:="http://www.w3.org/1999/xhtml"> axis. </span><span class="koboSpan" id="kobo.289.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1" xmlns:="http://www.w3.org/1999/xhtml">matplotlib</span></strong><span class="koboSpan" id="kobo.291.1" xmlns:="http://www.w3.org/1999/xhtml"> to display the plot by setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.292.1" xmlns:="http://www.w3.org/1999/xhtml">plot</span></strong><span class="koboSpan" id="kobo.293.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1" xmlns:="http://www.w3.org/1999/xhtml">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.295.1" xmlns:="http://www.w3.org/1999/xhtml">plt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.296.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.297.1" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.298.1" xmlns:="http://www.w3.org/1999/xhtml">plt.figure()</span></strong><span class="koboSpan" id="kobo.299.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1" xmlns:="http://www.w3.org/1999/xhtml">figsize</span></strong><span class="koboSpan" id="kobo.301.1" xmlns:="http://www.w3.org/1999/xhtml">, we adjusted the size of the figure and, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1" xmlns:="http://www.w3.org/1999/xhtml">plt.subplot()</span></strong><span class="koboSpan" id="kobo.303.1" xmlns:="http://www.w3.org/1999/xhtml">, we organized the two plots in </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1" xmlns:="http://www.w3.org/1999/xhtml">one</span></strong><span class="koboSpan" id="kobo.305.1" xmlns:="http://www.w3.org/1999/xhtml"> row with </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1" xmlns:="http://www.w3.org/1999/xhtml">two</span></strong><span class="koboSpan" id="kobo.307.1" xmlns:="http://www.w3.org/1999/xhtml"> columns – that is, one plot next to the other. </span><span class="koboSpan" id="kobo.307.2" xmlns:="http://www.w3.org/1999/xhtml">The numbers within </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1" xmlns:="http://www.w3.org/1999/xhtml">plt.subplot()</span></strong><span class="koboSpan" id="kobo.309.1" xmlns:="http://www.w3.org/1999/xhtml"> indicated the number of rows, the number of columns, and the place of the plot in the figure, respectively. </span><span class="koboSpan" id="kobo.309.2" xmlns:="http://www.w3.org/1999/xhtml">We placed the histogram in position 1 and the Q-Q plot in position 2 – that is, left and </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1" xmlns:="http://www.w3.org/1999/xhtml">right, respe</span><a id="_idTextAnchor393"/><span class="koboSpan" id="kobo.311.1" xmlns:="http://www.w3.org/1999/xhtml">ctively.</span></span></p>
<p><span class="koboSpan" id="kobo.312.1" xmlns:="http://www.w3.org/1999/xhtml">To test the </span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.313.1" xmlns:="http://www.w3.org/1999/xhtml">function, we plotted a histogram and a Q-Q plot for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.315.1" xmlns:="http://www.w3.org/1999/xhtml"> variable before t</span><a id="_idTextAnchor394"/><span class="koboSpan" id="kobo.316.1" xmlns:="http://www.w3.org/1999/xhtml">he transformation and observed that </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.318.1" xmlns:="http://www.w3.org/1999/xhtml"> was not normally distributed. </span><span class="koboSpan" id="kobo.318.2" xmlns:="http://www.w3.org/1999/xhtml">Most observations were at the left of the histogram and the values deviated from the 45-degree line in the Q-Q plot at both ends of </span><span class="No-Break"><span class="koboSpan" id="kobo.319.1" xmlns:="http://www.w3.org/1999/xhtml">the distribution.</span></span></p>
<p><span class="koboSpan" id="kobo.320.1" xmlns:="http://www.w3.org/1999/xhtml">Next, using </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1" xmlns:="http://www.w3.org/1999/xhtml">np.log()</span></strong><span class="koboSpan" id="kobo.322.1" xmlns:="http://www.w3.org/1999/xhtml">, we applied the logarithm to a slice of the DataFrame with four positive variables. </span><span class="koboSpan" id="kobo.322.2" xmlns:="http://www.w3.org/1999/xhtml">To evaluate the effect of the transformation, we plotted a histogram and Q-Q plot of the transformed </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.324.1" xmlns:="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.324.2" xmlns:="http://www.w3.org/1999/xhtml">We observed that, after the logarithm transformation, the values were more centered in the histogram and that, in the Q-Q plot, they only deviated from the 45-degree line toward the ends of </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1" xmlns:="http://www.w3.org/1999/xhtml">the distribution.</span></span></p>
<p><span class="koboSpan" id="kobo.326.1" xmlns:="http://www.w3.org/1999/xhtml">Next, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.328.1" xmlns:="http://www.w3.org/1999/xhtml"> from scikit-learn, which applies any user-defined function to a dataset. </span><span class="koboSpan" id="kobo.328.2" xmlns:="http://www.w3.org/1999/xhtml">We passed </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1" xmlns:="http://www.w3.org/1999/xhtml">np.log()</span></strong><span class="koboSpan" id="kobo.330.1" xmlns:="http://www.w3.org/1999/xhtml"> as an argument to apply the logarithm transformation and NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.331.1" xmlns:="http://www.w3.org/1999/xhtml">exp()</span></strong><span class="koboSpan" id="kobo.332.1" xmlns:="http://www.w3.org/1999/xhtml"> for the inverse transformation to </span><strong class="source-inline"><span class="koboSpan" id="kobo.333.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransfomer()</span></strong><span class="koboSpan" id="kobo.334.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.334.2" xmlns:="http://www.w3.org/1999/xhtml">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.336.1" xmlns:="http://www.w3.org/1999/xhtml"> method, we transformed a slice of the DataFrame with the positive variables by using the logarithm. </span><span class="koboSpan" id="kobo.336.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1" xmlns:="http://www.w3.org/1999/xhtml">inverse_transform()</span></strong><span class="koboSpan" id="kobo.338.1" xmlns:="http://www.w3.org/1999/xhtml">, we reverted the variable values to their </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1" xmlns:="http://www.w3.org/1999/xhtml">original representation.</span></span></p>
<p><span class="koboSpan" id="kobo.340.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, we used Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1" xmlns:="http://www.w3.org/1999/xhtml">LogTransformer()</span></strong><span class="koboSpan" id="kobo.342.1" xmlns:="http://www.w3.org/1999/xhtml"> and specified the variables to transform in a list using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.344.1" xmlns:="http://www.w3.org/1999/xhtml"> argument. </span><span class="koboSpan" id="kobo.344.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.346.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer checked that the variables were numerical and positive, and with </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.348.1" xmlns:="http://www.w3.org/1999/xhtml">, it applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1" xmlns:="http://www.w3.org/1999/xhtml">np.log()</span></strong><span class="koboSpan" id="kobo.350.1" xmlns:="http://www.w3.org/1999/xhtml"> under the hood to transform the selected variables. </span><span class="koboSpan" id="kobo.350.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1" xmlns:="http://www.w3.org/1999/xhtml">inverse_transform()</span></strong><span class="koboSpan" id="kobo.352.1" xmlns:="http://www.w3.org/1999/xhtml">, we reverted the transformed variables to their </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1" xmlns:="http://www.w3.org/1999/xhtml">original</span><a id="_idTextAnchor395"/><a id="_idTextAnchor396"/><span class="koboSpan" id="kobo.354.1" xmlns:="http://www.w3.org/1999/xhtml"> representations.</span></span></p>
<h2 id="_idParaDest-101"><a id="_idTextAnchor397"/><span class="koboSpan" id="kobo.355.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.356.1" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine has a</span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.357.1" xmlns:="http://www.w3.org/1999/xhtml"> dedicated</span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.358.1" xmlns:="http://www.w3.org/1999/xhtml"> transformer for adding a constant</span><a id="_idTextAnchor398"/><span class="koboSpan" id="kobo.359.1" xmlns:="http://www.w3.org/1999/xhtml"> value to variables that are not strictly positive, before applying the logarithm: </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1" xmlns:="http://www.w3.org/1999/xhtml">LogCpTransformer()</span></strong><span class="koboSpan" id="kobo.361.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.362.1" xmlns:="http://www.w3.org/1999/xhtml">LogCpTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.363.1" xmlns:="http://www.w3.org/1999/xhtml"> can:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.364.1" xmlns:="http://www.w3.org/1999/xhtml">Add the same constant to </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1" xmlns:="http://www.w3.org/1999/xhtml">all variables</span></span></li>
<li><span class="koboSpan" id="kobo.366.1" xmlns:="http://www.w3.org/1999/xhtml">Automatically identify and add the minimum value required to make the </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1" xmlns:="http://www.w3.org/1999/xhtml">variables positive</span></span></li>
<li><span class="koboSpan" id="kobo.368.1" xmlns:="http://www.w3.org/1999/xhtml">Add different values defined by the user to </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1" xmlns:="http://www.w3.org/1999/xhtml">different variables.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.370.1" xmlns:="http://www.w3.org/1999/xhtml">You can find a code implementation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.371.1" xmlns:="http://www.w3.org/1999/xhtml">LogCpTransformer()</span></strong><span class="koboSpan" id="kobo.372.1" xmlns:="http://www.w3.org/1999/xhtml"> in this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-Engineering-Cookbook-Third-Edition/blob/main/ch03-variable-transformation/Recipe-1-logarithmic-transformation.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.374.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-Engineering-Cookbook-Third-Edition/blob/main/ch03-variable-transformation/Recipe-1-logarithmic-t</span><span id="_idTextAnchor399"/><span id="_idTextAnchor400"/><span class="koboSpan" id="kobo.375.1" xmlns:="http://www.w3.org/1999/xhtml">ransformation.ipynb</span></span></a></p>
<h1 id="_idParaDest-102"><a id="_idTextAnchor401"/><span class="koboSpan" id="kobo.376.1" xmlns:="http://www.w3.org/1999/xhtml">Transforming variables with the reciprocal function</span></h1>
<p><span class="koboSpan" id="kobo.377.1" xmlns:="http://www.w3.org/1999/xhtml">The reciprocal function</span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.378.1" xmlns:="http://www.w3.org/1999/xhtml"> is defined as 1/x</span><a id="_idTextAnchor402"/><span class="koboSpan" id="kobo.379.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.379.2" xmlns:="http://www.w3.org/1999/xhtml">It is often useful when we have rati</span><a id="_idTextAnchor403"/><span class="koboSpan" id="kobo.380.1" xmlns:="http://www.w3.org/1999/xhtml">os – that is, values resulting from the division of two variables. </span><span class="koboSpan" id="kobo.380.2" xmlns:="http://www.w3.org/1999/xhtml">Examples of </span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.381.1" xmlns:="http://www.w3.org/1999/xhtml">this are </span><strong class="bold"><span class="koboSpan" id="kobo.382.1" xmlns:="http://www.w3.org/1999/xhtml">population density</span></strong><span class="koboSpan" id="kobo.383.1" xmlns:="http://www.w3.org/1999/xhtml"> – that is, people per area – and, as we will see in this recipe, </span><strong class="bold"><span class="koboSpan" id="kobo.384.1" xmlns:="http://www.w3.org/1999/xhtml">house occupancy</span></strong><span class="koboSpan" id="kobo.385.1" xmlns:="http://www.w3.org/1999/xhtml"> – that is, the</span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.386.1" xmlns:="http://www.w3.org/1999/xhtml"> number of occupants </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1" xmlns:="http://www.w3.org/1999/xhtml">per house.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1" xmlns:="http://www.w3.org/1999/xhtml">The reciprocal</span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.389.1" xmlns:="http://www.w3.org/1999/xhtml"> transformation is not defined for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.390.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.391.1" xmlns:="http://www.w3.org/1999/xhtml"> value, and although it is defined for negative values, it is mainly useful for transforming </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1" xmlns:="http://www.w3.org/1999/xhtml">positive variables.</span></span></p>
<p><span class="koboSpan" id="kobo.393.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will implement the reciprocal transformation using </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1" xmlns:="http://www.w3.org/1999/xhtml">NumPy</span></strong><span class="koboSpan" id="kobo.395.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.397.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.398.1" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine</span></strong><span class="koboSpan" id="kobo.399.1" xmlns:="http://www.w3.org/1999/xhtml">, and compare its effect on variable distribution using his</span><a id="_idTextAnchor404"/><a id="_idTextAnchor405"/><span class="koboSpan" id="kobo.400.1" xmlns:="http://www.w3.org/1999/xhtml">tograms and a </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plot</span><a id="_idTextAnchor406"/><span class="koboSpan" id="kobo.402.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-103"><a id="_idTextAnchor407"/><span class="koboSpan" id="kobo.403.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.404.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idTextAnchor408"/><span class="koboSpan" id="kobo.405.1" xmlns:="http://www.w3.org/1999/xhtml"> begin by </span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.406.1" xmlns:="http://www.w3.org/1999/xhtml">importing the libraries and getting the </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.408.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required Python libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.409.1" xmlns:="http://www.w3.org/1999/xhtml">and data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.410.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import scipy.stats as stats
from sklearn.datasets import fetch_california_housing</span></pre></li> <li><span class="koboSpan" id="kobo.411.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load</span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.412.1" xmlns:="http://www.w3.org/1999/xhtml"> the California </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1" xmlns:="http://www.w3.org/1999/xhtml">housing dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.414.1" xmlns:="http://www.w3.org/1999/xhtml">
X, y = fetch_california_housing(return_X_y=True,
    as_frame=True)</span></pre></li> <li><span class="koboSpan" id="kobo.415.1" xmlns:="http://www.w3.org/1999/xhtml">To evaluate variable distributions, we’ll create a function that takes a DataFrame and a variable name as inputs and plots a histogram next to a </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plot:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.417.1" xmlns:="http://www.w3.org/1999/xhtml">
def diagnostic_plots(df, variable):
    plt.figure(figsize=(15,6))
    plt.subplot(1, 2, 1)
    df[variable].hist(bins=30)
    plt.title(f"Histogram of {variable}")
    plt.subplot(1, 2, 2)
    stats.probplot(df[variable], dist="norm",
        plot=plt)
    plt.title(f"Q-Q plot of {variable}")
</span><a id="_idTextAnchor409"/><span class="koboSpan" id="kobo.418.1" xmlns:="http://www.w3.org/1999/xhtml">    plt.show()</span></pre></li> <li><span class="koboSpan" id="kobo.419.1" xmlns:="http://www.w3.org/1999/xhtml">Now, le</span><a id="_idTextAnchor410"/><span class="koboSpan" id="kobo.420.1" xmlns:="http://www.w3.org/1999/xhtml">t’s plot the distribution of the</span><a id="_idTextAnchor411"/> <strong class="source-inline"><span class="koboSpan" id="kobo.421.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.422.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, which specifies the average occupancy of </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1" xmlns:="http://www.w3.org/1999/xhtml">the house:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.424.1" xmlns:="http://www.w3.org/1999/xhtml">
diagnostic_plots(X, "AveOccup")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.425.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.427.1" xmlns:="http://www.w3.org/1999/xhtml"> variable </span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.428.1" xmlns:="http://www.w3.org/1999/xhtml">shows a very strong</span><a id="_idIndexMarker230"/><span class="koboSpan" id="kobo.429.1" xmlns:="http://www.w3.org/1999/xhtml"> right-skewed distribution, as show</span><a id="_idTextAnchor412"/><span class="koboSpan" id="kobo.430.1" xmlns:="http://www.w3.org/1999/xhtml">n in the </span><span class="No-Break"><span class="koboSpan" id="kobo.431.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.432.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.4 – A histogram and Q-Q plot of the AveOccup variable" src="image/B22396_03_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.433.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.4 – A histogram and Q-Q plot of the AveOccup variable</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.434.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.435.1" xmlns:="http://www.w3.org/1999/xhtml">Th</span><a id="_idTextAnchor413"/><span class="koboSpan" id="kobo.436.1" xmlns:="http://www.w3.org/1999/xhtml">e </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.438.1" xmlns:="http://www.w3.org/1999/xhtml"> variable</span><a id="_idIndexMarker231"/><span class="koboSpan" id="kobo.439.1" xmlns:="http://www.w3.org/1999/xhtml"> refers to the average number of household members – that is, the ratio between t</span><a id="_idTextAnchor414"/><span class="koboSpan" id="kobo.440.1" xmlns:="http://www.w3.org/1999/xhtml">he number of people and the nu</span><a id="_idTextAnchor415"/><span class="koboSpan" id="kobo.441.1" xmlns:="http://www.w3.org/1999/xhtml">mber of houses in a certain area. </span><span class="koboSpan" id="kobo.441.2" xmlns:="http://www.w3.org/1999/xhtml">This is a promising variable for a reciprocal transformation. </span><span class="koboSpan" id="kobo.441.3" xmlns:="http://www.w3.org/1999/xhtml">You can find more details about the variables and the dataset by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.442.1" xmlns:="http://www.w3.org/1999/xhtml">data = fetch_california_housing()</span></strong><span class="koboSpan" id="kobo.443.1" xmlns:="http://www.w3.org/1999/xhtml"> followed </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1" xmlns:="http://www.w3.org/1999/xhtml">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.445.1" xmlns:="http://www.w3.org/1999/xhtml">print(data.DESCR)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.446.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.447.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s apply the reciprocal transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1" xmlns:="http://www.w3.org/1999/xhtml">with NumPy.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.449.1" xmlns:="http://www.w3.org/1999/xhtml">First, let’s make a copy of the original DataFrame so that we can modify the values in</span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.450.1" xmlns:="http://www.w3.org/1999/xhtml"> the copy and not in the original one, which we will need for the rest of </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1" xmlns:="http://www.w3.org/1999/xhtml">this recipe:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.452.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = X.copy()</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.453.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.454.1" xmlns:="http://www.w3.org/1999/xhtml">Remember that executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.455.1" xmlns:="http://www.w3.org/1999/xhtml">X_tf = X</span></strong><span class="koboSpan" id="kobo.456.1" xmlns:="http://www.w3.org/1999/xhtml"> instead of using pandas’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1" xmlns:="http://www.w3.org/1999/xhtml">copy()</span></strong><span class="koboSpan" id="kobo.458.1" xmlns:="http://www.w3.org/1999/xhtml"> creates an additional view of the same data. </span><span class="koboSpan" id="kobo.458.2" xmlns:="http://www.w3.org/1999/xhtml">Therefore, changes that are made in </span><strong class="source-inline"><span class="koboSpan" id="kobo.459.1" xmlns:="http://www.w3.org/1999/xhtml">X_tf</span></strong><span class="koboSpan" id="kobo.460.1" xmlns:="http://www.w3.org/1999/xhtml"> will be r</span><a id="_idTextAnchor416"/><span class="koboSpan" id="kobo.461.1" xmlns:="http://www.w3.org/1999/xhtml">eflected in </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1" xmlns:="http://www.w3.org/1999/xhtml">X</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.463.1" xmlns:="http://www.w3.org/1999/xhtml">as well</span><a id="_idTextAnchor417"/><span class="koboSpan" id="kobo.464.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.465.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.466.1" xmlns:="http://www.w3.org/1999/xhtml"> apply the reciprocal transformation to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.467.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.468.1" xmlns:="http://www.w3.org/1999/xhtml"> variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.469.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf["AveOccup"] = np.reciprocal(X_tf["AveOccup"])</span></pre></li> <li><span class="koboSpan" id="kobo.470.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s check the distribution of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.471.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.472.1" xmlns:="http://www.w3.org/1999/xhtml"> variable after the transformation with the diagnostic function we created in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.473.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.474.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.475.1" xmlns:="http://www.w3.org/1999/xhtml">
diagnostic_plots(X_tf, "AveOccup")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.476.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.477.1" xmlns:="http://www.w3.org/1999/xhtml">After the transformation, </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.479.1" xmlns:="http://www.w3.org/1999/xhtml"> is now the ratio of the number of houses and the number of people in a certain area – in other words, houses </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1" xmlns:="http://www.w3.org/1999/xhtml">per citizen.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.481.1" xmlns:="http://www.w3.org/1999/xhtml">Here, we can see a dramatic change in the distribution of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.483.1" xmlns:="http://www.w3.org/1999/xhtml"> variable after th</span><a id="_idTextAnchor418"/><span class="koboSpan" id="kobo.484.1" xmlns:="http://www.w3.org/1999/xhtml">e </span><span class="No-Break"><span class="koboSpan" id="kobo.485.1" xmlns:="http://www.w3.org/1999/xhtml">reciprocal transformation:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.486.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.5 – A histogram and Q-Q plot of the AveOccup variable after the reciproc﻿al transfo﻿rmation" src="image/B22396_03_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.487.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.5 – A histogram and Q-Q plot of the AveOccup variable after the reciproc</span><a id="_idTextAnchor419"/><span class="koboSpan" id="kobo.488.1" xmlns:="http://www.w3.org/1999/xhtml">al transfo</span><a id="_idTextAnchor420"/><span class="koboSpan" id="kobo.489.1" xmlns:="http://www.w3.org/1999/xhtml">rmation</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.490.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s apply </span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.491.1" xmlns:="http://www.w3.org/1999/xhtml">the reciprocal transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.493.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.494.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.495.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1" xmlns:="http://www.w3.org/1999/xhtml">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.497.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.498.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.499.1" xmlns:="http://www.w3.org/1999/xhtml">
from sklearn.preprocessing import FunctionTransformer</span></pre></li> <li><span class="koboSpan" id="kobo.500.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the transformer by passing </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1" xmlns:="http://www.w3.org/1999/xhtml">np.reciprocal</span></strong><span class="koboSpan" id="kobo.502.1" xmlns:="http://www.w3.org/1999/xhtml"> as </span><span class="No-Break"><span class="koboSpan" id="kobo.503.1" xmlns:="http://www.w3.org/1999/xhtml">an argument:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.504.1" xmlns:="http://www.w3.org/1999/xhtml">
transformer = FunctionTransformer(np.reciprocal)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.505.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.506.1" xmlns:="http://www.w3.org/1999/xhtml">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.508.1" xmlns:="http://www.w3.org/1999/xhtml"> does not need to be fit before tran</span><a id="_idTextAnchor421"/><span class="koboSpan" id="kobo.509.1" xmlns:="http://www.w3.org/1999/xhtml">sforming </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1" xmlns:="http://www.w3.org/1999/xhtml">the data.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.511.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.512.1" xmlns:="http://www.w3.org/1999/xhtml">make a copy of the orig</span><a id="_idTextAnchor422"/><span class="koboSpan" id="kobo.513.1" xmlns:="http://www.w3.org/1999/xhtml">inal dataset and transform </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1" xmlns:="http://www.w3.org/1999/xhtml">the variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.515.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = X.copy()
X_tf["AveOccup"] = transformer.transform(
    X["AveOccup"])</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.516.1" xmlns:="http://www.w3.org/1999/xhtml">You can check the effect of the transformation using the function from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.517.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.518.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.519.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.520.1" xmlns:="http://www.w3.org/1999/xhtml">The inverse transformation of the reciprocal function is also the reciprocal function. </span><span class="koboSpan" id="kobo.520.2" xmlns:="http://www.w3.org/1999/xhtml">Hence, if you re-apply </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.522.1" xmlns:="http://www.w3.org/1999/xhtml"> to the transformed data, you will revert it to its original representation. </span><span class="koboSpan" id="kobo.522.2" xmlns:="http://www.w3.org/1999/xhtml">A better practice would be to set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1" xmlns:="http://www.w3.org/1999/xhtml">inverse_transform</span></strong><span class="koboSpan" id="kobo.524.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.526.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1" xmlns:="http://www.w3.org/1999/xhtml">np.reciprocal</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.528.1" xmlns:="http://www.w3.org/1999/xhtml">as well.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.529.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s apply</span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.530.1" xmlns:="http://www.w3.org/1999/xhtml"> the reciprocal transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.532.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.533.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.534.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><span class="No-Break"><span class="koboSpan" id="kobo.535.1" xmlns:="http://www.w3.org/1999/xhtml">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.536.1" xmlns:="http://www.w3.org/1999/xhtml">ReciprocalTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.537.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.538.1" xmlns:="http://www.w3.org/1999/xhtml">
from feature_engine.transformation import ReciprocalTransformer</span></pre></li> <li><span class="koboSpan" id="kobo.539.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the transformer to modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.540.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.541.1" xmlns:="http://www.w3.org/1999/xhtml"> variable and then fit it to </span><span class="No-Break"><span class="koboSpan" id="kobo.542.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.543.1" xmlns:="http://www.w3.org/1999/xhtml">
rt = ReciprocalTransformer(variables=»AveOccup»)
rt.fit(X)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.544.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.545.1" xmlns:="http://www.w3.org/1999/xhtml">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.547.1" xmlns:="http://www.w3.org/1999/xhtml"> argument is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.549.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer applies the reciprocal function to </span><em class="italic"><span class="koboSpan" id="kobo.550.1" xmlns:="http://www.w3.org/1999/xhtml">all the numerical variables</span></em><span class="koboSpan" id="kobo.551.1" xmlns:="http://www.w3.org/1999/xhtml"> in the dataset. </span><span class="koboSpan" id="kobo.551.2" xmlns:="http://www.w3.org/1999/xhtml">If some of the variables contain a </span><strong class="source-inline"><span class="koboSpan" id="kobo.552.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.553.1" xmlns:="http://www.w3.org/1999/xhtml"> value, the transfo</span><a id="_idTextAnchor423"/><span class="koboSpan" id="kobo.554.1" xmlns:="http://www.w3.org/1999/xhtml">rmer will rais</span><a id="_idTextAnchor424"/><span class="koboSpan" id="kobo.555.1" xmlns:="http://www.w3.org/1999/xhtml">e </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1" xmlns:="http://www.w3.org/1999/xhtml">an error.</span></span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.557.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.558.1" xmlns:="http://www.w3.org/1999/xhtml"> transform the selected variable in </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1" xmlns:="http://www.w3.org/1999/xhtml">our dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.560.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = rt.transform(X)</span></pre><p class="list-inset"><strong class="source-inline"><span class="koboSpan" id="kobo.561.1" xmlns:="http://www.w3.org/1999/xhtml">ReciprocalTransformer()</span></strong><span class="koboSpan" id="kobo.562.1" xmlns:="http://www.w3.org/1999/xhtml"> will return a new pandas DataFrame containing the original variables, where the variable indicated in </span><em class="italic"><span class="koboSpan" id="kobo.563.1" xmlns:="http://www.w3.org/1999/xhtml">step 12</span></em><span class="koboSpan" id="kobo.564.1" xmlns:="http://www.w3.org/1999/xhtml"> is transform</span><a id="_idTextAnchor425"/><a id="_idTextAnchor426"/><span class="koboSpan" id="kobo.565.1" xmlns:="http://www.w3.org/1999/xhtml">ed with the </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1" xmlns:="http://www.w3.org/1999/xhtml">reciprocal function.</span></span></p></li> </ol>
<h2 id="_idParaDest-104"><a id="_idTextAnchor427"/><span class="koboSpan" id="kobo.567.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.568.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we applied the reciprocal transformation using NumPy, scikit-learn, </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1" xmlns:="http://www.w3.org/1999/xhtml">and Feature-engine.</span></span></p>
<p><span class="koboSpan" id="kobo.570.1" xmlns:="http://www.w3.org/1999/xhtml">To evaluate the variable distribution, we used the function to plot a histogram next to a Q-Q plot that we described in the </span><em class="italic"><span class="koboSpan" id="kobo.571.1" xmlns:="http://www.w3.org/1999/xhtml">How it works…</span></em><span class="koboSpan" id="kobo.572.1" xmlns:="http://www.w3.org/1999/xhtml"> section of the </span><em class="italic"><span class="koboSpan" id="kobo.573.1" xmlns:="http://www.w3.org/1999/xhtml">Transforming variables with the logarithm function</span></em><span class="koboSpan" id="kobo.574.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe earlier in </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1" xmlns:="http://www.w3.org/1999/xhtml">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.576.1" xmlns:="http://www.w3.org/1999/xhtml">We plotted the histogram and Q-Q plot of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.577.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.578.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, which showed a heavy right-skewed distribution; most of its values were at the left of the histogram and they deviated from the 45-degree line toward the right end of the distribution in the </span><span class="No-Break"><span class="koboSpan" id="kobo.579.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plot.</span></span></p>
<p><span class="koboSpan" id="kobo.580.1" xmlns:="http://www.w3.org/1999/xhtml">To carry out the </span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.581.1" xmlns:="http://www.w3.org/1999/xhtml">reciprocal transformation, we applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.582.1" xmlns:="http://www.w3.org/1999/xhtml">np.reciprocal()</span></strong><span class="koboSpan" id="kobo.583.1" xmlns:="http://www.w3.org/1999/xhtml"> to the variable. </span><span class="koboSpan" id="kobo.583.2" xmlns:="http://www.w3.org/1999/xhtml">After the transformation, </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1" xmlns:="http://www.w3.org/1999/xhtml">AveOccup</span></strong><span class="koboSpan" id="kobo.585.1" xmlns:="http://www.w3.org/1999/xhtml">’s va</span><a id="_idTextAnchor428"/><span class="koboSpan" id="kobo.586.1" xmlns:="http://www.w3.org/1999/xhtml">lues were more evenly d</span><a id="_idTextAnchor429"/><span class="koboSpan" id="kobo.587.1" xmlns:="http://www.w3.org/1999/xhtml">istributed across the value range and followed the theoretical quantiles of the normal distribution in the Q-Q plot </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1" xmlns:="http://www.w3.org/1999/xhtml">more closely.</span></span></p>
<p><span class="koboSpan" id="kobo.589.1" xmlns:="http://www.w3.org/1999/xhtml">Next, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.590.1" xmlns:="http://www.w3.org/1999/xhtml">np.reciprocal()</span></strong><span class="koboSpan" id="kobo.591.1" xmlns:="http://www.w3.org/1999/xhtml"> with scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.592.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.593.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.593.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.594.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.595.1" xmlns:="http://www.w3.org/1999/xhtml"> method applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.596.1" xmlns:="http://www.w3.org/1999/xhtml">np.reciprocal()</span></strong><span class="koboSpan" id="kobo.597.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.598.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.599.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.600.1" xmlns:="http://www.w3.org/1999/xhtml">To restrict the effect of </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.602.1" xmlns:="http://www.w3.org/1999/xhtml"> to a group of variables, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.604.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.604.2" xmlns:="http://www.w3.org/1999/xhtml">To change the output to a pandas DataFrame, set the transform output </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1" xmlns:="http://www.w3.org/1999/xhtml">to pandas.</span></span></p>
<p><span class="koboSpan" id="kobo.606.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, we</span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.607.1" xmlns:="http://www.w3.org/1999/xhtml"> used Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.608.1" xmlns:="http://www.w3.org/1999/xhtml">ReciprocalTransformer()</span></strong><span class="koboSpan" id="kobo.609.1" xmlns:="http://www.w3.org/1999/xhtml"> to specifically modify one variable. </span><span class="koboSpan" id="kobo.609.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.610.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.611.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer checked that the variable was numerical. </span><span class="koboSpan" id="kobo.611.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.612.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.613.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.614.1" xmlns:="http://www.w3.org/1999/xhtml">np.reciprocal()</span></strong><span class="koboSpan" id="kobo.615.1" xmlns:="http://www.w3.org/1999/xhtml"> under the hood to transform </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1" xmlns:="http://www.w3.org/1999/xhtml">the variable.</span></span></p>
<p><span class="koboSpan" id="kobo.617.1" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.618.1" xmlns:="http://www.w3.org/1999/xhtml">ReciprocalTransformer()</span></strong><span class="koboSpan" id="kobo.619.1" xmlns:="http://www.w3.org/1999/xhtml"> provides functionality to revert the variable to its original representation out of the box via the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.620.1" xmlns:="http://www.w3.org/1999/xhtml">inverse_transform()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.621.1" xmlns:="http://www.w3.org/1999/xhtml"> method.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.622.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.623.1" xmlns:="http://www.w3.org/1999/xhtml">Using the transformers from scikit-learn or Feature-engine, instead of NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1" xmlns:="http://www.w3.org/1999/xhtml">reciprocal()</span></strong><span class="koboSpan" id="kobo.625.1" xmlns:="http://www.w3.org/1999/xhtml"> function, allows us to apply the reciprocal function as an additional step of a feature engineering pipeline within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1" xmlns:="http://www.w3.org/1999/xhtml">Pipeline</span></strong><span class="koboSpan" id="kobo.627.1" xmlns:="http://www.w3.org/1999/xhtml"> object </span><span class="No-Break"><span class="koboSpan" id="kobo.628.1" xmlns:="http://www.w3.org/1999/xhtml">from scikit-learn.</span></span></p>
<p><span class="koboSpan" id="kobo.629.1" xmlns:="http://www.w3.org/1999/xhtml">The difference </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.630.1" xmlns:="http://www.w3.org/1999/xhtml">between </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.632.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1" xmlns:="http://www.w3.org/1999/xhtml">ReciprocalTransformer()</span></strong><span class="koboSpan" id="kobo.634.1" xmlns:="http://www.w3.org/1999/xhtml"> is that the first one can apply any user-specified transformation, whereas the latter only applies the reciprocal function. </span><span class="koboSpan" id="kobo.634.2" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn returns NumPy arrays by default and transforms all variables in the dataset. </span><span class="koboSpan" id="kobo.634.3" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine’s transformer, on the other hand, returns pandas DataFrames and can modif</span><a id="_idTextAnchor430"/><span class="koboSpan" id="kobo.635.1" xmlns:="http://www.w3.org/1999/xhtml">y subsets of variables within the data</span><a id="_idTextAnchor431"/><a id="_idTextAnchor432"/><span class="koboSpan" id="kobo.636.1" xmlns:="http://www.w3.org/1999/xhtml"> without using </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1" xmlns:="http://www.w3.org/1999/xhtml">additional classes.</span></span></p>
<h1 id="_idParaDest-105"><a id="_idTextAnchor433"/><span class="koboSpan" id="kobo.638.1" xmlns:="http://www.w3.org/1999/xhtml">Using the square root to transform variables</span></h1>
<p><span class="koboSpan" id="kobo.639.1" xmlns:="http://www.w3.org/1999/xhtml">The</span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.640.1" xmlns:="http://www.w3.org/1999/xhtml"> square root transformation, </span><strong class="bold"><span class="koboSpan" id="kobo.641.1" xmlns:="http://www.w3.org/1999/xhtml">√x</span></strong><span class="koboSpan" id="kobo.642.1" xmlns:="http://www.w3.org/1999/xhtml">, as well as its variations, the Anscombe transformation, </span><strong class="bold"><span class="koboSpan" id="kobo.643.1" xmlns:="http://www.w3.org/1999/xhtml">√(x+3/8)</span></strong><span class="koboSpan" id="kobo.644.1" xmlns:="http://www.w3.org/1999/xhtml">, and the Freeman-Tukey transf</span><a id="_idTextAnchor434"/><span class="koboSpan" id="kobo.645.1" xmlns:="http://www.w3.org/1999/xhtml">ormation,  </span><strong class="bold"><span class="koboSpan" id="kobo.646.1" xmlns:="http://www.w3.org/1999/xhtml">√x + √(x+1)</span></strong><span class="koboSpan" id="kobo.647.1" xmlns:="http://www.w3.org/1999/xhtml">, are variance stabilizing transformations that transform a variable with a P</span><a id="_idTextAnchor435"/><span class="koboSpan" id="kobo.648.1" xmlns:="http://www.w3.org/1999/xhtml">oisson distribution into one with an approximately standard Gaussian distribution. </span><span class="koboSpan" id="kobo.648.2" xmlns:="http://www.w3.org/1999/xhtml">The square root transformation is a form of power transformation where the exponent is </span><strong class="bold"><span class="koboSpan" id="kobo.649.1" xmlns:="http://www.w3.org/1999/xhtml">1/2</span></strong><span class="koboSpan" id="kobo.650.1" xmlns:="http://www.w3.org/1999/xhtml"> and is only defined for </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1" xmlns:="http://www.w3.org/1999/xhtml">positive values.</span></span></p>
<p><span class="koboSpan" id="kobo.652.1" xmlns:="http://www.w3.org/1999/xhtml">The</span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.653.1" xmlns:="http://www.w3.org/1999/xhtml"> Poisson distribution is a probability distribution that indicates the number of times an event is likely to occur. </span><span class="koboSpan" id="kobo.653.2" xmlns:="http://www.w3.org/1999/xhtml">In other words, it is a count distribution. </span><span class="koboSpan" id="kobo.653.3" xmlns:="http://www.w3.org/1999/xhtml">It is right-skewed and its variance equals its mean. </span><span class="koboSpan" id="kobo.653.4" xmlns:="http://www.w3.org/1999/xhtml">Examples of variables that could follow a Poisson distribution are the number of financial items of a customer, such as the number of current accounts or credit cards, the number of passengers in a vehicle, and the number of occupants in </span><span class="No-Break"><span class="koboSpan" id="kobo.654.1" xmlns:="http://www.w3.org/1999/xhtml">a household.</span></span></p>
<p><span class="koboSpan" id="kobo.655.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will implement square root transformations using Num</span><a id="_idTextAnchor436"/><a id="_idTextAnchor437"/><span class="koboSpan" id="kobo.656.1" xmlns:="http://www.w3.org/1999/xhtml">Py, scikit-learn, </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1" xmlns:="http://www.w3.org/1999/xhtml">and Feature-engine.</span></span></p>
<h2 id="_idParaDest-106"><a id="_idTextAnchor438"/><span class="koboSpan" id="kobo.658.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.659.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll start </span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.660.1" xmlns:="http://www.w3.org/1999/xhtml">by creating a dataset with two variables whose values are drawn from a </span><span class="No-Break"><span class="koboSpan" id="kobo.661.1" xmlns:="http://www.w3.org/1999/xhtml">Poisson distribution:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.662.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing the </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1" xmlns:="http://www.w3.org/1999/xhtml">necessary libraries:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.664.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np import pandas as pd
import scipy.stats as stats</span></pre></li> <li><span class="koboSpan" id="kobo.665.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.666.1" xmlns:="http://www.w3.org/1999/xhtml">create a DataFrame with two variables drawn from a Poisson distribution with mean values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.667.1" xmlns:="http://www.w3.org/1999/xhtml">2</span></strong><span class="koboSpan" id="kobo.668.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.669.1" xmlns:="http://www.w3.org/1999/xhtml">3</span></strong><span class="koboSpan" id="kobo.670.1" xmlns:="http://www.w3.org/1999/xhtml">, respectively, and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.671.1" xmlns:="http://www.w3.org/1999/xhtml">10000</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.672.1" xmlns:="http://www.w3.org/1999/xhtml"> observations:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.673.1" xmlns:="http://www.w3.org/1999/xhtml">
df = pd.DataFrame()
df["counts1"] = stats.poisson.rvs(mu=3, size=10000)
df["counts2"] = stats.poisson.rvs(mu=2, size=10000)</span></pre></li> <li><span class="koboSpan" id="kobo.674.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a function that takes a </span><a id="_idTextAnchor439"/><span class="koboSpan" id="kobo.675.1" xmlns:="http://www.w3.org/1999/xhtml">DataFrame and a variab</span><a id="_idTextAnchor440"/><span class="koboSpan" id="kobo.676.1" xmlns:="http://www.w3.org/1999/xhtml">le name as inputs and plots a bar graph with the number of observations per value next to a </span><span class="No-Break"><span class="koboSpan" id="kobo.677.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plot:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.678.1" xmlns:="http://www.w3.org/1999/xhtml">
def diagnostic_plots(df, variable):
    plt.figure(figsize=(15,6))
    plt.subplot(1, 2, 1)
    df[variable].value_counts().sort_index(). </span><span class="koboSpan" id="kobo.678.2" xmlns:="http://www.w3.org/1999/xhtml">plot.bar()
    plt.title(f"Histogram of {variable}")
    plt.subplot(1, 2, 2)
    stats.probplot(df[variable], dist="norm",
        plot=plt)
    plt.title(f"Q-Q plot of {variable}")
    plt.show()</span></pre></li> <li><span class="koboSpan" id="kobo.679.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a bar plot and a Q-Q plot for one of the variables in the data using the function from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.680.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.681.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.682.1" xmlns:="http://www.w3.org/1999/xhtml">
diagnostic_plots(df, "counts1")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.683.1" xmlns:="http://www.w3.org/1999/xhtml">Here, we can see t</span><a id="_idTextAnchor441"/><span class="koboSpan" id="kobo.684.1" xmlns:="http://www.w3.org/1999/xhtml">he Poisson distribution in </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1" xmlns:="http://www.w3.org/1999/xhtml">the output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer048">
<span class="koboSpan" id="kobo.686.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.6 – The bar and Q-Q pl﻿ots of the counts1 variable" src="image/B22396_03_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.687.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.6 – The bar and Q-Q pl</span><a id="_idTextAnchor442"/><span class="koboSpan" id="kobo.688.1" xmlns:="http://www.w3.org/1999/xhtml">ots of the counts1 variable</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.689.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.690.1" xmlns:="http://www.w3.org/1999/xhtml">make a copy of </span><span class="No-Break"><span class="koboSpan" id="kobo.691.1" xmlns:="http://www.w3.org/1999/xhtml">the</span><a id="_idTextAnchor443"/><span class="koboSpan" id="kobo.692.1" xmlns:="http://www.w3.org/1999/xhtml"> dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.693.1" xmlns:="http://www.w3.org/1999/xhtml">
df_tf = df.copy()</span></pre></li> <li><span class="koboSpan" id="kobo.694.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s apply the</span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.695.1" xmlns:="http://www.w3.org/1999/xhtml"> square root transformation to </span><span class="No-Break"><span class="koboSpan" id="kobo.696.1" xmlns:="http://www.w3.org/1999/xhtml">both variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.697.1" xmlns:="http://www.w3.org/1999/xhtml">
df_tf[["counts1", "counts2"]] = np.sqrt(
    df[["counts1","counts2"]])</span></pre></li> <li><span class="koboSpan" id="kobo.698.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s round the values to two decimals for a </span><span class="No-Break"><span class="koboSpan" id="kobo.699.1" xmlns:="http://www.w3.org/1999/xhtml">nicer visualization:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.700.1" xmlns:="http://www.w3.org/1999/xhtml">
df_tf[["counts1", "counts2"]] = np.round(
    df_tf[["counts1", "counts2"]], 2)</span></pre></li> <li><span class="koboSpan" id="kobo.701.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s plot the distribution of </span><strong class="source-inline"><span class="koboSpan" id="kobo.702.1" xmlns:="http://www.w3.org/1999/xhtml">counts1</span></strong><span class="koboSpan" id="kobo.703.1" xmlns:="http://www.w3.org/1999/xhtml"> after </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1" xmlns:="http://www.w3.org/1999/xhtml">the transformation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.705.1" xmlns:="http://www.w3.org/1999/xhtml">
diagnostic_plots(df_tf, "counts1")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.706.1" xmlns:="http://www.w3.org/1999/xhtml">We see a more </span><strong class="bold"><span class="koboSpan" id="kobo.707.1" xmlns:="http://www.w3.org/1999/xhtml">stabilized</span></strong><span class="koboSpan" id="kobo.708.1" xmlns:="http://www.w3.org/1999/xhtml"> variance, as the dots in the Q-Q plot foll</span><a id="_idTextAnchor444"/><span class="koboSpan" id="kobo.709.1" xmlns:="http://www.w3.org/1999/xhtml">ow the 45-degree diagonal </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1" xmlns:="http://www.w3.org/1999/xhtml">more closely:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer049">
<span class="koboSpan" id="kobo.711.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.7 – The bar and Q-Q plots of the counts1 variable after th﻿e square root transformation" src="image/B22396_03_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.712.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.7 – The bar and Q-Q plots of the counts1 variable after th</span><a id="_idTextAnchor445"/><span class="koboSpan" id="kobo.713.1" xmlns:="http://www.w3.org/1999/xhtml">e square root transformation</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.714.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.715.1" xmlns:="http://www.w3.org/1999/xhtml">apply the square root</span><a id="_idTextAnchor446"/><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.716.1" xmlns:="http://www.w3.org/1999/xhtml"> transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.717.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.718.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.719.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.720.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><strong class="source-inline"><span class="koboSpan" id="kobo.721.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.722.1" xmlns:="http://www.w3.org/1999/xhtml"> and set up it to perform a square </span><span class="No-Break"><span class="koboSpan" id="kobo.723.1" xmlns:="http://www.w3.org/1999/xhtml">root transformation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.724.1" xmlns:="http://www.w3.org/1999/xhtml">
from sklearn.preprocessing import FunctionTransformer
transformer = FunctionTransformer(
    np.sqrt).set_output(transform="pandas")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.725.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.726.1" xmlns:="http://www.w3.org/1999/xhtml">If we wanted to round the values as we did in </span><em class="italic"><span class="koboSpan" id="kobo.727.1" xmlns:="http://www.w3.org/1999/xhtml">step 7</span></em><span class="koboSpan" id="kobo.728.1" xmlns:="http://www.w3.org/1999/xhtml">, we can set up the transformer using </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1" xmlns:="http://www.w3.org/1999/xhtml">transformer = FunctionTransformer(func=lambda x: </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.730.1" xmlns:="http://www.w3.org/1999/xhtml">np.round(np.sqrt(x), 2))</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.731.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.732.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s make a copy of the data and transform </span><span class="No-Break"><span class="koboSpan" id="kobo.733.1" xmlns:="http://www.w3.org/1999/xhtml">the variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.734.1" xmlns:="http://www.w3.org/1999/xhtml">
df_tf = df.copy()
df_tf = transformer.transform(df)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.735.1" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and check the result of the transformation as we did in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.736.1" xmlns:="http://www.w3.org/1999/xhtml">step 8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.737.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.738.1" xmlns:="http://www.w3.org/1999/xhtml">To apply</span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.739.1" xmlns:="http://www.w3.org/1999/xhtml"> the square root with Feature-engine instead, we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.740.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.741.1" xmlns:="http://www.w3.org/1999/xhtml"> with an exponent </span><span class="No-Break"><span class="koboSpan" id="kobo.742.1" xmlns:="http://www.w3.org/1999/xhtml">of 0.5:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.743.1" xmlns:="http://www.w3.org/1999/xhtml">from feature_engine.transformation import PowerTransformer
r</span><a id="_idTextAnchor447"/><span class="koboSpan" id="kobo.744.1" xmlns:="http://www.w3.org/1999/xhtml">oot_t = PowerTransformer(exp=1/2)</span></pre></li> <li><span class="koboSpan" id="kobo.745.1" xmlns:="http://www.w3.org/1999/xhtml">Next, we </span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.746.1" xmlns:="http://www.w3.org/1999/xhtml">fit the transformer to </span><span class="No-Break"><span class="koboSpan" id="kobo.747.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.748.1" xmlns:="http://www.w3.org/1999/xhtml">
root_t.fit(df)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.749.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.750.1" xmlns:="http://www.w3.org/1999/xhtml">The transformer automatically identifies the numerical variables, which we can explore by </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.752.1" xmlns:="http://www.w3.org/1999/xhtml">root_t.variables_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.753.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.754.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s transform </span><span class="No-Break"><span class="koboSpan" id="kobo.755.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.756.1" xmlns:="http://www.w3.org/1999/xhtml">
df_tf = root_t.transform(df)</span></pre><p class="list-inset"><strong class="source-inline"><span class="koboSpan" id="kobo.757.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.758.1" xmlns:="http://www.w3.org/1999/xhtml"> returns a panda</span><a id="_idTextAnchor448"/><a id="_idTextAnchor449"/><span class="koboSpan" id="kobo.759.1" xmlns:="http://www.w3.org/1999/xhtml">s DataFrame with the </span><span class="No-Break"><span class="koboSpan" id="kobo.760.1" xmlns:="http://www.w3.org/1999/xhtml">transformed variables.</span></span></p></li> </ol>
<h2 id="_idParaDest-107"><a id="_idTextAnchor450"/><span class="koboSpan" id="kobo.761.1" xmlns:="http://www.w3.org/1999/xhtml">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.762.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we applied the square root transformation using NumPy, scikit-learn, </span><span class="No-Break"><span class="koboSpan" id="kobo.763.1" xmlns:="http://www.w3.org/1999/xhtml">and Feature-engine.</span></span></p>
<p><span class="koboSpan" id="kobo.764.1" xmlns:="http://www.w3.org/1999/xhtml">We used NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.765.1" xmlns:="http://www.w3.org/1999/xhtml">sqrt()</span></strong><span class="koboSpan" id="kobo.766.1" xmlns:="http://www.w3.org/1999/xhtml"> function either directly or within scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.767.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTrasnformer()</span></strong><span class="koboSpan" id="kobo.768.1" xmlns:="http://www.w3.org/1999/xhtml"> to determine the variables’ square root. </span><span class="koboSpan" id="kobo.768.2" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, we used Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.769.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.770.1" xmlns:="http://www.w3.org/1999/xhtml">, setting the exponent to 0.5, that of the square root function. </span><span class="koboSpan" id="kobo.770.2" xmlns:="http://www.w3.org/1999/xhtml">NumPy modified the variables directly. </span><span class="koboSpan" id="kobo.770.3" xmlns:="http://www.w3.org/1999/xhtml">The transformers of scikit-learn and Feature-engine modified the var</span><a id="_idTextAnchor451"/><a id="_idTextAnchor452"/><span class="koboSpan" id="kobo.771.1" xmlns:="http://www.w3.org/1999/xhtml">iables when calling the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.772.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.773.1" xmlns:="http://www.w3.org/1999/xhtml"> method.</span></span></p>
<h1 id="_idParaDest-108"><a id="_idTextAnchor453"/><span class="koboSpan" id="kobo.774.1" xmlns:="http://www.w3.org/1999/xhtml">Using power transformations</span></h1>
<p><span class="koboSpan" id="kobo.775.1" xmlns:="http://www.w3.org/1999/xhtml">Power functions </span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.776.1" xmlns:="http://www.w3.org/1999/xhtml">are mathematical transformations that follow the </span><span class="koboSpan" id="kobo.777.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/15.png" style="vertical-align:-0.340em;height:1.088em;width:4.058em"/></span><span class="koboSpan" id="kobo.778.1" xmlns:="http://www.w3.org/1999/xhtml"> format, where lambda can take any value. </span><span class="koboSpan" id="kobo.778.2" xmlns:="http://www.w3.org/1999/xhtml">The square and</span><a id="_idTextAnchor454"/><span class="koboSpan" id="kobo.779.1" xmlns:="http://www.w3.org/1999/xhtml"> cube root transformations are special cases of power transformations where lambda is 1/2 or 1/3, respectively. </span><span class="koboSpan" id="kobo.779.2" xmlns:="http://www.w3.org/1999/xhtml">The challenge resides in finding the value for the lambda parameter. </span><span class="koboSpan" id="kobo.779.3" xmlns:="http://www.w3.org/1999/xhtml">The Box-Cox transformation, which</span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.780.1" xmlns:="http://www.w3.org/1999/xhtml"> is a generalization of the power transformations, finds the optimal lambda  value via maximum likelihood. </span><span class="koboSpan" id="kobo.780.2" xmlns:="http://www.w3.org/1999/xhtml">We will discuss the Box-Cox transformation in the following recipe. </span><span class="koboSpan" id="kobo.780.3" xmlns:="http://www.w3.org/1999/xhtml">In practice, we will try different lambda values and visually inspect the variable distribution to determine which one offers the best transformation. </span><span class="koboSpan" id="kobo.780.4" xmlns:="http://www.w3.org/1999/xhtml">In general, if the data is right-skewed – that is, if observations accumulate toward lower values – we use a lambda value that is smaller than 1, while if the data is left-skewed – that is, there are more observations around higher values – then we use a lambda value that is greater </span><span class="No-Break"><span class="koboSpan" id="kobo.781.1" xmlns:="http://www.w3.org/1999/xhtml">than 1.</span></span></p>
<p><span class="koboSpan" id="kobo.782.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will carry out power transformations u</span><a id="_idTextAnchor455"/><a id="_idTextAnchor456"/><span class="koboSpan" id="kobo.783.1" xmlns:="http://www.w3.org/1999/xhtml">sing NumPy, scikit-learn, </span><span class="No-Break"><span class="koboSpan" id="kobo.784.1" xmlns:="http://www.w3.org/1999/xhtml">an</span><a id="_idTextAnchor457"/><span class="koboSpan" id="kobo.785.1" xmlns:="http://www.w3.org/1999/xhtml">d Feature-engine.</span></span></p>
<h2 id="_idParaDest-109"><a id="_idTextAnchor458"/><span class="koboSpan" id="kobo.786.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.787.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing </span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.788.1" xmlns:="http://www.w3.org/1999/xhtml">the libraries and getting the </span><span class="No-Break"><span class="koboSpan" id="kobo.789.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.790.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required Python libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.792.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np
import pandas as pd
from sklearn.datasets import fetch_california_housing
from sklearn.preprocessing import FunctionTransformer
from feature_engine.transformation import PowerTransformer</span></pre></li> <li><span class="koboSpan" id="kobo.793.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the California housing dataset into a </span><span class="No-Break"><span class="koboSpan" id="kobo.794.1" xmlns:="http://www.w3.org/1999/xhtml">pandas DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.795.1" xmlns:="http://www.w3.org/1999/xhtml">
X, y = fetch_california_housing(
    return_X_y=True, as_frame=True)</span></pre></li> <li><span class="koboSpan" id="kobo.796.1" xmlns:="http://www.w3.org/1999/xhtml">To evaluate variable distributions, we’ll create a function that takes a DataFrame and a</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.797.1" xmlns:="http://www.w3.org/1999/xhtml"> variable name as inputs and plots a histogram next to a </span><span class="No-Break"><span class="koboSpan" id="kobo.798.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plot:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.799.1" xmlns:="http://www.w3.org/1999/xhtml">
def diagnostic_plots(df, variable):
    plt.figure(figsize=(15,6))
    plt.subplot(1, 2, 1)
    df[variable].hist(bins=30)
    plt.title(f"Histogram of {variable}")
    plt.subplot(1, 2, 2)
    stats.probplot(df[variable], dist="norm",
        plot=plt)
    plt.title(f"Q-Q</span><a id="_idTextAnchor459"/><span class="koboSpan" id="kobo.800.1" xmlns:="http://www.w3.org/1999/xhtml"> plot of {variable}")
    plt.show()</span></pre></li> <li><span class="koboSpan" id="kobo.801.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s plot the distribution of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.802.1" xmlns:="http://www.w3.org/1999/xhtml">Population</span></strong><span class="koboSpan" id="kobo.803.1" xmlns:="http://www.w3.org/1999/xhtml"> variable with the </span><span class="No-Break"><span class="koboSpan" id="kobo.804.1" xmlns:="http://www.w3.org/1999/xhtml">previous function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.805.1" xmlns:="http://www.w3.org/1999/xhtml">
diagnostic_plots(X, "Population")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.806.1" xmlns:="http://www.w3.org/1999/xhtml">In the plots returned by the previous command, we can see t</span><a id="_idTextAnchor460"/><span class="koboSpan" id="kobo.807.1" xmlns:="http://www.w3.org/1999/xhtml">hat </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1" xmlns:="http://www.w3.org/1999/xhtml">Population</span></strong><span class="koboSpan" id="kobo.809.1" xmlns:="http://www.w3.org/1999/xhtml"> is heavily skewed to </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1" xmlns:="http://www.w3.org/1999/xhtml">the right:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer051">
<span class="koboSpan" id="kobo.811.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.8 – A histogram and ﻿Q-Q plot of the Population variable" src="image/B22396_03_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.812.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.8 – A histogram and </span><a id="_idTextAnchor461"/><span class="koboSpan" id="kobo.813.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plot of the Population variable</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.814.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.815.1" xmlns:="http://www.w3.org/1999/xhtml">apply a power transformation to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.817.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.818.1" xmlns:="http://www.w3.org/1999/xhtml">Population</span></strong><span class="koboSpan" id="kobo.819.1" xmlns:="http://www.w3.org/1999/xhtml"> variables. </span><span class="koboSpan" id="kobo.819.2" xmlns:="http://www.w3.org/1999/xhtml">As both are skewed to the right, an exponent smaller than </span><em class="italic"><span class="koboSpan" id="kobo.820.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></em><span class="koboSpan" id="kobo.821.1" xmlns:="http://www.w3.org/1999/xhtml"> might return a better spread of the </span><span class="No-Break"><span class="koboSpan" id="kobo.822.1" xmlns:="http://www.w3.org/1999/xhtml">variable values.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.823.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s capture the variables to transform in </span><span class="No-Break"><span class="koboSpan" id="kobo.824.1" xmlns:="http://www.w3.org/1999/xhtml">a list:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.825.1" xmlns:="http://www.w3.org/1999/xhtml">
variables = ["MedInc", "Population"]</span></pre></li> <li><span class="koboSpan" id="kobo.826.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s make a copy of the DataFrame and then apply a power transformation to the variables from </span><em class="italic"><span class="koboSpan" id="kobo.827.1" xmlns:="http://www.w3.org/1999/xhtml">step 5,</span></em><span class="koboSpan" id="kobo.828.1" xmlns:="http://www.w3.org/1999/xhtml"> where the exponent </span><span class="No-Break"><span class="koboSpan" id="kobo.829.1" xmlns:="http://www.w3.org/1999/xhtml">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.830.1" xmlns:="http://www.w3.org/1999/xhtml">0.3</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.831.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.832.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = X.copy()
X_tf[variables] = np.power(X[variables], 0.3)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.833.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.834.1" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.835.1" xmlns:="http://www.w3.org/1999/xhtml">np.power()</span></strong><span class="koboSpan" id="kobo.836.1" xmlns:="http://www.w3.org/1999/xhtml">, we can apply any power transformation by changing the value of the exponent in the second position of </span><span class="No-Break"><span class="koboSpan" id="kobo.837.1" xmlns:="http://www.w3.org/1999/xhtml">the function.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.838.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s examine the change in the distribution </span><span class="No-Break"><span class="koboSpan" id="kobo.839.1" xmlns:="http://www.w3.org/1999/xhtml">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.840.1" xmlns:="http://www.w3.org/1999/xhtml">Population</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.841.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.842.1" xmlns:="http://www.w3.org/1999/xhtml">
diagnostic_plots(X_tf, "Population")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.843.1" xmlns:="http://www.w3.org/1999/xhtml">As shown in the plots returned by the previous command, </span><strong class="source-inline"><span class="koboSpan" id="kobo.844.1" xmlns:="http://www.w3.org/1999/xhtml">Population</span></strong><span class="koboSpan" id="kobo.845.1" xmlns:="http://www.w3.org/1999/xhtml"> is now more evenly distributed across the value range and follows the quan</span><a id="_idTextAnchor462"/><span class="koboSpan" id="kobo.846.1" xmlns:="http://www.w3.org/1999/xhtml">tiles of the normal distribution </span><span class="No-Break"><span class="koboSpan" id="kobo.847.1" xmlns:="http://www.w3.org/1999/xhtml">more closely:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer052">
<span class="koboSpan" id="kobo.848.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.9 – A histogram and Q-Q plot of the Populatio﻿n variable after the transformation" src="image/B22396_03_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.849.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.9 – A histogram and Q-Q plot of the Populatio</span><a id="_idTextAnchor463"/><span class="koboSpan" id="kobo.850.1" xmlns:="http://www.w3.org/1999/xhtml">n variable after the transformation</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.851.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s apply a</span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.852.1" xmlns:="http://www.w3.org/1999/xhtml"> power transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1" xmlns:="http://www.w3.org/1999/xhtml">with scikit-learn.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.854.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.855.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.856.1" xmlns:="http://www.w3.org/1999/xhtml"> with a power transformation with an exponent </span><span class="No-Break"><span class="koboSpan" id="kobo.857.1" xmlns:="http://www.w3.org/1999/xhtml">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.858.1" xmlns:="http://www.w3.org/1999/xhtml">0.3</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.859.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.860.1" xmlns:="http://www.w3.org/1999/xhtml">
transformer = FunctionTransformer(
    lambda x: np.power(x,0.3))</span></pre></li> <li><span class="koboSpan" id="kobo.861.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s make a copy of the DataFrame and transform the variables from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.862.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.863.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.864.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = X.copy()
X_tf[variables] = transformer.transform(X[variables])</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.865.1" xmlns:="http://www.w3.org/1999/xhtml">That’s it – we can now examine the variable distribution. </span><span class="koboSpan" id="kobo.865.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s perform an exponential transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.866.1" xmlns:="http://www.w3.org/1999/xhtml">with Feature-engine.</span></span></p></li> <li><span class="koboSpan" id="kobo.867.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.868.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.869.1" xmlns:="http://www.w3.org/1999/xhtml"> with an exponent of </span><strong class="source-inline"><span class="koboSpan" id="kobo.870.1" xmlns:="http://www.w3.org/1999/xhtml">0.3</span></strong><span class="koboSpan" id="kobo.871.1" xmlns:="http://www.w3.org/1999/xhtml"> to transform the variables from </span><em class="italic"><span class="koboSpan" id="kobo.872.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em><span class="koboSpan" id="kobo.873.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.873.2" xmlns:="http://www.w3.org/1999/xhtml">Then, we’ll fit it to </span><span class="No-Break"><span class="koboSpan" id="kobo.874.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.875.1" xmlns:="http://www.w3.org/1999/xhtml">
power_t = PowerTransformer(variables=variables,
    exp=0.3)
power_t.fit(X)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.876.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.877.1" xmlns:="http://www.w3.org/1999/xhtml">If we don’t define the variables to transform, </span><strong class="source-inline"><span class="koboSpan" id="kobo.878.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.879.1" xmlns:="http://www.w3.org/1999/xhtml"> will select and transform all of the numerical variables in </span><span class="No-Break"><span class="koboSpan" id="kobo.880.1" xmlns:="http://www.w3.org/1999/xhtml">the DataFrame.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.881.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s transform those </span><span class="No-Break"><span class="koboSpan" id="kobo.882.1" xmlns:="http://www.w3.org/1999/xhtml">two variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.883.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = power_t.transform(X)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.884.1" xmlns:="http://www.w3.org/1999/xhtml">The transformer </span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.885.1" xmlns:="http://www.w3.org/1999/xhtml">returns a DataFrame containing the original variables, where the two variables specified in</span><a id="_idTextAnchor464"/><a id="_idTextAnchor465"/> <em class="italic"><span class="koboSpan" id="kobo.886.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em><span class="koboSpan" id="kobo.887.1" xmlns:="http://www.w3.org/1999/xhtml"> are transformed with the </span><span class="No-Break"><span class="koboSpan" id="kobo.888.1" xmlns:="http://www.w3.org/1999/xhtml">po</span><a id="_idTextAnchor466"/><span class="koboSpan" id="kobo.889.1" xmlns:="http://www.w3.org/1999/xhtml">wer function.</span></span></p>
<h2 id="_idParaDest-110"><a id="_idTextAnchor467"/><span class="koboSpan" id="kobo.890.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.891.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we applied power transformations using NumPy, scikit-learn, </span><span class="No-Break"><span class="koboSpan" id="kobo.892.1" xmlns:="http://www.w3.org/1999/xhtml">and Feature-engine.</span></span></p>
<p><span class="koboSpan" id="kobo.893.1" xmlns:="http://www.w3.org/1999/xhtml">To apply power functions with NumPy, we applied the </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1" xmlns:="http://www.w3.org/1999/xhtml">power()</span></strong><span class="koboSpan" id="kobo.895.1" xmlns:="http://www.w3.org/1999/xhtml"> method to the slice of the dataset containing the variables to transform. </span><span class="koboSpan" id="kobo.895.2" xmlns:="http://www.w3.org/1999/xhtml">To apply this transformation with scikit-learn, we set up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.896.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.897.1" xmlns:="http://www.w3.org/1999/xhtml">with </span><strong class="source-inline"><span class="koboSpan" id="kobo.898.1" xmlns:="http://www.w3.org/1999/xhtml">np.power()</span></strong><span class="koboSpan" id="kobo.899.1" xmlns:="http://www.w3.org/1999/xhtml"> within a </span><strong class="source-inline"><span class="koboSpan" id="kobo.900.1" xmlns:="http://www.w3.org/1999/xhtml">lambda</span></strong><span class="koboSpan" id="kobo.901.1" xmlns:="http://www.w3.org/1999/xhtml"> function, using </span><strong class="source-inline"><span class="koboSpan" id="kobo.902.1" xmlns:="http://www.w3.org/1999/xhtml">0.</span><a id="_idTextAnchor468"/><span class="koboSpan" id="kobo.903.1" xmlns:="http://www.w3.org/1999/xhtml">3</span></strong><span class="koboSpan" id="kobo.904.1" xmlns:="http://www.w3.org/1999/xhtml"> as the exponent. </span><span class="koboSpan" id="kobo.904.2" xmlns:="http://www.w3.org/1999/xhtml">To apply power functions with Feature-engine, we set up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.905.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.906.1" xmlns:="http://www.w3.org/1999/xhtml"> with a list of the variables to transform and an exponent </span><span class="No-Break"><span class="koboSpan" id="kobo.907.1" xmlns:="http://www.w3.org/1999/xhtml">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.908.1" xmlns:="http://www.w3.org/1999/xhtml">0.3</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.909.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.910.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn and Feature-engine transformers applied the transformation when we called the </span><strong class="source-inline"><span class="koboSpan" id="kobo.911.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.912.1" xmlns:="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.912.2" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1" xmlns:="http://www.w3.org/1999/xhtml">FunctionTransformer()</span></strong><span class="koboSpan" id="kobo.914.1" xmlns:="http://www.w3.org/1999/xhtml"> modifies the entire dataset and returns NumPy arrays by default. </span><span class="koboSpan" id="kobo.914.2" xmlns:="http://www.w3.org/1999/xhtml">To return pandas DataFrames, we need to set the transform output to pandas, and to apply the transformation to specific variables, we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.915.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.916.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.916.2" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.917.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.918.1" xmlns:="http://www.w3.org/1999/xhtml">, on the other hand, can apply the transformation to a subset of variables out of </span><a id="_idTextAnchor469"/><a id="_idTextAnchor470"/><span class="koboSpan" id="kobo.919.1" xmlns:="http://www.w3.org/1999/xhtml">the box, returning pandas DataFrames </span><span class="No-Break"><span class="koboSpan" id="kobo.920.1" xmlns:="http://www.w3.org/1999/xhtml">by default</span><a id="_idTextAnchor471"/><span class="koboSpan" id="kobo.921.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-111"><a id="_idTextAnchor472"/><span class="koboSpan" id="kobo.922.1" xmlns:="http://www.w3.org/1999/xhtml">Performing Box-Cox transformations</span></h1>
<p><span class="koboSpan" id="kobo.923.1" xmlns:="http://www.w3.org/1999/xhtml">The Box-Cox transformation</span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.924.1" xmlns:="http://www.w3.org/1999/xhtml"> is a generalization of the power family of transformations and is defined </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1" xmlns:="http://www.w3.org/1999/xhtml">as follows:</span></span></p>
<p><span class="koboSpan" id="kobo.926.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;/msup&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;/mfrac&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;mo&gt;≠&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/16.png" style="vertical-align:-0.513em;height:1.807em;width:8.583em"/></span></p>
<p><span class="koboSpan" id="kobo.927.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mfenced open=&quot;(&quot; close=&quot;)&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mfenced&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/17.png" style="vertical-align:-0.307em;height:1.055em;width:8.136em"/></span></p>
<p><span class="koboSpan" id="kobo.928.1" xmlns:="http://www.w3.org/1999/xhtml">Here, </span><em class="italic"><span class="koboSpan" id="kobo.929.1" xmlns:="http://www.w3.org/1999/xhtml">y</span></em><span class="koboSpan" id="kobo.930.1" xmlns:="http://www.w3.org/1999/xhtml"> is the </span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.931.1" xmlns:="http://www.w3.org/1999/xhtml">variable and </span><em class="italic"><span class="koboSpan" id="kobo.932.1" xmlns:="http://www.w3.org/1999/xhtml">λ</span></em><span class="koboSpan" id="kobo.933.1" xmlns:="http://www.w3.org/1999/xhtml"> is the transformation parameter. </span><span class="koboSpan" id="kobo.933.2" xmlns:="http://www.w3.org/1999/xhtml">It includes important special cases of transformations, such as untransformed </span><em class="italic"><span class="koboSpan" id="kobo.934.1" xmlns:="http://www.w3.org/1999/xhtml">(λ = 1)</span></em><span class="koboSpan" id="kobo.935.1" xmlns:="http://www.w3.org/1999/xhtml">, the logarithm </span><em class="italic"><span class="koboSpan" id="kobo.936.1" xmlns:="http://www.w3.org/1999/xhtml">(λ = 0)</span></em><span class="koboSpan" id="kobo.937.1" xmlns:="http://www.w3.org/1999/xhtml">, the reciprocal </span><em class="italic"><span class="koboSpan" id="kobo.938.1" xmlns:="http://www.w3.org/1999/xhtml">(λ = - 1)</span></em><span class="koboSpan" id="kobo.939.1" xmlns:="http://www.w3.org/1999/xhtml">, the square root (when </span><em class="italic"><span class="koboSpan" id="kobo.940.1" xmlns:="http://www.w3.org/1999/xhtml">λ</span></em> <em class="italic"><span class="koboSpan" id="kobo.941.1" xmlns:="http://www.w3.org/1999/xhtml">= 0.5</span></em><span class="koboSpan" id="kobo.942.1" xmlns:="http://www.w3.org/1999/xhtml">, it applies a scaled and shifted version of the square root function), and the </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1" xmlns:="http://www.w3.org/1999/xhtml">cube root.</span></span></p>
<p><span class="koboSpan" id="kobo.944.1" xmlns:="http://www.w3.org/1999/xhtml">The Box-Cox transformation evaluates several values of </span><em class="italic"><span class="koboSpan" id="kobo.945.1" xmlns:="http://www.w3.org/1999/xhtml">λ</span></em><span class="koboSpan" id="kobo.946.1" xmlns:="http://www.w3.org/1999/xhtml"> using the maximum likelihood and selects the </span><em class="italic"><span class="koboSpan" id="kobo.947.1" xmlns:="http://www.w3.org/1999/xhtml">λ</span></em><span class="koboSpan" id="kobo.948.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter that returns the </span><span class="No-Break"><span class="koboSpan" id="kobo.949.1" xmlns:="http://www.w3.org/1999/xhtml">best transformation.</span></span></p>
<p><span class="koboSpan" id="kobo.950.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will perform the Box-Cox transformation using scikit-learn </span><span class="No-Break"><span class="koboSpan" id="kobo.951.1" xmlns:="http://www.w3.org/1999/xhtml">a</span><a id="_idTextAnchor473"/><span class="koboSpan" id="kobo.952.1" xmlns:="http://www.w3.org/1999/xhtml">nd Feature-engine.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.953.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.954.1" xmlns:="http://www.w3.org/1999/xhtml">The Box-Cox transformation can only be used on positive variables. </span><span class="koboSpan" id="kobo.954.2" xmlns:="http://www.w3.org/1999/xhtml">If your variables have negative values, try the Yeo-Johnson transformation, which is described in the next recipe, </span><em class="italic"><span class="koboSpan" id="kobo.955.1" xmlns:="http://www.w3.org/1999/xhtml">Performing Yeo-Johnson transformation</span></em><span class="koboSpan" id="kobo.956.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.956.2" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, you can shift the variable distributi</span><a id="_idTextAnchor474"/><a id="_idTextAnchor475"/><span class="koboSpan" id="kobo.957.1" xmlns:="http://www.w3.org/1999/xhtml">on by adding a constant befo</span><a id="_idTextAnchor476"/><span class="koboSpan" id="kobo.958.1" xmlns:="http://www.w3.org/1999/xhtml">re </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1" xmlns:="http://www.w3.org/1999/xhtml">the transformation.</span></span></p>
<h2 id="_idParaDest-112"><a id="_idTextAnchor477"/><span class="koboSpan" id="kobo.960.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.961.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing the necessary libraries and getting the </span><span class="No-Break"><span class="koboSpan" id="kobo.962.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.963.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required Python libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.964.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.965.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np
import pandas as pd
import scipy.stats as stats
from sklearn.datasets import fetch_california_housing
from sklearn.preprocessing import PowerTransformer
from feature_engine.transformation import BoxCoxTransformer</span></pre></li> <li><span class="koboSpan" id="kobo.966.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the California housing dataset into a </span><span class="No-Break"><span class="koboSpan" id="kobo.967.1" xmlns:="http://www.w3.org/1999/xhtml">pandas DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.968.1" xmlns:="http://www.w3.org/1999/xhtml">
X, y = fetch_california_housing(
    return_X_y=True, as_frame=True)</span></pre></li> <li><span class="koboSpan" id="kobo.969.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.970.1" xmlns:="http://www.w3.org/1999/xhtml"> drop the </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1" xmlns:="http://www.w3.org/1999/xhtml">Latitude</span></strong><span class="koboSpan" id="kobo.972.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.973.1" xmlns:="http://www.w3.org/1999/xhtml">Longitude</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.974.1" xmlns:="http://www.w3.org/1999/xhtml"> variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.975.1" xmlns:="http://www.w3.org/1999/xhtml">
X.drop(labels=["Latitude", "Longitude"], axis=1,
    inplace=True)</span></pre></li> <li><span class="koboSpan" id="kobo.976.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the variable distributions </span><span class="No-Break"><span class="koboSpan" id="kobo.977.1" xmlns:="http://www.w3.org/1999/xhtml">with histograms:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.978.1" xmlns:="http://www.w3.org/1999/xhtml">
X.hist(bins=30,</span><a id="_idTextAnchor478"/><span class="koboSpan" id="kobo.979.1" xmlns:="http://www.w3.org/1999/xhtml"> figsize=(12, 12), layout=(3, 3))
plt.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.980.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we can see that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.981.1" xmlns:="http://www.w3.org/1999/xhtml">MedInc</span></strong><span class="koboSpan" id="kobo.982.1" xmlns:="http://www.w3.org/1999/xhtml"> variable shows a mild right-skewed distribution, variables such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.983.1" xmlns:="http://www.w3.org/1999/xhtml">AveRooms</span></strong><span class="koboSpan" id="kobo.984.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.985.1" xmlns:="http://www.w3.org/1999/xhtml">Population</span></strong><span class="koboSpan" id="kobo.986.1" xmlns:="http://www.w3.org/1999/xhtml"> are heavily right-skewed, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.987.1" xmlns:="http://www.w3.org/1999/xhtml">HouseAge</span></strong><span class="koboSpan" id="kobo.988.1" xmlns:="http://www.w3.org/1999/xhtml"> variabl</span><a id="_idTextAnchor479"/><span class="koboSpan" id="kobo.989.1" xmlns:="http://www.w3.org/1999/xhtml">e shows an even spread of values across </span><span class="No-Break"><span class="koboSpan" id="kobo.990.1" xmlns:="http://www.w3.org/1999/xhtml">its range:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer055">
<span class="koboSpan" id="kobo.991.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.10 – Histograms of the numerical variables" src="image/B22396_03_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.992.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.10 – Histograms of the numerical variables</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.993.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker261"/><span class="koboSpan" id="kobo.994.1" xmlns:="http://www.w3.org/1999/xhtml"> capture the variable names in a list since we will use these in the </span><span class="No-Break"><span class="koboSpan" id="kobo.995.1" xmlns:="http://www.w3.org/1999/xhtml">follo</span><a id="_idTextAnchor480"/><span class="koboSpan" id="kobo.996.1" xmlns:="http://www.w3.org/1999/xhtml">wing step:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.997.1" xmlns:="http://www.w3.org/1999/xhtml">
variables = list(X.columns)</span></pre></li> <li><span class="koboSpan" id="kobo.998.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a function that will plot Q-Q plots for all the variables in the data in two rows with three </span><span class="No-Break"><span class="koboSpan" id="kobo.999.1" xmlns:="http://www.w3.org/1999/xhtml">plots each:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1000.1" xmlns:="http://www.w3.org/1999/xhtml">
def make_qqplot(df):
    plt.figure(figsize=(10, 6),
        constrained_layout=True)
    for i in range(6):
        # location in figure
        ax = plt.subplot(2, 3, i + 1)
        # variable to plot
        var = variables[i]
        # q-q plot
        stats.probplot((df[var]), dist="norm",
            plot=plt)
        # add variable name as title
        ax.set_title(var)
    plt.show()</span></pre></li> <li><span class="koboSpan" id="kobo.1001.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s display the Q-Q plots using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1002.1" xmlns:="http://www.w3.org/1999/xhtml">preceding function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1003.1" xmlns:="http://www.w3.org/1999/xhtml">
m</span><a id="_idTextAnchor481"/><span class="koboSpan" id="kobo.1004.1" xmlns:="http://www.w3.org/1999/xhtml">ake_qqplot(X)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1005.1" xmlns:="http://www.w3.org/1999/xhtml">By looking </span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.1006.1" xmlns:="http://www.w3.org/1999/xhtml">at the following plots, we can corrobora</span><a id="_idTextAnchor482"/><span class="koboSpan" id="kobo.1007.1" xmlns:="http://www.w3.org/1999/xhtml">te that the variables are not </span><span class="No-Break"><span class="koboSpan" id="kobo.1008.1" xmlns:="http://www.w3.org/1999/xhtml">normally distributed:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer056">
<span class="koboSpan" id="kobo.1009.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.11 – Q-Q plots of the numerical variables" src="image/B22396_03_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1010.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.11 – Q-Q plots of the numerical variables</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1011.1" xmlns:="http://www.w3.org/1999/xhtml">Next, let’s carry</span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.1012.1" xmlns:="http://www.w3.org/1999/xhtml"> out the Box-Cox transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.1013.1" xmlns:="http://www.w3.org/1999/xhtml">using scikit-learn.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.1014.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1015.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1016.1" xmlns:="http://www.w3.org/1999/xhtml"> to apply the Box-Cox transformation and fit it to the data so that it finds the optimal </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1017.1" xmlns:="http://www.w3.org/1999/xhtml">λ</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1018.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1019.1" xmlns:="http://www.w3.org/1999/xhtml">
transformer = PowerTransformer(
    method="box-cox", standardize=False,
).set_output(transform="pandas")
transformer.fit(X)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1020.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1021.1" xmlns:="http://www.w3.org/1999/xhtml">To avoid data leakage, the </span><em class="italic"><span class="koboSpan" id="kobo.1022.1" xmlns:="http://www.w3.org/1999/xhtml">λ</span></em><span class="koboSpan" id="kobo.1023.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter should be learned from the train set and then used to transform the train and test sets. </span><span class="koboSpan" id="kobo.1023.2" xmlns:="http://www.w3.org/1999/xhtml">Thus, remember to split your data into train and tes</span><a id="_idTextAnchor483"/><span class="koboSpan" id="kobo.1024.1" xmlns:="http://www.w3.org/1999/xhtml">t sets before </span><span class="No-Break"><span class="koboSpan" id="kobo.1025.1" xmlns:="http://www.w3.org/1999/xhtml">fitting </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1026.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1027.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.1028.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s transform </span><span class="No-Break"><span class="koboSpan" id="kobo.1029.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1030.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = transformer.transform(X)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1031.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1032.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1033.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1034.1" xmlns:="http://www.w3.org/1999/xhtml"> stores the learned lambdas in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.1035.1" xmlns:="http://www.w3.org/1999/xhtml">lambdas_</span></strong><span class="koboSpan" id="kobo.1036.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute, which you can display by </span><span class="No-Break"><span class="koboSpan" id="kobo.1037.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1038.1" xmlns:="http://www.w3.org/1999/xhtml">transformer.lambdas_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1039.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.1040.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the distributions of the transformed data </span><span class="No-Break"><span class="koboSpan" id="kobo.1041.1" xmlns:="http://www.w3.org/1999/xhtml">with histograms:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1042.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf.hist(bins=30</span><a id="_idTextAnchor484"/><span class="koboSpan" id="kobo.1043.1" xmlns:="http://www.w3.org/1999/xhtml">, figsize=(12, 12), layout=(3, 3))
plt.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1044.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we can see that the variables’</span><a id="_idTextAnchor485"/><span class="koboSpan" id="kobo.1045.1" xmlns:="http://www.w3.org/1999/xhtml"> values are more evenly spread across </span><span class="No-Break"><span class="koboSpan" id="kobo.1046.1" xmlns:="http://www.w3.org/1999/xhtml">their ranges:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer057">
<span class="koboSpan" id="kobo.1047.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.12 – Histograms of the variables after the transformation" src="image/B22396_03_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1048.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.12 – Histograms of the variables after the transformation</span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.1049.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s return </span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.1050.1" xmlns:="http://www.w3.org/1999/xhtml">Q-Q plots of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1051.1" xmlns:="http://www.w3.org/1999/xhtml">transformed variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1052.1" xmlns:="http://www.w3.org/1999/xhtml">
make_qqplot(X_tf)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1053.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we can see that, after the transformation, the variables follo</span><a id="_idTextAnchor486"/><span class="koboSpan" id="kobo.1054.1" xmlns:="http://www.w3.org/1999/xhtml">w the theoretical normal distribution </span><span class="No-Break"><span class="koboSpan" id="kobo.1055.1" xmlns:="http://www.w3.org/1999/xhtml">more closely:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer058">
<span class="koboSpan" id="kobo.1056.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.13 – Q-Q plots o﻿f the variables after the transformation" src="image/B22396_03_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1057.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.13 – Q-Q plots o</span><a id="_idTextAnchor487"/><span class="koboSpan" id="kobo.1058.1" xmlns:="http://www.w3.org/1999/xhtml">f the variables after the transformation</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1059.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s</span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.1060.1" xmlns:="http://www.w3.org/1999/xhtml"> implement the Box-Cox transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.1061.1" xmlns:="http://www.w3.org/1999/xhtml">with Feature-engine.</span></span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.1062.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1063.1" xmlns:="http://www.w3.org/1999/xhtml">BoxCoxTransformer()</span></strong><span class="koboSpan" id="kobo.1064.1" xmlns:="http://www.w3.org/1999/xhtml"> to transform all the variables in the dataset and then fit it to </span><span class="No-Break"><span class="koboSpan" id="kobo.1065.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1066.1" xmlns:="http://www.w3.org/1999/xhtml">
bct = BoxCoxTransformer()
bct.fit(X)</span></pre></li> <li><span class="koboSpan" id="kobo.1067.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s go ahead and transform </span><span class="No-Break"><span class="koboSpan" id="kobo.1068.1" xmlns:="http://www.w3.org/1999/xhtml">the variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1069.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = bct.transform(X)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1070.1" xmlns:="http://www.w3.org/1999/xhtml">The transformation returns a pandas DataFrame containing </span><a id="_idTextAnchor488"/><span class="koboSpan" id="kobo.1071.1" xmlns:="http://www.w3.org/1999/xhtml">the </span><span class="No-Break"><span class="koboSpan" id="kobo.1072.1" xmlns:="http://www.w3.org/1999/xhtml">modified variables.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1073.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span><a id="_idTextAnchor489"/></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1075.1" xmlns:="http://www.w3.org/1999/xhtml"> from scikit-learn will transform the entire dataset. </span><span class="koboSpan" id="kobo.1075.2" xmlns:="http://www.w3.org/1999/xhtml">On the other hand, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1076.1" xmlns:="http://www.w3.org/1999/xhtml">BoxCoxTransformer()</span></strong><span class="koboSpan" id="kobo.1077.1" xmlns:="http://www.w3.org/1999/xhtml"> from Feature-engine can modify a subset of the variables, if we pass their names in a list to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1079.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter when setting up the transformer. </span><span class="koboSpan" id="kobo.1079.2" xmlns:="http://www.w3.org/1999/xhtml">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1080.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1081.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1082.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1083.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer will transform all numerical variables seen </span><span class="No-Break"><span class="koboSpan" id="kobo.1084.1" xmlns:="http://www.w3.org/1999/xhtml">during </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1085.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1086.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.1087.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><a id="_idIndexMarker266"/><span class="koboSpan" id="kobo.1088.1" xmlns:="http://www.w3.org/1999/xhtml">optimal lambdas for the Box-Cox transformation are stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1" xmlns:="http://www.w3.org/1999/xhtml">lambda_dict_</span></strong><span class="koboSpan" id="kobo.1090.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.1090.2" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1091.1" xmlns:="http://www.w3.org/1999/xhtml">inspect them:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1092.1" xmlns:="http://www.w3.org/1999/xhtml">
bct.lambda_dict_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1093.1" xmlns:="http://www.w3.org/1999/xhtml">The output of the previous command is </span><span class="No-Break"><span class="koboSpan" id="kobo.1094.1" xmlns:="http://www.w3.org/1999/xhtml">the following:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1095.1" xmlns:="http://www.w3.org/1999/xhtml">{'MedInc': 0.09085449361507383,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1096.1" xmlns:="http://www.w3.org/1999/xhtml">'HouseAge': 0.8093980940712507,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1097.1" xmlns:="http://www.w3.org/1999/xhtml">'AveRooms': -0.2980048976549959,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1098.1" xmlns:="http://www.w3.org/1999/xhtml">'AveBedrms': -1.6290002625859639,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1099.1" xmlns:="http://www.w3.org/1999/xhtml">'Population': 0.235767</span><a id="_idTextAnchor490"/><span class="koboSpan" id="kobo.1100.1" xmlns:="http://www.w3.org/1999/xhtml">57812051324,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1101.1" xmlns:="http://www.w3.org/1999/xhtml">'AveOccup': -0.4763032278973292}</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1102.1" xmlns:="http://www.w3.org/1999/xhtml">Now you know how to implement the Box-Co</span><a id="_idTextAnchor491"/><a id="_idTextAnchor492"/><span class="koboSpan" id="kobo.1103.1" xmlns:="http://www.w3.org/1999/xhtml">x transformation with two different </span><span class="No-Break"><span class="koboSpan" id="kobo.1104.1" xmlns:="http://www.w3.org/1999/xhtml">Python libraries.</span></span></p>
<h2 id="_idParaDest-113"><a id="_idTextAnchor493"/><span class="koboSpan" id="kobo.1105.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1106.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1108.1" xmlns:="http://www.w3.org/1999/xhtml"> can apply both Box-Cox and Yeo-Johnson transformations, so we specified the transformation when setting up the transformer by passing the b</span><strong class="source-inline"><span class="koboSpan" id="kobo.1109.1" xmlns:="http://www.w3.org/1999/xhtml">ox-cox</span></strong><span class="koboSpan" id="kobo.1110.1" xmlns:="http://www.w3.org/1999/xhtml"> string. </span><span class="koboSpan" id="kobo.1110.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we fit the transformer to the data so that the transformer learned the optimal lambdas for each variable. </span><span class="koboSpan" id="kobo.1110.3" xmlns:="http://www.w3.org/1999/xhtml">The learned lambdas were stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1111.1" xmlns:="http://www.w3.org/1999/xhtml">lambdas_</span></strong><span class="koboSpan" id="kobo.1112.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.1112.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1113.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1114.1" xmlns:="http://www.w3.org/1999/xhtml"> method to transform </span><span class="No-Break"><span class="koboSpan" id="kobo.1115.1" xmlns:="http://www.w3.org/1999/xhtml">the variables.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1116.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1117.1" xmlns:="http://www.w3.org/1999/xhtml">Remember that to return DataFrames instead of arrays, you need to specify the transform output through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1118.1" xmlns:="http://www.w3.org/1999/xhtml">set_output()</span></strong><span class="koboSpan" id="kobo.1119.1" xmlns:="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.1119.2" xmlns:="http://www.w3.org/1999/xhtml">You can apply the transformation to a subset of values by using </span><span class="No-Break"><span class="koboSpan" id="kobo.1120.1" xmlns:="http://www.w3.org/1999/xhtml">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1121.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1122.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1123.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, we applied the Box-Cox transformation using Feature-engine. </span><span class="koboSpan" id="kobo.1123.2" xmlns:="http://www.w3.org/1999/xhtml">We initialized </span><strong class="source-inline"><span class="koboSpan" id="kobo.1124.1" xmlns:="http://www.w3.org/1999/xhtml">BoxCoxTransformer()</span></strong><span class="koboSpan" id="kobo.1125.1" xmlns:="http://www.w3.org/1999/xhtml">, leaving</span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.1126.1" xmlns:="http://www.w3.org/1999/xhtml"> the parameter </span><strong class="source-inline"><span class="koboSpan" id="kobo.1127.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1128.1" xmlns:="http://www.w3.org/1999/xhtml"> set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1130.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1130.2" xmlns:="http://www.w3.org/1999/xhtml">Due to this, the transformer automatically found the numerical variables in the data during </span><strong class="source-inline"><span class="koboSpan" id="kobo.1131.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1132.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1132.2" xmlns:="http://www.w3.org/1999/xhtml">We fit the transformer to the data so that it learned the optimal lambdas per variable, which were stored in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1133.1" xmlns:="http://www.w3.org/1999/xhtml">lambda_dict_</span></strong><span class="koboSpan" id="kobo.1134.1" xmlns:="http://www.w3.org/1999/xhtml">, and transformed the variables using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1135.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1136.1" xmlns:="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.1136.2" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1137.1" xmlns:="http://www.w3.org/1999/xhtml">BoxCoxTransformer()</span></strong><span class="koboSpan" id="kobo.1138.1" xmlns:="http://www.w3.org/1999/xhtml"> can take the entire DataFrame a</span><a id="_idTextAnchor494"/><a id="_idTextAnchor495"/><span class="koboSpan" id="kobo.1139.1" xmlns:="http://www.w3.org/1999/xhtml">s input and it yet mo</span><a id="_idTextAnchor496"/><span class="koboSpan" id="kobo.1140.1" xmlns:="http://www.w3.org/1999/xhtml">dify only the </span><span class="No-Break"><span class="koboSpan" id="kobo.1141.1" xmlns:="http://www.w3.org/1999/xhtml">selected variables.</span></span></p>
<h2 id="_idParaDest-114"><a id="_idTextAnchor497"/><span class="koboSpan" id="kobo.1142.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.1143.1" xmlns:="http://www.w3.org/1999/xhtml">We can apply the Box-Cox transformation with the SciPy library. </span><span class="koboSpan" id="kobo.1143.2" xmlns:="http://www.w3.org/1999/xhtml">For a code implementation, visit this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.1144.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-Engineering-Cookbook-Third-Edition/blob/main/ch03-variable-transformation/Recipe-5-Box-Cox-transformation.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.1145.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-Engineering-Cookbook-Third-Edition/blob/main/ch03-variabl</span><span id="_idTextAnchor498"/><span id="_idTextAnchor499"/><span class="koboSpan" id="kobo.1146.1" xmlns:="http://www.w3.org/1999/xhtml">e-transformation/Recipe-5-Box-Cox-transformation.ipynb</span></span></a></p>
<h1 id="_idParaDest-115"><a id="_idTextAnchor500"/><span class="koboSpan" id="kobo.1147.1" xmlns:="http://www.w3.org/1999/xhtml">Performing Yeo-Johnson transformations</span></h1>
<p><span class="koboSpan" id="kobo.1148.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><a id="_idIndexMarker268"/><span class="koboSpan" id="kobo.1149.1" xmlns:="http://www.w3.org/1999/xhtml">Yeo-Johnson transformation is an extension of the Box-Cox transformation that is no longer constrained to positive values. </span><span class="koboSpan" id="kobo.1149.2" xmlns:="http://www.w3.org/1999/xhtml">In other words, the Yeo-Johnson transformation can be used on variables with zero and negative values, as well as positive values. </span><span class="koboSpan" id="kobo.1149.3" xmlns:="http://www.w3.org/1999/xhtml">These transformations are defined </span><span class="No-Break"><span class="koboSpan" id="kobo.1150.1" xmlns:="http://www.w3.org/1999/xhtml">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1151.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:mfrac&gt;&lt;mml:mrow&gt;&lt;mml:msup&gt;&lt;mml:mrow&gt;&lt;mml:mo&gt;(&lt;/mml:mo&gt;&lt;mml:mi&gt;X&lt;/mml:mi&gt;&lt;mml:mo&gt;+&lt;/mml:mo&gt;&lt;mml:mn&gt;1&lt;/mml:mn&gt;&lt;mml:mo&gt;)&lt;/mml:mo&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;λ&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:msup&gt;&lt;mml:mo&gt;-&lt;/mml:mo&gt;&lt;mml:mn&gt;1&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;λ&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;/mml:mfrac&gt;&lt;/mml:math&gt;" src="image/18.png" style="vertical-align:-0.218em;height:1.059em;width:2.791em"/></span><span class="koboSpan" id="kobo.1152.1" xmlns:="http://www.w3.org/1999/xhtml">; if λ ≠ 0 and X &gt;= 0</span></li>
<li><span class="koboSpan" id="kobo.1153.1" xmlns:="http://www.w3.org/1999/xhtml">ln(X + 1 ); if λ = 0 and X &gt;= 0</span></li>
<li><span class="koboSpan" id="kobo.1154.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mstyle scriptlevel=&quot;+1&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" src="image/19.png" style="vertical-align:-0.218em;height:1.059em;width:4.268em"/></span><span class="koboSpan" id="kobo.1155.1" xmlns:="http://www.w3.org/1999/xhtml">; if λ ≠ 2 and X &lt; 0</span></li>
<li><span class="koboSpan" id="kobo.1156.1" xmlns:="http://www.w3.org/1999/xhtml">-ln(-X + 1); if λ = 2 and X &lt; 0</span></li>
</ul>
<p><span class="koboSpan" id="kobo.1157.1" xmlns:="http://www.w3.org/1999/xhtml">When the </span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.1158.1" xmlns:="http://www.w3.org/1999/xhtml">variable has only positive values, then the Yeo-Johnson transformation is like the Box-Cox transformation of the variable plus one. </span><span class="koboSpan" id="kobo.1158.2" xmlns:="http://www.w3.org/1999/xhtml">If the variable has only negative values, then the Yeo-Johnson transformation is like the Box-Cox transformation of the negative of the variable plus one, at the power of </span><em class="italic"><span class="koboSpan" id="kobo.1159.1" xmlns:="http://www.w3.org/1999/xhtml">2- λ</span></em><span class="koboSpan" id="kobo.1160.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1160.2" xmlns:="http://www.w3.org/1999/xhtml">If the variable has a mix of positive and negative values, the Yeo-Johnson transformation applies different powers to the positive and </span><span class="No-Break"><span class="koboSpan" id="kobo.1161.1" xmlns:="http://www.w3.org/1999/xhtml">negative values.</span></span></p>
<p><span class="koboSpan" id="kobo.1162.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will perform the Yeo-Johns</span><a id="_idTextAnchor501"/><span class="koboSpan" id="kobo.1163.1" xmlns:="http://www.w3.org/1999/xhtml">on transfo</span><a id="_idTextAnchor502"/><span class="koboSpan" id="kobo.1164.1" xmlns:="http://www.w3.org/1999/xhtml">rmation using scik</span><a id="_idTextAnchor503"/><span class="koboSpan" id="kobo.1165.1" xmlns:="http://www.w3.org/1999/xhtml">it-learn </span><span class="No-Break"><span class="koboSpan" id="kobo.1166.1" xmlns:="http://www.w3.org/1999/xhtml">and Feature-engine.</span></span></p>
<h2 id="_idParaDest-116"><a id="_idTextAnchor504"/><span class="koboSpan" id="kobo.1167.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1168.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin</span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.1169.1" xmlns:="http://www.w3.org/1999/xhtml"> by importing the necessary libraries and getting the </span><span class="No-Break"><span class="koboSpan" id="kobo.1170.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1171.1" xmlns:="http://www.w3.org/1999/xhtml">Import the required Python libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.1172.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1173.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np import pandas as pd
import scipy.stats as stats
from sklearn.datasets import fetch_california_housing
from sklearn.preprocessing import PowerTransformer
from feature_engine.transformation import YeoJohnsonTransformer</span></pre></li> <li><span class="koboSpan" id="kobo.1174.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the California housing dataset into a pandas DataFrame and then drop the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1175.1" xmlns:="http://www.w3.org/1999/xhtml">Latitude</span></strong><span class="koboSpan" id="kobo.1176.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1" xmlns:="http://www.w3.org/1999/xhtml">Longitude</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1178.1" xmlns:="http://www.w3.org/1999/xhtml"> variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1179.1" xmlns:="http://www.w3.org/1999/xhtml">
X, y = fetch_california_housing(
    return_X_y=True, as_frame=True)
X.drop(labels=[«Latitude», «Longitude»], axis=1,
    inplace=True)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1180.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1181.1" xmlns:="http://www.w3.org/1999/xhtml">We can evaluate the variable distribution with histograms and Q-Q plots, as we did in </span><em class="italic"><span class="koboSpan" id="kobo.1182.1" xmlns:="http://www.w3.org/1999/xhtml">steps 4</span></em><span class="koboSpan" id="kobo.1183.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><em class="italic"><span class="koboSpan" id="kobo.1184.1" xmlns:="http://www.w3.org/1999/xhtml">7</span></em><span class="koboSpan" id="kobo.1185.1" xmlns:="http://www.w3.org/1999/xhtml"> of the </span><em class="italic"><span class="koboSpan" id="kobo.1186.1" xmlns:="http://www.w3.org/1999/xhtml">Performing Box-Cox </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1187.1" xmlns:="http://www.w3.org/1999/xhtml">transformations</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1188.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1189.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.1190.1" xmlns:="http://www.w3.org/1999/xhtml">apply the Yeo-Johnson transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.1191.1" xmlns:="http://www.w3.org/1999/xhtml">with scikit-learn.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1192.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1193.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1194.1" xmlns:="http://www.w3.org/1999/xhtml"> with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1195.1" xmlns:="http://www.w3.org/1999/xhtml">yeo-johnson</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1196.1" xmlns:="http://www.w3.org/1999/xhtml"> transformation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1197.1" xmlns:="http://www.w3.org/1999/xhtml">
transformer = PowerTransformer(
    method="yeo-johnson", sta</span><a id="_idTextAnchor505"/><span class="koboSpan" id="kobo.1198.1" xmlns:="http://www.w3.org/1999/xhtml">ndardize=False,
).set_output(transform="pandas")</span></pre></li> <li><span class="koboSpan" id="kobo.1199.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.1200.1" xmlns:="http://www.w3.org/1999/xhtml">fit the transformer to </span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1202.1" xmlns:="http://www.w3.org/1999/xhtml">
transformer.fit(X)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1203.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1204.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><em class="italic"><span class="koboSpan" id="kobo.1205.1" xmlns:="http://www.w3.org/1999/xhtml">λ</span></em><span class="koboSpan" id="kobo.1206.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter should be learned from the train set and then used to transform the train and test sets. </span><span class="koboSpan" id="kobo.1206.2" xmlns:="http://www.w3.org/1999/xhtml">Thus, remember to separate your data into train and test sets before </span><span class="No-Break"><span class="koboSpan" id="kobo.1207.1" xmlns:="http://www.w3.org/1999/xhtml">fitting </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1208.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1209.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1210.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s transform </span><span class="No-Break"><span class="koboSpan" id="kobo.1211.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1212.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = transformer.transform(X)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1213.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1214.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1215.1" xmlns:="http://www.w3.org/1999/xhtml"> stores the learned parameters in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.1216.1" xmlns:="http://www.w3.org/1999/xhtml">lambda_</span></strong><span class="koboSpan" id="kobo.1217.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute, which you can return by </span><span class="No-Break"><span class="koboSpan" id="kobo.1218.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1219.1" xmlns:="http://www.w3.org/1999/xhtml">transformer.lambdas_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1220.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1221.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the distributions of the transformed data </span><span class="No-Break"><span class="koboSpan" id="kobo.1222.1" xmlns:="http://www.w3.org/1999/xhtml">with histograms:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1223.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf.hist(bins=30, figsize=(12, 12), layout=(3, 3))
plt.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1224.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we can see that the variables’ values are more evenly spread across </span><span class="No-Break"><span class="koboSpan" id="kobo.1225.1" xmlns:="http://www.w3.org/1999/xhtml">their ranges:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer061">
<span class="koboSpan" id="kobo.1226.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 3.14 – Histograms of the variables after the yeo-Johnson transformation" src="image/B22396_03_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1227.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 3.14 – Histograms of the variables after the yeo-Johnson transformation</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1228.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s implement</span><a id="_idIndexMarker273"/><span class="koboSpan" id="kobo.1229.1" xmlns:="http://www.w3.org/1999/xhtml"> the Yeo-Johnson transformation </span><span class="No-Break"><span class="koboSpan" id="kobo.1230.1" xmlns:="http://www.w3.org/1999/xhtml">with Feature-engine.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1231.1" xmlns:="http://www.w3.org/1999/xhtml">Let’</span><a id="_idTextAnchor506"/><span class="koboSpan" id="kobo.1232.1" xmlns:="http://www.w3.org/1999/xhtml">s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1233.1" xmlns:="http://www.w3.org/1999/xhtml">YeoJohnsonTransformer()</span></strong><span class="koboSpan" id="kobo.1234.1" xmlns:="http://www.w3.org/1999/xhtml"> to transform all numerical variables and then fit it to </span><span class="No-Break"><span class="koboSpan" id="kobo.1235.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1236.1" xmlns:="http://www.w3.org/1999/xhtml">
yjt = YeoJohnsonTransformer()
yjt.fit(X)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1237.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1238.1" xmlns:="http://www.w3.org/1999/xhtml">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1239.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1240.1" xmlns:="http://www.w3.org/1999/xhtml"> argument is left set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1241.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1242.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer selects and transforms all the numerical variables in the dataset. </span><span class="koboSpan" id="kobo.1242.2" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, we can pass the names of the variables to modify in </span><span class="No-Break"><span class="koboSpan" id="kobo.1243.1" xmlns:="http://www.w3.org/1999/xhtml">a list.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.1244.1" xmlns:="http://www.w3.org/1999/xhtml">Compared to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1245.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1246.1" xmlns:="http://www.w3.org/1999/xhtml"> from scikit-learn, Feature-engine’s transformer can take the entire DataFrame as an argument of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1247.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1248.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1249.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1250.1" xmlns:="http://www.w3.org/1999/xhtml"> methods, and yet it will only modify the </span><span class="No-Break"><span class="koboSpan" id="kobo.1251.1" xmlns:="http://www.w3.org/1999/xhtml">selected variables.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.1252.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s transform</span><a id="_idIndexMarker274"/> <span class="No-Break"><span class="koboSpan" id="kobo.1253.1" xmlns:="http://www.w3.org/1999/xhtml">the variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1254.1" xmlns:="http://www.w3.org/1999/xhtml">
X_tf = yjt.transform(X)</span></pre></li> <li><strong class="source-inline"><span class="koboSpan" id="kobo.1255.1" xmlns:="http://www.w3.org/1999/xhtml">YeoJohnsonTransformer()</span></strong><span class="koboSpan" id="kobo.1256.1" xmlns:="http://www.w3.org/1999/xhtml"> stores the best parameters per variable in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.1257.1" xmlns:="http://www.w3.org/1999/xhtml">lambda_dict_</span></strong><span class="koboSpan" id="kobo.1258.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute, which we can display </span><span class="No-Break"><span class="koboSpan" id="kobo.1259.1" xmlns:="http://www.w3.org/1999/xhtml">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1260.1" xmlns:="http://www.w3.org/1999/xhtml">
yjt.lambda_dict_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1261.1" xmlns:="http://www.w3.org/1999/xhtml">The previous command returns the </span><span class="No-Break"><span class="koboSpan" id="kobo.1262.1" xmlns:="http://www.w3.org/1999/xhtml">following dictionary:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1263.1" xmlns:="http://www.w3.org/1999/xhtml">{'MedInc': -0.1985098937827175,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1264.1" xmlns:="http://www.w3.org/1999/xhtml">'HouseAge': 0.8081480895997063,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1265.1" xmlns:="http://www.w3.org/1999/xhtml">'AveRooms': -0.5536698033957893,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1266.1" xmlns:="http://www.w3.org/1999/xhtml">'AveBedrms': -4.3940822236920365,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1267.1" xmlns:="http://www.w3.org/1999/xhtml">'Population': 0.2335</span><a id="_idTextAnchor507"/><span class="koboSpan" id="kobo.1268.1" xmlns:="http://www.w3.org/1999/xhtml">2363517075606,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1269.1" xmlns:="http://www.w3.org/1999/xhtml">'AveOccup': -0.9013456270549428}</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1270.1" xmlns:="http://www.w3.org/1999/xhtml">Now you know</span><a id="_idTextAnchor508"/><span class="koboSpan" id="kobo.1271.1" xmlns:="http://www.w3.org/1999/xhtml"> how to implement the Yeo-John</span><a id="_idTextAnchor509"/><a id="_idTextAnchor510"/><span class="koboSpan" id="kobo.1272.1" xmlns:="http://www.w3.org/1999/xhtml">son transformation with two different open </span><span class="No-Break"><span class="koboSpan" id="kobo.1273.1" xmlns:="http://www.w3.org/1999/xhtml">source libraries.</span></span></p>
<h2 id="_idParaDest-117"><a id="_idTextAnchor511"/><span class="koboSpan" id="kobo.1274.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1275.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we applied the Yeo-Johnson transformation using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1276.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1277.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1278.1" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1279.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1280.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1281.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1282.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1283.1" xmlns:="http://www.w3.org/1999/xhtml"> can apply both Box-Cox and Yeo-Johnson transformations, so we specified the transformation with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1284.1" xmlns:="http://www.w3.org/1999/xhtml">yeo-johnson</span></strong><span class="koboSpan" id="kobo.1285.1" xmlns:="http://www.w3.org/1999/xhtml"> string. </span><span class="koboSpan" id="kobo.1285.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1286.1" xmlns:="http://www.w3.org/1999/xhtml">standardize</span></strong><span class="koboSpan" id="kobo.1287.1" xmlns:="http://www.w3.org/1999/xhtml"> argument allowed us to determine whether we wanted to standardize (scale) the transformed values. </span><span class="koboSpan" id="kobo.1287.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we fit the transformer to the DataFrame so that it learned the optimal lambdas for each variable. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1288.1" xmlns:="http://www.w3.org/1999/xhtml">PowerTransformer()</span></strong><span class="koboSpan" id="kobo.1289.1" xmlns:="http://www.w3.org/1999/xhtml"> stored the learned lambdas in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.1290.1" xmlns:="http://www.w3.org/1999/xhtml">lambdas_</span></strong><span class="koboSpan" id="kobo.1291.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.1291.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1292.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1293.1" xmlns:="http://www.w3.org/1999/xhtml"> method to return the transformed variables. </span><span class="koboSpan" id="kobo.1293.2" xmlns:="http://www.w3.org/1999/xhtml">We set the transform output to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1294.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1295.1" xmlns:="http://www.w3.org/1999/xhtml"> to return DataFrames after </span><span class="No-Break"><span class="koboSpan" id="kobo.1296.1" xmlns:="http://www.w3.org/1999/xhtml">the transformation.</span></span></p>
<p><span class="koboSpan" id="kobo.1297.1" xmlns:="http://www.w3.org/1999/xhtml">After that, we </span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.1298.1" xmlns:="http://www.w3.org/1999/xhtml">applied the Yeo-Johnson transformation using Feature-engine. </span><span class="koboSpan" id="kobo.1298.2" xmlns:="http://www.w3.org/1999/xhtml">We set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1299.1" xmlns:="http://www.w3.org/1999/xhtml">YeoJohnsonTransformer()</span></strong><span class="koboSpan" id="kobo.1300.1" xmlns:="http://www.w3.org/1999/xhtml"> so that it transforms all numerical variables seen during </span><strong class="source-inline"><span class="koboSpan" id="kobo.1301.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1302.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1302.2" xmlns:="http://www.w3.org/1999/xhtml">We fitted the transformer to the data so that it learned the optimal lambdas per variable, which were stored in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1303.1" xmlns:="http://www.w3.org/1999/xhtml">lambda_dict_</span></strong><span class="koboSpan" id="kobo.1304.1" xmlns:="http://www.w3.org/1999/xhtml">, and finally transformed the variables using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1305.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1306.1" xmlns:="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.1306.2" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1307.1" xmlns:="http://www.w3.org/1999/xhtml">YeoJohnnsonTransformer()</span></strong><span class="koboSpan" id="kobo.1308.1" xmlns:="http://www.w3.org/1999/xhtml"> can take the entire DataFrame</span><a id="_idTextAnchor512"/><a id="_idTextAnchor513"/><span class="koboSpan" id="kobo.1309.1" xmlns:="http://www.w3.org/1999/xhtml"> as input, yet it wil</span><a id="_idTextAnchor514"/><span class="koboSpan" id="kobo.1310.1" xmlns:="http://www.w3.org/1999/xhtml">l only transform the </span><span class="No-Break"><span class="koboSpan" id="kobo.1311.1" xmlns:="http://www.w3.org/1999/xhtml">selected variables.</span></span></p>
<h2 id="_idParaDest-118"><a id="_idTextAnchor515"/><span class="koboSpan" id="kobo.1312.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.1313.1" xmlns:="http://www.w3.org/1999/xhtml">We can apply the Yeo-Johnson transformation with the SciPy library. </span><span class="koboSpan" id="kobo.1313.2" xmlns:="http://www.w3.org/1999/xhtml">For a code implementation, visit this book’s GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.1314.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-Engineering-Cookbook-Second-Edition/blob/main/ch03-variable-transformation/Recipe-6-Yeo-Johnson-transformation.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.1315.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-Engineering-Cookbook-Second-Edition/blob/main/ch03-variable-transformation/Recipe-6-Yeo-Johnson-transformation.ipynb</span></span></a></p>
</div>
</body></html>
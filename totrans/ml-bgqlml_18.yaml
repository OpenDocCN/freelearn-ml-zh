- en: '*Chapter 14*: BigQuery ML Tips and Best Practices'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第14章*：BigQuery ML 技巧和最佳实践'
- en: BigQuery ML has the great advantage of democratizing the use of **Machine Learning**
    (**ML**) for data and business analysts. In fact, BigQuery ML enables users without
    any programming experience to implement advanced ML algorithms. Even though BigQuery
    ML is designed to simplify and automatize the creation of a ML model, there are
    some best practices and tips that should be adopted during the development life
    cycle of a ML algorithm to obtain an effective performance from it.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: BigQuery ML 具有民主化数据分析师和业务分析师使用 **机器学习（ML**）的优势。实际上，BigQuery ML 允许没有任何编程经验的用户实施高级
    ML 算法。尽管 BigQuery ML 设计用于简化并自动化 ML 模型的创建，但在 ML 算法的开发生命周期中，仍有一些最佳实践和技巧应该被采用，以获得有效的性能。
- en: Having a background in data science can help us in further improving the performance
    of our ML models and in avoiding pitfalls during the implementation of a use case.
    In this chapter, we'll learn how to choose the right technique for each specific
    business scenario and will learn about the tools we can leverage to improve the
    performance of ML models.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有数据科学背景可以帮助我们在进一步提高 ML 模型的性能以及避免在用例实施过程中的陷阱。在本章中，我们将学习如何为每个特定的业务场景选择正确的技术，并了解我们可以利用的工具来提高
    ML 模型的性能。
- en: 'Following a typical ML development life cycle, we''ll go through the following
    topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 按照典型的 ML 开发生命周期，我们将讨论以下主题：
- en: Choosing the right BigQuery ML algorithm
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择合适的 BigQuery ML 算法
- en: Preparing the datasets
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备数据集
- en: Understanding feature engineering
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解特征工程
- en: Tuning hyperparameters
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整超参数
- en: Using BigQuery ML for online predictions
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 BigQuery ML 进行在线预测
- en: Choosing the right BigQuery ML algorithm
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 选择合适的 BigQuery ML 算法
- en: In this section, we'll learn why it is so important to define a clear business
    objective before implementing a ML model, and we'll understand which BigQuery
    ML algorithm is suitable for each specific use case.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习在实施 ML 模型之前定义一个明确的企业目标为什么如此重要，并了解哪些 BigQuery ML 算法适用于每个特定的用例。
- en: Important note
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: A **data scientist** is a professional in charge of the collection, analysis,
    and understanding of large amounts of data. This role typically requires a mix
    of skills, such as matching statistics and coding.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据科学家**是负责收集、分析和理解大量数据的专业人士。这个角色通常需要统计和编码技能的混合。'
- en: A **data analyst** is different from a data scientist. A data analyst is more
    focused on industry knowledge and business processes rather than on coding and
    programming skills. People in this role have huge experience in data manipulation
    and visualization and are able to present relevant business insights derived from
    data.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据分析师**与数据科学家不同。数据分析师更专注于行业知识和业务流程，而不是编码和编程技能。这个角色的人拥有大量数据操作和可视化的经验，能够从数据中提出相关的业务洞察。'
- en: In order to get meaningful results in ML, it is necessary to define a clear
    business objective. Before starting on the actual implementation of the ML model,
    data analysts and data scientists should clearly define the business goal they
    wish to achieve.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在机器学习（ML）中获得有意义的成果，有必要定义一个明确的企业目标。在开始实际实施 ML 模型之前，数据分析师和数据科学家应该清楚地定义他们希望实现的企业目标。
- en: 'One of the most famous techniques to set up clear goals is known as the **Specific,
    Measurable, Attainable, Relevant, and Time-based** (**SMART**) framework. In this
    paradigm, each letter represents a specific feature that our final goal should
    satisfy, as outlined here:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 一种设置明确目标最著名的技巧被称为 **具体、可衡量、可实现、相关和基于时间（SMART**）框架。在这个范式下，每个字母代表我们的最终目标应该满足的特定特征，如下所述：
- en: '**Specific**: It is necessary to define a clear and precise business objective.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**具体性**：有必要定义一个明确且精确的企业目标。'
- en: '**Measurable**: In order to understand if a BigQuery ML model satisfies our
    criteria, we need to select one or more **Key Performance Indicators** (**KPIs**)
    such as the **Receiver Operating Characteristic** (**ROC**), the **Area Under
    the Curve** (**AUC**) value, or the **Mean** **Absolute Error** (**MAE**).'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可衡量性**：为了理解 BigQuery ML 模型是否满足我们的标准，我们需要选择一个或多个 **关键绩效指标（KPI**），例如 **接收者操作特征（ROC**），**曲线下面积（AUC**）值，或
    **平均绝对误差（MAE**）。'
- en: '**Attainable**: We need to analyze the complexity of the use case that we want
    to solve and set the right expectations—for example, we cannot expect that our
    BigQuery ML model will predict the right values 100% of the time.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可达成**：我们需要分析我们想要解决的用例的复杂性，并设定合理的期望——例如，我们不能期望我们的BigQuery ML模型100%地预测正确的值。'
- en: '**Relevant**: We need to focus our efforts on the most important use cases,
    as it may be that some business scenarios can bring a limited business advantage
    to our company.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**相关**：我们需要将精力集中在最重要的用例上，因为可能某些业务场景只能为我们公司带来有限的优势。'
- en: '**Time-based**: As data analysts and data scientists, we have limited resources
    in terms of time. Focusing on the right goals is fundamental in order to generate
    value for our company.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基于时间**：作为数据分析师和数据科学家，我们在时间方面资源有限。集中精力在正确的目标上对于为公司创造价值是至关重要的。'
- en: We can apply the SMART framework to the ML field to help us in choosing the
    right use cases and the right BigQuery ML algorithm to use.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将SMART框架应用于ML领域，以帮助我们选择正确的用例和正确的BigQuery ML算法来使用。
- en: 'As an example, in the following table, you can visualize the SMART framework
    applied to the use case that we have developed in [*Chapter 4*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061),  *Predicting
    Numerical Values with Linear Regression*:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在下面的表中，您可以可视化SMART框架应用于我们在[*第4章*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061)，*使用线性回归预测数值*中开发的用例：
- en: '![Figure 14.1 – The SMART framework applied to a ML use case'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.1 – 将SMART框架应用于ML用例'
- en: '](img/B16722_14_001.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_14_001.jpg)'
- en: Figure 14.1 – The SMART framework applied to a ML use case
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.1 – 将SMART框架应用于ML用例
- en: Once we have defined our business objective using the SMART approach, we are
    ready to select the best BigQuery ML algorithms that can help us in addressing
    the business scenario.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们使用SMART方法定义了我们的业务目标，我们就准备好选择最佳的BigQuery ML算法，以帮助我们解决业务场景。
- en: According to the business objective that we want to achieve and the training
    dataset that we can leverage, we can identify the BigQuery ML algorithms that
    can potentially solve our use case.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们想要实现的企业目标和我们可以利用的训练数据集，我们可以确定可以解决我们用例的BigQuery ML算法。
- en: 'In the following table, we can see a summary of all the BigQuery ML techniques
    that we can use to develop our ML models:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的表中，我们可以看到我们可以用于开发我们的ML模型的所有BigQuery ML技术的总结：
- en: '![Figure 14.2 – The BigQuery ML algorithms at a glance'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.2 – 一瞥BigQuery ML算法'
- en: '](img/B16722_14_002.jpg)'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_14_002.jpg)'
- en: Figure 14.2 – The BigQuery ML algorithms at a glance
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.2 – 一瞥BigQuery ML算法
- en: 'In order to achieve our goal, we can navigate to the table represented in *Figure
    14.2* and clearly find the BigQuery ML algorithm that can solve our use case.
    For example, for the business scenario that we''ve analyzed in *Figure 14.1*,
    we can assert the following:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现我们的目标，我们可以导航到*图14.2*中表示的表，并清楚地找到可以解决我们用例的BigQuery ML算法。例如，对于我们在*图14.1*中分析的业务场景，我们可以断言以下内容：
- en: The BigQuery Public dataset that we used in [*Chapter 4*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061),
    *Predicting Numerical Values with Linear Regression*, is a labeled dataset because,
    for each record, it includes the trip duration of the past rides.
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们在[*第4章*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061)，*使用线性回归预测数值*中使用的BigQuery公共数据集是一个标记数据集，因为对于每条记录，它包括过去行程的行程时间。
- en: The expected outcome is a continuous real number. In fact, the goal of the use
    case is to predict the trip duration, expressed in minutes.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预期的结果是连续的实数。实际上，用例的目标是预测行程时间，以分钟为单位。
- en: 'By using the table presented in *Figure 14.2*, we notice that we can use one
    of the following BigQuery ML algorithms to address our prediction use case:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 通过查看*图14.2*中提供的表格，我们注意到我们可以使用以下BigQuery ML算法之一来解决我们的预测用例：
- en: '**Linear regression**'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**线性回归**'
- en: '**Boosted Tree – XGBoost – Regression**'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**提升树 – XGBoost – 回归**'
- en: '**Deep Neural Network – Regression**'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**深度神经网络 – 回归**'
- en: In this section, we learned how we can set a clear business objective. Then,
    we understood which BigQuery ML technique we can use to address our business goal.
    In the next section, we'll focus on preparing the datasets to get effective ML
    models.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了如何设定明确的企业目标。然后，我们了解了我们可以使用哪些BigQuery ML技术来解决我们的业务目标。在下一节中，我们将专注于准备数据集以获得有效的ML模型。
- en: Preparing the datasets
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备数据集
- en: In this section, we'll learn about which techniques we can apply to ensure that
    the data we will use to build our ML model is correct and produces the desired
    results. After that, we'll discover the strategies that we can use to segment
    the datasets into training, validation, and test sets.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习哪些技术可以应用以确保我们用于构建机器学习模型的数据是正确的并产生预期的结果。之后，我们将探讨我们可以使用的策略来将数据集分割为训练集、验证集和测试集。
- en: Working with high-quality data
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 与高质量数据一起工作
- en: In this section, we'll understand the characteristics that our datasets should
    have in order to develop effective BigQuery ML models.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解我们的数据集应该具备哪些特征，以便开发有效的BigQuery ML模型。
- en: Since ML models learn from data, it's very important to feed our ML algorithms
    with high-quality data, especially during the training phase. Since **data quality**
    is a very broad topic, it would require a specific book to analyze it in detail.
    For this reason, we will focus only on main data quality concepts in relation
    to the building of a ML model.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '由于机器学习模型是从数据中学习的，因此向我们的机器学习算法提供高质量的数据非常重要，尤其是在训练阶段。由于**数据质量**是一个非常广泛的话题，需要一本书来详细分析它。因此，我们将仅关注与构建机器学习模型相关的主要数据质量概念。 '
- en: Important note
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: '**Data quality** is a discipline that includes processes, professionals, technologies,
    and best practices to identify and correct anomalies, errors, and defects in data.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据质量**是一个包括过程、专业人员、技术和最佳实践的学科，用于识别和纠正数据中的异常、错误和缺陷。'
- en: This practice is fundamental in supporting business decisions with trusted and
    affordable data insights.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 这种做法对于支持基于可信和负担得起的数据洞察的商业决策至关重要。
- en: We can measure the quality of a dataset according to different data quality
    dimensions.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以根据不同的数据质量维度来衡量数据集的质量。
- en: 'In the following diagram, you can see the different dimensions used to measure
    the quality of the data:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的图中，你可以看到用于衡量数据质量的不同维度：
- en: '![Figure 14.3 – The data quality dimensions'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.3 – 数据质量维度]'
- en: '](img/B16722_14_003.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片 B16722_14_003.jpg]'
- en: Figure 14.3 – The data quality dimensions
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.3 – 数据质量维度
- en: 'We can evaluate the quality of a dataset based on the following dimensions:
    **Accuracy**, **Completeness**, **Consistency**, **Timeliness**, **Validity**,
    and **Uniqueness**.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以根据以下维度来评估数据集的质量：**准确性**、**完整性**、**一致性**、**及时性**、**有效性**和**唯一性**。
- en: In the following sections, we'll explain each data quality dimension and why
    it is important for the realization of a ML model.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将解释每个数据质量维度以及为什么它对于机器学习模型的实现很重要。
- en: Accuracy
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 准确性
- en: '**Accuracy** refers to the information that is available in our dataset. If
    a numerical value is wrong and doesn''t reflect reality, this will affect the
    effectiveness of the BigQuery ML model built on top of it.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**准确性**指的是我们数据集中可用的信息。如果一个数值是错误的并且不反映现实，这将影响建立在它之上的BigQuery ML模型的有效性。'
- en: Discovering information that is inaccurate is not an easy task, but we can apply
    some data quality checks to identify relevant issues in the data—for example,
    we can execute queries to identify and eventually remove records that contain
    incorrect values.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 发现不准确的信息并不容易，但我们可以应用一些数据质量检查来识别数据中的相关问题——例如，我们可以执行查询来识别并最终删除包含错误值的记录。
- en: 'In the following table, you can see a typical example of inaccurate data, with
    the presence of a negative value to express the age of a person:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的表格中，你可以看到一个典型的不准确数据示例，其中包含一个负值来表示一个人的年龄：
- en: '![Figure 14.4 – An example of a table with inaccurate values in the Age column'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.4 – 一个年龄列中存在不准确值的表格示例]'
- en: '](img/B16722_14_004.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片 B16722_14_004.jpg]'
- en: Figure 14.4 – An example of a table with inaccurate values in the Age column
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.4 – 一个年龄列中存在不准确值的表格示例
- en: Using `MAX` and `MIN` operators in `SELECT` queries can be a good way to find
    wrong values in the columns. These records are called outliers because they present
    very different values from the other records in the same column. Executing some
    preliminary **Structured Query Language** (**SQL**) queries to extract the maximum
    and the minimum values of the features and the label can be very useful in helping
    identify the most relevant errors in the dataset.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在`SELECT`查询中使用`MAX`和`MIN`运算符可以是一个很好的方法来找到列中的错误值。这些记录被称为异常值，因为它们与其他列中的记录相比具有非常不同的值。执行一些初步的**结构化查询语言**（**SQL**）查询以提取特征和标签的最大值和最小值对于帮助识别数据集中最相关的错误非常有用。
- en: For example, in *Figure 14.4*, Alice's age will be identified as an outlier
    in the **Age** column. In these cases, we can think about filtering out records
    with non-realistic values.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在*图14.4*中，Alice的年龄将在**年龄**列中被识别为异常值。在这些情况下，我们可以考虑过滤掉具有非现实值的记录。
- en: Completeness
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 完整性
- en: '`NULL` fields, these fields will affect the performance of our model.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '`NULL`字段，这些字段将影响我们模型的表现。'
- en: 'In the following table, you can see an example of incomplete data:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下表中，你可以看到一个不完整数据的示例：
- en: '![Figure 14.5 – An example of a table with incomplete values in the Age column'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.5 – 年龄列中存在不完整值的表格示例'
- en: '](img/B16722_14_005.jpg)'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](img/B16722_14_005.jpg)'
- en: Figure 14.5 – An example of a table with incomplete values in the Age column
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.5 – 年龄列中存在不完整值的表格示例
- en: In order to prevent the presence of incomplete records, the most effective solution
    is to apply specific filters in the query to exclude records with missing values.
    A typical completeness check is based on adding a `WHERE` clause when the feature
    or the label of the model should not be empty and should be different from `NULL`.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止存在不完整记录，最有效的解决方案是在查询中应用特定的过滤器，以排除具有缺失值的记录。一个典型的完整性检查是在特征或模型的标签不应为空且应不同于`NULL`时添加`WHERE`子句。
- en: 'In the following snippet of code, you can see an example of a `SELECT` statement
    with completeness checks applied to the `<TEXT_FIELD>` placeholder:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下代码片段中，你可以看到一个应用了完整性检查的`SELECT`语句示例，针对`<TEXT_FIELD>`占位符：
- en: '[PRE0]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: In the preceding example, we're applying completeness checks on the table represented
    by the `<TABLE_NAME>` placeholder. The quality check verifies that the `<TEXT_FIELD>`
    field is not equal to `NULL` and is not empty.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，我们正在对由`<TABLE_NAME>`占位符表示的表应用完整性检查。质量检查验证`<TEXT_FIELD>`字段不等于`NULL`且不为空。
- en: If a record presents incomplete fields, we can choose to exclude this record
    from the dataset or to replace missing values with default ones to fill the gaps.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一条记录包含不完整的字段，我们可以选择从数据集中排除此记录，或者用默认值替换缺失值以填补空白。
- en: Consistency
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 一致性
- en: Achieving **consistency** in data is one of the most complex tasks to perform.
    In enterprise contexts, the same data is usually stored in multiple locations
    and may be expressed with different formats or units of measurement. When a column
    presents a value incompatible with the values in other columns of a dataset, the
    data is inconsistent.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据中实现**一致性**是执行的最复杂任务之一。在企业环境中，相同的数据通常存储在多个位置，可能以不同的格式或单位表示。当一个列的值与其他列的值不兼容时，数据是不一致的。
- en: For example, we can imagine a table with a column that contains a temperature
    expressed in °C and another column with the same temperature in °F. If the two
    values should represent the same temperature but are not well calculated, the
    table will present an inconsistency.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们可以想象一个包含以°C表示的温度的列和另一个以°F表示相同温度的列的表。如果这两个值应该代表相同的温度但计算不准确，则表将显示不一致性。
- en: 'In the following table, you can see that the second record presents an inconsistency
    in the temperature values:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下表中，你可以看到第二条记录在温度值上存在不一致性：
- en: '![Figure 14.6 – An example of a table with inconsistent values in the Temperature
    columns'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.6 – 温度列中存在不一致值的表格示例'
- en: '](img/B16722_14_006.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](img/B16722_14_006.jpg)'
- en: Figure 14.6 – An example of a table with inconsistent values in the Temperature
    columns
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.6 – 温度列中存在不一致值的表格示例
- en: In *Figure 14.6*, the second record—which corresponds to the temperature measured
    in **Paris**—presents an inconsistency between the °C and the °F scale.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图14.6*中，第二条记录——对应于在**巴黎**测量的温度——在°C和°F尺度之间存在不一致性。
- en: To check the consistency of the data, we should usually apply validation checks
    on multiple fields that can reside in the same table or in different tables.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 为了检查数据的一致性，我们通常应该在同一个表或不同表中的多个字段上应用验证检查。
- en: Timeliness
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 及时性
- en: '**Timeliness** is particularly important when we need to use a BigQuery ML
    model. When we train a ML model, we need to be sure that all the features used
    during the training stage will be available when the ML model is executed.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '**及时性**在需要使用BigQuery ML模型时尤为重要。当我们训练ML模型时，我们需要确保在ML模型执行时，训练阶段使用的所有特征都将可用。'
- en: In the business scenario of [*Chapter 4*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061),
    *Predicting Numerical Values with Linear Regression*, we used the start and stop
    stations of a bike rental company to predict the trip duration. In this case,
    we've trained the BigQuery ML model leveraging the start and stop station, but
    if the stop station is not available at the prediction time, the ML model becomes
    inapplicable and worthless.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在**第4章**（[*Chapter 4*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061)）的商业场景中，*使用线性回归预测数值*，我们使用了自行车租赁公司的起始站和终点站来预测行程时长。在这种情况下，我们利用起始站和终点站训练了BigQuery
    ML模型，但如果在预测时终点站不可用，ML模型就变得不适用且毫无价值。
- en: To avoid this common error, we need to check that all the features used to train
    the model will also be available during the prediction phase when the ML model
    will generate the predictions.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免这种常见的错误，我们需要检查所有用于训练模型的特征在预测阶段（当ML模型生成预测时）也将可用。
- en: Validity
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**有效性**'
- en: The **validity** of a value is strictly related to the expected format that
    a field should have. If a column contains date values expressed in the format
    *DD/MM/YYYY* and one of the records presents the format *DD-MM-YYYY*, the validity
    of the record is compromised.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 值的**有效性**严格相关于字段应有的预期格式。如果一个列包含以*DD/MM/YYYY*格式表示的日期值，而其中一个记录呈现的格式为*DD-MM-YYYY*，则该记录的有效性会受到损害。
- en: 'In the following table, you will notice that the second record presents a non-valid
    value for the **Birth Date** field:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下表中，您将注意到第二个记录对于**出生日期**字段呈现了一个无效值：
- en: '![Figure 14.7 – An example of a table with invalid values in the Birth Date
    column'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.7 – 一个在出生日期列中包含无效值的表的示例'
- en: '](img/B16722_14_007.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_14_007.jpg)'
- en: Figure 14.7 – An example of a table with invalid values in the Birth Date column
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.7 – 一个在出生日期列中包含无效值的表的示例
- en: To meet this dimension, we must check that all the values of a column are stored
    in the same format and in a homogeneous way. In order to check the exact format
    of each field, we can apply regular expressions to the values in the columns.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 为了满足这一维度，我们必须检查一个列中所有值都存储在相同的格式和同一种方式中。为了检查每个字段的精确格式，我们可以将正则表达式应用于列中的值。
- en: Uniqueness
  id: totrans-95
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**唯一性**'
- en: '**Unique** information means that there is exactly one record in a table to
    represent a specific item. Data duplication can happen due to several reasons,
    such as bugs in the data ingestion process, or uncontrolled interruptions and
    restarts during data loading.'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '**唯一**信息意味着在一个表中恰好有一个记录来表示一个特定的项目。数据重复可能由几个原因造成，例如数据摄取过程中的错误，或在数据加载过程中的不可控中断和重启。'
- en: In order to prevent these errors, we need to know the fields that compose the
    **Primary Key** (**PK**) of our records, and we need to check that the **PK**
    matches one—and only one—record.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止这些错误，我们需要知道构成我们记录的**主键**（**PK**）的字段，并且我们需要检查**PK**与一个——并且只有一个——记录匹配。
- en: Important note
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: In a table, the **PK** is the minimum set of columns that uniquely identify
    a row.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个表中，**PK**是唯一标识一行的最小列集。
- en: The presence of duplicated records can lead the ML model to learn from occurrences
    that are not actual but generated by technical errors.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 重复记录的存在可能导致ML模型从非实际但由技术错误生成的发生中学习。
- en: Now that we've discovered all the data quality dimensions to check before implementing
    our BigQuery ML model, let's take a look the techniques we can use to segment
    the datasets into training, validation, and test sets.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经发现了在实施我们的BigQuery ML模型之前需要检查的所有数据质量维度，让我们来看看我们可以用来将数据集分割为训练集、验证集和测试集的技术。
- en: Segmenting the datasets
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据集的分割
- en: In this section, we'll learn how to easily segment the datasets to support the
    training, validation, and test phases of a BigQuery ML model.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习如何轻松分割数据集以支持BigQuery ML模型的训练、验证和测试阶段。
- en: 'For most BigQuery ML algorithms, we need to split the initial dataset into
    three different sets, as follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 对于大多数BigQuery ML算法，我们需要将初始数据集分为三个不同的集合，如下所示：
- en: The **training** dataset represents the sample of data that we'll use to train
    our BigQuery ML model.
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**训练**数据集代表我们将用于训练我们的BigQuery ML模型的样本数据。'
- en: The **validation** dataset is different from the training dataset and we can
    use it to evaluate the model's performance. We perform validation on completely
    new data that is different from the sample data used in the training stage. In
    this phase, we can also tune the hyperparameters of the model.
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**验证集**与训练集不同，我们可以用它来评估模型的性能。我们在与训练阶段使用的样本数据完全不同的新数据上执行验证。在这个阶段，我们还可以调整模型的超参数。'
- en: The **test** set is the dataset used to finally apply the model and verify its
    results and performance.
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**测试集**是用于最终应用模型并验证其结果和性能的数据集。'
- en: 'Splitting the initial dataset into these three subsets can be cumbersome, but
    if you have enough data, you can apply the following rule of thumb:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 将初始数据集分割成这三个子集可能会很繁琐，但如果您有足够的数据，可以应用以下经验规则：
- en: 80% of the data for the training set.
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 训练集的数据占 80%。
- en: 10% for the validation set.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 10% 用于验证集。
- en: The remaining 10% for the test set.
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 剩余的 10% 用于测试集。
- en: If we're working on large amounts of data, we can reduce the percentage of observations
    used for the validation and test sets.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我们在处理大量数据，我们可以减少用于验证集和测试集的观测值的百分比。
- en: 'In the following screenshot, you can see a graphical representation of the
    optimal splitting strategy:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下屏幕截图中，您可以看到最佳分割策略的图形表示：
- en: '![Figure 14.8 – The 80/10/10 splitting strategy for ML'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 14.8 – 机器学习的 80/10/10 分割策略](img/B16722_14_008.jpg)'
- en: '](img/B16722_14_008.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片 B16722_14_008.jpg](img/B16722_14_008.jpg)'
- en: Figure 14.8 – The 80/10/10 splitting strategy for ML
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.8 – 机器学习的 80/10/10 分割策略
- en: In order to achieve the best results, the split procedure should be as random
    as possible.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 为了达到最佳结果，分割过程应该尽可能随机。
- en: 'In the following code block, you can see how to apply this rule of thumb by
    using the `MOD` function:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下代码块中，您可以看到如何通过使用 `MOD` 函数应用此经验规则：
- en: '[PRE1]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In the example, the records stored in the table represented by the placeholder
    `<TABLE_NAME>`, are split into three different sets according to the value of
    the field dataframe. In this case, the MOD function returns a value from 0 to
    10\. Using this function allows us to group the records into three different sets.
    By leveraging the clauses `MOD(<RECORD_KEY>, 10)<8, MOD(<RECORD_KEY>, 10) = 8
    and MOD(<RECORD_KEY>, 10) = 9`, we can split the records into the `'training',
    'evaluation'` and `'test'` sets.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例中，存储在由占位符 `<TABLE_NAME>` 表示的表中的记录根据字段 dataframe 的值分为三个不同的集合。在这种情况下，MOD 函数返回一个从
    0 到 10 的值。使用此函数允许我们将记录分为三个不同的集合。通过利用 `MOD(<RECORD_KEY>, 10)<8, MOD(<RECORD_KEY>,
    10) = 8 和 MOD(<RECORD_KEY>, 10) = 9` 这两个子句，我们可以将记录分为 `'training'`、`'evaluation'`
    和 `'test'` 集合。
- en: Now that we've understood how to segment the datasets according to our needs
    for training, validation, and testing, let's look at the understanding of the
    feature engineering techniques.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了如何根据我们的训练、验证和测试需求来分割数据集，让我们来看看对特征工程技术的理解。
- en: Understanding feature engineering
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解特征工程
- en: In this section, we'll understand which techniques we can use to improve the
    features of a BigQuery ML model before the training stage.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解在训练阶段之前我们可以使用哪些技术来改进 BigQuery ML 模型的特征。
- en: Important note
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: '**Feature engineering** is the practice of applying preprocessing functions
    on raw data, to extract features useful for training a ML model. Creating preprocessed
    features can significantly improve the performance of a ML model.'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '**特征工程**是在原始数据上应用预处理函数的实践，以提取对训练机器学习模型有用的特征。创建预处理特征可以显著提高机器学习模型的性能。'
- en: By design, BigQuery ML automatically applies feature engineering during the
    training phase when we use the `CREATE MODEL` function, but it also allows us
    to apply preprocessing transformations as well.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 按照设计，BigQuery ML 在使用 `CREATE MODEL` 函数进行训练阶段时，会自动应用特征工程，但它也允许我们应用预处理转换。
- en: In order to automatically apply the feature engineering operations during the
    training and the prediction stage, we can include all the pre-processing functions
    into the `TRANSFORM` clause when we train the BigQuery ML model.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在训练和预测阶段自动应用特征工程操作，我们可以在训练 BigQuery ML 模型时将所有预处理函数包含在 `TRANSFORM` 子句中。
- en: 'As we can see from the following code example, we need to use the `TRANSFORM`
    clause before the `OPTIONS` clause, and after the `CREATE MODEL` statement:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 如以下代码示例所示，我们需要在 `OPTIONS` 子句之前使用 `TRANSFORM` 子句，并在 `CREATE MODEL` 语句之后：
- en: '[PRE2]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'In BigQuery ML, there are two different types of feature engineering function,
    outlined as follows:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在 BigQuery ML 中，有两种不同类型的特征工程函数，如下所述：
- en: '**Scalar** functions apply on a single record'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标量**函数作用于单个记录'
- en: '**Analytic** functions calculate the results on all the rows'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分析性**函数在所有行上计算结果'
- en: 'In the following list, you can take a look at the most important feature engineering
    functions that you can apply in BigQuery ML:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下列表中，您可以查看在 BigQuery ML 中可以应用的最重要特征工程函数：
- en: '`ML.BUCKETIZE`: This is used to convert a numerical expression into a categorical
    field—for example, you can use this function to convert the age of a person into
    *Young*, *Middle*, or *Old* buckets.'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML.BUCKETIZE`: 这个函数用于将数值表达式转换为分类字段——例如，您可以使用此函数将一个人的年龄转换为 *Young*（年轻）、*Middle*（中年）或
    *Old*（老年）桶。'
- en: '`ML.FEATURE_CROSS`: This is used to combine two features into a unique feature.
    For example, if in a dataset we have the gender and the place of birth of a person,
    we can combine these two features to simplify our BigQuery ML model. This technique
    is particularly indicated when we''ve correlated features and we want to include
    both the information in our ML model.'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML.FEATURE_CROSS`: 这个函数用于将两个特征组合成一个独特的特征。例如，如果在数据集中我们有一个人的性别和出生地，我们可以将这些两个特征组合起来简化我们的
    BigQuery ML 模型。当我们在相关特征中并且想要在我们的机器学习模型中包含这两个信息时，这种技术特别适用。'
- en: '`ML.QUANTILE_BUCKETIZE`: This is very similar to the `ML.BUCKETIZE` function.
    In this case, the function is analytic and applies on all records in the dataset.
    The splitting of records into buckets is based on the quantiles of an entire set
    of records.'
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML.QUANTILE_BUCKETIZE`: 这个函数与 `ML.BUCKETIZE` 函数非常相似。在这种情况下，该函数是分析性的，并应用于数据集中的所有记录。记录分割成桶是基于整个记录集的百分位数。'
- en: Important note
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要提示
- en: The **Quantile** is the specific portion of a dataset. For example, it identifies
    how many values are above or below a certain threshold value.
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**分位数**是数据集的特定部分。例如，它标识有多少值高于或低于某个阈值。'
- en: '`ML.MIN_MAX_SCALER`: This is an analytic function that returns a value from
    zero to one according to the distribution of the values in the entire record set.'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML.MIN_MAX_SCALER`: 这是一个分析函数，根据整个记录集中的值分布返回一个从零到一的值。'
- en: '`ML.STANDARD_SCALER`: This is an analytic function that allows us to use the
    standard deviation and mean of the record set.'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML.STANDARD_SCALER`: 这是一个分析函数，允许我们使用记录集的标准差和平均值。'
- en: 'For an entire list of feature engineering and preprocessing functions, you
    can visit the official BigQuery documentation at the following link: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions).'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 对于特征工程和预处理的完整函数列表，您可以访问以下链接的官方 BigQuery 文档：[https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions)。
- en: Now that we have learned about feature engineering, let's move on to hyperparameter
    tuning.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了特征工程，让我们继续学习超参数调整。
- en: Tuning hyperparameters
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调整超参数
- en: In this section, we'll discover the most important hyperparameters that we can
    tune in BigQuery ML.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨在 BigQuery ML 中可以调整的最重要超参数。
- en: Important note
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: '**Hyperparameter tuning** is the practice of choosing the best set of parameters
    to train a specific ML model. A hyperparameter influences and controls the learning
    process during the ML training stage.'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '**超参数调整**是选择最佳参数集以训练特定机器学习模型的实践。超参数在机器学习训练阶段影响并控制学习过程。'
- en: By design, BigQuery ML uses default hyperparameters to train a model, but advanced
    users can manually change them to influence the training process.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 按设计，BigQuery ML 使用默认超参数来训练模型，但高级用户可以手动更改它们以影响训练过程。
- en: 'In BigQuery ML, we can specify the hyperparameters in the `OPTIONS` clause
    as optional parameters. The most relevant hyperparameters, depending on the model,
    that we can change before starting the training of a BigQuery ML model are listed
    here:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在 BigQuery ML 中，我们可以在 `OPTIONS` 子句中指定超参数作为可选参数。在开始训练 BigQuery ML 模型之前，我们可以更改的最相关的超参数（取决于模型）如下所示：
- en: '`L1_REG`: This is a regularization parameter that we can use to prevent overfitting
    by keeping the weights of the model close to zero.'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`L1_REG`: 这是一个正则化参数，我们可以使用它通过保持模型权重接近零来防止过拟合。'
- en: '`L2_REG`: This is a second regularization parameter that we can use to prevent
    overfitting.'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`L2_REG`: 这是一个第二正则化参数，我们可以使用它来防止过拟合。'
- en: '`MAX_ITERATIONS`: This represents the maximum number of iterations that BigQuery
    ML will perform to train the model.'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`MAX_ITERATIONS`：这代表BigQuery ML在训练模型时将执行的最大迭代次数。'
- en: '`LEARN_RATE`: This is a parameter that affects how much the model changes according
    to the error of the previous iteration.'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`LEARN_RATE`：这是一个参数，它影响模型根据前一次迭代的错误进行多少变化。'
- en: '`MIN_REL_PROGRESS`: This is the minimum improvement that is necessary to continue
    the training after an iteration.'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`MIN_REL_PROGRESS`：这是在迭代后继续训练所必需的最小改进。'
- en: '`NUM_CLUSTERS`: This is used for K-Means algorithms and represents the number
    of clusters that the model will create.'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`NUM_CLUSTERS`：这用于K-Means算法，表示模型将创建的簇的数量。'
- en: '`HIDDEN_UNITS`: This is used in **Deep Neural Networks** (**DNNs**) and represents
    the number of hidden layers in a network.'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`HIDDEN_UNITS`：这用于**深度神经网络**（**DNNs**），表示网络中的隐藏层数量。'
- en: For a complete list of all the hyperparameters that you can apply with BigQuery
    ML, we suggest visiting the official documentation at [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create).
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 关于你可以使用BigQuery ML应用的所有超参数的完整列表，我们建议访问官方文档[https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)。
- en: Using BigQuery ML for online predictions
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用BigQuery ML进行在线预测
- en: In this section, we'll understand how we can use a BigQuery ML model in a synchronous
    and online manner.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解如何以同步和在线的方式使用BigQuery ML模型。
- en: BigQuery ML represents a huge opportunity to democratize ML techniques for business
    and data analysts. When BigQuery ML is trained and ready to use, we can invoke
    it directly in BigQuery using a SQL query or we can export it into TensorFlow
    format.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: BigQuery ML为商业和数据分析师民主化机器学习技术提供了巨大的机会。当BigQuery ML训练并准备好使用时，我们可以在BigQuery中直接通过SQL查询调用它，或者将其导出到TensorFlow格式。
- en: 'The requirements of each use case drive the prediction type that we should
    adopt, as outlined here:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 每个用例的需求驱动我们应该采用的预测类型，如下所述：
- en: We use **online prediction** when we want to enable request-response applications
    and when getting an immediate prediction is critical.
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当我们想要启用请求-响应应用程序，并且获取即时预测至关重要时，我们使用**在线预测**。
- en: We adopt **batch prediction** to process large volumes of data when we don't
    need immediate predictions—for example, scheduling daily or weekly jobs that calculate
    predictions on the data collected since the last job execution.
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当我们不需要立即预测时，我们会采用**批量预测**来处理大量数据——例如，安排每日或每周的工作，计算自上次作业执行以来收集的数据的预测。
- en: While using BigQuery SQL statements is more suitable for batch predictions on
    a large number of records stored in a BigQuery table, the possibility of exporting
    BigQuery ML models into TensorFlow opens new opportunities in terms of applications.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然使用BigQuery SQL语句更适合对存储在BigQuery表中的大量记录进行批量预测，但将BigQuery ML模型导出到TensorFlow的可能性为应用开辟了新的机会。
- en: 'In the following diagram, you can see the life cycle of a BigQuery ML model
    from the training phase to the deployment phase:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的图中，你可以看到BigQuery ML模型从训练阶段到部署阶段的生命周期：
- en: '![Figure 14.9 – Using a BigQuery ML model for online predictions'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '![图14.9 – 使用BigQuery ML模型进行在线预测](img/B16722_14_009.jpg)'
- en: '](img/B16722_14_009.jpg)'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '![图B16722_14_009.jpg](img/B16722_14_009.jpg)'
- en: Figure 14.9 – Using a BigQuery ML model for online predictions
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.9 – 使用BigQuery ML模型进行在线预测
- en: 'From the preceding diagram, we see that in the first step **(1)** of the BigQuery
    ML model life cycle we train the ML model by leveraging the training dataset stored
    in BigQuery. In this first step, the ML model goes through the three main stages
    of the development cycle, as follows:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 从前面的图中，我们看到在BigQuery ML模型生命周期的第一步**（1**）中，我们通过利用存储在BigQuery中的训练数据集来训练ML模型。在这个第一步中，ML模型经历了开发周期的三个主要阶段，如下所述：
- en: '**Train**: In this stage, the BigQuery ML model learns from the training data.'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**训练**：在这个阶段，BigQuery ML模型从训练数据中学习。'
- en: '**Evaluate**: In this step, we evaluate the KPIs of the model and we can tune
    the hyperparameters.'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评估**：在这个步骤中，我们评估模型的KPI指标，并且可以调整超参数。'
- en: '**Test**: In this last phase, we finally test the BigQuery ML model on the
    test dataset to get the predictions.'
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**测试**：在这个最后阶段，我们最终在测试数据集上测试BigQuery ML模型以获取预测。'
- en: 'When the BigQuery ML model satisfies our expectations in terms of performance,
    we can do the following:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 当BigQuery ML模型在性能方面满足我们的期望时，我们可以做以下操作：
- en: Use the model in BigQuery **(2a)** through SQL by leveraging data that is already
    stored in tables. This approach typically works well for batch predictions—for
    example, we can periodically run the BigQuery SQL statement to execute the model
    every day or every week by generating the new predictions.
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过SQL在BigQuery中使用模型**（2a）**，通过利用已存储在表中的数据。这种方法通常适用于批量预测——例如，我们可以定期运行BigQuery
    SQL语句，每天或每周执行模型，生成新的预测。
- en: Export the model into the TensorFlow `SavedFormat` **(2b)**, as we described
    in [*Chapter 13*](B16722_13_Final_ASB_ePub.xhtml#_idTextAnchor184), *Running TensorFlow
    Models with BigQuery ML*. This second approach is particularly suitable for running
    the ML model outside of BigQuery on other TensorFlow-compatible platforms. The
    same approach can be adopted by exporting the ML model into the XGBoost Booster
    format.
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将模型导出到TensorFlow的`SavedFormat**（2b）**`，正如我们在[*第13章*](B16722_13_Final_ASB_ePub.xhtml#_idTextAnchor184)，“使用BigQuery
    ML运行TensorFlow模型”中描述的那样。这种方法特别适合在BigQuery之外的其他TensorFlow兼容平台上运行机器学习模型。同样的方法可以通过将机器学习模型导出到XGBoost增强器格式来采用。
- en: 'When we''ve exported the BigQuery ML model, we can deploy the ML algorithm
    to one of the following:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们导出BigQuery ML模型后，我们可以将机器学习算法部署到以下之一：
- en: '**Google Cloud AI Platform Prediction** **(3a)**: With this Google Cloud module,
    we can deploy trained ML models in the cloud and leverage the cloud infrastructure
    to serve the model and generate online predictions. This cloud service automatically
    provisions and manages the infrastructure resources to run the ML model and can
    scale up according to the number of requests that come from client applications.
    The deployment on Google Cloud AI Platform Prediction automatically generates
    a **Representational State Transfer** (**REST**) endpoint that can be used to
    invoke the model through **HyperText Transfer Protocol** (**HTTP**) requests.'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Google Cloud AI Platform Prediction** **（3a）**：使用这个Google Cloud模块，我们可以在云中部署训练好的机器学习模型，并利用云基础设施来提供模型和生成在线预测。这种云服务自动配置和管理基础设施资源以运行机器学习模型，并且可以根据来自客户端应用程序的请求数量进行扩展。在Google
    Cloud AI Platform Prediction上的部署会自动生成一个**表示状态传输** (**REST**)端点，可以通过**超文本传输协议**
    (**HTTP**)请求来调用模型。'
- en: This kind of approach is particularly useful when we have multiple client applications
    that should interact with our ML model and we don't want to have to worry about
    the infrastructure maintenance of the service. As a prerequisite, we need to consider
    that we can only use this kind of approach if an internet connection is available.
    In fact, to invoke the REST **Application Programming Interface** (**API**) exposed
    by the cloud platform, we need to perform HTTP requests from the client applications
    to the cloud.
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这种方法在当我们有多个客户端应用程序需要与我们的机器学习模型交互，而我们又不想担心服务的基础设施维护时特别有用。作为先决条件，我们需要考虑的是，我们只能在使用互联网连接的情况下使用这种方法。实际上，为了调用云平台暴露的REST
    **应用程序编程接口** (**API**)，我们需要从客户端应用程序向云发送HTTP请求。
- en: An **on-premise machine** where it can be deployed using containers **(3b)**.
    TensorFlow models, in fact, can be deployed using containers by leveraging a **TensorFlow
    Serving Docker** container. To understand the deployment steps of a TensorFlow
    model in a **Docker** container, you can check out the documentation at [https://www.tensorflow.org/tfx/serving/docker](https://www.tensorflow.org/tfx/serving/docker).
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一种可以在**本地机器**上部署使用容器的**（3b）**方法。TensorFlow模型实际上可以通过利用**TensorFlow Serving Docker**容器来部署。要了解在**Docker**容器中部署TensorFlow模型的步骤，您可以查看[https://www.tensorflow.org/tfx/serving/docker](https://www.tensorflow.org/tfx/serving/docker)上的文档。
- en: Important note
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要提示
- en: A **container** is a virtualization mechanism that runs on top of a single operating
    system. **Docker** is a container engine used to deploy containerized applications.
    The container engine allocates the hardware resources for each application and
    manages the scalability of the virtual infrastructure.
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**容器**是一种在单个操作系统之上运行的虚拟化机制。**Docker**是一个用于部署容器化应用程序的容器引擎。容器引擎为每个应用程序分配硬件资源，并管理虚拟基础设施的可伸缩性。'
- en: We can use this approach when the ML model needs to run under specific conditions,
    such as during an absence of internet connectivity, or on sensitive data. In fact,
    when we deploy the on-premise machine ML model, the cloud infrastructure is no
    longer involved in the predictions and there is no data transfer between the on-premise
    environment and the cloud.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 当机器学习模型需要在特定条件下运行时，例如在无互联网连接或敏感数据的情况下，我们可以使用这种方法。实际上，当我们部署本地机器学习模型时，云基础设施不再参与预测，并且本地环境和云之间没有数据传输。
- en: In both deployment scenarios, the ML model can be invoked by using HTTP requests,
    passing the input parameters in the request payload. At the end of the ML model
    execution, the predictions are returned into the response payload.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在这两种部署场景中，可以通过使用HTTP请求调用ML模型，在请求有效负载中传递输入参数。在ML模型执行结束时，预测结果返回到响应有效负载中。
- en: Summary
  id: totrans-183
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we've learned the most important tips and best practices that
    we can apply during the implementation of a ML use case with BigQuery ML.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了在实施BigQuery ML机器学习用例时可以应用的最重要技巧和最佳实践。
- en: We've analyzed the importance of data preparation; we started looking at the
    data quality aspects; then, we've learned how we can easily split the data to
    get balanced training, validation, and test sets.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 我们分析了数据准备的重要性；我们开始关注数据质量方面；然后，我们学习了如何轻松地将数据分割以获得平衡的训练、验证和测试集。
- en: We then looked at how we can further improve a ML model's performance using
    BigQuery ML functions for feature engineering.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们探讨了如何使用BigQuery ML的函数来改进机器学习模型的表现。
- en: After that, we focused our attention on tuning hyperparameters. When we train
    a model, BigQuery ML allows us to choose different parameters, and these variables
    influence the training stage.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们专注于调整超参数。当我们训练模型时，BigQuery ML允许我们选择不同的参数，这些变量影响训练阶段。
- en: Finally, we have understood why it is so important to deploy BigQuery ML models
    on other platforms so that we get online predictions and satisfy near-real-time
    business scenarios.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们理解了为什么在其它平台上部署BigQuery ML模型如此重要，以便我们获得在线预测并满足近实时业务场景。
- en: Congratulations on finishing reading the book! You should now be able to use
    BigQuery ML for your business scenarios and use cases. I suggest you continue
    to keep constantly informed about this topic, which is so interesting and is evolving
    so quickly.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜您完成本书的阅读！现在您应该能够为您的业务场景和用例使用BigQuery ML。我建议您继续关注这个如此有趣且发展迅速的主题。
- en: Further resources
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更多资源
- en: '**BigQuery ML Create Model**: [https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike](https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike)'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 创建模型**: [https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike](https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike)'
- en: '**BigQuery ML preprocessing functions**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions)'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 预处理函数**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions)'
- en: '`CREATE MODEL` **statement for importing TensorFlow models**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-tensorflow](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-tensorflow)'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`导入TensorFlow模型的`CREATE MODEL**语句**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-tensorflow](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-tensorflow)'
- en: '`ML EVALUATE` **function**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML EVALUATE` **函数**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
- en: '`ML PREDICT` **function**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML PREDICT` **函数**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
- en: '**Exporting a BigQuery ML model for online prediction**: [https://cloud.google.com/bigquery-ml/docs/export-model-tutorial](https://cloud.google.com/bigquery-ml/docs/export-model-tutorial)'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**导出 BigQuery ML 模型以进行在线预测**: [https://cloud.google.com/bigquery-ml/docs/export-model-tutorial](https://cloud.google.com/bigquery-ml/docs/export-model-tutorial)'

<html><head></head><body>
		<div id="_idContainer137">
			<h1 id="_idParaDest-98" class="chapter-number"><a id="_idTextAnchor111"/>7</h1>
			<h1 id="_idParaDest-99"><a id="_idTextAnchor112"/>Building Regression Models</h1>
			<p>In the previous chapter, we learned about classification models. In this chapter, we will learn about building <strong class="bold">linear regression</strong> models where we predict numeric variables. Unlike classification models, linear regression models are used to predict a <strong class="bold">continuous numeric value</strong>. Similar to the previous chapter, here also you will learn about various methods that Redshift provides for creating linear <span class="No-Break">regression models.</span></p>
			<p>This chapter will provide several detailed examples of business problems that can be solved with these modeling techniques. In this chapter, we will walk through how you can try different algorithms to get the best <span class="No-Break">regression model.</span></p>
			<p>By the end of this chapter, you will be in a position to identify whether a business problem is a linear regression or not and then be able to identify the right method that Redshift provides to train and build <span class="No-Break">the model.</span></p>
			<p>In this chapter, we will go through the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Introducing <span class="No-Break">regression algorithms</span></li>
				<li>Creating a simple regression model using the <span class="No-Break">XGBoost algorithm</span></li>
				<li>Creating multi-input <span class="No-Break">regression models</span></li>
			</ul>
			<h1 id="_idParaDest-100"><a id="_idTextAnchor113"/>Technical requirements</h1>
			<p>This chapter requires a web browser and access to <span class="No-Break">the following:</span></p>
			<ul>
				<li><span class="No-Break">AWS account</span></li>
				<li>Amazon Redshift <span class="No-Break">Serverless endpoint</span></li>
				<li>Amazon Redshift Query <span class="No-Break">Editor v2</span></li>
			</ul>
			<p>You can find the code used in this <span class="No-Break">chapter here:</span></p>
			<p><a href="https://github.com/PacktPublishing/Serverless-Machine-Learning-with-Amazon-Redshift/blob/main/CodeFiles/chapter7/chapter7.sql"><span class="No-Break">https://github.com/PacktPublishing/Serverless-Machine-Learning-with-Amazon-Redshift/blob/main/CodeFiles/chapter7/chapter7.sql</span></a></p>
			<h1 id="_idParaDest-101"><a id="_idTextAnchor114"/>Introducing regression algorithms</h1>
			<p>Regression models <a id="_idIndexMarker331"/>are used where you are trying to predict a numeric outcome such as what price an item will sell for. The outcome variable is your target and your input variables are used to determine the relationship between the variables so that you can predict the unknown target on sets of data without the <span class="No-Break">target variable.</span></p>
			<p>You can have a single input variable, also<a id="_idIndexMarker332"/> known as <strong class="bold">simple linear regression</strong>. For example, years<a id="_idIndexMarker333"/> of experience and salary usually have <span class="No-Break">a relationship.</span></p>
			<p><strong class="bold">Multiple linear regression</strong> is <a id="_idIndexMarker334"/>when you have multiple input variables. For example, predicting the<a id="_idIndexMarker335"/> selling price of homes in a particular zip code by using the relationship between the target (price) and various inputs such as square footage, number of bedrooms, pool, basement, lot size, and <span class="No-Break">year built.</span></p>
			<p>A good linear regression model has a small amount of vertical distance between the line and the data points. Refer to the <span class="No-Break">following figure:</span></p>
			<div>
				<div id="_idContainer120" class="IMG---Figure">
					<img src="image/B19071_07_01.jpg" alt="Figure 7.1 – Linear regression line"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – Linear regression line</p>
			<p>Common use cases<a id="_idIndexMarker336"/> where regression models are useful are <span class="No-Break">as follows:</span></p>
			<ul>
				<li>Price and <span class="No-Break">revenue prediction</span></li>
				<li>Predicting customer <span class="No-Break">lifetime value</span></li>
				<li>Predicting <span class="No-Break">the weather</span></li>
				<li>Measuring the effectiveness of <span class="No-Break">marketing campaigns</span></li>
			</ul>
			<p>This chapter will show you how to build regression models in Amazon Redshift ML using the XGBoost and Linear Learner algorithms, which you used in <a href="B19071_06.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>. As you will see, you can use the same algorithms on different machine <span class="No-Break">learning problems.</span></p>
			<p>We have looked at the regression problem; now let’s look at the Redshift <strong class="source-inline">CREATE MODEL</strong> command to create a <span class="No-Break">regression mo<a id="_idTextAnchor115"/>del.</span></p>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor116"/>Redshift’s CREATE MODEL with user guidance</h2>
			<p>When <a id="_idIndexMarker337"/>using the <strong class="source-inline">CREATE MODEL</strong> command in Redshift, the system will automatically search for the best combination of preprocessing and model for your specific dataset. However, in some cases, you <a id="_idIndexMarker338"/>may want additional control over the model creation process or to incorporate <span class="No-Break">domain-specific knowledge.</span></p>
			<p>Redshift offers flexibility to guide the <strong class="source-inline">CREATE MODEL</strong> process so the time taken by the AutoML job <span class="No-Break">is reduced.</span></p>
			<p>We are going to explore the model type and problem type parameters of the <strong class="source-inline">CREATE MODEL</strong> statement in this chapter. As part of <strong class="source-inline">CREATE MODEL</strong> with user guidance, you also have the option of setting a preprocessor, but we will leave that topic for <a href="B19071_10.xhtml#_idTextAnchor178"><span class="No-Break"><em class="italic">Chapter 10</em></span></a><span class="No-Break">.</span></p>
			<p>When you are guiding the AutoML job, as a machine learning model creator, you are going to decide what algorithm to use and what problem type to address. Redshift ML still performs the feature engineering of independent variables behind the scenes – for example, out of 20 features, Redshift ML will automatically identify the categorical variables and numeric variables and create a one-hot-encoded value or standardization of numerical variables where applicable, along with various other tasks required to complete the <span class="No-Break">model training.</span></p>
			<p>In summary, you are letting Redshift ML handle the bulk of data preparation tasks for machine learning. As a model creator, you have the option to specify the algorithm and problem type to be used in the <strong class="source-inline">CREATE MODEL</strong> statement, which has the benefit of reduced training time, since SageMaker does not need to spend time determining which algorithm or problem type <span class="No-Break">to use.</span></p>
			<p>Now that we have learned what <strong class="source-inline">CREATE MODEL</strong> with user guidance is, let’s start creating a simple <span class="No-Break">regression <a id="_idTextAnchor117"/>model.</span></p>
			<h1 id="_idParaDest-103">Creating a simple linear regression model using X<a id="_idTextAnchor118"/>GBoost</h1>
			<p>To build <a id="_idIndexMarker339"/>our simple linear regression problem, we are going to take a look at a dataset that includes predicting weight based on height. This dataset has only one independent variable, which is height in inches, and is used to predict weight in pounds. Since there is only one independent variable, we call this the <strong class="bold">simple linear </strong><span class="No-Break"><strong class="bold">regression</strong></span><span class="No-Break"> model.</span></p>
			<p>In this section, we <a id="_idIndexMarker340"/>will upload the data, analyze it, prepare it for training the model, and then lastly, we will create the model and run prediction queries using the function created by <span class="No-Break">th<a id="_idTextAnchor119"/>e model.</span></p>
			<h2 id="_idParaDest-104"><a id="_idTextAnchor120"/>Uploading and analyzing the data</h2>
			<p>We <a id="_idIndexMarker341"/>are going to work on a height and weight dataset in <span class="No-Break">this section.</span></p>
			<p>The dataset contains 25,000 synthetic records of human heights and weights of 18-year-old participants. This data was generated based on a 1993 Growth Survey, which was conducted on 25,000 children from their birth to 18 years of age. The participants were recruited<a id="_idIndexMarker342"/> from <strong class="bold">Maternal and Child Health Centers</strong> (<strong class="bold">MCHCs</strong>) and schools, and the data collected was used to develop Hong Kong’s current growth charts for weight, height, weight-for-age, <a id="_idIndexMarker343"/>weight-for-height, and <strong class="bold">body mass </strong><span class="No-Break"><strong class="bold">index</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">BMI</strong></span><span class="No-Break">).</span></p>
			<p>More details about this dataset can be found <span class="No-Break">here: </span><a href="http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights"><span class="No-Break">http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights</span></a><span class="No-Break">.</span></p>
			<p class="callout-heading">Dataset citation</p>
			<p class="callout">Hung-Kwan So, Edmund AS Nelson, Albert M Li, Eric MC Wong, Joseph TF Lau, Georgia S Guldan, Kwok-Hang Mak, Youfa Wang, Tai-Fai Fok, and Rita YT Sung. (2008) <em class="italic">Secular changes in height, weight, and body mass index in Hong Kong Children</em>. BMC Public Health. 2008; 8: 320. doi: 10.1186/1471-2458-8-320. <span class="No-Break">PMCID: PMC2572616</span></p>
			<p class="callout">Leung SS, Lau JT, Tse LY, Oppenheimer SJ. <em class="italic">Weight-for-age and weight-for-height references for Hong Kong children from birth to 18 years</em>. J Paediatr Child Health. 1996;32:103–109. <span class="No-Break">doi: 10.1111/j.1440-1754.1996.tb00904.x.</span></p>
			<p class="callout">Leung SS, Lau JT, Xu YY, Tse LY, Huen KF, Wong GW, Law WY, Yeung VT, Yeung WK, et al. <em class="italic">Secular changes in standing height, sitting height and sexual maturation of Chinese–the Hong Kong Growth Study, 1993</em>. Ann Hum Biol. 1996;23:297–306. <span class="No-Break">doi: 10.1080/03014469600004532.</span></p>
			<p>In the following subsections, we will discuss the prediction goals we are trying to achieve using this dataset and then analyz<a id="_idTextAnchor121"/>e <span class="No-Break">the data.</span></p>
			<h3>Prediction goal</h3>
			<p>The <a id="_idIndexMarker344"/>goal is to predict the weight of children as a numeric value based on supplied height as a <span class="No-Break">numeric value.</span></p>
			<p>The dataset has the <span class="No-Break">following columns:</span></p>
			<table id="table001-3" class="No-Table-Style _idGenTablePara-1">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="bold">Column</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break"><strong class="bold">Description</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break">Index</span></p>
						</td>
						<td class="No-Table-Style">
							<p><span class="No-Break">Sequential number</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>Height <span class="No-Break">in Inches</span></p>
						</td>
						<td class="No-Table-Style">
							<p>Height of a child as a <span class="No-Break">numerical value</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>Weight <span class="No-Break">in Pounds</span></p>
						</td>
						<td class="No-Table-Style">
							<p>Weight of a child as a <span class="No-Break">numerical value</span></p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.1 –  Data definition</p>
			<h3><a id="_idTextAnchor122"/>Analyzing the data</h3>
			<p>After <a id="_idIndexMarker345"/>successfully connecting to Redshift as an admin or database developer, create the schema and load data into Amazon Redshift <span class="No-Break">as follows:</span></p>
			<ol>
				<li>Navigate to <strong class="bold">Redshift query editor v2</strong> and connect to the <strong class="bold">Serverless</strong> endpoint and then the <span class="No-Break"><strong class="bold">dev</strong></span><span class="No-Break"> database.</span></li>
				<li>Name the untitled query editor by saving it <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">Chapter7</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p>The following screenshot shows a serverless connection, the database set to <strong class="bold">dev</strong>, and the <strong class="bold">Redshift query editor</strong> page saved <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">Chapter7<a id="_idTextAnchor123"/></strong></span><span class="No-Break">:</span></p>
			<p class="IMG---Figure"><a id="_idTextAnchor124"/></p>
			<div>
				<div id="_idContainer121" class="IMG---Figure">
					<img src="image/B19071_07_02.jpg" alt="Figure 7.2 – Connecting to the Serverless endpoint"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – Connecting to the Serverless endpoint</p>
			<ol>
				<li value="3">Create <a id="_idIndexMarker346"/>the schema <span class="No-Break">as follows:</span><pre class="source-code">
create schema chapter7_RegressionModel;</pre></li>
				<li>Create a table using the <span class="No-Break">following code:</span><pre class="source-code">
--create table to load data</pre><pre class="source-code">
DROP TABLE chapter7_RegressionModel.height_weight;</pre><pre class="source-code">
CREATE TABLE chapter7_RegressionModel.height_weight</pre><pre class="source-code">
(</pre><pre class="source-code">
    Id integer,</pre><pre class="source-code">
    HeightInches decimal(9,2),</pre><pre class="source-code">
    weightPounds decimal(9,2)</pre><pre class="source-code">
)</pre><pre class="source-code">
;</pre></li>
				<li>Load the sample data by using the <span class="No-Break">following command:</span><pre class="source-code">
<strong class="bold">TRUNCATE chapter7_RegressionModel.height_weight;</strong></pre><pre class="source-code">
COPY chapter7_RegressionModel.height_weight</pre><pre class="source-code">
FROM 's3://packt-serverless-ml-redshift/chapter07/heightweight/HeightWeight.csv'</pre><pre class="source-code">
IAM_ROLE default</pre><pre class="source-code">
CSV</pre><pre class="source-code">
IGNOREHEADER 1</pre><pre class="source-code">
REGION AS 'eu-west-1';</pre></li>
				<li>Analyze the <a id="_idIndexMarker347"/>height and weight dataset table by creating a <span class="No-Break">histogram chart.</span></li>
				<li>Use the Query Editor v2 <strong class="bold">Chart</strong> feature to create a graph. First, run the following command and then click on the <strong class="bold">Chart</strong> option found on the right-hand side in the <span class="No-Break"><strong class="bold">Results</strong></span><span class="No-Break"> pane:</span><pre class="source-code">
SELECT * FROM</pre><pre class="source-code">
chapter7_RegressionModel.height_weight</pre><pre class="source-code">
ORDER BY 2,3;</pre></li>
			</ol>
			<p>To generate the following chart, you need to add two traces to your chart. By default, the chart is loaded with one trace, so you need to add one additional trace. You can add it by clicking on the <strong class="bold">+ </strong><span class="No-Break"><strong class="bold">Trace</strong></span><span class="No-Break"> button.</span></p>
			<p>The following chart shows both variables. For <em class="italic">trace 1</em>, select <strong class="bold">heightinches</strong> on the <em class="italic">y</em> axis, leaving the <em class="italic">x</em> axis empty. For <em class="italic">trace 2</em>, select <strong class="bold">weightpounds</strong> on the <em class="italic">y</em> axis, leaving the <em class="italic">x</em> axis empty. The resulting chart should look <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer122" class="IMG---Figure">
					<img src="image/B19071_07_03.jpg" alt="Figure 7.3 – Weights and heights"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Weights and heights</p>
			<p>As you can see, there<a id="_idIndexMarker348"/> is a slight upward trend in weights along <span class="No-Break">with heights.</span></p>
			<p>Now that we have analyzed our dataset, we will split it into training and validation sets. The training set will be used to train our model and the validation set will be used to evaluate the <span class="No-Break">model’s accuracy<a id="_idTextAnchor125"/>.</span></p>
			<h2 id="_idParaDest-105"><a id="_idTextAnchor126"/>Splitting data into training and validation sets</h2>
			<p>Since we <a id="_idIndexMarker349"/>have only one dataset, let’s write a query that splits data into two logical sets: training <span class="No-Break">and validation.</span></p>
			<p>To train the model, let’s use the syntax <em class="italic">where id%8 is not equal </em><span class="No-Break"><em class="italic">to 0</em></span><span class="No-Break">:</span></p>
			<pre class="source-code">
SELECT * FROM
chapter7_RegressionModel.height_weight Where id%8!=0;</pre>
			<p>To validate the model, let’s use <em class="italic">where id%8 is equal </em><span class="No-Break"><em class="italic">to 0</em></span><span class="No-Break">:</span></p>
			<pre class="source-code">
SELECT * FROM
chapter7_RegressionModel.height_weight Where id%8=<a id="_idTextAnchor127"/>0;</pre>
			<p>We have analyzed and prepared our input data, now let’s create a machine <span class="No-Break">learning model.</span></p>
			<h2 id="_idParaDest-106"><a id="_idTextAnchor128"/>Creating a simple linear regression model</h2>
			<p>In this section, you<a id="_idIndexMarker350"/> will use <strong class="source-inline">CREATE MODEL</strong> with user guidance to create a simple linear regression model using the XGBoost algorithm. We will address the weight prediction problem by training a machine learning model. The goal of this model is to predict a weight based on a <span class="No-Break">given height.</span></p>
			<p>We set <strong class="source-inline">MODEL_TYPE</strong> as <strong class="source-inline">xgboost</strong> and <strong class="source-inline">PROBLEM_TYPE</strong> as <strong class="source-inline">regression</strong>. We leave other options <span class="No-Break">as default:</span></p>
			<pre class="source-code">
DROP MODEL chapter7_RegressionModel.predict_weight;
CREATE MODEL chapter7_RegressionModel.predict_weight
FROM (select heightinches, cast(round(weightpounds,0) as integer) weightpounds from chapter7_RegressionModel.height_weight where id%8!=0 )
TARGET weightpounds
FUNCTION predict_weight
IAM_ROLE default
MODEL_TYPE xgboost
PROBLEM_TYPE regression
OBJECTIVE 'mse'
SETTINGS (s3_bucket '&lt;&lt;your-S3-bucket&gt;&gt;',
          s3_garbage_collect off,
          max_runtime 3600);</pre>
			<p>Let’s take a look at the options we provided in the <strong class="source-inline">CREATE MODEL</strong> statement and discuss how they affect the actions taken by <span class="No-Break">Amazon SageMaker</span></p>
			<p>In the <strong class="source-inline">CREATE MODEL</strong> statement, we are guiding Redshift ML to use XGBoost as an algorithm by setting <strong class="source-inline">MODEL_TYPE</strong>. The Amazon SageMaker Autopilot job will not train the model using other supported algorithms – for example, <strong class="bold">Linear Learner</strong> or <strong class="bold">multilayer perceptron</strong> (<strong class="bold">MLP</strong>). When<a id="_idIndexMarker351"/> this option is left as default, Amazon SageMaker <a id="_idIndexMarker352"/>will train the model using all the algorithms supported <span class="No-Break">by Autopilot.</span></p>
			<p>Next, when we set <strong class="source-inline">PROBLEM_TYPE</strong> to <strong class="source-inline">regression</strong>, we are guiding Redshift ML to search for a model to solve a regression <span class="No-Break">problem type.</span></p>
			<p>We set <strong class="source-inline">OBJECTIVE</strong> <a id="_idTextAnchor129"/>to <strong class="source-inline">mse</strong> (<strong class="bold">mean squared error</strong>), which<a id="_idIndexMarker353"/> is commonly used to evaluate the performance of a regression model. It is a measure of the average of the squared differences between the predicted values and the <span class="No-Break">actual values.</span></p>
			<p>With these<a id="_idIndexMarker354"/> three guiding options, we are creating boundaries for Amazon SageMaker Autopilot. The end result would be less training time bundled with other benefits of the Autopilot algorithm – for example, adjusting hyperparameters and data preprocessing steps, which are all auto-handled by Amazon <span class="No-Break">SageMaker Autopilot.</span></p>
			<p>To check the status of the model, run the <span class="No-Break">following command:</span></p>
			<pre class="source-code">
SHOW MODEL chapter7_RegressionModel.predict_weight;</pre>
			<p>The following screenshot shows the output of the <strong class="source-inline">SHOW </strong><span class="No-Break"><strong class="source-inline">MODEL</strong></span><span class="No-Break"> command:</span></p>
			<div>
				<div id="_idContainer123" class="IMG---Figure">
					<img src="image/B19071_07_04.jpg" alt="Figure 7.4 – SHOW MODEL output"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – SHOW MODEL output</p>
			<p>The model is <a id="_idIndexMarker355"/>still under training, but you will notice that Redshift ML is picking up <strong class="bold">Model Type</strong>, <strong class="bold">Problem Type</strong>, and <strong class="bold">Objective</strong> parameter values from our <strong class="source-inline">CREATE </strong><span class="No-Break"><strong class="source-inline">MODEL</strong></span><span class="No-Break"> statement.</span></p>
			<p>The <strong class="bold">Function Name</strong> parameter, <strong class="source-inline">predict_weight</strong>, is used to generate predictions and is used in the <strong class="source-inline">SELECT</strong> statement, which we will cover in the <span class="No-Break">next section.</span></p>
			<p>Run the <strong class="source-inline">SHOW MODEL</strong> command again after some time to check whether the model training is complete or not. From the following screenshot, you can see that model training has finished and MSE has been selected as the objective for model evaluation. This is auto-selected by the Redshift ML and is the correct evaluation method for linear <span class="No-Break">regression m<a id="_idTextAnchor130"/>odels:</span></p>
			<div>
				<div id="_idContainer124" class="IMG---Figure">
					<img src="image/B19071_07_05.jpg" alt="Figure 7.5 – SHOW MODEL output – model ready state"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 – SHOW MODEL output – model ready state</p>
			<p>We have trained<a id="_idIndexMarker356"/> and created the model; in the next step, we will generate <span class="No-Break">the predi<a id="_idTextAnchor131"/>ctions.</span></p>
			<h2 id="_idParaDest-107"><a id="_idTextAnchor132"/>Running predictions</h2>
			<p>Since our model <a id="_idIndexMarker357"/>has been successfully trained, let’s run some predictions against <span class="No-Break">unseen datasets.</span></p>
			<p>Run the following query to find records where the model is exactly predicting weight in pounds for a given height in inches where <strong class="source-inline">id%8=0</strong>. By using <strong class="source-inline">WHERE id%8=0</strong>, we are looking at ~20% of our dataset. These are records that were not included in model training. If you recall, in the <strong class="source-inline">CREATE MODEL</strong> statement, we specified <strong class="source-inline">WHERE </strong><span class="No-Break"><strong class="source-inline">id%8 !=0</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
SELECT heightinches, CAST(chapter7_RegressionModel.predict_weight(CAST(ROUND(heightinches,0) as integer)) as INTEGER) as Predicted_Weightpounds,
  CAST(ROUND(weightpounds,0) as INTEGER) Original_Weightpounds ,
  Predicted_Weightpounds - Original_Weightpounds  as Difference
  FROM chapter7_RegressionModel.height_weight WHERE id%8=0
  AND Predicted_Weightpounds - Original_Weightpounds = 0;</pre>
			<p>Here is the<a id="_idIndexMarker358"/> output <span class="No-Break">for it:</span></p>
			<div>
				<div id="_idContainer125" class="IMG---Figure">
					<img src="image/B19071_07_06.jpg" alt="Figure 7.6 – Showing predicted weight results"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.6 – Showing predicted weight results</p>
			<p>Now, let’s check the MSE <a id="_idIndexMarker359"/>and <strong class="bold">root mean square </strong><span class="No-Break"><strong class="bold">error</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">RMSE</strong></span><span class="No-Break">):</span></p>
			<pre class="source-code">
  SELECT
   ROUND(AVG(POWER(( Original_Weightpounds - Predicted_Weightpounds ),2)),2) mse
    , ROUND(SQRT(AVG(POWER(( Original_Weightpounds - Predicted_Weightpounds ),2))),2) rmse
FROM
    ( select heightinches, cast(chapter7_RegressionModel.predict_weight(cast(round(heightinches,0) as integer)) as integer) as Predicted_Weightpounds,
  cast(round(weightpounds,0) as integer) Original_Weightpounds ,
  Predicted_Weightpounds - Original_Weightpounds as Difference
  from chapter7_RegressionModel.height_weight where id%8=0
);</pre>
			<p>Here is <span class="No-Break">the </span><span class="No-Break"><a id="_idIndexMarker360"/></span><span class="No-Break">output:</span></p>
			<div>
				<div id="_idContainer126" class="IMG---Figure">
					<img src="image/B19071_07_07.jpg" alt="Figure 7.7 – MSE and RMSE values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.7 – MSE and RMSE values</p>
			<p>Our MSE value is high; it represents data that may have outliers or for which we do not have enough variables. For example, adding age and gender may improve the <span class="No-Break">prediction score.</span></p>
			<p>Let’s compare predicted scores and original scores in a <span class="No-Break">line chart:</span></p>
			<pre class="source-code">
 select heightinches, cast(chapter7_RegressionModel.predict_weight(cast(round(heightinches,0) as integer)) as integer) as Predicted_Weightpounds,
  cast(round(weightpounds,0) as integer) Original_Weightpounds ,
  Predicted_Weightpounds - Original_Weightpounds as Difference
  from chapter7_RegressionModel.height_weight where id%8=0;</pre>
			<p>Once a response is returned, click on the <strong class="bold">Chart</strong> option found on the right-hand side in the Query Editor, add a trace for the line, and select <strong class="bold">Predicted_Weightpounds</strong>. Add another trace for the line chart and select <strong class="bold">Original_Weightpounds</strong>, then add a third trace, but this time, select <strong class="bold">Bar graph</strong> and add a <span class="No-Break"><strong class="bold">Difference</strong></span><span class="No-Break"> column.</span></p>
			<p>In the following chart, you will notice that the predicted scores are following the original scores. The difference is shown at the bottom of the graph, which gives information <a id="_idIndexMarker361"/>about the variance <span class="No-Break">or error:</span></p>
			<div>
				<div id="_idContainer127" class="IMG---Figure">
					<img src="image/B19071_07_08.jpg" alt="Figure 7.8 – Predicted versus original weights"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.8 – Predicted versus original weights</p>
			<p>We have learned about how a simple regression model is created using Redshift ML. Now let’s learn about the multi-input <span class="No-Break">regressi<a id="_idTextAnchor133"/>on model.</span></p>
			<h1 id="_idParaDest-108"><a id="_idTextAnchor134"/>Creating multi-input regression models</h1>
			<p>In this exercise, you will<a id="_idIndexMarker362"/> learn how to build a regression model using multiple input variables in Amazon <span class="No-Break">Redshift ML.</span></p>
			<p>In this use case, we will use a dataset containing the sales history of online sporting events. A sporting event management company wants to review the data for the latest football and baseball seasons to figure out which games underperformed for revenue, and what the revenue projections look like for <span class="No-Break">the season.</span></p>
			<p>Your task is to build and train a model to predict revenue for upcoming events in order to proactively take action to increase ticket sales to ensure revenue numbers meet the <span class="No-Break">company’s targets.</span></p>
			<p>After successfully connecting to Redshift as an admin or database developer, load data into <span class="No-Break">Amazon Redshift.</span></p>
			<p>Navigate to <strong class="bold">Redshift query editor v2</strong> and connect to the <strong class="bold">Serverless</strong> endpoint and the <span class="No-Break"><strong class="bold">dev</strong></span><span class="No-Break"> database.</span></p>
			<p>Use the same schema and <strong class="bold">query editor</strong> page you created for the <span class="No-Break">previous exercise.</span></p>
			<p>Create your input <a id="_idIndexMarker363"/>table and load the data using the following <span class="No-Break">SQL commands:</span></p>
			<pre class="source-code">
CREATE TABLE chapter7_RegressionModel.sporting_event_ticket_info (
ticket_id double precision ,
event_id bigint,
sport character varying(500),
event_date_time timestamp without time zone,
home_team character varying(500),
away_team character varying(500),
location character varying(500),
city character varying(500),
seat_level bigint,
seat_section bigint,
seat_row character varying(500),
seat bigint ENCODE az64,
list_ticket_price double precision,
final_ticket_price double precision ,
ticketholder character varying(500)
)
DISTSTYLE AUTO;
COPY chapter7_RegressionModel.sporting_event_ticket_info
FROM 's3://packt-serverless-ml-redshift/chapter07/ticket_info'
IAM_ROLE default
FORMAT AS CSV DELIMITER ',' QUOTE '"'
REGION AS 'eu-west-1';</pre>
			<p>Let’s analyze <a id="_idIndexMarker364"/>our dataset and get a historical trend of ticket sales over the last <span class="No-Break">few months:</span></p>
			<pre class="source-code">
Select extract(month from event_date_time) as month,
sum(cast (final_ticket_price as decimal(8,2))) as ticket_revenue
From chapter7_RegressionModel.sporting_event_ticket_info
where event_date_time &lt; '2019-10-27'
group by 1
order by 1;</pre>
			<p>The output is <span class="No-Break">as follows:</span></p>
			<div>
				<div id="_idContainer128" class="IMG---Figure">
					<img src="image/B19071_07_09.jpg" alt="Figure 7.9 – Ticket revenue by month"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.9 – Ticket revenue by month</p>
			<p>We can see that sales are spiky and fall off dramatically in months <strong class="bold">7</strong> and <strong class="bold">8</strong>. Let’s create a model so we can predict teams that will have lower ticket revenue. Before creating our model, we need to split the dataset into training, validation, and testing <span class="No-Break">datasets, respectively.</span></p>
			<ol>
				<li>Execute the following code in Query Editor v2 to create the <span class="No-Break"><strong class="source-inline">training</strong></span><span class="No-Break"> table:</span><pre class="source-code">
CREATE TABLE chapter7_RegressionModel.sporting_event_ticket_info_training (</pre><pre class="source-code">
    ticket_id double precision ,</pre><pre class="source-code">
    event_id bigint,</pre><pre class="source-code">
    sport character varying(500),</pre><pre class="source-code">
    event_date_time timestamp without time zone,</pre><pre class="source-code">
    home_team character varying(500),</pre><pre class="source-code">
    away_team character varying(500),</pre><pre class="source-code">
    location character varying(500),</pre><pre class="source-code">
    city character varying(500),</pre><pre class="source-code">
    seat_level bigint,</pre><pre class="source-code">
    seat_section bigint,</pre><pre class="source-code">
    seat_row character varying(500),</pre><pre class="source-code">
    seat bigint ENCODE az64,</pre><pre class="source-code">
    list_ticket_price double precision,</pre><pre class="source-code">
    final_ticket_price double precision ,</pre><pre class="source-code">
    ticketholder character varying(500)</pre><pre class="source-code">
)</pre><pre class="source-code">
DISTSTYLE AUTO;</pre></li>
				<li>The next step <a id="_idIndexMarker365"/>is to insert ~70% of the data into the <span class="No-Break"><strong class="source-inline">training</strong></span><span class="No-Break"> table:</span><pre class="source-code">
--insert ~70% of data into training_set</pre><pre class="source-code">
insert into   chapter7_RegressionModel.sporting_event_ticket_info_training</pre><pre class="source-code">
(  ticket_id ,event_id ,sport , event_date_time,  home_team , away_team , location , city , seat_level, seat_section,</pre><pre class="source-code">
    seat_row ,  seat, list_ticket_price, final_ticket_price, ticketholder )</pre><pre class="source-code">
 select</pre><pre class="source-code">
 ticket_id ,event_id ,sport , event_date_time,  home_team , away_team , location , city , seat_level, seat_section,</pre><pre class="source-code">
    seat_row ,  seat, list_ticket_price, final_ticket_price, ticketholder</pre><pre class="source-code">
 from chapter7_RegressionModel.sporting_event_ticket_info</pre><pre class="source-code">
 where event_date_time &lt; '2019-10-20';</pre></li>
				<li>Next, you<a id="_idIndexMarker366"/> will create the <span class="No-Break"><strong class="source-inline">validation</strong></span><span class="No-Break"> table:</span><pre class="source-code">
CREATE TABLE chapter7_RegressionModel.sporting_event_ticket_info_validation (</pre><pre class="source-code">
    ticket_id double precision ,</pre><pre class="source-code">
    event_id bigint,</pre><pre class="source-code">
    sport character varying(500),</pre><pre class="source-code">
    event_date_time timestamp without time zone,</pre><pre class="source-code">
    home_team character varying(500),</pre><pre class="source-code">
    away_team character varying(500),</pre><pre class="source-code">
    location character varying(500),</pre><pre class="source-code">
    city character varying(500),</pre><pre class="source-code">
    seat_level bigint,</pre><pre class="source-code">
    seat_section bigint,</pre><pre class="source-code">
    seat_row character varying(500),</pre><pre class="source-code">
    seat bigint ENCODE az64,</pre><pre class="source-code">
    list_ticket_price double precision,</pre><pre class="source-code">
    final_ticket_price double precision ,</pre><pre class="source-code">
    ticketholder character varying(500)</pre><pre class="source-code">
)</pre><pre class="source-code">
DISTSTYLE AUTO;</pre></li>
				<li>Next, insert ~10% of the<a id="_idIndexMarker367"/> data into the <span class="No-Break"><strong class="source-inline">validation</strong></span><span class="No-Break"> table:</span><pre class="source-code">
insert into  chapter7_RegressionModel.sporting_event_ticket_info_validation</pre><pre class="source-code">
(  ticket_id ,event_id ,sport , event_date_time,  home_team , away_team , location , city , seat_level, seat_section,</pre><pre class="source-code">
    seat_row ,  seat, list_ticket_price, final_ticket_price, ticketholder )</pre><pre class="source-code">
 select</pre><pre class="source-code">
 ticket_id ,event_id ,sport , event_date_time,  home_team , away_team , location , city , seat_level, seat_section,</pre><pre class="source-code">
    seat_row ,  seat, list_ticket_price, final_ticket_price, ticketholder</pre><pre class="source-code">
 from chapter7_RegressionModel.sporting_event_ticket_info</pre><pre class="source-code">
 where event_date_time between '2019-10-20' and '2019-10-22' ;</pre></li>
				<li>Finally, create <a id="_idIndexMarker368"/>the <span class="No-Break"><strong class="source-inline">testing</strong></span><span class="No-Break"> table:</span><pre class="source-code">
CREATE TABLE chapter7_RegressionModel.sporting_event_ticket_info_testing (</pre><pre class="source-code">
    ticket_id double precision ,</pre><pre class="source-code">
    event_id bigint,</pre><pre class="source-code">
    sport character varying(500),</pre><pre class="source-code">
    event_date_time timestamp without time zone,</pre><pre class="source-code">
    home_team character varying(500),</pre><pre class="source-code">
    away_team character varying(500),</pre><pre class="source-code">
    location character varying(500),</pre><pre class="source-code">
    city character varying(500),</pre><pre class="source-code">
    seat_level bigint,</pre><pre class="source-code">
    seat_section bigint,</pre><pre class="source-code">
    seat_row character varying(500),</pre><pre class="source-code">
    seat bigint ENCODE az64,</pre><pre class="source-code">
    list_ticket_price double precision,</pre><pre class="source-code">
    final_ticket_price double precision ,</pre><pre class="source-code">
    ticketholder character varying(500)</pre><pre class="source-code">
)</pre><pre class="source-code">
DISTSTYLE AUTO;</pre></li>
				<li>Next, insert ~20% of the data into the <span class="No-Break"><strong class="source-inline">testing</strong></span><span class="No-Break"> table:</span><pre class="source-code">
insert into   chapter7_RegressionModel.sporting_event_ticket_info_testing</pre><pre class="source-code">
(  ticket_id ,event_id ,sport , event_date_time,  home_team , away_team , location , city , seat_level, seat_section,</pre><pre class="source-code">
    seat_row ,  seat, list_ticket_price, final_ticket_price, ticketholder )</pre><pre class="source-code">
select</pre><pre class="source-code">
 ticket_id ,event_id ,sport , event_date_time,  home_team , away_team , location , city , seat_level, seat_section,</pre><pre class="source-code">
    seat_row ,  seat, list_ticket_price, final_ticket_price, ticketholder</pre><pre class="source-code">
 from chapter7_RegressionModel.sporting_event_ticket_info</pre><pre class="source-code">
 where event_date_time &gt;  '2019-10-22'</pre><pre class="source-code">
 ;</pre></li>
			</ol>
			<p>We have prepared <a id="_idIndexMarker369"/>the dataset to train and test the ML model; now let’s create a regression model using the Linear <span class="No-Break">Learner algorithm.</span></p>
			<h2 id="_idParaDest-109"><a id="_idTextAnchor135"/>Linear Learner algorithm</h2>
			<p>As we<a id="_idIndexMarker370"/> saw in <a href="B19071_06.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, you can use the Linear Learner model type to solve classification or regression problems. This is a supervised learning algorithm. For regression problems, we are trying to predict a numerical outcome and, in this exercise, we will be using multiple inputs; SageMaker will choose the best modes based on continuous objectives <span class="No-Break">using MSE.</span></p>
			<p>We provide a training set with data that contains our inputs or observations about the data and the label, which represents the value we want to predict. Our goal is to accurately predict future <span class="No-Break">ticket sales.</span></p>
			<p>We set <strong class="source-inline">MODEL_TYPE</strong> as <strong class="source-inline">LINEAR_LEARNER</strong>, <strong class="source-inline">PROBLEM_TYPE</strong> as <strong class="source-inline">regression</strong>, and <strong class="source-inline">OBJECTIVE</strong> as <strong class="source-inline">mse</strong>. We leave out other options <span class="No-Break">as default.</span></p>
			<p>Execute this code in Query Editor v2 to train the model. Be sure to replace the following S3 bucket using the bucket you created previously. You will need to input the S3 bucket you created previously to store the Redshift <span class="No-Break">ML artifacts.</span></p>
			<p>Run the following <a id="_idIndexMarker371"/>command to train the <span class="No-Break">regression model:</span></p>
			<pre class="source-code">
CREATE MODEL chapter7_RegressionModel.predict_ticket_price_linlearn from
chapter7_RegressionModel.sporting_event_ticket_info_training
TARGET final_ticket_price
FUNCTION predict_ticket_price_linlearn
IAM_ROLE default
MODEL_TYPE LINEAR_LEARNER
PROBLEM_TYPE regression
OBJECTIVE 'mse'
SETTINGS (s3_bucket '&lt;&lt;your-S3-Bucket&gt;&gt;',
s3_garbage_collect off,
max_runtime 9600);</pre>
			<p>Once the model state is <strong class="bold">READY</strong>, you are ready to proceed.  To check the status of the model, run the <span class="No-Break">following command:</span></p>
			<pre class="source-code">
SHOW MODEL chapter7_RegressionModel.predict_ticket_price_linlearn;</pre>
			<p>Note the MSE score you see; it will be similar to the output in <span class="No-Break"><em class="italic">Figure 7</em></span><span class="No-Break"><em class="italic">.10</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer129" class="IMG---Figure">
					<img src="image/B19071_07_10.jpg" alt="Figure 7.10 – SHOW MODEL output"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.10 – SHOW MODEL output</p>
			<p>We have now <a id="_idIndexMarker372"/>created the ML model; let’s validate <span class="No-Break">its performance.</span></p>
			<h2 id="_idParaDest-110"><a id="_idTextAnchor136"/>Understanding model evaluation</h2>
			<p>You<a id="_idIndexMarker373"/> measure the model performance of regression problems through the MSE and/or RMSE. This is the distance between the predicted numeric target and the actual numeric answer, also known<a id="_idIndexMarker374"/> as <strong class="bold">ground truth</strong>. In our <strong class="source-inline">SHOW MODEL</strong> output, we see the MSE. We can also calculate this ourselves by squaring the differences between the actual and predicted values and then finding the average. Then, take the square root of MSE to get the RMSE. The lower the MSE and RMSE scores, <span class="No-Break">the better.</span></p>
			<p>As we see from the <strong class="source-inline">SHOW MODEL</strong> output, our MSE score is over 681 – let’s check this and the RMSE score against our validation by running the following <span class="No-Break">SQL command:</span></p>
			<pre class="source-code">
SELECT
      ROUND(AVG(POWER(( actual_price_revenue - predicted_price_revenue ),2)),2) mse
    , ROUND(SQRT(AVG(POWER(( actual_price_revenue - predicted_price_revenue ),2))),2) rmse
FROM
    (select home_team, chapter7_RegressionModel.predict_ticket_price_linlearn (ticket_id, event_id, sport, event_date_time, home_team, away_team,
Location, city, seat_level, seat_section, seat_row, seat,
list_ticket_price ,ticketholder ) as predicted_price_revenue,
 final_ticket_price  as actual_price_revenue
From chapter7_RegressionModel.sporting_event_ticket_info_validation
     );</pre>
			<p>This is the <a id="_idIndexMarker375"/>output of <span class="No-Break">the query:</span></p>
			<div>
				<div id="_idContainer130" class="IMG---Figure">
					<img src="image/B19071_07_11.jpg" alt="Figure 7.11 – MSE and RMSE values"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.11 – MSE and RMSE values</p>
			<p>While the MSE scores seem a little high, we can also run a validation query to check our accuracy rates. You will notice in the following query that it uses the function that was generated by our <strong class="source-inline">CREATE MODEL</strong> command to get the predicted price revenue for us to compare to the actual <span class="No-Break">price revenue:</span></p>
			<pre class="source-code">
Select home_team,
sum(cast(chapter7_RegressionModel.predict_ticket_price_linlearn (ticket_id, event_id, sport,
event_date_time, home_team, away_team,
Location, city, seat_level, seat_section, seat_row, seat,
list_ticket_price ,ticketholder ) as decimal(8,2) )) as predicted_price_revenue,
sum(cast (final_ticket_price as decimal(8,2))) as actual_price_revenue,
(predicted_price_revenue - actual_price_revenue) as diff,
abs((predicted_price_revenue - actual_price_revenue)/actual_price_revenue) * 100  as pct_diff
From chapter7_RegressionModel.sporting_event_ticket_info_validation
group by 1
order by 5 desc ;</pre>
			<p>This is the<a id="_idIndexMarker376"/> output of <span class="No-Break">the query:</span></p>
			<div>
				<div id="_idContainer131" class="IMG---Figure">
					<img src="image/B19071_07_12.jpg" alt="Figure 7.12 – Predicted price versus actual price"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.12 – Predicted price versus actual price</p>
			<p>Looking at the results, the model is not performing as well as we would like. You can run the validation query against the training data and see that the model is not performing very well on the training data either – this <a id="_idIndexMarker377"/>is <span class="No-Break">called </span><span class="No-Break"><strong class="bold">underfitting</strong></span><span class="No-Break">.</span></p>
			<p>One solution would be to add more features, but we have already used all the <span class="No-Break">available features.</span></p>
			<p>Let’s try running the model again, but this time, we will use the <strong class="source-inline">auto</strong> option and let SageMaker pick <span class="No-Break">the algorithm:</span></p>
			<pre class="source-code">
CREATE MODEL Chapter7_RegressionModel.predict_ticket_price_auto
from
chapter7_RegressionModel.sporting_event_ticket_info_training
TARGET final_ticket_price
FUNCTION predict_ticket_price_auto
IAM_ROLE default
PROBLEM_TYPE regression
OBJECTIVE 'mse'
SETTINGS (s3_bucket '&lt;&lt;your-S3-bucket&gt;&gt;',
s3_garbage_collect off,
max_runtime 9600);</pre>
			<p>After letting the <a id="_idIndexMarker378"/>model train for some time, check the status of the model <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
SHOW MODEL Chapter7_RegressionModel.predict_ticket_price_auto;</pre>
			<p>This is how <span class="No-Break">it appears:</span></p>
			<div>
				<div id="_idContainer132" class="IMG---Figure">
					<img src="image/B19071_07_13.jpg" alt="Figure 7.13 – SHOW MODEL output"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.13 – SHOW MODEL output</p>
			<p>From the <a id="_idIndexMarker379"/>preceding figure, we see that two things <span class="No-Break">stand out:</span></p>
			<ul>
				<li>The MSE score is <span class="No-Break">much better</span></li>
				<li>Amazon SageMaker chose to use the <span class="No-Break">XGBoost algorithm</span></li>
			</ul>
			<p>We can check the MSE and RMSE scores for our new model using our validation dataset <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
SELECT
      ROUND(AVG(POWER(( actual_price_revenue - predicted_price_revenue ),2)),2) mse
    , ROUND(SQRT(AVG(POWER(( actual_price_revenue - predicted_price_revenue ),2))),2) rmse
FROM
    (select home_team, chapter7_RegressionModel.predict_ticket_price_auto (ticket_id, event_id, sport, event_date_time, home_team, away_team,
Location, city, seat_level, seat_section, seat_row, seat,
list_ticket_price ,ticketholder ) as predicted_price_revenue,
 final_ticket_price  as actual_price_revenue
From chapter7_RegressionModel.sporting_event_ticket_info_validation
     );</pre>
			<p>This is <span class="No-Break">the output:</span></p>
			<div>
				<div id="_idContainer133" class="IMG---Figure">
					<img src="image/B19071_07_14.jpg" alt="Figure 7.14 – MSE and RMSE scores"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.14 – MSE and RMSE scores</p>
			<p>These MSE<a id="_idIndexMarker380"/> and RMSE values show that we have a <span class="No-Break">good model.</span></p>
			<p>Let’s run a validation query using the <strong class="source-inline">predict_ticket_price_auto</strong> function from the <span class="No-Break">new model:</span></p>
			<pre class="source-code">
Select home_team,
sum(cast(chapter7_RegressionModel.predict_ticket_price_auto (ticket_id, event_id, sport, event_date_time, home_team, away_team,
Location, city, seat_level, seat_section, seat_row, seat,
list_ticket_price ,ticketholder ) as decimal(8,2) )) as predicted_price_revenue,
sum(cast (final_ticket_price as decimal(8,2))) as actual_price_revenue,
(predicted_price_revenue - actual_price_revenue) as diff,
((predicted_price_revenue - actual_price_revenue)/actual_price_revenue) * 100  as pct_diff
From chapter7_RegressionModel.sporting_event_ticket_info_validation
group by 1
order by 5 desc;</pre>
			<p>The following is the output for <span class="No-Break">this query:</span></p>
			<div>
				<div id="_idContainer134" class="IMG---Figure">
					<img src="image/B19071_07_15.jpg" alt="Figure 7.15 – Predicted price versus actual price"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.15 – Predicted price versus actual price</p>
			<p>You can see<a id="_idIndexMarker381"/> we have much better results when comparing the differences between the actual and predicted ticket price revenue. We will use this model to do our <span class="No-Break">prediction queries.</span></p>
			<p>Run the following query to see which inputs contributed most to the <span class="No-Break">model prediction:</span></p>
			<pre class="source-code">
set search_path to chapter7_regressionmodel;
select json_table.report.explanations.kernel_shap.label0.global_shap_values from
 (select explain_model('predict_ticket_price_auto') as report) as json_table</pre>
			<p>To make the <a id="_idIndexMarker382"/>result set easier to read, right-click on the result set and choose <strong class="bold">Copy rows</strong>. You can then paste that into the editor as shown in <span class="No-Break"><em class="italic">Figure 7</em></span><span class="No-Break"><em class="italic">.16</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer135" class="IMG---Figure">
					<img src="image/B19071_07_16.jpg" alt="Figure 7.16 – Model explainability report"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.16 – Model explainability report</p>
			<p>This shows that <strong class="source-inline">list_ticket_price</strong> contributed the most weight and <strong class="source-inline">sport</strong> contributed the <span class="No-Break">least weight.</span></p>
			<p>We have validated the model with a validation dataset, checked the MSE values, and determined feature importance. Now let’s run the prediction query against <span class="No-Break">test data.</span></p>
			<h2 id="_idParaDest-111"><a id="_idTextAnchor137"/>Prediction query</h2>
			<p>Now that<a id="_idIndexMarker383"/> we have our model and have done validation, we can run our prediction query against our test dataset to determine which teams and events will need a proactive approach to increase ticket sales. Let’s check for teams with a predicted revenue of less <span class="No-Break">than 200K:</span></p>
			<pre class="source-code">
select t1.home_team, predicted_price_revenue
from
(Select home_team,
sum(cast(chapter7_RegressionModel.predict_ticket_price_auto (ticket_id, event_id, sport, event_date_time, home_team, away_team,
Location, city, seat_level, seat_section, seat_row, seat,
list_ticket_price ,ticketholder ) as decimal (8,2) ) ) as predicted_price_revenue
From chapter7_RegressionModel.sporting_event_ticket_info_testing
group by 1) t1
where predicted_price_revenue &lt; 200000;</pre>
			<p>This is <a id="_idIndexMarker384"/><span class="No-Break">the result:</span></p>
			<div>
				<div id="_idContainer136" class="IMG---Figure">
					<img src="image/B19071_07_17.jpg" alt="Figure 7.17 – Predicted price against the test dataset"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.17 – Predicted price against the test dataset</p>
			<p>There are 16 teams that are predicted to have reduced ticket revenue. You can share this information with your marketing teams to create a focused strategy to ensure ticket revenues can remain <span class="No-Break">on track.</span></p>
			<h1 id="_idParaDest-112"><a id="_idTextAnchor138"/>Summary</h1>
			<p>In this chapter, we discussed regression models in detail and saw how to create single-input and multi-input regression models. We learned how easy it is to predict a numeric value. We also learned how to validate regression models, take actions to improve our model’s accuracy, and do prediction queries with our regression models. We walked through options for using XGBoost, Linear Learner and <strong class="source-inline">auto</strong> options to train <span class="No-Break">your model.</span></p>
			<p>We also saw how we can check and validate the MSE score from the <strong class="source-inline">SHOW MODEL</strong> output using SQL commands <span class="No-Break">in Redshift.</span></p>
			<p>In the next chapter, we will show you how to create unsupervised models using the <span class="No-Break">K-means algorithm.</span></p>
		</div>
	</body></html>
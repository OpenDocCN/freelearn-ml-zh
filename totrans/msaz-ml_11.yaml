- en: Chapter 11. Publishing a Model as a Web Service
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 11 章。将模型作为 Web 服务发布
- en: So far, you have explored how to build different predictive models as experiments.
    Now, you might be wondering how that would be of use in real-life scenarios. One
    use of it is after you build and test your model, you can take a dataset and make
    a prediction straightaway inside the experiment, but in most of the cases, the
    result or the predictions of a model need to be used elsewhere and probably by
    some other people. Consider you have built a recommender model and it recommends
    items that a buyer might be interested in. So, these predictions require that
    the e-commerce site display the recommended product items to the prospective buyers.
    Consider one more scenario, where you have built a model for market segmentation
    using clustering. The marketing executive of your company should use this model
    for analysis by integrating the results in their software or simply by using the
    familiar Microsoft Excel.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你已经了解了如何构建不同的预测模型作为实验。现在，你可能想知道这在现实生活中的场景中会有什么用途。其中一个用途是在你构建和测试你的模型之后，你可以在实验中直接使用数据集进行预测，但在大多数情况下，模型的结果或预测需要用于其他地方，可能由其他人使用。考虑你构建了一个推荐模型，它推荐买家可能感兴趣的商品。因此，这些预测需要电子商务网站向潜在买家展示推荐的产品项。再考虑一个场景，你使用聚类构建了一个用于市场细分的模型。你的公司的营销主管应该通过将结果集成到他们的软件中或简单地使用熟悉的
    Microsoft Excel 来分析这个模型。
- en: Basically, you have to make the predictive model you have built available in
    an environment, so that people inside or outside your organization can use it.
    Traditionally, it used to be a cumbersome job, where a bunch of code had to be
    written and tested. Then, infrastructure had to be made ready as required.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上，你必须将你构建的预测模型在某个环境中可用，以便组织内部或外部的人可以使用它。传统上，这通常是一项繁琐的工作，需要编写和测试大量代码。然后，根据需要准备基础设施。
- en: Now, Azure ML takes all the pain out. In this chapter, you will explore, how
    easily you can publish a model in an experiment and make it available as a web
    service API for others to consume.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，Azure ML 消除了所有痛苦。在本章中，你将了解如何轻松地将模型发布到实验中，并将其作为 web 服务 API 使其他人可以使用。
- en: 'In a nutshell, you can publish your model in the following simple steps:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 简而言之，你可以按照以下简单步骤发布你的模型：
- en: Prepare your model to be published as a web service.
  id: totrans-5
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 准备你的模型以作为 web 服务发布。
- en: Prepare a scoring experiment.
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 准备评分实验。
- en: Specify the input and output for the web service.
  id: totrans-7
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定 web 服务的输入和输出。
- en: Publish and test it as a web service.
  id: totrans-8
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将其作为 web 服务发布和测试。
- en: Preparing an experiment to be published
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备要发布的实验
- en: You need to get your experiment ready before you start deploying it. To do this
    you need to complete your experiments, run them successfully, and evaluate and
    identify the trained model to be used. For illustration, we have a simple model
    here that predicts the income of adults based on age, education, sex, and race.
    The model uses the **Two-Class Decision Forest** module to predict whether a person
    has an income of more than 50K or not. The details to build the experiment can
    be found in [Chapter 7](ch07.html "Chapter 7. Classification Models"), *Classification
    Models*.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始部署之前，你需要准备好你的实验。为此，你需要完成你的实验，成功运行它们，评估并确定要使用的训练好的模型。为了说明，我们这里有一个简单的模型，它根据年龄、教育、性别和种族预测成年人的收入。该模型使用**双分类决策森林**模块来预测一个人是否有超过
    50K 的收入。构建实验的详细信息可以在[第 7 章](ch07.html "第 7 章。分类模型")*分类模型*中找到。
- en: '![Preparing an experiment to be published](img/0792EN_11_01.jpg)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![准备要发布的实验](img/0792EN_11_01.jpg)'
- en: Saving a trained model
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 保存训练好的模型
- en: 'Once you are sure about your model, you can save it as a trained model. To
    do this, right-click on the output port of the **Train Model** module on the canvas
    and then click on the **Save as Trained Model** option to save the trained model,
    which can be used later. You have to specify a name and the optional description
    text as the **Save trained model** popup appears. Then, click on the tick mark
    button to the right of the screen to save the trained model, as shown in the following
    screenshot:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你对你的模型有信心，你可以将其保存为训练好的模型。为此，在画布上右键单击**训练模型**模块的输出端口，然后单击**另存为训练模型**选项以保存训练好的模型，该模型以后可以使用。当出现**保存训练模型**弹出窗口时，你必须指定一个名称和可选的描述文本。然后，点击屏幕右侧的勾选按钮以保存训练好的模型，如下面的截图所示：
- en: '![Saving a trained model](img/0792EN_11_02.jpg)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![保存训练好的模型](img/0792EN_11_02.jpg)'
- en: The saved model will be like a predictor module, which can be used by a **Score
    Model** module to score with a given feature set. It will appear as a module on
    the left-hand side of the screen in the module palette under the **Trained Models**
    group.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 保存的模型将像预测模块一样，可以被**评分模型**模块使用给定的特征集进行评分。它将作为模块出现在屏幕左侧模块调色板中**训练模型**组下。
- en: If you have made any changes to the model say, you've changed the parameters
    to the algorithm, and so on, then you have to save the trained model again, and
    as the popup appears, tick the **This is the new version of an existing trained
    model** option at the top of the screen and choose the name of the previously
    saved model.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经对模型进行了任何更改，比如更改了算法的参数等，那么你必须重新保存训练模型，并且当弹出窗口出现时，在屏幕顶部勾选**这是现有训练模型的新版本**选项，并选择之前保存的模型名称。
- en: Creating a scoring experiment
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建评分实验
- en: 'A **scoring experiment** is one where you use a trained model module to make
    a prediction (scoring). You can create a new experiment, use a **Trained Model**
    module, and make a prediction with a dataset. ML Studio makes it really easy for
    you with a single button, as you can see in the following screenshot:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**评分实验**是指使用训练好的模型模块进行预测（评分）的实验。你可以创建一个新的实验，使用**训练模型**模块，并使用数据集进行预测。ML Studio
    通过一个按钮就能轻松实现这一点，如下面的截图所示：'
- en: '![Creating a scoring experiment](img/0792EN_11_13.jpg)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![创建评分实验](img/0792EN_11_13.jpg)'
- en: 'The button becomes active when the training experiment is run successfully.
    Run your **Income Predictor** experiment successfully and then click on the **CREATE
    SCORING EXPERIMENT** button to create a scoring experiment corresponding to the
    existing one. After this is done, you will see the following screenshot:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 当训练实验成功运行时，按钮会变为激活状态。成功运行你的**收入预测器**实验后，然后点击**创建评分实验**按钮来创建与现有实验相对应的评分实验。完成此操作后，你将看到以下截图：
- en: '![Creating a scoring experiment](img/0792EN_11_14.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![创建评分实验](img/0792EN_11_14.jpg)'
- en: 'Behind the scenes, ML Studio has done the following tasks for you:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在幕后，ML Studio 已经为你完成了以下任务：
- en: It saved your trained model as a module in the **Trained Models** section of
    the module palette to the left of the screen.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它将你的训练模型保存为屏幕左侧模块调色板中**训练模型**部分的模块。
- en: It created a copy of the existing training experiment then replaced the machine
    learning algorithm module and the **Train Model** module with the saved trained
    model.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它创建了现有训练实验的副本，然后替换了机器学习算法模块和**训练模型**模块，用保存的训练模型替换。
- en: It removed the modules that were clearly not needed in a scoring experiment—the
    **Split** and **Evaluate Model** modules in this case.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它移除了评分实验中明显不需要的模块——在这个例子中是**分割**和**评估模型**模块。
- en: It added the **Web service input** and **Web service output** modules and connected
    them to the default locations in the experiment.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它添加了**Web服务输入**和**Web服务输出**模块，并将它们连接到实验中的默认位置。
- en: You can also do these steps by yourself manually and create a scoring experiment.
    However, by creating the experiment this way, ML Studio links up the training
    and scoring experiment. When you open any one link, the other will be present
    as a tab so that you can switch between training and scoring your experiment easily.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以手动执行这些步骤并创建一个评分实验。然而，通过这种方式创建实验，ML Studio 会将训练和评分实验链接起来。当你打开任何一个链接时，另一个链接将以标签的形式出现，这样你就可以轻松地在训练和评分实验之间切换。
- en: The **Web service input** and the **Web service output** modules specify where
    the input goes into and where the output comes from when the model is published
    as a web service. Now that these modules are connected to the default position,
    you need to plan and connect these to the right modules.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '**Web服务输入**和**Web服务输出**模块指定了当模型作为Web服务发布时输入的去向和输出的来源。现在这些模块已经连接到默认位置，你需要计划和连接到正确的模块。'
- en: Specifying the input and output of the web service
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 指定 Web 服务的输入和输出
- en: 'Before publishing a web service, you need to specify what the web service will
    take as an input and which output you are interested in. Assume that for our illustration,
    we need to predict a level of someone''s income (that is, less than or equal to
    50K or greater than or equal to 50K) from the input: age, education, sex, and
    race. You can achieve this using the **Project Columns** module.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在发布网络服务之前，您需要指定网络服务将接受什么作为输入以及您感兴趣的输出。假设为了我们的说明，我们需要从输入中预测某人的收入水平（即小于或等于50K或大于或等于50K）：年龄、教育、性别和种族。您可以使用**项目列**模块实现这一点。
- en: 'In your web service, the input should go to the **Score Model** module. So,
    connect the **Web service input** module to the **Score Model** module. Add a
    **Project Columns** module and connect its input port to the output of the **Score
    Model** module. In the properties panel of the module, select the **Scored Labels**
    option only. Let''s take a look at the following screenshot:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的网络服务中，输入应进入**评分模型**模块。因此，将**网络服务输入**模块连接到**评分模型**模块。添加一个**项目列**模块，并将其输入端口连接到**评分模型**模块的输出。在模块属性面板中，仅选择**评分标签**选项。让我们看看以下截图：
- en: '![Specifying the input and output of the web service](img/0792EN_11_15.jpg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![指定网络服务的输入和输出](img/0792EN_11_15.jpg)'
- en: After running the experiment successfully, you can check the output of the two
    **Project Columns** modules in your scoring experiment; the output of which are
    as expected. Now, this experiment is ready to be published as a web service.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在实验成功运行后，您可以在评分实验中检查两个**项目列**模块的输出；其输出符合预期。现在，这个实验可以发布为网络服务。
- en: Publishing a model as a web service
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将模型发布为网络服务
- en: 'Publishing a model as a web service is very easy. To publish the model, click
    on the **PUBLISH WEB SERVICE** button and click on **YES** when it asks for confirmation,
    as shown in the following screenshot:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 将模型发布为网络服务非常简单。要发布模型，请点击**发布网络服务**按钮，并在它请求确认时点击**是**，如图所示：
- en: '![Publishing a model as a web service](img/0792EN_11_07.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![将模型发布为网络服务](img/0792EN_11_07.jpg)'
- en: It may take a while and once this is done, it would take you to the published
    web service dashboard page. You can get back to the parent scoring experiment
    by clicking on the link, which is the **View latest** option (refer to **2** in
    the following figure). The **View snapshot** link also takes you to the same parent
    scoring experiment, but it shows the experiment in a locked view.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能需要一段时间，一旦完成，它将带您进入已发布的网络服务仪表板页面。您可以通过点击链接返回父评分实验，该链接是**查看最新**选项（参见图中的**2**）。**查看快照**链接也会带您进入相同的父评分实验，但它以锁定视图显示实验。
- en: '![Publishing a model as a web service](img/0792EN_11_08.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![将模型发布为网络服务](img/0792EN_11_08.jpg)'
- en: The default endpoint or the published web service API suggests how the web service
    would be called or consumed. The **Request/Response** option (refer to **5** in
    the preceding figure) specifies that you would call the web service with one feature
    set and get a response as a prediction based on how you defined the output. The
    **Batch Execution** option (refer to **6** in the preceding figure) requires that
    you pass a dataset (a feature matrix) as a file and get the output prediction
    also as a dataset.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 默认端点或已发布的网络服务API建议如何调用或消费网络服务。**请求/响应**选项（参见图中的**5**）指定您将使用一个特征集调用网络服务，并根据您定义的输出获得一个基于预测的响应。**批量执行**选项（参见图中的**6**）要求您传递一个数据集（特征矩阵）作为文件，并获取作为数据集的输出预测。
- en: Visually testing a web service
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 视觉测试网络服务
- en: 'You can visually test the published web service by clicking on the **Test**
    button (refer to **7** in the preceding figure). Click on the button and a popup
    form appears. Fill up the different features to make a prediction. Fill the form
    and click on the button with the tick mark in the bottom-right corner of the screen,
    as shown in the following screenshot:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过点击**测试**按钮（参见图中的**7**）来视觉测试已发布的网络服务。点击按钮，将出现一个弹出表单。填写不同的特征以进行预测。填写表单，并点击屏幕右下角的勾选按钮，如图所示：
- en: '![Visually testing a web service](img/0792EN_11_09.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![视觉测试网络服务](img/0792EN_11_09.jpg)'
- en: 'After it gets a response from the web service, you would see a message, as
    shown in the following figure:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在从网络服务获得响应后，您将看到以下图所示的消息：
- en: '![Visually testing a web service](img/0792EN_11_10.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![视觉测试网络服务](img/0792EN_11_10.jpg)'
- en: As you can see in the preceding figure, it returned the predicted label **">50K"**.
    You can also test the web service by downloading the Excel file (refer to **8**),
    which is already configured to get connected with the web service. Just fill the
    fields to see the result.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 如前图所示，它返回了预测标签**">50K"**。您也可以通过下载Excel文件（参考**8**）来测试该网络服务，该文件已配置好以连接到网络服务。只需填写字段即可查看结果。
- en: Consuming a published web service
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 消费已发布的网络服务
- en: Now that the web service has been published and is available as an API, you
    can write a program in the language of your choice and consume the API to get
    a prediction or the result of the API. The API needs an **API key**, which you
    can find on the published web service dashboard page (refer to **4**). Without
    the API key, you won't be able to connect to the web service. On the API help
    page, you will find the detailed documentation on the published API, including
    the sample code in **C#.Net**, **Python**, and **R,** which include the necessary
    inline comments. You can find the links to the API help page from the same web
    service dashboard page (refer to **5** and **6**).
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 现在由于网络服务已发布并作为API提供，您可以使用您选择的编程语言编写程序，并消费API以获取预测或API的结果。API需要一个**API密钥**，您可以在已发布的网络服务仪表板页面上找到（参考**4**）。没有API密钥，您将无法连接到网络服务。在API帮助页面上，您将找到有关已发布API的详细文档，包括**C#.Net**、**Python**和**R**中的示例代码，其中包含必要的内联注释。您可以从相同的网络服务仪表板页面找到API帮助页面的链接（参考**5**和**6**）。
- en: Web service configuration
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络服务配置
- en: 'After you publish a model, the web service name will be available on the web
    services page with a link to the dashboard page of the web service, as shown in
    the following figure:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在发布模型后，网络服务名称将在网络服务页面中可用，并带有指向网络服务仪表板页面的链接，如下图所示：
- en: '![Web service configuration](img/0792EN_11_12.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![网络服务配置](img/0792EN_11_12.jpg)'
- en: Click on the name of the web service and on the dashboard page, click on the
    **CONFIGURATION** option (refer to **1**). On the configuration page, you can
    customize the information related to the web service, for example, **Display Name**,
    **Description**, **Input Schema**, **Output Schema**, and so on.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 点击网络服务的名称，在仪表板页面，点击**配置**选项（参考**1**）。在配置页面，您可以自定义与网络服务相关的信息，例如，**显示名称**、**描述**、**输入模式**、**输出模式**等。
- en: Updating the web service
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更新网络服务
- en: 'You might need to update your published web service under the following two
    scenarios:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下两种情况下，您可能需要更新您已发布的网络服务：
- en: Your original model changed, for example, you modified the model parameters
    to improve performance and so on
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您的原始模型已更改，例如，您修改了模型参数以改进性能等
- en: You need to make changes to the input or output of the web service
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您需要更改网络服务的输入或输出
- en: For the first case, you need to go back to your original training experiment,
    make the changes, run it, and then click on the **UPDATE SCORING EXPERIMENT**
    link to update the scoring experiment. For both the scenarios, you have to go
    to the scoring experiment and publish it again, so it would overwrite the previously
    published experiment.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 对于第一种情况，您需要回到您的原始训练实验，进行更改，运行它，然后点击**更新评分实验**链接以更新评分实验。对于这两种情况，您都必须回到评分实验并重新发布，因此它将覆盖之前发布的实验。
- en: Summary
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you explored the complete steps to publish a model as a web
    service, so that others can use the API and consume the web service. You prepared
    an experiment to make it ready to be published and saved a trained model. You
    then created a scoring experiment and prepared it to set the input and output
    for the web service. You published the scoring experiment as a web service and
    tested it visually. You also explored ways to consume the web service API and
    how it can be maintained over a period of time by making configuration changes
    and updates.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您探讨了将模型发布为网络服务的完整步骤，以便其他人可以使用API并消费网络服务。您准备了一个实验以使其准备好发布，并保存了一个训练好的模型。然后您创建了一个评分实验并为其设置了输入和输出。您将评分实验发布为网络服务并进行了视觉测试。您还探讨了如何消费网络服务API，以及如何通过进行配置更改和更新来维护它一段时间。
- en: In the next chapter, you will learn to build your own model with a case study
    exercise by solving a regression problem.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，您将通过解决回归问题案例研究练习来学习如何构建自己的模型。

<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Machine Learning Workouts on IBM Cloud</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will go through several sample machine learning (ML) exercises using the IBM Cloud platform to uncover the power of the <strong>Python</strong> language as the machine learning programming language of choice, and to look at the Machine Learning service offered by IBM Watson Studio.</p>
<p>This chapter will enable you to understand the practice of proper feature engineering as well as demonstrate the ability to run <strong>supervised</strong> (classification) and <strong>unsupervised</strong> (clustering) algorithms in the IBM Cloud, using IBM Watson Studio.</p>
<p>With simple practice examples, this chapter will guide you through the steps for implementing various machine learning projects using IBM Watson Studio.</p>
<p>We will break down this chapter into the following areas:</p>
<ul>
<li>Watson Studio and Python</li>
<li>Data cleansing and preparation</li>
<li>A k-means clustering example</li>
<li>A k-nearest neighbors example</li>
<li>A time series prediction example</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Watson Studio and Python</h1>
                </header>
            
            <article>
                
<p>As already mentioned, Python could very well be (currently anyway) the programming or scripting language most often chosen for predictive modeling and data science projects. A significant advance in the area of this type of computing is <strong>Jupyter</strong> <strong>Notebook </strong><span>(formerly, IPython)</span><strong> </strong>technology. </p>
<p>A Jupyter Notebook is a web-based environment aimed at interactive computing where you can run small bits of code to process data, and immediately view the results of that code. Notebooks include all of the building blocks you need to work with data:</p>
<ul>
<li>The data</li>
<li>The code computations that process the data</li>
<li>Visualizations of the results (of the code computations) </li>
<li>Text and rich media to enhance your understanding</li>
</ul>
<p>In addition, saved notebooks record how you worked with data, so you can more readily understand precisely what was done, reproduce those computations consistently, and even share your findings with others for collaboration.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up the environment</h1>
                </header>
            
            <article>
                
<p>With IBM Watson Studio, it is a pretty straightforward process to create a Python, Scala, or R notebook. These notebooks can then be used to analyze, clean, and transform data, and perform numerical simulations, statistical modeling, data visualization, machine learning, and other tasks.</p>
<p>To get us going with this chapter's example projects, we need to take the following steps to create a new project and add a notebook in IBM Watson Studio:</p>
<ol>
<li>Create a new project by first clicking on <span class="packt_screen">New project</span>; then, from the <span class="packt_screen">Create a project</span> page (shown as follows), find <span class="packt_screen">Deep Learning</span> and then click on <span class="packt_screen">Create Project</span>: </li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f7512f08-b341-49f1-aac4-50f81cac75e5.png"/></div>
<ol start="2">
<li>Next, select a region for the machine learning service to run in then click on <span class="packt_screen">Select</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/321b6281-219e-44ec-a392-f6982b168c4c.png" style=""/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="3">
<li>Name your project on the <span class="packt_screen">New project</span> page (shown as follows), and then click on <strong><span class="packt_screen">Create</span></strong>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/90e5823b-f22f-4a9a-9073-c2288db58240.png"/></div>
<ol start="4">
<li>Now that we have created a machine learning project, we are ready to create a notebook. Notebooks are considered a project asset that can be used and shared. To create a notebook from within the project, you click on <span class="packt_screen">Add to project</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3170542d-a10e-4a61-b32a-b8bf88250cde.png"/></div>
<ol start="5">
<li>Once you have clicked <span class="packt_screen">Add to project,</span> you need to choose an asset type. In previous examples, we selected the <span class="packt_screen">DATA</span> and <span class="packt_screen">DASHBOARD</span> asset types; here we will choose <span class="packt_screen">NOTEBOOK</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/1cf2e20b-3d25-4498-8391-30340dbecd56.png" style=""/></div>
<ol start="6">
<li>Like creating projects, once you select <span class="packt_screen">NOTEBOOK</span> as the asset type, you need to provide a name and description under the <span class="packt_screen">Name</span> and <span class="packt_screen">Description</span> options for the new notebook:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/edb38454-59c2-4f55-bb32-be741966b743.png" style=""/></div>
<ol start="7">
<li>In addition, in the bottom left-hand of the page, you will need to select a language for the notebook to use. Notice that the default is Python 3.5:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4a16726e-d614-4ea8-bd72-553f8cded7be.png" style=""/></div>
<ol start="8">
<li>Since we will use Python in our examples, we can simply click on <span class="packt_screen">Create Notebook</span>. Take note that IBM Watson Studio notebooks (currently) support the following runtime languages. Once you click on <span class="packt_screen">Create Notebook</span><span>, the notebook instance will be created and initialized for use:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a9e52a32-1a0f-4301-966b-18553971e9df.png" style=""/></div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Try it out</h1>
                </header>
            
            <article>
                
<p>Once your notebook has been instantiated, you are ready to run Python commands and code. Take notice of a couple of things in the following screenshot. For example, we have entered a snip of Python code in the first <strong>cell</strong> of the notebook that iterates with a for loop and prints columns of data. The other thing to notice is that we have clicked on <span class="packt_screen">Find and add data</span> and added a new file (<span class="packt_screen">winemag-data-130k-v2.csv</span>) as an asset, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5f1b68bc-79ce-45a8-962e-052b05884c27.png"/></div>
<p>To make things easy, we can click on the link below the file name <span class="packt_screen">Insert to code</span> and select <span class="packt_screen">Insert pandas DataFrame</span>. The result is that the appropriate <strong>Python</strong> modules (pandas<span> is a software library written for the </span>Python<span> programming language for data manipulation and analysis</span>) are imported for us and a Python DataFrame is automatically defined. This is shown in the notebook cell (<span class="packt_screen">In [9]</span>) in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/672d7e9e-b743-4abb-9e8d-44aea8215219.png"/></div>
<p>The output generated by the last line of code, <kbd>df_data_1.head()</kbd> is displayed in the notebook cell <span class="packt_screen">Out [9]</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0deb5d75-64e6-43de-b598-248b78704e27.png"/></div>
<p>Now we have a data asset (a CVS file) loaded and accessible in our Watson Studio project via a DataFrame object.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Data cleansing and preparation</h1>
                </header>
            
            <article>
                
<p>A common description for data cleansing and preparation is the work that goes into transforming <strong>raw data</strong> into a form that data scientists and analysts can more easily run through machine learning algorithms in an effort to uncover insights or make predictions based upon that data.</p>
<p>This process can be complicated by issues such as missing or incomplete records or simply finding extraneous columns of information within a data source.</p>
<p>In the previous example screenshot, we can see that the DataFrame object includes the columns <span class="packt_screen">country</span>, <span class="packt_screen">description</span>, <span class="packt_screen">designation</span>, <span class="packt_screen">points</span>, <span class="packt_screen">price</span>, <span class="packt_screen">province</span>, and so on.</p>
<p>As an exercise designed to demonstrate how easily we can use Python within Watson Studio to prepare data, let's suppose that we wanted to drop one or more columns from the DataFrame. To accomplish this task, we use the following Python statements:</p>
<pre>to_drop = ['points']<br/>df_data_1.drop(to_drop, inplace=True, axis=1)<br/>df_data_1.head()</pre>
<p>The preceding simple Python commands define the column name to be dropped from the DataFrame, that is, <span class="packt_screen">points</span> and then drop the column from the <kbd>df_data_1</kbd> DataFrame:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e5d8290b-33b3-44af-8b1b-ef923071a903.png"/></div>
<p>Within IBM Watson Studio, using the notebook we created earlier in this chapter, we can enter and run the preceding commands, and then use the <kbd>head()</kbd> function, to verify that the column we indicated has actually been dropped.</p>
<p>Although the preceding demonstration is simplistic and doesn't begin to break the surface on the process of data cleansing and preparation, it does demonstrate the ability to use Python easily in Watson Studio to access and manipulate data.</p>
<p>Rather than continuing with additional fundamental data manipulations, we'll move on to looking at something a bit more complex.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">K-means clustering using Python</h1>
                </header>
            
            <article>
                
<p>To recap from <a href="630e47b4-11b7-4be9-a881-8be2cb492314.xhtml">Chapter 4</a>, <em>Machine Learning Workouts on IBM Cloud</em>, <strong>k-means clustering</strong> is an unsupervised machine learning methodology—an algorithm that is commonly used to find groups within <strong>unlabeled</strong> data. Again, since the goal here is to demonstrate how you can apply this methodology to some data using Python in Watson Studio, we won't bother to dissect the details of how k-means works, but will show a working example of the algorithm, using Watson Studio as a proof of concept.</p>
<p>There are numerous examples available online and elsewhere demonstrating the use of Python to implement k-means logic. Here, we'll use an example that is simple to follow and uses available Python modules, such as <kbd>matplotlib</kbd>, <kbd>pandas</kbd>, and <kbd>scipy</kbd>.</p>
<p>Our exercise, using IBM Watson Studio and the Notebook (we created in the sections of this chapter) will:</p>
<ol>
<li>Create a DataFrame for a two-dimensional dataset</li>
<li>Find centroids for three clusters, and then for four clusters</li>
<li>Add a <strong>graphical user interface</strong> (<strong>GUI</strong>) to display the results</li>
</ol>
<div class="packt_infobox">
<p>The most representative point within a group is called the <strong>centroid</strong>. It is defined as the mean of the values of the points of <strong>data</strong> in the cluster. Each cluster should consist of the points of <strong>data</strong> closest to it.</p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Python code</h1>
                </header>
            
            <article>
                
<p>First, we can take a look at the Python code:</p>
<ol>
<li>This step references <kbd>pandas</kbd> and then defines our two-dimensional DataFrame. Note that the data is simply two lists of numbers, defined as <kbd>x</kbd> and <kbd>y</kbd>:</li>
</ol>
<pre style="padding-left: 60px">from pandas import DataFrame<br/>Data = {'x': [25,34,22,27,33,33,31,22,35,34,67,54,57,43,50,57,59,52,65,47,49,48,35,33,44,45,38,43,51,46],<br/>        'y': [79,51,53,78,59,74,73,57,69,75,51,32,40,47,53,36,35,58,59,50,25,20,14,12,20,5,29,27,8,7]<br/>      }<br/>df = DataFrame(Data,columns=['x','y'])<br/>print (df)</pre>
<p style="padding-left: 60px">The last command (<kbd>print(df)</kbd>) is added so that if you run the code, you'll get to see the output, which should match the dataset that was defined.</p>
<ol start="2">
<li>The next step is where we will use the <kbd>sklearn</kbd> Python module to find the centroids for three and then for four clusters, and the <kbd>matplotlib</kbd> module to create some charts to visualize the results of the algorithm.</li>
</ol>
<div class="packt_infobox">
<p>Scikit-learn provides a range of supervised as well as unsupervised learning algorithms through a consistent interface in Python. The library is built upon the SciPy (Scientific Python). <strong>Matplotlib</strong> is a plotting library for Python and its numerical mathematics extension NumPy (Wikipedia, 2019).</p>
</div>
<ol start="3">
<li>Once the DataFrame is created using the columns of data entered, the next block of Python code also imports the two aforementioned Python modules and specifies the number of clusters to create with the <kbd>KMeans</kbd> algorithm and finally uses <kbd>matplotlib</kbd> to generate some scatter plots:</li>
</ol>
<pre style="padding-left: 60px">from pandas import DataFrame<br/>import matplotlib.pyplot as plt<br/>from sklearn.cluster import KMeans<br/>Data = {'x': [25,34,22,27,33,33,31,22,35,34,67,54,57,43,50,57,59,52,65,47,49,48,35,33,44,45,38,43,51,46],<br/>        'y': [79,51,53,78,59,74,73,57,69,75,51,32,40,47,53,36,35,58,59,50,25,20,14,12,20,5,29,27,8,7]<br/>       }<br/>df = DataFrame(Data,columns=['x','y'])<br/>kmeans = KMeans(n_clusters=3).fit(df)<br/>centroids = kmeans.cluster_centers_<br/>print(centroids)<br/>plt.scatter(df['x'], df['y'], c= kmeans.labels_.astype(float), s=50, alpha=0.5)<br/>plt.scatter(centroids[:, 0], centroids[:, 1], c='red', s=50)<br/>plt.show()</pre>
<p style="padding-left: 60px">The output from the preceding Python code generates the following output: </p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a9533123-8cd6-4b3e-8098-3eb75bdc5f79.png" style=""/></div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Observing the results</h1>
                </header>
            
            <article>
                
<p>Note that the center of each of the three clusters (in red) represents the mean of all the observations that belong to that cluster. As you might also see, the observations that belong to a given cluster are closer to the center of that cluster, in comparison to the centers of other clusters.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Implementing in Watson</h1>
                </header>
            
            <article>
                
<p>Again, rather than dwell on the interpretation of the previous output, let's look at how we might be able to implement the same exercise using IBM Watson Studio. We could use the Notebook we created earlier in this chapter, but let's create a fresh new one (following the same procedure as we used earlier).</p>
<p class="mce-root"/>
<p>Once the Notebook is open and ready, we can run the Python code we just reviewed. First paste the original code block into the first Notebook cell and click on <span class="packt_screen">Run</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b149b8ea-b842-4add-92ee-4baebb557403.png" style=""/></div>
<p>Repeat the step but with the following code block:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/dfd6d6bd-059c-486b-84e2-a2fbbbcbb4fc.png" style=""/></div>
<p>This yields the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7f15e65f-507a-4fce-b065-29e457df3443.png" style=""/></div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Saving your work</h1>
                </header>
            
            <article>
                
<p>Once you are satisfied with the results, you should save your Notebook by clicking on <span class="packt_screen">File</span> and then <span class="packt_screen">Save</span>. Additionally, a nice feature is the ability to download the Notebook in various formats so that you can share with others who may not have access to Watson Studio. We will discuss this more in the next section.</p>
<p>For now, try navigating to <span class="packt_screen">File </span>| <span class="packt_screen">Download as</span> |<span class="packt_screen"> Python (.py)</span>, which will save all of the Python code blocks within the Notebook as a standard Python code file, which can be shared and run within other Python environments:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8c101e26-a377-4b63-9ec8-0d6875f613dd.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">K-nearest neighbors</h1>
                </header>
            
            <article>
                
<p>As the previous algorithm (<kbd>KMeans</kbd>) is an <strong>unsupervised</strong> learning methodology, the <strong>k-nearest neighbors</strong> (<strong>KNN</strong>) algorithm is a fundamentally simple to understand <strong>supervised</strong> machine learning methodology. The concept of the KNN algorithm is described commonly as classifying data by identifying its nearest neighbor or, my favorite analogy, you can identify or classify data by identifying who it associates most with or finding its closest neighbor.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Python code</h1>
                </header>
            
            <article>
                
<p>As we stated earlier, our objective is to demonstrate how to implement various types of ML algorithms within IBM Watson Studio, not provide the theory behind each algorithm; in addition to that, consistent with the last section, we will utilize an existing sample Python script set to illustrate the functionalities and features offered within the Watson Studio platform, and not try to create a new solution.</p>
<p>In this implemented example, we have to do the following:</p>
<ul>
<li>Find a predefined number of training samples closest in distance to a new sample of data that needs to be classified</li>
<li>Make sure the label (classification) of the new sample of data is defined by those (training sample) neighbors</li>
<li>Set a fixed user-defined constant for the number of neighbors that have to be determined</li>
<li>Compute the classification using a majority vote of the nearest neighbors of the new sample</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Implementing in Watson</h1>
                </header>
            
            <article>
                
<p>Once again, following the steps used earlier in this chapter, we can open our machine learning project in IBM Watson Studio and create a new Notebook. From there, we can paste the sample Python code into cells within the Notebook and press <span class="packt_screen">Run</span> to test each cell's code.</p>
<p>As we've seen, you can use multiple cells within the Notebook to segment functional blocks of your code. Using the menu bar, you can also cut and paste cells, split and merge cells, and move a cell up or down within the Notebook. For clarity, an additional handy feature is to display the line numbers for each of the Python commands in the Notebook. You can do this by clicking the appropriate menu selection under <span class="packt_screen">Edit</span> or <span class="packt_screen">View</span> on the menu bar:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9dac38ab-7f62-4f9f-8ed0-d89b42c333db.png"/></div>
<p class="mce-root"/>
<p>You may want to split cells to show intermediate cell outputs or combine cells into one cell and show the combined output. For example, in the next screenshot, you can see two cells, each followed by their respective outputs:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f0106308-6f4f-4030-b193-0924dd460236.png" style=""/></div>
<p>The following screenshot shows those two cells combined into one followed by the combined output:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f93916d5-3e7b-4c3a-a71d-9cc23bf54d4d.png" style=""/></div>
<p>Using the menu options, you can create a very well-organized, functional, and sharable solution. In the next section, we will use <strong>Markdown</strong> <strong>tags</strong> within Watson Studio to create an even more valuable solution.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Exploring Markdown text</h1>
                </header>
            
            <article>
                
<p><strong>Markdown</strong> is an easily-used markup language that is used with plain text to add formatting elements (headings, bulleted lists, URLs, and so on) to plain text without the use of a formal text editor or the use of <strong>HTML</strong> tags. Markdown is device agnostic and displays the writing format consistently across device types in an effort to create visual interest in the Notebook solutions you create.</p>
<p>Let's complete our latest example case. We'll assume that all of the example Python code has been pasted into cells in the Notebook and we have run the solution in its entirety.</p>
<p><span>Now, suppose that we want to save and share this solution with others who are not familiar</span><span> with our project and our thought process? What we can do is insert additional cells within our Notebook and instead of pasting code into them, we can add comments and other information</span> as explanatory text so that <span>others can more easily understand what we have created.</span> For example, take a look at the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6c81edd7-defb-4fa4-b731-99ffd8713a3f.png" style=""/></div>
<p>Let's see how this is done by performing the following steps:</p>
<ol>
<li>We can click on the first cell in the Notebook and then click on <span class="packt_screen">Insert</span>, then <span class="packt_screen">Insert Cell Above</span>. Next click on the new cell and change the <span class="packt_screen">Format</span> (of the cell) to <span class="packt_screen">Markdown</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/17d7faa5-2630-4961-ba22-bfa88c1b9f29.png" style=""/></div>
<ol start="2">
<li>Next, enter the <kbd>k-Nearest-Neighbor Classifier</kbd> text into the new cell:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/a6275265-0d0d-4c40-abb8-7efe20968f6f.png"/></div>
<ol start="3">
<li>Then, click on the keyboard icon and select <span class="packt_screen">change cell to heading 1</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4f4da498-e132-45b9-887b-6d926cc69dad.png" style=""/></div>
<p class="mce-root"/>
<ol start="4">
<li>After you perform the preceding steps, you can see that the Markdown cell looks a bit different:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3b78323c-bdf9-4dfb-ad72-47ce77f27798.png" style=""/></div>
<ol start="5">
<li>Once you click on <span class="packt_screen">Run</span>, you can see the results:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6ab4b79a-4316-4912-a111-f460a482aeca.png" style=""/></div>
<p>Using common Markdown, we can proceed to interject commentary throughout the Notebook:</p>
<ul>
<li>You can add a new cell to the top of the Notebook, convert the format to Markdown, then drag and drop an image to the cell (as shown below). This can be used to add a company logo or even a workflow diagram:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/712e9f0e-b825-43b5-a58e-00c49a7acf0f.png" style=""/></div>
<ul>
<li>Using other markdowns, such as heading levels, indents, and bulleted lists, you can provide details about assumptions, such as the source of the data used and what is found within the data:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ed57e54c-1d37-4613-b867-d804ee153b73.png"/></div>
<ul>
<li>Using additional, HTML-like markdowns (such as <kbd>&lt;font color=&gt;&lt;/font&gt;</kbd>), you can create markdown cells such as the following:</li>
</ul>
<div class="CDPAlignCenter CDPAlign"><img src="assets/35a5c059-9050-4006-be80-b16b1e7781a5.png"/></div>
<p style="padding-left: 90px">This results in the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/bd7e34a6-af09-4b23-9eea-b1288d70e193.png"/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<div class="packt_infobox">
<p>You can experiment with the full-featured Markdowns to see what works best for you. You can go to: <a href="https://commonmark.org/help/">https://commonmark.org/help/</a> to find a full Markdown cheatsheet.</p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Time series prediction example</h1>
                </header>
            
            <article>
                
<p>In this section, our goal is to try implementing a time series model using Python and Watson Studio.</p>
<p>Time series analysis includes methods for analyzing time series data (of course) so we can extract meaningful statistics and other characteristics of the data. Time series forecasting is the process where we use an algorithm to predict future values based on previously observed values.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Time series analysis</h1>
                </header>
            
            <article>
                
<p>Time series data may be <strong>stationary</strong> or <strong>non-stationary</strong> in nature. Stationary implies flat without periodic fluctuations, while non-stationary data typically has frequent shifts in value. You see time series analysis generally used for non-stationary data, such as evaluating and predicting retail sales. In this example, we will again utilize a study exercise (available on GitHub) to demonstrate the fundamental steps involved in the analysis and forecasting of retail sales data, as implemented with IBM Watson Studio. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setup</h1>
                </header>
            
            <article>
                
<p>Using the (now) familiar process of adding data to our Watson Studio project, we've created a new asset using a CSV data file and, in an effort to better understand the data, used the Data Refinery feature to analyze, profile, and visualize our asset. From there (as we did in a previous <em>Time series analysis</em> section of this chapter), we used <span class="packt_screen">Insert to Code</span> and then <span class="packt_screen">Insert pandas DataFrame</span> so that Watson Studio would generate the code required to import the required Python modules, load the data (into a Python DataFrame object, named <kbd>df_data_1</kbd>) and print the first five rows, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2638de8e-c9fd-472d-9498-84e6cce743c3.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Data preprocessing</h1>
                </header>
            
            <article>
                
<p>While using the <strong>Data Refinery</strong> feature, we noticed that there is a column within the data file named <kbd>Category</kbd>, which seems to indicate the type of product sold (furniture, office supplies, and several others). In this example, the data scientist is interested in only furniture sales, so the following lines of code are used to filter the data and then verify if there is a reasonable amount of data for that category to perform a proper analysis:</p>
<pre>furniture = df.loc[df['Category'] == 'Furniture']<br/>furniture['Order Date'].min(), furniture['Order Date'].max()</pre>
<p>The preceding code executed in Watson Studio is shown in the following screenshot, filtering the sales data and verifying that we have four years of furniture sales within this data file <span>by showing the earliest and latest timestamp</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f0e2a5a6-6236-4945-8c43-ad0cb61dfba4.png"/></div>
<p>In the selected example, the data scientist chose to use raw Python commands to remove (drop) columns of data not needed in the analysis, check for missing values, aggregate (group by) sales transactions by date, and so on. Although using Python scripting to accomplish these tasks is not overly complex, you can alternatively perform all of those tasks (and more) with the drag and drop of Watson <strong>Data Refinery flow</strong>.</p>
<div class="packt_infobox">
<p>As we mentioned earlier, a Data Refinery flow is an ordered set of steps to cleanse, shape, and enhance a data asset. As you refine data by applying operations to the data, you are actually dynamically building a customized Data Refinery flow that can be modified in real time and saved for future use as new data becomes available!</p>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Indexing for visualization</h1>
                </header>
            
            <article>
                
<p>Once the data has been properly prepared, the data scientist uses the <kbd>Pandas set_index</kbd> command to set the <kbd>Order Date</kbd> column, indexing the rows (of sales transactions) as the field we will perform the initial analysis on. In other words, we want to ultimately be able to predict furniture sales per month. The following screenshot shows the Python statements executed in our Watson project to set the index and print the results of the command:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/28db5036-e5a1-4b39-adf7-69d17cbb034b.png"/></div>
<p>The data scientist then goes on to point out that it would be more reasonable (given the data) to look at average daily sales for each month, so the following commands are used to <strong>resample</strong> the sales data, using the start of each month (MS) as the timestamp, and then, as a sanity check, have a peek at the some of the data (order month followed by the computed average sales):</p>
<pre>y = furniture['Sales'].resample('MS').mean()<br/>y["2017":]</pre>
<p>The following screenshot shows the preceding commands executed in our Watson project:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/773c2625-14f4-4c3d-a432-1d89bfa9cd7a.png" style=""/></div>
<p> </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Visualizations</h1>
                </header>
            
            <article>
                
<p>To actually visualize the average sales volumes over the 4-year series, the <kbd>plot</kbd> command is used:</p>
<pre>y.plot(figsize=(15, 6))<br/>plt.show()</pre>
<p>This results in the following visualization, shown here executed in Watson Studio:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5e01601e-77d8-48f3-bb5d-54b654c7227c.png"/></div>
<p class="CDPAlignLeft CDPAlign">When you plot or otherwise visualize data, it is much easier to recognize patterns. In this example, the data scientist pointed out a pattern commonly identified as seasonality. The data scientist then goes a step further and performs a time series decomposition, breaking out trend, seasonality, and noise, using the following commands:</p>
<pre>from pylab import rcParams<br/>rcParams['figure.figsize'] = 18, 8<br/>decomposition = sm.tsa.seasonal_decompose(y, model='additive')<br/>fig = decomposition.plot()<br/>plt.show()</pre>
<p>And again, as executed in Watson Studio, we have the following:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f7a945f9-b2c4-4ca6-8fd1-0433b208204d.png"/></div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Forecasting sales</h1>
                </header>
            
            <article>
                
<p>Finally, after completing the preceding time series data analysis and decomposition, we can get to the actual forecasting step! Still in-step with the track outlined in the selected example, the data scientist chose to apply one of the most commonly used methods for time series forecasting, <strong>autoregressive integrated moving average</strong> (<strong>ARIMA</strong>).</p>
<div class="packt_infobox">
<p>You can head on to the following link to learn more about ARIMA: <a href="http://www.forecastingsolutions.com/arima.html">http://www.forecastingsolutions.com/arima.html</a>.</p>
</div>
<p>To use an ARIMA model or methodology for a time series forecasting exercise, you'll need to understand how to choose values for the algorithms' three main parameters: as <em>P</em>, <em>D</em>, and <em>Q</em>. Assuming you've validated your model choice (to use ARIMA in the first place), the hardest part of building the actual forecasting model and generating a forecast with the model is selecting those parameter values that best fit the model (given the data):</p>
<ul>
<li><em>P</em> is the number of autoregressive terms</li>
<li><em>D</em> is the number of nonseasonal differences needed for stationarity</li>
<li><em>Q</em> is the number of lagged forecast errors in the prediction equation</li>
</ul>
<p>Without digging too deep into the theories behind parameter selection, we'll say here that this step involves determining the possible parameter value combinations, looking at their overall fitting results, running the appropriate diagnostics to investigate any unusual behaviors by the model, and validating results generated by the model.</p>
<p>The following are the code blocks and selected outputs as implemented with IBM Watson Studio:</p>
<p><span>Let's take a look at the first code here that shows the examples of the parameter combinations:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/edf7438c-c8be-46a8-8fc0-5b1b029f5295.png"/></div>
<p>Let's take a look at the next code here:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/3c741f93-6a42-401d-83e1-0138ba332b5f.png"/></div>
<p>Now, take a look at the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cece668f-926e-498b-9362-2306ca01549d.png"/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="CDPAlignLeft CDPAlign">Now, let's take a look at all the graphs here at once:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/2ae034d4-9727-46fc-bbca-5d5517b8c593.png"/></div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Validation</h1>
                </header>
            
            <article>
                
<p>Of course, the data scientist cannot generate a forecast and be done. An effort must be made to review the model’s performance or forecast accuracy. To help understand the accuracy of the model, <em>predicted</em> sales are compared to actual sales, setting the forecast to start at 2017-07-01 (to the end of the data). Again, a plot is used to visualize the output, showing the <em>observed</em> values compared to the rolling forecast predictions. Overall, the sales forecast seems to align with the actual sales values and shows an upward trend that starts from the beginning of the year.</p>
<p>We see the following code block:</p>
<pre>pred = results.get_prediction(start=pd.to_datetime('2017-01-01'), dynamic=False)<br/>pred_ci = pred.conf_int()<br/>ax = y['2014':].plot(label='observed')<br/>pred.predicted_mean.plot(ax=ax, label='One-step' ahead Forecast', alpha=.7, figsize=(14, 7))<br/>ax.fill_between(pred_ci.index, pred_ci.iloc[:, 0], pred_ci.iloc[:, 1], color='k', alpha)<br/>ax.set_xlabel('Date')<br/>ax.set_ylabel('Furniture Sales')<br/>plt.legend()<br/>plt.show() </pre>
<p>The actual results implemented in Watson Studio are as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/94c19eab-6edb-4182-b84d-7b2b1ac14a0c.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we created a new machine learning project in IBM Watson Studio and added notebooks to it so that we could use Python as the programming language for our project's objectives.</p>
<p>Using Python, we demonstrated how easy it is to load data into a DataFrame and perform manipulations on it in preparation for further processing. We also used additional Notebooks to illustrate how easy it is to implement various machine learning projects with Watson Studio.</p>
<p>In the next chapter, we will provide guidelines for creating a Spark machine learning pipeline within IBM Watson Studio.</p>


            </article>

            
        </section>
    </body></html>
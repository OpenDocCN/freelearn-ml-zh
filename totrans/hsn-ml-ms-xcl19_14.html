<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Azure and Excel - Machine Learning in the Cloud</h1>
                </header>
            
            <article>
                
<p>The clear tendency nowadays is to move all analysis, storage, and visualization activities to the cloud. In this chapter, you will find information about how to use Azure services and get a free subscription to test them. Deep learning seems to be the path to general Artificial Intelligence, that is, machines that can think as humans. We are not even close to that yet, but artificial neural networks are used in computer vision, text and speech analysis, and many other advanced applications. There are many use cases for artificial intelligence that are pre-built inside Azure and that can be used by building an experiment, as shown in detail in this chapter.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>Introducing the Azure Cloud</li>
<li>Using Azure Machine Learning Studio for free – a step-by-step guide</li>
<li>Loading your data into Azure <span>Machine Learning Studio</span></li>
<li>Creating and running an experiment in Azure Machine Learning Studio</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>To complete this chapter, you will need a Microsoft account. If you don't have one, you can get one for free at <a href="https://signup.live.com/">https://signup.live.com/</a>.</p>
<p>You will also need to download the <kbd>titanic_small.csv</kbd> file from the GitHub repository at <a href="https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter10">https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter10</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introducing the Azure Cloud</h1>
                </header>
            
            <article>
                
<p>Cloud computing is the on demand availability of computer system resources, especially data storage and computing power, without direct active management by the user. The term is generally used to describe data centers available to many users over the Internet. Here are some advantages of using the cloud instead of on-premises computers:</p>
<ul>
<li><strong>Cost</strong>: Instead of buying and maintaining expensive hardware and software, the cloud model offers to pay only for what is used.</li>
<li><strong>Speed</strong>: A large amount of resources can be obtained typically in minutes, just by configuring some settings in a website.</li>
<li><strong>Global scale</strong>: The size and location of the resources can be dynamically changed according to the user's needs.</li>
<li><strong>Productivity</strong>: IT staff can save time and focus on tasks that help the business grow, instead of doing hands-on maintenance of local equipment.</li>
<li><strong>Performance</strong>: The cloud servers are upgraded often and offer the latest available technology.</li>
<li><strong>Security</strong>: In spite of the usual worries related to storing and moving sensitive data to and from the cloud, most providers have adequate policies to protect the user's data.</li>
</ul>
<p>The most important cloud providers, at the time of writing this book, are AWS, MS-Azure and GCP. We are going to focus on Azure and describe some of the services that are relevant for data analysis using machine learning.</p>
<p>Like all cloud providers, Microsoft includes all types of services in Azure. Our interest will be mainly in <strong>Azure Machine Learning Studio</strong> (<strong>AMLS</strong>), which is designed to create and test machine learning projects and experiments easily.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using AMLS for free – a step-by-step guide</h1>
                </header>
            
            <article>
                
<p>Microsoft AMLS is a tool that provides a <span>drag and drop interface to bui</span>ld, test, and deploy machine learning models and analytics solutions. It is possible to publish models as web services that can be consumed from Excel (among other tools).</p>
<p>We will start by registering in the AMLS home page, using your Microsoft account:</p>
<ol>
<li>Open <a href="https://studio.azureml.net/" target="_blank">https://studio.azureml.net/</a>. You will see the following front page:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c7b6b286-6ab3-4f66-a550-9fa57c00a1d9.png" style="width:57.25em;height:27.33em;"/></p>
<ol start="2">
<li>Click on <span class="packt_screen">Sign up here</span> and you will get to the next page:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/650db3e2-32a1-4a81-a0b4-078fc3e87d15.png" style="width:54.75em;height:24.50em;"/></p>
<ol start="3">
<li>Choose the second option (that is, <span class="packt_screen">Free Workspace</span>), which requires that you have a Microsoft account. The advantage is that this option is free and you can use it without limits. Once you click on the <span class="packt_screen">Free Workspace</span> option, you will be taken to the following login screen:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/667549c3-9d5d-4859-ae02-45a3c8254f48.png" style="width:26.83em;height:24.42em;"/></p>
<ol start="4">
<li>Enter the username you chose when you created your Microsoft account and click on <span class="packt_screen">Next</span>. You will then see the password input screen:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/51222510-5ac2-4570-b1fb-69fbc4c10a9f.png" style="width:21.33em;height:17.50em;"/></p>
<ol start="5">
<li>Type the password of your Microsoft account and click on <span class="packt_screen">Sign in</span>.</li>
<li>You will be taken to the AMLS home page:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e405cadd-3609-4d7e-8c11-58159c07a011.png" style="width:62.08em;height:28.17em;"/></p>
<p class="CDPAlignLeft CDPAlign"><span>Now that you are ready to start, we will cover how to load your dataset into ALMS.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Loading your data into AMLS</h1>
                </header>
            
            <article>
                
<p>There is no machine learning project without data, so the first step in our analysis is to load the input file (<kbd>titanic_small.csv</kbd>) into AMLS. This is a simplified version of the Titanic dataset, which contains three features and one target variable:</p>
<ul>
<li>Features:
<ul>
<li><strong>pclass</strong>: The class in which the passenger traveled (values 1, 2, or 3 corresponding to 1st, 2nd, and 3rd class)</li>
<li><strong>sex</strong>: Passenger's gender (female or male)</li>
<li><strong>Age group</strong>: Infant, child, teenager, adult, elderly, or unknown</li>
</ul>
</li>
<li>Target variable:
<ul>
<li><strong>Survived</strong>: 1 if the passenger survived the shipwreck, 0 if they didn't.</li>
</ul>
</li>
</ul>
<p>To load the file, follow these steps:</p>
<ol>
<li>From the home page, click on <span class="packt_screen">DATASETS</span>. You will see an empty list of datasets:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0b60a787-1009-48ff-aaae-5e9d7c3c6476.png"/></p>
<ol start="2">
<li>Click on <span class="packt_screen">+NEW</span> to get a link to upload a local data file:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0a214150-da00-40b2-bd77-7662073dff79.png" style="width:51.08em;height:23.50em;"/></p>
<ol start="3">
<li>Click on <span class="packt_screen">FROM LOCAL FILE</span> and you will see the following dialog box:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2f55592d-79d7-4293-8a12-02493ab6975f.png" style="width:33.33em;height:36.42em;"/></p>
<ol start="4">
<li>Click on <span class="packt_screen">Choose File</span> and navigate to the input file <span>(</span><kbd>titanic_small.csv</kbd><span>)</span> location in your computer.</li>
<li>Enter any name you want for the dataset in the corresponding field.</li>
<li>Select the type of file, in this case <span class="packt_screen">Generic CSV File with a header (.csv).</span></li>
<li>Optionally, describe the contents of the data set for future reference.</li>
<li>Click <span class="packt_screen">OK.</span></li>
</ol>
<ol start="9">
<li>You will see your recently uploaded dataset in the list:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/599ed585-1ce9-464f-8c64-dcd8b5ea2e76.png"/></p>
<p>You now have everything you need to start building your first experiment in AMLS. We'll do it together in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and running an experiment in AMLS</h1>
                </header>
            
            <article>
                
<p>The basic components of AMLS are experiments. They are built by dragging and dropping predefined modules into a workspace. Each module has some defined task, a given number of parameters that can be chosen at runtime, and a defined number of input and output nodes. Here is a screenshot of the AMLS module:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/edd55207-ceb7-461f-9c88-0a69a5821c75.png" style="width:13.00em;height:8.25em;"/></p>
<p>They can be connected to build an analysis workflow, from data input and transformation to machine learning model training and results. We will go step by step and create a machine learning experiment, training a decision tree to predict the survival of the Titanic passengers.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a new experiment</h1>
                </header>
            
            <article>
                
<p>Perform the following steps to create a new environment:</p>
<ol>
<li>From the home page, select <span class="packt_screen">EXPERIMENTS</span>. You will see the empty list of experiments:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9e9859e4-face-4185-ba9c-71916894c0b5.png" style="width:52.08em;height:24.17em;"/></p>
<ol start="2">
<li><span>Click on</span> <span class="packt_screen">+NEW</span> <span>to create a new Experiment. You will see the list of available experiments that can be loaded from the Azure catalog:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7d218b27-5026-41dc-8a06-04652c60d9e6.png" style="width:50.83em;height:27.83em;"/></p>
<ol start="3">
<li>Click on <span class="packt_screen">Blank Experiment</span> to create an empty one. The following screenshot shows how an experiment looks before you start to add modules:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/71943629-32cc-4b78-839c-3b21bc1b3716.png"/></p>
<p>The left part is the module catalog, grouped by function. The middle (gray) area is the workspace, where we are going to drop the modules, and the right part shows a summary of the experiment. In the upper-left corner of the workspace, you can see the experiment name. You can click on it and edit the text. In our example, the text was edited to show <span class="packt_screen">Titanic <span>–</span> model training</span>.</p>
<div class="packt_tip"><span>Once you are familiar with AMLS, explore the experiments in the catalog. They are good examples of the capabilities that AMLS can offer and the types of problems you can solve with it.</span></div>
<p>This first experiment will only use the input data to train the decision tree, and have it ready to use later in another experiment, which will be the one that predicts the survival of the passengers. We split the experiment into two parts because we want to train the tree only once and use it later for prediction. We will show a step-by-step guide to training the decision tree model in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Training a decision tree model</h1>
                </header>
            
            <article>
                
<ol>
<li>In the module catalog, go to <span class="packt_screen">Saved Datasets</span> | <span class="packt_screen">My Datasets</span> and drag the "titanic_small.csv" into the right workspace module that contains our input data to the workspace. It contains the data previously read from the file. After dropping the data module, you should see something similar to the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e72fbf2c-2d96-44d7-98ea-9a4b511d676b.png"/></p>
<div class="packt_tip">Clicking in a module after dropping it on the workspace will show information about it on the right-hand side of the screen.</div>
<ol start="2">
<li>Drag and drop two other modules, which represent the decision tree that we are going to train and a generic training module. The first one is located in <span class="packt_screen">Machine Learning</span> | <span class="packt_screen">Initialize Model</span> | <span class="packt_screen">Classification</span> | <span class="packt_screen">Two Class Boosted Decision Tree</span>. The second one is located in <span class="packt_screen">Machine Learning</span> | <span class="packt_screen">Train</span> | <span class="packt_screen">Train Model</span>.</li>
<li>Once all modules are dropped into the workspace, you need to connect them to build a data flow. To connect two modules, do the following:
<ol>
<li>Click on the output node of the first module.</li>
<li>Keep the mouse button pressed and move the pointer to the input node of the second module.</li>
<li>Release the mouse button. You should see a curved lines joining both modules.</li>
</ol>
</li>
<li>The final set of connected modules should look like the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6dfbf6f5-7c5c-4928-b6ab-ed126fa4a948.png"/></p>
<p>You need to select the target variable in the module labeled <span class="packt_screen">Train Model</span>. To do that, perform these steps:</p>
<ol>
<li>Click on the module.</li>
<li>Click on <span class="packt_screen">Launch column selector</span> on the right-hand side panel.</li>
<li>In the pop-up window, click on <span class="packt_screen">BY NAME</span>.</li>
<li>From the list of available columns, click on <span class="packt_screen">survived</span>.</li>
<li>Click on the right arrow (<span class="packt_screen">&gt;</span>). This will move the <span class="packt_screen">survived</span> variable to the right. You should see something similar to the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e970abfc-929b-4e21-9cb6-59933eeb8fa8.png" style="width:64.58em;height:31.50em;"/></p>
<ol start="6">
<li>In the bottom menu, click on <span class="packt_screen">RUN</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d0fd4ff1-02cd-49de-83cb-fd393a6c26d2.png" style="width:41.08em;height:4.00em;"/></p>
<ol start="7">
<li>Wait until the run finishes. It should only take a couple of minutes until you see a green tilde on all modules.</li>
</ol>
<p>You can visualize the models that you trained. In this case, the default is to train 100 decision trees. To see them in detail, follow these steps:</p>
<ol>
<li>Right-click on the <span class="packt_screen">Train model</span> module.</li>
<li>Navigate to <span class="packt_screen">Trained model</span> | <span class="packt_screen">Visualize</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9b9b72e0-e45f-440e-9273-370c0596b77b.png"/></p>
<ol start="3">
<li>Choose any of the trees shown in miniature on the left-hand side to see the details. You can follow how decisions are made on each node of the tree and follow the branch values to the final value of the target variable. The following screenshot illustrates this:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/5d4c7f85-b86d-4f6e-a92c-bdcf97abf45c.png"/></p>
<ol start="4">
<li>Clicking on the module labeled <span class="packt_screen">Two-Class Boosted Decision Tree</span> shows a list of model parameters on the right-hand side panel. These parameters affect the training of a decision tree. You can change these parameters and run the experiment again:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/dd6192ff-6fd1-4f54-9826-d587b2008757.png"/></p>
<ol start="5">
<li>Save the experiment by clicking on <span class="packt_screen">SAVE</span> in the bottom menu.</li>
</ol>
<p>Finally, we are going to save the model for future use, whenever we want to predict the survival chance of a given passenger. To do so, follow these steps:</p>
<ol>
<li>Right-click on the <span class="packt_screen">Train model</span> module.</li>
<li>Navigate to <span class="packt_screen">Trained model</span> | <span class="packt_screen">Save as Trained Model</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ef19e848-2029-4c08-b9b1-f980523197c9.png"/></p>
<p>The model is now trained with the input dataset and ready to use in a new experiment. We are going to build such an experiment in the next subsection and then show how it can be used from an Excel workbook.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making predictions with the model from Excel</h1>
                </header>
            
            <article>
                
<p>We are now going to create a web service using the trained decision tree. Web services are used to allow communication between different applications and different sources, and don't depend on the operating system or specific programming language. We are then going to use Excel to communicate with this web service, send the input data to it, and receive the output data with the predicted values of survival.</p>
<p>If you followed the instructions to create an experiment carefully, you should be now able to do it on your own, with some general guidance, as follows:</p>
<ol>
<li>Create a new experiment and change its name to <kbd>Titanic - Web Service</kbd>.</li>
<li>Drag and drop five modules to the workspace:
<ul>
<li><span class="packt_screen">Saved Datasets</span> | <span class="packt_screen">My Datasets</span> | <kbd>titanic_small.csv</kbd>: The dataset we loaded and used to train the decision tree.</li>
<li><span class="packt_screen">Trained Models</span> | <span class="packt_screen">Titanic Model - Trained</span>: The trained model we saved for future use.</li>
<li><span class="packt_screen">Machine Learning</span> | <span class="packt_screen">Score</span> | <span class="packt_screen">Score Model</span>: That will be used to predict the target variable according to the model training.</li>
<li><span class="packt_screen">Web Service</span> | <span class="packt_screen">Web Service</span> <span class="packt_screen">Input</span> and <span class="packt_screen">Web Service</span> <span class="packt_screen">Output</span>: That will handle the communication of data from and to Excel.</li>
</ul>
</li>
<li>Connect the modules so the experiment looks like the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/acaf8c72-6aa5-4ce4-bee3-96536011ad4c.png"/></p>
<ol start="4">
<li>Save the experiment and run it.</li>
</ol>
<div class="packt_tip">The input data is not really used in the experiment, since the data for the prediction will eventually be sent from the application that uses the web service. In spite of this, the input data module needs to be included as a reference to the data format (names of the variables and total number of columns).</div>
<ol start="5">
<li>Once the run is successful, click on <span class="packt_screen">DEPLOY WEB SERVICE</span> in the bottom menu. You will be taken to the following screen:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fc7e371a-e2fe-40c7-a141-6af9771b9521.png"/></p>
<p style="padding-left: 60px">The web service is now created and AMLS lets you download an Excel file that is already connected to it.</p>
<ol start="6">
<li>Download the file from the link on the last row of the screen (<span class="packt_screen">BATCH EXECUTION</span>, <span class="packt_screen">Excel 2013 or later workbook</span>).</li>
<li>Open the Excel file on your computer. You should see a menu to the right of the workbook:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6a5bac26-f32c-4bba-bbd8-c772287313dd.png"/></p>
<p style="padding-left: 60px">This means that the file is already connected to the web service we created.</p>
<ol start="8">
<li>Click on <span class="packt_screen">Titanic <span>–</span> Web Service</span>. You will see the data input menu to the right:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/7879ddb3-8c43-4ca6-95b5-3b350797f105.png"/></p>
<ol start="9">
<li>Click on <span class="packt_screen">Use sample data</span> to get a few rows of data to use for predicting. You now have a table similar to the following:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b3086080-57f4-4fa0-9073-10df302d8719.png"/></p>
<ol start="10">
<li>In the <span class="packt_screen">Input</span> dialog box, write <em>A1:D6</em>.</li>
<li>In the <span class="packt_screen">Output</span> dialog box, write the coordinates of the cell where you want the output data to start. In this example, we used <em>G1</em>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4d347dae-5c86-4f18-9b17-5379b09b210d.png"/></p>
<ol start="12">
<li>Click on <span class="packt_screen">Predict</span>. The original table plus the predicted values will appear in the worksheet:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f82e590e-65cd-4fb1-ba6d-c5ca94615c90.png"/></p>
<div class="packt_tip">Data in the <kbd>survived</kbd> column is not taken into account for the prediction, since it is the target variable. It must be present to comply with the training data format.</div>
<p>Notice that four out of the five predicted values (in the <kbd>Scored Labels</kbd> column) agree with the values used for training. Predictions are never perfect and that is why it is so important to fine-tune the model parameters and carefully study the prediction error.</p>
<p>You now know how to build an experiment in AMLS and communicate with it from Excel, sending and receiving data. So, when you hear the phrase <em>cloud computing</em>, you know what it is about.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>We went through all the necessary steps to open an account in AMLS, a part of the Microsoft Azure cloud that helps us to build simple data and analysis flows. We also built two experiments: one of them trains a decision tree and the other predicts the target variable. Then we learned how to create a web service and connect Excel to it, sending and receiving data.</p>
<p>In the next chapter, we will show the present status of machine learning, which almost completely moves operations to the cloud, makes the data flows completely automatic, and uses automation to fine-tune the predictive models.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>What are the main advantages of using cloud computing?</li>
<li>Is cloud computing only useful for machine learning?</li>
<li>What is a web service and why is it useful?</li>
<li>If the model is already trained, why do we need to include the input data model in the analysis flow used for prediction?</li>
<li>Why did we split training and prediction into two different flows?</li>
</ol>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p>Check out the following resources for more information on the topics covered in this chapter:</p>
<ul>
<li><em>Understanding the Basics of Cloud Computing</em>: <a href="https://www.lucidchart.com/blog/cloud-computing-basics">https://www.lucidchart.com/blog/cloud-computing-basics</a></li>
<li><em>Azure Machine Learning Studio Documentation</em>: <a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio/">https://docs.microsoft.com/en-us/azure/machine-learning/studio/</a></li>
<li><span><em>Decision Trees Explained Easily</em>: <a href="https://medium.com/@chiragsehra42/decision-trees-explained-easily-28f23241248">https://medium.com/@chiragsehra42/decision-trees-explained-easily-28f23241248</a></span></li>
</ul>


            </article>

            
        </section>
    </body></html>
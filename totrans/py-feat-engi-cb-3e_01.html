<html><head></head><body>
<div id="_idContainer016">
<h1 class="chapter-number" id="_idParaDest-21"><a id="_idTextAnchor020"/><span class="koboSpan" id="kobo.1.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></h1>
<h1 id="_idParaDest-22"><a id="_idTextAnchor021"/><a id="_idTextAnchor022"/><span class="koboSpan" id="kobo.2.1" xmlns:="http://www.w3.org/1999/xhtml">Imputing Missing Data</span></h1>
<p><span class="koboSpan" id="kobo.3.1" xmlns:="http://www.w3.org/1999/xhtml">Missing data—meaning the absence</span><a id="_idIndexMarker000"/><span class="koboSpan" id="kobo.4.1" xmlns:="http://www.w3.org/1999/xhtml"> of values for certain observations—is an unavoidable problem in most data sources. </span><span class="koboSpan" id="kobo.4.2" xmlns:="http://www.w3.org/1999/xhtml">Some machine learning model implementations can handle missing data out of the box. </span><span class="koboSpan" id="kobo.4.3" xmlns:="http://www.w3.org/1999/xhtml">To train other models, we must remove observations with missing data or transform them into </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1" xmlns:="http://www.w3.org/1999/xhtml">permitted values.</span></span></p>
<p><span class="koboSpan" id="kobo.6.1" xmlns:="http://www.w3.org/1999/xhtml">The act of replacing missing data</span><a id="_idIndexMarker001"/><span class="koboSpan" id="kobo.7.1" xmlns:="http://www.w3.org/1999/xhtml"> with their statistical estimates is called </span><strong class="bold"><span class="koboSpan" id="kobo.8.1" xmlns:="http://www.w3.org/1999/xhtml">imputation</span></strong><span class="koboSpan" id="kobo.9.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.9.2" xmlns:="http://www.w3.org/1999/xhtml">The goa</span><a id="_idTextAnchor023"/><span class="koboSpan" id="kobo.10.1" xmlns:="http://www.w3.org/1999/xhtml">l of any imputation technique is to produce a complete dataset. </span><span class="koboSpan" id="kobo.10.2" xmlns:="http://www.w3.org/1999/xhtml">There are multiple imputation methods. </span><span class="koboSpan" id="kobo.10.3" xmlns:="http://www.w3.org/1999/xhtml">We select which one to use, depending on whether the data is missing at random, the proportion of missing values, and the machine learning model we intend to use. </span><span class="koboSpan" id="kobo.10.4" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will discuss several </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1" xmlns:="http://www.w3.org/1999/xhtml">imputation methods.</span></span></p>
<p><span class="koboSpan" id="kobo.12.1" xmlns:="http://www.w3.org/1999/xhtml">This chapter will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1" xmlns:="http://www.w3.org/1999/xhtml">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.14.1" xmlns:="http://www.w3.org/1999/xhtml">Removing observations with </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1" xmlns:="http://www.w3.org/1999/xhtml">missing data</span></span></li>
<li><span class="koboSpan" id="kobo.16.1" xmlns:="http://www.w3.org/1999/xhtml">Performing mean or </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1" xmlns:="http://www.w3.org/1999/xhtml">median imputation</span></span></li>
<li><span class="koboSpan" id="kobo.18.1" xmlns:="http://www.w3.org/1999/xhtml">Imputing </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables</span></span></li>
<li><span class="koboSpan" id="kobo.20.1" xmlns:="http://www.w3.org/1999/xhtml">Replacing missing values with an </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1" xmlns:="http://www.w3.org/1999/xhtml">arbitrary number</span></span></li>
<li><span class="koboSpan" id="kobo.22.1" xmlns:="http://www.w3.org/1999/xhtml">Finding extreme values </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1" xmlns:="http://www.w3.org/1999/xhtml">for imputation</span></span></li>
<li><span class="koboSpan" id="kobo.24.1" xmlns:="http://www.w3.org/1999/xhtml">Marking </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1" xmlns:="http://www.w3.org/1999/xhtml">imputed values</span></span></li>
<li><span class="koboSpan" id="kobo.26.1" xmlns:="http://www.w3.org/1999/xhtml">Implementing forward and </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1" xmlns:="http://www.w3.org/1999/xhtml">backward fill</span></span></li>
<li><span class="koboSpan" id="kobo.28.1" xmlns:="http://www.w3.org/1999/xhtml">Carrying </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1" xmlns:="http://www.w3.org/1999/xhtml">out interpolation</span></span></li>
<li><span class="koboSpan" id="kobo.30.1" xmlns:="http://www.w3.org/1999/xhtml">Performing multivariate imputation by </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1" xmlns:="http://www.w3.org/1999/xhtml">chained equations</span></span></li>
<li><span class="koboSpan" id="kobo.32.1" xmlns:="http://www.w3.org/1999/xhtml">Estimating missing data with </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1" xmlns:="http://www.w3.org/1999/xhtml">nearest neighbo</span><a id="_idTextAnchor024"/><span class="koboSpan" id="kobo.34.1" xmlns:="http://www.w3.org/1999/xhtml">r</span><a id="_idTextAnchor025"/><a id="_idTextAnchor026"/><span class="koboSpan" id="kobo.35.1" xmlns:="http://www.w3.org/1999/xhtml">s</span></span></li>
</ul>
<h1 id="_idParaDest-23"><a id="_idTextAnchor027"/><span class="koboSpan" id="kobo.36.1" xmlns:="http://www.w3.org/1999/xhtml">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.37.1" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will use the Python libraries Matplotlib, pandas, NumPy, scikit-learn, and Feature-engine. </span><span class="koboSpan" id="kobo.37.2" xmlns:="http://www.w3.org/1999/xhtml">If you need to install Python, the free Anaconda Python distribution (</span><a href="https://www.anaconda.com/"><span class="koboSpan" id="kobo.38.1" xmlns:="http://www.w3.org/1999/xhtml">https://www.anaconda.com/</span></a><span class="koboSpan" id="kobo.39.1" xmlns:="http://www.w3.org/1999/xhtml">) includes most numerical </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1" xmlns:="http://www.w3.org/1999/xhtml">computing libraries.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.41.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.42.1" xmlns:="http://www.w3.org/1999/xhtml"> can be installed with </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1" xmlns:="http://www.w3.org/1999/xhtml">pip</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.44.1" xmlns:="http://www.w3.org/1999/xhtml">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.45.1" xmlns:="http://www.w3.org/1999/xhtml">
pip install feature-engine</span></pre> <p><span class="koboSpan" id="kobo.46.1" xmlns:="http://www.w3.org/1999/xhtml">If you use Anaconda, you can install </span><strong class="source-inline"><span class="koboSpan" id="kobo.47.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.48.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.49.1" xmlns:="http://www.w3.org/1999/xhtml">conda</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.50.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.51.1" xmlns:="http://www.w3.org/1999/xhtml">
conda install -c conda-forge feature_engine</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.52.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.53.1" xmlns:="http://www.w3.org/1999/xhtml">The recipes from this chapter were created using the latest versions of the Python libraries at the time of publishing. </span><span class="koboSpan" id="kobo.53.2" xmlns:="http://www.w3.org/1999/xhtml">You can check the versions in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.54.1" xmlns:="http://www.w3.org/1999/xhtml">requirements.txt</span></strong><span class="koboSpan" id="kobo.55.1" xmlns:="http://www.w3.org/1999/xhtml"> file in the accompanying GitHub repository, </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1" xmlns:="http://www.w3.org/1999/xhtml">at </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/requirements.txt"><span class="No-Break"><span class="koboSpan" id="kobo.57.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/requirements.txt</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.58.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.59.1" xmlns:="http://www.w3.org/1999/xhtml">We will use the </span><strong class="bold"><span class="koboSpan" id="kobo.60.1" xmlns:="http://www.w3.org/1999/xhtml">Credit Approval</span></strong><span class="koboSpan" id="kobo.61.1" xmlns:="http://www.w3.org/1999/xhtml"> dataset from the </span><em class="italic"><span class="koboSpan" id="kobo.62.1" xmlns:="http://www.w3.org/1999/xhtml">UCI Machine Learning Repository</span></em><span class="koboSpan" id="kobo.63.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span><a href="https://archive.ics.uci.edu/"><span class="koboSpan" id="kobo.64.1" xmlns:="http://www.w3.org/1999/xhtml">https://archive.ics.uci.edu/</span></a><span class="koboSpan" id="kobo.65.1" xmlns:="http://www.w3.org/1999/xhtml">), licensed under the CC BY 4.0 creative commons attribution: </span><a href="https://creativecommons.org/licenses/by/4.0/legalcode"><span class="koboSpan" id="kobo.66.1" xmlns:="http://www.w3.org/1999/xhtml">https://creativecommons.org/licenses/by/4.0/legalcode</span></a><span class="koboSpan" id="kobo.67.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.67.2" xmlns:="http://www.w3.org/1999/xhtml">You’ll find the dataset at this </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1" xmlns:="http://www.w3.org/1999/xhtml">link: </span></span><a href="http://archive.ics.uci.edu/dataset/27/credit+approval"><span class="No-Break"><span class="koboSpan" id="kobo.69.1" xmlns:="http://www.w3.org/1999/xhtml">http://archive.ics.uci.edu/dataset/27/credit+approval</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.70.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.71.1" xmlns:="http://www.w3.org/1999/xhtml">I downloaded and modified the data as shown in this </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1" xmlns:="http://www.w3.org/1999/xhtml">notebook: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch01-missing-data-imputation/credit-approval-dataset.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.73.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch01-missing-data-imputation/credit-approval-dataset.ipynb</span></span></a></p>
<p><span class="koboSpan" id="kobo.74.1" xmlns:="http://www.w3.org/1999/xhtml">We will also use the </span><strong class="bold"><span class="koboSpan" id="kobo.75.1" xmlns:="http://www.w3.org/1999/xhtml">air passenger</span></strong><span class="koboSpan" id="kobo.76.1" xmlns:="http://www.w3.org/1999/xhtml"> dataset located in Facebook’s Prophet GitHub repository (</span><a href="https://github.com/facebook/prophet/blob/main/examples/example_air_passengers.csv"><span class="koboSpan" id="kobo.77.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/facebook/prophet/blob/main/examples/example_air_passengers.csv</span></a><span class="koboSpan" id="kobo.78.1" xmlns:="http://www.w3.org/1999/xhtml">), licensed under the MIT </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1" xmlns:="http://www.w3.org/1999/xhtml">license: </span></span><a href="https://github.com/facebook/prophet/blob/main/LICENSE"><span class="No-Break"><span class="koboSpan" id="kobo.80.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/facebook/prophet/blob/main/LICENSE</span></span></a></p>
<p><span class="koboSpan" id="kobo.81.1" xmlns:="http://www.w3.org/1999/xhtml">I modified the data as shown in this </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1" xmlns:="http://www.w3.org/1999/xhtml">notebook: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch01-missing-data-imputation/air-passengers-dataset.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.83.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch01-missing-data-imputation/air-passengers-dataset.ipynb</span></span></a></p>
<p><span class="koboSpan" id="kobo.84.1" xmlns:="http://www.w3.org/1999/xhtml">You’ll find a copy of the modified data sets in the accompanying GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1" xmlns:="http://www.w3.org/1999/xhtml">repository: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch01-missing-data-imputation/"><span class="No-Break"><span class="koboSpan" id="kobo.86.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch01-missing-data-imputatio</span><span id="_idTextAnchor028"/><span class="koboSpan" id="kobo.87.1" xmlns:="http://www.w3.org/1999/xhtml">n</span><span id="_idTextAnchor029"/><span id="_idTextAnchor030"/><span id="_idTextAnchor031"/><span class="koboSpan" id="kobo.88.1" xmlns:="http://www.w3.org/1999/xhtml">/</span></span></a></p>
<h1 id="_idParaDest-24"><a id="_idTextAnchor032"/><span class="koboSpan" id="kobo.89.1" xmlns:="http://www.w3.org/1999/xhtml">Removing observations with missing data</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.90.1" xmlns:="http://www.w3.org/1999/xhtml">Complete Case Analysis</span></strong><span class="koboSpan" id="kobo.91.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span><strong class="bold"><span class="koboSpan" id="kobo.92.1" xmlns:="http://www.w3.org/1999/xhtml">CCA</span></strong><span class="koboSpan" id="kobo.93.1" xmlns:="http://www.w3.org/1999/xhtml">), als</span><a id="_idTextAnchor033"/><span class="koboSpan" id="kobo.94.1" xmlns:="http://www.w3.org/1999/xhtml">o called list-wis</span><a id="_idTextAnchor034"/><span class="koboSpan" id="kobo.95.1" xmlns:="http://www.w3.org/1999/xhtml">e deletion of cases, consists</span><a id="_idIndexMarker002"/><span class="koboSpan" id="kobo.96.1" xmlns:="http://www.w3.org/1999/xhtml"> of discarding</span><a id="_idIndexMarker003"/><span class="koboSpan" id="kobo.97.1" xmlns:="http://www.w3.org/1999/xhtml"> observations</span><a id="_idIndexMarker004"/><span class="koboSpan" id="kobo.98.1" xmlns:="http://www.w3.org/1999/xhtml"> with missing data. </span><span class="koboSpan" id="kobo.98.2" xmlns:="http://www.w3.org/1999/xhtml">CCA can be applied to both categorical</span><a id="_idIndexMarker005"/><span class="koboSpan" id="kobo.99.1" xmlns:="http://www.w3.org/1999/xhtml"> and numerical variables. </span><span class="koboSpan" id="kobo.99.2" xmlns:="http://www.w3.org/1999/xhtml">With CCA, we pre</span><a id="_idTextAnchor035"/><span class="koboSpan" id="kobo.100.1" xmlns:="http://www.w3.org/1999/xhtml">serve the distribution o</span><a id="_idTextAnchor036"/><span class="koboSpan" id="kobo.101.1" xmlns:="http://www.w3.org/1999/xhtml">f the variables after the imputation, provided the data is missing at random and only in a small proportion of observations. </span><span class="koboSpan" id="kobo.101.2" xmlns:="http://www.w3.org/1999/xhtml">However, if data is missing across many variables, CCA may lead to the removal of a large portion of </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.103.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.104.1" xmlns:="http://www.w3.org/1999/xhtml">Use CCA only when a small number of observations are missing and you have good reasons to believe that they are not important to </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1" xmlns:="http://www.w3.org/1999/xhtml">your m</span><a id="_idTextAnchor037"/><a id="_idTextAnchor038"/><span class="koboSpan" id="kobo.106.1" xmlns:="http://www.w3.org/1999/xhtml">odel.</span></span></p>
<h2 id="_idParaDest-25"><a id="_idTextAnchor039"/><span class="koboSpan" id="kobo.107.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.108.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by making some imports and loading </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1" xmlns:="http://www.w3.org/1999/xhtml">the dataset:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.110.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.112.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1" xmlns:="http://www.w3.org/1999/xhtml">matplotlib</span></strong><span class="koboSpan" id="kobo.114.1" xmlns:="http://www.w3.org/1999/xhtml">, and the train/test split function </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1" xmlns:="http://www.w3.org/1999/xhtml">from scikit-learn:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.116.1" xmlns:="http://www.w3.org/1999/xhtml">
import matplotlib.pyplot as plt
import pandas as pd
from sklearn.model_selection import train_test_split</span></pre></li> <li><span class="koboSpan" id="kobo.117.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load and display the dataset described in the </span><em class="italic"><span class="koboSpan" id="kobo.118.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.119.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.120.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.121.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
data.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.122.1" xmlns:="http://www.w3.org/1999/xhtml">In the following image, we see the first 5 rows </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1" xmlns:="http://www.w3.org/1999/xhtml">of data:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer005">
<span class="koboSpan" id="kobo.124.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.1 – First 5 rows of the dataset" src="image/B22396_01_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.125.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.1 – First 5 rows of the dataset</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.126.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s proceed as we normally</span><a id="_idIndexMarker006"/><span class="koboSpan" id="kobo.127.1" xmlns:="http://www.w3.org/1999/xhtml"> would if we were preparing</span><a id="_idIndexMarker007"/><span class="koboSpan" id="kobo.128.1" xmlns:="http://www.w3.org/1999/xhtml"> the data to train machine learning models; by splitting the data into a training and a </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1" xmlns:="http://www.w3.org/1999/xhtml">test set:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.130.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    data.drop("target", axis=1),
    data["target"],
    test_size=0.30,
    random_state=42,
)</span></pre></li> <li><span class="koboSpan" id="kobo.131.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s now make a bar plot with the proportion of missing data per variable in the training and </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1" xmlns:="http://www.w3.org/1999/xhtml">te</span><a id="_idTextAnchor040"/><span class="koboSpan" id="kobo.133.1" xmlns:="http://www.w3.org/1999/xhtml">st sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.134.1" xmlns:="http://www.w3.org/1999/xhtml">
fig, axes = plt.subplots(
    2, 1, figsize=(15, 10), squeeze=False)
X_train.isnull().mean().plot(
    kind='bar', color='grey', ax=axes[0, 0], title="train")
X_test.isnull().mean().plot(
    kind='bar', color='black', ax=axes[1, 0], title="test")
axes[0, 0].set_ylabel('Fraction of NAN')
axes[1, 0].set_ylabel('Fraction of NAN')
plt.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.135.1" xmlns:="http://www.w3.org/1999/xhtml">The previous code block returns</span><a id="_idIndexMarker008"/><span class="koboSpan" id="kobo.136.1" xmlns:="http://www.w3.org/1999/xhtml"> the following bar plots</span><a id="_idIndexMarker009"/><span class="koboSpan" id="kobo.137.1" xmlns:="http://www.w3.org/1999/xhtml"> with the fraction of missing data per variable in the training (top) and test </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1" xmlns:="http://www.w3.org/1999/xhtml">sets (b</span><a id="_idTextAnchor041"/><span class="koboSpan" id="kobo.139.1" xmlns:="http://www.w3.org/1999/xhtml">ottom):</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer006">
<span class="koboSpan" id="kobo.140.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.2 – Proportion of missing data per variable" src="image/B22396_01_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.141.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.2 – Proportion of missing data per variable</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.142.1" xmlns:="http://www.w3.org/1999/xhtml">Now</span><a id="_idTextAnchor042"/><span class="koboSpan" id="kobo.143.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll remove obser</span><a id="_idTextAnchor043"/><span class="koboSpan" id="kobo.144.1" xmlns:="http://www.w3.org/1999/xhtml">vations if they have missing values in </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1" xmlns:="http://www.w3.org/1999/xhtml">any variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.146.1" xmlns:="http://www.w3.org/1999/xhtml">
train_cca = X_train.dropna()
test_cca = X_test.dropna()</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.147.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.148.1" xmlns:="http://www.w3.org/1999/xhtml">pandas’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1" xmlns:="http://www.w3.org/1999/xhtml">dropna()</span></strong><span class="koboSpan" id="kobo.150.1" xmlns:="http://www.w3.org/1999/xhtml">drops observations with any missing value by default. </span><span class="koboSpan" id="kobo.150.2" xmlns:="http://www.w3.org/1999/xhtml">We can remove observations with missing data in a subset of variables like this: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.151.1" xmlns:="http://www.w3.org/1999/xhtml">data.dropna(subset=["A3", "A4"])</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.152.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.153.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s print and compare the size of the original and complete </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1" xmlns:="http://www.w3.org/1999/xhtml">case datasets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.155.1" xmlns:="http://www.w3.org/1999/xhtml">
print(f"Total observations: {len(X_train)}")
print(f"Observations without NAN: {len(train_cca)}")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.156.1" xmlns:="http://www.w3.org/1999/xhtml">We removed more than 200 observations with missing data from the training set, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.158.1" xmlns:="http://www.w3.org/1999/xhtml">Total observations: 483</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.159.1" xmlns:="http://www.w3.org/1999/xhtml">Observations without NAN: 264</span></strong></pre></li> <li><span class="koboSpan" id="kobo.160.1" xmlns:="http://www.w3.org/1999/xhtml">After removing</span><a id="_idIndexMarker010"/><span class="koboSpan" id="kobo.161.1" xmlns:="http://www.w3.org/1999/xhtml"> observations from the training</span><a id="_idIndexMarker011"/><span class="koboSpan" id="kobo.162.1" xmlns:="http://www.w3.org/1999/xhtml"> and test sets, we need to align the </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1" xmlns:="http://www.w3.org/1999/xhtml">target variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.164.1" xmlns:="http://www.w3.org/1999/xhtml">
y_train_cca = y_train.loc[train_cca.index]
y_test_cca = y_test.loc[test_cca.index]</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.165.1" xmlns:="http://www.w3.org/1999/xhtml">Now, the datasets and target variables contain the rows without </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p></li> <li><span class="koboSpan" id="kobo.167.1" xmlns:="http://www.w3.org/1999/xhtml">To drop observations with missing data utilizing </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.169.1" xmlns:="http://www.w3.org/1999/xhtml">, let’s import the </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1" xmlns:="http://www.w3.org/1999/xhtml">required transformer:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.171.1" xmlns:="http://www.w3.org/1999/xhtml">
from feature_engine.imputation import DropMissingData</span></pre></li> <li><span class="koboSpan" id="kobo.172.1" xmlns:="http://www.w3.org/1999/xhtml">Let</span><a id="_idTextAnchor044"/><span class="koboSpan" id="kobo.173.1" xmlns:="http://www.w3.org/1999/xhtml">’s set up the imputer to auto</span><a id="_idTextAnchor045"/><span class="koboSpan" id="kobo.174.1" xmlns:="http://www.w3.org/1999/xhtml">matically find the variables with </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1" xmlns:="http://www.w3.org/1999/xhtml">missing data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.176.1" xmlns:="http://www.w3.org/1999/xhtml">
cca = DropMissingData(variables=None, missing_only=True)</span></pre></li> <li><span class="koboSpan" id="kobo.177.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the transformer so that it finds the variables with </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1" xmlns:="http://www.w3.org/1999/xhtml">missing data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.179.1" xmlns:="http://www.w3.org/1999/xhtml">
cca.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.180.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the variables with NAN that the </span><span class="No-Break"><span class="koboSpan" id="kobo.181.1" xmlns:="http://www.w3.org/1999/xhtml">transformer found:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.182.1" xmlns:="http://www.w3.org/1999/xhtml">
cca.variables_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.183.1" xmlns:="http://www.w3.org/1999/xhtml">The previous command returns the names of the variables with </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1" xmlns:="http://www.w3.org/1999/xhtml">missing data:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.185.1" xmlns:="http://www.w3.org/1999/xhtml">['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9', 'A10', 'A14']</span></strong></pre></li> <li><span class="koboSpan" id="kobo.186.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s remove the rows with missing data in the training and </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.188.1" xmlns:="http://www.w3.org/1999/xhtml">
train_cca = cca.transform(X_train)
test_cca = cca.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.189.1" xmlns:="http://www.w3.org/1999/xhtml">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1" xmlns:="http://www.w3.org/1999/xhtml">train_cca.isnull().sum()</span></strong><span class="koboSpan" id="kobo.191.1" xmlns:="http://www.w3.org/1999/xhtml"> to corroborate</span><a id="_idIndexMarker012"/><span class="koboSpan" id="kobo.192.1" xmlns:="http://www.w3.org/1999/xhtml"> the absence of missing data in the complete</span><a id="_idIndexMarker013"/> <span class="No-Break"><span class="koboSpan" id="kobo.193.1" xmlns:="http://www.w3.org/1999/xhtml">case dataset.</span></span></p></li> <li><strong class="source-inline"><span class="koboSpan" id="kobo.194.1" xmlns:="http://www.w3.org/1999/xhtml">DropMissingData</span></strong><span class="koboSpan" id="kobo.195.1" xmlns:="http://www.w3.org/1999/xhtml"> can automatically adjust the target after removing missing data from the </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1" xmlns:="http://www.w3.org/1999/xhtml">training set:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.197.1" xmlns:="http://www.w3.org/1999/xhtml">
train_c, y_train_c = cca.transform_x_y( X_train, y_train)
test_c, y_test_c = cca.transform_x_y(X_test, y_test)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.198.1" xmlns:="http://www.w3.org/1999/xhtml">The previous code removed rows with </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.200.1" xmlns:="http://www.w3.org/1999/xhtml"> from the training and test sets and then re-aligned the </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1" xmlns:="http://www.w3.org/1999/xhtml">target variables.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.202.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.203.1" xmlns:="http://www.w3.org/1999/xhtml">To remove observations with missing data in a subset of variables, use </span><strong class="source-inline"><span class="koboSpan" id="kobo.204.1" xmlns:="http://www.w3.org/1999/xhtml">DropMissingData(variables=['A3', 'A4'])</span></strong><span class="koboSpan" id="kobo.205.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.205.2" xmlns:="http://www.w3.org/1999/xhtml">To remove rows with </span><strong class="source-inline"><span class="koboSpan" id="kobo.206.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.207.1" xmlns:="http://www.w3.org/1999/xhtml"> in at least 5% of the variables, </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1" xmlns:="http://www.w3.org/1999/xhtml">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.209.1" xmlns:="http://www.w3.org/1999/xhtml">DropMissingData(thres</span><a id="_idTextAnchor046"/><a id="_idTextAnchor047"/><span class="koboSpan" id="kobo.210.1" xmlns:="http://www.w3.org/1999/xhtml">hold=0.95)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.211.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-26"><span class="koboSpan" id="kobo.212.1" xmlns:="http://www.w3.org/1999/xhtml">How it works</span><a id="_idTextAnchor048"/><span class="koboSpan" id="kobo.213.1" xmlns:="http://www.w3.org/1999/xhtml">...</span></h2>
<p><span class="koboSpan" id="kobo.214.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe,</span><a id="_idTextAnchor049"/><span class="koboSpan" id="kobo.215.1" xmlns:="http://www.w3.org/1999/xhtml"> we plotted</span><a id="_idIndexMarker014"/><span class="koboSpan" id="kobo.216.1" xmlns:="http://www.w3.org/1999/xhtml"> the proportion of missing data</span><a id="_idIndexMarker015"/><span class="koboSpan" id="kobo.217.1" xmlns:="http://www.w3.org/1999/xhtml"> in each variable and then removed all observations with </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1" xmlns:="http://www.w3.org/1999/xhtml">missing values.</span></span></p>
<p><span class="koboSpan" id="kobo.219.1" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.221.1" xmlns:="http://www.w3.org/1999/xhtml">isnull()</span></strong><span class="koboSpan" id="kobo.222.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1" xmlns:="http://www.w3.org/1999/xhtml">mean()</span></strong><span class="koboSpan" id="kobo.224.1" xmlns:="http://www.w3.org/1999/xhtml"> methods to determine the proportion of missing observations in each variable. </span><span class="koboSpan" id="kobo.224.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1" xmlns:="http://www.w3.org/1999/xhtml">isnull()</span></strong><span class="koboSpan" id="kobo.226.1" xmlns:="http://www.w3.org/1999/xhtml"> method created a Boolean vector per variable with </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.228.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1" xmlns:="http://www.w3.org/1999/xhtml">False</span></strong><span class="koboSpan" id="kobo.230.1" xmlns:="http://www.w3.org/1999/xhtml"> values indicating whether a value was missing. </span><span class="koboSpan" id="kobo.230.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1" xmlns:="http://www.w3.org/1999/xhtml">mean()</span></strong><span class="koboSpan" id="kobo.232.1" xmlns:="http://www.w3.org/1999/xhtml"> method took the average of these values and returned the proportion of </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
<p><span class="koboSpan" id="kobo.234.1" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.235.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.236.1" xmlns:="http://www.w3.org/1999/xhtml">plot.bar()</span></strong><span class="koboSpan" id="kobo.237.1" xmlns:="http://www.w3.org/1999/xhtml"> to create a bar plot of the fraction of missing data per variable. </span><span class="koboSpan" id="kobo.237.2" xmlns:="http://www.w3.org/1999/xhtml">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.238.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.239.1" xmlns:="http://www.w3.org/1999/xhtml">.2</span></em><span class="koboSpan" id="kobo.240.1" xmlns:="http://www.w3.org/1999/xhtml">, we saw the fraction of </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.242.1" xmlns:="http://www.w3.org/1999/xhtml"> per variable in the training and </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1" xmlns:="http://www.w3.org/1999/xhtml">test sets.</span></span></p>
<p><span class="koboSpan" id="kobo.244.1" xmlns:="http://www.w3.org/1999/xhtml">To remove observations with missing values in </span><em class="italic"><span class="koboSpan" id="kobo.245.1" xmlns:="http://www.w3.org/1999/xhtml">any</span></em><span class="koboSpan" id="kobo.246.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, we used pandas’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1" xmlns:="http://www.w3.org/1999/xhtml">dropna()</span></strong><span class="koboSpan" id="kobo.248.1" xmlns:="http://www.w3.org/1999/xhtml">, thereby obtaining a complete </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1" xmlns:="http://www.w3.org/1999/xhtml">case dataset.</span></span></p>
<p><span class="koboSpan" id="kobo.250.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, we removed missing data using Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1" xmlns:="http://www.w3.org/1999/xhtml">DropMissingData()</span></strong><span class="koboSpan" id="kobo.252.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.252.2" xmlns:="http://www.w3.org/1999/xhtml">This imputer automatically identified and stored the variables with missing data from the train set when we called the </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.254.1" xmlns:="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.254.2" xmlns:="http://www.w3.org/1999/xhtml">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.256.1" xmlns:="http://www.w3.org/1999/xhtml"> method, the imputer removed observations with</span><a id="_idTextAnchor050"/> <strong class="source-inline"><span class="koboSpan" id="kobo.257.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.258.1" xmlns:="http://www.w3.org/1999/xhtml"> in those variables. </span><span class="koboSpan" id="kobo.258.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1" xmlns:="http://www.w3.org/1999/xhtml">transform_x_y()</span></strong><span class="koboSpan" id="kobo.260.1" xmlns:="http://www.w3.org/1999/xhtml">, the imputer removed rows with </span><strong class="source-inline"><span class="koboSpan" id="kobo.261.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.262.1" xmlns:="http://www.w3.org/1999/xhtml"> from the data sets and then realigned the </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1" xmlns:="http://www.w3.org/1999/xhtml">target variable.</span></span></p>
<h2 id="_idParaDest-27"><a id="_idTextAnchor051"/><span class="koboSpan" id="kobo.264.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.265.1" xmlns:="http://www.w3.org/1999/xhtml">If you want to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1" xmlns:="http://www.w3.org/1999/xhtml">DropMissingData()</span></strong><span class="koboSpan" id="kobo.267.1" xmlns:="http://www.w3.org/1999/xhtml"> within a pipeline together with other Feature-engine or scikit-learn transformers, check</span><a id="_idIndexMarker016"/><span class="koboSpan" id="kobo.268.1" xmlns:="http://www.w3.org/1999/xhtml"> out Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.269.1" xmlns:="http://www.w3.org/1999/xhtml">Pipeline</span></strong><span class="koboSpan" id="kobo.270.1" xmlns:="http://www.w3.org/1999/xhtml">: </span><a href="https://Feature-engine.trainindata.com/en/latest/user_guide/pipeline/Pipeline.html"><span class="koboSpan" id="kobo.271.1" xmlns:="http://www.w3.org/1999/xhtml">https://Feature-engine.trainindata.com/en/latest/user_guide/pipeline/Pipeline.html</span></a><span class="koboSpan" id="kobo.272.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.272.2" xmlns:="http://www.w3.org/1999/xhtml">This pipeline can align the target with the training  and test sets after </span><a id="_idTextAnchor052"/><a id="_idTextAnchor053"/><span class="No-Break"><span class="koboSpan" id="kobo.273.1" xmlns:="http://www.w3.org/1999/xhtml">removing rows.</span></span></p>
<h1 id="_idParaDest-28"><span class="koboSpan" id="kobo.274.1" xmlns:="http://www.w3.org/1999/xhtml">Performing mean or median impu</span><a id="_idTextAnchor054"/><span class="koboSpan" id="kobo.275.1" xmlns:="http://www.w3.org/1999/xhtml">tation</span></h1>
<p><span class="koboSpan" id="kobo.276.1" xmlns:="http://www.w3.org/1999/xhtml">Mean or median imputation</span><a id="_idIndexMarker017"/><span class="koboSpan" id="kobo.277.1" xmlns:="http://www.w3.org/1999/xhtml"> consists of replaci</span><a id="_idTextAnchor055"/><span class="koboSpan" id="kobo.278.1" xmlns:="http://www.w3.org/1999/xhtml">ng missing data</span><a id="_idIndexMarker018"/><span class="koboSpan" id="kobo.279.1" xmlns:="http://www.w3.org/1999/xhtml"> with the variable’s mean or median value. </span><span class="koboSpan" id="kobo.279.2" xmlns:="http://www.w3.org/1999/xhtml">To avoid data leakage, we determine the mean or median using the train set, and then use these values to impute the train and test sets, and all </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1" xmlns:="http://www.w3.org/1999/xhtml">future data.</span></span></p>
<p><span class="koboSpan" id="kobo.281.1" xmlns:="http://www.w3.org/1999/xhtml">Scikit-learn and Feature-engine learn the mean or median from the train set and store these parameters for future use out of </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1" xmlns:="http://www.w3.org/1999/xhtml">the box.</span></span></p>
<p><span class="koboSpan" id="kobo.283.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will perform mean and median imputation using </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.285.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1" xmlns:="http://www.w3.org/1999/xhtml">scikit</span></strong><span class="koboSpan" id="kobo.287.1" xmlns:="http://www.w3.org/1999/xhtml">-</span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1" xmlns:="http://www.w3.org/1999/xhtml">learn</span></strong><span class="koboSpan" id="kobo.289.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.291.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.292.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.293.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.294.1" xmlns:="http://www.w3.org/1999/xhtml">Use mean imputation if variables are normally distributed and median imputation otherwise. </span><span class="koboSpan" id="kobo.294.2" xmlns:="http://www.w3.org/1999/xhtml">Mean and median imputation may distort the variable distribution if there is a high percentage </span><a id="_idTextAnchor056"/><a id="_idTextAnchor057"/><span class="koboSpan" id="kobo.295.1" xmlns:="http://www.w3.org/1999/xhtml">of </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
<h2 id="_idParaDest-29"><span class="koboSpan" id="kobo.297.1" xmlns:="http://www.w3.org/1999/xhtml">How t</span><a id="_idTextAnchor058"/><span class="koboSpan" id="kobo.298.1" xmlns:="http://www.w3.org/1999/xhtml">o do it...</span></h2>
<p><span class="koboSpan" id="kobo.299.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin </span><span class="No-Break"><span class="koboSpan" id="kobo.300.1" xmlns:="http://www.w3.org/1999/xhtml">this reci</span><a id="_idTextAnchor059"/><span class="koboSpan" id="kobo.301.1" xmlns:="http://www.w3.org/1999/xhtml">pe:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.302.1" xmlns:="http://www.w3.org/1999/xhtml">First, we’ll import </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.304.1" xmlns:="http://www.w3.org/1999/xhtml"> and the required functions and classes from</span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1" xmlns:="http://www.w3.org/1999/xhtml"> scikit-learn</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.306.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.307.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.308.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.309.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.impute import SimpleImputer
from sklearn.compose import ColumnTransformer
from feature_engine.imputation import MeanMedianImputer</span></pre></li> <li><span class="koboSpan" id="kobo.310.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the dataset that we prepared in the </span><em class="italic"><span class="koboSpan" id="kobo.311.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.312.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.313.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.314.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")</span></pre></li> <li><span class="koboSpan" id="kobo.315.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s split the data into train and test sets with their </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1" xmlns:="http://www.w3.org/1999/xhtml">respective targets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.317.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    data.drop("target", axis=1),
    data["target"],
    test_size=0.3,
    random_</span><a id="_idTextAnchor060"/><span class="koboSpan" id="kobo.318.1" xmlns:="http://www.w3.org/1999/xhtml">state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.319.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s make a list with</span><a id="_idIndexMarker019"/><span class="koboSpan" id="kobo.320.1" xmlns:="http://www.w3.org/1999/xhtml"> the numerical variables by excluding</span><a id="_idIndexMarker020"/><span class="koboSpan" id="kobo.321.1" xmlns:="http://www.w3.org/1999/xhtml"> variables of </span><span class="No-Break"><span class="koboSpan" id="kobo.322.1" xmlns:="http://www.w3.org/1999/xhtml">type object:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.323.1" xmlns:="http://www.w3.org/1999/xhtml">
numeric_vars = X_train.select_dtypes(
    exclude="O").columns.to_list()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.324.1" xmlns:="http://www.w3.org/1999/xhtml">If you execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.325.1" xmlns:="http://www.w3.org/1999/xhtml">numeric_vars</span></strong><span class="koboSpan" id="kobo.326.1" xmlns:="http://www.w3.org/1999/xhtml">, you will see the names of the numerical variables: </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1" xmlns:="http://www.w3.org/1999/xhtml">['A2', 'A3', 'A8', 'A11', '</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.328.1" xmlns:="http://www.w3.org/1999/xhtml">A14', 'A15']</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.329.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.330.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s capture the variables’ median values in </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1" xmlns:="http://www.w3.org/1999/xhtml">a dictionary:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.332.1" xmlns:="http://www.w3.org/1999/xhtml">
median_values = X_train[
    numeric_vars].median().to_dict()</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.333.1" xmlns:="http://www.w3.org/1999/xhtml">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.334.1" xmlns:="http://www.w3.org/1999/xhtml">Note how we calculate the median using the train set. </span><span class="koboSpan" id="kobo.334.2" xmlns:="http://www.w3.org/1999/xhtml">We will use these values to replace missing data in the train and test sets. </span><span class="koboSpan" id="kobo.334.3" xmlns:="http://www.w3.org/1999/xhtml">To calculate the mean, use pandas </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1" xmlns:="http://www.w3.org/1999/xhtml">mean()</span></strong><span class="koboSpan" id="kobo.336.1" xmlns:="http://www.w3.org/1999/xhtml"> instead </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1" xmlns:="http://www.w3.org/1999/xhtml">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.338.1" xmlns:="http://www.w3.org/1999/xhtml">median()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.339.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.340.1" xmlns:="http://www.w3.org/1999/xhtml">If you execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1" xmlns:="http://www.w3.org/1999/xhtml">median_values</span></strong><span class="koboSpan" id="kobo.342.1" xmlns:="http://www.w3.org/1999/xhtml">, you will see a dictionary with the median value per variable: </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1" xmlns:="http://www.w3.org/1999/xhtml">{'A2': 28.835, 'A3': 2.75, 'A8': 1.0, 'A11': 0.0, 'A14': 160.0, '</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.344.1" xmlns:="http://www.w3.org/1999/xhtml">A15': 6.0}.</span></strong></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.345.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s replace missing data with </span><span class="No-Break"><span class="koboSpan" id="kobo.346.1" xmlns:="http://www.w3.org/1999/xhtml">the median:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.347.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = X_train.fillna(value=median_values)
X_test_t = X_test.fillna(value=median_values)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.348.1" xmlns:="http://www.w3.org/1999/xhtml">If you execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_t[numeric_vars].isnull().sum()</span></strong><span class="koboSpan" id="kobo.350.1" xmlns:="http://www.w3.org/1999/xhtml"> after the imputation, the number of missing values in the numerical variables should </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1" xmlns:="http://www.w3.org/1999/xhtml">be </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.352.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.353.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.354.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.355.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.356.1" xmlns:="http://www.w3.org/1999/xhtml">fillna()</span></strong><span class="koboSpan" id="kobo.357.1" xmlns:="http://www.w3.org/1999/xhtml"> returns a new dataset with imputed values by default. </span><span class="koboSpan" id="kobo.357.2" xmlns:="http://www.w3.org/1999/xhtml">To replace missing data in the original DataFrame, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1" xmlns:="http://www.w3.org/1999/xhtml">inplace</span></strong><span class="koboSpan" id="kobo.359.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.361.1" xmlns:="http://www.w3.org/1999/xhtml">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.362.1" xmlns:="http://www.w3.org/1999/xhtml">X_train.fillna(value=median_values, inplace</span><a id="_idTextAnchor061"/><span class="koboSpan" id="kobo.363.1" xmlns:="http://www.w3.org/1999/xhtml">=True)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.364.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.365.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s impute missing valu</span><a id="_idTextAnchor062"/><span class="koboSpan" id="kobo.366.1" xmlns:="http://www.w3.org/1999/xhtml">es with the median </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.368.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.369.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.370.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the imputer</span><a id="_idIndexMarker021"/><span class="koboSpan" id="kobo.371.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace missing data with</span><a id="_idIndexMarker022"/> <span class="No-Break"><span class="koboSpan" id="kobo.372.1" xmlns:="http://www.w3.org/1999/xhtml">the median:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.373.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = SimpleImputer(strategy="median")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.374.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.375.1" xmlns:="http://www.w3.org/1999/xhtml">To perform mean imputation, set </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.377.1" xmlns:="http://www.w3.org/1999/xhtml"> as follows: </span><strong class="source-inline"><span class="koboSpan" id="kobo.378.1" xmlns:="http://www.w3.org/1999/xhtml">imputer =</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.379.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer(strategy = "</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.380.1" xmlns:="http://www.w3.org/1999/xhtml">mean")</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.381.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.382.1" xmlns:="http://www.w3.org/1999/xhtml">We restrict the imputation to the numerical variables by </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.384.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.385.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.386.1" xmlns:="http://www.w3.org/1999/xhtml">
ct = ColumnTransformer(
    [("imputer", imputer, numeric_vars)],
    remainder="passthrough",
    force_int_remainder_cols=False,
).set_output(transform="pandas")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.387.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.388.1" xmlns:="http://www.w3.org/1999/xhtml">Scikit-learn can return </span><strong class="source-inline"><span class="koboSpan" id="kobo.389.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong><span class="koboSpan" id="kobo.390.1" xmlns:="http://www.w3.org/1999/xhtml"> arrays, </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.392.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrames, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.393.1" xmlns:="http://www.w3.org/1999/xhtml">polar</span></strong><span class="koboSpan" id="kobo.394.1" xmlns:="http://www.w3.org/1999/xhtml"> frames, depending on how we set out the transform output. </span><span class="koboSpan" id="kobo.394.2" xmlns:="http://www.w3.org/1999/xhtml">By default, it returns </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.395.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.396.1" xmlns:="http://www.w3.org/1999/xhtml"> arrays.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.397.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the imputer</span><a id="_idIndexMarker023"/><span class="koboSpan" id="kobo.398.1" xmlns:="http://www.w3.org/1999/xhtml"> to the train set so that it learns the </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1" xmlns:="http://www.w3.org/1999/xhtml">median</span></span><span class="No-Break"><a id="_idIndexMarker024"/></span><span class="No-Break"><span class="koboSpan" id="kobo.400.1" xmlns:="http://www.w3.org/1999/xhtml"> values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.401.1" xmlns:="http://www.w3.org/1999/xhtml">
ct.fit(X_tr</span><a id="_idTextAnchor063"/><span class="koboSpan" id="kobo.402.1" xmlns:="http://www.w3.org/1999/xhtml">ain)</span></pre></li> <li><span class="koboSpan" id="kobo.403.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s check out the learned </span><span class="No-Break"><span class="koboSpan" id="kobo.404.1" xmlns:="http://www.w3.org/1999/xhtml">median values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.405.1" xmlns:="http://www.w3.org/1999/xhtml">
ct.named_transformers_.i</span><a id="_idTextAnchor064"/><span class="koboSpan" id="kobo.406.1" xmlns:="http://www.w3.org/1999/xhtml">mputer.statistics_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.407.1" xmlns:="http://www.w3.org/1999/xhtml">The previous command returns the median values </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1" xmlns:="http://www.w3.org/1999/xhtml">per variable:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.409.1" xmlns:="http://www.w3.org/1999/xhtml">array([ 28.835,   2.75,   1.,   0., 160.,   6.])</span></pre></li> <li><span class="koboSpan" id="kobo.410.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s replace missing values with </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1" xmlns:="http://www.w3.org/1999/xhtml">the median:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.412.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = ct.transform(X_train)
X_test_t = ct.transform(X_test)</span></pre></li> <li><span class="koboSpan" id="kobo.413.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s display the resulting </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1" xmlns:="http://www.w3.org/1999/xhtml">training set:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.415.1" xmlns:="http://www.w3.org/1999/xhtml">
print(X_train_t.head())</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.416.1" xmlns:="http://www.w3.org/1999/xhtml">We see the resulting DataFrame in the </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1" xmlns:="http://www.w3.org/1999/xhtml">following image:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer007">
<span class="koboSpan" id="kobo.418.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.3 – Training set after the imputation. The imputed variables are marked by the imputer prefix; the untransformed variables show the prefix remainder" src="image/B22396_01_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.419.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.3 – Training set after the imputation. </span><span class="koboSpan" id="kobo.419.2" xmlns:="http://www.w3.org/1999/xhtml">The imputed variables are marked by the imputer prefix; the untransformed variables show the prefix remainder</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.420.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s perform median imputation </span><span class="No-Break"><span class="koboSpan" id="kobo.421.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.422.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.423.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.424.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the imputer</span><a id="_idIndexMarker025"/><span class="koboSpan" id="kobo.425.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace missing data in numerical variables</span><a id="_idIndexMarker026"/><span class="koboSpan" id="kobo.426.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1" xmlns:="http://www.w3.org/1999/xhtml">the median:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.428.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = MeanMedianImputer(
    imputation_method="median",
    variables=numeric_vars,
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.429.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.430.1" xmlns:="http://www.w3.org/1999/xhtml">To perform mean imputation, change </span><strong class="source-inline"><span class="koboSpan" id="kobo.431.1" xmlns:="http://www.w3.org/1999/xhtml">imputation_method</span></strong><span class="koboSpan" id="kobo.432.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.433.1" xmlns:="http://www.w3.org/1999/xhtml">"mean"</span></strong><span class="koboSpan" id="kobo.434.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.434.2" xmlns:="http://www.w3.org/1999/xhtml">By default </span><strong class="source-inline"><span class="koboSpan" id="kobo.435.1" xmlns:="http://www.w3.org/1999/xhtml">MeanMedianImputer()</span></strong><span class="koboSpan" id="kobo.436.1" xmlns:="http://www.w3.org/1999/xhtml"> will impute all numerical variables in the DataFrame, ignoring categorical variables. </span><span class="koboSpan" id="kobo.436.2" xmlns:="http://www.w3.org/1999/xhtml">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.438.1" xmlns:="http://www.w3.org/1999/xhtml"> argument to restrict the imputation to a subset of </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1" xmlns:="http://www.w3.org/1999/xhtml">numer</span><a id="_idTextAnchor065"/><span class="koboSpan" id="kobo.440.1" xmlns:="http://www.w3.org/1999/xhtml">ical variables.</span></span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.441.1" xmlns:="http://www.w3.org/1999/xhtml">Fit the imputer so th</span><a id="_idTextAnchor066"/><span class="koboSpan" id="kobo.442.1" xmlns:="http://www.w3.org/1999/xhtml">at it learns the </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1" xmlns:="http://www.w3.org/1999/xhtml">median values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.444.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.445.1" xmlns:="http://www.w3.org/1999/xhtml">Inspect the </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1" xmlns:="http://www.w3.org/1999/xhtml">learned medians:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.447.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.imputer_dict_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.448.1" xmlns:="http://www.w3.org/1999/xhtml">The previous command returns the median values in </span><span class="No-Break"><span class="koboSpan" id="kobo.449.1" xmlns:="http://www.w3.org/1999/xhtml">a dictionary:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.450.1" xmlns:="http://www.w3.org/1999/xhtml">{</span><strong class="bold"><span class="koboSpan" id="kobo.451.1" xmlns:="http://www.w3.org/1999/xhtml">'A2': 28.835, 'A3': 2.75, 'A8': 1.0, 'A11': 0.0, 'A14': 160.0, 'A15': 6.0}</span></strong></pre></li> <li><span class="koboSpan" id="kobo.452.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s replace the missing values with </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1" xmlns:="http://www.w3.org/1999/xhtml">the median:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.454.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train = imputer.transform(X_train)
X_test = imputer.transform(X_test)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.455.1" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1" xmlns:="http://www.w3.org/1999/xhtml">MeanMedianImputer()</span></strong><span class="koboSpan" id="kobo.457.1" xmlns:="http://www.w3.org/1999/xhtml"> returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1" xmlns:="http://www.w3.org/1999/xhtml">DataFrame</span></strong><span class="koboSpan" id="kobo.459.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.459.2" xmlns:="http://www.w3.org/1999/xhtml">You can check that the imputed variables do not contain missing values </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.461.1" xmlns:="http://www.w3.org/1999/xhtml">X_train[numeric</span><a id="_idTextAnchor067"/><a id="_idTextAnchor068"/><span class="koboSpan" id="kobo.462.1" xmlns:="http://www.w3.org/1999/xhtml">_vars].isnull().mean()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.463.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-30"><a id="_idTextAnchor069"/><span class="koboSpan" id="kobo.464.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.465.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we replaced</span><a id="_idIndexMarker027"/><span class="koboSpan" id="kobo.466.1" xmlns:="http://www.w3.org/1999/xhtml"> missing data with the variable’s median values</span><a id="_idIndexMarker028"/><span class="koboSpan" id="kobo.467.1" xmlns:="http://www.w3.org/1999/xhtml"> using </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.469.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.470.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.471.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.472.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.473.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.474.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.475.1" xmlns:="http://www.w3.org/1999/xhtml">We divided the dataset into train and test sets using scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.476.1" xmlns:="http://www.w3.org/1999/xhtml">train_test_split()</span></strong><span class="koboSpan" id="kobo.477.1" xmlns:="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.477.2" xmlns:="http://www.w3.org/1999/xhtml">The function takes the predictor variables, the target, the fraction of observations to retain in the test set, and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1" xmlns:="http://www.w3.org/1999/xhtml">random_state</span></strong><span class="koboSpan" id="kobo.479.1" xmlns:="http://www.w3.org/1999/xhtml"> value for reproducibility, as arguments. </span><span class="koboSpan" id="kobo.479.2" xmlns:="http://www.w3.org/1999/xhtml">It returned a train set with 70% of the original observations and a test set with 30% of the original observations. </span><span class="koboSpan" id="kobo.479.3" xmlns:="http://www.w3.org/1999/xhtml">The 70:30 split was done </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1" xmlns:="http://www.w3.org/1999/xhtml">at random.</span></span></p>
<p><span class="koboSpan" id="kobo.481.1" xmlns:="http://www.w3.org/1999/xhtml">To impute missing data with pandas, in </span><em class="italic"><span class="koboSpan" id="kobo.482.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em><span class="koboSpan" id="kobo.483.1" xmlns:="http://www.w3.org/1999/xhtml">, we created a dictionary with the numerical variable names as keys and their medians as values. </span><span class="koboSpan" id="kobo.483.2" xmlns:="http://www.w3.org/1999/xhtml">The median values were learned from the training set to avoid data leakage. </span><span class="koboSpan" id="kobo.483.3" xmlns:="http://www.w3.org/1999/xhtml">To replace missing data, we applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.485.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1" xmlns:="http://www.w3.org/1999/xhtml">fillna()</span></strong><span class="koboSpan" id="kobo.487.1" xmlns:="http://www.w3.org/1999/xhtml"> to train and test sets, passing the dictionary with the median values per variable as </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1" xmlns:="http://www.w3.org/1999/xhtml">a parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.489.1" xmlns:="http://www.w3.org/1999/xhtml">To replace the missing values with the median using </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.491.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.493.1" xmlns:="http://www.w3.org/1999/xhtml"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.494.1" xmlns:="http://www.w3.org/1999/xhtml">strategy</span></strong><span class="koboSpan" id="kobo.495.1" xmlns:="http://www.w3.org/1999/xhtml"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1" xmlns:="http://www.w3.org/1999/xhtml">"median"</span></strong><span class="koboSpan" id="kobo.497.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.497.2" xmlns:="http://www.w3.org/1999/xhtml">To restrict the imputation to numerical variables, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.499.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.499.2" xmlns:="http://www.w3.org/1999/xhtml">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong><span class="koboSpan" id="kobo.501.1" xmlns:="http://www.w3.org/1999/xhtml"> argument set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1" xmlns:="http://www.w3.org/1999/xhtml">passthrough</span></strong><span class="koboSpan" id="kobo.503.1" xmlns:="http://www.w3.org/1999/xhtml">, we made </span><strong class="source-inline"><span class="koboSpan" id="kobo.504.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.505.1" xmlns:="http://www.w3.org/1999/xhtml"> return </span><em class="italic"><span class="koboSpan" id="kobo.506.1" xmlns:="http://www.w3.org/1999/xhtml">all the variables</span></em><span class="koboSpan" id="kobo.507.1" xmlns:="http://www.w3.org/1999/xhtml"> seen in the training set in the transformed output; the imputed ones followed by those that were </span><span class="No-Break"><span class="koboSpan" id="kobo.508.1" xmlns:="http://www.w3.org/1999/xhtml">not transformed.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.509.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.510.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.511.1" xmlns:="http://www.w3.org/1999/xhtml"> changes the names of the variables in the output. </span><span class="koboSpan" id="kobo.511.2" xmlns:="http://www.w3.org/1999/xhtml">The transformed variables show the prefix </span><strong class="source-inline"><span class="koboSpan" id="kobo.512.1" xmlns:="http://www.w3.org/1999/xhtml">imputer</span></strong><span class="koboSpan" id="kobo.513.1" xmlns:="http://www.w3.org/1999/xhtml"> and the unchanged variables show the </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1" xmlns:="http://www.w3.org/1999/xhtml">prefix </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.515.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.516.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.517.1" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.518.1" xmlns:="http://www.w3.org/1999/xhtml">step 8</span></em><span class="koboSpan" id="kobo.519.1" xmlns:="http://www.w3.org/1999/xhtml">, we set the output of the column transformer to </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.521.1" xmlns:="http://www.w3.org/1999/xhtml"> to obtain a DataFrame as a result. </span><span class="koboSpan" id="kobo.521.2" xmlns:="http://www.w3.org/1999/xhtml">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.523.1" xmlns:="http://www.w3.org/1999/xhtml"> returns </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.524.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.525.1" xmlns:="http://www.w3.org/1999/xhtml"> arrays.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.526.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.527.1" xmlns:="http://www.w3.org/1999/xhtml">From version 1.4.0, </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.529.1" xmlns:="http://www.w3.org/1999/xhtml"> transformers can return </span><strong class="source-inline"><span class="koboSpan" id="kobo.530.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong><span class="koboSpan" id="kobo.531.1" xmlns:="http://www.w3.org/1999/xhtml"> arrays, </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.533.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrames, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1" xmlns:="http://www.w3.org/1999/xhtml">polar</span></strong><span class="koboSpan" id="kobo.535.1" xmlns:="http://www.w3.org/1999/xhtml"> frames as a result of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.536.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.537.1" xmlns:="http://www.w3.org/1999/xhtml"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.538.1" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.540.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.542.1" xmlns:="http://www.w3.org/1999/xhtml"> learned the median of each numerical variable in the train set and stored them in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1" xmlns:="http://www.w3.org/1999/xhtml">statistics_</span></strong><span class="koboSpan" id="kobo.544.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.544.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.545.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.546.1" xmlns:="http://www.w3.org/1999/xhtml">, it replaced the missing values with </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1" xmlns:="http://www.w3.org/1999/xhtml">the medians.</span></span></p>
<p><span class="koboSpan" id="kobo.548.1" xmlns:="http://www.w3.org/1999/xhtml">To replace missing values with the median using Feature-engine, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1" xmlns:="http://www.w3.org/1999/xhtml">MeanMedianImputer()</span></strong><span class="koboSpan" id="kobo.550.1" xmlns:="http://www.w3.org/1999/xhtml"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1" xmlns:="http://www.w3.org/1999/xhtml">imputation_method</span></strong><span class="koboSpan" id="kobo.552.1" xmlns:="http://www.w3.org/1999/xhtml"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.553.1" xmlns:="http://www.w3.org/1999/xhtml">median</span></strong><span class="koboSpan" id="kobo.554.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.554.2" xmlns:="http://www.w3.org/1999/xhtml">To restrict the imputation to a subset of variables, we passed the variable names in a list to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.556.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter. </span><span class="koboSpan" id="kobo.556.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.558.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer learned and stored the median values per</span><a id="_idTextAnchor070"/><span class="koboSpan" id="kobo.559.1" xmlns:="http://www.w3.org/1999/xhtml"> variable</span><a id="_idIndexMarker029"/><span class="koboSpan" id="kobo.560.1" xmlns:="http://www.w3.org/1999/xhtml"> in a dictionary</span><a id="_idIndexMarker030"/><span class="koboSpan" id="kobo.561.1" xmlns:="http://www.w3.org/1999/xhtml"> in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.562.1" xmlns:="http://www.w3.org/1999/xhtml">imputer_dict_</span></strong><span class="koboSpan" id="kobo.563.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.563.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.564.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.565.1" xmlns:="http://www.w3.org/1999/xhtml">, it replaced the missing values, re</span><a id="_idTextAnchor071"/><a id="_idTextAnchor072"/><span class="koboSpan" id="kobo.566.1" xmlns:="http://www.w3.org/1999/xhtml">turning a </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1" xmlns:="http://www.w3.org/1999/xhtml">pandas DataFrame.</span></span></p>
<h1 id="_idParaDest-31"><a id="_idTextAnchor073"/><span class="koboSpan" id="kobo.568.1" xmlns:="http://www.w3.org/1999/xhtml">Imputing categorical variables</span></h1>
<p><span class="koboSpan" id="kobo.569.1" xmlns:="http://www.w3.org/1999/xhtml">We typically impute categorical variables</span><a id="_idIndexMarker031"/><span class="koboSpan" id="kobo.570.1" xmlns:="http://www.w3.org/1999/xhtml"> with the most frequent category, or with a specific string. </span><span class="koboSpan" id="kobo.570.2" xmlns:="http://www.w3.org/1999/xhtml">To avoid data leakage, we find the frequent categories from the train set. </span><span class="koboSpan" id="kobo.570.3" xmlns:="http://www.w3.org/1999/xhtml">Then, we use these values to impute the train, test, and future datasets. </span><strong class="source-inline"><span class="koboSpan" id="kobo.571.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.572.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.574.1" xmlns:="http://www.w3.org/1999/xhtml"> find and store the frequent categories for the imputation, out of </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1" xmlns:="http://www.w3.org/1999/xhtml">the box.</span></span></p>
<p><span class="koboSpan" id="kobo.576.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will replace missing data in categorical variables with the most frequent category, </span><a id="_idTextAnchor074"/><a id="_idTextAnchor075"/><span class="koboSpan" id="kobo.577.1" xmlns:="http://www.w3.org/1999/xhtml">or with an </span><span class="No-Break"><span class="koboSpan" id="kobo.578.1" xmlns:="http://www.w3.org/1999/xhtml">arbitrary string.</span></span></p>
<h2 id="_idParaDest-32"><a id="_idTextAnchor076"/><span class="koboSpan" id="kobo.579.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.580.1" xmlns:="http://www.w3.org/1999/xhtml">To begin, let’s make a few imports and prepare </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.582.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><strong class="source-inline"><span class="koboSpan" id="kobo.583.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.584.1" xmlns:="http://www.w3.org/1999/xhtml"> and the required functions and classes from </span><strong class="source-inline"><span class="koboSpan" id="kobo.585.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.586.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.587.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.588.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.589.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.impute import SimpleImputer
from sklearn.compose import ColumnTransformer
from feature_engine.imputation import CategoricalImputer</span></pre></li> <li><span class="koboSpan" id="kobo.590.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the dataset that we prepared in the </span><em class="italic"><span class="koboSpan" id="kobo.591.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.592.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.593.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.594.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_ap</span><a id="_idTextAnchor077"/><span class="koboSpan" id="kobo.595.1" xmlns:="http://www.w3.org/1999/xhtml">proval_uci.csv")</span></pre></li> <li><span class="koboSpan" id="kobo.596.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s split the data into train and test sets and their </span><span class="No-Break"><span class="koboSpan" id="kobo.597.1" xmlns:="http://www.w3.org/1999/xhtml">respective targets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.598.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    data.drop("target", axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.599.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s capture the categorical variables in </span><span class="No-Break"><span class="koboSpan" id="kobo.600.1" xmlns:="http://www.w3.org/1999/xhtml">a list:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.601.1" xmlns:="http://www.w3.org/1999/xhtml">
categorical_vars = X_train.select_dtypes(
    include="O").columns.to_list()</span></pre></li> <li><span class="koboSpan" id="kobo.602.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s store the variables’ most frequent categories in </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1" xmlns:="http://www.w3.org/1999/xhtml">a dictionary:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.604.1" xmlns:="http://www.w3.org/1999/xhtml">
frequent_values = X_train[
    categorical_vars].mode().iloc[0].to_dict()</span></pre></li> <li><span class="koboSpan" id="kobo.605.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s replace missing values</span><a id="_idIndexMarker032"/><span class="koboSpan" id="kobo.606.1" xmlns:="http://www.w3.org/1999/xhtml"> with the </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1" xmlns:="http://www.w3.org/1999/xhtml">frequent categories:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.608.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = X_train.fillna(value=frequent_values)
X_test_t = X_test.fillna(value=frequent_values)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.609.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.610.1" xmlns:="http://www.w3.org/1999/xhtml">fillna()</span></strong><span class="koboSpan" id="kobo.611.1" xmlns:="http://www.w3.org/1999/xhtml"> returns a new DataFrame with the imputed values by default. </span><span class="koboSpan" id="kobo.611.2" xmlns:="http://www.w3.org/1999/xhtml">We can replace missing data in the original DataFrame by executing </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.612.1" xmlns:="http://www.w3.org/1999/xhtml">X_train.fillna(value=frequent_valu</span><a id="_idTextAnchor078"/><span class="koboSpan" id="kobo.613.1" xmlns:="http://www.w3.org/1999/xhtml">es, inplace=True)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.614.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.615.1" xmlns:="http://www.w3.org/1999/xhtml">To replace missing data with a specific string, let’s create an imputation dictionary with the categorical variable names as the keys and an arbitrary string as </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1" xmlns:="http://www.w3.org/1999/xhtml">the values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.617.1" xmlns:="http://www.w3.org/1999/xhtml">
imputation_dict = {var:
     "no_data" for var in categorical_vars}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.618.1" xmlns:="http://www.w3.org/1999/xhtml">Now, we can use this dictionary and the code in </span><em class="italic"><span class="koboSpan" id="kobo.619.1" xmlns:="http://www.w3.org/1999/xhtml">step 6</span></em><span class="koboSpan" id="kobo.620.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.622.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.623.1" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.625.1" xmlns:="http://www.w3.org/1999/xhtml">value_counts()</span></strong><span class="koboSpan" id="kobo.626.1" xmlns:="http://www.w3.org/1999/xhtml"> we can see the string added by the imputation. </span><span class="koboSpan" id="kobo.626.2" xmlns:="http://www.w3.org/1999/xhtml">Try executing, for </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1" xmlns:="http://www.w3.org/1999/xhtml">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.628.1" xmlns:="http://www.w3.org/1999/xhtml">X_train["A1"].value_counts()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.629.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.630.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s impute missing values with the most frequent category </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.632.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.633.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.634.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the imputer to find the most frequent category </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1" xmlns:="http://www.w3.org/1999/xhtml">per variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.636.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = SimpleImputer(strategy='most_frequent')</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.637.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.638.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.639.1" xmlns:="http://www.w3.org/1999/xhtml"> will learn the mode for numerical and categorical variables alike. </span><span class="koboSpan" id="kobo.639.2" xmlns:="http://www.w3.org/1999/xhtml">But in practice, mode imputation is done for categorical </span><span class="No-Break"><span class="koboSpan" id="kobo.640.1" xmlns:="http://www.w3.org/1999/xhtml">variables only.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.641.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s restrict the imputation </span><a id="_idIndexMarker033"/><span class="koboSpan" id="kobo.642.1" xmlns:="http://www.w3.org/1999/xhtml">to the </span><span class="No-Break"><span class="koboSpan" id="kobo.643.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.644.1" xmlns:="http://www.w3.org/1999/xhtml">
ct = ColumnTransformer(
    [("imputer",imputer, categorical_vars)],
    remainder="passthrough"
    ).set_output(transform="pandas")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.645.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.646.1" xmlns:="http://www.w3.org/1999/xhtml">To impute missing data with a string instead of the most frequent category, set </span><strong class="source-inline"><span class="koboSpan" id="kobo.647.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.648.1" xmlns:="http://www.w3.org/1999/xhtml"> as follows: </span><strong class="source-inline"><span class="koboSpan" id="kobo.649.1" xmlns:="http://www.w3.org/1999/xhtml">imputer = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.650.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer(strategy="constant", </span><a id="_idTextAnchor079"/><span class="koboSpan" id="kobo.651.1" xmlns:="http://www.w3.org/1999/xhtml">fill_value="missing")</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.652.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.653.1" xmlns:="http://www.w3.org/1999/xhtml">Fit the imputer to the train set so that it learns the most </span><span class="No-Break"><span class="koboSpan" id="kobo.654.1" xmlns:="http://www.w3.org/1999/xhtml">frequent values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.655.1" xmlns:="http://www.w3.org/1999/xhtml">
ct.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.656.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s take a look at the most frequent values learned by </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1" xmlns:="http://www.w3.org/1999/xhtml">the imputer:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.658.1" xmlns:="http://www.w3.org/1999/xhtml">
ct.named_transformers_.imputer.statistics_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.659.1" xmlns:="http://www.w3.org/1999/xhtml">The previous command returns the most frequent values </span><span class="No-Break"><span class="koboSpan" id="kobo.660.1" xmlns:="http://www.w3.org/1999/xhtml">per variable:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.661.1" xmlns:="http://www.w3.org/1999/xhtml">array(['b', 'u', 'g', 'c', 'v', 't', 'f', 'f', 'g'], dtype=object)</span></strong></pre></li> <li><span class="koboSpan" id="kobo.662.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s replace missing values with the </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1" xmlns:="http://www.w3.org/1999/xhtml">frequent categories:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.664.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = ct.transform(X_train)
X_test_t = ct.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.665.1" xmlns:="http://www.w3.org/1999/xhtml">Make sure to inspect the resulting DataFrames by </span><span class="No-Break"><span class="koboSpan" id="kobo.666.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.667.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_t.head()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.668.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.669.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.670.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.672.1" xmlns:="http://www.w3.org/1999/xhtml"> changes the names of the variables. </span><span class="koboSpan" id="kobo.672.2" xmlns:="http://www.w3.org/1999/xhtml">The imputed variables show the prefix </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1" xmlns:="http://www.w3.org/1999/xhtml">imputer</span></strong><span class="koboSpan" id="kobo.674.1" xmlns:="http://www.w3.org/1999/xhtml"> and the untransformed variables the </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1" xmlns:="http://www.w3.org/1999/xhtml">prefix </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.676.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.677.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.678.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s impute missing value</span><a id="_idTextAnchor080"/><span class="koboSpan" id="kobo.679.1" xmlns:="http://www.w3.org/1999/xhtml">s </span><span class="No-Break"><span class="koboSpan" id="kobo.680.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.681.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.682.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.683.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the imputer</span><a id="_idIndexMarker034"/><span class="koboSpan" id="kobo.684.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace the missing data in categorical variables with their most </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1" xmlns:="http://www.w3.org/1999/xhtml">frequent value:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.686.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = CategoricalImputer(
    imputation_method="frequent",
    variables=categorical_vars,
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.687.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.688.1" xmlns:="http://www.w3.org/1999/xhtml">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.689.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.690.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.691.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.692.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.693.1" xmlns:="http://www.w3.org/1999/xhtml">CategoricalImputer()</span></strong><span class="koboSpan" id="kobo.694.1" xmlns:="http://www.w3.org/1999/xhtml"> will automatically impute all categorical variables found in the train set. </span><span class="koboSpan" id="kobo.694.2" xmlns:="http://www.w3.org/1999/xhtml">Use this parameter to restrict the imputation to a subset of categorical variables, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.695.1" xmlns:="http://www.w3.org/1999/xhtml">step 13</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.696.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.697.1" xmlns:="http://www.w3.org/1999/xhtml">Fit the imputer to the train set so that it learns the most </span><span class="No-Break"><span class="koboSpan" id="kobo.698.1" xmlns:="http://www.w3.org/1999/xhtml">frequent categories:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.699.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.fit(X_train)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.700.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.701.1" xmlns:="http://www.w3.org/1999/xhtml">To impute categorical variables with a specific string, set </span><strong class="source-inline"><span class="koboSpan" id="kobo.702.1" xmlns:="http://www.w3.org/1999/xhtml">imputation_method</span></strong><span class="koboSpan" id="kobo.703.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.704.1" xmlns:="http://www.w3.org/1999/xhtml">missing</span></strong><span class="koboSpan" id="kobo.705.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.706.1" xmlns:="http://www.w3.org/1999/xhtml">fill_value</span></strong><span class="koboSpan" id="kobo.707.1" xmlns:="http://www.w3.org/1999/xhtml"> to the </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1" xmlns:="http://www.w3.org/1999/xhtml">desired string.</span></span></p>
<ol>
<li value="15"><span class="koboSpan" id="kobo.709.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s check out the </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1" xmlns:="http://www.w3.org/1999/xhtml">learned categories:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.711.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.imputer_dict_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.712.1" xmlns:="http://www.w3.org/1999/xhtml">We can see the dictionary</span><a id="_idIndexMarker035"/><span class="koboSpan" id="kobo.713.1" xmlns:="http://www.w3.org/1999/xhtml"> with the most frequent values in the </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.715.1" xmlns:="http://www.w3.org/1999/xhtml">{'A1': 'b',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.716.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A4': 'u',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.717.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A5': 'g',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.718.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A6': 'c',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.719.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A7': 'v',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.720.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A9': 't',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.721.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A10': 'f',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.722.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A12': 'f',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.723.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A13': 'g'}</span></strong></pre></li> <li><span class="koboSpan" id="kobo.724.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s replace the missing values with </span><span class="No-Break"><span class="koboSpan" id="kobo.725.1" xmlns:="http://www.w3.org/1999/xhtml">frequent categories:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.726.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = imputer.transform(X_train)
X_test_t = imputer.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.727.1" xmlns:="http://www.w3.org/1999/xhtml">If you want to impute numerical variables with a string or the most frequent value using </span><strong class="source-inline"><span class="koboSpan" id="kobo.728.1" xmlns:="http://www.w3.org/1999/xhtml">CategoricalImputer()</span></strong><span class="koboSpan" id="kobo.729.1" xmlns:="http://www.w3.org/1999/xhtml">, set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.730.1" xmlns:="http://www.w3.org/1999/xhtml">ignore_format</span></strong><span class="koboSpan" id="kobo.731.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1" xmlns:="http://www.w3.org/1999/xhtml">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.733.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.734.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> </ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.735.1" xmlns:="http://www.w3.org/1999/xhtml">CategoricalImputer()</span></strong><span class="koboSpan" id="kobo.736.1" xmlns:="http://www.w3.org/1999/xhtml"> returns</span><a id="_idTextAnchor081"/><a id="_idTextAnchor082"/><span class="koboSpan" id="kobo.737.1" xmlns:="http://www.w3.org/1999/xhtml"> a pandas DataFrame as </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1" xmlns:="http://www.w3.org/1999/xhtml">a result.</span></span></p>
<h2 id="_idParaDest-33"><a id="_idTextAnchor083"/><span class="koboSpan" id="kobo.739.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.740.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we replaced missing values in categorical </span><a id="_idTextAnchor084"/><span class="koboSpan" id="kobo.741.1" xmlns:="http://www.w3.org/1999/xhtml">variables with the most frequent categories or an arbitrary string. </span><span class="koboSpan" id="kobo.741.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.742.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.743.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.744.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.745.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.747.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.748.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.749.1" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.750.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em><span class="koboSpan" id="kobo.751.1" xmlns:="http://www.w3.org/1999/xhtml">, we created a dictionary </span><a id="_idIndexMarker036"/><span class="koboSpan" id="kobo.752.1" xmlns:="http://www.w3.org/1999/xhtml">with the variable names as keys and the frequent categories as values. </span><span class="koboSpan" id="kobo.752.2" xmlns:="http://www.w3.org/1999/xhtml">To capture the frequent categories, we used pandas </span><strong class="source-inline"><span class="koboSpan" id="kobo.753.1" xmlns:="http://www.w3.org/1999/xhtml">mode()</span></strong><span class="koboSpan" id="kobo.754.1" xmlns:="http://www.w3.org/1999/xhtml">, and to return a dictionary, we used pandas </span><strong class="source-inline"><span class="koboSpan" id="kobo.755.1" xmlns:="http://www.w3.org/1999/xhtml">to_dict()</span></strong><span class="koboSpan" id="kobo.756.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.756.2" xmlns:="http://www.w3.org/1999/xhtml">To replace the missing data, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.758.1" xmlns:="http://www.w3.org/1999/xhtml">fillna()</span></strong><span class="koboSpan" id="kobo.759.1" xmlns:="http://www.w3.org/1999/xhtml">, passing the dictionary with the variables and their frequent categories as parameters. </span><span class="koboSpan" id="kobo.759.2" xmlns:="http://www.w3.org/1999/xhtml">There can be more than one mode in a variable, that’s why we made sure to capture only one of those valu</span><a id="_idTextAnchor085"/><span class="koboSpan" id="kobo.760.1" xmlns:="http://www.w3.org/1999/xhtml">es by </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.762.1" xmlns:="http://www.w3.org/1999/xhtml">.iloc[0]</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.763.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.764.1" xmlns:="http://www.w3.org/1999/xhtml">To replace the missing values using </span><strong class="source-inline"><span class="koboSpan" id="kobo.765.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.766.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.767.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.768.1" xmlns:="http://www.w3.org/1999/xhtml"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.769.1" xmlns:="http://www.w3.org/1999/xhtml">strategy</span></strong><span class="koboSpan" id="kobo.770.1" xmlns:="http://www.w3.org/1999/xhtml"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.771.1" xmlns:="http://www.w3.org/1999/xhtml">most_frequent</span></strong><span class="koboSpan" id="kobo.772.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.772.2" xmlns:="http://www.w3.org/1999/xhtml">To restrict the imputation to categorical variables, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.773.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.774.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.774.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.775.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong><span class="koboSpan" id="kobo.776.1" xmlns:="http://www.w3.org/1999/xhtml"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.777.1" xmlns:="http://www.w3.org/1999/xhtml">passthrough</span></strong><span class="koboSpan" id="kobo.778.1" xmlns:="http://www.w3.org/1999/xhtml">, we made </span><strong class="source-inline"><span class="koboSpan" id="kobo.779.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.780.1" xmlns:="http://www.w3.org/1999/xhtml"> return all the variables present in the training set as a result of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.781.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.782.1" xmlns:="http://www.w3.org/1999/xhtml">method .</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.783.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.784.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.785.1" xmlns:="http://www.w3.org/1999/xhtml"> changes the names of the variables in the output. </span><span class="koboSpan" id="kobo.785.2" xmlns:="http://www.w3.org/1999/xhtml">The transformed variables show the prefix </span><strong class="source-inline"><span class="koboSpan" id="kobo.786.1" xmlns:="http://www.w3.org/1999/xhtml">imputer</span></strong><span class="koboSpan" id="kobo.787.1" xmlns:="http://www.w3.org/1999/xhtml"> and the unchanged variables show the </span><span class="No-Break"><span class="koboSpan" id="kobo.788.1" xmlns:="http://www.w3.org/1999/xhtml">prefix </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.789.1" xmlns:="http://www.w3.org/1999/xhtml">remainder</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.790.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.791.1" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.792.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.793.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.794.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.795.1" xmlns:="http://www.w3.org/1999/xhtml"> learned the variables’ most frequent categories and stored them in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.796.1" xmlns:="http://www.w3.org/1999/xhtml">statistics_</span></strong><span class="koboSpan" id="kobo.797.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.797.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.798.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.799.1" xmlns:="http://www.w3.org/1999/xhtml">, it replaced the missing data with the </span><span class="No-Break"><span class="koboSpan" id="kobo.800.1" xmlns:="http://www.w3.org/1999/xhtml">learned parameters.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.801.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.802.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.803.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.804.1" xmlns:="http://www.w3.org/1999/xhtml"> return NumPy arrays by default. </span><span class="koboSpan" id="kobo.804.2" xmlns:="http://www.w3.org/1999/xhtml">We can change this behavior with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.805.1" xmlns:="http://www.w3.org/1999/xhtml">set_output()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.806.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.807.1" xmlns:="http://www.w3.org/1999/xhtml">To replace missing values with </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.809.1" xmlns:="http://www.w3.org/1999/xhtml">, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.810.1" xmlns:="http://www.w3.org/1999/xhtml">CategoricalImputer()</span></strong><span class="koboSpan" id="kobo.811.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.812.1" xmlns:="http://www.w3.org/1999/xhtml">imputation_method</span></strong><span class="koboSpan" id="kobo.813.1" xmlns:="http://www.w3.org/1999/xhtml"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.814.1" xmlns:="http://www.w3.org/1999/xhtml">frequent</span></strong><span class="koboSpan" id="kobo.815.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.815.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.817.1" xmlns:="http://www.w3.org/1999/xhtml">, the transformer learned and stored the most frequent categories in a dictionary in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.818.1" xmlns:="http://www.w3.org/1999/xhtml">imputer_dict_</span></strong><span class="koboSpan" id="kobo.819.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.819.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.820.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.821.1" xmlns:="http://www.w3.org/1999/xhtml">, it replaced the missing values with the </span><span class="No-Break"><span class="koboSpan" id="kobo.822.1" xmlns:="http://www.w3.org/1999/xhtml">learned parameters.</span></span></p>
<p><span class="koboSpan" id="kobo.823.1" xmlns:="http://www.w3.org/1999/xhtml">Unlike </span><strong class="source-inline"><span class="koboSpan" id="kobo.824.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.825.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.826.1" xmlns:="http://www.w3.org/1999/xhtml">CategoricalImputer()</span></strong><span class="koboSpan" id="kobo.827.1" xmlns:="http://www.w3.org/1999/xhtml"> will only impute categorical variables, unless specificall</span><a id="_idTextAnchor086"/><span class="koboSpan" id="kobo.828.1" xmlns:="http://www.w3.org/1999/xhtml">y told not to do so by setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1" xmlns:="http://www.w3.org/1999/xhtml">ignore_format</span></strong><span class="koboSpan" id="kobo.830.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.832.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.832.2" xmlns:="http://www.w3.org/1999/xhtml">In addition, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.833.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.834.1" xmlns:="http://www.w3.org/1999/xhtml"> transformers we can restrict the transformations to a subset of variables through the transformer itself. </span><span class="koboSpan" id="kobo.834.2" xmlns:="http://www.w3.org/1999/xhtml">For </span><strong class="source-inline"><span class="koboSpan" id="kobo.835.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.836.1" xmlns:="http://www.w3.org/1999/xhtml"> transformers, we need the additional </span><strong class="source-inline"><span class="koboSpan" id="kobo.837.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.838.1" xmlns:="http://www.w3.org/1999/xhtml"> class to apply the transformat</span><a id="_idTextAnchor087"/><a id="_idTextAnchor088"/><span class="koboSpan" id="kobo.839.1" xmlns:="http://www.w3.org/1999/xhtml">ion</span><a id="_idIndexMarker037"/><span class="koboSpan" id="kobo.840.1" xmlns:="http://www.w3.org/1999/xhtml"> to a subset of </span><span class="No-Break"><span class="koboSpan" id="kobo.841.1" xmlns:="http://www.w3.org/1999/xhtml">the variables.</span></span></p>
<h1 id="_idParaDest-34"><a id="_idTextAnchor089"/><span class="koboSpan" id="kobo.842.1" xmlns:="http://www.w3.org/1999/xhtml">Replacing missing values with an arbitrary number</span></h1>
<p><span class="koboSpan" id="kobo.843.1" xmlns:="http://www.w3.org/1999/xhtml">We can replace missing data</span><a id="_idTextAnchor090"/><a id="_idIndexMarker038"/><span class="koboSpan" id="kobo.844.1" xmlns:="http://www.w3.org/1999/xhtml"> with an arbitrary value. </span><span class="koboSpan" id="kobo.844.2" xmlns:="http://www.w3.org/1999/xhtml">Commonly</span><a id="_idIndexMarker039"/><span class="koboSpan" id="kobo.845.1" xmlns:="http://www.w3.org/1999/xhtml"> used values are </span><strong class="source-inline"><span class="koboSpan" id="kobo.846.1" xmlns:="http://www.w3.org/1999/xhtml">999</span></strong><span class="koboSpan" id="kobo.847.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.848.1" xmlns:="http://www.w3.org/1999/xhtml">9999</span></strong><span class="koboSpan" id="kobo.849.1" xmlns:="http://www.w3.org/1999/xhtml">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.850.1" xmlns:="http://www.w3.org/1999/xhtml">-1</span></strong><span class="koboSpan" id="kobo.851.1" xmlns:="http://www.w3.org/1999/xhtml"> for positive distributions. </span><span class="koboSpan" id="kobo.851.2" xmlns:="http://www.w3.org/1999/xhtml">This method is used for numerical variables. </span><span class="koboSpan" id="kobo.851.3" xmlns:="http://www.w3.org/1999/xhtml">For categorical variables, the equivalent metho</span><a id="_idTextAnchor091"/><span class="koboSpan" id="kobo.852.1" xmlns:="http://www.w3.org/1999/xhtml">d is to replace missing data with an arbitrary string, as described in the </span><em class="italic"><span class="koboSpan" id="kobo.853.1" xmlns:="http://www.w3.org/1999/xhtml">Imputing categorical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.854.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.855.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<p><span class="koboSpan" id="kobo.856.1" xmlns:="http://www.w3.org/1999/xhtml">When replacing missing values with arbitrary numbers, we need to be careful not to select a value close to the mean, the median, or any other common value of </span><span class="No-Break"><span class="koboSpan" id="kobo.857.1" xmlns:="http://www.w3.org/1999/xhtml">the distribution.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.858.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.859.1" xmlns:="http://www.w3.org/1999/xhtml">We’d use arbitrary number imputation when data is not missing at random, use non-linear models, or when the percentage of missing data is high. </span><span class="koboSpan" id="kobo.859.2" xmlns:="http://www.w3.org/1999/xhtml">This imputation technique distorts the original </span><span class="No-Break"><span class="koboSpan" id="kobo.860.1" xmlns:="http://www.w3.org/1999/xhtml">variable distribution.</span></span></p>
<p><span class="koboSpan" id="kobo.861.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will impute missing data with arbitrary numbers using </span><strong class="source-inline"><span class="koboSpan" id="kobo.862.1" xmlns:="http://www.w3.org/1999/xhtml">panda</span><a id="_idTextAnchor092"/><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.863.1" xmlns:="http://www.w3.org/1999/xhtml">s</span></strong><span class="koboSpan" id="kobo.864.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.865.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.866.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.867.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.868.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.869.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-35"><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.870.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.871.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing the necessary tools and loading </span><span class="No-Break"><span class="koboSpan" id="kobo.872.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.873.1" xmlns:="http://www.w3.org/1999/xhtml">Import </span><strong class="source-inline"><span class="koboSpan" id="kobo.874.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.875.1" xmlns:="http://www.w3.org/1999/xhtml"> and the required functions </span><span class="No-Break"><span class="koboSpan" id="kobo.876.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.877.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.impute import SimpleImputer
from feature_engine.imputation import ArbitraryNumberImputer</span></pre></li> <li><span class="koboSpan" id="kobo.878.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the dataset described in the </span><em class="italic"><span class="koboSpan" id="kobo.879.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.880.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.881.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.882.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")</span></pre></li> <li><span class="koboSpan" id="kobo.883.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s separate</span><a id="_idIndexMarker040"/><span class="koboSpan" id="kobo.884.1" xmlns:="http://www.w3.org/1999/xhtml"> the data into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.885.1" xmlns:="http://www.w3.org/1999/xhtml">test</span></span><span class="No-Break"><a id="_idIndexMarker041"/></span><span class="No-Break"><span class="koboSpan" id="kobo.886.1" xmlns:="http://www.w3.org/1999/xhtml"> sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.887.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    data.drop("target", axis=1),
    data["target"],
    test_s</span><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.888.1" xmlns:="http://www.w3.org/1999/xhtml">ize=0.3,
    random_stat</span><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.889.1" xmlns:="http://www.w3.org/1999/xhtml">e=0,
)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.890.1" xmlns:="http://www.w3.org/1999/xhtml">We will select arbitrary values greater than the maximum value of </span><span class="No-Break"><span class="koboSpan" id="kobo.891.1" xmlns:="http://www.w3.org/1999/xhtml">the distribution.</span></span></p></li> <li><span class="koboSpan" id="kobo.892.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s find the maximum value of four </span><span class="No-Break"><span class="koboSpan" id="kobo.893.1" xmlns:="http://www.w3.org/1999/xhtml">numerical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.894.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train[['A2','A3', 'A8', 'A11']].max()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.895.1" xmlns:="http://www.w3.org/1999/xhtml">The previous</span><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.896.1" xmlns:="http://www.w3.org/1999/xhtml"> command returns the </span><span class="No-Break"><span class="koboSpan" id="kobo.897.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.898.1" xmlns:="http://www.w3.org/1999/xhtml">A2     76.750</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.899.1" xmlns:="http://www.w3.org/1999/xhtml">A3     26.335</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.900.1" xmlns:="http://www.w3.org/1999/xhtml">A8     28.500</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.901.1" xmlns:="http://www.w3.org/1999/xhtml">A11    67.000</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.902.1" xmlns:="http://www.w3.org/1999/xhtml">dtype: float64</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.903.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll use </span><strong class="source-inline"><span class="koboSpan" id="kobo.904.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong><span class="koboSpan" id="kobo.905.1" xmlns:="http://www.w3.org/1999/xhtml"> for the imputation because it is bigger than the maximum values of the numerical variables in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.906.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.907.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.908.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s make a copy of the </span><span class="No-Break"><span class="koboSpan" id="kobo.909.1" xmlns:="http://www.w3.org/1999/xhtml">original DataFrames:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.910.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = X_train.copy()
X_test_t = X_test.copy()</span></pre></li> <li><span class="koboSpan" id="kobo.911.1" xmlns:="http://www.w3.org/1999/xhtml">Now, we replace the missing values </span><span class="No-Break"><span class="koboSpan" id="kobo.912.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.913.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.914.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.915.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t[["A2", "A3", "A8", "A11"]] = X_train_t[[
    "A2", "A3", "A8", "A11"]].fillna(99)
X_test_t[["A2", "A3", "A8", "A11"]] = X_test_t[[
    "A2", "A3", "A8", "A11"]].fillna(99)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.916.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.917.1" xmlns:="http://www.w3.org/1999/xhtml">To impute different variables with different values using </span><strong class="source-inline"><span class="koboSpan" id="kobo.918.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.919.1" xmlns:="http://www.w3.org/1999/xhtml">fillna()</span></strong><span class="koboSpan" id="kobo.920.1" xmlns:="http://www.w3.org/1999/xhtml">, use a dictionary like this: </span><strong class="source-inline"><span class="koboSpan" id="kobo.921.1" xmlns:="http://www.w3.org/1999/xhtml">imputation_dict = {"A2": -1, "A3": -</span><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.922.1" xmlns:="http://www.w3.org/1999/xhtml">1, "A8": 999, "</span><a id="_idTextAnchor099"/></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.923.1" xmlns:="http://www.w3.org/1999/xhtml">A11": 9999}</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.924.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.925.1" xmlns:="http://www.w3.org/1999/xhtml">Now, we’ll impute missing</span><a id="_idIndexMarker042"/><span class="koboSpan" id="kobo.926.1" xmlns:="http://www.w3.org/1999/xhtml"> values with an arbitrary number</span><a id="_idIndexMarker043"/> <span class="No-Break"><span class="koboSpan" id="kobo.927.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.928.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.929.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.930.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.931.1" xmlns:="http://www.w3.org/1999/xhtml">imputer</span></strong><span class="koboSpan" id="kobo.932.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace missing values </span><span class="No-Break"><span class="koboSpan" id="kobo.933.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.934.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.935.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.936.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = SimpleImputer(strategy='constant', fill_value=99)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.937.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.938.1" xmlns:="http://www.w3.org/1999/xhtml">If your dataset contains categorical variables, </span><strong class="source-inline"><span class="koboSpan" id="kobo.939.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.940.1" xmlns:="http://www.w3.org/1999/xhtml"> will add </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong><span class="koboSpan" id="kobo.942.1" xmlns:="http://www.w3.org/1999/xhtml"> to those variables as well if any values </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1" xmlns:="http://www.w3.org/1999/xhtml">are missing.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.944.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit </span><strong class="source-inline"><span class="koboSpan" id="kobo.945.1" xmlns:="http://www.w3.org/1999/xhtml">imputer</span></strong><span class="koboSpan" id="kobo.946.1" xmlns:="http://www.w3.org/1999/xhtml"> to a slice of the train set containing the variables </span><span class="No-Break"><span class="koboSpan" id="kobo.947.1" xmlns:="http://www.w3.org/1999/xhtml">to impute:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.948.1" xmlns:="http://www.w3.org/1999/xhtml">
vars = ["A2", "A3", "A8", "A11"]
imputer.fit(X_train[vars])</span></pre></li> <li><span class="koboSpan" id="kobo.949.1" xmlns:="http://www.w3.org/1999/xhtml">Replace the missing values with </span><strong class="source-inline"><span class="koboSpan" id="kobo.950.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong><span class="koboSpan" id="kobo.951.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.952.1" xmlns:="http://www.w3.org/1999/xhtml">desired variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.953.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t[vars] = imputer.transform(X_train[vars])
X_test_t[vars] = imputer.transform(X_test[vars])</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.954.1" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and check the lack of missing values by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.955.1" xmlns:="http://www.w3.org/1999/xhtml">X_test_t[["A2", "A3", "</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.956.1" xmlns:="http://www.w3.org/1999/xhtml">A8", "A11"]].isnull().sum()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.957.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.958.1" xmlns:="http://www.w3.org/1999/xhtml">To finish, let’s impute mis</span><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.959.1" xmlns:="http://www.w3.org/1999/xhtml">sing values </span><span class="No-Break"><span class="koboSpan" id="kobo.960.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.961.1" xmlns:="http://www.w3.org/1999/xhtml">f</span><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.962.1" xmlns:="http://www.w3.org/1999/xhtml">eature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.963.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.964.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.965.1" xmlns:="http://www.w3.org/1999/xhtml">imputer</span></strong><span class="koboSpan" id="kobo.966.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace</span><a id="_idIndexMarker044"/><span class="koboSpan" id="kobo.967.1" xmlns:="http://www.w3.org/1999/xhtml"> missing values</span><a id="_idIndexMarker045"/><span class="koboSpan" id="kobo.968.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.969.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong><span class="koboSpan" id="kobo.970.1" xmlns:="http://www.w3.org/1999/xhtml"> in 4 </span><span class="No-Break"><span class="koboSpan" id="kobo.971.1" xmlns:="http://www.w3.org/1999/xhtml">specific variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.972.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = ArbitraryNumberImputer(
    arbitrary_number=99,
    variables=["A2", "A3", "A8", "A11"],
)</span></pre></li> </ol>
<p class="callout-heading"><strong class="source-inline"><span class="koboSpan" id="kobo.973.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></strong></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.974.1" xmlns:="http://www.w3.org/1999/xhtml">ArbitraryNumberImputer()</span></strong><span class="koboSpan" id="kobo.975.1" xmlns:="http://www.w3.org/1999/xhtml"> will automatically select all numerical variables in the train set for imputation if we set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.976.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.977.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter </span><span class="No-Break"><span class="koboSpan" id="kobo.978.1" xmlns:="http://www.w3.org/1999/xhtml">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.979.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.980.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.981.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s replace the missing values </span><span class="No-Break"><span class="koboSpan" id="kobo.982.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.983.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.984.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.985.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train = imputer.fit_transform(X_train)
X_test = imputer.transform(X_test)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.986.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.987.1" xmlns:="http://www.w3.org/1999/xhtml">To impute different variables with different numbers, set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.988.1" xmlns:="http://www.w3.org/1999/xhtml">ArbitraryNumberImputer()</span></strong><span class="koboSpan" id="kobo.989.1" xmlns:="http://www.w3.org/1999/xhtml"> as follows: </span><strong class="source-inline"><span class="koboSpan" id="kobo.990.1" xmlns:="http://www.w3.org/1999/xhtml">ArbitraryNumberImputer(imputater_dict = {"A2": -1, "A3": -1, "A8": 999, "</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.991.1" xmlns:="http://www.w3.org/1999/xhtml">A11": 9999})</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.992.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.993.1" xmlns:="http://www.w3.org/1999/xhtml">We have now replaced missing data with arbitrary numbers us</span><a id="_idTextAnchor102"/><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.994.1" xmlns:="http://www.w3.org/1999/xhtml">ing three different </span><span class="No-Break"><span class="koboSpan" id="kobo.995.1" xmlns:="http://www.w3.org/1999/xhtml">open-source libraries.</span></span></p>
<h2 id="_idParaDest-36"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.996.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.997.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we replaced</span><a id="_idIndexMarker046"/><span class="koboSpan" id="kobo.998.1" xmlns:="http://www.w3.org/1999/xhtml"> missing values in numerical variables</span><a id="_idIndexMarker047"/><span class="koboSpan" id="kobo.999.1" xmlns:="http://www.w3.org/1999/xhtml"> with an arbitrary number using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1001.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1" xmlns:="http://www.w3.org/1999/xhtml">sc</span><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.1003.1" xmlns:="http://www.w3.org/1999/xhtml">ikit-learn</span></strong><span class="koboSpan" id="kobo.1004.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1006.1" xmlns:="http://www.w3.org/1999/xhtml">featur</span><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.1007.1" xmlns:="http://www.w3.org/1999/xhtml">e-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1008.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1009.1" xmlns:="http://www.w3.org/1999/xhtml">To determine which arbitrary value to use, we inspected the maximum values of four numerical variables using pandas’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1010.1" xmlns:="http://www.w3.org/1999/xhtml">max()</span></strong><span class="koboSpan" id="kobo.1011.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1011.2" xmlns:="http://www.w3.org/1999/xhtml">We chose </span><strong class="source-inline"><span class="koboSpan" id="kobo.1012.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong><span class="koboSpan" id="kobo.1013.1" xmlns:="http://www.w3.org/1999/xhtml"> because it was greater than the maximum values of the selected variables. </span><span class="koboSpan" id="kobo.1013.2" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.1014.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em><span class="koboSpan" id="kobo.1015.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1016.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1017.1" xmlns:="http://www.w3.org/1999/xhtml">fillna()</span></strong><span class="koboSpan" id="kobo.1018.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace the </span><span class="No-Break"><span class="koboSpan" id="kobo.1019.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
<p><span class="koboSpan" id="kobo.1020.1" xmlns:="http://www.w3.org/1999/xhtml">To replace missing values using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1021.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1022.1" xmlns:="http://www.w3.org/1999/xhtml">, we utilized </span><strong class="source-inline"><span class="koboSpan" id="kobo.1023.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.1024.1" xmlns:="http://www.w3.org/1999/xhtml">, with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1025.1" xmlns:="http://www.w3.org/1999/xhtml">strategy</span></strong><span class="koboSpan" id="kobo.1026.1" xmlns:="http://www.w3.org/1999/xhtml"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1027.1" xmlns:="http://www.w3.org/1999/xhtml">constant</span></strong><span class="koboSpan" id="kobo.1028.1" xmlns:="http://www.w3.org/1999/xhtml">, and specified </span><strong class="source-inline"><span class="koboSpan" id="kobo.1029.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong><span class="koboSpan" id="kobo.1030.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1" xmlns:="http://www.w3.org/1999/xhtml">fill_value</span></strong><span class="koboSpan" id="kobo.1032.1" xmlns:="http://www.w3.org/1999/xhtml"> argument. </span><span class="koboSpan" id="kobo.1032.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we fitted the imputer to a slice of the train set with the numerical variables to impute. </span><span class="koboSpan" id="kobo.1032.3" xmlns:="http://www.w3.org/1999/xhtml">Finally, we replaced missing values </span><span class="No-Break"><span class="koboSpan" id="kobo.1033.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1035.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1036.1" xmlns:="http://www.w3.org/1999/xhtml">To replace missing values with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1038.1" xmlns:="http://www.w3.org/1999/xhtml"> we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1039.1" xmlns:="http://www.w3.org/1999/xhtml">ArbitraryValueImputer()</span></strong><span class="koboSpan" id="kobo.1040.1" xmlns:="http://www.w3.org/1999/xhtml">, specifying the value </span><strong class="source-inline"><span class="koboSpan" id="kobo.1041.1" xmlns:="http://www.w3.org/1999/xhtml">99</span></strong><span class="koboSpan" id="kobo.1042.1" xmlns:="http://www.w3.org/1999/xhtml"> and the variables to impute as parameters. </span><span class="koboSpan" id="kobo.1042.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we applied the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1043.1" xmlns:="http://www.w3.org/1999/xhtml">fit_transform()</span></strong><span class="koboSpan" id="kobo.1044.1" xmlns:="http://www.w3.org/1999/xhtml"> method to replace missing data in the train set and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1046.1" xmlns:="http://www.w3.org/1999/xhtml"> met</span><a id="_idTextAnchor107"/><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.1047.1" xmlns:="http://www.w3.org/1999/xhtml">hod to replace missing data in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1048.1" xmlns:="http://www.w3.org/1999/xhtml">test set.</span></span></p>
<h1 id="_idParaDest-37"><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.1049.1" xmlns:="http://www.w3.org/1999/xhtml">Finding extreme values for imputation</span></h1>
<p><span class="koboSpan" id="kobo.1050.1" xmlns:="http://www.w3.org/1999/xhtml">Replacing missing values</span><a id="_idIndexMarker048"/><span class="koboSpan" id="kobo.1051.1" xmlns:="http://www.w3.org/1999/xhtml"> with a value at the end of the variable</span><a id="_idIndexMarker049"/><span class="koboSpan" id="kobo.1052.1" xmlns:="http://www.w3.org/1999/xhtml"> distribution (extreme values) is like replacing them with an arbitra</span><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.1053.1" xmlns:="http://www.w3.org/1999/xhtml">ry value, but instead of setting the arbitrary values manually, the values are automatically selected from the end of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1054.1" xmlns:="http://www.w3.org/1999/xhtml">variable distribution.</span></span></p>
<p><span class="koboSpan" id="kobo.1055.1" xmlns:="http://www.w3.org/1999/xhtml">We can replace missing data with a value that is greater or smaller than most values in the variable. </span><span class="koboSpan" id="kobo.1055.2" xmlns:="http://www.w3.org/1999/xhtml">To select a value that is greater, we can use the mean plus a factor of the standard deviation. </span><span class="koboSpan" id="kobo.1055.3" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, we can set it to the 75th quantile + IQR × 1.5. </span><strong class="bold"><span class="koboSpan" id="kobo.1056.1" xmlns:="http://www.w3.org/1999/xhtml">IQR</span></strong><span class="koboSpan" id="kobo.1057.1" xmlns:="http://www.w3.org/1999/xhtml"> stands for </span><strong class="bold"><span class="koboSpan" id="kobo.1058.1" xmlns:="http://www.w3.org/1999/xhtml">inter-quartile range</span></strong><span class="koboSpan" id="kobo.1059.1" xmlns:="http://www.w3.org/1999/xhtml"> and is the difference between</span><a id="_idIndexMarker050"/><span class="koboSpan" id="kobo.1060.1" xmlns:="http://www.w3.org/1999/xhtml"> the 75th and 25th quantile. </span><span class="koboSpan" id="kobo.1060.2" xmlns:="http://www.w3.org/1999/xhtml">To replace missing data with values that are smaller than the remaining values, we can use the mean minus a factor of the standard deviation, or the 25th quantile – IQR × </span><span class="No-Break"><span class="koboSpan" id="kobo.1061.1" xmlns:="http://www.w3.org/1999/xhtml">1.5.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1062.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1063.1" xmlns:="http://www.w3.org/1999/xhtml">End-of-tail imputation may distort the distribution of the original variables, so it may not be suitable for </span><span class="No-Break"><span class="koboSpan" id="kobo.1064.1" xmlns:="http://www.w3.org/1999/xhtml">linear models.</span></span></p>
<p><span class="koboSpan" id="kobo.1065.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will implement end-of-tail or extreme va</span><a id="_idTextAnchor111"/><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.1066.1" xmlns:="http://www.w3.org/1999/xhtml">lue imputation using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1067.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1068.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1069.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1070.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-38"><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.1071.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1072.1" xmlns:="http://www.w3.org/1999/xhtml">To begin this</span><a id="_idIndexMarker051"/><span class="koboSpan" id="kobo.1073.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe, let’s import the necessary tools</span><a id="_idIndexMarker052"/><span class="koboSpan" id="kobo.1074.1" xmlns:="http://www.w3.org/1999/xhtml"> and load </span><span class="No-Break"><span class="koboSpan" id="kobo.1075.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1076.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><strong class="source-inline"><span class="koboSpan" id="kobo.1077.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1078.1" xmlns:="http://www.w3.org/1999/xhtml"> and the required function </span><span class="No-Break"><span class="koboSpan" id="kobo.1079.1" xmlns:="http://www.w3.org/1999/xhtml">and class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1080.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.model_selection import train_test_split
from feature_engine.imputation import EndTailImputer</span></pre></li> <li><span class="koboSpan" id="kobo.1081.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the dataset we described in the </span><em class="italic"><span class="koboSpan" id="kobo.1082.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1083.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1084.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1085.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")</span></pre></li> <li><span class="koboSpan" id="kobo.1086.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s capture the numerical variables in a list, excluding </span><span class="No-Break"><span class="koboSpan" id="kobo.1087.1" xmlns:="http://www.w3.org/1999/xhtml">the target:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1088.1" xmlns:="http://www.w3.org/1999/xhtml">
numeric_vars = [
    var for var in data.select_dtypes(
        exclude="O").columns.to_list()
    if var !="target"
]</span></pre></li> <li><span class="koboSpan" id="kobo.1089.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s split the data into train and test sets, keeping only the </span><span class="No-Break"><span class="koboSpan" id="kobo.1090.1" xmlns:="http://www.w3.org/1999/xhtml">numerical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1091.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    data[numeric_vars],
    data["target"],
    test_si</span><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.1092.1" xmlns:="http://www.w3.org/1999/xhtml">ze=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1093.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll now determine </span><span class="No-Break"><span class="koboSpan" id="kobo.1094.1" xmlns:="http://www.w3.org/1999/xhtml">the IQR:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1095.1" xmlns:="http://www.w3.org/1999/xhtml">
IQR = X_train.quantile(0.75) - X_train.quantile(0.25)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1096.1" xmlns:="http://www.w3.org/1999/xhtml">We can visualize</span><a id="_idIndexMarker053"/><span class="koboSpan" id="kobo.1097.1" xmlns:="http://www.w3.org/1999/xhtml"> the IQR values</span><a id="_idIndexMarker054"/><span class="koboSpan" id="kobo.1098.1" xmlns:="http://www.w3.org/1999/xhtml"> by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1" xmlns:="http://www.w3.org/1999/xhtml">IQR</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1100.1" xmlns:="http://www.w3.org/1999/xhtml">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1101.1" xmlns:="http://www.w3.org/1999/xhtml">print(IQR)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1102.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1103.1" xmlns:="http://www.w3.org/1999/xhtml">A2      16.4200</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1104.1" xmlns:="http://www.w3.org/1999/xhtml">A3       </span></strong><strong class="bold"><span class="koboSpan" id="kobo.1105.1" xmlns:="http://www.w3.org/1999/xhtml">6.5825</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1106.1" xmlns:="http://www.w3.org/1999/xhtml">A8       2.8350</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1107.1" xmlns:="http://www.w3.org/1999/xhtml">A11      3.0000</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1108.1" xmlns:="http://www.w3.org/1999/xhtml">A14    212.0000</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1109.1" xmlns:="http://www.w3.org/1999/xhtml">A15    450.0000</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1110.1" xmlns:="http://www.w3.org/1999/xhtml">dtype: float64</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1111.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a dictionary with the variable names and the </span><span class="No-Break"><span class="koboSpan" id="kobo.1112.1" xmlns:="http://www.w3.org/1999/xhtml">imputation values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1113.1" xmlns:="http://www.w3.org/1999/xhtml">
imputation_dict = (
    X_train.quantile(0.75) + 1.5 * IQR).to_dict()</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1114.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1115.1" xmlns:="http://www.w3.org/1999/xhtml">If we use the inter-quartile range proximity rule, we determine the imputation values by adding 1.5 times the IQR to the 75th quantile. </span><span class="koboSpan" id="kobo.1115.2" xmlns:="http://www.w3.org/1999/xhtml">If variables are normally distributed, we can calculate the imputation values as the mean plus a factor of the standard deviation, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1116.1" xmlns:="http://www.w3.org/1999/xhtml">imputation_dict = (X_train.me</span><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.1117.1" xmlns:="http://www.w3.org/1999/xhtml">an() + 3 * </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1118.1" xmlns:="http://www.w3.org/1999/xhtml">X_train.std()).to_dict()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1119.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1120.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s replace the </span><span class="No-Break"><span class="koboSpan" id="kobo.1121.1" xmlns:="http://www.w3.org/1999/xhtml">missing data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1122.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = X_train.fillna(value=imputation_dict)
X_test_t = X_test.fillna(value=imputation_dict)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1123.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1124.1" xmlns:="http://www.w3.org/1999/xhtml">We can also replace missing data with values at the left tail of the distribution using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1" xmlns:="http://www.w3.org/1999/xhtml">value = X_train[var].quantile(0.25) - 1.5 * IQR</span></strong><span class="koboSpan" id="kobo.1126.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1127.1" xmlns:="http://www.w3.org/1999/xhtml">value = X_train[var].mean() – 3 * </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1128.1" xmlns:="http://www.w3.org/1999/xhtml">X_train[var].std()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1129.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1130.1" xmlns:="http://www.w3.org/1999/xhtml">To finish, let’s impute</span><a id="_idIndexMarker055"/><span class="koboSpan" id="kobo.1131.1" xmlns:="http://www.w3.org/1999/xhtml"> missing values</span><a id="_idIndexMarker056"/> <span class="No-Break"><span class="koboSpan" id="kobo.1132.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1133.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1134.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1135.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1136.1" xmlns:="http://www.w3.org/1999/xhtml">imputer</span></strong><span class="koboSpan" id="kobo.1137.1" xmlns:="http://www.w3.org/1999/xhtml"> to estimate a value at the right of the distribution using the IQR </span><span class="No-Break"><span class="koboSpan" id="kobo.1138.1" xmlns:="http://www.w3.org/1999/xhtml">proximity rule:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1139.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = EndTailImputer(
    imputation_method="iqr",
    tail="right",
    fold=3,
    variables=None,
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1140.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1141.1" xmlns:="http://www.w3.org/1999/xhtml">To use the mean and standard deviation to calculate the replacement values, set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1142.1" xmlns:="http://www.w3.org/1999/xhtml">imputation_method="Gaussian"</span></strong><span class="koboSpan" id="kobo.1143.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1143.2" xmlns:="http://www.w3.org/1999/xhtml">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1144.1" xmlns:="http://www.w3.org/1999/xhtml">left</span></strong><span class="koboSpan" id="kobo.1145.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1146.1" xmlns:="http://www.w3.org/1999/xhtml">right</span></strong><span class="koboSpan" id="kobo.1147.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1148.1" xmlns:="http://www.w3.org/1999/xhtml">tail</span></strong><span class="koboSpan" id="kobo.1149.1" xmlns:="http://www.w3.org/1999/xhtml"> argument to specify the side of the distribution to consider when finding values for </span><span class="No-Break"><span class="koboSpan" id="kobo.1150.1" xmlns:="http://www.w3.org/1999/xhtml">the imputation.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1151.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit </span><strong class="source-inline"><span class="koboSpan" id="kobo.1152.1" xmlns:="http://www.w3.org/1999/xhtml">EndTailImputer()</span></strong><span class="koboSpan" id="kobo.1153.1" xmlns:="http://www.w3.org/1999/xhtml"> to the train set so that it learns the </span><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.1154.1" xmlns:="http://www.w3.org/1999/xhtml">values for </span><span class="No-Break"><span class="koboSpan" id="kobo.1155.1" xmlns:="http://www.w3.org/1999/xhtml">the imputation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1156.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.1157.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the </span><span class="No-Break"><span class="koboSpan" id="kobo.1158.1" xmlns:="http://www.w3.org/1999/xhtml">learned values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1159.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.imputer_dict_</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1160.1" xmlns:="http://www.w3.org/1999/xhtml">The previous command</span><a id="_idIndexMarker057"/><span class="koboSpan" id="kobo.1161.1" xmlns:="http://www.w3.org/1999/xhtml"> returns a dictionary with the values</span><a id="_idIndexMarker058"/><span class="koboSpan" id="kobo.1162.1" xmlns:="http://www.w3.org/1999/xhtml"> to use to impute </span><span class="No-Break"><span class="koboSpan" id="kobo.1163.1" xmlns:="http://www.w3.org/1999/xhtml">each variable:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1164.1" xmlns:="http://www.w3.org/1999/xhtml">{'A2': 88.18,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1165.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A3': 27.31,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1166.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A8': 11.504999999999999,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1167.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A11': 12.0,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1168.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A14': 908.0,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1169.1" xmlns:="http://www.w3.org/1999/xhtml"> 'A15': 1800.0}</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1170.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s replace the </span><span class="No-Break"><span class="koboSpan" id="kobo.1171.1" xmlns:="http://www.w3.org/1999/xhtml">missing values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1172.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train = imputer.transform(X_train)
X_test = imputer.transform(X_test)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1173.1" xmlns:="http://www.w3.org/1999/xhtml">Remember that you can corroborate that the missing values were replaced by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1174.1" xmlns:="http://www.w3.org/1999/xhtml">X_train[[</span><a id="_idTextAnchor117"/><a id="_idTextAnchor118"/><span class="koboSpan" id="kobo.1175.1" xmlns:="http://www.w3.org/1999/xhtml">'A2','A3', 'A8', 'A11', '</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1176.1" xmlns:="http://www.w3.org/1999/xhtml">A14', 'A15']].isnull().mean()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1177.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-39"><a id="_idTextAnchor119"/><span class="koboSpan" id="kobo.1178.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1179.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we replaced missing values in numerical variables with a number at the end </span><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.1180.1" xmlns:="http://www.w3.org/1999/xhtml">of the distribution using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1181.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1182.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1183.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1184.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1185.1" xmlns:="http://www.w3.org/1999/xhtml">We determined the imputation values according to the formulas described in the introduction to this recipe. </span><span class="koboSpan" id="kobo.1185.2" xmlns:="http://www.w3.org/1999/xhtml">We used pandas </span><strong class="source-inline"><span class="koboSpan" id="kobo.1186.1" xmlns:="http://www.w3.org/1999/xhtml">quantile()</span></strong><span class="koboSpan" id="kobo.1187.1" xmlns:="http://www.w3.org/1999/xhtml"> to find specific quantile values, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1188.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1189.1" xmlns:="http://www.w3.org/1999/xhtml">mean()</span></strong><span class="koboSpan" id="kobo.1190.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1191.1" xmlns:="http://www.w3.org/1999/xhtml">std()</span></strong><span class="koboSpan" id="kobo.1192.1" xmlns:="http://www.w3.org/1999/xhtml"> for the mean and standard deviation. </span><span class="koboSpan" id="kobo.1192.2" xmlns:="http://www.w3.org/1999/xhtml">With pandas </span><strong class="source-inline"><span class="koboSpan" id="kobo.1193.1" xmlns:="http://www.w3.org/1999/xhtml">fillna()</span></strong><span class="koboSpan" id="kobo.1194.1" xmlns:="http://www.w3.org/1999/xhtml"> we replaced the </span><span class="No-Break"><span class="koboSpan" id="kobo.1195.1" xmlns:="http://www.w3.org/1999/xhtml">missing values.</span></span></p>
<p><span class="koboSpan" id="kobo.1196.1" xmlns:="http://www.w3.org/1999/xhtml">To replace missing values with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1197.1" xmlns:="http://www.w3.org/1999/xhtml">EndTailImputer()</span></strong><span class="koboSpan" id="kobo.1198.1" xmlns:="http://www.w3.org/1999/xhtml"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1199.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1200.1" xmlns:="http://www.w3.org/1999/xhtml">, we set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1201.1" xmlns:="http://www.w3.org/1999/xhtml">distribution</span></strong><span class="koboSpan" id="kobo.1202.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1203.1" xmlns:="http://www.w3.org/1999/xhtml">iqr</span></strong><span class="koboSpan" id="kobo.1204.1" xmlns:="http://www.w3.org/1999/xhtml"> to calculate the values based on the IQR proximity rule. </span><span class="koboSpan" id="kobo.1204.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1205.1" xmlns:="http://www.w3.org/1999/xhtml">tail</span></strong><span class="koboSpan" id="kobo.1206.1" xmlns:="http://www.w3.org/1999/xhtml"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1207.1" xmlns:="http://www.w3.org/1999/xhtml">right</span></strong><span class="koboSpan" id="kobo.1208.1" xmlns:="http://www.w3.org/1999/xhtml"> the transformer found the imputation values from the right of the distribution. </span><span class="koboSpan" id="kobo.1208.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1209.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1210.1" xmlns:="http://www.w3.org/1999/xhtml">, the imputer learned and stored the values for the imputation in a dictionary in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1211.1" xmlns:="http://www.w3.org/1999/xhtml">imputer_dict_</span></strong><span class="koboSpan" id="kobo.1212.1" xmlns:="http://www.w3.org/1999/xhtml"> attribute. </span><span class="koboSpan" id="kobo.1212.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><a id="_idTextAnchor121"/><strong class="source-inline"><span class="koboSpan" id="kobo.1213.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span><a id="_idTextAnchor122"/><a id="_idTextAnchor123"/></strong><span class="koboSpan" id="kobo.1214.1" xmlns:="http://www.w3.org/1999/xhtml">, we replaced</span><a id="_idIndexMarker059"/><span class="koboSpan" id="kobo.1215.1" xmlns:="http://www.w3.org/1999/xhtml"> the missing</span><a id="_idIndexMarker060"/><span class="koboSpan" id="kobo.1216.1" xmlns:="http://www.w3.org/1999/xhtml"> values, </span><span class="No-Break"><span class="koboSpan" id="kobo.1217.1" xmlns:="http://www.w3.org/1999/xhtml">returning DataFrames.</span></span></p>
<h1 id="_idParaDest-40"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.1218.1" xmlns:="http://www.w3.org/1999/xhtml">Marking imputed values</span></h1>
<p><span class="koboSpan" id="kobo.1219.1" xmlns:="http://www.w3.org/1999/xhtml">In the previous recipes, we focused </span><a id="_idIndexMarker061"/><span class="koboSpan" id="kobo.1220.1" xmlns:="http://www.w3.org/1999/xhtml">on replacing missing data with estimates of their values. </span><span class="koboSpan" id="kobo.1220.2" xmlns:="http://www.w3.org/1999/xhtml">In addition, we can add missing indicators to </span><em class="italic"><span class="koboSpan" id="kobo.1221.1" xmlns:="http://www.w3.org/1999/xhtml">mark</span></em><span class="koboSpan" id="kobo.1222.1" xmlns:="http://www.w3.org/1999/xhtml"> observations where values </span><span class="No-Break"><span class="koboSpan" id="kobo.1223.1" xmlns:="http://www.w3.org/1999/xhtml">were missing.</span></span></p>
<p><span class="koboSpan" id="kobo.1224.1" xmlns:="http://www.w3.org/1999/xhtml">A missing indicator is a binary var</span><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.1225.1" xmlns:="http://www.w3.org/1999/xhtml">iable that takes the value </span><strong class="source-inline"><span class="koboSpan" id="kobo.1226.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.1227.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1228.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.1229.1" xmlns:="http://www.w3.org/1999/xhtml"> to indicate whether a value was missing, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1230.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.1231.1" xmlns:="http://www.w3.org/1999/xhtml"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1232.1" xmlns:="http://www.w3.org/1999/xhtml">False</span></strong><span class="koboSpan" id="kobo.1233.1" xmlns:="http://www.w3.org/1999/xhtml"> otherwise. </span><span class="koboSpan" id="kobo.1233.2" xmlns:="http://www.w3.org/1999/xhtml">It is common practice to replace missing observations with the mean, median, or most frequent category while simultaneously marking those missing observations with missing indicators. </span><span class="koboSpan" id="kobo.1233.3" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will learn how to add missing </span><a id="_idTextAnchor126"/><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.1234.1" xmlns:="http://www.w3.org/1999/xhtml">indicators using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1235.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1236.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1237.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1238.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1239.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1240.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1241.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-41"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.1242.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1243.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by making some imports and loading </span><span class="No-Break"><span class="koboSpan" id="kobo.1244.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1245.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the required libraries, functions, </span><span class="No-Break"><span class="koboSpan" id="kobo.1246.1" xmlns:="http://www.w3.org/1999/xhtml">and classes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1247.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.impute import SimpleImputer
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from feature_engine.imputation import(
    AddMissingIndicator,
</span><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.1248.1" xmlns:="http://www.w3.org/1999/xhtml">    CategoricalImputer,
    MeanMedianImputer
)</span></pre></li> <li><span class="koboSpan" id="kobo.1249.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load and split the dataset</span><a id="_idIndexMarker062"/><span class="koboSpan" id="kobo.1250.1" xmlns:="http://www.w3.org/1999/xhtml"> described in the </span><em class="italic"><span class="koboSpan" id="kobo.1251.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1252.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1253.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1254.1" xmlns:="http://www.w3.org/1999/xhtml">
data = pd.read_csv("credit_approval_uci.csv")
X_train, X_test, y_train, y_test = train_test_split(
    data.drop("target", axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1255.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s capture the variable names in </span><span class="No-Break"><span class="koboSpan" id="kobo.1256.1" xmlns:="http://www.w3.org/1999/xhtml">a list:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1257.1" xmlns:="http://www.w3.org/1999/xhtml">
varnames = ["A1", "A3", "A4", "A5", "A6", "A7", "A8"]</span></pre></li> <li><span class="koboSpan" id="kobo.1258.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create names for the missing indicators and store them in </span><span class="No-Break"><span class="koboSpan" id="kobo.1259.1" xmlns:="http://www.w3.org/1999/xhtml">a list:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1260.1" xmlns:="http://www.w3.org/1999/xhtml">
indicators = [f"{var}_na" for var in varnames]</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1261.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1262.1" xmlns:="http://www.w3.org/1999/xhtml">indicators</span></strong><span class="koboSpan" id="kobo.1263.1" xmlns:="http://www.w3.org/1999/xhtml">, we will see the names we will use for the new variables: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1264.1" xmlns:="http://www.w3.org/1999/xhtml">['A1_na', 'A3_na', 'A4_na', 'A5_na', 'A6_na', '</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1265.1" xmlns:="http://www.w3.org/1999/xhtml">A7_na', 'A8_na']</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1266.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.1267.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s make a copy of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1268.1" xmlns:="http://www.w3.org/1999/xhtml">original DataFrames:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1269.1" xmlns:="http://www.w3.org/1999/xhtml">
X_trai</span><a id="_idTextAnchor130"/><span class="koboSpan" id="kobo.1270.1" xmlns:="http://www.w3.org/1999/xhtml">n_t = X_train.copy()
X_test_t = X_test.copy()</span></pre></li> <li><span class="koboSpan" id="kobo.1271.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s add the </span><span class="No-Break"><span class="koboSpan" id="kobo.1272.1" xmlns:="http://www.w3.org/1999/xhtml">missing indicators:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1273.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t[indicators] =X_train[
    varnames].isna().astype(int)
X_test_t[indicators] = X_test[
    varnames].isna().astype(int)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1274.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1275.1" xmlns:="http://www.w3.org/1999/xhtml">If you want the indicators to have </span><strong class="source-inline"><span class="koboSpan" id="kobo.1276.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.1277.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1278.1" xmlns:="http://www.w3.org/1999/xhtml">False</span></strong><span class="koboSpan" id="kobo.1279.1" xmlns:="http://www.w3.org/1999/xhtml"> as values instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1280.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.1281.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1282.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.1283.1" xmlns:="http://www.w3.org/1999/xhtml">, remove </span><strong class="source-inline"><span class="koboSpan" id="kobo.1284.1" xmlns:="http://www.w3.org/1999/xhtml">astype(int)</span></strong><span class="koboSpan" id="kobo.1285.1" xmlns:="http://www.w3.org/1999/xhtml"> in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1286.1" xmlns:="http://www.w3.org/1999/xhtml">step 6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1287.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1288.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s inspect the </span><span class="No-Break"><span class="koboSpan" id="kobo.1289.1" xmlns:="http://www.w3.org/1999/xhtml">resulting</span></span><span class="No-Break"><a id="_idIndexMarker063"/></span><span class="No-Break"><span class="koboSpan" id="kobo.1290.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1291.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1292.1" xmlns:="http://www.w3.org/1999/xhtml">We can see the newly added vari</span><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.1293.1" xmlns:="http://www.w3.org/1999/xhtml">ables at the right of the DataFrame in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1294.1" xmlns:="http://www.w3.org/1999/xhtml">following image:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer008">
<span class="koboSpan" id="kobo.1295.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.4 – DataFrame with the missing indicators" src="image/B22396_01_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1296.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.4 – DataFrame with the missing indicators</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1297.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s add missing indicators using </span><span class="No-Break"><span class="koboSpan" id="kobo.1298.1" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine instead.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.1299.1" xmlns:="http://www.w3.org/1999/xhtml">Set up the imputer to add binary indicators to every variable with </span><span class="No-Break"><span class="koboSpan" id="kobo.1300.1" xmlns:="http://www.w3.org/1999/xhtml">missing data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1301.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = AddMissingInd</span><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.1302.1" xmlns:="http://www.w3.org/1999/xhtml">icator(
    variables=None, missing_only=True
    )</span></pre></li> <li><span class="koboSpan" id="kobo.1303.1" xmlns:="http://www.w3.org/1999/xhtml">Fit the imputer to the train set so that it finds the variables with </span><span class="No-Break"><span class="koboSpan" id="kobo.1304.1" xmlns:="http://www.w3.org/1999/xhtml">missing data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1305.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.fit(X_train)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1306.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1307.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1308.1" xmlns:="http://www.w3.org/1999/xhtml">imputer.variables_</span></strong><span class="koboSpan" id="kobo.1309.1" xmlns:="http://www.w3.org/1999/xhtml">, we will find the variables for which missing indicators will </span><span class="No-Break"><span class="koboSpan" id="kobo.1310.1" xmlns:="http://www.w3.org/1999/xhtml">be added.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.1311.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s add the </span><span class="No-Break"><span class="koboSpan" id="kobo.1312.1" xmlns:="http://www.w3.org/1999/xhtml">missing indicators:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1313.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = imputer.transform(X_train)
X_test_t = imputer.transform(X_test)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1314.1" xmlns:="http://www.w3.org/1999/xhtml">So far, we just added missing indicators. </span><span class="koboSpan" id="kobo.1314.2" xmlns:="http://www.w3.org/1999/xhtml">But we still have the missing data in our variables. </span><span class="koboSpan" id="kobo.1314.3" xmlns:="http://www.w3.org/1999/xhtml">We need to replace them with numbers. </span><span class="koboSpan" id="kobo.1314.4" xmlns:="http://www.w3.org/1999/xhtml">In the rest of this recipe, we will combine the use of missing indicators with mean and </span><span class="No-Break"><span class="koboSpan" id="kobo.1315.1" xmlns:="http://www.w3.org/1999/xhtml">mode imputation.</span></span></p></li> <li><span class="koboSpan" id="kobo.1316.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a pipeline</span><a id="_idIndexMarker064"/><span class="koboSpan" id="kobo.1317.1" xmlns:="http://www.w3.org/1999/xhtml"> to add missing indicators to categorical and numerical variables, then impute categorical variables with the most frequent category, and numerical variables with </span><span class="No-Break"><span class="koboSpan" id="kobo.1318.1" xmlns:="http://www.w3.org/1999/xhtml">the mean:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1319.1" xmlns:="http://www.w3.org/1999/xhtml">
pipe = Pipeline([
    ("indicators",
        AddMissingIndicator(missing_only=True)),
    ("categorical", CategoricalImputer(
        imputation_method="frequent")),
    ("numerical", MeanMedianImputer()),
])</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1320.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1321.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1322.1" xmlns:="http://www.w3.org/1999/xhtml"> imputers automatically identify numerical or categorical variables. </span><span class="koboSpan" id="kobo.1322.2" xmlns:="http://www.w3.org/1999/xhtml">So there is no need to slice the data or pass the variabl</span><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.1323.1" xmlns:="http://www.w3.org/1999/xhtml">e names as arguments to the transformers in </span><span class="No-Break"><span class="koboSpan" id="kobo.1324.1" xmlns:="http://www.w3.org/1999/xhtml">this case.</span></span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.1325.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s add the indicators and impute </span><span class="No-Break"><span class="koboSpan" id="kobo.1326.1" xmlns:="http://www.w3.org/1999/xhtml">missing values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1327.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = pipe.fit_transform(X_train)
X_test_t = pipe.transform(X_test)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1328.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1329.1" xmlns:="http://www.w3.org/1999/xhtml">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1330.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_t.isnull().sum()</span></strong><span class="koboSpan" id="kobo.1331.1" xmlns:="http://www.w3.org/1999/xhtml"> to corroborate that there is no data missing. </span><span class="koboSpan" id="kobo.1331.2" xmlns:="http://www.w3.org/1999/xhtml">Execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1332.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_t.head()</span></strong><span class="koboSpan" id="kobo.1333.1" xmlns:="http://www.w3.org/1999/xhtml"> to get a view of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1334.1" xmlns:="http://www.w3.org/1999/xhtml">resulting datafame.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1335.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s add missing indicators and simultaneously impute numerical and categorical variables with the mean and most frequent categories respectively, </span><span class="No-Break"><span class="koboSpan" id="kobo.1336.1" xmlns:="http://www.w3.org/1999/xhtml">utilizing scikit-learn.</span></span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.1337.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s make a list with the names</span><a id="_idIndexMarker065"/><span class="koboSpan" id="kobo.1338.1" xmlns:="http://www.w3.org/1999/xhtml"> of the numerical and </span><span class="No-Break"><span class="koboSpan" id="kobo.1339.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1340.1" xmlns:="http://www.w3.org/1999/xhtml">
numvars = X_train.select_dtypes(
    exclude="O").columns.to_list()
catvars = X_train.select_dtypes(
    include="O").columns.to_list()</span></pre></li> <li><span class="koboSpan" id="kobo.1341.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up a pipeline to perform mean and frequent category imputation while marking the </span><span class="No-Break"><span class="koboSpan" id="kobo.1342.1" xmlns:="http://www.w3.org/1999/xhtml">missing data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1343.1" xmlns:="http://www.w3.org/1999/xhtml">
pipe = ColumnTransformer([
    ("num_imputer", SimpleImputer(
        strategy="mean",
        add_indicator=True),
    numvars),
    ("cat_imputer", SimpleImputer(
        strategy="most_frequent",
        add_indicator=True),
    catvars),
]).set_output(transform="pandas")</span></pre></li> <li><span class="koboSpan" id="kobo.1344.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s carry out </span><span class="No-Break"><span class="koboSpan" id="kobo.1345.1" xmlns:="http://www.w3.org/1999/xhtml">the imputation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1346.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = pipe.fit_transform(X_train)
X_test_t = pipe.transform(X_test)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1347.1" xmlns:="http://www.w3.org/1999/xhtml">Make sure to explore</span><a id="_idTextAnchor134"/><a id="_idTextAnchor135"/> <strong class="source-inline"><span class="koboSpan" id="kobo.1348.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_t.head()</span></strong><span class="koboSpan" id="kobo.1349.1" xmlns:="http://www.w3.org/1999/xhtml"> to get familiar with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1350.1" xmlns:="http://www.w3.org/1999/xhtml">pipeline’s output.</span></span></p>
<h2 id="_idParaDest-42"><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.1351.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1352.1" xmlns:="http://www.w3.org/1999/xhtml">To add missing</span><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.1353.1" xmlns:="http://www.w3.org/1999/xhtml"> indicators</span><a id="_idIndexMarker066"/><span class="koboSpan" id="kobo.1354.1" xmlns:="http://www.w3.org/1999/xhtml"> using pandas, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1355.1" xmlns:="http://www.w3.org/1999/xhtml">isna()</span></strong><span class="koboSpan" id="kobo.1356.1" xmlns:="http://www.w3.org/1999/xhtml">, which created a new vector assigning the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1357.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.1358.1" xmlns:="http://www.w3.org/1999/xhtml"> if there was a missing value or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1359.1" xmlns:="http://www.w3.org/1999/xhtml">False</span></strong><span class="koboSpan" id="kobo.1360.1" xmlns:="http://www.w3.org/1999/xhtml"> otherwise. </span><span class="koboSpan" id="kobo.1360.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1361.1" xmlns:="http://www.w3.org/1999/xhtml">astype(int)</span></strong><span class="koboSpan" id="kobo.1362.1" xmlns:="http://www.w3.org/1999/xhtml"> to convert the Boolean vectors into binary vectors with values </span><strong class="source-inline"><span class="koboSpan" id="kobo.1363.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1364.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1365.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1366.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1367.1" xmlns:="http://www.w3.org/1999/xhtml">To add a missing indicator with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1368.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1369.1" xmlns:="http://www.w3.org/1999/xhtml">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1370.1" xmlns:="http://www.w3.org/1999/xhtml">AddMissingIndicator()</span></strong><span class="koboSpan" id="kobo.1371.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1371.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1372.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1373.1" xmlns:="http://www.w3.org/1999/xhtml"> the transformer found the variables with missing data. </span><span class="koboSpan" id="kobo.1373.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1374.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1375.1" xmlns:="http://www.w3.org/1999/xhtml"> it appended the missing indicators to the right of the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1376.1" xmlns:="http://www.w3.org/1999/xhtml">test sets.</span></span></p>
<p><span class="koboSpan" id="kobo.1377.1" xmlns:="http://www.w3.org/1999/xhtml">To sequentially add missing indicators and then replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1378.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.1379.1" xmlns:="http://www.w3.org/1999/xhtml"> values with the most frequent category or the mean, we lined up Feature-engine’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1380.1" xmlns:="http://www.w3.org/1999/xhtml">AddMissingIndicator()</span></strong><span class="koboSpan" id="kobo.1381.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1382.1" xmlns:="http://www.w3.org/1999/xhtml">CategoricalImputer()</span></strong><span class="koboSpan" id="kobo.1383.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1384.1" xmlns:="http://www.w3.org/1999/xhtml">MeanMedianImputer()</span></strong><span class="koboSpan" id="kobo.1385.1" xmlns:="http://www.w3.org/1999/xhtml"> within a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1386.1" xmlns:="http://www.w3.org/1999/xhtml">pipeline</span></strong><span class="koboSpan" id="kobo.1387.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1387.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1388.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1389.1" xmlns:="http://www.w3.org/1999/xhtml"> method from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1390.1" xmlns:="http://www.w3.org/1999/xhtml">pipeline</span></strong><span class="koboSpan" id="kobo.1391.1" xmlns:="http://www.w3.org/1999/xhtml"> made the transformers find the variables with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1392.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.1393.1" xmlns:="http://www.w3.org/1999/xhtml"> and calculate the mean of the numerical variables and the mode of the categorical variables. </span><span class="koboSpan" id="kobo.1393.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1394.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1395.1" xmlns:="http://www.w3.org/1999/xhtml"> method from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1396.1" xmlns:="http://www.w3.org/1999/xhtml">pipeline</span></strong><span class="koboSpan" id="kobo.1397.1" xmlns:="http://www.w3.org/1999/xhtml"> made the transformers add the missing indicators and then replace the missing values with </span><span class="No-Break"><span class="koboSpan" id="kobo.1398.1" xmlns:="http://www.w3.org/1999/xhtml">their estimates.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1399.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1400.1" xmlns:="http://www.w3.org/1999/xhtml">Feature-engine transformations return DataFrames respecting the original names and order of the variables. </span><span class="koboSpan" id="kobo.1400.2" xmlns:="http://www.w3.org/1999/xhtml">Scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1401.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.1402.1" xmlns:="http://www.w3.org/1999/xhtml">, on the other hand, changes the variable’s names and order in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1403.1" xmlns:="http://www.w3.org/1999/xhtml">resulting data.</span></span></p>
<p><span class="koboSpan" id="kobo.1404.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, we added missing indicators and replaced missing data with the mean and most frequent category using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1405.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1406.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1406.2" xmlns:="http://www.w3.org/1999/xhtml">We lined up two instances of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1407.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.1408.1" xmlns:="http://www.w3.org/1999/xhtml">, the first to impute data with the mean and the second to impute data with the most frequent category. </span><span class="koboSpan" id="kobo.1408.2" xmlns:="http://www.w3.org/1999/xhtml">In both cases, we set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1409.1" xmlns:="http://www.w3.org/1999/xhtml">add_indicator</span></strong><span class="koboSpan" id="kobo.1410.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1411.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.1412.1" xmlns:="http://www.w3.org/1999/xhtml"> to add the missing indicators. </span><span class="koboSpan" id="kobo.1412.2" xmlns:="http://www.w3.org/1999/xhtml">We wrapped </span><strong class="source-inline"><span class="koboSpan" id="kobo.1413.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.1414.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1415.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.1416.1" xmlns:="http://www.w3.org/1999/xhtml"> to specifically modify numerical or categorical variables. </span><span class="koboSpan" id="kobo.1416.2" xmlns:="http://www.w3.org/1999/xhtml">Then we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1417.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1418.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1419.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1420.1" xmlns:="http://www.w3.org/1999/xhtml"> methods from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1421.1" xmlns:="http://www.w3.org/1999/xhtml">pipeline</span></strong><span class="koboSpan" id="kobo.1422.1" xmlns:="http://www.w3.org/1999/xhtml"> to train the transformers and then add the indicators and replace the </span><span class="No-Break"><span class="koboSpan" id="kobo.1423.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
<p><span class="koboSpan" id="kobo.1424.1" xmlns:="http://www.w3.org/1999/xhtml">When returning DataFrames, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1425.1" xmlns:="http://www.w3.org/1999/xhtml">ColumnTransformer()</span></strong><span class="koboSpan" id="kobo.1426.1" xmlns:="http://www.w3.org/1999/xhtml"> changes the names of the variables and their order. </span><span class="koboSpan" id="kobo.1426.2" xmlns:="http://www.w3.org/1999/xhtml">Take a look at the result from </span><em class="italic"><span class="koboSpan" id="kobo.1427.1" xmlns:="http://www.w3.org/1999/xhtml">step 15</span></em><span class="koboSpan" id="kobo.1428.1" xmlns:="http://www.w3.org/1999/xhtml"> by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1429.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_t.head()</span></strong><span class="koboSpan" id="kobo.1430.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1430.2" xmlns:="http://www.w3.org/1999/xhtml">You’ll see that the name given to each step of the pipeline is added as a prefix to the variables to flag which variable was modified with each transformer. </span><span class="koboSpan" id="kobo.1430.3" xmlns:="http://www.w3.org/1999/xhtml">Then, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1431.1" xmlns:="http://www.w3.org/1999/xhtml">num_imputer__A2</span></strong><span class="koboSpan" id="kobo.1432.1" xmlns:="http://www.w3.org/1999/xhtml"> was returned by the first step of the pipeline, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.1433.1" xmlns:="http://www.w3.org/1999/xhtml">cat_imputer__A12</span></strong><span class="koboSpan" id="kobo.1434.1" xmlns:="http://www.w3.org/1999/xhtml"> was returned</span><a id="_idIndexMarker067"/><span class="koboSpan" id="kobo.1435.1" xmlns:="http://www.w3.org/1999/xhtml"> by the second step of </span><span class="No-Break"><span class="koboSpan" id="kobo.1436.1" xmlns:="http://www.w3.org/1999/xhtml">the pipeline.</span></span></p>
<h2 id="_idParaDest-43"><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.1437.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.1438.1" xmlns:="http://www.w3.org/1999/xhtml">Scikit-learn has</span><a id="_idIndexMarker068"/><span class="koboSpan" id="kobo.1439.1" xmlns:="http://www.w3.org/1999/xhtml"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1440.1" xmlns:="http://www.w3.org/1999/xhtml">MissingIndicator()</span></strong><span class="koboSpan" id="kobo.1441.1" xmlns:="http://www.w3.org/1999/xhtml"> transformer that just adds missing indicators. </span><span class="koboSpan" id="kobo.1441.2" xmlns:="http://www.w3.org/1999/xhtml">Check it out in the documentation: </span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.MissingIndicator.html"><span class="koboSpan" id="kobo.1442.1" xmlns:="http://www.w3.org/1999/xhtml">https://scikit-learn.org/stable/modules/generated/sklearn.impute.MissingIndicator.html</span></a><span class="koboSpan" id="kobo.1443.1" xmlns:="http://www.w3.org/1999/xhtml"> and find an example in the accompanying GitHub repository </span><span class="No-Break"><span class="koboSpan" id="kobo.1444.1" xmlns:="http://www.w3.org/1999/xhtml">at </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch01-missing-data-imputation/Recipe-06-Marking-imputed-values.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.1445.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch01</span><span id="_idTextAnchor139"/><span id="_idTextAnchor140"/><span class="koboSpan" id="kobo.1446.1" xmlns:="http://www.w3.org/1999/xhtml">-missing-data-imputation/Recipe-06-Marking-imputed-values.ipynb</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1447.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-44"><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.1448.1" xmlns:="http://www.w3.org/1999/xhtml">Implementing forward and backward fill</span></h1>
<p><span class="koboSpan" id="kobo.1449.1" xmlns:="http://www.w3.org/1999/xhtml">Time series data also show missing values. </span><span class="koboSpan" id="kobo.1449.2" xmlns:="http://www.w3.org/1999/xhtml">To impute</span><a id="_idIndexMarker069"/><span class="koboSpan" id="kobo.1450.1" xmlns:="http://www.w3.org/1999/xhtml"> missing data in time series, we use specific methods. </span><span class="koboSpan" id="kobo.1450.2" xmlns:="http://www.w3.org/1999/xhtml">Forward fill imputation involves filling missing values in a dataset with the most recent non-missing value that precedes it in the data sequence. </span><span class="koboSpan" id="kobo.1450.3" xmlns:="http://www.w3.org/1999/xhtml">In other words, we carry forward the last seen value to the next valid value. </span><span class="koboSpan" id="kobo.1450.4" xmlns:="http://www.w3.org/1999/xhtml">Backward fill imputation involves filling missing values with the next non-missing value that follows it in the data sequence. </span><span class="koboSpan" id="kobo.1450.5" xmlns:="http://www.w3.org/1999/xhtml">In other words, we carry the last valid value backward to its preceding </span><span class="No-Break"><span class="koboSpan" id="kobo.1451.1" xmlns:="http://www.w3.org/1999/xhtml">valid value.</span></span></p>
<p><span class="koboSpan" id="kobo.1452.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will replace missing data in a time series with forward and </span><span class="No-Break"><span class="koboSpan" id="kobo.1453.1" xmlns:="http://www.w3.org/1999/xhtml">backward fills.</span></span></p>
<h2 id="_idParaDest-45"><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.1454.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1455.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing the required</span><a id="_idIndexMarker070"/><span class="koboSpan" id="kobo.1456.1" xmlns:="http://www.w3.org/1999/xhtml"> libraries and time </span><span class="No-Break"><span class="koboSpan" id="kobo.1457.1" xmlns:="http://www.w3.org/1999/xhtml">series dataset:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1458.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><strong class="source-inline"><span class="koboSpan" id="kobo.1459.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1460.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1461.1" xmlns:="http://www.w3.org/1999/xhtml">matplotlib</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1462.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1463.1" xmlns:="http://www.w3.org/1999/xhtml">
import matplotlib.pyplot as plt
import pandas as pd</span></pre></li> <li><span class="koboSpan" id="kobo.1464.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the air passengers dataset that we described in the </span><em class="italic"><span class="koboSpan" id="kobo.1465.1" xmlns:="http://www.w3.org/1999/xhtml">Technical requirements</span></em><span class="koboSpan" id="kobo.1466.1" xmlns:="http://www.w3.org/1999/xhtml"> section and display the first five rows of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1467.1" xmlns:="http://www.w3.org/1999/xhtml">time series:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1468.1" xmlns:="http://www.w3.org/1999/xhtml">
df = pd.read_csv(
    "air_passengers.csv",
    parse_dates=["ds"],
    index_col=["ds"],
)
print(df.head())</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1469.1" xmlns:="http://www.w3.org/1999/xhtml">We see the time series in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1470.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1471.1" xmlns:="http://www.w3.org/1999/xhtml">                y</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1472.1" xmlns:="http://www.w3.org/1999/xhtml">ds</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1473.1" xmlns:="http://www.w3.org/1999/xhtml">1949-01-01  112.0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1474.1" xmlns:="http://www.w3.org/1999/xhtml">1949-02-01  118.0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1475.1" xmlns:="http://www.w3.org/1999/xhtml">1949-03-01</span></strong><strong class="bold"><span class="koboSpan" id="kobo.1476.1" xmlns:="http://www.w3.org/1999/xhtml">  132.0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1477.1" xmlns:="http://www.w3.org/1999/xhtml">1949-04-01  129.0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1478.1" xmlns:="http://www.w3.org/1999/xhtml">1949-05-01  121.0</span></strong></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1479.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1480.1" xmlns:="http://www.w3.org/1999/xhtml">You can determine the percentage of missing data by </span><span class="No-Break"><span class="koboSpan" id="kobo.1481.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1482.1" xmlns:="http://www.w3.org/1999/xhtml">df.isnull().mean()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1483.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1484.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s plot the time series to spot any obvious </span><span class="No-Break"><span class="koboSpan" id="kobo.1485.1" xmlns:="http://www.w3.org/1999/xhtml">data gaps:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1486.1" xmlns:="http://www.w3.org/1999/xhtml">
ax = df.plot(marker=".", figsize=[10, 5], legend=None)
ax.set_title("Air passengers")
ax.set_ylabel("Number of passengers")
ax.set_xlabel("Time")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1487.1" xmlns:="http://www.w3.org/1999/xhtml">The previous code returns</span><a id="_idIndexMarker071"/><span class="koboSpan" id="kobo.1488.1" xmlns:="http://www.w3.org/1999/xhtml"> the following plot, where we see intervals of time where data </span><span class="No-Break"><span class="koboSpan" id="kobo.1489.1" xmlns:="http://www.w3.org/1999/xhtml">is missing:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer009">
<span class="koboSpan" id="kobo.1490.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.5 – Time series data showing missing values" src="image/B22396_01_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1491.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.5 – Time series data showing missing values</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1492.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s impute missing data by carrying the last observed value in any interval to the next </span><span class="No-Break"><span class="koboSpan" id="kobo.1493.1" xmlns:="http://www.w3.org/1999/xhtml">valid value:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1494.1" xmlns:="http://www.w3.org/1999/xhtml">
df_imputed = df.ffill()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1495.1" xmlns:="http://www.w3.org/1999/xhtml">You can verify the absence of missing data by </span><span class="No-Break"><span class="koboSpan" id="kobo.1496.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1497.1" xmlns:="http://www.w3.org/1999/xhtml">df_imputed.isnull().sum()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1498.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p></li> <li><span class="koboSpan" id="kobo.1499.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s now plot the complete dataset and overlay as a dotted line the values used for </span><span class="No-Break"><span class="koboSpan" id="kobo.1500.1" xmlns:="http://www.w3.org/1999/xhtml">the imputation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1501.1" xmlns:="http://www.w3.org/1999/xhtml">
ax = df_imputed.plot(
    linestyle="-", marker=".", figsize=[10, 5])
df_imputed[df.isnull()].plot(
    ax=ax, legend=None, marker=".", color="r")
ax.set_title("Air passengers")
ax.set_ylabel("Number of passengers")
ax.set_xlabel("Time")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1502.1" xmlns:="http://www.w3.org/1999/xhtml">The previous code returns the following plot, where we see the values used to replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.1503.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.1504.1" xmlns:="http://www.w3.org/1999/xhtml"> as dotted lines</span><a id="_idIndexMarker072"/><span class="koboSpan" id="kobo.1505.1" xmlns:="http://www.w3.org/1999/xhtml"> overlaid in between the continuous time </span><span class="No-Break"><span class="koboSpan" id="kobo.1506.1" xmlns:="http://www.w3.org/1999/xhtml">series lines:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer010">
<span class="koboSpan" id="kobo.1507.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.6 – Time series data where missing values were replaced by the last seen observations (dotted line)" src="image/B22396_01_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1508.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.6 – Time series data where missing values were replaced by the last seen observations (dotted line)</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1509.1" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, we can impute missing data using </span><span class="No-Break"><span class="koboSpan" id="kobo.1510.1" xmlns:="http://www.w3.org/1999/xhtml">backward fill:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1511.1" xmlns:="http://www.w3.org/1999/xhtml">
df_imputed = df.bfill()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1512.1" xmlns:="http://www.w3.org/1999/xhtml">If we plot the imputed dataset and overlay the imputation values as we did in </span><em class="italic"><span class="koboSpan" id="kobo.1513.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em><span class="koboSpan" id="kobo.1514.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the </span><span class="No-Break"><span class="koboSpan" id="kobo.1515.1" xmlns:="http://www.w3.org/1999/xhtml">following plot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer011">
<span class="koboSpan" id="kobo.1516.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.7 – Time series data where missing values were replaced by backward fill (dotted line)" src="image/B22396_01_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1517.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.7 – Time series data where missing values were replaced by backward fill (dotted line)</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1518.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1519.1" xmlns:="http://www.w3.org/1999/xhtml">The heights of the values used in the imputation are different in </span><em class="italic"><span class="koboSpan" id="kobo.1520.1" xmlns:="http://www.w3.org/1999/xhtml">Figures 1.6 and 1.7</span></em><span class="koboSpan" id="kobo.1521.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1521.2" xmlns:="http://www.w3.org/1999/xhtml">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1522.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.1523.1" xmlns:="http://www.w3.org/1999/xhtml">.6</span></em><span class="koboSpan" id="kobo.1524.1" xmlns:="http://www.w3.org/1999/xhtml">, we carry the last value forward, hence the height is lower. </span><span class="koboSpan" id="kobo.1524.2" xmlns:="http://www.w3.org/1999/xhtml">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1525.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.1526.1" xmlns:="http://www.w3.org/1999/xhtml">.7</span></em><span class="koboSpan" id="kobo.1527.1" xmlns:="http://www.w3.org/1999/xhtml">, we carry the next value backward, hence the height </span><span class="No-Break"><span class="koboSpan" id="kobo.1528.1" xmlns:="http://www.w3.org/1999/xhtml">is higher.</span></span></p>
<p><span class="koboSpan" id="kobo.1529.1" xmlns:="http://www.w3.org/1999/xhtml">We’ve now obtained complete</span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.1530.1" xmlns:="http://www.w3.org/1999/xhtml"> datasets that we can use for time series analysis </span><span class="No-Break"><span class="koboSpan" id="kobo.1531.1" xmlns:="http://www.w3.org/1999/xhtml">and modeling.</span></span></p>
<h2 id="_idParaDest-46"><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.1532.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1533.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1534.1" xmlns:="http://www.w3.org/1999/xhtml">ffill()</span></strong><span class="koboSpan" id="kobo.1535.1" xmlns:="http://www.w3.org/1999/xhtml"> takes the last seen value in any temporal gap in a time series and propagates it forward to the next observed value. </span><span class="koboSpan" id="kobo.1535.2" xmlns:="http://www.w3.org/1999/xhtml">Hence, in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1536.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.1537.1" xmlns:="http://www.w3.org/1999/xhtml">.6</span></em><span class="koboSpan" id="kobo.1538.1" xmlns:="http://www.w3.org/1999/xhtml"> we see the dotted overlay corresponding to the imputation values at the height of the last </span><span class="No-Break"><span class="koboSpan" id="kobo.1539.1" xmlns:="http://www.w3.org/1999/xhtml">seen observation.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1540.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1541.1" xmlns:="http://www.w3.org/1999/xhtml">bfill()</span></strong><span class="koboSpan" id="kobo.1542.1" xmlns:="http://www.w3.org/1999/xhtml"> takes the next valid value in any temporal gap in a time series and propagates it backward to the previously observed value. </span><span class="koboSpan" id="kobo.1542.2" xmlns:="http://www.w3.org/1999/xhtml">Hence, in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1543.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.1544.1" xmlns:="http://www.w3.org/1999/xhtml">.7</span></em><span class="koboSpan" id="kobo.1545.1" xmlns:="http://www.w3.org/1999/xhtml"> we see the dotted overlay corresponding to the imputation values at the height of the next observation in </span><span class="No-Break"><span class="koboSpan" id="kobo.1546.1" xmlns:="http://www.w3.org/1999/xhtml">the gap.</span></span></p>
<p><span class="koboSpan" id="kobo.1547.1" xmlns:="http://www.w3.org/1999/xhtml">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1548.1" xmlns:="http://www.w3.org/1999/xhtml">ffill()</span></strong><span class="koboSpan" id="kobo.1549.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1550.1" xmlns:="http://www.w3.org/1999/xhtml">bfill()</span></strong><span class="koboSpan" id="kobo.1551.1" xmlns:="http://www.w3.org/1999/xhtml"> will impute all values between valid observations. </span><span class="koboSpan" id="kobo.1551.2" xmlns:="http://www.w3.org/1999/xhtml">We can restrict the imputation to a maximum number of data points in any interval by setting a limit, using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1552.1" xmlns:="http://www.w3.org/1999/xhtml">limit</span></strong><span class="koboSpan" id="kobo.1553.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter in both methods. </span><span class="koboSpan" id="kobo.1553.2" xmlns:="http://www.w3.org/1999/xhtml">For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1554.1" xmlns:="http://www.w3.org/1999/xhtml">ffill(limit=10)</span></strong><span class="koboSpan" id="kobo.1555.1" xmlns:="http://www.w3.org/1999/xhtml"> will only replace</span><a id="_idIndexMarker074"/><span class="koboSpan" id="kobo.1556.1" xmlns:="http://www.w3.org/1999/xhtml"> the first 10 data points in </span><span class="No-Break"><span class="koboSpan" id="kobo.1557.1" xmlns:="http://www.w3.org/1999/xhtml">any gap.</span></span></p>
<h1 id="_idParaDest-47"><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.1558.1" xmlns:="http://www.w3.org/1999/xhtml">Carrying out interpolation</span></h1>
<p><span class="koboSpan" id="kobo.1559.1" xmlns:="http://www.w3.org/1999/xhtml">We can impute missing</span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.1560.1" xmlns:="http://www.w3.org/1999/xhtml"> data in time series by using interpolation between two non-missing data points. </span><span class="koboSpan" id="kobo.1560.2" xmlns:="http://www.w3.org/1999/xhtml">Interpolation is the estimation of one or more values in a range by means of a function. </span><span class="koboSpan" id="kobo.1560.3" xmlns:="http://www.w3.org/1999/xhtml">In linear interpolation, we fit a linear function between the last observed value and the next valid point. </span><span class="koboSpan" id="kobo.1560.4" xmlns:="http://www.w3.org/1999/xhtml">In spline interpolation, we fit a low-degree polynomial between the last and next observed values. </span><span class="koboSpan" id="kobo.1560.5" xmlns:="http://www.w3.org/1999/xhtml">The idea of using interpolation is to obtain better estimates of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1561.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
<p><span class="koboSpan" id="kobo.1562.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we’ll carry out linear and spline interpolation in a </span><span class="No-Break"><span class="koboSpan" id="kobo.1563.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.1564.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1565.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing the required libraries and time </span><span class="No-Break"><span class="koboSpan" id="kobo.1566.1" xmlns:="http://www.w3.org/1999/xhtml">series dataset.</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1567.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><strong class="source-inline"><span class="koboSpan" id="kobo.1568.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1569.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1570.1" xmlns:="http://www.w3.org/1999/xhtml">matplotlib</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1571.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1572.1" xmlns:="http://www.w3.org/1999/xhtml">
import matplotlib.pyplot as plt
import pandas as pd</span></pre></li> <li><span class="koboSpan" id="kobo.1573.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the time series data described in the </span><em class="italic"><span class="koboSpan" id="kobo.1574.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1575.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1576.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1577.1" xmlns:="http://www.w3.org/1999/xhtml">
df = pd.read_csv(
    "air_passengers.csv",
    parse_dates=["ds"],
    index_col=["ds"],
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1578.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1579.1" xmlns:="http://www.w3.org/1999/xhtml">You can plot the time series to find data gaps as we did in </span><em class="italic"><span class="koboSpan" id="kobo.1580.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.1581.1" xmlns:="http://www.w3.org/1999/xhtml"> of the </span><em class="italic"><span class="koboSpan" id="kobo.1582.1" xmlns:="http://www.w3.org/1999/xhtml">Implementing forward and backward </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1583.1" xmlns:="http://www.w3.org/1999/xhtml">fill</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1584.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1585.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s impute the missing</span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.1586.1" xmlns:="http://www.w3.org/1999/xhtml"> data by </span><span class="No-Break"><span class="koboSpan" id="kobo.1587.1" xmlns:="http://www.w3.org/1999/xhtml">linear interpolation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1588.1" xmlns:="http://www.w3.org/1999/xhtml">
df_imputed = df.interpolate(method="linear")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1589.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1590.1" xmlns:="http://www.w3.org/1999/xhtml">If the time intervals between rows are not uniform then the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1591.1" xmlns:="http://www.w3.org/1999/xhtml">method</span></strong><span class="koboSpan" id="kobo.1592.1" xmlns:="http://www.w3.org/1999/xhtml"> should be set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1593.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong><span class="koboSpan" id="kobo.1594.1" xmlns:="http://www.w3.org/1999/xhtml"> to achieve a </span><span class="No-Break"><span class="koboSpan" id="kobo.1595.1" xmlns:="http://www.w3.org/1999/xhtml">linear fit.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1596.1" xmlns:="http://www.w3.org/1999/xhtml">You can verify the absence of missing data by </span><span class="No-Break"><span class="koboSpan" id="kobo.1597.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1598.1" xmlns:="http://www.w3.org/1999/xhtml">df_imputed.isnull().sum()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1599.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1600.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s now plot the complete dataset and overlay as a dotted line the values used for </span><span class="No-Break"><span class="koboSpan" id="kobo.1601.1" xmlns:="http://www.w3.org/1999/xhtml">the imputation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1602.1" xmlns:="http://www.w3.org/1999/xhtml">
ax = df_imputed.plot(
    linestyle="-", marker=".", figsize=[10, 5])
df_imputed[df.isnull()].plot(
    ax=ax, legend=None, marker=".", color="r")
ax.set_title("Air passengers")
ax.set_ylabel("Number of passengers")
ax.set_xlabel("Time")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1603.1" xmlns:="http://www.w3.org/1999/xhtml">The previous code returns the following plot, where we see the values used to replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.1604.1" xmlns:="http://www.w3.org/1999/xhtml">nan</span></strong><span class="koboSpan" id="kobo.1605.1" xmlns:="http://www.w3.org/1999/xhtml"> as dotted lines in between the continuous line of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1606.1" xmlns:="http://www.w3.org/1999/xhtml">time series:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer012">
<span class="koboSpan" id="kobo.1607.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.8 – Time series data where missing values were replaced by linear interpolation between the last and next valid data points (dotted line)" src="image/B22396_01_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1608.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.8 – Time series data where missing values were replaced by linear interpolation between the last and next valid data points (dotted line)</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1609.1" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, we can impute</span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.1610.1" xmlns:="http://www.w3.org/1999/xhtml"> missing data by doing spline interpolation. </span><span class="koboSpan" id="kobo.1610.2" xmlns:="http://www.w3.org/1999/xhtml">We’ll use a polynomial of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1611.1" xmlns:="http://www.w3.org/1999/xhtml">second degree:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1612.1" xmlns:="http://www.w3.org/1999/xhtml">
df_imputed = df.interpolate(method="spline", order=2)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1613.1" xmlns:="http://www.w3.org/1999/xhtml">If we plot the imputed dataset and overlay the imputation values as we did in </span><em class="italic"><span class="koboSpan" id="kobo.1614.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em><span class="koboSpan" id="kobo.1615.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the </span><span class="No-Break"><span class="koboSpan" id="kobo.1616.1" xmlns:="http://www.w3.org/1999/xhtml">following plot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer013">
<span class="koboSpan" id="kobo.1617.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.9 – Time series data where missing values were replaced by fitting a second-degree polynomial between the last and next valid data points (dotted line)" src="image/B22396_01_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1618.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.9 – Time series data where missing values were replaced by fitting a second-degree polynomial between the last and next valid data points (dotted line)</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1619.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1620.1" xmlns:="http://www.w3.org/1999/xhtml">Change the degree of the polynomial used in the interpolation to see how the replacement </span><span class="No-Break"><span class="koboSpan" id="kobo.1621.1" xmlns:="http://www.w3.org/1999/xhtml">values vary.</span></span></p>
<p><span class="koboSpan" id="kobo.1622.1" xmlns:="http://www.w3.org/1999/xhtml">We’ve now obtained complete</span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.1623.1" xmlns:="http://www.w3.org/1999/xhtml"> datasets that we can use for analysis </span><span class="No-Break"><span class="koboSpan" id="kobo.1624.1" xmlns:="http://www.w3.org/1999/xhtml">and modeling.</span></span></p>
<h2 id="_idParaDest-49"><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.1625.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1626.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1627.1" xmlns:="http://www.w3.org/1999/xhtml">interpolate()</span></strong><span class="koboSpan" id="kobo.1628.1" xmlns:="http://www.w3.org/1999/xhtml"> fills missing values in a range by using an interpolation method. </span><span class="koboSpan" id="kobo.1628.2" xmlns:="http://www.w3.org/1999/xhtml">When we set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1629.1" xmlns:="http://www.w3.org/1999/xhtml">method</span></strong><span class="koboSpan" id="kobo.1630.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1631.1" xmlns:="http://www.w3.org/1999/xhtml">linear</span></strong><span class="koboSpan" id="kobo.1632.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1633.1" xmlns:="http://www.w3.org/1999/xhtml">interpolate()</span></strong><span class="koboSpan" id="kobo.1634.1" xmlns:="http://www.w3.org/1999/xhtml"> treats all data points as equidistant and fits a line between the last and next valid points in an interval with </span><span class="No-Break"><span class="koboSpan" id="kobo.1635.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1636.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1637.1" xmlns:="http://www.w3.org/1999/xhtml">If you want to perform linear interpolation, but your data points are not equally distanced, set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1638.1" xmlns:="http://www.w3.org/1999/xhtml">method</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1639.1" xmlns:="http://www.w3.org/1999/xhtml">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1640.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1641.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1642.1" xmlns:="http://www.w3.org/1999/xhtml">We then performed spline interpolation with a second-degree polynomial by setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.1643.1" xmlns:="http://www.w3.org/1999/xhtml">method</span></strong><span class="koboSpan" id="kobo.1644.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1645.1" xmlns:="http://www.w3.org/1999/xhtml">spline</span></strong><span class="koboSpan" id="kobo.1646.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1647.1" xmlns:="http://www.w3.org/1999/xhtml">order</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1648.1" xmlns:="http://www.w3.org/1999/xhtml">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1649.1" xmlns:="http://www.w3.org/1999/xhtml">2</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1650.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1651.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.1652.1" xmlns:="http://www.w3.org/1999/xhtml">interpolate()</span></strong><span class="koboSpan" id="kobo.1653.1" xmlns:="http://www.w3.org/1999/xhtml"> uses </span><strong class="source-inline"><span class="koboSpan" id="kobo.1654.1" xmlns:="http://www.w3.org/1999/xhtml">scipy.interpolate.interp1d</span></strong><span class="koboSpan" id="kobo.1655.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1656.1" xmlns:="http://www.w3.org/1999/xhtml">scipy.interpolate.UnivariateSpline</span></strong><span class="koboSpan" id="kobo.1657.1" xmlns:="http://www.w3.org/1999/xhtml"> under the hood, and can therefore implement other interpolation</span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.1658.1" xmlns:="http://www.w3.org/1999/xhtml"> methods. </span><span class="koboSpan" id="kobo.1658.2" xmlns:="http://www.w3.org/1999/xhtml">Check out pandas</span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.1659.1" xmlns:="http://www.w3.org/1999/xhtml"> documentation for more details </span><span class="No-Break"><span class="koboSpan" id="kobo.1660.1" xmlns:="http://www.w3.org/1999/xhtml">at </span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.interpolate.html"><span class="No-Break"><span class="koboSpan" id="kobo.1661.1" xmlns:="http://www.w3.org/1999/xhtml">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.interpolate.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1662.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-50"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.1663.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.1664.1" xmlns:="http://www.w3.org/1999/xhtml">While interpolation aims to get better estimates of the missing data compared to forward and backward fill, these estimates may still not be accurate if the times series show strong trend and seasonality. </span><span class="koboSpan" id="kobo.1664.2" xmlns:="http://www.w3.org/1999/xhtml">To obtain better estimates of the missing data in these types of time series, check out time series decomposition</span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.1665.1" xmlns:="http://www.w3.org/1999/xhtml"> followed by interpolation in the </span><em class="italic"><span class="koboSpan" id="kobo.1666.1" xmlns:="http://www.w3.org/1999/xhtml">Feature Engineering for Time Series Course</span></em> <span class="No-Break"><span class="koboSpan" id="kobo.1667.1" xmlns:="http://www.w3.org/1999/xhtml">at </span></span><a href="https://www.trainindata.com/p/feature-engineering-for-forecasting"><span class="No-Break"><span class="koboSpan" id="kobo.1668.1" xmlns:="http://www.w3.org/1999/xhtml">https://www.trainindata.com/p/feature-engineering-for-forecasting</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1669.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-51"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.1670.1" xmlns:="http://www.w3.org/1999/xhtml">Performing multivariate imputation by chained equations</span></h1>
<p><span class="koboSpan" id="kobo.1671.1" xmlns:="http://www.w3.org/1999/xhtml">Multivariate imputat</span><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.1672.1" xmlns:="http://www.w3.org/1999/xhtml">ion</span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.1673.1" xmlns:="http://www.w3.org/1999/xhtml"> methods, as opposed</span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.1674.1" xmlns:="http://www.w3.org/1999/xhtml"> to univariate imputation, use multiple variables to estimate the missing values. </span><strong class="bold"><span class="koboSpan" id="kobo.1675.1" xmlns:="http://www.w3.org/1999/xhtml">Multivariate Imputation by Chained Equations</span></strong><span class="koboSpan" id="kobo.1676.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1677.1" xmlns:="http://www.w3.org/1999/xhtml">MICE</span></strong><span class="koboSpan" id="kobo.1678.1" xmlns:="http://www.w3.org/1999/xhtml">) models each variable with missing</span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.1679.1" xmlns:="http://www.w3.org/1999/xhtml"> values as a function of the remaining variables in the dataset. </span><span class="koboSpan" id="kobo.1679.2" xmlns:="http://www.w3.org/1999/xhtml">The output of that function is used to replace </span><span class="No-Break"><span class="koboSpan" id="kobo.1680.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
<p><span class="koboSpan" id="kobo.1681.1" xmlns:="http://www.w3.org/1999/xhtml">MICE involves the </span><span class="No-Break"><span class="koboSpan" id="kobo.1682.1" xmlns:="http://www.w3.org/1999/xhtml">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1683.1" xmlns:="http://www.w3.org/1999/xhtml">First, it performs a simple univariate imputation to every variable with missing data. </span><span class="koboSpan" id="kobo.1683.2" xmlns:="http://www.w3.org/1999/xhtml">For example, </span><span class="No-Break"><span class="koboSpan" id="kobo.1684.1" xmlns:="http://www.w3.org/1999/xhtml">median imputation.</span></span></li>
<li><span class="koboSpan" id="kobo.1685.1" xmlns:="http://www.w3.org/1999/xhtml">Next, it selects one specific variable, say, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1686.1" xmlns:="http://www.w3.org/1999/xhtml">var_1</span></strong><span class="koboSpan" id="kobo.1687.1" xmlns:="http://www.w3.org/1999/xhtml">, and sets the missing values back </span><span class="No-Break"><span class="koboSpan" id="kobo.1688.1" xmlns:="http://www.w3.org/1999/xhtml">to missing.</span></span></li>
<li><span class="koboSpan" id="kobo.1689.1" xmlns:="http://www.w3.org/1999/xhtml">It trains a model to predict </span><strong class="source-inline"><span class="koboSpan" id="kobo.1690.1" xmlns:="http://www.w3.org/1999/xhtml">var_1</span></strong><span class="koboSpan" id="kobo.1691.1" xmlns:="http://www.w3.org/1999/xhtml"> using the other variables as </span><span class="No-Break"><span class="koboSpan" id="kobo.1692.1" xmlns:="http://www.w3.org/1999/xhtml">input features.</span></span></li>
<li><span class="koboSpan" id="kobo.1693.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, it replaces the missing values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1694.1" xmlns:="http://www.w3.org/1999/xhtml">var_1</span></strong><span class="koboSpan" id="kobo.1695.1" xmlns:="http://www.w3.org/1999/xhtml"> with the output of </span><span class="No-Break"><span class="koboSpan" id="kobo.1696.1" xmlns:="http://www.w3.org/1999/xhtml">the model.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.1697.1" xmlns:="http://www.w3.org/1999/xhtml">MICE repeats </span><em class="italic"><span class="koboSpan" id="kobo.1698.1" xmlns:="http://www.w3.org/1999/xhtml">steps 2</span></em><span class="koboSpan" id="kobo.1699.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><em class="italic"><span class="koboSpan" id="kobo.1700.1" xmlns:="http://www.w3.org/1999/xhtml">4</span></em><span class="koboSpan" id="kobo.1701.1" xmlns:="http://www.w3.org/1999/xhtml"> for each of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1702.1" xmlns:="http://www.w3.org/1999/xhtml">remaining variables.</span></span></p>
<p><span class="koboSpan" id="kobo.1703.1" xmlns:="http://www.w3.org/1999/xhtml">An imputation cycle</span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.1704.1" xmlns:="http://www.w3.org/1999/xhtml"> concludes once all the variables</span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.1705.1" xmlns:="http://www.w3.org/1999/xhtml"> have been modeled. </span><span class="koboSpan" id="kobo.1705.2" xmlns:="http://www.w3.org/1999/xhtml">MICE carries out multiple imputation cycles, typically 10. </span><span class="koboSpan" id="kobo.1705.3" xmlns:="http://www.w3.org/1999/xhtml">That is, we repeat </span><em class="italic"><span class="koboSpan" id="kobo.1706.1" xmlns:="http://www.w3.org/1999/xhtml">steps 2</span></em><span class="koboSpan" id="kobo.1707.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><em class="italic"><span class="koboSpan" id="kobo.1708.1" xmlns:="http://www.w3.org/1999/xhtml">4</span></em><span class="koboSpan" id="kobo.1709.1" xmlns:="http://www.w3.org/1999/xhtml"> for each variable 10 times. </span><span class="koboSpan" id="kobo.1709.2" xmlns:="http://www.w3.org/1999/xhtml">The idea is th</span><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.1710.1" xmlns:="http://www.w3.org/1999/xhtml">at by the end of the cycles, we should have found the best possible estimates of the missing data for </span><span class="No-Break"><span class="koboSpan" id="kobo.1711.1" xmlns:="http://www.w3.org/1999/xhtml">each variable.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1712.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1713.1" xmlns:="http://www.w3.org/1999/xhtml">Multivariate imputation</span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.1714.1" xmlns:="http://www.w3.org/1999/xhtml"> can be a useful alternative to univariate imputation in situations where we don’t want to distort the variable distributions. </span><span class="koboSpan" id="kobo.1714.2" xmlns:="http://www.w3.org/1999/xhtml">Multivariate imputation is also useful when we are interested in having good estimates o</span><a id="_idTextAnchor151"/><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.1715.1" xmlns:="http://www.w3.org/1999/xhtml">f the </span><span class="No-Break"><span class="koboSpan" id="kobo.1716.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
<p><span class="koboSpan" id="kobo.1717.1" xmlns:="http://www.w3.org/1999/xhtml">In th</span><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.1718.1" xmlns:="http://www.w3.org/1999/xhtml">is recipe, we will implement MICE </span><span class="No-Break"><span class="koboSpan" id="kobo.1719.1" xmlns:="http://www.w3.org/1999/xhtml">using scikit-learn.</span></span></p>
<h2 id="_idParaDest-52"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.1720.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1721.1" xmlns:="http://www.w3.org/1999/xhtml">To begin the recipe, let’s import the required libraries and load </span><span class="No-Break"><span class="koboSpan" id="kobo.1722.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1723.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the required Python libraries, classes, </span><span class="No-Break"><span class="koboSpan" id="kobo.1724.1" xmlns:="http://www.w3.org/1999/xhtml">and functions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1725.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.linear_model import BayesianRidge
from sklearn.experimental import (
    enable_iterative_imputer
)
from sklearn.impute import (
    IterativeImputer,
    SimpleImputer
)</span></pre></li> <li><span class="koboSpan" id="kobo.1726.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load some numerical</span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.1727.1" xmlns:="http://www.w3.org/1999/xhtml"> variables from the dataset</span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.1728.1" xmlns:="http://www.w3.org/1999/xhtml"> described in the </span><em class="italic"><span class="koboSpan" id="kobo.1729.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1730.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1731.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1732.1" xmlns:="http://www.w3.org/1999/xhtml">
variables = [
    "A2", "A3", "A8", "A11", "A14", "A15", "target"]
data = pd.read_csv(
    "credit_approval_uci.csv",
    usecols=variables)</span></pre></li> <li><span class="koboSpan" id="kobo.1733.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s divide the data into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1734.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1735.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    data.drop("targ</span><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.1736.1" xmlns:="http://www.w3.org/1999/xhtml">et", axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1737.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a MICE imputer using Bayes regression, specifying the number of iteration cycles and setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.1738.1" xmlns:="http://www.w3.org/1999/xhtml">random_state</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1739.1" xmlns:="http://www.w3.org/1999/xhtml">for reproducibility:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1740.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = IterativeImputer(
    estimator= BayesianRidge(),
    max_iter=10,
    random_state=0,
).set_output(transform="pandas")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1741.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1742.1" xmlns:="http://www.w3.org/1999/xhtml">IterativeImputer()</span></strong><span class="koboSpan" id="kobo.1743.1" xmlns:="http://www.w3.org/1999/xhtml"> contains other useful arguments. </span><span class="koboSpan" id="kobo.1743.2" xmlns:="http://www.w3.org/1999/xhtml">For example, we can specify the first imputation strategy using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1744.1" xmlns:="http://www.w3.org/1999/xhtml">initial_strategy</span></strong><span class="koboSpan" id="kobo.1745.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter. </span><span class="koboSpan" id="kobo.1745.2" xmlns:="http://www.w3.org/1999/xhtml">We can choose from the mean, median, mode, or arbitrary imputation. </span><span class="koboSpan" id="kobo.1745.3" xmlns:="http://www.w3.org/1999/xhtml">We can also specify how we want to cycle over the variables, either randomly or from the one with the fewest missing values to the one with </span><span class="No-Break"><span class="koboSpan" id="kobo.1746.1" xmlns:="http://www.w3.org/1999/xhtml">the most.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1747.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit </span><strong class="source-inline"><span class="koboSpan" id="kobo.1748.1" xmlns:="http://www.w3.org/1999/xhtml">IterativeImputer()</span></strong><span class="koboSpan" id="kobo.1749.1" xmlns:="http://www.w3.org/1999/xhtml"> so that it trains</span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.1750.1" xmlns:="http://www.w3.org/1999/xhtml"> the estimators</span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.1751.1" xmlns:="http://www.w3.org/1999/xhtml"> to predict the missing values in </span><span class="No-Break"><span class="koboSpan" id="kobo.1752.1" xmlns:="http://www.w3.org/1999/xhtml">each variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1753.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.fit(X_train)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1754.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1755.1" xmlns:="http://www.w3.org/1999/xhtml">We can use any regression model to estimate the missing data </span><span class="No-Break"><span class="koboSpan" id="kobo.1756.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1757.1" xmlns:="http://www.w3.org/1999/xhtml">IterativeImputer()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1758.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1759.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s fill in the missing values in both the train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1760.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1761.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = imputer.transform(X_train)
X_test_t = imputer.transform(X_test)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1762.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1763.1" xmlns:="http://www.w3.org/1999/xhtml">To corroborate the lack of missing data, we can </span><span class="No-Break"><span class="koboSpan" id="kobo.1764.1" xmlns:="http://www.w3.org/1999/xhtml">execute </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1765.1" xmlns:="http://www.w3.org/1999/xhtml">X_train_t.isnull().sum()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1766.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1767.1" xmlns:="http://www.w3.org/1999/xhtml">To wrap up the recipe, let’s impute the variables with a simple univariate imputation method and compare the effect on the </span><span class="No-Break"><span class="koboSpan" id="kobo.1768.1" xmlns:="http://www.w3.org/1999/xhtml">variables’ distribution.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1769.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1770.1" xmlns:="http://www.w3.org/1999/xhtml">SimpleImputer()</span></strong><span class="koboSpan" id="kobo.1771.1" xmlns:="http://www.w3.org/1999/xhtml"> to perform mean imputation, and then transform </span><span class="No-Break"><span class="koboSpan" id="kobo.1772.1" xmlns:="http://www.w3.org/1999/xhtml">the datasets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1773.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer_simple = SimpleImputer(
    strategy="mean").set_output(transform="pandas")
X_train_s =</span><a id="_idTextAnchor156"/><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.1774.1" xmlns:="http://www.w3.org/1999/xhtml"> imputer_simple.fit_transform(X_train)
X_test_s = imputer_simple.transform(X_test)</span></pre></li> <li><span class="koboSpan" id="kobo.1775.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s now make a histogram</span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.1776.1" xmlns:="http://www.w3.org/1999/xhtml"> of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1777.1" xmlns:="http://www.w3.org/1999/xhtml">A3</span></strong><span class="koboSpan" id="kobo.1778.1" xmlns:="http://www.w3.org/1999/xhtml"> variable</span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.1779.1" xmlns:="http://www.w3.org/1999/xhtml"> after MICE imputation, followed by a histogram of the same variable after </span><span class="No-Break"><span class="koboSpan" id="kobo.1780.1" xmlns:="http://www.w3.org/1999/xhtml">mean imputation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1781.1" xmlns:="http://www.w3.org/1999/xhtml">
fig, axes = plt.subplots(
    2, 1, figsize=(10, 10), squeeze=False)
X_test_t["A3"].hist(
    bins=50, ax=axes[0, 0], color="blue")
X_test_s["A3"].hist(
    bins=50, ax=axes[1, 0], color="green")
axes[0, 0].set_ylabel('Number of observations')
axes[1, 0].set_ylabel('Number of observations')
axes[0, 0].set_xlabel('A3')
axes[1, 0].set_xlabel('A3')
axes[0, 0].set_title('MICE')
axes[1, 0].set_title('Mean imputation')
plt.show()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1782.1" xmlns:="http://www.w3.org/1999/xhtml">In the following plot, we see that mean imputation distorts the variable distribution, with more observations toward the </span><span class="No-Break"><span class="koboSpan" id="kobo.1783.1" xmlns:="http://www.w3.org/1999/xhtml">mean value:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer014">
<span class="koboSpan" id="kobo.1784.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.10 –  Histogram of variable A3 after mice imputation (top) or mean imputation (bottom), showing the distortion in the variable distribution caused by the latter" src="image/B22396_01_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1785.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.10 –  Histogram of variable A3 after mice imputation (top) or mean imputation (bottom), showing the distortion in the variable distribution caused by the latter</span></p>
<h2 id="_idParaDest-53"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.1786.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1787.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we performed</span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.1788.1" xmlns:="http://www.w3.org/1999/xhtml"> multivariate imputation</span><a id="_idIndexMarker095"/><span class="koboSpan" id="kobo.1789.1" xmlns:="http://www.w3.org/1999/xhtml"> using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1790.1" xmlns:="http://www.w3.org/1999/xhtml">IterativeImputer()</span></strong><span class="koboSpan" id="kobo.1791.1" xmlns:="http://www.w3.org/1999/xhtml"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1792.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn</span></strong><span class="koboSpan" id="kobo.1793.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1793.2" xmlns:="http://www.w3.org/1999/xhtml">When we fit the model, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1794.1" xmlns:="http://www.w3.org/1999/xhtml">IterativeImputer()</span></strong><span class="koboSpan" id="kobo.1795.1" xmlns:="http://www.w3.org/1999/xhtml"> carried out the steps that we described in the introduction of the recipe. </span><span class="koboSpan" id="kobo.1795.2" xmlns:="http://www.w3.org/1999/xhtml">That is, it imputed all variables with the mean. </span><span class="koboSpan" id="kobo.1795.3" xmlns:="http://www.w3.org/1999/xhtml">Then it selected one variable and set its missing values back to missing. </span><span class="koboSpan" id="kobo.1795.4" xmlns:="http://www.w3.org/1999/xhtml">And finally, it fitted a Bayes regressor to estimate that variable based on the others. </span><span class="koboSpan" id="kobo.1795.5" xmlns:="http://www.w3.org/1999/xhtml">It repeated this procedure for each variable. </span><span class="koboSpan" id="kobo.1795.6" xmlns:="http://www.w3.org/1999/xhtml">That was one cycle of imputation. </span><span class="koboSpan" id="kobo.1795.7" xmlns:="http://www.w3.org/1999/xhtml">We set it to repeat this process 10 times. </span><span class="koboSpan" id="kobo.1795.8" xmlns:="http://www.w3.org/1999/xhtml">By the end of this procedure, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1796.1" xmlns:="http://www.w3.org/1999/xhtml">IterativeImputer()</span></strong><span class="koboSpan" id="kobo.1797.1" xmlns:="http://www.w3.org/1999/xhtml"> had one Bayes regressor trained to predict the values of each variable based on the other variables in the dataset. </span><span class="koboSpan" id="kobo.1797.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1798.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1799.1" xmlns:="http://www.w3.org/1999/xhtml">, it uses the predictions of these Bayes models to impute the </span><span class="No-Break"><span class="koboSpan" id="kobo.1800.1" xmlns:="http://www.w3.org/1999/xhtml">missing d</span><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.1801.1" xmlns:="http://www.w3.org/1999/xhtml">ata.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1802.1" xmlns:="http://www.w3.org/1999/xhtml">Iter</span><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.1803.1" xmlns:="http://www.w3.org/1999/xhtml">ativeImputer()</span></strong><span class="koboSpan" id="kobo.1804.1" xmlns:="http://www.w3.org/1999/xhtml"> can only impute missing data in numerical variables based on numerical variables. </span><span class="koboSpan" id="kobo.1804.2" xmlns:="http://www.w3.org/1999/xhtml">If you want to use categorical variables as input, you need to encode them first. </span><span class="koboSpan" id="kobo.1804.3" xmlns:="http://www.w3.org/1999/xhtml">However, keep in mind</span><a id="_idIndexMarker096"/><span class="koboSpan" id="kobo.1805.1" xmlns:="http://www.w3.org/1999/xhtml"> that it will only carry </span><a id="_idIndexMarker097"/><span class="koboSpan" id="kobo.1806.1" xmlns:="http://www.w3.org/1999/xhtml">out regression. </span><a id="_idTextAnchor161"/><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.1807.1" xmlns:="http://www.w3.org/1999/xhtml">Hence it is </span><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.1808.1" xmlns:="http://www.w3.org/1999/xhtml">not suitable to estimate missing data in discrete or </span><span class="No-Break"><span class="koboSpan" id="kobo.1809.1" xmlns:="http://www.w3.org/1999/xhtml">categorical variables.</span></span></p>
<h2 id="_idParaDest-54"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.1810.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.1811.1" xmlns:="http://www.w3.org/1999/xhtml">To learn more about MICE, take a look at the </span><span class="No-Break"><span class="koboSpan" id="kobo.1812.1" xmlns:="http://www.w3.org/1999/xhtml">following resources:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1813.1" xmlns:="http://www.w3.org/1999/xhtml">A multivariate technique for multiplying imputing missing values using a sequence of regression </span><span class="No-Break"><span class="koboSpan" id="kobo.1814.1" xmlns:="http://www.w3.org/1999/xhtml">models: </span></span><a href="https://www.researchgate.net/publication/244959137_A_Multivariate_Technique_for_Multiply_Imputing_Missing_Values_Using_a_Sequence_of_Regression_Models"><span class="No-Break"><span class="koboSpan" id="kobo.1815.1" xmlns:="http://www.w3.org/1999/xhtml">https://www.researchgate.net/publication/244959137</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.1816.1" xmlns:="http://www.w3.org/1999/xhtml">Multiple Imputation by Chained Equations: W</span><a id="_idTextAnchor165"/><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.1817.1" xmlns:="http://www.w3.org/1999/xhtml">hat is it and how does it </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1818.1" xmlns:="http://www.w3.org/1999/xhtml">work?</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1819.1" xmlns:="http://www.w3.org/1999/xhtml">: </span></span><a href="https://www.jstatsoft.org/article/download/v045i03/550"><span class="No-Break"><span class="koboSpan" id="kobo.1820.1" xmlns:="http://www.w3.org/1999/xhtml">https://www.jstatsoft.org/article/download/v045i03/550</span></span></a></li>
</ul>
<h1 id="_idParaDest-55"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.1821.1" xmlns:="http://www.w3.org/1999/xhtml">Estimating missing data with nearest neighbors</span></h1>
<p><span class="koboSpan" id="kobo.1822.1" xmlns:="http://www.w3.org/1999/xhtml">Imputation with </span><strong class="bold"><span class="koboSpan" id="kobo.1823.1" xmlns:="http://www.w3.org/1999/xhtml">K-Nearest Neighbors</span></strong><span class="koboSpan" id="kobo.1824.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1825.1" xmlns:="http://www.w3.org/1999/xhtml">KNN</span></strong><span class="koboSpan" id="kobo.1826.1" xmlns:="http://www.w3.org/1999/xhtml">) involves estimating missing values</span><a id="_idIndexMarker098"/><span class="koboSpan" id="kobo.1827.1" xmlns:="http://www.w3.org/1999/xhtml"> in a dataset by considering</span><a id="_idIndexMarker099"/><span class="koboSpan" id="kobo.1828.1" xmlns:="http://www.w3.org/1999/xhtml"> the values of their nearest </span><a id="_idIndexMarker100"/><span class="koboSpan" id="kobo.1829.1" xmlns:="http://www.w3.org/1999/xhtml">neighbors, where similarity between data points is determined based on a distance metric, such as the Euclidean distance. </span><span class="koboSpan" id="kobo.1829.2" xmlns:="http://www.w3.org/1999/xhtml">It assigns the missing value the average of the nearest neighbors’ values, weighted by </span><span class="No-Break"><span class="koboSpan" id="kobo.1830.1" xmlns:="http://www.w3.org/1999/xhtml">their distance.</span></span></p>
<p><span class="koboSpan" id="kobo.1831.1" xmlns:="http://www.w3.org/1999/xhtml">Consider the following data set containing 4 variables (columns) and 11 observations (rows). </span><span class="koboSpan" id="kobo.1831.2" xmlns:="http://www.w3.org/1999/xhtml">We want to impute the dark value in the fifth row of the second variable. </span><span class="koboSpan" id="kobo.1831.3" xmlns:="http://www.w3.org/1999/xhtml">First, we find the row’s k-nearest neighbors, where </span><em class="italic"><span class="koboSpan" id="kobo.1832.1" xmlns:="http://www.w3.org/1999/xhtml">k=3</span></em><span class="koboSpan" id="kobo.1833.1" xmlns:="http://www.w3.org/1999/xhtml"> in our example, and they are highlighted by the rectangular boxes (middle panel). </span><span class="koboSpan" id="kobo.1833.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we take the average value shown by the closest neighbors for </span><span class="No-Break"><span class="koboSpan" id="kobo.1834.1" xmlns:="http://www.w3.org/1999/xhtml">variable 2.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.1835.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 1.11 – Diagram showing a value to impute (dark box), the three closest rows to the value to impute (square boxes), and the values considered to take the average for the imputation" src="image/B22396_01_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1836.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 1.11 – Diagram showing a value to impute (dark box), the three closest rows to the value to impute (square boxes), and the values considered to take the average for the imputation</span></p>
<p><span class="koboSpan" id="kobo.1837.1" xmlns:="http://www.w3.org/1999/xhtml">The value for the imputation</span><a id="_idIndexMarker101"/><span class="koboSpan" id="kobo.1838.1" xmlns:="http://www.w3.org/1999/xhtml"> is given by (value1 × w1 + value2 × w2 + value3 × w3) / 3, where w1, w2, and w3 are proportional to the distance</span><a id="_idIndexMarker102"/><span class="koboSpan" id="kobo.1839.1" xmlns:="http://www.w3.org/1999/xhtml"> of the neighbo</span><a id="_idTextAnchor168"/><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.1840.1" xmlns:="http://www.w3.org/1999/xhtml">r to the data </span><span class="No-Break"><span class="koboSpan" id="kobo.1841.1" xmlns:="http://www.w3.org/1999/xhtml">to impute.</span></span></p>
<p><span class="koboSpan" id="kobo.1842.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will perform KNN imputation </span><span class="No-Break"><span class="koboSpan" id="kobo.1843.1" xmlns:="http://www.w3.org/1999/xhtml">using scikit-learn.</span></span></p>
<h2 id="_idParaDest-56"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.1844.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1845.1" xmlns:="http://www.w3.org/1999/xhtml">To proceed with the recipe, let’s import the required libraries and prepare </span><span class="No-Break"><span class="koboSpan" id="kobo.1846.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1847.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the required libraries, classes, </span><span class="No-Break"><span class="koboSpan" id="kobo.1848.1" xmlns:="http://www.w3.org/1999/xhtml">and functions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1849.1" xmlns:="http://www.w3.org/1999/xhtml">
import matplotlib.pyplot as plt
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.impute import KNNImputer</span></pre></li> <li><span class="koboSpan" id="kobo.1850.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the dataset described in the </span><em class="italic"><span class="koboSpan" id="kobo.1851.1" xmlns:="http://www.w3.org/1999/xhtml">Technical requirements</span></em><span class="koboSpan" id="kobo.1852.1" xmlns:="http://www.w3.org/1999/xhtml"> section (only some </span><span class="No-Break"><span class="koboSpan" id="kobo.1853.1" xmlns:="http://www.w3.org/1999/xhtml">numerical variables):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1854.1" xmlns:="http://www.w3.org/1999/xhtml">
variables = [
    "A2", "A3", "A8", "A11", "A14", "A15", </span><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.1855.1" xmlns:="http://www.w3.org/1999/xhtml">"target"]
d</span><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.1856.1" xmlns:="http://www.w3.org/1999/xhtml">ata = pd.read_csv(
    "credit_approval_uci.csv",
    usecols=variables,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1857.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s divide the data into train and </span><span class="No-Break"><span class="koboSpan" id="kobo.1858.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1859.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    data.drop("target", axis=1),
    data["target"],
    test_size=0.3,
    random_state=0,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1860.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up the imputer</span><a id="_idIndexMarker103"/><span class="koboSpan" id="kobo.1861.1" xmlns:="http://www.w3.org/1999/xhtml"> to replace missing data</span><a id="_idIndexMarker104"/><span class="koboSpan" id="kobo.1862.1" xmlns:="http://www.w3.org/1999/xhtml"> with the weighted mean of its closest </span><span class="No-Break"><span class="koboSpan" id="kobo.1863.1" xmlns:="http://www.w3.org/1999/xhtml">five neighbors:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1864.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer = KNNImputer(
    n_neighbors=5, weights="distance",
).set_output(transform="pandas")</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1865.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1866.1" xmlns:="http://www.w3.org/1999/xhtml">The replacement values can be calculated as the uniform mean of the k-nearest neighbors, by setting </span><strong class="source-inline"><span class="koboSpan" id="kobo.1867.1" xmlns:="http://www.w3.org/1999/xhtml">weights</span></strong><span class="koboSpan" id="kobo.1868.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1869.1" xmlns:="http://www.w3.org/1999/xhtml">uniform</span></strong><span class="koboSpan" id="kobo.1870.1" xmlns:="http://www.w3.org/1999/xhtml"> or as the weighted average, as we do in the recipe. </span><span class="koboSpan" id="kobo.1870.2" xmlns:="http://www.w3.org/1999/xhtml">The weight is based on the distance of the neighbor to the observation to impute. </span><span class="koboSpan" id="kobo.1870.3" xmlns:="http://www.w3.org/1999/xhtml">The nearest neighbors carry </span><span class="No-Break"><span class="koboSpan" id="kobo.1871.1" xmlns:="http://www.w3.org/1999/xhtml">more weight.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1872.1" xmlns:="http://www.w3.org/1999/xhtml">Find the </span><span class="No-Break"><span class="koboSpan" id="kobo.1873.1" xmlns:="http://www.w3.org/1999/xhtml">nearest neighbors:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1874.1" xmlns:="http://www.w3.org/1999/xhtml">
imputer.fit(X_train)</span></pre></li> <li><span class="koboSpan" id="kobo.1875.1" xmlns:="http://www.w3.org/1999/xhtml">Replace the missing values with the weighted mean of the values shown by </span><span class="No-Break"><span class="koboSpan" id="kobo.1876.1" xmlns:="http://www.w3.org/1999/xhtml">the neighbors:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1877.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train_t = imputer.</span><a id="_idTextAnchor173"/><a id="_idTextAnchor174"/><a id="_idTextAnchor175"/><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.1878.1" xmlns:="http://www.w3.org/1999/xhtml">transform(X_train)
X_test_t</span><a id="_idTextAnchor177"/><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.1879.1" xmlns:="http://www.w3.org/1999/xhtml"> = imputer.transform(X_t</span><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.1880.1" xmlns:="http://www.w3.org/1999/xhtml">est)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1881.1" xmlns:="http://www.w3.org/1999/xhtml">The result is a</span><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.1882.1" xmlns:="http://www.w3.org/1999/xhtml"> pandas DataFrame with the missing </span><span class="No-Break"><span class="koboSpan" id="kobo.1883.1" xmlns:="http://www.w3.org/1999/xhtml">data replaced.</span></span></p>
<h2 id="_idParaDest-57"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.1884.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1885.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we replaced</span><a id="_idIndexMarker105"/><span class="koboSpan" id="kobo.1886.1" xmlns:="http://www.w3.org/1999/xhtml"> missing data with the average</span><a id="_idIndexMarker106"/><span class="koboSpan" id="kobo.1887.1" xmlns:="http://www.w3.org/1999/xhtml"> value shown by each observation’s k-nearest neighbors. </span><span class="koboSpan" id="kobo.1887.2" xmlns:="http://www.w3.org/1999/xhtml">We set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1888.1" xmlns:="http://www.w3.org/1999/xhtml">KNNImputer()</span></strong><span class="koboSpan" id="kobo.1889.1" xmlns:="http://www.w3.org/1999/xhtml"> to find each observation’s five closest neighbors based on the Euclidean distance. </span><span class="koboSpan" id="kobo.1889.2" xmlns:="http://www.w3.org/1999/xhtml">The replacement values were estimated as the weighted average of the values shown by the five closest neighbors for the variable to impute. </span><span class="koboSpan" id="kobo.1889.3" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1890.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1891.1" xmlns:="http://www.w3.org/1999/xhtml">, the imputer calculated the replacement value and replaced the </span><span class="No-Break"><span class="koboSpan" id="kobo.1892.1" xmlns:="http://www.w3.org/1999/xhtml">missing data.</span></span></p>
</div>
</body></html>
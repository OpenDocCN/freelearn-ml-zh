<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer080">
    <h1 class="chapterNumber">2</h1>
    <h1 class="chapterTitle" id="_idParaDest-41">Decoding Marketing Performance with KPIs</h1>
    <p class="normal">Every data-driven or AI/ML-driven marketing strategy starts with a set of optimization and enhancement goals that have key performance metrics tied to them. These key performance metrics<a id="_idIndexMarker085"/> or measures are often termed the <strong class="keyWord">key performance indicators</strong> (<strong class="keyWord">KPIs</strong>) that help you track the performance of your marketing campaigns and define the success criteria of your marketing efforts. Some of the frequently<a id="_idIndexMarker086"/> used KPIs in digital<a id="_idIndexMarker087"/> and data-driven<a id="_idIndexMarker088"/> marketing that<a id="_idIndexMarker089"/> we will define and explore in this chapter are <strong class="keyWord">conversion rate, cost per acquisition</strong> (<strong class="keyWord">CPA</strong>), <strong class="keyWord">customer lifetime value</strong> (<strong class="keyWord">CLV</strong>), and <strong class="keyWord">return on investment</strong> (<strong class="keyWord">ROI</strong>).</p>
    <p class="normal">In this chapter, we will discuss a frequently used set of marketing KPIs, what they tell you about your marketing campaigns, and how they can be used to further improve and optimize your marketing strategies and business outcomes. We will use an insurance product marketing dataset as an example to highlight how Python and its data analysis and visualization libraries, such as <code class="inlineCode">pandas, numpy, matplotlib, </code>and<code class="inlineCode"> plotly</code>, can be used for analyzing, visualizing, and generating insights from marketing KPIs.</p>
    <p class="normal">In particular, we will cover the following topics in this chapter:</p>
    <ul>
      <li class="bulletList">Understanding marketing KPIs</li>
      <li class="bulletList">Computing and visualizing KPIs from data with Python</li>
      <li class="bulletList">Tracking marketing performance with KPIs</li>
    </ul>
    <div class="note">
      <p class="normal"><strong class="keyWord">Source code and data</strong>: <a href="https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/tree/main/ch.2"><span class="url">https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/tree/main/ch.2</span></a></p>
      <p class="normal"><strong class="keyWord">Data source</strong>: <a href="https://www.kaggle.com/datasets/pankajjsh06/ibm-watson-marketing-customer-value-data"><span class="url">https://www.kaggle.com/datasets/pankajjsh06/ibm-watson-marketing-customer-value-data</span></a></p>
    </div>
    <h1 class="heading-1" id="_idParaDest-42">Understanding marketing KPIs</h1>
    <p class="normal">As a marketer or marketing data<a id="_idIndexMarker090"/> scientist, KPIs are the keys to measuring the successes and failures of any marketing efforts. The proper usage and definition of KPIs ahead of embarking on any marketing campaign is crucial for the effective measurement of marketing successes and failures. However, improper usage of KPIs can result in misinformation being gathered and often wasting significant financial and human resources that have a direct negative impact on the business.</p>
    <p class="normal">For example, if your marketing goal is to raise brand awareness of a targeted group (i.e., Generation Alpha) but you are not properly breaking down the sources of marketing content impressions (i.e., text vs. image vs. video, or YouTube vs. Instagram vs. TikTok, or influencer referrals vs. paid ads), it may tell a completely different story than what is actually happening. We will review some of the frequently used KPIs in this section and move on to the implementation and real-world use case examples in the following sections.</p>
    <div class="note">
      <p class="normal"><strong class="keyWord">What is a KPI?</strong></p>
      <p class="normal">A KPI is a key performance indicator<a id="_idIndexMarker091"/> that measures and quantifies the progress toward a certain goal or objective. KPIs help organizations identify strengths and weaknesses and make data-driven decisions in every aspect of business, such as marketing, finance, sales, and operation.</p>
    </div>
    <p class="normal">In each stage of the marketing funnel, there are KPIs associated with it. The following diagram shows a summary of a typical marketing funnel along with some of the frequently used KPIs for each stage.</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_01.png"/></figure>
    <p class="packt_figref">Figure 2.1: Different stages of a typical marketing funnel</p>
    <p class="normal">Now let’s look at each of these stages in some detail.</p>
    <h2 class="heading-2" id="_idParaDest-43">Awareness stage</h2>
    <p class="normal">During the <em class="italic">Awareness</em> stage, the goal<a id="_idIndexMarker092"/> is to make customers aware of your organization and products. Thus, brand building and exposure are the ultimate marketing goals. Some of the typical KPIs to measure for the success of the marketing initiatives during this stage are <em class="italic">Number of Page Views</em>, <em class="italic">Number of Ad Clicks</em>, <em class="italic">Number of Visitors</em>, and <em class="italic">SEO Rankings</em>. The key here is to optimize marketing spending for maximum brand impressions and exposure.</p>
    <h2 class="heading-2" id="_idParaDest-44">Engagement stage</h2>
    <p class="normal">During the <em class="italic">Engagement</em> stage, the goal is to start<a id="_idIndexMarker093"/> interactions and build relationships with prospective customers. You may want potential customers to engage with your organization and products by opening emails, reading newsletters, clicking on links, and signing up for events. Some of the key metrics or KPIs to measure the success of your marketing initiatives during this stage are <em class="italic">Number of Opens</em>, <em class="italic">Number of Clicks</em>, <em class="italic">Number of Likes</em>, and <em class="italic">Number of Qualified Leads</em>.</p>
    <p class="normal">In particular, tracking the number of leads, as well as the quality of leads, is directly tied to potential future revenue. The key<a id="_idIndexMarker094"/> measure or metric to keep in mind here is the <strong class="keyWord">cost per lead</strong> (<strong class="keyWord">CPL</strong>), given by:</p>
    <figure class="mediaobject"><a id="_idIndexMarker095"/><img alt="" src="../Images/B30999_02_001.png"/></figure>
    <p class="normal">Keeping track of the rise and fall of CPL is important for successful marketing campaigns during this stage, as rising CPL indicates<a id="_idIndexMarker096"/> that the efficiency of your marketing strategy is decreasing.</p>
    <h2 class="heading-2" id="_idParaDest-45">Conversion stage</h2>
    <p class="normal">The <em class="italic">Conversion</em> stage is where we harvest<a id="_idIndexMarker097"/> all the hard work we have done. The definition of conversion can be different for distinct types of customers. For e-commerce businesses, conversion may mean leads making item purchases. For media businesses, conversion may mean leads signing up or paying subscriptions for newsletters. Regardless, this is when leads become customers. Some of the key metrics to follow in this stage are <em class="italic">Number of Purchases</em>, <em class="italic">Amount of Purchases</em>, <em class="italic">Number of Subscriptions</em>, or <em class="italic">Number of Items in Cart</em>.</p>
    <p class="normal">During this stage, tracking the conversion rate is important to measure the successes and failures of marketing initiatives. The conversion rate is simply:</p>
    <figure class="mediaobject"><a id="_idIndexMarker098"/><img alt="" src="../Images/B30999_02_002.png"/></figure>
    <p class="normal">Tracking the rise and fall of the conversion rate is important, as a falling conversion rate may suggest inefficiency in marketing strategies at this stage, product feature deficiencies, or market shifts in interests. On top of tracking this KPI, delving deeper into the drivers behind the rise and fall of conversion rates is even more important. We will look further into this in the following section on some of the approaches that can be taken to gain insights into conversion rates, and we will discuss more in detail, unveiling the drivers and factors behind the rise and fall of conversion rates, in the following chapter.</p>
    <h2 class="heading-2" id="_idParaDest-46">Retention stage</h2>
    <p class="normal">During the <em class="italic">Retention</em> stage, you focus on turning customers<a id="_idIndexMarker099"/> into repeat customers, providing continuous value to the customers, and making them stick to your services or products. Retaining customers and turning them into consistent repeat customers are directly tied to generating steady revenue streams. Some<a id="_idIndexMarker100"/> of the<a id="_idIndexMarker101"/> key<a id="_idIndexMarker102"/> metrics<a id="_idIndexMarker103"/> to track are <strong class="keyWord">customer retention rate</strong> (<strong class="keyWord">CRR</strong>), <strong class="keyWord">customer churn rate</strong> (<strong class="keyWord">CCR</strong>), <strong class="keyWord">customer lifetime value</strong> (<strong class="keyWord">CLV</strong>), and <strong class="keyWord">cost per acquisition</strong> (<strong class="keyWord">CPA</strong>).</p>
    <p class="normal">CRR and CCR can be calculated using the following equations:</p>
    <figure class="mediaobject"><a id="_idIndexMarker104"/><img alt="" src="../Images/B30999_02_003.png"/></figure>
    <figure class="mediaobject"><a id="_idIndexMarker105"/><img alt="" src="../Images/B30999_02_004.png"/></figure>
    <p class="normal">Rising CRR<a id="_idIndexMarker106"/> suggests that customers see value in using your services and products continuously; on the other hand, an increase in CCR suggests the opposite. There can be multiple reasons why customers churn, and delving deeper into data to understand the potential causes is the key to building successful marketing strategies during this stage. We will discuss how to look at data from different angles to have a comprehensive understanding of certain customer behaviors in the following section, and even deeper analysis techniques using machine learning will be discussed in the following chapter.</p>
    <p class="normal">In the <em class="italic">Retention</em> stage, understanding<a id="_idIndexMarker107"/> CLV and CPA is critical for <a id="_idIndexMarker108"/>a sustainable business. Even if CLV is high, where each customer brings in significant revenue, if CPA exceeds CLV, then it will be a net negative business. Even though it is not trivial to calculate CLV, the formulas for CPA and CLV are as follows:</p>
    <figure class="mediaobject"><a id="_idIndexMarker109"/><img alt="" src="../Images/B30999_02_005.png"/></figure>
    <figure class="mediaobject"><a id="_idIndexMarker110"/><img alt="" src="../Images/B30999_02_006.png"/></figure>
    <p class="normal">As you may notice, <em class="italic">Customer Value</em> in the CLV formula may depend on many factors, such as the type of business and the definition of the value. We will delve deeper into estimating CLV from an AI/ML point<a id="_idIndexMarker111"/> of view in <em class="chapterRef">Chapter 8</em>, but the key takeaway from this section is that CPA negates CLV, and proper measurement of both KPIs and optimization are critical paths to successful marketing strategies during the <em class="italic">Retention</em> stage.</p>
    <h2 class="heading-2" id="_idParaDest-47">Loyalty stage</h2>
    <p class="normal">This stage is where your customers<a id="_idIndexMarker112"/> become advocates of your services or products and bring in more new leads and customers via referrals, word of mouth, or reviews. It is critical to show your appreciation toward these loyal customers, help them spread the word about your services and products, and continue to build strong relationships and connections with your loyal customers.</p>
    <p class="normal">All key measures discussed previously are relevant and important to be continuously monitored for this stage. For example, the number of page visits and page views that were some of the <em class="italic">Awareness</em> stage KPIs are still applicable to this stage, so that you can continuously monitor and gauge the loyal customer group’s interest level. The number of clicks and likes, which were the KPIs during the <em class="italic">Engagement</em> stage, for example, are still relevant in the <em class="italic">Loyalty</em> stage so that you can track the continuous engagement of this group of customers. The number and amount of purchases, as well as the retention and churn rates that were some of the KPIs during the <em class="italic">Conversion</em> and <em class="italic">Retention</em> stages, are still important to monitor, as these loyal customers are the ones that bring the most consistent stream of revenues for businesses.</p>
    <p class="normal">Aside from the<a id="_idIndexMarker113"/> aforementioned KPIs, <strong class="keyWord">net promoter score</strong> (<strong class="keyWord">NPS</strong>) and <em class="italic">number of referrals</em> and reviews can be some of the other important KPIs to monitor during the <em class="italic">Loyalty</em> stage. </p>
    <p class="normal">In order to get the NPS, a survey needs to be conducted to gather customer feedback and, based on the survey results, NPS is calculated as in the following equation:</p>
    <figure class="mediaobject"><a id="_idIndexMarker114"/><img alt="" src="../Images/B30999_02_007.png"/></figure>
    <p class="normal">For example, if 60% of the survey respondents were promoters and 10% of the respondents were detractors, then your NPS would be 50. NPS ranges from -100 to 100, and the higher the score, the higher the satisfaction that the customers have from your services and products. It would be wise to periodically conduct such satisfaction surveys and monitor NPS, as not addressing decreasing NPS is likely to result in increasing customer churn rate and lower conversion rates.</p>
    <p class="normal">We have covered some of the key stages in the customer journey and marketing funnel and how you can form KPIs for each stage to track the health of your marketing funnel, as well as how to measure the successes and failures of your marketing strategies for each stage. Not only would you need to monitor KPIs consistently but you would also need to delve deeper into data to identify which parts of your funnel show weaknesses and how various groups of customers behave differently to different marketing strategies. In the following section, we will discuss how to take these learnings into practice with an insurance marketing dataset as an example using Python and start generating reusable and trackable<a id="_idIndexMarker115"/> KPIs, and derive actionable items from these KPIs.</p>
    <h1 class="heading-1" id="_idParaDest-48">Computing and visualizing KPIs from data with Python</h1>
    <p class="normal">With the foundation of various marketing KPIs<a id="_idIndexMarker116"/> that we have discussed<a id="_idIndexMarker117"/> so far, let us dive into a potential<a id="_idIndexMarker118"/> real-world use case of some of these KPIs, how<a id="_idIndexMarker119"/> to compute and visualize them, and how to interpret them for further data-driven decision-making. We will be using an insurance product marketing dataset for our example.</p>
    <p class="normal">From a financial point of view, the success of marketing is to bring in more revenue with less spending. The most straightforward approach in tracking and measuring this is to look at conversion rate, CLV, and CPA. The conversion rate tells us the percentage of leads converted into paying customers, CLV tells us the estimated revenue being generated per acquired customer, and CPA tells us how much it costs to acquire a paying customer. By combining these three KPIs, we can understand the ROI and contribution to the net income.</p>
    <p class="normal">Using the above-mentioned example dataset, let’s discuss how these KPIs can be measured with Python, help generate deeper insights, and, ultimately, affect the decision-making process for better and more efficient marketing strategies.</p>
    <h2 class="heading-2" id="_idParaDest-49">Conversion rate</h2>
    <p class="normal">The first KPI<a id="_idIndexMarker120"/> we are going to look at within this data is the <em class="italic">conversion rate</em>. Remember from the previous section that the conversion rate is the percentage of the leads converted into purchasing a product. In the context of this data, those who converted are those who responded <em class="italic">Yes</em> in the <code class="inlineCode">Response</code> column.</p>
    <h3 class="heading-" id="_idParaDest-50">Overall conversion rate</h3>
    <p class="normal">To calculate the overall conversion<a id="_idIndexMarker121"/> rate, we use the <code class="inlineCode">pandas</code> library:</p>
    <ol>
      <li class="numberedList" value="1">Assuming that the name of the data file is <code class="inlineCode">data.csv</code>, you can use the following code to import and read the data into a <code class="inlineCode">DataFrame</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.read_csv(<span class="hljs-string">"./data.csv"</span>)
</code></pre>
      </li>
      <li class="numberedList">Next, we need to convert the text responses in the <code class="inlineCode">Response</code> column into a binary 0 or 1 value so that we can easily compute the conversion rates. The code to do this is as follows:
        <pre class="programlisting code"><code class="hljs-code">df[<span class="hljs-string">"conversion"</span>] = df[<span class="hljs-string">"Response"</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x == <span class="hljs-string">"Yes"</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)
</code></pre>
      </li>
      <li class="numberedList">In order to compute the overall conversion rate with this data, you simply need to take the average of the values in the newly created <code class="inlineCode">conversion</code> column as in the following code:
        <pre class="programlisting con"><code class="hljs-con">df[<span class="hljs-string">"conversion"</span>].mean()
</code></pre>
      </li>
      <li class="numberedList">One way to visualize and easily understand the overall conversion rate is using a pie chart, which is a great way to show the composition or breakdown of different segments within data. The code to generate such a pie chart is as follows:
        <pre class="programlisting code"><code class="hljs-code">ax = df.groupby(<span class="hljs-string">"conversion"</span>)[<span class="hljs-string">"Customer"</span>].count().reset_index().plot.pie(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    y=<span class="hljs-string">"Customer"</span>,
    autopct=<span class="hljs-string">'%1.1f%%'</span>,
    legend=<span class="hljs-literal">False</span>,
    labels=[<span class="hljs-string">"No Conversion"</span>, <span class="hljs-string">"Conversion"</span>],
    explode=[<span class="hljs-number">0.05</span>, <span class="hljs-number">0.05</span>]
)
ax.set_ylabel(<span class="hljs-literal">None</span>)
</code></pre>
      </li>
    </ol>
    <p class="normal">Here, we first group by the column, conversion, and count the number of customers in each segment. This results in the number of converted customers vs. non-converted customers.</p>
    <ol>
      <li class="numberedList" value="5">Then, we plot a pie chart for these two groups. The result looks as follows:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_02.png"/></figure>
    <p class="packt_figref">Figure 2.2: Pie chart of Conversion versus No Conversion</p>
    <p class="normal">As is clearly noticeable, the majority of the leads did not convert. Only 14.3% of the qualified leads converted into a policy renewal or responded <em class="italic">Yes</em> to the renewal offer. This is typically the case when it comes to marketing. Typically, conversion rates are very low, and even low single-digit percentage conversion rates are not abnormal in digital marketing.</p>
    <p class="normal">The chart itself is insightful<a id="_idIndexMarker122"/> in a way that it helps business stakeholders to understand what percentage of the targeted leads converted, but this is not enough. In order to have a full grasp of what the data tells us about the conversion rate, we need to look at various angles.</p>
    <h3 class="heading-" id="_idParaDest-51">Demographics and conversion rate</h3>
    <p class="normal">One way to dive deeper<a id="_idIndexMarker123"/> to generate more insights into the conversion rate is to look at the demographics of customers and how it may affect the conversion rates. For example, in our data, there is a column called <code class="inlineCode">income</code>. We can break down the conversion rates across different income levels to see what kind of story the data may tell us about the relationship between income and conversions.</p>
    <p class="normal">In our example data, the reported income ranges from $0 to $100,000. For easier understanding and better visualization, we are going to bucket this into 10 income levels and examine the relationship<a id="_idIndexMarker124"/> between income and conversions, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">df[<span class="hljs-string">"income_category"</span>] = df[<span class="hljs-string">"Income"</span>].apply(
    <span class="hljs-keyword">lambda</span> x: <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> x == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> x//<span class="hljs-number">10000</span>
)
income_conversion = df.groupby(<span class="hljs-string">"income_category"</span>)[<span class="hljs-string">"conversion"</span>].mean() * <span class="hljs-number">100</span>
ax = (
    income_conversion
).plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>,
)
ax.set_xticklabels([<span class="hljs-string">"$0"</span> <span class="hljs-keyword">if</span> x == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">f"$</span><span class="hljs-subst">{x}</span><span class="hljs-string">0-</span><span class="hljs-subst">{x+</span><span class="hljs-number">1</span><span class="hljs-subst">}</span><span class="hljs-string">0k"</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> income_conversion.index])
ax.set_ylabel(<span class="hljs-string">"Conversion Rate (%)"</span>)
ax.set_xlabel(<span class="hljs-string">"Reported Income"</span>)
ax.set_title(<span class="hljs-string">"Conversion Rate across Reported Income"</span>)
</code></pre>
    <p class="normal">The output of this code looks as follows:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_03.png"/></figure>
    <p class="packt_figref">Figure 2.3: Bar plot of conversion rates across different income bands</p>
    <p class="normal">As you can see from this bar plot, people with an income between $10k and $20k have the highest conversion rate. Another interesting point to note is this chart shows a bimodal distribution, where one is at $10–20k and another is at $70–80k. Lastly, customers with a reported income<a id="_idIndexMarker125"/> of $0 seem to show the lowest conversion rate.</p>
    <div class="packt_tip">
      <p class="normal">Try breaking down the conversion rates with other demographic variables, such as gender, education, and marital status!</p>
    </div>
    <h3 class="heading-" id="_idParaDest-52">Sales channel and conversion rate</h3>
    <p class="normal">How customers are contacted<a id="_idIndexMarker126"/> can also be a critical factor affecting conversions. We can break down the conversion rates based on <code class="inlineCode">Sales Channel</code>, as in the following code, to understand the relationship between sales channels and conversion rates:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = (
    df.groupby(<span class="hljs-string">"Sales Channel"</span>)[<span class="hljs-string">"conversion"</span>].mean() * <span class="hljs-number">100</span>
).plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>
)
ax.set_ylabel(<span class="hljs-string">"Conversion Rate (%)"</span>)
ax.set_title(<span class="hljs-string">"Conversion Rate per Sales Channel"</span>)
</code></pre>
    <p class="normal">The resulting bar chart looks as follows:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_04.png"/></figure>
    <p class="packt_figref">Figure 2.4: Bar plot of conversion rates across different sales channels</p>
    <p class="normal">As this chart shows, the chance<a id="_idIndexMarker127"/> of conversion is the highest when a customer is reached out to by an <code class="inlineCode">Agent</code>. The other three channels, <code class="inlineCode">Branch</code><em class="italic">, </em><code class="inlineCode">Call Center</code><em class="italic">,</em> and <code class="inlineCode">Web</code>, have similar chances when it comes to conversion rates. This may be related to the personal connections that agents have with customers and how personal interactions affect a customer’s tendency to convert.</p>
    <p class="normal">Not so surprisingly, the composition of conversions across different sales channels, it looks like the following:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_05.png"/></figure>
    <p class="packt_figref">Figure 2.5: Pie chart of conversions across different sales channels</p>
    <p class="normal">The code to generate<a id="_idIndexMarker128"/> this pie chart looks as follows:</p>
    <pre class="programlisting code"><code class="hljs-code">sales_channel_count = df.groupby(<span class="hljs-string">"Sales Channel"</span>)[<span class="hljs-string">"conversion"</span>].<span class="hljs-built_in">sum</span>()
ax = sales_channel_count.reset_index().plot.pie(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    y=<span class="hljs-string">"conversion"</span>,
    autopct=<span class="hljs-string">'%1.1f%%'</span>,
    legend=<span class="hljs-literal">False</span>,
    labels=sales_channel_count.index,
    explode=[<span class="hljs-number">0.02</span>]*df[<span class="hljs-string">"Sales Channel"</span>].nunique()
)
ax.set_ylabel(<span class="hljs-literal">None</span>)
</code></pre>
    <p class="normal">This pie chart suggests that, out of the conversions, a little above 50% are through <code class="inlineCode">Agent</code> interactions, <code class="inlineCode">Branch</code> comes next, and then <code class="inlineCode">Call Center</code> and <code class="inlineCode">Web</code> have similar impacts on the number of conversion contributions.</p>
    <p class="normal">In summary, looking at conversion rates from different angles tells us different stories about them. It informs us that the conversions are strong for low ($10–20k) and high ($70–80k) income populations, but weak in mid-income ($40–50k) and $0 reported income populations. It also gives us insights into which marketing channels worked the best for this renewal marketing campaign, showing that Agent reachouts worked the best among the four channels. Based on these KPI analyses, we are better informed and armed for what aspects to improve<a id="_idIndexMarker129"/> and what aspects are known to work well.</p>
    <div class="packt_tip">
      <p class="normal">Try diving deeper into the conversion rates not only with other variables, such as renew offer type and vehicle class, but also with multiple variables, such as sales channel and state or education and policy and vehicle size.</p>
      <p class="normal">Bring the hidden insights to the surface!</p>
    </div>
    <h2 class="heading-2" id="_idParaDest-53">CLV</h2>
    <p class="normal">As mentioned previously, CLV<a id="_idIndexMarker130"/> is one of the key measures to calculate ROI, as it tells us the potential revenue each customer brings. In this section, we will utilize the pre-computed CLV that was given within the dataset. However, we will discuss in depth how to build and forecast CLV for each customer in <em class="chapterRef">Chapter 8</em>. For the sake of focusing on the KPIs and deriving actionable items and insights from KPIs, we will use the given CLV in this chapter.</p>
    <h3 class="heading-" id="_idParaDest-54">Overall CLV</h3>
    <p class="normal">Using the <code class="inlineCode">pandas</code> library, there are multiple ways<a id="_idIndexMarker131"/> to understand the distribution of CLV. One way is to use the <code class="inlineCode">describe</code> function of a DataFrame as in the following:</p>
    <pre class="programlisting code"><code class="hljs-code">df[<span class="hljs-string">"Customer Lifetime Value"</span>].describe()
</code></pre>
    <p class="normal">This code will show the distribution as in the following output:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_06.png"/></figure>
    <p class="packt_figref">Figure 2.6: Distribution of CLV</p>
    <p class="normal">As you can see, the <code class="inlineCode">describe</code> function<a id="_idIndexMarker132"/> gives us high-level distribution information about the <code class="inlineCode">Customer Lifetime Value</code> column, where the average CLV is $8,004.94 and the median is $5,780.18. Another way to look at the distribution is with a box plot, using the <code class="inlineCode">plot.box</code> function of a DataFrame, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">df[<span class="hljs-string">"Customer Lifetime Value"</span>].plot.box()
</code></pre>
    <p class="normal">This gives us the following output:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_07.png"/></figure>
    <p class="packt_figref">Figure 2.7: Box plot of CLV</p>
    <p class="normal">As shown from the box plot above, there<a id="_idIndexMarker133"/> is a very long tail or group of outliers. This coincides with the output of the <code class="inlineCode">describe</code> function, where the mean was much higher than the median, which suggests there is a long tail. This skewness in the data is also visible from the histogram as follows:</p>
    <pre class="programlisting code"><code class="hljs-code">ax=df[<span class="hljs-string">"Customer Lifetime Value"</span>].hist(bins=<span class="hljs-number">25</span>)
plt.show()
</code></pre>
    <p class="normal">We then see the following output:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_08.png"/></figure>
    <p class="packt_figref">Figure 2.8: Histogram of CLV</p>
    <p class="normal">As can be seen from<a id="_idIndexMarker134"/> the histogram chart, there is a long tail to the right, which corresponds with the outliers shown in the previous box plot and the output of the descriptive statistics.</p>
    <p class="normal">From a marketing and business standpoint, this signifies that most customers will have a lifetime value below $10,000 and there will be a subset of high-profile customers with lifetime values above $10,000. As these groups will behave and react very differently to different marketing strategies, it will be wise to consider personalizing the marketing messages and strategies to different groups of customers. We will dive deeper into personalized marketing in <em class="chapterRef">Chapter 7</em>; however, it is critical to have a good understanding that the CLV and other KPIs<a id="_idIndexMarker135"/> shown in this section show potential different groups that need to be targeted with different marketing messages.</p>
    <h3 class="heading-" id="_idParaDest-55">Geolocation and CLV</h3>
    <p class="normal">Not only should we look<a id="_idIndexMarker136"/> at the overall distribution of CLV when analyzing the lifetime values of customers but we should also look at it from various angles. One angle can be geolocation and how geolocation affects the CLV. In the example insurance marketing dataset, there is a column called <code class="inlineCode">State</code>. We can separately look at CLVs based on different states, using the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = df.groupby(<span class="hljs-string">"State"</span>)[<span class="hljs-string">"Customer Lifetime Value"</span>].mean().plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>
)
ax.bar_label(ax.containers[<span class="hljs-number">0</span>], fmt=<span class="hljs-string">'$%.1f'</span>)
ax.set_ylabel(<span class="hljs-string">"Customer Lifetime Value ($)"</span>)
ax.set_title(<span class="hljs-string">"CLV per State"</span>)
</code></pre>
    <p class="normal">The resulting bar chart looks like the following:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_09.png"/></figure>
    <p class="packt_figref">Figure 2.9: Bar plot of CLVs across different states</p>
    <p class="normal">We have used the <code class="inlineCode">groupby</code> function<a id="_idIndexMarker137"/> to group the data by the <code class="inlineCode">State</code> column and took the average of <code class="inlineCode">Customer Lifetime Value</code>. Using the <code class="inlineCode">plot.bar</code> function, we can visualize the CLVs across different states. Although the average CLVs are similar across different states, <code class="inlineCode">Oregon</code> has the highest average CLV and <code class="inlineCode">Arizona</code> has the lowest. </p>
    <p class="normal">As areas within the same state may also differ, we can go a level deeper into analysis<a id="_idIndexMarker138"/> by breaking it down further by the types of areas with the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = df.groupby([
    <span class="hljs-string">"State"</span>, <span class="hljs-string">"Location Code"</span>
])[
    <span class="hljs-string">"Customer Lifetime Value"</span>
].mean().unstack().plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>
)
ax.set_ylabel(<span class="hljs-string">"Customer Lifetime Value ($)"</span>)
ax.set_title(<span class="hljs-string">"CLV per State"</span>)
</code></pre>
    <p class="normal">This gives us the following output:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_10.png"/></figure>
    <p class="packt_figref">Figure 2.10: Bar plot of CLVs across different states and locations</p>
    <p class="normal">Compared to the previous chart, we have now grouped<a id="_idIndexMarker139"/> by not only <code class="inlineCode">State</code> but also by <code class="inlineCode">Location</code><em class="italic"> </em><code class="inlineCode">Code</code>. This brings additional insights into how different types of area further affect the CLVs. Previously, we have seen that <em class="italic">Arizona</em> has the lowest overall CLV compared to other states; however, as this bar plot shows, the urban area of <code class="inlineCode">Arizona</code> has the highest CLV and the decrease in the CLV was mostly driven by the <code class="inlineCode">Rural</code> and <code class="inlineCode">Suburban</code> areas within <code class="inlineCode">Arizona</code>. Generally speaking, CLVs in urban areas are higher than in rural and suburban areas, except for <em class="italic">Oregon</em> and <em class="italic">Washington</em>. Rural areas within the <code class="inlineCode">Oregon</code> and <code class="inlineCode">Washington</code> states have higher CLVs than those of urban areas. As can be noted from this exercise, analyzing KPIs from different angles<a id="_idIndexMarker140"/> exposes different insights.</p>
    <h3 class="heading-" id="_idParaDest-56">Product and CLV</h3>
    <p class="normal">CLVs often differ by the products<a id="_idIndexMarker141"/> that customers purchase. We can examine this relationship in our dataset by looking at the <code class="inlineCode">Policy</code> column, which is an insurance product that customers have purchased:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = df.groupby(<span class="hljs-string">"Policy"</span>)[<span class="hljs-string">"Customer Lifetime Value"</span>].mean().plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>
)
ax.bar_label(ax.containers[<span class="hljs-number">0</span>], fmt=<span class="hljs-string">'$%.1f'</span>, fontsize=<span class="hljs-number">6</span>)
ax.set_ylabel(<span class="hljs-string">"Customer Lifetime Value ($)"</span>)
ax.set_title(<span class="hljs-string">"CLV per Product"</span>)
</code></pre>
    <p class="normal">This gives us the following bar plot:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_11.png"/></figure>
    <p class="packt_figref">Figure 2.11: Bar plot of CLV per product</p>
    <p class="normal">By grouping by <code class="inlineCode">Policy</code><code class="inlineCode"><a id="_idIndexMarker142"/></code> and averaging CLV, we get the distribution as shown in the previous chart. It is noticeable that customers with <code class="inlineCode">Special</code> <code class="inlineCode">L3</code> policies or products have the highest CLV and those with <code class="inlineCode">Corporate L2</code> have the lowest CLV. As the types of products that customers purchase are inherently related to the needs and appetites of the customers, they should be taken into consideration when targeting different customer bases. Having personalized marketing strategies using predictive ML <a id="_idIndexMarker143"/>modeling can be a good solution to target different customer bases more efficiently.</p>
    <h2 class="heading-2" id="_idParaDest-57">CPA</h2>
    <p class="normal">As mentioned previously, CPA<a id="_idIndexMarker144"/> is another critical piece to measure marketing effectiveness. Costs spent for acquiring new customers can vary by business. Some of the common marketing costs for new customer acquisition are for advertisements via different channels, such as emails, mail, TV, social media, promotional merchandise, telemarketing and customer service calls, and other tools, such as website promotions, chatbots, and customer relationship management systems.</p>
    <p class="normal">As we have seen when analyzing conversion rate, in our example with the insurance marketing dataset, four channels were used to market insurance renewal offers: <code class="inlineCode">Agent</code>, <code class="inlineCode">Branch</code><em class="italic">, </em><code class="inlineCode">Call Center</code>, and <code class="inlineCode">Web</code>. Unfortunately, the data in this example does not have the costs spent for each sales channel; thus, we are going to make some assumptions.</p>
    <p class="normal">Let us assume it costs about <em class="italic">$200</em> for each <code class="inlineCode">Agent</code> sale, <em class="italic">$85</em> for each <code class="inlineCode">Branch</code> sale, <em class="italic">$30</em> for each <code class="inlineCode">Call</code> <code class="inlineCode">Center</code> sale, and <em class="italic">$2</em> for each <code class="inlineCode">Web</code> sale. In the real-world, you would track the marketing spending for each marketing channel you use. For example, you would need to know how much it costs per minute for each sales agent call, how much it costs for each online ad click, and how much it costs for each email or direct mail sent. With this assumption, we are going to assign <em class="italic">Estimated Acquisition Cost</em> for each customer as in the following:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
cost_distr = {
    <span class="hljs-string">"Agent"</span>: {<span class="hljs-string">"avg"</span>: <span class="hljs-number">200</span>, <span class="hljs-string">"std"</span>: <span class="hljs-number">40</span>},
    <span class="hljs-string">"Branch"</span>: {<span class="hljs-string">"avg"</span>: <span class="hljs-number">85</span>, <span class="hljs-string">"std"</span>: <span class="hljs-number">17</span>},
    <span class="hljs-string">"Call Center"</span>: {<span class="hljs-string">"avg"</span>: <span class="hljs-number">30</span>, <span class="hljs-string">"std"</span>: <span class="hljs-number">6</span>},
    <span class="hljs-string">"Web"</span>: {<span class="hljs-string">"avg"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"std"</span>: <span class="hljs-number">0.5</span>}
}
df[<span class="hljs-string">"est_acquisition_cost"</span>] = df[<span class="hljs-string">"Sales Channel"</span>].apply(
    <span class="hljs-keyword">lambda</span> x: np.random.normal(cost_distr[x][<span class="hljs-string">"avg"</span>], cost_distr[x][<span class="hljs-string">"std"</span>], <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]
)
</code></pre>
    <p class="normal">As you can see from this code, we create a <code class="inlineCode">cost_distr</code> dictionary with our assumptions for the costs of each marketing channel. Then, we use the <code class="inlineCode">numpy</code> library’s <code class="inlineCode">random.normal</code> function to generate random numbers for each record from our assumptions and insert them into a column, <code class="inlineCode">est_acquisition_cost</code>, which will be used in the following subsections:</p>
    <pre class="programlisting code"><code class="hljs-code">df[<span class="hljs-string">"est_acquisition_cost"</span>].describe()
</code></pre>
    <p class="normal">This is one way to create synthetic data from an assumed distribution. The resulting distribution should look something like the following:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_12.png"/></figure>
    <p class="packt_figref">Figure 2.12: Distribution of the generated estimated acquisition cost</p>
    <p class="normal">Given that these numbers are randomly generated from normal distributions, the exact numbers will vary each time this code<a id="_idIndexMarker145"/> is run. However, the overall distribution will look similar to this output.</p>
    <h3 class="heading-" id="_idParaDest-58">Overall CPA</h3>
    <p class="normal">As we have discussed in the previous section, CPA is calculated as the total marketing cost divided by the total number of conversions, which can be done in Python, as in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">campaign_cost = df[<span class="hljs-string">"est_acquisition_cost"</span>].<span class="hljs-built_in">sum</span>() / df[<span class="hljs-string">"conversion"</span>].<span class="hljs-built_in">sum</span>()
</code></pre>
    <p class="normal">We simply sum across all the values in the <code class="inlineCode">est_acquisition_cost</code> column, which will give us the total marketing spend, and divide that sum by the number of conversions, which is done by summing across all values in the <code class="inlineCode">conversion</code> column:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in">print</span>(<span class="hljs-string">f"$</span><span class="hljs-subst">{campaign_cost:</span><span class="hljs-number">.1</span><span class="hljs-subst">f}</span><span class="hljs-string">"</span>)
</code></pre>
    <pre class="programlisting con"><code class="hljs-con">$739.8
</code></pre>
    <p class="normal">The value of <code class="inlineCode">campaign_cost</code> should be similar to <code class="inlineCode">$739.8</code>.</p>
    <p class="normal">At the time of writing, the value of <code class="inlineCode">campaign_cost</code> was <code class="inlineCode">$739.8</code>; however, given the nature of randomness when we created synthetic data<a id="_idIndexMarker146"/> with our assumptions, this value may differ each time you run but should be in the ballpark.</p>
    <h3 class="heading-" id="_idParaDest-59">Sales channel and CPA</h3>
    <p class="normal">Due to the fact that different sales<a id="_idIndexMarker147"/> and marketing channels have different costs, CPA differs by channel. We can also observe this in our data. In order to calculate CPAs per channel, we simply need to calculate the total marketing cost for each channel and divide them by the number of conversions for each channel, as in the following code example:</p>
    <pre class="programlisting code"><code class="hljs-code">channel_cpa = (
df.groupby(<span class="hljs-string">"Sales Channel"</span>)[<span class="hljs-string">"est_acquisition_cost"</span>].<span class="hljs-built_in">sum</span>()
/
df.groupby(<span class="hljs-string">"Sales Channel"</span>)[<span class="hljs-string">"conversion"</span>].<span class="hljs-built_in">sum</span>()
)
</code></pre>
    <p class="normal">In this code, we first apply the <code class="inlineCode">groupby</code> function to the <code class="inlineCode">Sales Channel</code> column and sum over the <code class="inlineCode">est_acquisition_cost</code> column. Then, we apply the <code class="inlineCode">groupby</code> function to the <code class="inlineCode">Sales Channel</code> column again, but this time, sum over the <code class="inlineCode">conversion</code> column. When we divide the former <code class="inlineCode">pandas Series</code> by the latter <code class="inlineCode">pandas Series</code>, it divides the sum of <code class="inlineCode">est_acquisition_cost</code> by the sum of <code class="inlineCode">conversion</code> for each <code class="inlineCode">Sales Channel</code> column:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = (
    channel_cpa
).plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>
)
ax.bar_label(ax.containers[<span class="hljs-number">0</span>], fmt=<span class="hljs-string">'$%.1f'</span>)
ax.set_ylabel(<span class="hljs-string">"Cost per Acquisition ($)"</span>)
ax.set_title(<span class="hljs-string">"CPA per Sales Channel"</span>)
</code></pre>
    <p class="normal">The bar chart with the newly created variable <code class="inlineCode">channel_cpa</code> looks like the following:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_13.png"/></figure>
    <p class="packt_figref">Figure 2.13: Bar plot of CPAs across different sales channels</p>
    <p class="normal">As expected, the CPA is the highest<a id="_idIndexMarker148"/> with the <code class="inlineCode">Agent</code> channel and the lowest with the <code class="inlineCode">Web</code> channel. Despite the fact that the conversion rate is the highest from the <code class="inlineCode">Agent</code> channel, as we saw in the previous section where we discussed conversion rates across different sales channels, the <strong class="keyWord">CPA</strong> is still the highest. This is a good example to show that managing the cost of marketing spending is as important<a id="_idIndexMarker149"/> as having high conversion rates.</p>
    <h3 class="heading-" id="_idParaDest-60">Promotions and CPA</h3>
    <p class="normal">Similar to how CPAs differ <a id="_idIndexMarker150"/>by sales channels, CPAs may also differ by the types of marketing promotions. We can observe this from our dataset as well. In order to calculate the CPAs for each promotion, you can use the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">promo_cpa = (
df.groupby(<span class="hljs-string">"Renew Offer Type"</span>)[<span class="hljs-string">"est_acquisition_cost"</span>].<span class="hljs-built_in">sum</span>()
/
df.groupby(<span class="hljs-string">"Renew Offer Type"</span>)[<span class="hljs-string">"conversion"</span>].<span class="hljs-built_in">sum</span>()
)
</code></pre>
    <p class="normal">Here, we group by the <code class="inlineCode">Renew Offer Type</code> column and sum across the <code class="inlineCode">est_acquisition_cost</code> and <code class="inlineCode">conversion</code> columns, then divide the former by the latter. The resulting bar plot looks as follows:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = (
    promo_cpa
).plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>
)
ax.bar_label(ax.containers[<span class="hljs-number">0</span>], fmt=<span class="hljs-string">'$%.1f'</span>)
ax.set_ylabel(<span class="hljs-string">"Cost per Acquisition ($)"</span>)
ax.set_title(<span class="hljs-string">"CPA per Promotion"</span>)
</code></pre>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_14.png"/></figure>
    <p class="packt_figref">Figure 2.14: Bar plot of CPAs across different promotions</p>
    <p class="normal">There are two things<a id="_idIndexMarker151"/> that stand out from this chart. One is that the CPA for <code class="inlineCode">Offer3</code> is the highest and the other is that the CPA for <code class="inlineCode">Offer4</code> is not shown. The reason why the CPA for <code class="inlineCode">Offer4</code> is not shown in this chart is that there were no conversions for <code class="inlineCode">Offer4</code>. </p>
    <p class="normal">This can be found when you dive deeper into the conversion rates for each promotion, as in the following:</p>
    <pre class="programlisting code"><code class="hljs-code">df.groupby("<span class="hljs-string">Renew Offer Type</span>")["<span class="hljs-string">conversion</span>"].mean()
</code></pre>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_15.png"/></figure>
    <p class="packt_figref">Figure 2.15: Conversion rates across different renewal offer types</p>
    <p class="normal">Although this answers<a id="_idIndexMarker152"/> why the CPA for <code class="inlineCode">Offer4</code> was not shown in the previous bar plot, as there was no conversion, this still does not fully answer the reason why the CPA for <code class="inlineCode">Offer3</code> was so high as there still are some conversions. What is more interesting is that the total marketing spend for <code class="inlineCode">Offer3</code> was the second lowest among the four promotions, as shown in the chart generated using the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = df.groupby(<span class="hljs-string">"Renew Offer Type"</span>)[<span class="hljs-string">"est_acquisition_cost"</span>].<span class="hljs-built_in">sum</span>().plot.bar(
    figsize=(<span class="hljs-number">5</span>,<span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>
)
ax.bar_label(ax.containers[<span class="hljs-number">0</span>], fmt=<span class="hljs-string">'$%.1f'</span>)
ax.set_ylabel(<span class="hljs-string">"Total Cost ($)"</span>)
ax.set_title(<span class="hljs-string">"Total Cost per Promotion"</span>)
</code></pre>
    <p class="normal">Here is the bar plot:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_16.png"/></figure>
    <p class="packt_figref">Figure 2.16: Bar plot of total costs across different promotions</p>
    <p class="normal">This is a good example of how a low conversion rate<a id="_idIndexMarker153"/> offsets the low marketing spend, and vice versa. <code class="inlineCode">Offer1</code> has the highest marketing spend and close to 3 times more spending than <code class="inlineCode">Offer3</code>, so the high conversion rate of <code class="inlineCode">Offer1</code> offsets the cost of marketing, which results in a much lower CPA than <code class="inlineCode">Offer3</code>. On the other hand, <code class="inlineCode">Offer3</code> has the second lowest marketing spend but has the highest CPA, because the low conversion rate of <code class="inlineCode">Offer3</code> offsets the low marketing spend. This signifies the necessity of analyzing KPIs in various aspects and understanding the key factors in the rise and fall of certain KPIs.</p>
    <h2 class="heading-2" id="_idParaDest-61">ROI</h2>
    <p class="normal">We have come a long way <a id="_idIndexMarker154"/>to finally be able to compute the ROI of our marketing initiative. Those conversion rates, CLVs, and CPAs we have analyzed so far will be combined to get the ROI and decide if the marketing money was well spent.</p>
    <h2 class="heading-2" id="_idParaDest-62">Overall ROI</h2>
    <p class="normal">In a nutshell, <strong class="keyWord">ROI</strong> is total returns or earnings divided by total spending. One way to approach it within our example is to sum across <code class="inlineCode">Customer Lifetime Value</code> for those customers that converted and divide it by the sum across the <code class="inlineCode">est_acquisition_cost</code> column, as in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">campaign_cost = df[<span class="hljs-string">"est_acquisition_cost"</span>].<span class="hljs-built_in">sum</span>()
converted_clv = (df[<span class="hljs-string">"Customer Lifetime Value"</span>] * df[<span class="hljs-string">"conversion"</span>]).<span class="hljs-built_in">sum</span>()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Total CLV: $</span><span class="hljs-subst">{converted_clv:,</span><span class="hljs-number">.02</span><span class="hljs-subst">f}</span><span class="hljs-string">"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Total Cost: $</span><span class="hljs-subst">{campaign_cost:,</span><span class="hljs-number">.02</span><span class="hljs-subst">f}</span><span class="hljs-string">"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Overall ROI: </span><span class="hljs-subst">{(converted_clv-campaign_cost)/campaign_cost:</span><span class="hljs-number">.01</span><span class="hljs-subst">f}</span><span class="hljs-string">x"</span>)
</code></pre>
    <p class="normal">The output is as follows:</p>
    <pre class="programlisting con"><code class="hljs-con">Total CLV: $10,274,171.74
Total Cost: $972,130.58
Overall ROI: 9.6x
</code></pre>
    <p class="normal">As this output shows, the total CLV added from the converted customers is about $10.3M and the total marketing spend is about $968K within our example. This gives us an ROI of 9.6x or 960%, which suggests that the value addition from this marketing initiative outweighs the spending by multiples of 9.6. If this were a real-world marketing campaign with such performances, this would have been a stellar marketing initiative. Typically, an ROI of 5:1 is a solid outcome, and anything higher is considered great. An ROI of 2:1 or below is considered disappointing.</p>
    <p class="normal">Another effective way of visualizing this KPI is to visually show value inflows vs. outflows. One way of showing this is using a waterfall chart, as shown in the following:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_17.png"/></figure>
    <p class="packt_figref">Figure 2.17: Waterfall chart of Net Return</p>
    <p class="normal">As you can imagine, you can break this down by factors<a id="_idIndexMarker155"/> contributing to value additions and subtractions. For example, you can visualize value additions by each sales channel and how it sums up to the total CLV added, and value subtractions by each sales channel and how it sums up to the total marketing cost. Waterfall charts are a great way to visualize value additions and subtractions and show the net return in one view. The following code can be used to visualize the waterfall chart using the <code class="inlineCode">plotly</code> library:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> plotly.graph_objects <span class="hljs-keyword">as</span> go
fig = go.Figure(
    go.Waterfall(
        name = <span class="hljs-string">"Waterfall"</span>,
        orientation = <span class="hljs-string">"v"</span>,
        measure = [<span class="hljs-string">"relative"</span>, <span class="hljs-string">"relative"</span>, <span class="hljs-string">"total"</span>],
        x = [<span class="hljs-string">"Total CLV"</span>, <span class="hljs-string">"Total Marketing Cost"</span>, <span class="hljs-string">"Net Return"</span>],
        textposition = <span class="hljs-string">"outside"</span>,
        text = [
            <span class="hljs-string">f"$</span><span class="hljs-subst">{converted_clv:</span><span class="hljs-number">.01</span><span class="hljs-subst">f}</span><span class="hljs-string">"</span>,
            <span class="hljs-string">f"$</span><span class="hljs-subst">{campaign_cost:</span><span class="hljs-number">.01</span><span class="hljs-subst">f}</span><span class="hljs-string">"</span>,
            <span class="hljs-string">f"Return: $</span><span class="hljs-subst">{converted_clv-campaign_cost:</span><span class="hljs-number">.1</span><span class="hljs-subst">f}</span><span class="hljs-string"> (</span><span class="hljs-subst">{(converted_clv-campaign_cost)/campaign_cost:</span><span class="hljs-number">.01</span><span class="hljs-subst">f}</span><span class="hljs-string">x)"</span>
        ],
        y = [converted_clv, -campaign_cost, <span class="hljs-number">0</span>],
        connector = {<span class="hljs-string">"line"</span>:{<span class="hljs-string">"color"</span>:<span class="hljs-string">"rgb(63, 63, 63)"</span>}},
    )
)
fig.update_layout(
    height=<span class="hljs-number">500</span>,
    width=<span class="hljs-number">500</span>,
    title = <span class="hljs-string">"ROI"</span>,
    title_x = 0.5,
    showlegend = <span class="hljs-literal">True</span>
)
fig.show()
</code></pre>
    <p class="normal">As you can see<a id="_idIndexMarker156"/> from this code, you can use the <code class="inlineCode">Waterfall</code> object within the <code class="inlineCode">plotly</code> library to create a waterfall chart. The key parameters here are:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">measure</code>: This is an array of the types of values. Use <code class="inlineCode">relative</code> to show the relative values, such as additions and subtractions, and use <code class="inlineCode">total</code> to calculate the sum value.</li>
      <li class="bulletList"><code class="inlineCode">x</code>: This is an array of x coordinates, where it is an array of labels of each addition and subtraction.</li>
      <li class="bulletList"><code class="inlineCode">y</code>: This is an array of y coordinates, where it is an array of addition and subtraction values.</li>
    </ul>
    <div class="packt_tip">
      <p class="normal">Waterfall charts<a id="_idIndexMarker157"/> can be an intuitive and efficient way of showing value ins and outs. Try breaking it down to further show factors contributing to value additions and subtractions!</p>
    </div>
    <h3 class="heading-" id="_idParaDest-63">ROI per sales channel</h3>
    <p class="normal">As briefly mentioned<a id="_idIndexMarker158"/> in the previous subsection, analyzing which factor contributes to ROI in which way is important to help understand which marketing strategies or channels work the most efficiently and which do not. The first angle we are going to look at for ROI is <em class="italic">Sales Channel</em>. The first thing we are going to do is calculate the net return and compute the ROI per sales channel, as in the following:</p>
    <pre class="programlisting code"><code class="hljs-code">df[<span class="hljs-string">"</span><span class="hljs-string">return"</span>] = (
df[<span class="hljs-string">"Customer Lifetime Value"</span>] * df[<span class="hljs-string">"conversion"</span>]
) - df[<span class="hljs-string">"est_acquisition_cost"</span>]
channel_roi = (
df.groupby(<span class="hljs-string">"Sales Channel"</span>)[<span class="hljs-string">"return"</span>].<span class="hljs-built_in">sum</span>()
/
df.groupby(<span class="hljs-string">"Sales Channel"</span>)[<span class="hljs-string">"est_acquisition_cost"</span>].<span class="hljs-built_in">sum</span>()
)
</code></pre>
    <p class="normal">This code creates a new variable, named <code class="inlineCode">return</code>, which is the CLV<a id="_idIndexMarker159"/> minus acquisition cost, and for those customers who have not converted, it is simply a negative acquisition cost, as there is no value addition. Then, the ROI per channel is calculated by grouping it by the <code class="inlineCode">Sales Channel</code> column and dividing the sum of <code class="inlineCode">return</code> by the sum of <code class="inlineCode">est_acquisition_cost</code>. In order to visualize the ROI per sales channel, the following code can be used:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = (
    channel_roi
).plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>
)
ax.bar_label(ax.containers[<span class="hljs-number">0</span>], fmt=<span class="hljs-string">'</span><span class="hljs-string">%.1fx'</span>)
ax.set_ylabel(<span class="hljs-string">"Return on Investment (multiple)"</span>)
ax.set_title(<span class="hljs-string">"ROI per Sales Channel"</span>)
</code></pre>
    <p class="normal">The resulting chart looks as follows:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_18.png"/></figure>
    <p class="packt_figref">Figure 2.18: Bar plot of ROI across different sales channels</p>
    <p class="normal">This bar plot suggests<a id="_idIndexMarker160"/> the ROI from the <code class="inlineCode">Web</code> channel is the highest, followed by the <code class="inlineCode">Call Center</code> channel, and the <code class="inlineCode">Agent</code> channel is the lowest. As you can imagine, ROI is negatively correlated with CPA and positively correlated with CLV.</p>
    <p class="normal">The low CPA of the <code class="inlineCode">Web</code> channel would have been the highest contributing factor for this extremely high ROI, given that the conversion rate for this sales channel was similar to other channels. On the other hand, the high CPA of the <code class="inlineCode">Agent</code> channel would have been the most critical factor for a relatively low ROI, as its conversion rate was the highest among the four channels. As you can see, ROI and its breakdowns are insightful KPIs to gain knowledge on how best to manage marketing costs and generate returns.</p>
    <h3 class="heading-" id="_idParaDest-64">ROI per promotion</h3>
    <p class="normal">One last factor we<a id="_idIndexMarker161"/> will look at to understand the dynamics of ROIs across different angles is the promotion types. We will look at how <code class="inlineCode">Renew Offer Type</code> affects the ROI, as shown in the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">promo_roi = (
    df.groupby(<span class="hljs-string">"Renew Offer Type"</span>)[<span class="hljs-string">"return"</span>].<span class="hljs-built_in">sum</span>()
    /
    df.groupby(<span class="hljs-string">"Renew Offer Type"</span>)[<span class="hljs-string">"est_acquisition_cost"</span>].<span class="hljs-built_in">sum</span>()
)
</code></pre>
    <p class="normal">As shown in the code, we group by the <code class="inlineCode">Renew Offer Type</code> column and divide the sum of <code class="inlineCode">return</code> by the sum of <code class="inlineCode">est_acquisition_cost</code>. This can be visualized in a bar chart using the following code:</p>
    <pre class="programlisting code"><code class="hljs-code">ax = (
    promo_roi
).plot.bar(
    figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>),
    rot=<span class="hljs-number">45</span>,
    color=(promo_roi &gt; <span class="hljs-number">0</span>).<span class="hljs-built_in">map</span>({<span class="hljs-literal">True</span>: <span class="hljs-string">'cornflowerblue'</span>, <span class="hljs-literal">False</span>: <span class="hljs-string">'salmon'</span>})
)
ax.bar_label(ax.containers[<span class="hljs-number">0</span>], fmt=<span class="hljs-string">'%.1fx'</span>)
ax.set_ylabel(<span class="hljs-string">"Return on Investment (multiple)"</span>)
ax.set_title(<span class="hljs-string">"ROI per Promotion"</span>)
</code></pre>
    <p class="normal">We get a bar chart like this:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_19.png"/></figure>
    <p class="packt_figref">Figure 2.19: Bar chart of ROI among different offers</p>
    <p class="normal">This bar chart shows that <code class="inlineCode">Offer2</code> has the highest<a id="_idIndexMarker162"/> ROI, followed by <code class="inlineCode">Offer1</code>, and <code class="inlineCode">Offer4</code> is the lowest. As previously discovered, there were no conversions for <code class="inlineCode">Offer4</code>; thus, all the marketing spending was lost, resulting in a -100% return or -1x ROI.</p>
    <p class="normal">As expected from the previous discussion around CPA, <code class="inlineCode">Offer3</code> has the lowest ROI after <code class="inlineCode">Offer4</code>. This is likely due to the high CPA that <code class="inlineCode">Offer3</code> had, which negatively affected ROI. On the other hand, CPA for <code class="inlineCode">Offer2</code> was the lowest, which helped<a id="_idIndexMarker163"/> it to have the highest ROI among the promotion offers.</p>
    <h2 class="heading-2" id="_idParaDest-65">Correlations across KPIs</h2>
    <p class="normal">As we have seen so far, there are multiple factors<a id="_idIndexMarker164"/> contributing to ROI, which, in turn, necessitates conducting analyses from various points of view. We have examined the basics and the interpretations of KPIs that ultimately touch from the <em class="italic">Engagement</em> stage to the <em class="italic">Conversion</em> stage up until this section.</p>
    <p class="normal">Not only can we examine KPIs with a set of defined factors but we can also leverage a more data-driven and statistical approach to uncover the relationships between various metrics. One approach may be to analyze the correlations among KPIs, as well as between KPIs and other factors. A <em class="italic">heatmap</em> is a clever way to visualize<a id="_idIndexMarker165"/> these relationships and provide a more intuitive understanding of hidden relationships within the data. This analytical technique reveals how different KPIs are interconnected with each other as well as how individual factors are associated with the KPIs, offering strategic insights for optimizing marketing campaigns. The following code can be used to build a heatmap using our example data:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
correlation_matrix = df[[
    <span class="hljs-string">'Income'</span>, <span class="hljs-string">'Monthly Premium Auto'</span>,
    <span class="hljs-string">'Months Since Last Claim'</span>, <span class="hljs-string">'Months Since Policy Inception'</span>,
    <span class="hljs-string">'Number of Open Complaints'</span>, <span class="hljs-string">'Number of Policies'</span>, <span class="hljs-string">'Total Claim Amount'</span>,
    <span class="hljs-string">'conversion'</span>, <span class="hljs-string">'Customer Lifetime Value'</span>, <span class="hljs-string">'est_acquisition_cost'</span>, <span class="hljs-string">'return'</span>
]].corr()
plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">8</span>))
sns.heatmap(correlation_matrix, annot=<span class="hljs-literal">True</span>, fmt=<span class="hljs-string">".2f"</span>, cmap=<span class="hljs-string">'coolwarm'</span>, cbar=<span class="hljs-literal">True</span>)
plt.title(<span class="hljs-string">'Correlation Matrix Heatmap of Marketing KPIs'</span>)
plt.show()
</code></pre>
    <p class="normal">This code generates the following heatmap:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_20.png"/></figure>
    <p class="packt_figref">Figure 2.20: Heatmap of relationships among variables</p>
    <p class="normal">Notably, the correlation<a id="_idIndexMarker166"/> between <em class="italic">Monthly Premium Auto</em> and <em class="italic">Total Claim Amount</em> stands out with a coefficient of <strong class="keyWord">0.632</strong>, indicating a strong positive relationship. This suggests that as the monthly premium for auto insurance increases, so does the total claim amount. Such insights are invaluable for insurance companies looking to balance premium rates with claim costs to maximize profitability.</p>
    <p class="normal">Additionally, the <em class="italic">Income</em> and <em class="italic">Total Claim Amount</em> show a significant negative correlation of <strong class="keyWord">-0.355</strong>, highlighting that higher-income customers tend to have lower total claim amounts. This could imply that higher-income segments might represent a lower risk profile, potentially guiding targeted marketing<a id="_idIndexMarker167"/> strategies or premium adjustments.</p>
    <div class="packt_tip">
      <p class="normal">Be creative when analyzing and building KPIs and focus on building a good data story!</p>
    </div>
    <h1 class="heading-1" id="_idParaDest-66">Tracking marketing performance with KPIs</h1>
    <p class="normal">Computing and building KPIs<a id="_idIndexMarker168"/> is one key aspect of decoding<a id="_idIndexMarker169"/> marketing performances, but staying on top of the progressions and changes in KPIs is another equally important aspect of having a good grasp of your marketing performance. There are numerous ways to visualize KPIs and countless ways of tracking and sharing the KPIs with key stakeholders. In this section, we are going to share some of the common approaches to visualizations and ongoing KPI tracking.</p>
    <h2 class="heading-2" id="_idParaDest-67">Choosing the right visualization for KPIs</h2>
    <p class="normal">When presenting KPI data, the choice of visualization<a id="_idIndexMarker170"/> plays a crucial role in conveying<a id="_idIndexMarker171"/> insights effectively. Here are some guidelines to help choose the most appropriate type of visualization:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Bar charts</strong>: Ideal for comparing quantities<a id="_idIndexMarker172"/> across distinct categories, such as sales performance across different regions or products.</li>
      <li class="bulletList"><strong class="keyWord">Pie charts</strong>: For illustrating a composition<a id="_idIndexMarker173"/> or proportion of a whole, like market share distribution.</li>
      <li class="bulletList"><strong class="keyWord">Scatter plots</strong>: Use these to explore<a id="_idIndexMarker174"/> relationships between two variables, such as ad spend versus sales revenue.</li>
      <li class="bulletList"><strong class="keyWord">Line charts</strong>: Suitable for showing trends<a id="_idIndexMarker175"/> over time, such as website traffic growth or sales trends.</li>
      <li class="bulletList"><strong class="keyWord">Area charts</strong>: Typically used for comparing<a id="_idIndexMarker176"/> one or more series over time, or numeric values, such as website traffic across different channels.</li>
      <li class="bulletList"><strong class="keyWord">Heat maps</strong>: Effective for showcasing correlation<a id="_idIndexMarker177"/>s or patterns within large datasets, such as the relationship between various marketing KPIs.</li>
      <li class="bulletList"><strong class="keyWord">Funnel charts</strong>: Perfect for visualizing stages<a id="_idIndexMarker178"/> in a process, particularly useful for conversion rates across a marketing or sales funnel.</li>
      <li class="bulletList"><strong class="keyWord">Waterfall charts</strong>: Often used for showing<a id="_idIndexMarker179"/> additions and subtractions that sum up to the total, such as cash flows.</li>
    </ul>
    <h2 class="heading-2" id="_idParaDest-68">Ongoing KPI tracking</h2>
    <p class="normal">Now that we have experimented with how KPIs can be computed in Python given a dataset, you may wonder what is next. You may also question whether you must run your Python scripts each time you’d like to report KPI metrics. The approach generally taken and recommended<a id="_idIndexMarker180"/> for ongoing KPI tracking is utilizing accessible dashboards.</p>
    <div class="note">
      <p class="normal"><strong class="keyWord">What is a dashboard?</strong></p>
      <p class="normal">A dashboard<a id="_idIndexMarker181"/> is a way of showing diverse types of visuals of data, so that information can be shared and digested easily by stakeholders. It includes KPIs and other business metrics that need to be monitored. The scope of dashboards is not limited to tracking just marketing KPIs and it can be used in various lines of business, such as finance, operations, technology, customer service, and so forth.</p>
    </div>
    <p class="normal">In the business setting, dashboards are typically connected to data warehouses, so that the data being visualized is ingested directly from the data warehouse. This enables real-time or close-to-real-time updates to the dashboards. If the data in the data warehouse is updated, the visuals on the dashboards are automatically updated as well. Often, the data is complex, messy, or not easy to digest, so data ingestion pipelines are built to transform data into a more digestible structure. A typical flow of data to dashboards for tracking marketing KPIs looks as follows:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B30999_02_21.png"/></figure>
    <p class="packt_figref">Figure 2.21: Typical flow of data to dashboards</p>
    <p class="normal">A detailed discussion of data ETL pipeline development is out of scope for this book, but it is a process that <em class="italic">extracts</em> raw data from various sources, <em class="italic">transforms</em> it into a format that is easily usable, and <em class="italic">loads</em> it into data storage. The three key steps, extract, transform, and load, make up the acronym ETL. The outcome of an ETL pipeline for marketing data is easily digestible data for marketing KPI calculations, which are then summarized and visualized on the marketing dashboards. Some of the commonly used dashboard software products<a id="_idIndexMarker182"/> in the industry are Tableau, Power BI, and Looker.</p>
    <div class="packt_tip">
      <p class="normal">Good KPIs and dashboards should provoke meaningful action items and assist decision-making! Consider building goal-oriented KPIs and dashboards that are specific to each marketing goal and initiative.</p>
    </div>
    <h1 class="heading-1" id="_idParaDest-69">Summary</h1>
    <p class="normal">In this chapter, we have laid a concrete foundation for building data and AI/ML-driven marketing models and strategies. We have discussed commonly used marketing KPIs that not only help the business measure the marketing performance but also provoke action items for improvements based on the strengths and weaknesses discovered through multilevel analyses. Using an insurance product marketing dataset as an example, we have seen how these KPIs can be measured and analyzed with Python for further improvements and optimizations in future marketing efforts.</p>
    <p class="normal">We have also discussed how various dashboarding tools, such as Tableau, Power BI, and Looker, can be used for reusable real-time KPI tracking. As everyone emphasizes, AI/ML starts with data and deep exploratory analysis to decide what to train AI/ML models with and what to optimize for. The items and KPIs covered in this chapter will come in handy when designing and developing advanced AI/ML models for marketing in the future.</p>
    <p class="normal">In the next chapter, we are going to learn how we can utilize data science and machine learning algorithms to uncover the drivers behind marketing successes and failures. More specifically, we will discuss how regression analysis and models can be used to dissect the factors affecting marketing engagement, how tree-based models can be used to identify drivers behind conversions, and how causal inference can help understand the reasoning behind customer churn.</p>
    <h1 class="heading-1">Join our book’s Discord space</h1>
    <p class="normal">Join our Discord community to meet like-minded people and learn alongside more than 5000 members at:</p>
    <p class="normal"><a href="https://packt.link/genai"><span class="url">https://packt.link/genai</span></a></p>
    <p class="normal"><img alt="" src="../Images/QR_Code12856128601808671.png"/></p>
  </div>
</body></html>
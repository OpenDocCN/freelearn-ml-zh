- en: '*Chapter 5*: Predicting Boolean Values Using Binary Logistic Regression'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第五章*：使用二元逻辑回归预测布尔值'
- en: Binary logistic regression is one of the most widely used **Machine Learning**
    (**ML**) algorithms to predict the classification of future events and behaviors.
    It's used in different industries and contexts. Some variables that can be predicted
    with this technique are the propensity to buy a product and the probability of
    getting positive or negative feedback from customers for a specific service.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 二元逻辑回归是最广泛使用的**机器学习（ML**）算法之一，用于预测未来事件和行为分类。它在不同的行业和环境中都有应用。可以使用这种技术预测的变量包括购买产品的倾向以及特定服务获得正面或负面客户反馈的概率。
- en: Most digital native companies offer their services in subscription mode. In
    streaming video services, telco operators, and pay TVs, the binary logistic regression
    technique is widely used to predict the probability of churn of a customer. Predicting
    this kind of information is fundamental to target marketing campaigns and special
    offers to customers with the highest propensity to buy and increase revenue.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数数字原生公司以订阅模式提供他们的服务。在流媒体视频服务、电信运营商和付费电视中，二元逻辑回归技术被广泛用于预测客户流失的可能性。预测这类信息对于针对营销活动和针对购买意愿最高、能增加收入的客户提供的特别优惠至关重要。
- en: In this chapter, we'll see all the stages necessary to implement a binary logistic
    regression model leveraging BigQuery ML.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将看到实施二元逻辑回归模型所需的所有阶段，利用BigQuery ML。
- en: 'Using the BigQuery ML SQL language, we''ll go through the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 使用BigQuery ML SQL语言，我们将探讨以下主题：
- en: Introducing the business scenario
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: Discovering binary logistic regression
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现二元逻辑回归
- en: Exploring and understanding the dataset
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索和理解数据集
- en: Training the binary logistic regression model
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 训练二元逻辑回归模型
- en: Evaluating the binary logistic regression model
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估二元逻辑回归模型
- en: Using the binary logistic regression model
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用二元逻辑回归模型
- en: Drawing business conclusions
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提出业务结论
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter requires access to a web browser and the possibility to leverage
    the following:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章需要访问网络浏览器，并能够利用以下功能：
- en: A GCP account to access Google Cloud Console
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP账户以访问Google Cloud Console
- en: A GCP project to host the BigQuery datasets
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP项目来托管BigQuery数据集
- en: Now that we're ready with the technical requirements, let's dive into the analysis
    and development of our BigQuery ML binary logistic regression model.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经准备好了技术要求，让我们深入分析和发展我们的BigQuery ML二元逻辑回归模型。
- en: 'Check out the following video to see the Code in Action: [https://bit.ly/2QXCGHM](https://bit.ly/2QXCGHM)'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下视频，以查看代码的实际应用：[https://bit.ly/2QXCGHM](https://bit.ly/2QXCGHM)
- en: Introducing the business scenario
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: In this section, we'll introduce the business scenario that will be tackled
    with binary logistic regression.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍将使用二元逻辑回归来解决的问题的业务场景。
- en: Let's take an example wherein you are a taxi driver who is passionate about
    ML. You're currently working in Chicago and your goal is to provide an additional
    tool to all your colleagues to understand the probability of getting a tip from
    your customers.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们以一个例子为例，你是一位对机器学习充满热情的出租车司机。你现在在芝加哥工作，你的目标是为你所有的同事提供一个额外的工具，以了解从你的顾客那里获得小费的概率。
- en: Getting a tip from a customer is very important for taxi drivers to increase
    their income. Predicting the probability of getting a tip can be useful to, for
    example, know when to reserve a particularly gentle treatment for a specific subset
    of customers.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 获取顾客的提示对出租车司机来说非常重要，这有助于增加他们的收入。预测获得小费的可能性可能对以下情况很有用，例如知道何时为特定客户群体预留特别温和的待遇。
- en: 'In the following photo, you can see a taxi in Chicago:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下照片中，你可以看到芝加哥的一辆出租车：
- en: '![Figure 5.1 – Taxi in Chicago'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '![图5.1 – 芝加哥的出租车](img/B16722_05_001.jpg)'
- en: '](img/B16722_05_001.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '![图5.1 – 芝加哥的出租车](img/B16722_05_001.jpg)'
- en: Figure 5.1 – Taxi in Chicago
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.1 – 芝加哥的出租车
- en: The city of Chicago has collected information about most of the taxi trips that
    have occurred since 2013\. This dataset is available in the BigQuery public datasets
    marketplace ([https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips](https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips))
    and can be easily accessed and used.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 芝加哥市自2013年以来收集了大多数出租车行程的信息。这个数据集可在BigQuery公共数据集市场（[https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips](https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips)）中找到，并且可以轻松访问和使用。
- en: Your goal is to leverage the available information about taxi trips, such as
    the payment type, the miles traveled, the fare, and the name of the taxi company,
    to predict whether a taxi driver will receive a tip at the end of the taxi ride.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 你的目标是利用关于出租车行程的可用信息，例如支付类型、行驶里程、车费以及出租车公司的名称，来预测出租车司机在出租车行程结束时是否会收到小费。
- en: Now that we've explained and understood the business scenario, let's take a
    look at the ML technique that we can use to predict whether a specific event will
    happen or not.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经解释并理解了业务场景，让我们看看我们可以用来预测特定事件是否会发生的人工智能技术。
- en: Discovering binary logistic regression
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发现二元逻辑回归
- en: In this section, we'll learn what **binary logistic regression** is and we'll
    understand the use cases that can be tackled with this ML algorithm.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习什么是**二元逻辑回归**，并了解可以使用此机器学习算法解决的问题用例。
- en: '**Logistic regression** is a classification ML technique that can be used to
    predict a categorical variable. We can apply **binary logistic regression** when
    the variable to predict is binary and can assume only two values, such as true
    or false, yes or no, or 1 or 0.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '**逻辑回归**是一种分类机器学习技术，可以用来预测分类变量。当要预测的变量是二元且只能假设两个值时（例如，真或假、是或否、1或0），我们可以应用**二元逻辑回归**。'
- en: In order to predict one of the two labels, this ML algorithm calculates the
    probability of two different outcomes and allows us to choose a probability threshold
    to get the final classification of the binary variable.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 为了预测两个标签中的一个，此机器学习算法计算两种不同结果的可能性，并允许我们选择一个概率阈值以获得二元变量的最终分类。
- en: Since this is an algorithm based on a regression technique, the prediction of
    the label is based on a set of independent variables called features that are
    used to predict the dependent variable, called a label.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这是一个基于回归技术的算法，标签的预测基于一组称为特征的独立变量，这些变量用于预测称为标签的因变量。
- en: 'This ML technique can be used to answer relevant business questions across
    different industries, such as the following:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 这种人工智能技术可以用于回答不同行业的相关业务问题，例如以下问题：
- en: Will this customer buy my product?
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这个客户会买我的产品吗？
- en: Is my customer satisfied with my service?
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的客户对我的服务满意吗？
- en: Will my customer unsubscribe from my service in the next months?
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的客户在接下来的几个月内会取消我的服务吗？
- en: Will this student pass the next exam?
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这个学生会通过下一场考试吗？
- en: Will this person develop diabetes in the next year?
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这个人下一年会患上糖尿病吗？
- en: In our business scenario, the possibility of getting a tip at the end of a taxi
    ride can be predicted by leveraging binary logistic regression. In fact, we're
    interested in predicting whether a certain event will happen or not. If the taxi
    driver will get a tip, the binary categorical variable will be valued with 1,
    otherwise 0.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的业务场景中，可以通过二元逻辑回归预测出租车行程结束时获得小费的可能性。实际上，我们感兴趣的是预测某个事件是否会发生。如果出租车司机将获得小费，二元分类变量将被赋予值1，否则为0。
- en: Training a binary logistic regression model means trying to find the values
    of the coefficients that can be used in the equation between the input variables,
    called features, and the binary output variable, called the label.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 训练二元逻辑回归模型意味着尝试找到可以用于输入变量（称为特征）和二元输出变量（称为标签）之间方程的系数值。
- en: After the training, we'll leverage a **confusion matrix** to evaluate the performance
    of our binary logistic regression model. In this matrix, the rows represent the
    predicted value of the label while the columns are used to store the actual values.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 训练完成后，我们将利用**混淆矩阵**来评估我们的二元逻辑回归模型的表现。在这个矩阵中，行表示标签的预测值，而列用于存储实际值。
- en: 'The following figure represents a confusion matrix that is used to evaluate
    the performances of the binary logistic regression:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表示了一个用于评估二元逻辑回归性能的混淆矩阵：
- en: '![Figure 5.2 – Confusion matrix'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '![图5.2 – 混淆矩阵'
- en: '](img/B16722_05_Table_01.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '![图5.3 – chicago_taxi_trips数据集只包含一个表：taxi_trips]'
- en: Figure 5.2 – Confusion matrix
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.2 – 混淆矩阵
- en: This matrix allows us to visualize the performance of an ML algorithm, comparing
    the right predictions with the wrong ones.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 此矩阵使我们能够可视化机器学习算法的性能，比较正确预测与错误预测。
- en: 'From the numbers that will be presented in the confusion matrix, we can extract
    a fundamental performance indicator for logistic regression models: the **Area
    Under the Curve** (**AUC**) and the **Receiver Operating Characteristic** (**ROC**).
    The **ROC** is a curve that helps us in measuring the performance of a classification
    scenario with various thresholds. Basically, it tells us the capability of our
    ML model in predicting the right class.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 从混淆矩阵中将要展示的数字中，我们可以提取出逻辑回归模型的基本性能指标：**曲线下面积**（**AUC**）和**接收者操作特征**（**ROC**）。**ROC**曲线帮助我们测量具有各种阈值的分类场景的性能。基本上，它告诉我们我们的机器学习模型在预测正确类别方面的能力。
- en: 'The **ROC** curve is a graph plotted using the following two parameters:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**ROC**曲线是使用以下两个参数绘制的图表：'
- en: '**False positive rate** on the abscissa axis. This parameter is calculated
    as the ratio between the number of **false positives** and the sum of **false
    positives** and **true negatives**.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**假正率**位于横坐标轴上。此参数是**假正例**数量与**假正例**和**真反例**之和的比率。'
- en: '**True positive rate** on the ordinate axis. This parameter is also called
    the **recall** of the model. It is calculated as the ratio between **true positives**
    and the sum of **true positives** and **false negatives**.'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**真正率**位于纵坐标轴上。此参数也称为模型的**召回率**。它是**真正例**与**真正例**和**假反例**之和的比率。'
- en: If the **area under the curve**, called the **AUC**, is high and close to 1,
    the model is more likely to be able to predict the right label.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 如果**曲线下面积**，称为**AUC**，很高且接近1，则模型更有可能能够预测正确的标签。
- en: We've learned about the basics of binary logistic regression; now it's time
    to take a look at the dataset that we'll use to build our ML model.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经学习了二元逻辑回归的基础知识；现在是时候看看我们将用它来构建机器学习模型的数据集了。
- en: Exploring and understanding the dataset
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索和理解数据集
- en: As we learned in [*Chapter 4*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061),
    *Predicting Numerical Values with Linear Regression*, before diving into the ML
    implementation, it's necessary to analyze the data available for our use case.
    We need to begin by having a clear understanding of the data that can be used
    for our business scenario.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们在[*第4章*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061)，“使用线性回归预测数值”中学习的，在深入机器学习实现之前，分析我们用例中的可用数据是必要的。我们需要首先对可用于我们业务场景的数据有一个清晰的理解。
- en: Understanding the data
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解数据
- en: 'To start exploring the data, we need to do the following:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始探索数据，我们需要做以下事情：
- en: Log in to Google Cloud Console and access the **BigQuery** user interface from
    the navigation menu.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录Google Cloud控制台，并通过导航菜单访问**BigQuery**用户界面。
- en: Create a new dataset in the project that we created in [*Chapter 2*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039),
    *Setting Up Your GCP and BigQuery Environment*. For this use case, we'll create
    the `05_chicago_taxi` dataset with the default options.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们[*第2章*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039)，“设置您的GCP和BigQuery环境”中创建的项目中创建一个新的数据集。对于此用例，我们将使用默认选项创建名为`05_chicago_taxi`的数据集。
- en: 'Open the `bigquery-public-data` GCP project that hosts all the BigQuery public
    datasets and browse the items until you find the `chicago_taxi_trips` dataset.
    In this public dataset, we can see only one BigQuery table: `taxi_trips`. This
    table contains all the information about the taxi rides that happened in the city
    of Chicago and we''ll use it to train and test our ML model:![Figure 5.3 – The
    chicago_taxi_trips dataset contains only one table: taxi_trips'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`bigquery-public-data` GCP项目，该项目托管所有BigQuery公共数据集，浏览项目直到找到`chicago_taxi_trips`数据集。在这个公共数据集中，我们只能看到一个BigQuery表：`taxi_trips`。此表包含关于在芝加哥市发生的出租车行程的所有信息，我们将使用它来训练和测试我们的机器学习模型：![图5.3
    – The chicago_taxi_trips数据集只包含一个表：taxi_trips
- en: '](img/B16722_05_003.jpg)'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图5.3 – chicago_taxi_trips数据集只包含一个表：taxi_trips]'
- en: 'Figure 5.3 – The chicago_taxi_trips dataset contains only one table: taxi_trips'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图5.3 – The chicago_taxi_trips数据集只包含一个表：taxi_trips
- en: 'Let''s click on the table named `tips` column, represented with the numeric
    `FLOAT` format. Apparently, this might seem like a problem because our ML model
    is only able to predict Boolean values. This situation can easily be overcome
    by transforming the numeric value into a binary value by applying the following
    rule: if the value of `tips` is greater than 0, the label is 1, otherwise it''s
    0.'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们点击名为`tips`的列，该列以数值`FLOAT`格式表示。显然，这可能会看起来像一个问题，因为我们的机器学习模型只能预测布尔值。这种情况可以通过应用以下规则轻松克服：如果`tips`的值大于0，则标签为1，否则为0。
- en: We can leverage all the other columns in the table as **features** of our ML
    model. The duration of the taxi ride could be a good feature because during longer
    rides, the taxi driver has more time to familiarize themselves with the customer
    than during short trips of just some minutes. The pick-up and drop-off locations
    can impact the tip because, as we can imagine, some areas are more profitable
    than others. For example, an area of the city with a lot of businesses and offices
    of large companies can increase the probability of getting a tip.
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们可以利用表中的所有其他列作为我们机器学习模型的**特征**。出租车行程的持续时间可能是一个好的特征，因为在较长的行程中，出租车司机有更多时间熟悉顾客，而短途行程只有几分钟。接车和下车地点可能会影响小费，因为我们可以想象，一些地区比其他地区更有利可图。例如，一个城市中有很多商业和大型公司办公区的地区可能会增加得到小费的可能性。
- en: The payment type used to pay for the taxi ride is another important factor in
    our analysis. When you need to pay a taxi driver with electronic payment, it's
    usually easier to give a tip simply by pressing a button on the **Point of Sale**
    (**POS**) device.
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 用于支付出租车费用的支付类型是我们分析中的另一个重要因素。当你需要用电子支付方式支付给出租车司机时，通常通过在**销售点**（**POS**）设备上按一个按钮来给小费会更简单。
- en: Furthermore, the name of the taxi company could be another important feature
    to consider. Some taxi companies can offer a better experience to customers in
    terms of services, professionalism of the drivers, and comfort of the cars. All
    these ingredients can influence a customer in giving a tip to the taxi driver.
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此外，出租车公司的名字也可能是需要考虑的另一个重要特征。一些出租车公司可以在服务、司机的专业性和车辆的舒适性方面为顾客提供更好的体验。所有这些因素都可能影响顾客给出租车司机小费的决定。
- en: From a schema perspective, this table includes a lot of useful information that
    can be used to develop our binary logistic regression model. Let's proceed with
    our analysis, deepening our understanding of the data.
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 从模式的角度来看，这个表格包含了许多有用的信息，这些信息可以用来开发我们的二元逻辑回归模型。让我们继续分析，深化我们对数据的理解。
- en: As a next step, let's take a look at how many records we have in the table and
    whether they're enough for our purposes. In the **Details** tab, we can notice
    that the table contains more than 194 million records. We can be confident in
    building our ML model with this amount of data:![Figure 5.4 – The Details tab
    on the taxi_trips table shows the number of records
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为下一步，让我们看看表中记录的数量以及它们是否足够用于我们的目的。在**详细信息**标签页中，我们可以注意到该表包含超过1.94亿条记录。我们可以有信心用这么多的数据来构建我们的机器学习模型：![图5.4
    – taxi_trips表上的详细信息标签页显示了记录数
- en: and the table size in terms of GB
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以及以GB为单位的表格大小
- en: '](img/B16722_05_004.jpg)'
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_05_004.jpg)'
- en: Figure 5.4 – The Details tab on the taxi_trips table shows the number of records
    and the table size in terms of GB
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图5.4 – taxi_trips表上的详细信息标签页显示了记录数以及以GB为单位的表格大小
- en: 'Now, let''s take a look at the actual data in the `taxi_trips` table:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们看看`taxi_trips`表中的实际数据：
- en: '[PRE0]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The query shows all the fields of the table filtering on the first 10 rows.
    The `LIMIT 10` clause is used to limit the number of records in the result set
    and returns a random selection of rows from the table.
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询显示了表中的所有字段，并过滤出前10行。使用`LIMIT 10`子句来限制结果集中的记录数，并从表中返回随机选择的行。
- en: 'After getting a preview of the table content, we can analyze the time frame
    of our dataset:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在预览了表格内容之后，我们可以分析我们数据集的时间范围：
- en: '[PRE1]'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The query extracts the minimum and maximum values of the `trip_start_timestamp`
    field to have a clear understanding of the period over which the data is collected.
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询提取了`trip_start_timestamp`字段的最低值和最高值，以便清楚地了解数据收集的时期。
- en: 'In the following screenshot, you can view the result of the query execution:'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，您可以查看查询执行的结果：
- en: '![Figure 5.5 – The query returns the minimum and maximum values of the trip_start_timestamp
    field'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图5.5 – 查询返回trip_start_timestamp字段的最低值和最高值'
- en: '](img/B16722_05_005.jpg)'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_05_005.jpg)'
- en: Figure 5.5 – The query returns the minimum and maximum values of the trip_start_timestamp
    field
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.5 – 查询返回 trip_start_timestamp 字段的最小值和最大值
- en: At the time of writing this book, the minimum value is represented by 1 January
    2013, while the maximum value is 1 October 2020.
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在撰写本书时，最小值是 2013 年 1 月 1 日，而最大值是 2020 年 10 月 1 日。
- en: 'Then, we can apply a data quality check on the `tips` field on which our label
    will be based. In fact, if the `tips` column is greater than 0, we can assume
    that the taxi driver got a tip from the customer:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们可以对作为我们的标签基础的 `tips` 字段进行数据质量检查。事实上，如果 `tips` 列大于 0，我们可以假设出租车司机收到了顾客的小费：
- en: '[PRE2]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'In the following screenshot, you can see the result of the query:'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，您可以看到查询的结果：
- en: '![Figure 5.6 – The query returns the 4,784 records with the tips field empty'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 5.6 – 查询返回 4,784 条 tips 字段为空的记录'
- en: '](img/B16722_05_006.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_05_006.jpg)'
- en: Figure 5.6 – The query returns the 4,784 records with the tips field empty
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.6 – 查询返回 4,784 条 tips 字段为空的记录
- en: Executing the `SELECT COUNT(*)` query, we can notice that there are 4,784 records
    where the `tips` field is empty. We'll take into consideration this aspect during
    the creation of the ML model, filtering these rows.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 执行 `SELECT COUNT(*)` 查询，我们可以注意到有 4,784 条记录的 `tips` 字段为空。在创建 ML 模型时，我们将考虑这一方面，过滤掉这些行。
- en: 'In this section, we''ve analyzed the dataset that we can leverage in order
    to build our ML model, so now let''s start segmenting it into three different
    sets: training, evaluation, and classification.'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们已经分析了我们可以利用来构建我们的 ML 模型的数据集，因此现在让我们开始将其分割成三个不同的集合：训练、评估和分类。
- en: Segmenting the dataset
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据集分段
- en: 'Before implementing our binary logistic regression model, let''s segment our
    dataset according to the main stages of the ML development: training, evaluation,
    and use:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在实现我们的二元逻辑回归模型之前，让我们根据 ML 开发的主要阶段来分割我们的数据集：训练、评估和使用：
- en: 'To understand how the data is distributed across the years and months, we can
    use the following query statement:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要了解数据如何在年份和月份之间分布，我们可以使用以下查询语句：
- en: '[PRE3]'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `SELECT` statement extracts the information about the year and month when
    the taxi rides occurred and for each month counts the total number of rides. This
    aggregation is possible by the `GROUP BY` clause at the end of the query.
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`SELECT` 语句提取了关于出租车行程发生的年份和月份的信息，并为每个月计算了总行程数。这种聚合是通过查询末尾的 `GROUP BY` 子句实现的。'
- en: The query extracts the records from the `taxi_trips` table but applies some
    important filters. All the records with an empty `tips` field are excluded as
    well as all the rows with the potential features equal to `NULL`.
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询从 `taxi_trips` 表中提取记录，但应用了一些重要的过滤器。所有 `tips` 字段为空的记录以及所有潜在特征等于 `NULL` 的行都被排除。
- en: In order to exclude outliers and possible incorrect measurements, we've decided
    to keep only the taxi rides with a duration greater than 3 minutes and longer
    than a mile.
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了排除异常值和可能的错误测量，我们决定只保留持续时间超过 3 分钟且超过一英里的出租车行程。
- en: 'Thanks to the `ORDER BY` clause, the results are ascendingly ordered:'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 多亏了 `ORDER BY` 子句，结果按升序排列：
- en: '![Figure 5.7 – The query returns the distribution of the records in the taxi_trips
    table'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 5.7 – 查询返回 taxi_trips 表中记录的分布'
- en: '](img/B16722_05_007.jpg)'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_05_007.jpg)'
- en: Figure 5.7 – The query returns the distribution of the records in the taxi_trips
    table
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.7 – 查询返回 taxi_trips 表中记录的分布
- en: Focusing on the most recent months, we can immediately notice a drop in the
    numbers in April 2020\. This sudden decrease is probably caused by the restrictions
    introduced to manage the COVID-19 pandemic. To avoid any impact of this event
    on our analysis, let's focus our implementation only on the year 2019\. We'll
    split our dataset using a time frame that starts from January 2019 up to October
    2019.
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 关注最近的几个月，我们可以立即注意到 2020 年 4 月的数字下降。这种突然的下降可能是由于为管理 COVID-19 大流行而引入的限制所导致的。为了避免任何事件对我们分析的影响，让我们只关注
    2019 年。我们将使用从 2019 年 1 月到 2019 年 10 月的时间框架来分割我们的数据集。
- en: 'Let''s create a table that contains the rows that will be used to train our
    BigQuery ML model. For this use case, we''ll select only the taxi rides that occurred
    from January 2019 until August 2019 inclusive:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们创建一个包含将要用于训练我们的 BigQuery ML 模型的行的表。对于此用例，我们将仅选择从 2019 年 1 月到 2019 年 8 月（包括）发生的出租车行程：
- en: '[PRE4]'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: As we can notice from the `CREATE TABLE` statement, the query filters all the
    rows with empty features and labels that could cause issues during the implementation
    of the ML model.
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 从`CREATE TABLE`语句中，我们可以注意到查询过滤掉了所有具有空特征和标签的行，这些特征和标签在机器学习模型的实现过程中可能会引起问题。
- en: 'After that, we create another table dedicated to the records that will be used
    to evaluate our ML model:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后，我们创建另一个表格，专门用于评估我们的机器学习模型的记录：
- en: '[PRE5]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The only difference, compared to the table that contains the training data,
    is in the month that we've selected to create this table. In this case, we've
    chosen to include the records related to the month of September of 2019.
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 与包含训练数据的表格相比，唯一的区别在于我们选择的月份来创建这个表格。在这种情况下，我们选择包含与2019年9月相关的记录。
- en: 'The last preparatory step is based on the creation of the table that we''ll
    use to test our binary logistic regression model. Let''s create `classification_table`
    as specified in the following SQL statement:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后的准备步骤是基于创建我们将用于测试二元逻辑回归模型的表格。让我们根据以下SQL语句创建`classification_table`：
- en: '[PRE6]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Thanks to the selection and the filters that we''ve applied in this query,
    our set will contain only the records related to October 2019\. We can also notice
    that all the other filters remain unchanged and uniform across the three datasets:
    training, evaluation, and classification.'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 多亏了我们在查询中应用的筛选和过滤器，我们的集合将只包含与2019年10月相关的记录。我们还可以注意到，所有其他过滤器在三个数据集（训练、评估和分类）中保持不变且一致。
- en: Now that we've divided our dataset into three parts. Let's start the actual
    training of the binary logistic regression ML model.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经将数据集分为三个部分，让我们开始实际训练二元逻辑回归机器学习模型。
- en: Training the binary logistic regression model
  id: totrans-113
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 训练二元逻辑回归模型
- en: 'As we already did in [*Chapter 4*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061),
    *Predicting Numerical Values with Linear Regression*, we''ll adopt an incremental
    approach in trying to improve the performance of our ML model at each attempt:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在[*第4章*](B16722_04_Final_ASB_ePub.xhtml#_idTextAnchor061)中已经做的那样，*使用线性回归预测数值值*，我们将采用增量方法来尝试在每次尝试中提高我们的机器学习模型的表现：
- en: 'Let''s start training our first ML model, `binary_classification_version_1`:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们开始训练我们的第一个机器学习模型，`binary_classification_version_1`：
- en: '[PRE7]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: In this BigQuery ML statement, we can see the `CREATE OR REPLACE MODEL` keywords
    used to start the training of the model. These keywords are followed by the identifier
    of the ML model. After the identifier, we can notice the `OPTIONS` clause. As
    our options, we've chosen to train the model with a `logistic_reg` algorithm and
    to use the `will_get_tip` field as the target label.
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这个BigQuery ML语句中，我们可以看到用于开始模型训练的`CREATE OR REPLACE MODEL`关键字。这些关键字后面跟着机器学习模型的标识符。在标识符之后，我们可以注意到`OPTIONS`子句。作为我们的选项，我们选择使用`logistic_reg`算法来训练模型，并使用`will_get_tip`字段作为目标标签。
- en: 'The `SELECT` statement points out that the `will_get_tip` label is valued with
    `1` if the value of the `tips` field is greater than 0, otherwise with `0`. In
    the `SELECT` statement, we''ve also included the only feature that we''re using
    for our first attempt: `trip_seconds`. This feature represents the duration expressed
    in seconds of the taxi ride.'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`SELECT`语句指出，如果`tips`字段的值大于0，则`will_get_tip`标签的值为`1`，否则为`0`。在`SELECT`语句中，我们还包含了我们第一次尝试使用的唯一特征：`trip_seconds`。这个特征代表出租车行程的持续时间（以秒为单位）。'
- en: 'Finally, the `SELECT` statement is based on the table that we''ve created to
    perform the training of the model: `05_chicago_taxi.training_table`.'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 最后，`SELECT`语句基于我们创建的用于训练模型的表格：`05_chicago_taxi.training_table`。
- en: At the end of the training, we can access the ML model from the BigQuery navigation
    menu to have a look at the performance of the model. Selecting the **Evaluation**
    tab, we can see the **ROC AUC** value. In this case, we can see we haven't achieved
    great results because it is not close to 1; it's **0.5696**:![Figure 5.8 – The
    Evaluation tab shows the ROC AUC value related to the trained ML model
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 训练结束后，我们可以从BigQuery导航菜单中访问机器学习模型，查看模型的表现。选择**评估**选项卡，我们可以看到**ROC AUC**值。在这种情况下，我们可以看到我们没有取得很好的结果，因为它没有接近1；它是**0.5696**：![图5.8
    – 评估选项卡显示了与训练的机器学习模型相关的ROC AUC值
- en: '](img/B16722_05_008.jpg)'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_05_008.jpg)'
- en: Figure 5.8 – The Evaluation tab shows the ROC AUC value related to the trained
    ML model
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图5.8 – 评估选项卡显示了与训练的机器学习模型相关的ROC AUC值
- en: 'In the same tab, we can also see the ROC curve:'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在同一个选项卡中，我们还可以看到ROC曲线：
- en: '![Figure 5.9 – In the Evaluation tab, it is also possible to graphically analyze
    the ROC curve and see the blue area under the ROC curve'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图5.9 – 在评估标签页中，也可以图形化分析ROC曲线并看到ROC曲线下的蓝色区域](img/Figure_5.9.png)'
- en: '](img/B16722_05_009.jpg)'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_05_009.jpg](img/B16722_05_009.jpg)'
- en: Figure 5.9 – In the Evaluation tab, it is also possible to graphically analyze
    the ROC curve and see the blue area under the ROC curve
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图5.9 – 在评估标签页中，也可以图形化分析ROC曲线并看到ROC曲线下的蓝色区域
- en: As we can see from the preceding diagram, the ROC curve, which expresses the
    rate between the true positive and the false positive, is not close to 1\. The
    blue area under the curve is about 50% of the entire square.
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如前图所示，表示真正例与假正例之间比率的ROC曲线并没有接近1。曲线下的蓝色区域大约占整个正方形的50%。
- en: 'As shown in the following screenshot, we can also leverage the confusion matrix
    in the same tab to experiment with the outcome of the ML model according to different
    thresholds:'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如下截图所示，我们还可以在同一标签页中利用混淆矩阵来根据不同的阈值实验机器学习模型的输出：
- en: '![Figure 5.10 – In the Evaluation tab, it is also possible to see the confusion
    matrix of the classification model'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图5.10 – 在评估标签页中，也可以查看分类模型的混淆矩阵](img/Figure_5.10.png)'
- en: '](img/B16722_05_010.jpg)'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_05_010.jpg](img/B16722_05_010.jpg)'
- en: Figure 5.10 – In the Evaluation tab, it is also possible to see the confusion
    matrix of the classification model
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图5.10 – 在评估标签页中，也可以查看分类模型的混淆矩阵
- en: 'Let''s try to improve our ML model by adding features that can be useful to
    predict the probability of getting a tip. We''ll introduce the fare of the taxi
    ride, any tolls paid during the ride, and the name of the taxi company as new
    features:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们尝试通过添加有助于预测小费概率的特征来改进我们的机器学习模型。我们将引入出租车行程的票价、行程中支付的费用以及出租车公司的名称作为新的特征：
- en: '[PRE8]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `CREATE OR REPLACE MODEL` part is similar to the previous one but includes
    the new features previously mentioned. Despite adding the new fields, the improvement
    in terms of **ROC AUC** is not significant. In fact, with this attempt, we have
    achieved a value of **0.5902**.
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`CREATE OR REPLACE MODEL`部分与之前的一个类似，但包括了之前提到的新的功能。尽管增加了新的字段，但在**ROC AUC**方面的改进并不显著。实际上，通过这次尝试，我们已经达到了**0.5902**的值。'
- en: 'It''s time to introduce a feature that can be extremely helpful for the development
    of our ML model. The next ML model, `binary_classification_version_3`, will introduce
    the payment type used by the customer to pay the taxi driver:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 是时候介绍一个可能对我们机器学习模型开发极为有帮助的特征了。下一个机器学习模型`binary_classification_version_3`将引入客户支付出租车司机的支付类型：
- en: '[PRE9]'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: After the training of this ML model, we can immediately notice a huge increase
    in the value of **ROC AUC**. Adding the payment method as a feature to our model,
    we have achieved a value of **0.9809**. This is very close to 1 and represents
    a significant improvement in the performance of our binary logistic regression
    model.
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在训练这个机器学习模型之后，我们可以立即注意到**ROC AUC**值的巨大提升。将支付方式作为特征添加到我们的模型中，我们达到了**0.9809**的值。这非常接近1，代表了我们二元逻辑回归模型性能的显著提升。
- en: 'The result that we''ve achieved with the `binary_classification_version_3`
    ML model in the preceding code block is already a great result. Let''s see whether
    it''s possible to further improve our classification model by leveraging the information
    about the pick-up and drop-off locations of the taxi trip:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在前一个代码块中，我们使用`binary_classification_version_3`机器学习模型所取得的结果已经是一个很好的结果了。让我们看看是否可以通过利用出租车行程的接车和下车位置信息来进一步改进我们的分类模型：
- en: '[PRE10]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The query is very similar to the other training statements but introduces two
    more features: `pickup_location` and `dropoff_location`. The two fields represent
    the area where the taxi ride started and ended.'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询语句与其他训练语句非常相似，但引入了两个额外的特征：`pickup_location`和`dropoff_location`。这两个字段代表出租车行程开始和结束的区域。
- en: After the training of the ML model, we can immediately appreciate that we've
    further improved the performances of our classification model. This is clearly
    visible from the **ROC AUC** value, which is **0.9827**.
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在训练机器学习模型之后，我们可以立即欣赏到我们进一步提高了分类模型的性能。这从**ROC AUC**值中可以清楚地看出，其值为**0.9827**。
- en: Looking at the **Confusion matrix**, we can choose the best threshold that gives
    us the right balance between true positive and true negative predictions.
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通过查看**混淆矩阵**，我们可以选择最佳阈值，以在真正例和真负例预测之间取得正确的平衡。
- en: The threshold value influences the ratio between the True Positive Rate and
    the False Positive Rate. Finding the best threshold means to find a value that
    maximize the True Positive Rate and minimize the False Positive Rate.
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 阈值值影响真正例率和假正例率之间的比率。找到最佳阈值意味着找到一个值，以最大化真正例率并最小化假正例率。
- en: 'In the following screenshot, you can see the confusion matrix and the **Positive
    class threshold** slider:'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在以下屏幕截图中，您可以看到混淆矩阵和 **正类阈值** 滑块：
- en: '![Figure 5.11 – The confusion matrix shows excellent performances in terms
    of'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: '![Figure 5.11 – 混淆矩阵显示了在预测标签与实际标签方面的出色表现'
- en: predicted labels versus the actual ones
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 预测标签与实际标签的对比
- en: '](img/B16722_05_011.jpg)'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_05_011.jpg](img/B16722_05_011.jpg)'
- en: Figure 5.11 – The confusion matrix shows excellent performances in terms of
    predicted labels versus the actual ones
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.11 – 混淆矩阵显示了在预测标签与实际标签方面的出色表现
- en: All the other key performance indicators, such as the precision, recall, and
    accuracy, are very high and close to the maximum of 1.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 所有其他关键性能指标，如精确率、召回率和准确率，都非常高，接近 1 的最大值。
- en: 'From a graphical perspective, we can appreciate the excellent quality of our
    ML model. In fact, the blue area under the ROC curve is very close to 1 and covers
    almost the entire area of the square. The following screenshot shows the ROC curve
    of the last ML model and shows that our ML model has achieved an excellent result:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 从图形角度来看，我们可以欣赏到我们 ML 模型的优秀质量。事实上，ROC 曲线下方的蓝色区域非常接近 1，几乎覆盖了整个正方形的面积。以下截图显示了最后一个
    ML 模型的 ROC 曲线，并显示我们的 ML 模型已经取得了优异的结果：
- en: '![Figure 5.12 – The area under the ROC curve is very close to 1 and to filling
    in the entire square'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '![Figure 5.12 – ROC 曲线下方的面积非常接近 1，并且几乎填满了整个正方形'
- en: '](img/B16722_05_012.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_05_012.jpg](img/B16722_05_012.jpg)'
- en: Figure 5.12 – The area under the ROC curve is very close to 1 and to filling
    in the entire square
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.12 – ROC 曲线下方的面积非常接近 1，并且几乎填满了整个正方形
- en: In this section, we've trained some binary logistic regression ML models leveraging
    the features available in our dataset. To proceed with the evaluation stage, we
    choose to pick up the `binary_classification_version_4` model, which showed the
    best performance. Now, let's see how to start the evaluation phase.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们利用数据集中可用的特征训练了一些二元逻辑回归 ML 模型。为了进行评估阶段，我们选择使用表现最佳的 `binary_classification_version_4`
    模型。现在，让我们看看如何开始评估阶段。
- en: Evaluating the binary logistic regression model
  id: totrans-155
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估二元逻辑回归模型
- en: To evaluate our BigQuery ML model, we'll use the `ML.EVALUATE` function and
    the table that we've expressly created as the evaluation dataset.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 为了评估我们的 BigQuery ML 模型，我们将使用 `ML.EVALUATE` 函数和专门创建的作为评估数据集的表。
- en: 'The following query will tell us whether the model is suffering from overfitting
    or is also able to perform well on new data:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 以下查询将告诉我们模型是否过度拟合，或者是否也能在新数据上表现良好：
- en: '[PRE11]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The `SELECT` statement extracts the `roc_auc` value returned by the `ML.EVALUATE`
    function and also provides a clear description of the quality of the model, starting
    from `'POOR'` and going up to the `'EXCELLENT'` grade, passing through some intermediate
    stages such as `'NEEDS IMPROVEMENTS'` and `'GOOD'`.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '`SELECT` 语句提取了 `ML.EVALUATE` 函数返回的 `roc_auc` 值，并提供了对模型质量的清晰描述，从 `''POOR''`
    级别开始，到 `''EXCELLENT''` 级别，经过一些中间阶段，如 `''NEEDS IMPROVEMENTS''` 和 `''GOOD''`。'
- en: 'Executing the query, we can see that the score is very high, and the result
    is `EXCELLENT`:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 执行查询，我们可以看到分数非常高，结果是 `EXCELLENT`：
- en: '![Figure 5.13 – The evaluation stage returns an EXCELLENT quality result of
    our BigQuery ML model'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '![Figure 5.13 – 评估阶段返回了我们的 BigQuery ML 模型的优秀质量结果'
- en: '](img/B16722_05_013.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_05_013.jpg](img/B16722_05_013.jpg)'
- en: Figure 5.13 – The evaluation stage returns an EXCELLENT quality result of our
    BigQuery ML model
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.13 – 评估阶段返回了我们的 BigQuery ML 模型的优秀质量结果
- en: Now that we've evaluated our ML model, let's see how we can apply it to other
    records to get the predictions.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经评估了我们的 ML 模型，让我们看看我们如何将其应用于其他记录以获取预测结果。
- en: Using the binary logistic regression model
  id: totrans-165
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用二元逻辑回归模型
- en: In this section, we'll use the ML model to predict the probability of getting
    a tip from our customers.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用 ML 模型来预测客户获得小费的概率。
- en: 'To test our BigQuery ML model, we''ll use the `ML.PREDICT` function on the
    `classification_table` table:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测试我们的 BigQuery ML 模型，我们将在 `classification_table` 表上使用 `ML.PREDICT` 函数：
- en: '[PRE12]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The query is composed of a `SELECT` statement that extracts the actual and predicted
    values of the `will_get_tip` field. If not specified, `ML.PREDICT` will use the
    value `0.5` as the default threshold.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 查询由一个`SELECT`语句组成，该语句提取了`will_get_tip`字段的实际和预测值。如果没有指定，`ML.PREDICT`将使用值`0.5`作为默认阈值。
- en: 'The output of the query shows the following columns:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 查询的输出显示了以下列：
- en: The predicted label in the first column
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一列中的预测标签
- en: The calculated probabilities for each label in the second and third columns
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第二列和第三列中每个标签的计算概率
- en: The actual value extracted from `classification_table` as the last column
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从`classification_table`中提取的实际值作为最后一列
- en: 'In the following screenshot, you can see the result of the query execution:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，你可以看到查询执行的结果：
- en: '![Figure 5.14 – The output of the query shows the predicted label compared
    with the actual one'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '![Figure 5.14 – 查询的输出显示了预测标签与实际标签的比较'
- en: '](img/B16722_05_014.jpg)'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_05_014.jpg]'
- en: Figure 5.14 – The output of the query shows the predicted label compared with
    the actual one
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.14 – 查询的输出显示了预测标签与实际标签的比较
- en: Now that we've tested our BigQuery ML model, let's make some final considerations
    about the possibility of predicting whether a customer will give a tip to the
    taxi driver according to the information that we have about the taxi ride.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经测试了我们的BigQuery ML模型，让我们对根据我们所拥有的出租车行程信息预测客户是否会给出租车司机小费的可能性进行一些最终考虑。
- en: Drawing business conclusions
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提出业务结论
- en: In this section, we'll use our ML model, and we'll understand how many times
    the BigQuery ML model is able to predict the actual outcome.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用我们的机器学习模型，并了解BigQuery ML模型能够预测实际结果多少次。
- en: 'Using the default threshold of `0.5`, let''s see how many times the ML model
    is able to correctly identify when a driver will get a tip:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 使用默认阈值`0.5`，让我们看看ML模型能够正确识别司机是否会得到小费多少次：
- en: '[PRE13]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: To calculate this value, we've introduced the `WHERE` clause, filtering only
    the rows where the predicted value is equal to the actual one.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 为了计算这个值，我们引入了`WHERE`子句，仅过滤那些预测值等于实际值的行。
- en: '`SELECT COUNT` returns a value of 727,462 predictions corresponding with the
    predicted value being equal to the actual one.'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: '`SELECT COUNT`返回了727,462个预测值，与预测值等于实际值相对应。'
- en: On a total of 744,058 rows, we can say that our model with a standard threshold
    of 0.5 predicts the right outcome in 97.76% of cases.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在总共744,058行中，我们可以说，我们的模型在标准阈值为0.5的情况下，在97.76%的情况下预测了正确的结果。
- en: Since we've created a very effective binary logistic regression model leveraging
    BigQuery ML, we're now confident with providing insights and suggestions to our
    taxi drivers. Knowing in advance the probability of getting a tip, they can behave
    differently according to the probability of getting a tip from the customer they're
    serving.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们利用BigQuery ML创建了一个非常有效的二元逻辑回归模型，我们现在有信心向我们的出租车司机提供见解和建议。了解提前得到小费的概率，他们可以根据他们服务的客户得到小费的概率采取不同的行为。
- en: Summary
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we implemented a binary logistic regression model. We introduced
    the business scenario based on the data collected by the city of Chicago about
    taxi services. After that, we learned how the binary logistic regression technique
    can be used to predict binary values.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们实现了一个二元逻辑回归模型。我们基于芝加哥市收集的出租车服务数据介绍了业务场景。之后，我们学习了二元逻辑回归技术如何用于预测二元值。
- en: 'In order to build an effective model, we performed a detailed analysis of the
    data, and then segmented the dataset according to our needs into three tables:
    one to host training data, the second for evaluation, and the last one to apply
    our classification model.'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 为了构建一个有效的模型，我们对数据进行详细分析，然后根据我们的需求将数据集分为三个表：一个用于存放训练数据，第二个用于评估，最后一个用于应用我们的分类模型。
- en: During the training phase of the BigQuery ML model, we constantly improved the
    performances of the ML model based on the confusion matrix and the ROC AUC value.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在BigQuery ML模型的训练阶段，我们根据混淆矩阵和ROC AUC值不断改进ML模型的性能。
- en: After that, we evaluated the best ML model on a new set of records to verify
    the absence of overfitting and gain more confidence in the good quality of our
    binary logistic regression model.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们在一组新的记录上评估了最佳的机器学习模型，以验证是否存在过拟合，并增加对我们二元逻辑回归模型高质量的好感。
- en: Finally, we applied our ML model to the last subset of records to predict the
    probability of getting a tip or not from the customer at the end of each taxi
    ride. We discovered that our ML model is able to correctly predict the customer's
    behavior in more than 97% of cases.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将我们的机器学习模型应用于最后一批记录，以预测每次出租车行程结束时客户是否得到小费的可能性。我们发现我们的机器学习模型能够正确预测客户行为在97%以上的情况下。
- en: In the next chapter, we'll go through multiclass logistic regression and we'll
    learn how to apply this algorithm to classify trees into different species according
    to their characteristics.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍多类逻辑回归，并学习如何根据树木的特征将它们分类到不同的物种。
- en: Further resources
  id: totrans-194
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更多资源
- en: '**Chicago Taxi Trips public dataset**: [https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips](https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips)'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**芝加哥出租车行程公共数据集**：[https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips](https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips)'
- en: '**Chicago Open Data**: [https://data.cityofchicago.org/](https://data.cityofchicago.org/)'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**芝加哥开放数据**：[https://data.cityofchicago.org/](https://data.cityofchicago.org/)'
- en: '**BigQuery ML CREATE MODEL**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 创建模型**：[https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)'
- en: '**BigQuery ML EVALUATE MODEL**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 评估模型**：[https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
- en: '**BigQuery ML PREDICT**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 预测**：[https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
- en: '**BigQuery ML binary logistic regression example**: [https://cloud.google.com/bigquery-ml/docs/logistic-regression-prediction](https://cloud.google.com/bigquery-ml/docs/logistic-regression-prediction)'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 二元逻辑回归示例**：[https://cloud.google.com/bigquery-ml/docs/logistic-regression-prediction](https://cloud.google.com/bigquery-ml/docs/logistic-regression-prediction)'

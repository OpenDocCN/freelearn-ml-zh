<html><head></head><body>
<div id="_idContainer178">
<h1 class="chapter-number" id="_idParaDest-148"><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 id="_idParaDest-149"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.2.1">Managing and Securing Your Azure Machine Learning Workspace</span></h1>
<p><span class="koboSpan" id="kobo.3.1">After data and access management comes infrastructure. </span><span class="koboSpan" id="kobo.3.2">Although Azure Machine Learning is a cloud service, it doesn’t mean that we cannot leverage services together with our Azure or on-premises infrastructure to isolate our resources and secure them from </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">public access.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In this chapter, we will learn how to implement security best practices regarding the workspace. </span><span class="koboSpan" id="kobo.5.2">We will focus more on practices and scenarios around virtual networking and endpoint security as well as compute. </span><span class="koboSpan" id="kobo.5.3">Compute in Azure Machine Learning can be used both for model training and deployment and each option available has its own security best practices. </span><span class="koboSpan" id="kobo.5.4">Compute includes compute instances, compute clusters, and containers. </span><span class="koboSpan" id="kobo.5.5">The workspace uses Azure Container Registries to deploy models that can be deployed as containers, so we will review security options for all </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">those services.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Exploring </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">network security</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Working with Azure Machine </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">Learning compute</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Managing container registries </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">and containers</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.15.1">By the end of this chapter, we will know how to implement best practices and isolate our Azure Machine Learning workspace and its associated resources by using virtual networking </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">in Azure.</span></span></p>
<h1 id="_idParaDest-150"><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.17.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.18.1">This chapter deals heavily with networking and infrastructure in Azure. </span><span class="koboSpan" id="kobo.18.2">Although the tutorials can be implemented without much difficulty, properly implementing and maintaining a network architecture in Azure requires a lot </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">of knowledge.</span></span></p>
<p><span class="koboSpan" id="kobo.20.1">If you have no experience with networking in Azure, I recommend taking a look at this overview of the </span><a id="_idIndexMarker557"/><span class="koboSpan" id="kobo.21.1">service before</span><a id="_idIndexMarker558"/><span class="koboSpan" id="kobo.22.1"> moving on with </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">the chapter:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.24.1">Virtual </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.25.1">Networks overview</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">:</span></span><p class="list-inset"><a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview"><span class="No-Break"><span class="koboSpan" id="kobo.27.1">https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview</span></span></a></p></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.28.1">Networking </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.29.1">architecture design</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">:</span></span><p class="list-inset"><a href="https://learn.microsoft.com/en-us/azure/architecture/guide/networking/networking-start-here"><span class="No-Break"><span class="koboSpan" id="kobo.31.1">https://learn.microsoft.com/en-us/azure/architecture/guide/networking/networking-start-here</span></span></a><span class="hidden"><a id="_idTextAnchor163"/></span></p></li>
</ul>
<h1 id="_idParaDest-151"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.32.1">Exploring network security</span></h1>
<p><span class="koboSpan" id="kobo.33.1">The Azure Machine Learning workspace</span><a id="_idIndexMarker559"/><span class="koboSpan" id="kobo.34.1"> is the main point of use. </span><span class="koboSpan" id="kobo.34.2">This is where you complete all your ML tasks, and by default, all endpoints and workspace have access to the public internet. </span><span class="koboSpan" id="kobo.34.3">However, if we are already using Azure infrastructure services for different purposes or want to</span><a id="_idIndexMarker560"/><span class="koboSpan" id="kobo.35.1"> restrict access to our resources, we can </span><a id="_idIndexMarker561"/><span class="koboSpan" id="kobo.36.1">leverage </span><strong class="bold"><span class="koboSpan" id="kobo.37.1">virtual networks</span></strong><span class="koboSpan" id="kobo.38.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.39.1">VNets</span></strong><span class="koboSpan" id="kobo.40.1">). </span><span class="koboSpan" id="kobo.40.2">Using VNets in Azure provides an extra layer of security and isolation for our Azure Machine Learning resources and better control for inbound and outbound network communications. </span><span class="koboSpan" id="kobo.40.3">In this section, we will explore several options we have to integrate VNets with Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">Machine Learning.</span></span></p>
<p><span class="koboSpan" id="kobo.42.1">Let us start with </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">the workspace.</span></span></p>
<h2 id="_idParaDest-152"><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.44.1">Creating a VNet</span></h2>
<p><span class="koboSpan" id="kobo.45.1">The first thing we will </span><a id="_idIndexMarker562"/><span class="koboSpan" id="kobo.46.1">need is a VNet. </span><span class="koboSpan" id="kobo.46.2">If you already have one, you can use it. </span><span class="koboSpan" id="kobo.46.3">If not, you can follow the next steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">create one:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.48.1">Search for </span><strong class="bold"><span class="koboSpan" id="kobo.49.1">Virtual Networks</span></strong><span class="koboSpan" id="kobo.50.1"> in the Azure search bar and click to create a new one. </span><span class="koboSpan" id="kobo.50.2">The create form will pop up. </span><span class="koboSpan" id="kobo.50.3">Choose the </span><strong class="bold"><span class="koboSpan" id="kobo.51.1">Subscription</span></strong><span class="koboSpan" id="kobo.52.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.53.1">Resource group</span></strong><span class="koboSpan" id="kobo.54.1"> and provide a </span><strong class="bold"><span class="koboSpan" id="kobo.55.1">Virtual network name</span></strong><span class="koboSpan" id="kobo.56.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.57.1">Region</span></strong><span class="koboSpan" id="kobo.58.1"> as shown in the following screenshot. </span><span class="koboSpan" id="kobo.58.2">Choose the same region as </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">your workspace:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer146">
<span class="koboSpan" id="kobo.60.1"><img alt="Figure 7.1 – Filling in basic details" src="image/B21076_07_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.61.1">Figure 7.1 – Filling in basic details</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.62.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.63.1">Next</span></strong><span class="koboSpan" id="kobo.64.1"> and leave</span><a id="_idIndexMarker563"/><span class="koboSpan" id="kobo.65.1"> the default values until you reach the </span><strong class="bold"><span class="koboSpan" id="kobo.66.1">IP addresses</span></strong><span class="koboSpan" id="kobo.67.1"> tab. </span><span class="koboSpan" id="kobo.67.2">Make sure the address space is adequate and that there is at least one subnet available. </span><span class="koboSpan" id="kobo.67.3">An example is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer147">
<span class="koboSpan" id="kobo.69.1"><img alt="Figure 7.2 – Add the address space" src="image/B21076_07_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.70.1">Figure 7.2 – Add the address space</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.71.1">VNet best practice</span></p>
<p class="callout"><span class="koboSpan" id="kobo.72.1">Make sure the </span><a id="_idIndexMarker564"/><span class="koboSpan" id="kobo.73.1">address space and subnet do not overlap with other networks in your subscription or on-premises systems. </span><span class="koboSpan" id="kobo.73.2">If you need more guidance on creating a VNet architecture, see more</span><a id="_idIndexMarker565"/><span class="koboSpan" id="kobo.74.1"> information </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">at </span></span><a href="https://learn.microsoft.com/en-us/azure/virtual-network/concepts-and-best-practices"><span class="No-Break"><span class="koboSpan" id="kobo.76.1">https://learn.microsoft.com/en-us/azure/virtual-network/concepts-and-best-practices</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.77.1">.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.78.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.79.1">Review + create</span></strong><span class="koboSpan" id="kobo.80.1"> to create</span><a id="_idIndexMarker566"/><span class="koboSpan" id="kobo.81.1"> the VNet. </span><span class="koboSpan" id="kobo.81.2">Wait for the process to complete before you move forward with </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">anything else.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.83.1">Now we are ready to start restricting access to our workspace </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">using VNets.</span></span></p>
<h2 id="_idParaDest-153"><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.85.1">Securing the workspace</span></h2>
<p><span class="koboSpan" id="kobo.86.1">Restricting public access to the </span><a id="_idIndexMarker567"/><span class="koboSpan" id="kobo.87.1">workspace is very easily configurable through the Azure portal and can restrict all inbound and/or outbound connections. </span><span class="koboSpan" id="kobo.87.2">When we are talking about inbound traffic, we refer to connections coming into the Azure ML workspace or associated resources from the public internet. </span><span class="koboSpan" id="kobo.87.3">This can be data being ingested into the Azure ML workspace from on-premises locations, from other cloud resources, or from external applications and platforms. </span><span class="koboSpan" id="kobo.87.4">When you submit a dataset, a job, or any other request from your local machine to Azure Machine Learning, that’s considered inbound traffic. </span><span class="koboSpan" id="kobo.87.5">Outbound traffic is any connection leaving the workspace or associated resources to go elsewhere. </span><span class="koboSpan" id="kobo.87.6">This can be the results from a machine learning model, processed data, logs, and so on being sent back to your local machine, another cloud resource, or an external application </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">or platform.</span></span></p>
<p><span class="koboSpan" id="kobo.89.1">The challenge is to make sure that all associated services to the workspace are also accessible and configured properly through that virtual network and not the public internet. </span><span class="koboSpan" id="kobo.89.2">Something else we need to consider when designing and implementing this solution is that the workspace needs to have outbound access to specific endpoints via the public internet. </span><span class="koboSpan" id="kobo.89.3">If we want to restrict outbound access as well, we need to ensure that these </span><a id="_idIndexMarker568"/><span class="koboSpan" id="kobo.90.1">endpoints maintain their </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">public access.</span></span></p>
<p><span class="koboSpan" id="kobo.92.1">Let us see how we can configure </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">both options.</span></span></p>
<h3><span class="koboSpan" id="kobo.94.1">Restricting inbound traffic</span></h3>
<p><span class="koboSpan" id="kobo.95.1">To restrict inbound traffic from the</span><a id="_idIndexMarker569"/><span class="koboSpan" id="kobo.96.1"> public internet, we need to use a VNet, which we learned how to configure in the preceding section. </span><span class="koboSpan" id="kobo.96.2">Here is the process of disabling public access and using a VNet with </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">our workspace.</span></span></p>
<p><span class="koboSpan" id="kobo.98.1">First, open the Azure Machine Learning resource from the Azure portal and find the </span><strong class="bold"><span class="koboSpan" id="kobo.99.1">Networking</span></strong><span class="koboSpan" id="kobo.100.1"> section. </span><span class="koboSpan" id="kobo.100.2">In the first tab, called </span><strong class="bold"><span class="koboSpan" id="kobo.101.1">Public access</span></strong><span class="koboSpan" id="kobo.102.1">, set the access to </span><strong class="bold"><span class="koboSpan" id="kobo.103.1">Disabled</span></strong><span class="koboSpan" id="kobo.104.1"> and click </span><strong class="bold"><span class="koboSpan" id="kobo.105.1">Save,</span></strong><span class="koboSpan" id="kobo.106.1"> as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">next screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer148">
<span class="koboSpan" id="kobo.108.1"><img alt="Figure 7.3 – Disable public access" src="image/B21076_07_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.109.1">Figure 7.3 – Disable public access</span></p>
<p><span class="koboSpan" id="kobo.110.1">Now we </span><a id="_idIndexMarker570"/><span class="koboSpan" id="kobo.111.1">need to create a private endpoint connection. </span><span class="koboSpan" id="kobo.111.2">Azure Private Link</span><a id="_idIndexMarker571"/><span class="koboSpan" id="kobo.112.1"> is a service in Microsoft’s Azure cloud platform that enables you to securely access Azure services over a private endpoint in your virtual network, thus avoiding data exposure to the public internet. </span><span class="koboSpan" id="kobo.112.2">With Azure Private Link, Azure services can be accessed over a private IP address in your virtual network. </span><span class="koboSpan" id="kobo.112.3">This provides several benefits. </span><span class="koboSpan" id="kobo.112.4">If your virtual network is connected to on-premises work environments via a </span><strong class="bold"><span class="koboSpan" id="kobo.113.1">virtual private network </span></strong><span class="koboSpan" id="kobo.114.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.115.1">VPN</span></strong><span class="koboSpan" id="kobo.116.1">) or </span><a id="_idIndexMarker572"/><span class="koboSpan" id="kobo.117.1">ExpressRoute, resources can access the Azure service over these private connections with the use of Azure Private Link. </span><span class="koboSpan" id="kobo.117.2">Using global VNet peering, we can connect to Azure services from any region. </span><span class="koboSpan" id="kobo.117.3">Azure Private Link integrates with Azure Private DNS zones, meaning that the service’s private endpoint can be registered with a private DNS zone, thus making name resolution </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">more straightforward.</span></span></p>
<p><span class="koboSpan" id="kobo.119.1">Setting up a private endpoint is a straightforward process in the Azure portal. </span><span class="koboSpan" id="kobo.119.2">Once set up, all network traffic between the service provider and the service consumer can be routed through the private endpoint. </span><span class="koboSpan" id="kobo.119.3">So, now that we have disabled public access, we need to create a private link to re-establish access this time via the </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">virtual network.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.121.1">Virtual network peering</span></p>
<p class="callout"><span class="koboSpan" id="kobo.122.1">To learn more about Vnet peering</span><a id="_idIndexMarker573"/><span class="koboSpan" id="kobo.123.1">, visit the </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">following URL:</span></span></p>
<p class="callout"><a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview"><span class="No-Break"><span class="koboSpan" id="kobo.125.1">https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview</span></span></a></p>
<p><span class="koboSpan" id="kobo.126.1">Here is the creation process for the private links/endpoints. </span><span class="koboSpan" id="kobo.126.2">Move on to the next tab, </span><strong class="bold"><span class="koboSpan" id="kobo.127.1">Private endpoint connections</span></strong><span class="koboSpan" id="kobo.128.1">, and click on </span><strong class="bold"><span class="koboSpan" id="kobo.129.1">Private endpoint</span></strong><span class="koboSpan" id="kobo.130.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">create one:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer149">
<span class="koboSpan" id="kobo.132.1"><img alt="Figure 7.4 – Creating a private endpoint" src="image/B21076_07_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.133.1">Figure 7.4 – Creating a private endpoint</span></p>
<p><span class="koboSpan" id="kobo.134.1">On the form, fill in </span><a id="_idIndexMarker574"/><span class="koboSpan" id="kobo.135.1">some basic details including </span><strong class="bold"><span class="koboSpan" id="kobo.136.1">Subscription</span></strong><span class="koboSpan" id="kobo.137.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.138.1">Resource group</span></strong><span class="koboSpan" id="kobo.139.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.140.1">Network interface name</span></strong><span class="koboSpan" id="kobo.141.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.142.1">Region</span></strong><span class="koboSpan" id="kobo.143.1"> and click </span><strong class="bold"><span class="koboSpan" id="kobo.144.1">Next</span></strong><span class="koboSpan" id="kobo.145.1"> as </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer150">
<span class="koboSpan" id="kobo.147.1"><img alt="Figure 7.5 – Filling in the basic details" src="image/B21076_07_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.148.1">Figure 7.5 – Filling in the basic details</span></p>
<p><span class="koboSpan" id="kobo.149.1">On the </span><strong class="bold"><span class="koboSpan" id="kobo.150.1">Resource</span></strong><span class="koboSpan" id="kobo.151.1"> tab, choose </span><strong class="bold"><span class="koboSpan" id="kobo.152.1">amlworkspace</span></strong><span class="koboSpan" id="kobo.153.1"> from the dropdown and </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.155.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer151">
<span class="koboSpan" id="kobo.157.1"><img alt="Figure 7.6 – Choosing the resource" src="image/B21076_07_6.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.158.1">Figure 7.6 – Choosing the resource</span></p>
<p><span class="koboSpan" id="kobo.159.1">Here, we will choose the</span><a id="_idIndexMarker575"/><span class="koboSpan" id="kobo.160.1"> desired VNet. </span><span class="koboSpan" id="kobo.160.2">You have to choose an existing one, so use the one we created previously. </span><span class="koboSpan" id="kobo.160.3">Make sure you select the proper subnet if your VNet has more than one. </span><span class="koboSpan" id="kobo.160.4">Leave the rest of the options </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">as </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.162.1">default</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer152">
<span class="koboSpan" id="kobo.164.1"><img alt="Figure 7.7 – Selecting the virtual network" src="image/B21076_07_7.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.165.1">Figure 7.7 – Selecting the virtual network</span></p>
<p><span class="koboSpan" id="kobo.166.1">Integrating with a</span><a id="_idIndexMarker576"/><span class="koboSpan" id="kobo.167.1"> DNS zone is optional but convenient, as it makes name resolution easier. </span><span class="koboSpan" id="kobo.167.2">Set the </span><strong class="bold"><span class="koboSpan" id="kobo.168.1">Integrate with private DNS zone</span></strong><span class="koboSpan" id="kobo.169.1"> option to </span><strong class="bold"><span class="koboSpan" id="kobo.170.1">Yes</span></strong><span class="koboSpan" id="kobo.171.1"> and then choose the </span><strong class="bold"><span class="koboSpan" id="kobo.172.1">Subscription</span></strong><span class="koboSpan" id="kobo.173.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.174.1">Resource group</span></strong><span class="koboSpan" id="kobo.175.1">. </span><span class="koboSpan" id="kobo.175.2">The service will fill out the rest of </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">the fields.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer153">
<span class="koboSpan" id="kobo.177.1"><img alt="Figure 7.8 – Adding DNS integration" src="image/B21076_07_8.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.178.1">Figure 7.8 – Adding DNS integration</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.179.1">DNS zones overview</span></p>
<p class="callout"><span class="koboSpan" id="kobo.180.1">To learn more about DNS zones</span><a id="_idIndexMarker577"/><span class="koboSpan" id="kobo.181.1"> check the </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">overview here:</span></span></p>
<p class="callout"><a href="https://learn.microsoft.com/en-us/azure/dns/dns-zones-records"><span class="No-Break"><span class="koboSpan" id="kobo.183.1">https://learn.microsoft.com/en-us/azure/dns/dns-zones-records</span></span></a></p>
<p><span class="koboSpan" id="kobo.184.1">Now move on to </span><strong class="bold"><span class="koboSpan" id="kobo.185.1">Review + create</span></strong><span class="koboSpan" id="kobo.186.1"> and start the deployment of the resources. </span><span class="koboSpan" id="kobo.186.2">Wait for this process to be completed before moving on with any </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">other steps.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.188.1">Creating a private Link via the CLI</span></p>
<p class="callout"><span class="koboSpan" id="kobo.189.1">For creating a </span><a id="_idIndexMarker578"/><span class="koboSpan" id="kobo.190.1">private link, you can learn </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">more here:</span></span></p>
<p class="callout"><a href="https://learn.microsoft.com/en-us/azure/machine-learning/how-to-configure-private-link?view=azureml-api-2&amp;tabs=cli"><span class="No-Break"><span class="koboSpan" id="kobo.192.1">https://learn.microsoft.com/en-us/azure/machine-learning/how-to-configure-private-link?view=azureml-api-2&amp;tabs=cli</span></span></a></p>
<p><span class="koboSpan" id="kobo.193.1">If you try to access the workspace at this point, you will get the following error because public access has </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">been disabled.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer154">
<span class="koboSpan" id="kobo.195.1"><img alt="Figure 7.9 – Workspace public access is disabled" src="image/B21076_07_9.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.196.1">Figure 7.9 – Workspace public access is disabled</span></p>
<p><span class="koboSpan" id="kobo.197.1">This was the basic</span><a id="_idIndexMarker579"/><span class="koboSpan" id="kobo.198.1"> configuration for the workspace’s inbound access. </span><span class="koboSpan" id="kobo.198.2">Before we validate the access through the VNet, we should first configure outbound traffic and restrict access to associated services </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.200.1">Let us start with </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">outbound traffic.</span></span></p>
<h3><span class="koboSpan" id="kobo.202.1">Restricting outbound traffic</span></h3>
<p><span class="koboSpan" id="kobo.203.1">To restrict outbound</span><a id="_idIndexMarker580"/><span class="koboSpan" id="kobo.204.1"> traffic, we will go through the </span><strong class="bold"><span class="koboSpan" id="kobo.205.1">Networking</span></strong><span class="koboSpan" id="kobo.206.1"> blade again in Azure Machine Learning, but this time, we will click on the </span><strong class="bold"><span class="koboSpan" id="kobo.207.1">Workspace managed outbound </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.208.1">access</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.209.1"> tab:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer155">
<span class="koboSpan" id="kobo.210.1"><img alt="Figure 7.10 – Restricting outbound traffic" src="image/B21076_07_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.211.1">Figure 7.10 – Restricting outbound traffic</span></p>
<p><span class="koboSpan" id="kobo.212.1">To restrict</span><a id="_idIndexMarker581"/><span class="koboSpan" id="kobo.213.1"> outbound traffic, we have two options: </span><strong class="bold"><span class="koboSpan" id="kobo.214.1">Allow Internet Outbound</span></strong><span class="koboSpan" id="kobo.215.1"> where only compute is limited and </span><strong class="bold"><span class="koboSpan" id="kobo.216.1">Allow Only Approved Outbound</span></strong><span class="koboSpan" id="kobo.217.1"> where both compute and all outbound data movement </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">are limited.</span></span></p>
<p><span class="koboSpan" id="kobo.219.1">Both of those options have some connection exceptions that you can see when enabling the options at the bottom of the screen. </span><span class="koboSpan" id="kobo.219.2">You can add some rules of your own, but the default ones cannot </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">be disabled.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer156">
<span class="koboSpan" id="kobo.221.1"><img alt="Figure 7.11 – Allowing only approved outbound option" src="image/B21076_07_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.222.1">Figure 7.11 – Allowing only approved outbound option</span></p>
<p><span class="koboSpan" id="kobo.223.1">If you are also using a firewall together with the network, make sure the connectivity is enabled through there as well, as restricting access to those resources will result in connectivity issues in the workspace and an inability to work with </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">the services.</span></span></p>
<p><span class="koboSpan" id="kobo.225.1">Securing the workspace was only the first step. </span><span class="koboSpan" id="kobo.225.2">Now we need to ensure that associated resources are also secured through </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">the VNet.</span></span></p>
<h2 id="_idParaDest-154"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.227.1">Securing associated resources</span></h2>
<p><span class="koboSpan" id="kobo.228.1">As </span><a id="_idIndexMarker582"/><span class="koboSpan" id="kobo.229.1">mentioned in </span><a href="B21076_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.230.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.231.1">, the workspace works closely with many resources, including storage accounts and key vaults, which are created to support the workspace. </span><span class="koboSpan" id="kobo.231.2">We need to configure the same networking settings if we truly want to ensure that they connect properly to the workspace through the Microsoft network but still maintain isolation from the public internet. </span><span class="koboSpan" id="kobo.231.3">The first thing we need to do is disable public access to those services </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.233.1">To disable public access and restrict the account to specific networks, we can go to the </span><strong class="bold"><span class="koboSpan" id="kobo.234.1">Networking</span></strong><span class="koboSpan" id="kobo.235.1"> tab in the </span><strong class="bold"><span class="koboSpan" id="kobo.236.1">Storage </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.237.1">account</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.238.1"> blade.</span></span></p>
<p><span class="koboSpan" id="kobo.239.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.240.1">Public network access</span></strong><span class="koboSpan" id="kobo.241.1"> options, click </span><strong class="bold"><span class="koboSpan" id="kobo.242.1">Enabled from selected virtual networks and ID addresses</span></strong><span class="koboSpan" id="kobo.243.1">. </span><span class="koboSpan" id="kobo.243.2">Then, choose the previously created VNet in the </span><strong class="bold"><span class="koboSpan" id="kobo.244.1">Virtual networks</span></strong><span class="koboSpan" id="kobo.245.1"> section and subnet by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.246.1">Add existing virtual network </span></strong><span class="koboSpan" id="kobo.247.1">button and </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.249.1">Save</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.251.1">The final view should look like the </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer157">
<span class="koboSpan" id="kobo.253.1"><img alt="Figure 7.12 – Disabling public access in the storage account" src="image/B21076_07_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.254.1">Figure 7.12 – Disabling public access in the storage account</span></p>
<p><span class="koboSpan" id="kobo.255.1">The next step is to do something similar this time to the key vault associated with the workspace. </span><span class="koboSpan" id="kobo.255.2">The steps are exactly the same </span><span class="No-Break"><span class="koboSpan" id="kobo.256.1">as previously.</span></span></p>
<p><span class="koboSpan" id="kobo.257.1">To disable public access and restrict the account to specific networks, we can go to the </span><strong class="bold"><span class="koboSpan" id="kobo.258.1">Networking </span></strong><span class="koboSpan" id="kobo.259.1">tab in the </span><strong class="bold"><span class="koboSpan" id="kobo.260.1">Storage account</span></strong><span class="koboSpan" id="kobo.261.1"> blade. </span><span class="koboSpan" id="kobo.261.2">For the </span><strong class="bold"><span class="koboSpan" id="kobo.262.1">Public network access </span></strong><span class="koboSpan" id="kobo.263.1">option, click on </span><strong class="bold"><span class="koboSpan" id="kobo.264.1">Enabled from selected virtual networks and ID addresses</span></strong><span class="koboSpan" id="kobo.265.1">. </span><span class="koboSpan" id="kobo.265.2">Then, choose the previously created VNet in the </span><strong class="bold"><span class="koboSpan" id="kobo.266.1">Virtual networks</span></strong><span class="koboSpan" id="kobo.267.1"> section and the subnet by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">Add existing virtual network</span></strong><span class="koboSpan" id="kobo.269.1"> button and </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">clicking </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.271.1">Save</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.273.1">The final </span><a id="_idIndexMarker583"/><span class="koboSpan" id="kobo.274.1">view should look like </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer158">
<span class="koboSpan" id="kobo.276.1"><img alt="Figure 7.13 – Disabling public access in the key vault" src="image/B21076_07_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.277.1">Figure 7.13 – Disabling public access in the key vault</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.278.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.279.1">We can still configure service endpoints without restricting network access to the services. </span><span class="koboSpan" id="kobo.279.2">In this case, traffic from the workspace will go through the VNet and any other traffic will still access the services through the public internet. </span><span class="koboSpan" id="kobo.279.3">Doing both ensures </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">better isolation.</span></span></p>
<p><span class="koboSpan" id="kobo.281.1">Now that we have disabled public access, we have two options for configuration: enabling service endpoints or creating private endpoints for </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">each service.</span></span></p>
<p><span class="koboSpan" id="kobo.283.1">Let us explore both options starting with </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">service endpoints.</span></span></p>
<h3><span class="koboSpan" id="kobo.285.1">Option 1: configuring service endpoints</span></h3>
<p><span class="koboSpan" id="kobo.286.1">This is the </span><a id="_idIndexMarker584"/><span class="koboSpan" id="kobo.287.1">easiest and fastest option. </span><span class="koboSpan" id="kobo.287.2">Service endpoints in Azure provide enhanced security and optimized routing for VNets by extending your VNet’s private address space over to Azure service resources. </span><span class="koboSpan" id="kobo.287.3">This allows you to secure Azure service resources to </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">your VNet.</span></span></p>
<p><span class="koboSpan" id="kobo.289.1">Open the VNet we created previously and go to the </span><strong class="bold"><span class="koboSpan" id="kobo.290.1">Subnets</span></strong><span class="koboSpan" id="kobo.291.1"> section. </span><span class="koboSpan" id="kobo.291.2">Click on the desired subnet and scroll down in the popup on </span><span class="No-Break"><span class="koboSpan" id="kobo.292.1">the right.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer159">
<span class="koboSpan" id="kobo.293.1"><img alt="Figure 7.14 – Allowing only approved outbound traffic" src="image/B21076_07_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.294.1">Figure 7.14 – Allowing only approved outbound traffic</span></p>
<p><span class="koboSpan" id="kobo.295.1">It is essential to note that while service endpoints are beneficial for many scenarios, there are cases where you might consider using Azure Private Link or Private Endpoints instead, especially when you want Azure services to be accessed via private IP addresses in </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">your VNet.</span></span></p>
<p><span class="koboSpan" id="kobo.297.1">So, let us see how to implement this </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">option next.</span></span></p>
<h3><span class="koboSpan" id="kobo.299.1">Option 2: creating private endpoints</span></h3>
<p><span class="koboSpan" id="kobo.300.1">The process of creating </span><a id="_idIndexMarker585"/><span class="koboSpan" id="kobo.301.1">private endpoints is similar to the one we use to create the public endpoint for the workspace. </span><span class="koboSpan" id="kobo.301.2">Let us see the steps for </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">each service.</span></span></p>
<h4><span class="koboSpan" id="kobo.303.1">Azure storage account</span></h4>
<p><span class="koboSpan" id="kobo.304.1">From the </span><strong class="bold"><span class="koboSpan" id="kobo.305.1">Networking</span></strong><span class="koboSpan" id="kobo.306.1"> screen</span><a id="_idIndexMarker586"/><span class="koboSpan" id="kobo.307.1"> of the </span><strong class="bold"><span class="koboSpan" id="kobo.308.1">Storage account</span></strong><span class="koboSpan" id="kobo.309.1"> resource, click on </span><strong class="bold"><span class="koboSpan" id="kobo.310.1">Private endpoint connections</span></strong><span class="koboSpan" id="kobo.311.1">. </span><span class="koboSpan" id="kobo.311.2">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.312.1">+ Private endpoint </span></strong><span class="koboSpan" id="kobo.313.1">button and follow the tabs as we did previously for </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">the </span></span><span class="No-Break"><a id="_idIndexMarker587"/></span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">workspace.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer160">
<span class="koboSpan" id="kobo.316.1"><img alt="Figure 7.15 – Creating a private endpoint" src="image/B21076_07_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.317.1">Figure 7.15 – Creating a private endpoint</span></p>
<p><span class="koboSpan" id="kobo.318.1">Fill in some basic information for the endpoint, as seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer161">
<span class="koboSpan" id="kobo.320.1"><img alt="Figure 7.16 – Filling in the basics" src="image/B21076_07_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.321.1">Figure 7.16 – Filling in the basics</span></p>
<p><span class="koboSpan" id="kobo.322.1">Then, on </span><a id="_idIndexMarker588"/><span class="koboSpan" id="kobo.323.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.324.1">Resource</span></strong><span class="koboSpan" id="kobo.325.1"> tab for the </span><strong class="bold"><span class="koboSpan" id="kobo.326.1">Target sub-resource</span></strong><span class="koboSpan" id="kobo.327.1">, choose </span><strong class="bold"><span class="koboSpan" id="kobo.328.1">blob</span></strong><span class="koboSpan" id="kobo.329.1"> from </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">the dropdown:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer162">
<span class="koboSpan" id="kobo.331.1"><img alt="Figure 7.17 – Choosing the blob resource" src="image/B21076_07_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.332.1">Figure 7.17 – Choosing the blob resource</span></p>
<p><span class="koboSpan" id="kobo.333.1">Go through the rest of the tabs exactly as for the workspace, filling in the </span><strong class="bold"><span class="koboSpan" id="kobo.334.1">Virtual Network</span></strong><span class="koboSpan" id="kobo.335.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.336.1">DNS</span></strong><span class="koboSpan" id="kobo.337.1">, and then going to </span><strong class="bold"><span class="koboSpan" id="kobo.338.1">Review + </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.339.1">create</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.341.1">Once you have completed this process, create another private endpoint, this time choosing </span><strong class="bold"><span class="koboSpan" id="kobo.342.1">file</span></strong><span class="koboSpan" id="kobo.343.1"> for the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.344.1">Target sub-resource</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.346.1">Once we are</span><a id="_idIndexMarker589"/><span class="koboSpan" id="kobo.347.1"> done with the storage account, here is how to do the same for the </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">key vault.</span></span></p>
<h4><span class="koboSpan" id="kobo.349.1">Azure Key Vault</span></h4>
<p><span class="koboSpan" id="kobo.350.1">From the </span><strong class="bold"><span class="koboSpan" id="kobo.351.1">Networking</span></strong><span class="koboSpan" id="kobo.352.1"> screen of the key </span><a id="_idIndexMarker590"/><span class="koboSpan" id="kobo.353.1">vault resource, click on </span><strong class="bold"><span class="koboSpan" id="kobo.354.1">Private endpoint connections</span></strong><span class="koboSpan" id="kobo.355.1">. </span><span class="koboSpan" id="kobo.355.2">Click the</span><strong class="bold"><span class="koboSpan" id="kobo.356.1"> + Private endpoint</span></strong><span class="koboSpan" id="kobo.357.1"> button and follow the tabs as we did previously in the chapter for the </span><span class="No-Break"><span class="koboSpan" id="kobo.358.1">storage account:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer163">
<span class="koboSpan" id="kobo.359.1"><img alt="Figure 7.18 – Creating a private endpoint" src="image/B21076_07_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.360.1">Figure 7.18 – Creating a private endpoint</span></p>
<p><span class="koboSpan" id="kobo.361.1">Fill in some basic information for the endpoint, as seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer164">
<span class="koboSpan" id="kobo.363.1"><img alt="Figure 7.19 – Filling in the basics" src="image/B21076_07_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.364.1">Figure 7.19 – Filling in the basics</span></p>
<p><span class="koboSpan" id="kobo.365.1">Then, on the </span><a id="_idIndexMarker591"/><span class="koboSpan" id="kobo.366.1">Resource tab for the </span><strong class="bold"><span class="koboSpan" id="kobo.367.1">Target sub-resource</span></strong><span class="koboSpan" id="kobo.368.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">choose </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.370.1">vault</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer165">
<span class="koboSpan" id="kobo.372.1"><img alt="Figure 7.20 – Choosing the vault resource" src="image/B21076_07_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.373.1">Figure 7.20 – Choosing the vault resource</span></p>
<p><span class="koboSpan" id="kobo.374.1">Again, go </span><a id="_idIndexMarker592"/><span class="koboSpan" id="kobo.375.1">through the rest of the tabs exactly as for the storage account, filling in the </span><strong class="bold"><span class="koboSpan" id="kobo.376.1">Virtual Network</span></strong><span class="koboSpan" id="kobo.377.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.378.1">DNS</span></strong><span class="koboSpan" id="kobo.379.1"> and then going to </span><strong class="bold"><span class="koboSpan" id="kobo.380.1">Review + </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.381.1">create</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.383.1">We have completed the minimum required configurations. </span><span class="koboSpan" id="kobo.383.2">Now it is time to test it! </span><span class="koboSpan" id="kobo.383.3">Let us review some options to </span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">test connectivity.</span></span></p>
<h2 id="_idParaDest-155"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.385.1">Validating connectivity</span></h2>
<p><span class="koboSpan" id="kobo.386.1">In order to connect to a</span><a id="_idIndexMarker593"/><span class="koboSpan" id="kobo.387.1"> workspace that is behind a firewall, we have many options. </span><span class="koboSpan" id="kobo.387.2">They depend mostly on your individual Azure infrastructure </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">and requirements.</span></span></p>
<p><span class="koboSpan" id="kobo.389.1">Let us review </span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">those options:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.391.1">Connecting from on-premises systems</span></strong><span class="koboSpan" id="kobo.392.1">: There is one option to establish secure, encrypted communications between your on-premises networks and Azure. </span><span class="koboSpan" id="kobo.392.2">It is done via a VPN gateway through the public internet. </span><span class="koboSpan" id="kobo.392.3">Azure offers two types of</span><a id="_idIndexMarker594"/><span class="koboSpan" id="kobo.393.1"> gateways: </span><strong class="bold"><span class="koboSpan" id="kobo.394.1">VPN Gateway</span></strong><span class="koboSpan" id="kobo.395.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.396.1">ExpressRoute</span></strong><span class="koboSpan" id="kobo.397.1">. </span><span class="koboSpan" id="kobo.397.2">It’s</span><a id="_idIndexMarker595"/><span class="koboSpan" id="kobo.398.1"> important to choose the appropriate VPN solution, as they will have access to your internet activity, and not all VPN options offer the same level of security, privacy, </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">and speed.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.400.1">VPN solutions on Azure</span></p>
<p class="callout"><span class="koboSpan" id="kobo.401.1">Here, you can find more information about the VPN gateway and ExpressRoute services </span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">in Azure.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.403.1">For VPN </span><a id="_idIndexMarker596"/><span class="koboSpan" id="kobo.404.1">Gateway, </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">see </span></span><a href="https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways"><span class="No-Break"><span class="koboSpan" id="kobo.406.1">https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.407.1">.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.408.1">For </span><a id="_idIndexMarker597"/><span class="koboSpan" id="kobo.409.1">ExpressRoute, </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">see </span></span><a href="https://learn.microsoft.com/en-us/azure/expressroute/expressroute-introduction"><span class="No-Break"><span class="koboSpan" id="kobo.411.1">https://learn.microsoft.com/en-us/azure/expressroute/expressroute-introduction</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.412.1">.</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.413.1">Connecting from cloud infrastructure</span></strong><span class="koboSpan" id="kobo.414.1">: We can always create a virtual machine—also sometimes referred to as</span><a id="_idIndexMarker598"/><span class="koboSpan" id="kobo.415.1"> a </span><strong class="bold"><span class="koboSpan" id="kobo.416.1">jump box</span></strong><span class="koboSpan" id="kobo.417.1">—that we will connect to. </span><span class="koboSpan" id="kobo.417.2">From there, we can access the services restricted by the network. </span><span class="koboSpan" id="kobo.417.3">In addition, you can enable </span><strong class="bold"><span class="koboSpan" id="kobo.418.1">Azure Bastion</span></strong><span class="koboSpan" id="kobo.419.1"> in the VM and access the machine through the browser without </span><a id="_idIndexMarker599"/><span class="koboSpan" id="kobo.420.1">configuring public IPs on the VM, which reduces exposure to </span><span class="No-Break"><span class="koboSpan" id="kobo.421.1">security vulnerabilities.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.422.1">For our example, we will use a VM in Azure deployed in the same VNet that the Azure Machine Learning workspace and associated services are behind. </span><span class="koboSpan" id="kobo.422.2">All you need to do is create a VM deployed in the same network or a peered network and try to access </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">the workspace.</span></span></p></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.424.1">Quickstart: create a VM in the portal</span></p>
<p class="callout"><span class="koboSpan" id="kobo.425.1">If you need to get started with VMs, check this quickstart </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">guide here:</span></span></p>
<p class="callout"><a href="https://learn.microsoft.com/en-us/azure/virtual-machines/windows/quick-create-portal"><span class="No-Break"><span class="koboSpan" id="kobo.427.1">https://learn.microsoft.com/en-us/azure/virtual-machines/windows/quick-create-portal</span></span></a></p>
<p><span class="koboSpan" id="kobo.428.1">The result is as expected. </span><span class="koboSpan" id="kobo.428.2">We</span><a id="_idIndexMarker600"/><span class="koboSpan" id="kobo.429.1"> can access the workspace from the device inside the network, but everything outside the network is disabled. </span><span class="koboSpan" id="kobo.429.2">Here is a screenshot with a VM that is in the same VNet as the workspace accessing the page (left) and a browser trying to access the same workspace (right) through the </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">public internet:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer166">
<span class="koboSpan" id="kobo.431.1"><img alt="Figure 7.21 – Public access disabled" src="image/B21076_07_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.432.1">Figure 7.21 – Public access disabled</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.433.1">VM security best practices</span></p>
<p class="callout"><span class="koboSpan" id="kobo.434.1">To increase isolation and security, there are multiple ways to secure either the network itself or the VMs that </span><a id="_idIndexMarker601"/><span class="koboSpan" id="kobo.435.1">belong to it. </span><span class="koboSpan" id="kobo.435.2">As an </span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.436.1">example, you</span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.437.1"> can review the </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">following services:</span></span></p>
<ul>
<li class="callout"><strong class="bold"><span class="koboSpan" id="kobo.439.1">Network security </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.440.1">groups</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">: </span></span><a href="https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview"><span class="No-Break"><span class="koboSpan" id="kobo.442.1">https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview</span></span></a></li>
<li class="callout"><strong class="bold"><span class="koboSpan" id="kobo.443.1">Azure </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.444.1">Firewall</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">: </span></span><a href="https://learn.microsoft.com/en-us/azure/firewall/overview"><span class="No-Break"><span class="koboSpan" id="kobo.446.1">https://learn.microsoft.com/en-us/azure/firewall/overview</span></span></a></li>
<li class="callout"><strong class="bold"><span class="koboSpan" id="kobo.447.1">Azure </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.448.1">Bastion</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.449.1">:</span></span><span class="No-Break"><span class="hidden"> </span></span><a href="https://learn.microsoft.com/en-us/azure/bastion/bastion-overview"><span class="No-Break"><span class="koboSpan" id="kobo.450.1">https://learn.microsoft.com/en-us/azure/bastion/bastion-overview</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.451.1">We can secure </span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.452.1">associated resources in a similar way, such as in databases and other types of data storages that can be used in Azure Machine Learning. </span><span class="koboSpan" id="kobo.452.2">If the services are already part of other VNets, we can always connect different networks via network peering as long as our VNets do not have overlapping addresses. </span><span class="koboSpan" id="kobo.452.3">We can connect networks by using VNet peering in the same or different subscriptions so ultimately your decision on how to segregate the networks in Azure is based on individual </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">organizational requirements.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.454.1">Network architecture in Azure</span></p>
<p class="callout"><span class="koboSpan" id="kobo.455.1">Find out more </span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.456.1">about network architectures by exploring network peering, the </span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.457.1">hub-spoke topology, and Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">landing zones:</span></span></p>
<ul>
<li class="callout"><span class="koboSpan" id="kobo.459.1">VNet </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">peering: </span></span><a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview"><span class="No-Break"><span class="koboSpan" id="kobo.461.1">https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview</span></span></a></li>
<li class="callout"><span class="No-Break"><span class="koboSpan" id="kobo.462.1">Hub-spoke: </span></span><a href="https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/hub-s"><span class="No-Break"><span class="koboSpan" id="kobo.463.1">https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?tabs=cli</span></span></a></li>
<li class="callout"><span class="koboSpan" id="kobo.464.1">Azure</span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.465.1"> landing </span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">zones: </span></span><a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/landing-zone/"><span class="No-Break"><span class="koboSpan" id="kobo.467.1">https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/landing-zone/</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.468.1">By integrating Azure Machine Learning with Azure VNets, we are adding an essential layer of security that will help in safeguarding our data, models, and other resources from unauthorized access and threats. </span><span class="koboSpan" id="kobo.468.2">Let us not forget to always monitor and regularly review the security measures to adapt to the evolving </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">threat landscape.</span></span></p>
<p><span class="koboSpan" id="kobo.470.1">Let us now explore further security practices for the workspace, starting with Azure Machine </span><span class="No-Break"><span class="koboSpan" id="kobo.471.1">Learning compute.</span></span></p>
<h1 id="_idParaDest-156"><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.472.1">Working with Azure Machine Learning compute</span></h1>
<p><span class="koboSpan" id="kobo.473.1">Azure Machine Learning </span><a id="_idIndexMarker608"/><span class="koboSpan" id="kobo.474.1">provides a scalable cloud environment to build, train, and deploy ML models. </span><span class="koboSpan" id="kobo.474.2">It offers different computational targets for running experiments, training models, and </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">serving predictions.</span></span></p>
<p><span class="koboSpan" id="kobo.476.1">There are four targets overall, with two of these being managed internally from the workspace: </span><strong class="bold"><span class="koboSpan" id="kobo.477.1">compute instances</span></strong><span class="koboSpan" id="kobo.478.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.479.1">compute clusters</span></strong><span class="koboSpan" id="kobo.480.1">. </span><span class="koboSpan" id="kobo.480.2">A compute instance</span><a id="_idIndexMarker609"/><span class="koboSpan" id="kobo.481.1"> is a managed VM that you use for development, training, and inferencing needs. </span><span class="koboSpan" id="kobo.481.2">It’s essentially a dedicated, personal workstation in the workspace. </span><span class="koboSpan" id="kobo.481.3">It can be used to run Jupyter notebooks and scripts. </span><span class="koboSpan" id="kobo.481.4">A compute cluster is a managed scalable set of virtual machines that are used for the large-scale training of ML models. </span><span class="koboSpan" id="kobo.481.5">Compute clusters </span><a id="_idIndexMarker610"/><span class="koboSpan" id="kobo.482.1">automatically scale up or down (within the limits you set) based on the workload. </span><span class="koboSpan" id="kobo.482.2">So, for example, you can declare a minimum and maximum node and the machine will scale based on demand, which helps us optimize costs. </span><span class="koboSpan" id="kobo.482.3">There is also external compute, which you can use for inferencing, specifically the Azure Kubernetes service. </span><span class="koboSpan" id="kobo.482.4">You can also attach compute for training from external services to the workspace like Ubuntu VMs or </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">Databricks compute.</span></span></p>
<p><span class="koboSpan" id="kobo.484.1">In this section, we will focus on securing the internal resources. </span><span class="koboSpan" id="kobo.484.2">For external services, you must find the best practices for securing each service. </span><span class="koboSpan" id="kobo.484.3">Here are some links to give you more information about securing inference and </span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">attached compute:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.486.1">Azure Kubernetes</span><a id="_idIndexMarker611"/> <span class="No-Break"><span class="koboSpan" id="kobo.487.1">Service: </span></span><a href="https://learn.microsoft.com/en-us/azure/aks/concepts-security "><span class="No-Break"><span class="koboSpan" id="kobo.488.1">https://learn.microsoft.com/en-us/azure/aks/concepts-security</span></span></a></li>
<li><span class="koboSpan" id="kobo.489.1">Virtual Machine </span><a id="_idIndexMarker612"/><span class="No-Break"><span class="koboSpan" id="kobo.490.1">security: </span></span><a href="https://learn.microsoft.com/en-us/azure/virtual-machines/security-recommendations "><span class="No-Break"><span class="koboSpan" id="kobo.491.1">https://learn.microsoft.com/en-us/azure/virtual-machines/security-recommendations</span></span></a></li>
<li><span class="koboSpan" id="kobo.492.1">Azure Databricks security</span><a id="_idIndexMarker613"/> <span class="No-Break"><span class="koboSpan" id="kobo.493.1">guide: </span></span><a href="https://learn.microsoft.com/en-us/azure/databricks/security/"><span class="No-Break"><span class="koboSpan" id="kobo.494.1">https://learn.microsoft.com/en-us/azure/databricks/security/</span></span></a></li>
<li><span class="koboSpan" id="kobo.495.1">Azure Data Lake security </span><a id="_idIndexMarker614"/><span class="No-Break"><span class="koboSpan" id="kobo.496.1">baseline: </span></span><a href="https://learn.microsoft.com/en-us/security/benchmark/azure/baselines/data-lake-analytics-security-baseline "><span class="No-Break"><span class="koboSpan" id="kobo.497.1">https://learn.microsoft.com/en-us/security/benchmark/azure/baselines/data-lake-analytics-security-baseline</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.498.1">The following sections will help you understand how to secure compute instances and </span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">compute clusters.</span></span></p>
<h2 id="_idParaDest-157"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.500.1">Securing compute instances</span></h2>
<p><span class="koboSpan" id="kobo.501.1">The basis of securing both compute</span><a id="_idIndexMarker615"/><span class="koboSpan" id="kobo.502.1"> instances and compute clusters lies in the combination of using managed identities and network isolation. </span><span class="koboSpan" id="kobo.502.2">Let us follow along with the steps to enable them starting with </span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">compute instances.</span></span></p>
<p><span class="koboSpan" id="kobo.504.1">From the Azure Machine </span><a id="_idIndexMarker616"/><span class="koboSpan" id="kobo.505.1">Learning workspace, find the </span><strong class="bold"><span class="koboSpan" id="kobo.506.1">Compute</span></strong><span class="koboSpan" id="kobo.507.1"> menu under </span><strong class="bold"><span class="koboSpan" id="kobo.508.1">Manage</span></strong><span class="koboSpan" id="kobo.509.1"> and open it to view the list of available compute. </span><span class="koboSpan" id="kobo.509.2">In the </span><strong class="bold"><span class="koboSpan" id="kobo.510.1">Compute instances</span></strong><span class="koboSpan" id="kobo.511.1"> tab, click </span><strong class="bold"><span class="koboSpan" id="kobo.512.1">+ New</span></strong><span class="koboSpan" id="kobo.513.1"> to create a new </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">compute instance:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer167">
<span class="koboSpan" id="kobo.515.1"><img alt="Figure 7.22 – New compute instance" src="image/B21076_07_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.516.1">Figure 7.22 – New compute instance</span></p>
<p><span class="koboSpan" id="kobo.517.1">Fill in all tabs as desired until you reach the </span><strong class="bold"><span class="koboSpan" id="kobo.518.1">Security</span></strong><span class="koboSpan" id="kobo.519.1"> tab. </span><span class="koboSpan" id="kobo.519.2">Enable the </span><strong class="bold"><span class="koboSpan" id="kobo.520.1">Assign a managed identity</span></strong><span class="koboSpan" id="kobo.521.1"> button and leave the </span><strong class="bold"><span class="koboSpan" id="kobo.522.1">Identity</span></strong><span class="koboSpan" id="kobo.523.1"> type as </span><strong class="bold"><span class="koboSpan" id="kobo.524.1">System-assigned</span></strong><span class="koboSpan" id="kobo.525.1">. </span><span class="koboSpan" id="kobo.525.2">Ensure that the </span><strong class="bold"><span class="koboSpan" id="kobo.526.1">SSH</span></strong><span class="koboSpan" id="kobo.527.1"> button is disabled to prevent public access, as when using a VNet, you can still </span><strong class="bold"><span class="koboSpan" id="kobo.528.1">Secure Shell</span></strong><span class="koboSpan" id="kobo.529.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.530.1">SSH</span></strong><span class="koboSpan" id="kobo.531.1">) within </span><a id="_idIndexMarker617"/><span class="koboSpan" id="kobo.532.1">that VNet to the machine. </span><span class="koboSpan" id="kobo.532.2">If you have previously restricted access to the workspace and associated resources, </span><strong class="bold"><span class="koboSpan" id="kobo.533.1">Enable virtual network</span></strong><span class="koboSpan" id="kobo.534.1"> will be enabled by default, making it mandatory to choose a </span><strong class="bold"><span class="koboSpan" id="kobo.535.1">Virtual network</span></strong><span class="koboSpan" id="kobo.536.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.537.1">Subnet</span></strong><span class="koboSpan" id="kobo.538.1">. </span><span class="koboSpan" id="kobo.538.2">Choose the one </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">created previously:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer168">
<span class="koboSpan" id="kobo.540.1"><img alt="Figure 7.23 – Setting compute instance security" src="image/B21076_07_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.541.1">Figure 7.23 – Setting compute instance security</span></p>
<p><span class="koboSpan" id="kobo.542.1">Fill in the rest of the tabs </span><a id="_idIndexMarker618"/><span class="koboSpan" id="kobo.543.1">as desired and create the compute. </span><span class="koboSpan" id="kobo.543.2">Remember to use the proper credentials in the scripts when using this compute </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">for training.</span></span></p>
<p><span class="koboSpan" id="kobo.545.1">Let us move on to securing </span><span class="No-Break"><span class="koboSpan" id="kobo.546.1">compute clusters.</span></span></p>
<h2 id="_idParaDest-158"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.547.1">Securing compute clusters</span></h2>
<p><span class="koboSpan" id="kobo.548.1">The process of </span><a id="_idIndexMarker619"/><span class="koboSpan" id="kobo.549.1">securing compute clusters is very similar. </span><span class="koboSpan" id="kobo.549.2">To initiate the process from the </span><strong class="bold"><span class="koboSpan" id="kobo.550.1">Compute</span></strong><span class="koboSpan" id="kobo.551.1"> menu under </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">Manage</span></strong><span class="koboSpan" id="kobo.553.1">, choose the </span><strong class="bold"><span class="koboSpan" id="kobo.554.1">Compute clusters</span></strong><span class="koboSpan" id="kobo.555.1"> tab and click </span><strong class="bold"><span class="koboSpan" id="kobo.556.1">+ New</span></strong><span class="koboSpan" id="kobo.557.1"> to create a new </span><span class="No-Break"><span class="koboSpan" id="kobo.558.1">compute instance:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer169">
<span class="koboSpan" id="kobo.559.1"><img alt="Figure 7.24 – New compute cluster" src="image/B21076_07_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.560.1">Figure 7.24 – New compute cluster</span></p>
<p><span class="koboSpan" id="kobo.561.1">Fill in the </span><strong class="bold"><span class="koboSpan" id="kobo.562.1">Virtual machine</span></strong><span class="koboSpan" id="kobo.563.1"> tab as desired until you reach the </span><strong class="bold"><span class="koboSpan" id="kobo.564.1">Advanced settings</span></strong><span class="koboSpan" id="kobo.565.1"> tab. </span><span class="koboSpan" id="kobo.565.2">Scroll down until you reach the </span><strong class="bold"><span class="koboSpan" id="kobo.566.1">Advanced settings</span></strong><span class="koboSpan" id="kobo.567.1"> drop-down and ensure that </span><strong class="bold"><span class="koboSpan" id="kobo.568.1">Enable SSH access</span></strong><span class="koboSpan" id="kobo.569.1"> is disabled to prevent public access, enable </span><strong class="bold"><span class="koboSpan" id="kobo.570.1">Assign a managed identity</span></strong><span class="koboSpan" id="kobo.571.1">, and leave the </span><strong class="bold"><span class="koboSpan" id="kobo.572.1">Identity type</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.573.1">as </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.574.1">System-assigned</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.576.1">If you have previously</span><a id="_idIndexMarker620"/><span class="koboSpan" id="kobo.577.1"> restricted access to the workspace and associated resources, again, the </span><strong class="bold"><span class="koboSpan" id="kobo.578.1">Enable virtual network</span></strong><span class="koboSpan" id="kobo.579.1"> will be enabled by default, making it mandatory to choose a </span><strong class="bold"><span class="koboSpan" id="kobo.580.1">Virtual network</span></strong><span class="koboSpan" id="kobo.581.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.582.1">Subnet</span></strong><span class="koboSpan" id="kobo.583.1">. </span><span class="koboSpan" id="kobo.583.2">Choose the one created previously, as demonstrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer170">
<span class="koboSpan" id="kobo.585.1"><img alt="Figure 7.25 – Setting compute cluster security" src="image/B21076_07_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.586.1">Figure 7.25 – Setting compute cluster security</span></p>
<p><span class="koboSpan" id="kobo.587.1">The process might </span><a id="_idIndexMarker621"/><span class="koboSpan" id="kobo.588.1">be simple, but it is enough to isolate our compute resources from the public internet, preventing further vulnerabilities. </span><span class="koboSpan" id="kobo.588.2">Just remember that when running scripts on notebooks through compute, ensure the appropriate credentials are passed in the code. </span><span class="koboSpan" id="kobo.588.3">For an example of how to use managed identities, review the </span><em class="italic"><span class="koboSpan" id="kobo.589.1">Working with managed identities</span></em><span class="koboSpan" id="kobo.590.1"> section in </span><a href="B21076_06.xhtml#_idTextAnchor141"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.591.1">Chapter 6</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.592.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.593.1">Let us review the last resource associated with the workspace and its security features: Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.594.1">Container Registry.</span></span></p>
<h1 id="_idParaDest-159"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.595.1">Managing container registries and containers</span></h1>
<p><span class="koboSpan" id="kobo.596.1">Azure Machine Learning</span><a id="_idIndexMarker622"/><span class="koboSpan" id="kobo.597.1"> provides an integrated, end-to-end data science workflow, enabling data scientists and developers to prepare data, experiment with models, and then deploy them in a scalable environment. </span><span class="koboSpan" id="kobo.597.2">A pivotal aspect of this deployment process involves containerization, which brings us to </span><strong class="bold"><span class="koboSpan" id="kobo.598.1">Azure Container Registry</span></strong><span class="koboSpan" id="kobo.599.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.600.1">ACR</span></strong><span class="koboSpan" id="kobo.601.1">). </span><span class="koboSpan" id="kobo.601.2">ACR</span><a id="_idIndexMarker623"/><span class="koboSpan" id="kobo.602.1"> is a managed, private Docker container registry service based on the open source Docker Registry 2.0. </span><span class="koboSpan" id="kobo.602.2">ACR allows users to build, store, and manage container images and artifacts in a secure and scalable manner within Azure. </span><span class="koboSpan" id="kobo.602.3">ACR integrates well with existing container development and deployment pipelines, and it’s especially useful for storing and managing the custom Docker images that can be deployed in various </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1">Azure services.</span></span></p>
<p><span class="koboSpan" id="kobo.604.1">When working</span><a id="_idIndexMarker624"/><span class="koboSpan" id="kobo.605.1"> with Azure Machine Learning, there’s an underlying process that </span><a id="_idIndexMarker625"/><span class="koboSpan" id="kobo.606.1">packages models for deployment. </span><span class="koboSpan" id="kobo.606.2">This packaging involves creating a Docker image that contains the model, the scoring script, and all the dependencies required to run the model. </span><span class="koboSpan" id="kobo.606.3">Once this Docker image is created, it needs to be stored somewhere where it can be fetched </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">and run.</span></span></p>
<p><span class="koboSpan" id="kobo.608.1">This is where ACR comes into play. </span><span class="koboSpan" id="kobo.608.2">When you deploy a model for the first time using Azure Machine Learning, even if you haven’t explicitly set up an Azure container registry, the platform will automatically create one for you. </span><span class="koboSpan" id="kobo.608.3">This is a seamless experience; however, we need to be aware of the implications for cost </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">and security.</span></span></p>
<p><span class="koboSpan" id="kobo.610.1">In the next section, we will see how to</span><a id="_idIndexMarker626"/><span class="koboSpan" id="kobo.611.1"> secure our ACR and deployed containers in </span><strong class="bold"><span class="koboSpan" id="kobo.612.1">Azure Container Instances</span></strong><span class="koboSpan" id="kobo.613.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.614.1">ACI</span></strong><span class="koboSpan" id="kobo.615.1">). </span><span class="koboSpan" id="kobo.615.2">Let us start </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">with ACR.</span></span></p>
<h2 id="_idParaDest-160"><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.617.1">Securing images with Azure Container Registry</span></h2>
<p><span class="koboSpan" id="kobo.618.1">Securing ACR involves a</span><a id="_idIndexMarker627"/><span class="koboSpan" id="kobo.619.1"> combination of best practices in</span><a id="_idIndexMarker628"/><span class="koboSpan" id="kobo.620.1"> network security, access control, and image security. </span><span class="koboSpan" id="kobo.620.2">Similarly, to the compute, security best practices for ACR involve using managed identities where possible and ensuring that the ACR is behind the same virtual network as </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">the workspace.</span></span></p>
<p><span class="koboSpan" id="kobo.622.1">To isolate the container registry in a VNet, the steps are similar to other resources. </span><span class="koboSpan" id="kobo.622.2">However, before we are able to use the networking features, we need to update the service to use a </span><strong class="bold"><span class="koboSpan" id="kobo.623.1">Premium</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.624.1">pricing tier.</span></span></p>
<p><span class="koboSpan" id="kobo.625.1">To update the</span><a id="_idIndexMarker629"/><span class="koboSpan" id="kobo.626.1"> pricing tier, visit the ACR blade</span><a id="_idIndexMarker630"/><span class="koboSpan" id="kobo.627.1"> of the resource associated with your workspace and find the </span><strong class="bold"><span class="koboSpan" id="kobo.628.1">Properties</span></strong><span class="koboSpan" id="kobo.629.1"> section. </span><span class="koboSpan" id="kobo.629.2">Update the values as shown in the next screenshot and </span><span class="No-Break"><span class="koboSpan" id="kobo.630.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.631.1">Save</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.632.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer171">
<span class="koboSpan" id="kobo.633.1"><img alt="Figure 7.26 – Updating container registry properties" src="image/B21076_07_26.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.634.1">Figure 7.26 – Updating container registry properties</span></p>
<p><span class="koboSpan" id="kobo.635.1">Now we can use the networking features of the ACR. </span><span class="koboSpan" id="kobo.635.2">As we have already seen multiple times, go to the </span><strong class="bold"><span class="koboSpan" id="kobo.636.1">Networking</span></strong><span class="koboSpan" id="kobo.637.1"> section and set </span><strong class="bold"><span class="koboSpan" id="kobo.638.1">Public access</span></strong><span class="koboSpan" id="kobo.639.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.640.1">Disabled</span></strong><span class="koboSpan" id="kobo.641.1">, as demonstrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer172">
<span class="koboSpan" id="kobo.643.1"><img alt="Figure 7.27 – Disable public access" src="image/B21076_07_27.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.644.1">Figure 7.27 – Disable public access</span></p>
<p><span class="koboSpan" id="kobo.645.1">On the </span><strong class="bold"><span class="koboSpan" id="kobo.646.1">Private access</span></strong><span class="koboSpan" id="kobo.647.1"> tab, click on </span><strong class="bold"><span class="koboSpan" id="kobo.648.1">Create a private </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.649.1">endpoint connection</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer173">
<span class="koboSpan" id="kobo.651.1"><img alt="Figure 7.28 – Creating a private endpoint for the registry" src="image/B21076_07_28.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.652.1">Figure 7.28 – Creating a private endpoint for the registry</span></p>
<p><span class="koboSpan" id="kobo.653.1">Follow the </span><a id="_idIndexMarker631"/><span class="koboSpan" id="kobo.654.1">steps as usual, ensuring that in</span><a id="_idIndexMarker632"/><span class="koboSpan" id="kobo.655.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.656.1">Resources</span></strong><span class="koboSpan" id="kobo.657.1"> tab of the </span><strong class="bold"><span class="koboSpan" id="kobo.658.1">Private endpoint </span></strong><span class="koboSpan" id="kobo.659.1">form, you fill in the proper </span><strong class="bold"><span class="koboSpan" id="kobo.660.1">Resource</span></strong><span class="koboSpan" id="kobo.661.1"> and </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.662.1">Resource type</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.663.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer174">
<span class="koboSpan" id="kobo.664.1"><img alt="Figure 7.29 – Filling in the private endpoint form" src="image/B21076_07_29.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.665.1">Figure 7.29 – Filling in the private endpoint form</span></p>
<p><span class="koboSpan" id="kobo.666.1">Securing </span><a id="_idIndexMarker633"/><span class="koboSpan" id="kobo.667.1">ACR is a multi-faceted </span><a id="_idIndexMarker634"/><span class="koboSpan" id="kobo.668.1">process. </span><span class="koboSpan" id="kobo.668.2">By taking a comprehensive approach that encompasses network security, access control, and constant monitoring, you can ensure that your container images remain safe and are only accessed by authenticated users </span><span class="No-Break"><span class="koboSpan" id="kobo.669.1">or applications.</span></span></p>
<p><span class="koboSpan" id="kobo.670.1">Container registries</span><a id="_idIndexMarker635"/><span class="koboSpan" id="kobo.671.1"> are only the repositories of the models. </span><span class="koboSpan" id="kobo.671.2">They can be exposed in published endpoints so that they can be available to applications. </span><span class="koboSpan" id="kobo.671.3">Let us explore how to secure those endpoints when deployed </span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">with ACI.</span></span></p>
<h2 id="_idParaDest-161"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.673.1">Working with ML endpoints</span></h2>
<p><span class="koboSpan" id="kobo.674.1">When we deploy a model </span><a id="_idIndexMarker636"/><span class="koboSpan" id="kobo.675.1">via the workspace, the options available are Azure Kubernetes and ACI. </span><span class="koboSpan" id="kobo.675.2">The fastest option is to use ACI, as they are deployed quickly via the workspace and there is no further configuration. </span><span class="koboSpan" id="kobo.675.3">If you want to be reminded of the process of deploying a model, you can review the </span><em class="italic"><span class="koboSpan" id="kobo.676.1">Deploying the model</span></em><span class="koboSpan" id="kobo.677.1"> section of </span><a href="B21076_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.678.1">Chapter 1</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.679.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.680.1">After deploying an endpoint through the workspace, there is no option to disable public access to the container. </span><span class="koboSpan" id="kobo.680.2">In that case, what you can do is still register the model, but redeploy it using the saved container from the repository in a new ACI deployment. </span><span class="koboSpan" id="kobo.680.3">This provides the opportunity for </span><span class="No-Break"><span class="koboSpan" id="kobo.681.1">network isolation.</span></span></p>
<p><span class="koboSpan" id="kobo.682.1">To do this, we </span><a id="_idIndexMarker637"/><span class="koboSpan" id="kobo.683.1">need to choose the deployed image from the ACR connected with our workspace in the </span><strong class="bold"><span class="koboSpan" id="kobo.684.1">Basic</span></strong><span class="koboSpan" id="kobo.685.1"> tab of the container instance form. </span><span class="koboSpan" id="kobo.685.2">Begin to fill out the form as usual like in the </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">next screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer175">
<span class="koboSpan" id="kobo.687.1"><img alt="Figure 7.30 – Filling in the basic details" src="image/B21076_07_30.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.688.1">Figure 7.30 – Filling in the basic details</span></p>
<p><span class="koboSpan" id="kobo.689.1">When we reach the part where we need to choose an </span><strong class="bold"><span class="koboSpan" id="kobo.690.1">Image source</span></strong><span class="koboSpan" id="kobo.691.1">, choose the ACR connected to your workspace. </span><span class="koboSpan" id="kobo.691.2">Fill in </span><strong class="bold"><span class="koboSpan" id="kobo.692.1">Registry</span></strong><span class="koboSpan" id="kobo.693.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.694.1">Image</span></strong><span class="koboSpan" id="kobo.695.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.696.1">Image tag</span></strong><span class="koboSpan" id="kobo.697.1"> to correspond to your model and then fill out the rest of the form </span><span class="No-Break"><span class="koboSpan" id="kobo.698.1">as desired:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer176">
<span class="koboSpan" id="kobo.699.1"><img alt="Figure 7.31 – Choosing the correct ACR" src="image/B21076_07_31.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.700.1">Figure 7.31 – Choosing the correct ACR</span></p>
<p><span class="koboSpan" id="kobo.701.1">Next, you will</span><a id="_idIndexMarker638"/><span class="koboSpan" id="kobo.702.1"> find the </span><strong class="bold"><span class="koboSpan" id="kobo.703.1">Networking</span></strong><span class="koboSpan" id="kobo.704.1"> tab. </span><span class="koboSpan" id="kobo.704.2">From here, you can </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">restrict networking.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.706.1">Application considerations with VNet isolation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.707.1">Be careful in this stage. </span><span class="koboSpan" id="kobo.707.2">It all depends on where your application is hosted since this endpoint is meant to be consumed by an external application to the service. </span><span class="koboSpan" id="kobo.707.3">If it is an application hosted on Azure, you can probably configure the access easily. </span><span class="koboSpan" id="kobo.707.4">If it is an internal application hosted on-premises, you would need some of the services mentioned previously, such as a VPN gateway to access the isolated endpoint. </span><span class="koboSpan" id="kobo.707.5">If it is a public-facing application, you might need to further configure the network security group or firewall attached to the VNet to allow access properly. </span><span class="koboSpan" id="kobo.707.6">As this part of the process is heavily dependent on other factors, ensure that you have explored all options of networking and authentication before proceeding to use that API endpoint for scoring, training, and </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.709.1">To isolate behind a VNet, choose the </span><strong class="bold"><span class="koboSpan" id="kobo.710.1">Virtual network</span></strong><span class="koboSpan" id="kobo.711.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.712.1">Subnet</span></strong><span class="koboSpan" id="kobo.713.1">. </span><span class="koboSpan" id="kobo.713.2">The subnet must be a different one than the one we have used so far to accommodate endpoints instead of VMs. </span><span class="koboSpan" id="kobo.713.3">Refer to the </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer177">
<span class="koboSpan" id="kobo.715.1"><img alt="Figure 7.32 – Configuring network isolation" src="image/B21076_07_32.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.716.1">Figure 7.32 – Configuring network isolation</span></p>
<p><span class="koboSpan" id="kobo.717.1">Then, you can </span><a id="_idIndexMarker639"/><span class="koboSpan" id="kobo.718.1">complete the rest of the settings as desired and create the endpoint. </span><span class="koboSpan" id="kobo.718.2">Pay attention to environment variables if any are required. </span><span class="koboSpan" id="kobo.718.3">These can be filled in in the </span><strong class="bold"><span class="koboSpan" id="kobo.719.1">Advanced</span></strong><span class="koboSpan" id="kobo.720.1"> tab. </span><span class="koboSpan" id="kobo.720.2">Then, you can </span><strong class="bold"><span class="koboSpan" id="kobo.721.1">Review + Create</span></strong><span class="koboSpan" id="kobo.722.1"> the service. </span><span class="koboSpan" id="kobo.722.2">You can test the service from a VM deployed in the same VNet to test connectivity. </span><span class="koboSpan" id="kobo.722.3">This is just one way of isolating endpoints. </span><span class="koboSpan" id="kobo.722.4">Another way is to use workspace-managed network isolation, which is a new feature that is yet to be fully available. </span><span class="koboSpan" id="kobo.722.5">It is worth keeping up to date with this feature for </span><span class="No-Break"><span class="koboSpan" id="kobo.723.1">the future.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.724.1">Workspace-managed network isolation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.725.1">Azure Machine </span><a id="_idIndexMarker640"/><span class="koboSpan" id="kobo.726.1">Learning currently offers another option for integrated management for VNet isolation: automating the process with a VNet managed by the workspace. </span><span class="koboSpan" id="kobo.726.2">This feature is still in preview at the time of writing and should not be used for </span><a id="_idIndexMarker641"/><span class="koboSpan" id="kobo.727.1">production workloads, as the service provides no </span><strong class="bold"><span class="koboSpan" id="kobo.728.1">Service Level Agreement</span></strong><span class="koboSpan" id="kobo.729.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.730.1">SLA</span></strong><span class="koboSpan" id="kobo.731.1">). </span><span class="koboSpan" id="kobo.731.2">If you want to learn more, you can find more information </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1">at </span></span><span class="No-Break"><span class="koboSpan" id="kobo.733.1">https://learn.microsoft.com/en-us/azure/machine-learning/how-to-managed-network?view=azureml-api-2&amp;tabs=azure-cli</span></span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.735.1">We have explored multiple ways to leverage Azure infrastructure to secure our Azure Machine Learning workspace and its associated resources. </span><span class="koboSpan" id="kobo.735.2">It is easier if we already have cloud infrastructure we can leverage that is used within our organization for other purposes. </span><span class="koboSpan" id="kobo.735.3">It is worth exploring even if we do not, as it can help not only with isolating our resources and reducing the attack surface area but also with preventing data exfiltration in the case of a </span><span class="No-Break"><span class="koboSpan" id="kobo.736.1">security incident.</span></span></p>
<h1 id="_idParaDest-162"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.737.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.738.1">In this chapter, we talked about multiple aspects of leveraging networking to protect our Azure Machine </span><span class="No-Break"><span class="koboSpan" id="kobo.739.1">Learning workloads.</span></span></p>
<p><span class="koboSpan" id="kobo.740.1">The main aim of this chapter was to learn basic networking practices to isolate the workspace and all associated services, specifically storage accounts, key vaults, and Azure Container Registry. </span><span class="koboSpan" id="kobo.740.2">Although public access means access from the public internet and not unauthorized access, credentials can be leaked and malicious actors can gain access. </span><span class="koboSpan" id="kobo.740.3">By isolating our resources using VNets, we are reducing the attack </span><span class="No-Break"><span class="koboSpan" id="kobo.741.1">surface area.</span></span></p>
<p><span class="koboSpan" id="kobo.742.1">Combining networking and best practices regarding identity, such as configuring managed identities where possible and using proper RBAC with our users and services, we can take one step closer to maintaining a baseline security posture across our cloud services </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1">and infrastructure.</span></span></p>
<p><span class="koboSpan" id="kobo.744.1">In the next chapter, we will see how to automate best practices with </span><strong class="bold"><span class="koboSpan" id="kobo.745.1">continuous integration and continuous delivery</span></strong><span class="koboSpan" id="kobo.746.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.747.1">CI/CD</span></strong><span class="koboSpan" id="kobo.748.1">) for our </span><span class="No-Break"><span class="koboSpan" id="kobo.749.1">ML tasks.</span></span></p>
</div>
</body></html>
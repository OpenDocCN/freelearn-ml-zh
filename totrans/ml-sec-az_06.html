<html><head></head><body>
<div id="_idContainer145">
<h1 class="chapter-number" id="_idParaDest-133"><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-134"><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.2.1">Managing and Securing Access</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Up to this point, we have talked mostly about data, which is the basis of ML. </span><span class="koboSpan" id="kobo.3.2">But when it comes to security, there are other aspects we need to explore. </span><span class="koboSpan" id="kobo.3.3">Let us dive into identity and how we can manage access in Azure Machine Learning. </span><span class="koboSpan" id="kobo.3.4">As we embark on a journey through this chapter, we will first lay the groundwork by exploring the essence of the </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">principle of least privilege</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">PoLP</span></strong><span class="koboSpan" id="kobo.7.1">) and its importance. </span><span class="koboSpan" id="kobo.7.2">Although simple in theory, there are many things we need to consider before we start the implementation of Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">Machine Learning.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">We will follow up by exploring all the identity features of Microsoft Entra. </span><span class="koboSpan" id="kobo.9.2">We will see authentication options available and how to work with permissions by implementing </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">role-based access control</span></strong><span class="koboSpan" id="kobo.11.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.12.1">RBAC</span></strong><span class="koboSpan" id="kobo.13.1">). </span><span class="koboSpan" id="kobo.13.2">We will see how to authenticate applications and services using managed identities and how to secure access using tools such as Key Vault. </span><span class="koboSpan" id="kobo.13.3">Finally, we will talk about how to automate the processes by using Conditional Access and </span><strong class="bold"><span class="koboSpan" id="kobo.14.1">Privileged Identity Management</span></strong><span class="koboSpan" id="kobo.15.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.16.1">PIM</span></strong><span class="koboSpan" id="kobo.17.1">). </span><span class="koboSpan" id="kobo.17.2">The best practices in this chapter can be applied not only to Azure Machine Learning but to other services in Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.19.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">main topics:</span></span></p>
<ul>
<li><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.21.1">Working with </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">the </span><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.23.1">PoLP</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">Authenticating with Microsoft </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">Entra ID</span></span></li>
<li><a id="_idTextAnchor145"/><span class="No-Break"><span class="koboSpan" id="kobo.26.1">Implementing RBAC</span></span></li>
<li><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.27.1">Authenticating with </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">application identities</span></span></li>
<li><span class="koboSpan" id="kobo.29.1">Enhancing </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">access security</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.31.1">By the end of this chapter, you will have learned how to apply access management effectively by implementing PoLP in Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">Machine Learning.</span></span></p>
<h1 id="_idParaDest-135"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.33.1">Working with the PoLP</span></h1>
<p><span class="koboSpan" id="kobo.34.1">As we</span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.35.1"> mentioned in </span><a href="B21076_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.36.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.37.1"> when we talked about the Zero Trust strategy, we learned about the PoLP, which states that users, devices, and applications should only be granted access to the minimum level of resources necessary to perform their job functions. </span><span class="koboSpan" id="kobo.37.2">Users are often given more access privileges to network resources and data, assuming they only access the resources required to perform their daily tasks. </span><span class="koboSpan" id="kobo.37.3">However, this tactic imposes a greater risk of unauthorized access. </span><span class="koboSpan" id="kobo.37.4">When users have access to resources they don’t need, attackers can take advantage of it. </span><span class="koboSpan" id="kobo.37.5">While providing just enough permissions to apps or users to complete their tasks sounds easy, the implementation can present some challenges. </span><span class="koboSpan" id="kobo.37.6">Creating overprivileged applications is never the intention, but usually the result of unplanned actions </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">over time.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.39.1">Overprivileged applications</span></strong><span class="koboSpan" id="kobo.40.1"> are </span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.41.1">software applications that have been granted more access rights, permissions, or privileges than they actually require to perform their intended tasks. </span><span class="koboSpan" id="kobo.41.2">An application is characterized as overprivileged if it includes unused as well as reducible permissions. </span><span class="koboSpan" id="kobo.41.3">Let us see </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">some examples.</span></span></p>
<p><span class="koboSpan" id="kobo.43.1">Suppose we have an application that includes a user profile, where the user signs in and the application pulls all the information from the identity management system. </span><span class="koboSpan" id="kobo.43.2">The application’s usage has nothing to do with user profile updates and is just using the user’s profile information to get the manager or department information to complete other business tasks, so it does not include an </span><strong class="bold"><span class="koboSpan" id="kobo.44.1">Edit profile</span></strong><span class="koboSpan" id="kobo.45.1"> functionality. </span><span class="koboSpan" id="kobo.45.2">However, the application has the permissions needed to edit the profile information. </span><span class="koboSpan" id="kobo.45.3">This is an example of reducible permissions, where the application needs to read the data but not write in the system. </span><span class="koboSpan" id="kobo.45.4">Suppose that the same application also uses an API endpoint to get predictions from an ML model, and additionally has permissions to start or stop the Azure Machine Learning compute. </span><span class="koboSpan" id="kobo.45.5">This would be an example of unused permissions as the application has nothing to do with model training and the Azure Machine </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">Learning compute.</span></span></p>
<p><span class="koboSpan" id="kobo.47.1">It is tempting to include permissions to an application that will apply to future releases as we are often reluctant to modify deployed applications to avoid impacting their normal business operations. </span><span class="koboSpan" id="kobo.47.2">However, we must always consider the risks that accompany such decisions. </span><span class="koboSpan" id="kobo.47.3">Applying the PoLP is more of an iterative process than </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">a rule.</span></span></p>
<p><span class="koboSpan" id="kobo.49.1">Let us review some best practices before</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.50.1"> we dive into the implementations for Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">Machine Learning:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.52.1">Application inventory</span></strong><span class="koboSpan" id="kobo.53.1">: The first step is to keep an updated inventory of all applications in our organization. </span><span class="koboSpan" id="kobo.53.2">This includes both in-house developed applications and third-party applications and their required permissions. </span><span class="koboSpan" id="kobo.53.3">This can be part of our </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">governance program.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.55.1">RBAC</span></strong><span class="koboSpan" id="kobo.56.1">: We can implement RBAC to define and assign roles that align with specific application functions. </span><span class="koboSpan" id="kobo.56.2">The best approach is to assign permissions based on the PoLP to ensure that applications only have the access they need and re-evaluate this access </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">when appropriate.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.58.1">Regular reviews</span></strong><span class="koboSpan" id="kobo.59.1">: We need to periodically review the permissions granted to applications and remove any unnecessary or unused permissions that could potentially </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">be exploited.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.61.1">Automated tools</span></strong><span class="koboSpan" id="kobo.62.1">: It is always preferable to use automated tools to continuously analyze application permissions and identify overprivileged applications. </span><span class="koboSpan" id="kobo.62.2">These tools can provide insights into which permissions are actually being used and which can be revoked. </span><span class="koboSpan" id="kobo.62.3">For Azure, we can use Conditional Access policies and PIM as part of Microsoft </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">Entra ID.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.64.1">Zero Trust architecture</span></strong><span class="koboSpan" id="kobo.65.1">: As mentioned in </span><a href="B21076_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.66.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.67.1">, applying a zero-trust architecture when possible, where applications are not automatically trusted based on their location or source, is always beneficial. </span><span class="koboSpan" id="kobo.67.2">We should always verify the identity and permissions of applications before </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">granting access.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.69.1">Continuous monitoring</span></strong><span class="koboSpan" id="kobo.70.1">: After any implementation, continuously monitor application behavior and access patterns. </span><span class="koboSpan" id="kobo.70.2">Detecting and investigating any unusual or unauthorized activities should be one of our priorities to identify any breaches as soon </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">as possible.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.72.1">Training and awareness</span></strong><span class="koboSpan" id="kobo.73.1">: We should never forget the human factor. </span><span class="koboSpan" id="kobo.73.2">Everyone from developers and IT staff to data scientists should be educated about the importance of preventing overprivileged applications. </span><span class="koboSpan" id="kobo.73.3">As part of our organization’s governance, we should provide guidelines for implementing secure </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">access</span></span><span class="No-Break"><a id="_idIndexMarker491"/></span><span class="No-Break"><span class="koboSpan" id="kobo.75.1"> controls.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.76.1">Adhering to the PoLP is challenging as it requires a thorough understanding of user roles, responsibilities, and system interactions, and it is an iterative and continuous process. </span><span class="koboSpan" id="kobo.76.2">It can also </span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.77.1">become more complicated the more applications and systems we have. </span><span class="koboSpan" id="kobo.77.2">However, the security benefits it provides, by minimizing the potential impact of security breaches, make it an essential practice in any organization’s information </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">security strategy.</span></span></p>
<p><span class="koboSpan" id="kobo.79.1">Let us explore how to implement the PoLP in Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">Machine Learning.</span></span></p>
<h1 id="_idParaDest-136"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.81.1">Authenticating with Microsoft Entra ID</span></h1>
<p><span class="koboSpan" id="kobo.82.1">Azure Machine Learning uses </span><strong class="bold"><span class="koboSpan" id="kobo.83.1">Microsoft Entra ID</span></strong><span class="koboSpan" id="kobo.84.1"> (previously </span><strong class="bold"><span class="koboSpan" id="kobo.85.1">Azure Active Directory</span></strong><span class="koboSpan" id="kobo.86.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.87.1">Azure AD</span></strong><span class="koboSpan" id="kobo.88.1">)) for</span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.89.1"> authentication. </span><span class="koboSpan" id="kobo.89.2">Microsoft Entra ID is Microsoft’s </span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.90.1">cloud-based </span><strong class="bold"><span class="koboSpan" id="kobo.91.1">identity and access management</span></strong><span class="koboSpan" id="kobo.92.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.93.1">IAM</span></strong><span class="koboSpan" id="kobo.94.1">) service. </span><span class="koboSpan" id="kobo.94.2">It’s designed to help organizations manage user identities and access to resources in the cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">and on-premises.</span></span></p>
<p><span class="koboSpan" id="kobo.96.1">When</span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.97.1"> you are logged in to the Azure portal, the same account is used to directly authenticate you to your Azure Machine Learning Studio session. </span><span class="koboSpan" id="kobo.97.2">So, anyone working on your ML project needs to be part of the Microsoft Entra ID workspace. </span><span class="koboSpan" id="kobo.97.3">That does not mean that only employees have access to the workspace. </span><span class="koboSpan" id="kobo.97.4">Microsoft Entra ID supports two types of users: members and guests. </span><span class="koboSpan" id="kobo.97.5">Members are users that are created within the Microsoft Entra ID tenant, while guests can be users that belong to other Microsoft Entra tenants or are personal accounts such as Outlook, Gmail, Hotmail, and so on. </span><span class="koboSpan" id="kobo.97.6">But as soon as you create or invite a user in your Microsoft Entra ID tenant, then you can assign them roles and treat them as part of </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">your organization.</span></span></p>
<p><span class="koboSpan" id="kobo.99.1">Ways to authenticate using Microsoft Entra ID in Azure Machine Learning include interactive authentication directly with your account, the Azure CLI, service principals, and managed identities, which we will explore later in </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.101.1">Microsoft Entra ID is widely used across various industries and is an integral part of Microsoft’s cloud offerings, including Azure, Microsoft 365, and Dynamics 365. </span><span class="koboSpan" id="kobo.101.2">It’s a critical component for securing and managing access to cloud resources and ensuring that users have the appropriate level of access to applications and data while maintaining a high level </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">of security.</span></span></p>
<p><span class="koboSpan" id="kobo.103.1">Here is how we can use its security features to secure our Azure Machine </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">Learning workloads.</span></span></p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.105.1">Implementing RBAC</span></h1>
<p><span class="koboSpan" id="kobo.106.1">RBAC is a </span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.107.1">built-in feature of Microsoft Entra ID </span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.108.1">that allows you to manage access to Azure resources using roles. </span><span class="koboSpan" id="kobo.108.2">This way, we can control who can perform specific actions on resources in Azure. </span><span class="koboSpan" id="kobo.108.3">This helps in maintaining a secure environment and ensures that users have only the permissions they need to perform </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">their tasks.</span></span></p>
<p><span class="koboSpan" id="kobo.110.1">Each role</span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.111.1"> in RBAC is essentially a set of distinct permissions that operate in different scopes. </span><span class="koboSpan" id="kobo.111.2">We can assign a role to a management group, subscription, resource group, and resource. </span><span class="koboSpan" id="kobo.111.3">A role assignment at a higher scope is inherited by resources at a lower scope. </span><span class="koboSpan" id="kobo.111.4">For example, if we assign a role to a user at the subscription level, they will have those permissions across all resources within that subscription. </span><span class="koboSpan" id="kobo.111.5">Each role assignment in Azure has three distinct parts—the role, the scope, and the service principal, as we can see in the </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">following diagram:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer120">
<span class="koboSpan" id="kobo.113.1"><img alt="Figure 6.1 – Role assignment" src="image/B21076_06_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.114.1">Figure 6.1 – Role assignment</span></p>
<p><span class="koboSpan" id="kobo.115.1">The principle can be a user, a group of users, or a service principal such as an application or an Azure resource. </span><span class="koboSpan" id="kobo.115.2">We will explore service principals a little bit more later in the chapter when </span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.116.1">we talk about application identities and </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">managed identities.</span></span></p>
<p><span class="koboSpan" id="kobo.118.1">There are </span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.119.1">two types of roles: built-in and custom. </span><span class="koboSpan" id="kobo.119.2">Built-in roles are created by Azure, and we can assign them at any time. </span><span class="koboSpan" id="kobo.119.3">If they do not cover your needs, you can combine different roles to get the result you desire or create your own custom role to use with </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">the service.</span></span></p>
<p><span class="koboSpan" id="kobo.121.1">Let us see how we can assign or create RBAC roles specifically for Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">Machine Learning.</span></span></p>
<h2 id="_idParaDest-138"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.123.1">Working with built-in roles</span></h2>
<p><span class="koboSpan" id="kobo.124.1">Azure </span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.125.1">offers over 400 built-in roles, such as </span><strong class="bold"><span class="koboSpan" id="kobo.126.1">Virtual Machine Contributor</span></strong><span class="koboSpan" id="kobo.127.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.128.1">Storage Account Contributor</span></strong><span class="koboSpan" id="kobo.129.1">, and more. </span><span class="koboSpan" id="kobo.129.2">Each built-in role corresponds to specific scopes, actions, and services </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">in Azure.</span></span></p>
<p><span class="koboSpan" id="kobo.131.1">There are</span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.132.1"> three roles that are a must-know and apply to all </span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.133.1">Azure services—the </span><strong class="bold"><span class="koboSpan" id="kobo.134.1">Owner</span></strong><span class="koboSpan" id="kobo.135.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.136.1">Contributor</span></strong><span class="koboSpan" id="kobo.137.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.138.1">Reader</span></strong><span class="koboSpan" id="kobo.139.1"> roles. </span><span class="koboSpan" id="kobo.139.2">Here</span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.140.1"> are their descriptions in the </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer121">
<span class="koboSpan" id="kobo.142.1"><img alt="Figure 6.2 – Core RBAC roles for Azure resources" src="image/B21076_06_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.143.1">Figure 6.2 – Core RBAC roles for Azure resources</span></p>
<p><span class="koboSpan" id="kobo.144.1">Then, we have Azure Machine Learning-specific roles that we need to be aware of. </span><span class="koboSpan" id="kobo.144.2">Here are descriptions of the most important roles we need to know when we are working with Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">Machine Learning:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer122">
<span class="koboSpan" id="kobo.146.1"><img alt="Figure 6.3 – RBAC roles for Azure Machine Learning" src="image/B21076_06_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.147.1">Figure 6.3 – RBAC roles for Azure Machine Learning</span></p>
<p><span class="koboSpan" id="kobo.148.1">As you </span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.149.1">can see, the roles have been built around specific employee roles and encompass certain tasks around data scientists or compute operators for ML. </span><span class="koboSpan" id="kobo.149.2">Of course, if you have a different structure in your organization, you can assign two roles to the same person and have them complete all the relevant tasks </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">in Azure.</span></span></p>
<p><span class="koboSpan" id="kobo.151.1">Let us review how to work with </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">role assignments.</span></span></p>
<h3><span class="koboSpan" id="kobo.153.1">Adding a role assignment</span></h3>
<p><span class="koboSpan" id="kobo.154.1">As owners </span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.155.1">of the workspace, we can assign or remove roles to/from users and the workspace at any time using the Azure portal, the command-line tools, and</span><a id="_idIndexMarker507"/><span class="koboSpan" id="kobo.156.1"> even </span><strong class="bold"><span class="koboSpan" id="kobo.157.1">Azure Resource Manager</span></strong><span class="koboSpan" id="kobo.158.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.159.1">ARM</span></strong><span class="koboSpan" id="kobo.160.1">) templates if we have complex assignments that we want to repeat. </span><span class="koboSpan" id="kobo.160.2">The process is simple. </span><span class="koboSpan" id="kobo.160.3">In every resource blade on the top left, we can see that there is an </span><strong class="bold"><span class="koboSpan" id="kobo.161.1">Access control (</span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.162.1">IAM)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.163.1"> menu:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer123">
<span class="koboSpan" id="kobo.164.1"><img alt="Figure 6.4 – Azure Access control (IAM) menu" src="image/B21076_06_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.165.1">Figure 6.4 – Azure Access control (IAM) menu</span></p>
<p><span class="koboSpan" id="kobo.166.1">From </span><a id="_idIndexMarker508"/><span class="koboSpan" id="kobo.167.1">this blade, you can see existing role assignments and roles, and you can add or remove access to the resource. </span><span class="koboSpan" id="kobo.167.2">In this case, we have opened the </span><strong class="bold"><span class="koboSpan" id="kobo.168.1">Subscription</span></strong><span class="koboSpan" id="kobo.169.1"> blade, which means that any role assignments we change are going to be inherited by any resource groups and resources under </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">this subscription.</span></span></p>
<p><span class="koboSpan" id="kobo.171.1">To add a role assignment, click the </span><strong class="bold"><span class="koboSpan" id="kobo.172.1">Add</span></strong><span class="koboSpan" id="kobo.173.1"> button on the top. </span><span class="koboSpan" id="kobo.173.2">Follow the three-step wizard to add your </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">role assignment:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.175.1">The first step is to choose a role. </span><span class="koboSpan" id="kobo.175.2">For this example, I will </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">choose </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.177.1">Reader</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer124">
<span class="koboSpan" id="kobo.179.1"><img alt="Figure 6.5 – Step 1: Choosing a role" src="image/B21076_06_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.180.1">Figure 6.5 – Step 1: Choosing a role</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.181.1">The second step is to choose members for the selected role. </span><span class="koboSpan" id="kobo.181.2">You can add multiple members by clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.182.1">Select </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.183.1">members</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.184.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer125">
<span class="koboSpan" id="kobo.185.1"><img alt="Figure 6.6 – Step 2: Adding members" src="image/B21076_06_6.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.186.1">Figure 6.6 – Step 2: Adding members</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.187.1">That is it! </span><span class="koboSpan" id="kobo.187.2">The </span><a id="_idIndexMarker509"/><span class="koboSpan" id="kobo.188.1">final step is to review and complete </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">the assignment.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.190.1">If you want to use the command-line tools, here is an example in </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">the CLI:</span></span></p><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.192.1">az role assignment create --role "Reader" --assignee "georg***@*****.com" --subscription "00000000-0000-0000-0000-000000000000"</span></strong></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.193.1">Role assignment documentation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.194.1">To view more options to assign roles using the Azure tools, follow the corresponding link to the tool of </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">your choice:</span></span></p>
<p class="callout"><span class="No-Break"><span class="koboSpan" id="kobo.196.1">CLI: </span></span><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-cli"><span class="No-Break"><span class="koboSpan" id="kobo.197.1">https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-cli</span></span></a></p>
<p class="callout"><span class="No-Break"><span class="koboSpan" id="kobo.198.1">PowerShell: </span></span><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-powershell"><span class="No-Break"><span class="koboSpan" id="kobo.199.1">https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-powershell</span></span></a></p>
<p class="callout"><span class="koboSpan" id="kobo.200.1">REST </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">API: </span></span><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-rest"><span class="No-Break"><span class="koboSpan" id="kobo.202.1">https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-rest</span></span></a></p>
<p class="callout"><span class="koboSpan" id="kobo.203.1">ARM </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">templates: </span></span><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-template"><span class="No-Break"><span class="koboSpan" id="kobo.205.1">https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-template</span></span></a></p>
<p><span class="koboSpan" id="kobo.206.1">Adding role assignments is just one part of the story. </span><span class="koboSpan" id="kobo.206.2">Let us see how to review our existing assignments and remove them </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">when necessary.</span></span></p>
<h3><span class="koboSpan" id="kobo.208.1">Viewing and removing role assignments</span></h3>
<p><span class="koboSpan" id="kobo.209.1">The process to</span><a id="_idIndexMarker510"/><span class="koboSpan" id="kobo.210.1"> view and remove</span><a id="_idIndexMarker511"/><span class="koboSpan" id="kobo.211.1"> role assignments is just as simple. </span><span class="koboSpan" id="kobo.211.2">The first step is to visit the resource you want to check the role assignments for and open the </span><strong class="bold"><span class="koboSpan" id="kobo.212.1">Access control (IAM)</span></strong><span class="koboSpan" id="kobo.213.1"> menu. </span><span class="koboSpan" id="kobo.213.2">There, on the </span><strong class="bold"><span class="koboSpan" id="kobo.214.1">Role assignments</span></strong><span class="koboSpan" id="kobo.215.1"> tab, you can see existing role assignments, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer126">
<span class="koboSpan" id="kobo.217.1"><img alt="Figure 6.7 – Removing a role assignment" src="image/B21076_06_7.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.218.1">Figure 6.7 – Removing a role assignment</span></p>
<p><span class="koboSpan" id="kobo.219.1">By clicking on the box on the left of the role assignment in the user list, the </span><strong class="bold"><span class="koboSpan" id="kobo.220.1">Remove</span></strong><span class="koboSpan" id="kobo.221.1"> button on the top is enabled. </span><span class="koboSpan" id="kobo.221.2">You can click </span><strong class="bold"><span class="koboSpan" id="kobo.222.1">Remove</span></strong><span class="koboSpan" id="kobo.223.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.224.1">Confirm</span></strong><span class="koboSpan" id="kobo.225.1"> to remove </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">the assignment.</span></span></p>
<p><span class="koboSpan" id="kobo.227.1">As with adding an assignment, you can use the command-line tools. </span><span class="koboSpan" id="kobo.227.2">Here is an example of removing an assignment using </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">the CLI:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.229.1">
az role assignment delete --assignee "georg***@*****.com" \
--role "Reader" \
--subscription "00000000-0000-0000-0000-000000000000"</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.230.1">Role assignment documentation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.231.1">To view more options to remove role assignments using the Azure tools, follow this </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">link: </span></span><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-remove"><span class="No-Break"><span class="koboSpan" id="kobo.233.1">https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-remove</span></span></a></p>
<p><span class="koboSpan" id="kobo.234.1">Built-in roles </span><a id="_idIndexMarker512"/><span class="koboSpan" id="kobo.235.1">are not the only way to assign </span><a id="_idIndexMarker513"/><span class="koboSpan" id="kobo.236.1">permissions. </span><span class="koboSpan" id="kobo.236.2">Let us review </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">custom roles.</span></span></p>
<h2 id="_idParaDest-139"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.238.1">Creating a custom role for Azure Machine Learning</span></h2>
<p><span class="koboSpan" id="kobo.239.1">The</span><a id="_idIndexMarker514"/><span class="koboSpan" id="kobo.240.1"> built-in roles are great, but sometimes they do not provide exactly what we need to properly restrict permissions of our users. </span><span class="koboSpan" id="kobo.240.2">In that case, we have the option of creating our own custom roles that have the exact permissions we need to complete the tasks necessary. </span><span class="koboSpan" id="kobo.240.3">A role is essentially a set of permissions. </span><span class="koboSpan" id="kobo.240.4">This set of permissions is described as a JSON file. </span><span class="koboSpan" id="kobo.240.5">You can find an example of the Contributor role in JSON format </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">here: </span></span><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-definitions-list"><span class="No-Break"><span class="koboSpan" id="kobo.242.1">https://learn.microsoft.com/en-us/azure/role-based-access-control/role-definitions-list</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.243.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.244.1">Custom role overview</span></p>
<p class="callout"><span class="koboSpan" id="kobo.245.1">If you want to learn more about Azure custom role properties, see the information provided in this </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">link: </span></span><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles"><span class="No-Break"><span class="koboSpan" id="kobo.247.1">https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles</span></span></a></p>
<p><span class="koboSpan" id="kobo.248.1">In this section, we will not go into much detail on RBAC, but we will focus on how to create custom roles for the Azure Machine Learning service. </span><span class="koboSpan" id="kobo.248.2">If looking at that JSON file seems daunting, you do not have to worry. </span><span class="koboSpan" id="kobo.248.3">We can create our own custom role using the Azure portal. </span><span class="koboSpan" id="kobo.248.4">As done previously, we go onto the resource blade we want to assign a new role to and find the </span><strong class="bold"><span class="koboSpan" id="kobo.249.1">Add</span></strong><span class="koboSpan" id="kobo.250.1"> button. </span><span class="koboSpan" id="kobo.250.2">Click the Add button and then follow the </span><strong class="bold"><span class="koboSpan" id="kobo.251.1">Add custom </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.252.1">role</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.253.1"> menu:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer127">
<span class="koboSpan" id="kobo.254.1"><img alt="Figure 6.8 – Adding a custom role" src="image/B21076_06_8.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.255.1">Figure 6.8 – Adding a custom role</span></p>
<p><span class="koboSpan" id="kobo.256.1">The</span><a id="_idIndexMarker515"/><span class="koboSpan" id="kobo.257.1"> custom role wizard will pop up. </span><span class="koboSpan" id="kobo.257.2">The first step is to create a name for our role. </span><span class="koboSpan" id="kobo.257.3">In this case, I chose the name </span><strong class="bold"><span class="koboSpan" id="kobo.258.1">AzureML Data Scientist Extended</span></strong><span class="koboSpan" id="kobo.259.1">, because my goal is to clone the existing role and simply add more permissions. </span><span class="koboSpan" id="kobo.259.2">You can, of course, start from scratch or from a saved JSON file. </span><span class="koboSpan" id="kobo.259.3">We then add a good description and we are ready to proceed, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer128">
<span class="koboSpan" id="kobo.261.1"><img alt="Figure 6.9 – Filling in the basics" src="image/B21076_06_9.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.262.1">Figure 6.9 – Filling in the basics</span></p>
<p><span class="koboSpan" id="kobo.263.1">Under the </span><strong class="bold"><span class="koboSpan" id="kobo.264.1">Permissions</span></strong><span class="koboSpan" id="kobo.265.1"> tab, I see that this role has permissions in the workspace, but in the </span><strong class="bold"><span class="koboSpan" id="kobo.266.1">Permission type</span></strong><span class="koboSpan" id="kobo.267.1"> column is assigned with </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">NotAction</span></strong><span class="koboSpan" id="kobo.269.1"> since we can see that </span><em class="italic"><span class="koboSpan" id="kobo.270.1">delete</span></em><span class="koboSpan" id="kobo.271.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.272.1">write</span></em><span class="koboSpan" id="kobo.273.1"> actions in the workspace are prohibited. </span><span class="koboSpan" id="kobo.273.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.274.1">Action</span></strong><span class="koboSpan" id="kobo.275.1"> section of the role describes what the role can do, and then </span><strong class="bold"><span class="koboSpan" id="kobo.276.1">NotAction</span></strong><span class="koboSpan" id="kobo.277.1"> describes what it cannot do. </span><span class="koboSpan" id="kobo.277.2">So, if I </span><a id="_idIndexMarker516"/><span class="koboSpan" id="kobo.278.1">remove those permissions from </span><strong class="bold"><span class="koboSpan" id="kobo.279.1">NotAction</span></strong><span class="koboSpan" id="kobo.280.1">, the role will be able to create and delete workspaces, which is what I want my data scientists to be able </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">to do:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer129">
<span class="koboSpan" id="kobo.282.1"><img alt="Figure 6.10 – Working with permissions" src="image/B21076_06_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.283.1">Figure 6.10 – Working with permissions</span></p>
<p><span class="koboSpan" id="kobo.284.1">The following screenshot shows the result with the complete </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">permissions list:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer130">
<span class="koboSpan" id="kobo.286.1"><img alt="Figure 6.11 – Final permissions" src="image/B21076_06_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.287.1">Figure 6.11 – Final permissions</span></p>
<p><span class="koboSpan" id="kobo.288.1">Before</span><a id="_idIndexMarker517"/><span class="koboSpan" id="kobo.289.1"> we move on, though, you might ask: What if I want to add permissions? </span><span class="koboSpan" id="kobo.289.2">Where do I find them? </span><span class="koboSpan" id="kobo.289.3">In the preceding screenshot, we can see the </span><strong class="bold"><span class="koboSpan" id="kobo.290.1">+ Add permissions</span></strong><span class="koboSpan" id="kobo.291.1"> button. </span><span class="koboSpan" id="kobo.291.2">From here, the process of adding permissions is very intuitive. </span><span class="koboSpan" id="kobo.291.3">When you want to add permissions, you do not need to scroll through an endless list or have the documentation at hand every time. </span><span class="koboSpan" id="kobo.291.4">You can simply filter to the service you want and see the relevant permissions. </span><span class="koboSpan" id="kobo.291.5">For Azure Machine Learning, we are interested in the </span><strong class="bold"><span class="koboSpan" id="kobo.292.1">Machine Learning Services Resource Provider</span></strong><span class="koboSpan" id="kobo.293.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.294.1">Microsoft Machine Learning Web Services Management</span></strong><span class="koboSpan" id="kobo.295.1"> permissions, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer131">
<span class="koboSpan" id="kobo.297.1"><img alt="Figure 6.12 – Adding permissions" src="image/B21076_06_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.298.1">Figure 6.12 – Adding permissions</span></p>
<p><span class="koboSpan" id="kobo.299.1">By clicking </span><a id="_idIndexMarker518"/><span class="koboSpan" id="kobo.300.1">on the relevant category, we can see a list of permissions together with their description, as we can see in the </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">next screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer132">
<span class="koboSpan" id="kobo.302.1"><img alt="Figure 6.13 – Viewing Azure Machine Learning permissions" src="image/B21076_06_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.303.1">Figure 6.13 – Viewing Azure Machine Learning permissions</span></p>
<p><span class="koboSpan" id="kobo.304.1">This makes it very quick to create a custom role. </span><span class="koboSpan" id="kobo.304.2">You just need to ensure that you have included all the permissions needed and then you can come back to the </span><strong class="bold"><span class="koboSpan" id="kobo.305.1">Permissions</span></strong><span class="koboSpan" id="kobo.306.1"> page and review </span><span class="No-Break"><span class="koboSpan" id="kobo.307.1">the list.</span></span></p>
<p><span class="koboSpan" id="kobo.308.1">The next step is to set the assignable scope. </span><span class="koboSpan" id="kobo.308.2">You can change the </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">Assignable scopes</span></strong><span class="koboSpan" id="kobo.310.1"> option to set the scope of this custom role at the subscription level, the resource group level, or a </span><a id="_idIndexMarker519"/><span class="koboSpan" id="kobo.311.1">specific </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">workspace level:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer133">
<span class="koboSpan" id="kobo.313.1"><img alt="" role="presentation" src="image/B21076_06_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.314.1">Figure 6.14 – Deciding on the scope</span></p>
<p><span class="koboSpan" id="kobo.315.1">Then, you can review and download the generated JSON or proceed to the final step to create the new </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">custom role:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer134">
<span class="koboSpan" id="kobo.317.1"><img alt="Figure 6.15 – Reviewing and creating/downloading" src="image/B21076_06_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.318.1">Figure 6.15 – Reviewing and creating/downloading</span></p>
<p><span class="koboSpan" id="kobo.319.1">After you have created the custom role, you can assign it just as with the built-in roles. </span><span class="koboSpan" id="kobo.319.2">You will find it on the </span><strong class="bold"><span class="koboSpan" id="kobo.320.1">Roles</span></strong><span class="koboSpan" id="kobo.321.1"> list in the </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">Access control (IAM)</span></strong><span class="koboSpan" id="kobo.323.1"> menu with the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.324.1">CustomRole</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.325.1"> type:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer135">
<span class="koboSpan" id="kobo.326.1"><img alt="Figure 6.16 – Finding your custom role" src="image/B21076_06_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.327.1">Figure 6.16 – Finding your custom role</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.328.1">Azure RBAC</span></p>
<p class="callout"><span class="koboSpan" id="kobo.329.1">Learn more about </span><a id="_idIndexMarker520"/><span class="koboSpan" id="kobo.330.1">Azure RBAC </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">here: </span></span><a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/overview"><span class="No-Break"><span class="koboSpan" id="kobo.332.1">https://learn.microsoft.com/en-us/azure/role-based-access-control/overview</span></span></a></p>
<p><span class="koboSpan" id="kobo.333.1">Azure RBAC</span><a id="_idIndexMarker521"/><span class="koboSpan" id="kobo.334.1"> is a crucial component for securing Azure resources and ensuring that only authorized users and applications have access. </span><span class="koboSpan" id="kobo.334.2">It plays a vital role in maintaining a secure, compliant, and well-managed Azure environment. </span><span class="koboSpan" id="kobo.334.3">Combining it with Azure Policy, Azure management groups, and Azure Blueprints, we have all the components needed for a complete </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1">governance framework.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.336.1">RBAC – best practices</span></p>
<p class="callout"><span class="koboSpan" id="kobo.337.1">Here are some RBAC best practices to follow when </span><span class="No-Break"><span class="koboSpan" id="kobo.338.1">assigning roles:</span></span></p>
<ul>
<li class="callout"><span class="koboSpan" id="kobo.339.1">Only grant the exact access </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">users need</span></span></li>
<li class="callout"><span class="koboSpan" id="kobo.341.1">Restrict the number of </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">subscription owners</span></span></li>
<li class="callout"><span class="koboSpan" id="kobo.343.1">Use Microsoft Entra </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">ID PIM</span></span></li>
<li class="callout"><span class="koboSpan" id="kobo.345.1">Assign roles to groups, not individual users, so that permissions </span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">are inherited</span></span></li>
<li class="callout"><span class="koboSpan" id="kobo.347.1">Assign roles using the unique role ID instead of the role name, in case the role </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">is renamed</span></span></li>
<li class="callout"><span class="koboSpan" id="kobo.349.1">Avoid using wildcards when working with </span><span class="No-Break"><span class="koboSpan" id="kobo.350.1">custom roles</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.351.1">RBAC is not only</span><a id="_idIndexMarker522"/><span class="koboSpan" id="kobo.352.1"> about the users. </span><span class="koboSpan" id="kobo.352.2">Microsoft Entra ID is also used to authenticate users and applications. </span><span class="koboSpan" id="kobo.352.3">Let us see how we can work with those identities in the </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">next section.</span></span></p>
<h1 id="_idParaDest-140"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.354.1">Authenticating with application identities</span></h1>
<p><span class="koboSpan" id="kobo.355.1">Application identities</span><a id="_idIndexMarker523"/><span class="koboSpan" id="kobo.356.1"> are a fundamental concept in Microsoft Entra ID IAM. </span><span class="koboSpan" id="kobo.356.2">They represent the security context of an application or service when interacting with Azure resources. </span><span class="koboSpan" id="kobo.356.3">Typically, the underlying object is the service principal. </span><span class="koboSpan" id="kobo.356.4">A service principal is like a user identity</span><a id="_idIndexMarker524"/><span class="koboSpan" id="kobo.357.1"> but is used by applications, services, or scripts to authenticate and access Azure resources securely. </span><span class="koboSpan" id="kobo.357.2">The process of creating a service principal depends on what it is we want to use to authenticate, and mostly, we can recognize two types—application identities and managed identities used by </span><span class="No-Break"><span class="koboSpan" id="kobo.358.1">Azure services.</span></span></p>
<p><span class="koboSpan" id="kobo.359.1">When it comes to authentication and authorization in the application or managed identity, the process is the same. </span><span class="koboSpan" id="kobo.359.2">If it exists in Microsoft Entra ID, it can be assigned RBAC, as with any user in the system. </span><span class="koboSpan" id="kobo.359.3">Service principals have life cycles, just as with user identities. </span><span class="koboSpan" id="kobo.359.4">They can be created, updated, and deleted. </span><span class="koboSpan" id="kobo.359.5">For standalone Azure AD applications, service principals can use client secrets/passwords or certificates for authentication. </span><span class="koboSpan" id="kobo.359.6">Client secrets should be stored securely, while certificates provide an added layer of security. </span><span class="koboSpan" id="kobo.359.7">Microsoft Entra ID applications can be configured as single tenant (only accessible in one Microsoft Entra ID tenant) or multi-tenant (accessible by users and applications from multiple Microsoft Entra ID tenants). </span><span class="koboSpan" id="kobo.359.8">Multi-tenant apps often require additional configuration to handle </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">identity federation.</span></span></p>
<p><span class="koboSpan" id="kobo.361.1">Let us review how we can create and work with service </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">principals next.</span></span></p>
<h2 id="_idParaDest-141"><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.363.1">Creating a service principal</span></h2>
<p><span class="koboSpan" id="kobo.364.1">In order </span><a id="_idIndexMarker525"/><span class="koboSpan" id="kobo.365.1">to authenticate </span><a id="_idIndexMarker526"/><span class="koboSpan" id="kobo.366.1">when working with applications or scripts that train and test a model, for example, you can use service principal authentication. </span><span class="koboSpan" id="kobo.366.2">To achieve this, we need to create a service principal in the Microsoft Entra ID workspace. </span><span class="koboSpan" id="kobo.366.3">If you are creating a service principal, you need to create an </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">application registration.</span></span></p>
<p><span class="koboSpan" id="kobo.368.1">Let us see both ways of </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">achieving this.</span></span></p>
<h3><span class="koboSpan" id="kobo.370.1">Using the CLI</span></h3>
<p><span class="koboSpan" id="kobo.371.1">Depending </span><a id="_idIndexMarker527"/><span class="koboSpan" id="kobo.372.1">on where you are running the command, you might need to authenticate your Azure subscription. </span><span class="koboSpan" id="kobo.372.2">Run the commands through Cloud Shell so that there is no need. </span><span class="koboSpan" id="kobo.372.3">The command to create a service principal is </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">shown here:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.374.1">
az ad sp create-for-rbac --sdk-auth --name azuremldatascientist --role Contributor --scopes /subscriptions/&lt;subscription id&gt;</span></pre> <p><span class="koboSpan" id="kobo.375.1">The result will include several values that we must protect as they serve as credentials, but we must ensure to save them so that we can use them in our code to retrieve an authentication token. </span><span class="koboSpan" id="kobo.375.2">These are </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">clientId</span></strong><span class="koboSpan" id="kobo.377.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">clientSecret</span></strong><span class="koboSpan" id="kobo.379.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">tenantId</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer136">
<span class="koboSpan" id="kobo.383.1"><img alt="Figure 6.17 – Service principal creation result" src="image/B21076_06_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.384.1">Figure 6.17 – Service principal creation result</span></p>
<p><span class="koboSpan" id="kobo.385.1">You can retrieve more information about the service principal using the portal or the </span><span class="No-Break"><span class="koboSpan" id="kobo.386.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.387.1">
az ad sp show --id &lt;clientId from previous result&gt;</span></pre> <p><span class="koboSpan" id="kobo.388.1">Now that we have created a service principal, we can use it in our code and assign more roles </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">if necessary.</span></span></p>
<h3><span class="koboSpan" id="kobo.390.1">Registering an application</span></h3>
<p><span class="koboSpan" id="kobo.391.1">The CLI is </span><a id="_idIndexMarker528"/><span class="koboSpan" id="kobo.392.1">not the only way to create a service principal. </span><span class="koboSpan" id="kobo.392.2">Another way is to use the portal. </span><span class="koboSpan" id="kobo.392.3">Open the Microsoft Entra ID workspace and find the </span><strong class="bold"><span class="koboSpan" id="kobo.393.1">App registrations</span></strong><span class="koboSpan" id="kobo.394.1"> menu. </span><span class="koboSpan" id="kobo.394.2">In the following screenshot, you can see a list of existing service principals, including the service principal we created in the previous section using the CLI. </span><span class="koboSpan" id="kobo.394.3">You can find the necessary IDs and information using the portal from here </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">as well:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer137">
<span class="koboSpan" id="kobo.396.1"><img alt="Figure 6.18 – App registrations" src="image/B21076_06_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.397.1">Figure 6.18 – App registrations</span></p>
<p><span class="koboSpan" id="kobo.398.1">To proceed from here, click the </span><strong class="bold"><span class="koboSpan" id="kobo.399.1">New registration</span></strong><span class="koboSpan" id="kobo.400.1"> button. </span><span class="koboSpan" id="kobo.400.2">Fill in the details, giving the application a name and indicating what kinds of accounts can use this. </span><span class="koboSpan" id="kobo.400.3">For this example, we will keep the defaults and click </span><strong class="bold"><span class="koboSpan" id="kobo.401.1">Register</span></strong><span class="koboSpan" id="kobo.402.1">, as we can see in the </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">next screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer138">
<span class="koboSpan" id="kobo.404.1"><img alt="Figure 6.19 – Creating a new registration" src="image/B21076_06_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.405.1">Figure 6.19 – Creating a new registration</span></p>
<p><span class="koboSpan" id="kobo.406.1">Your</span><a id="_idIndexMarker529"/><span class="koboSpan" id="kobo.407.1"> registration is complete. </span><span class="koboSpan" id="kobo.407.2">As soon as we click </span><strong class="bold"><span class="koboSpan" id="kobo.408.1">Register</span></strong><span class="koboSpan" id="kobo.409.1">, the application registration page will open, and we can configure multiple options, as seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer139">
<span class="koboSpan" id="kobo.411.1"><img alt="Figure 6.20 – Creating a new registration" src="image/B21076_06_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.412.1">Figure 6.20 – Creating a new registration</span></p>
<p><span class="koboSpan" id="kobo.413.1">By opening up an app registration, you can configure options such as client certificates and secrets, as well </span><a id="_idIndexMarker530"/><span class="koboSpan" id="kobo.414.1">as roles </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">and permissions.</span></span></p>
<p><span class="koboSpan" id="kobo.416.1">But what about services? </span><span class="koboSpan" id="kobo.416.2">How does the workspace authenticate a </span><strong class="bold"><span class="koboSpan" id="kobo.417.1">virtual machine</span></strong><span class="koboSpan" id="kobo.418.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.419.1">VM</span></strong><span class="koboSpan" id="kobo.420.1">) that wants to connect to the workspace? </span><span class="koboSpan" id="kobo.420.2">This is where managed identities come in. </span><span class="koboSpan" id="kobo.420.3">Let us see how managed identities work and how we can use everything we have seen so far to authenticate in </span><span class="No-Break"><span class="koboSpan" id="kobo.421.1">our code.</span></span></p>
<h2 id="_idParaDest-142"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.422.1">Working with managed identities</span></h2>
<p><span class="koboSpan" id="kobo.423.1">Managed identities</span><a id="_idIndexMarker531"/><span class="koboSpan" id="kobo.424.1"> in Azure are a </span><a id="_idIndexMarker532"/><span class="koboSpan" id="kobo.425.1">way to securely authenticate and authorize applications and services within the Azure ecosystem. </span><span class="koboSpan" id="kobo.425.2">They are a fundamental part of Azure’s IAM capabilities and are used to authorize themselves when interacting with other Azure services and resources. </span><span class="koboSpan" id="kobo.425.3">This eliminates the need to store sensitive credentials or secrets in code or configuration files, making the application more secure. </span><span class="koboSpan" id="kobo.425.4">Managed identities can be used with a wide range of Azure services, including Azure Virtual Machines, Azure Storage accounts, Azure Key Vault, Azure Machine Learning, and more. </span><span class="koboSpan" id="kobo.425.5">They can be assigned specific roles and permissions in Azure RBAC. </span><span class="koboSpan" id="kobo.425.6">This means you can control which actions and resources the identity can access within your Azure environment. </span><span class="koboSpan" id="kobo.425.7">We can easily use managed identities in our applications or scripts by leveraging the Azure Machine Learning libraries and SDKs available, as we will see in the </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">next section.</span></span></p>
<p><span class="koboSpan" id="kobo.427.1">Each Azure resource that supports managed identities has a specific way of enabling and using them. </span><span class="koboSpan" id="kobo.427.2">There are two types of managed identities. </span><span class="koboSpan" id="kobo.427.3">Let us review the differences between </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">the two.</span></span></p>
<h3><span class="koboSpan" id="kobo.429.1">Enabling a system-assigned managed identity</span></h3>
<p><span class="koboSpan" id="kobo.430.1">This</span><a id="_idIndexMarker533"/><span class="koboSpan" id="kobo.431.1"> type of identity is created and managed by Azure for a specific Azure resource, such as a VM or an Azure function. </span><span class="koboSpan" id="kobo.431.2">It’s tightly bound to the life cycle of the resource it’s associated with, meaning when the resource is deleted, the managed identity is deleted along with it and cannot be associated with multiple resources. </span><span class="koboSpan" id="kobo.431.3">To work with system-assigned managed identities, you simply enable them on </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">your resources.</span></span></p>
<p><span class="koboSpan" id="kobo.433.1">To enable a system-assigned managed identity, we simply need to find the </span><strong class="bold"><span class="koboSpan" id="kobo.434.1">Identity </span></strong><span class="koboSpan" id="kobo.435.1">menu, as shown in the following screenshot, in the resource blade of our choice, set the </span><strong class="bold"><span class="koboSpan" id="kobo.436.1">Status</span></strong><span class="koboSpan" id="kobo.437.1"> toggle to </span><strong class="bold"><span class="koboSpan" id="kobo.438.1">On</span></strong><span class="koboSpan" id="kobo.439.1">, and click on </span><strong class="bold"><span class="koboSpan" id="kobo.440.1">Save</span></strong><span class="koboSpan" id="kobo.441.1">. </span><span class="koboSpan" id="kobo.441.2">For this example, I have chosen a VM, but it is supported</span><a id="_idIndexMarker534"/><span class="koboSpan" id="kobo.442.1"> in multiple </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">Azure resources:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer140">
<span class="koboSpan" id="kobo.444.1"><img alt="Figure 6.21 – Opening the Identity menu" src="image/B21076_06_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.445.1">Figure 6.21 – Opening the Identity menu</span></p>
<p><span class="koboSpan" id="kobo.446.1">As soon as we have enabled the system-assigned managed identity, we can use RBAC and assign roles or disable it by setting the </span><strong class="bold"><span class="koboSpan" id="kobo.447.1">Status</span></strong><span class="koboSpan" id="kobo.448.1"> toggle to </span><strong class="bold"><span class="koboSpan" id="kobo.449.1">Off</span></strong><span class="koboSpan" id="kobo.450.1">. </span><span class="koboSpan" id="kobo.450.2">You can see the enabled system-assigned managed identity in the </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">next screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer141">
<span class="koboSpan" id="kobo.452.1"><img alt="Figure 6.22 – System-assigned managed identity enabled" src="image/B21076_06_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.453.1">Figure 6.22 – System-assigned managed identity enabled</span></p>
<h3><span class="koboSpan" id="kobo.454.1">Creating a user-assigned managed identity</span></h3>
<p><span class="koboSpan" id="kobo.455.1">This type of </span><a id="_idIndexMarker535"/><span class="koboSpan" id="kobo.456.1">identity is created and managed as a standalone Azure resource. </span><span class="koboSpan" id="kobo.456.2">You can then associate it with one or more Azure resources, allowing multiple resources to use the same identity. </span><span class="koboSpan" id="kobo.456.3">This is very useful when, for example, the life cycle of the managed identity needs to be independent of the resource life cycle or multiple resources need to share the </span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">same permissions.</span></span></p>
<p><span class="koboSpan" id="kobo.458.1">Creating a managed identity is a two-step process. </span><span class="koboSpan" id="kobo.458.2">First, we need to create a </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">managed identity.</span></span></p>
<p><span class="koboSpan" id="kobo.460.1">To do that, open the </span><strong class="bold"><span class="koboSpan" id="kobo.461.1">Managed Identities</span></strong><span class="koboSpan" id="kobo.462.1"> menu from the search box on the top and click on </span><strong class="bold"><span class="koboSpan" id="kobo.463.1">Create</span></strong><span class="koboSpan" id="kobo.464.1">. </span><span class="koboSpan" id="kobo.464.2">Fill in some basic details, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer142">
<span class="koboSpan" id="kobo.466.1"><img alt="Figure 6.23 – Creating a user-assigned managed identity" src="image/B21076_06_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.467.1">Figure 6.23 – Creating a user-assigned managed identity</span></p>
<p><span class="koboSpan" id="kobo.468.1">As </span><a id="_idIndexMarker536"/><span class="koboSpan" id="kobo.469.1">soon as the identity is created, we can associate it with many resources. </span><span class="koboSpan" id="kobo.469.2">As previously, we will find the </span><strong class="bold"><span class="koboSpan" id="kobo.470.1">Identity</span></strong><span class="koboSpan" id="kobo.471.1"> menu in the resource blade, but this time we will switch to the </span><strong class="bold"><span class="koboSpan" id="kobo.472.1">User assigned</span></strong><span class="koboSpan" id="kobo.473.1"> tab. </span><span class="koboSpan" id="kobo.473.2">Then, we can click on the </span><strong class="bold"><span class="koboSpan" id="kobo.474.1">Add</span></strong><span class="koboSpan" id="kobo.475.1"> button and filter our identities, and as soon as we find the one we created previously, we can associate it with the resource. </span><span class="koboSpan" id="kobo.475.2">You can see the portal for these steps in the </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer143">
<span class="koboSpan" id="kobo.477.1"><img alt="Figure 6.24 – Associating the user-assigned managed identity" src="image/B21076_06_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.478.1">Figure 6.24 – Associating the user-assigned managed identity</span></p>
<p><span class="koboSpan" id="kobo.479.1">Managed identities can also be created or enabled using other Azure tools such as the CLI, PowerShell, or the REST API. </span><span class="koboSpan" id="kobo.479.2">Then, they can be used from scripts or other Azure services we </span><a id="_idIndexMarker537"/><span class="koboSpan" id="kobo.480.1">want to connect to. </span><span class="koboSpan" id="kobo.480.2">We can enable, disable, or disassociate them from our resources at </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">any time.</span></span></p>
<p><span class="koboSpan" id="kobo.482.1">In summary, Microsoft Entra ID managed identities are a way to improve the security and management of authentication and authorization for Azure resources by eliminating the need for storing credentials and providing seamless integration with Azure services. </span><span class="koboSpan" id="kobo.482.2">They help developers and administrators ensure the security and compliance of their </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">Azure workloads.</span></span></p>
<p><span class="koboSpan" id="kobo.484.1">Here is how we can set up authentication using the different </span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">identities available.</span></span></p>
<h3><span class="koboSpan" id="kobo.486.1">Setting up authentication</span></h3>
<p><span class="koboSpan" id="kobo.487.1">We </span><a id="_idIndexMarker538"/><span class="koboSpan" id="kobo.488.1">can simplify the authentication process by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">DefaultAzureCredential</span></strong><span class="koboSpan" id="kobo.490.1"> class from the Azure Identity package for Python. </span><span class="koboSpan" id="kobo.490.2">This class automatically chooses the appropriate authentication method (such as Managed Identity, Service Principal, or interactive login) based on the environment it’s running in. </span><span class="koboSpan" id="kobo.490.3">Here’s how we can use it for both managed identity and service </span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">principal scenarios</span></span></p>
<p><span class="koboSpan" id="kobo.492.1">When connecting with a service principal, we need to provide three environment variables and use the values </span><span class="No-Break"><span class="koboSpan" id="kobo.493.1">when authenticating.</span></span></p>
<p><span class="koboSpan" id="kobo.494.1">Here are the variables—they can all be found in the object returned when we created the </span><span class="No-Break"><span class="koboSpan" id="kobo.495.1">service principal:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">AZURE_CLIENT_ID</span></strong><span class="koboSpan" id="kobo.497.1"> : The ID of </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">the client</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">AZURE_TENANT_ID</span></strong><span class="koboSpan" id="kobo.500.1">: The Microsoft Entra ID </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">tenant ID</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">AZURE_CLIENT_SECRET</span></strong><span class="koboSpan" id="kobo.503.1">: The </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">credential secret</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.505.1">To set these variables, you can use the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">python-dotenv</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.507.1"> package.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.508.1">Identity libraries</span></p>
<p class="callout"><span class="koboSpan" id="kobo.509.1">To find out more about the libraries, </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">see here:</span></span></p>
<p class="callout"><a href="https://learn.microsoft.com/en-us/python/api/overview/azure/identity-readme?view=azure-python"><span class="No-Break"><span class="koboSpan" id="kobo.511.1">https://learn.microsoft.com/en-us/python/api/overview/azure/identity-readme?view=azure-python</span></span></a></p>
<p class="callout"><a href="https://pypi.org/project/python-dotenv/"><span class="No-Break"><span class="koboSpan" id="kobo.512.1">https://pypi.org/project/python-dotenv/</span></span></a></p>
<p><span class="koboSpan" id="kobo.513.1">If we are</span><a id="_idIndexMarker539"/><span class="koboSpan" id="kobo.514.1"> using a managed identity, the class will automatically detect the credentials, and there is no need for environment variables. </span><span class="koboSpan" id="kobo.514.2">Here is a code sample </span><span class="No-Break"><span class="koboSpan" id="kobo.515.1">for both:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.516.1">
from azure.identity import DefaultAzureCredential
identity= DefaultAzureCredential() identity.get_token("https://management.azure.com/.default")</span></pre> <p><span class="koboSpan" id="kobo.517.1">After this code, you can write your desired code to work with Azure Machine Learning and train </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">your models.</span></span></p>
<p><span class="koboSpan" id="kobo.519.1">Working with application identities helps us greatly ensure that we have consistency across roles and secure our ML assets. </span><span class="koboSpan" id="kobo.519.2">Now that we have reviewed our authentication and role management options, let us review some other services that complement this functionality and help us secure our </span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">workloads further.</span></span></p>
<h1 id="_idParaDest-143"><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.521.1">Enhancing access security</span></h1>
<p><span class="koboSpan" id="kobo.522.1">Now that </span><a id="_idIndexMarker540"/><span class="koboSpan" id="kobo.523.1">we have a better idea of how to</span><a id="_idIndexMarker541"/><span class="koboSpan" id="kobo.524.1"> leverage Microsoft Entra ID for authentication and role management, we can see some other services that we can use to complement and further secure our </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">users’ identities.</span></span></p>
<h2 id="_idParaDest-144"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.526.1">Conditional Access</span></h2>
<p><strong class="bold"><span class="koboSpan" id="kobo.527.1">Conditional Access</span></strong><span class="koboSpan" id="kobo.528.1"> in Microsoft Entra ID is a powerful feature that allows organizations </span><a id="_idIndexMarker542"/><span class="koboSpan" id="kobo.529.1">to set specific conditions and policies for granting or denying access to their cloud-based resources. </span><span class="koboSpan" id="kobo.529.2">With </span><strong class="bold"><span class="koboSpan" id="kobo.530.1">Conditional Access</span></strong><span class="koboSpan" id="kobo.531.1">, you can create rules and policies that consider a range of factors before allowing or blocking access, enhancing security </span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">and compliance.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.533.1">Conditional Access</span></strong><span class="koboSpan" id="kobo.534.1"> policies are rules that you define to control access to your protected resources. </span><span class="koboSpan" id="kobo.534.2">These policies are based on conditions and can be tailored to specific users, groups, applications, IP location information, user or sign risk detection, and devices. </span><span class="koboSpan" id="kobo.534.3">The action based on those signals is either </span><strong class="bold"><span class="koboSpan" id="kobo.535.1">Block/Allow</span></strong><span class="koboSpan" id="kobo.536.1">. </span><span class="koboSpan" id="kobo.536.2">You can combine multiple conditions based on different scenarios that apply to your organization </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">and users.</span></span></p>
<p><span class="koboSpan" id="kobo.538.1">The following are </span><a id="_idIndexMarker543"/><span class="koboSpan" id="kobo.539.1">some examples of policies that are </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">used commonly:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.541.1">Requiring </span><a id="_idIndexMarker544"/><span class="koboSpan" id="kobo.542.1">for </span><strong class="bold"><span class="koboSpan" id="kobo.543.1">multi-factor authentication</span></strong><span class="koboSpan" id="kobo.544.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.545.1">MFA</span></strong><span class="koboSpan" id="kobo.546.1">) to be enabled for users with highly privileged roles or from </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">unrecognized locations</span></span></li>
<li><span class="koboSpan" id="kobo.548.1">Blocking users that are flagged by the system as </span><span class="No-Break"><span class="koboSpan" id="kobo.549.1">high risk</span></span></li>
<li><span class="koboSpan" id="kobo.550.1">Allowing or blocking access from specific IPs </span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">or countries</span></span></li>
<li><span class="koboSpan" id="kobo.552.1">Requiring a password change to </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">allow access</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.554.1">This is the </span><strong class="bold"><span class="koboSpan" id="kobo.555.1">Overview</span></strong><span class="koboSpan" id="kobo.556.1"> blade of </span><strong class="bold"><span class="koboSpan" id="kobo.557.1">Conditional Access</span></strong><span class="koboSpan" id="kobo.558.1"> where you can manage policies, locations, networking, and </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">other features:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer144">
<span class="koboSpan" id="kobo.560.1"><img alt="Figure 6.25 – Conditional Access Overview blade" src="image/B21076_06_25.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.561.1">Figure 6.25 – Conditional Access Overview blade</span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.562.1">Conditional Access</span></strong><span class="koboSpan" id="kobo.563.1"> in Microsoft Entra ID is a dynamic and flexible tool that helps organizations strike a balance between security and user productivity. </span><span class="koboSpan" id="kobo.563.2">By setting up policies that </span><a id="_idIndexMarker545"/><span class="koboSpan" id="kobo.564.1">consider different factors, we can enforce access controls that adapt to the changing security landscape and the needs of </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">your organization.</span></span></p>
<p><span class="koboSpan" id="kobo.566.1">This is not the only tool we can use to enhance security. </span><span class="koboSpan" id="kobo.566.2">Let us see how we can use PIM together </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">with RBAC.</span></span></p>
<h2 id="_idParaDest-145"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.568.1">PIM</span></h2>
<p><span class="koboSpan" id="kobo.569.1">Microsoft Entra ID PIM is </span><a id="_idIndexMarker546"/><span class="koboSpan" id="kobo.570.1">an </span><a id="_idIndexMarker547"/><span class="koboSpan" id="kobo.571.1">Azure service that helps organizations manage, control, and monitor access within their Azure AD and other Microsoft Online services. </span><span class="koboSpan" id="kobo.571.2">It focuses on privileged accounts, which have access to critical resources and data. </span><span class="koboSpan" id="kobo.571.3">PIM provides features and capabilities to help organizations protect these privileged accounts and mitigate </span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">security risks.</span></span></p>
<p><span class="koboSpan" id="kobo.573.1">PIM can be</span><a id="_idIndexMarker548"/><span class="koboSpan" id="kobo.574.1"> used in conjunction with RBAC to enhance the security and management of privileged accounts and access to Azure resources. </span><span class="koboSpan" id="kobo.574.2">When used together, PIM and RBAC provide a comprehensive approach to managing access to Azure resources, especially those that require elevated privileges. </span><span class="koboSpan" id="kobo.574.3">We can </span><a id="_idIndexMarker549"/><span class="koboSpan" id="kobo.575.1">enable </span><strong class="bold"><span class="koboSpan" id="kobo.576.1">just-in-time</span></strong><span class="koboSpan" id="kobo.577.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.578.1">JIT</span></strong><span class="koboSpan" id="kobo.579.1">) and time-bound access for users assigned to specific RBAC roles. </span><span class="koboSpan" id="kobo.579.2">For example, if a user needs </span><strong class="bold"><span class="koboSpan" id="kobo.580.1">Contributor</span></strong><span class="koboSpan" id="kobo.581.1"> access to a resource group, Azure PIM allows them to activate this role only when necessary and for a defined duration. </span><span class="koboSpan" id="kobo.581.2">When a user needs to activate an RBAC role, they initiate a request through the Azure PIM interface by providing a valid justification. </span><span class="koboSpan" id="kobo.581.3">This request goes through an approval process, ensuring that activation is authorized by an appropriate administrator or role owner. </span><span class="koboSpan" id="kobo.581.4">The user specifies the duration, and access is automatically revoked when the specified time period expires, reducing the risk of prolonged </span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">elevated access.</span></span></p>
<p><span class="koboSpan" id="kobo.583.1">Azure PIM logs all activations and deactivations of RBAC roles, providing audit trails for compliance and security purposes. </span><span class="koboSpan" id="kobo.583.2">Organizations can regularly review and certify the continued need for privileged access through access reviews. </span><span class="koboSpan" id="kobo.583.3">This process helps ensure that users who have been assigned RBAC roles still require them, and that access remains aligned with </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">business needs.</span></span></p>
<p><span class="koboSpan" id="kobo.585.1">By combining Azure PIM and RBAC, organizations can strengthen their IAM strategy for Azure resources. </span><span class="koboSpan" id="kobo.585.2">This approach minimizes risks associated with persistent, overprivileged accounts, and helps organizations maintain control, visibility, and compliance while managing access to critical Azure services </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">and data.</span></span></p>
<h2 id="_idParaDest-146"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.587.1">Azure Key Vault</span></h2>
<p><span class="koboSpan" id="kobo.588.1">Azure Key Vault</span><a id="_idIndexMarker550"/><span class="koboSpan" id="kobo.589.1"> is a cloud service</span><a id="_idIndexMarker551"/><span class="koboSpan" id="kobo.590.1"> provided by Microsoft Azure that helps you securely manage keys, secrets, certificates, and other sensitive information used by your applications and services. </span><span class="koboSpan" id="kobo.590.2">It is designed to provide a centralized and secure location for storing and managing cryptographic keys and other secrets, making it easier to adhere to security best practices and compliance</span><a id="_idIndexMarker552"/><span class="koboSpan" id="kobo.591.1"> requirements. </span><span class="koboSpan" id="kobo.591.2">Here is some information about </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">its features:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.593.1">Key management</span></strong><span class="koboSpan" id="kobo.594.1">: Azure Key Vault allows us to generate, import, and manage cryptographic keys used for encryption, decryption, and authentication. </span><span class="koboSpan" id="kobo.594.2">It supports various </span><a id="_idIndexMarker553"/><span class="koboSpan" id="kobo.595.1">key types, including </span><strong class="bold"><span class="koboSpan" id="kobo.596.1">Rivest–Shamir–Adleman</span></strong><span class="koboSpan" id="kobo.597.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.598.1">RSA</span></strong><span class="koboSpan" id="kobo.599.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.600.1">Advanced Encryption Standard</span></strong><span class="koboSpan" id="kobo.601.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.602.1">AES</span></strong><span class="koboSpan" id="kobo.603.1">), and elliptic</span><a id="_idIndexMarker554"/> <span class="No-Break"><span class="koboSpan" id="kobo.604.1">curve keys.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.605.1">Secrets management</span></strong><span class="koboSpan" id="kobo.606.1">: We can use Azure Key Vault to store and manage secrets, such as connection strings, API keys, and passwords. </span><span class="koboSpan" id="kobo.606.2">These secrets are stored securely and can be accessed programmatically by </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">your applications.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.608.1">Certificate management</span></strong><span class="koboSpan" id="kobo.609.1">: Key Vault enables the management of X.509 certificates and automates tasks such as certificate renewal. </span><span class="koboSpan" id="kobo.609.2">It also supports integration with Azure services such </span><a id="_idIndexMarker555"/><span class="koboSpan" id="kobo.610.1">as Azure Application Gateway and </span><strong class="bold"><span class="koboSpan" id="kobo.611.1">Azure Kubernetes Service</span></strong><span class="koboSpan" id="kobo.612.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.613.1">AKS</span></strong><span class="koboSpan" id="kobo.614.1">) for SSL/TLS </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">certificate management.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.616.1">To retrieve keys or secrets, instead of hardcoding the secrets, we authenticate to Key Vault to retrieve them. </span><span class="koboSpan" id="kobo.616.2">This adds another layer of security, and we can revoke access easily at any time and have additional security options such as key versioning, logging, backup, purge protection, </span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">and more.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.618.1">Best practice</span></p>
<p class="callout"><span class="koboSpan" id="kobo.619.1">Combine the Azure Key Vault service with managed identities for </span><span class="No-Break"><span class="koboSpan" id="kobo.620.1">maximum security.</span></span></p>
<p><span class="koboSpan" id="kobo.621.1">For Azure Machine Learning, we can combine the Azure Key Vault service with managed identities to retrieve secrets in our scripts. </span><span class="koboSpan" id="kobo.621.2">All we need is the Azure Key Vault Secrets client library </span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">for Python.</span></span></p>
<p><span class="koboSpan" id="kobo.623.1">Before we get </span><a id="_idIndexMarker556"/><span class="koboSpan" id="kobo.624.1">started, we need to make sure we have the following prerequisites along with </span><span class="No-Break"><span class="koboSpan" id="kobo.625.1">our workspace:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.626.1">An Azure Key Vault resource with the secret value we want </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">to retrieve</span></span></li>
<li><span class="koboSpan" id="kobo.628.1">A compute cluster with a managed identity enabled and assigned with the proper RBAC roles or access policies in Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.629.1">Key Vault</span></span></li>
<li><span class="koboSpan" id="kobo.630.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">azure-keyvault-secrets</span></strong><span class="koboSpan" id="kobo.632.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1">azure-identity</span></strong><span class="koboSpan" id="kobo.634.1"> packages installed in our Azure Machine </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">Learning environment</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.636.1">If you have all the prerequisites completed, you can retrieve the secret using the following code sample. </span><span class="koboSpan" id="kobo.636.2">Just ensure you replace the key vault name with yours and the secret name </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">with yours:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.638.1">
from azure.identity import DefaultAzureCredential
from azure.keyvault.secrets import SecretClient
identity= DefaultAzureCredential()
kv_client = SecretClient(vault_url="https://&lt;key vault name&gt;.vault.azure.net/", credential= identity)
secret = kv_client.get_secret("secret-name")
print(secret.value)</span></pre> <p><strong class="bold"><span class="koboSpan" id="kobo.639.1">Conditional Access</span></strong><span class="koboSpan" id="kobo.640.1"> and PIM are both Microsoft Entra ID features that, when enabled, provide additional security to our identities and keep our user credentials secure and in accordance with the PoLP. </span><span class="koboSpan" id="kobo.640.2">Azure Key Vault is a critical component in building secure and compliant applications in the Azure cloud environment, especially when you combine it with managed identities. </span><span class="koboSpan" id="kobo.640.3">These features might be optional, but they need to be considered when working to secure our </span><span class="No-Break"><span class="koboSpan" id="kobo.641.1">ML projects.</span></span></p>
<h1 id="_idParaDest-147"><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.642.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.643.1">In this chapter, we focused on all aspects of identity and adhering to the PoLP. </span><span class="koboSpan" id="kobo.643.2">Although simple in theory, the PoLP is an iterative and continuous process that we need to monitor in order to prevent overprivileged applications. </span><span class="koboSpan" id="kobo.643.3">Since Microsoft Entra ID is the identity management tool for Azure and, by extension, Azure Machine Learning, implementing its core features such as RBAC and learning to work with application identities will help us ensure that the credentials of our users and applications will not be compromised easily. </span><span class="koboSpan" id="kobo.643.4">Additionally, implementing features such as </span><strong class="bold"><span class="koboSpan" id="kobo.644.1">Conditional Access</span></strong><span class="koboSpan" id="kobo.645.1"> and PIM can provide an additional level of security to our identities. </span><span class="koboSpan" id="kobo.645.2">But these credentials are not the only ones that matter. </span><span class="koboSpan" id="kobo.645.3">In our scripts, we might be using different connection strings or secrets. </span><span class="koboSpan" id="kobo.645.4">We can use the Key Vault service together with managed identities where it is possible to manage them centrally and ensure that our secrets </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">are safe.</span></span></p>
<p><span class="koboSpan" id="kobo.647.1">In the next chapter, we will explore everything to do with our workspace security and the underlying infrastructure. </span><span class="koboSpan" id="kobo.647.2">We will learn how to secure our compute and endpoints and take advantage of any existing Azure infrastructure such as networks for </span><span class="No-Break"><span class="koboSpan" id="kobo.648.1">added security.</span></span></p>
</div>
</body></html>
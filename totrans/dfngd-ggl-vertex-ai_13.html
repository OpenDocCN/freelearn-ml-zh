<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><div id="_idContainer144">
			<h1 id="_idParaDest-194" class="chapter-number"><a id="_idTextAnchor194"/>13</h1>
			<h1 id="_idParaDest-195"><a id="_idTextAnchor195"/>Document AI – An End-to-End Solution for Processing Documents</h1>
			<p>Almost every business relies on some kind of document to convey information daily. This can be in the form of emails, contracts, forms, PDFs, and so on. Because this data is unstructured, many businesses often fail to take advantage of the value coming from this data. If there is a way to convert this huge amount of data from documents into machine-readable format, it can help with many useful tasks, such as automating business processes, doing analytics, applying AI and ML, and more. Considering the size of the data, it’s often not possible to parse these documents manually to extract information. Tools such <a id="_idIndexMarker882"/>as <strong class="bold">optical character recognition</strong> (<strong class="bold">OCR</strong>) can help in partially automating the task of at least converting the document into text format, but it will still be unstructured and more effort is required to make <span class="No-Break">it useful.</span></p>
			<p>Document AI<a id="_idIndexMarker883"/> is Google Cloud’s managed service that converts unstructured content (different types of documents) into structured data. It is an end-to-end cloud-based platform for extracting and classifying information in a structured way, such as key-value pairs, so that it is easy to make this data useful. Document AI is a complex solution that involves many AI and<a id="_idIndexMarker884"/> ML-based algorithms such as OCR, image recognition, <strong class="bold">natural language processing</strong> (<strong class="bold">NLP</strong>), entity extraction, machine translation, and <span class="No-Break">many others.</span></p>
			<p>In this chapter, we will learn how to work with Document AI on GCP to extract useful information for any business problem. The following main topics will be covered in <span class="No-Break">this chapter:</span></p>
			<ul>
				<li>What is <span class="No-Break">Document AI?</span></li>
				<li>Overview of existing Document <span class="No-Break">AI processors</span></li>
				<li>Creating custom Document <span class="No-Break">AI processors</span></li>
			</ul>
			<h1 id="_idParaDest-196"><a id="_idTextAnchor196"/>Technical requirements</h1>
			<p>The code examples shown in this chapter can be found in the following GitHub <span class="No-Break">repository: </span><a href="https://github.com/PacktPublishing/The-Definitive-Guide-to-Google-Vertex-AI/tree/main/Chapter13"><span class="No-Break">https://github.com/PacktPublishing/The-Definitive-Guide-to-Google-Vertex-AI/tree/main/Chapter13</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-197"><a id="_idTextAnchor197"/>What is Document AI?</h1>
			<p>Document AI is<a id="_idIndexMarker885"/> an end-to-end AI-based solution for extracting and classifying useful information from any kind of unstructured documents, including scanned images, PDFs, forms, emails, and contracts. Document AI’s solution includes pre-trained ML models for extraction and other document-related tasks, and it also provides the flexibility to uptrain existing models and train custom models without writing much code. Document AI is one unified solution that can help businesses manage the entire unstructured document life cycle, ensuring a high level of accuracy and low costs to accelerate deployment to meet <span class="No-Break">customer expectations.</span></p>
			<p>Some key features of Google Cloud’s Document AI platform are <span class="No-Break">as follows:</span></p>
			<ul>
				<li><strong class="bold">Google’s state-of-the-art AI</strong>: The <a id="_idIndexMarker886"/>Document AI platform is built upon Google’s industry-leading AI innovations in various fields, including computer vision (including OCR), NLP, and semantic search, to make this platform highly accurate <span class="No-Break">and useful.</span></li>
				<li><strong class="bold">A unified console</strong>: It has one unified console that lets us quickly access all the related models and tools, including OCR and form parsers. Document AI Workbench lets us create custom or uptrain existing models with minimal effort. Document AI Warehouse lets us store, search for, and manage documents, and even <span class="No-Break">trigger workflows.</span></li>
				<li><strong class="bold">Google Knowledge Graph</strong>: We can leverage Google’s Knowledge Graph technology to validate and enrich parsed information, such as addresses and phone numbers, against entities on <span class="No-Break">the internet.</span></li>
				<li><strong class="bold">Human-in-the-loop AI</strong>: This<a id="_idIndexMarker887"/> feature can help us achieve higher accuracy with the assurance of human review. Along with accuracy, it can also help in interpreting predictions using <span class="No-Break">purpose-built tools.</span></li>
			</ul>
			<p>Now let’s take a look at Document <span class="No-Break">AI processors.</span></p>
			<h2 id="_idParaDest-198"><a id="_idTextAnchor198"/>Document AI processors</h2>
			<p>A Document AI processor<a id="_idIndexMarker888"/> is an interface between a document file and an underlying ML model that performs a document processing-related task. A processor can be used to classify, split, parse, or analyze a document. Document AI processors can be classified into the following <span class="No-Break">three categories:</span></p>
			<ul>
				<li><strong class="bold">General</strong>: These are<a id="_idIndexMarker889"/> prebuilt processors and can be applied to any use case. OCR is an example of a general-purpose processor that is use case <span class="No-Break">or document-independent.</span></li>
				<li><strong class="bold">Specialized</strong>: These <a id="_idIndexMarker890"/>are also prebuilt processors that are specifically built to work well with some fixed types of documents. As these are specialized, they are often highly accurate in performing their tasks. Specialized processors are more useful in use cases related to identifying verification, lending applications, contracts, and payment-related documents such as invoices <span class="No-Break">and receipts.</span></li>
				<li><strong class="bold">Custom</strong>: These can be<a id="_idIndexMarker891"/> created on a use case and requirement basis. Sometimes, we may need to uptrain existing models or train custom models. Custom processors provide the flexibility of using the solution as per the <span class="No-Break">customer’s needs.</span></li>
			</ul>
			<p><span class="No-Break"><em class="italic">Figure 13</em></span><em class="italic">.1</em> can help in determining which processor is more suitable for a given <span class="No-Break">use case:</span></p>
			<div>
				<div id="_idContainer136" class="IMG---Figure">
					<img src="image/B17792_13_1.jpg" alt="Figure 13.1 – Document processing overview on Google Cloud" width="1282" height="617"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.1 – Document processing overview on Google Cloud</p>
			<p>Now that we have a good understanding of the Document AI platform from a theoretical perspective, next, we will go through some exercises on how to use this solution to solve a <span class="No-Break">business problem.</span></p>
			<h1 id="_idParaDest-199"><a id="_idTextAnchor199"/>Overview of existing Document AI processors</h1>
			<p>As discussed previously, the Document AI platform provides prebuilt parsers for general-purpose, as well as some specialized, use cases. As these processors are prebuilt, they are readily available to use in any relevant use case with very little effort. Before jumping into an example of how these processors work, let’s first look at the list of available processors as part of Google Cloud’s Document <span class="No-Break">AI platform:</span></p>
			<ul>
				<li><strong class="bold">Document OCR</strong>: Identify <a id="_idIndexMarker892"/>and extract both machine-printed as well as handwritten text <a id="_idIndexMarker893"/>from documents in over <span class="No-Break">200 languages</span></li>
				<li><strong class="bold">Form Parser</strong>: Extract<a id="_idIndexMarker894"/> key-value pairs (entity and checkbox), tables, and generic<a id="_idIndexMarker895"/> entities in addition to <span class="No-Break">OCR text</span></li>
				<li><strong class="bold">Intelligent Document Quality Processor</strong>: Assesses the quality of documents based on their<a id="_idIndexMarker896"/> readability and provides a <a id="_idIndexMarker897"/><span class="No-Break">quality score</span></li>
				<li><strong class="bold">Document Splitter</strong>: Automatically<a id="_idIndexMarker898"/> splits documents based on <span class="No-Break">logical </span><span class="No-Break"><a id="_idIndexMarker899"/></span><span class="No-Break">boundaries</span></li>
			</ul>
			<p>Document AI provides us with numerous specialized processors as well. Some common examples of specialized prebuilt processors are <span class="No-Break">as follows:</span></p>
			<ul>
				<li><strong class="bold">Contract Parser</strong>: Extract<a id="_idIndexMarker900"/> text and values from legal contacts, such as<a id="_idIndexMarker901"/> agreement date, effective date, <span class="No-Break">and parties</span></li>
				<li><strong class="bold">France Driver License Parser</strong>: Extract<a id="_idIndexMarker902"/> fields such as names, document<a id="_idIndexMarker903"/> ID, date of birth, and so on from French <span class="No-Break">driver’s licenses.</span></li>
				<li><strong class="bold">US Passport Parser</strong>: Extract <a id="_idIndexMarker904"/>important fields such as name, date of birth, and <a id="_idIndexMarker905"/>document ID from US <span class="No-Break">passport images</span></li>
				<li><strong class="bold">Pay Slip Parser</strong>: Extract <a id="_idIndexMarker906"/>name, business, and amounts from pay <span class="No-Break">slip </span><span class="No-Break"><a id="_idIndexMarker907"/></span><span class="No-Break">documents</span></li>
				<li><strong class="bold">Invoice Parser</strong>: Extract<a id="_idIndexMarker908"/> values such as invoice number, supplier name, amount, tax <a id="_idIndexMarker909"/>amount, due date, and <span class="No-Break">so on</span></li>
			</ul>
			<p>Now, let’s go ahead and try out one of these parsers on <span class="No-Break">example documents.</span></p>
			<h2 id="_idParaDest-200"><a id="_idTextAnchor200"/>Using Document AI processors</h2>
			<p>There are three major steps to using<a id="_idIndexMarker910"/> Document AI processors to start <span class="No-Break">processing documents:</span></p>
			<ol>
				<li><strong class="bold">Choosing a processor</strong>: Choosing the best processor for a use case is very important to get the best results out of it. The documentation of the Document AI solution can help in determining the best parser for a given <span class="No-Break">use case.</span></li>
				<li><strong class="bold">Creating a processor</strong>: Creating a processor means deploying a prebuilt processor to an endpoint so that it can <span class="No-Break">accept requests.</span></li>
				<li><strong class="bold">Processing documents</strong>: In this step, we send document processing requests to the endpoint to get extracted <span class="No-Break">structured information.</span></li>
			</ol>
			<p>Now, let’s follow the <a id="_idIndexMarker911"/>aforementioned steps and try out one of the parsers. In this example, we will try out the general-purpose Document OCR parser to extract the text information from an <span class="No-Break">example document.</span></p>
			<p>The first step is to open the Google Cloud console, go to <strong class="bold">Document AI</strong>, and click on <strong class="bold">Processor gallery</strong> in the left pane. <strong class="bold">Processor gallery</strong> consists of all the prebuilt document processors with categories. Go to the <strong class="bold">Document OCR</strong> parser and click on the <strong class="bold">Create processor</strong> button. It will ask us to provide a processor name and region to deploy it. After a few seconds, we should be able to see this processor inside the <strong class="bold">My Processors</strong> tab, as shown in <span class="No-Break"><em class="italic">Figure 13</em></span><span class="No-Break"><em class="italic">.2</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer137" class="IMG---Figure">
					<img src="image/B17792_13_2.jpg" alt="Figure 13.2 – Creating a custom processor within Google Cloud’s Document AI" width="1208" height="577"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.2 – Creating a custom processor within Google Cloud’s Document AI</p>
			<p>We can get the prediction endpoint and other useful information by clicking on the processor’s name (see <span class="No-Break"><em class="italic">Figure 13</em></span><span class="No-Break"><em class="italic">.3</em></span><span class="No-Break">):</span></p>
			<div>
				<div id="_idContainer138" class="IMG---Figure">
					<img src="image/B17792_13_3.jpg" alt="Figure 13.3 – Document AI processor details in the Google Cloud console UI" width="1210" height="434"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.3 – Document AI processor details in the Google Cloud console UI</p>
			<p>The console UI, as <a id="_idIndexMarker912"/>shown in the previous screenshot, also gives us the option to directly upload a document and test the results. Let’s try this out by uploading a sample document. To make things a little more complicated and interesting, I have written something on a piece of paper in my bad handwriting. Let’s see how it works on that (see <span class="No-Break"><em class="italic">Figure 13</em></span><span class="No-Break"><em class="italic">.4</em></span><span class="No-Break">):</span></p>
			<div>
				<div id="_idContainer139" class="IMG---Figure">
					<img src="image/B17792_13_4.jpg" alt="Figure 13.4 – Document OCR analysis results on an example handwritten image" width="1211" height="762"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.4 – Document OCR analysis results on an example handwritten image</p>
			<p>As we can see, Document OCR works great on <span class="No-Break">handwritten documents.</span></p>
			<p>Now, let’s try this out within a Jupyter Notebook cell to get the output through an API request using Python. Upon going to the <strong class="bold">MANAGE VERSIONS</strong> tab within the console, you can <a id="_idIndexMarker913"/>choose from different trained API versions to use (see <span class="No-Break"><em class="italic">Figure 13</em></span><span class="No-Break"><em class="italic">.5</em></span><span class="No-Break">):</span></p>
			<div>
				<div id="_idContainer140" class="IMG---Figure">
					<img src="image/B17792_13_5.jpg" alt="Figure 13.5 – Managing versions for Document AI processors" width="1211" height="608"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.5 – Managing versions for Document AI processors</p>
			<p><span class="No-Break"><em class="italic">Figure 13</em></span><em class="italic">.6</em> shows how a<a id="_idIndexMarker914"/> Python request can be used to get the response from the Document OCR solution from within a notebook. The full code can be accessed in the GitHub repository for <span class="No-Break">this chapter:</span></p>
			<div>
				<div id="_idContainer141" class="IMG---Figure">
					<img src="image/B17792_13_6.jpg" alt="Figure 13.6 – Using a Python request to get predictions from Document AI processors" width="1259" height="1007"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.6 – Using a Python request to get predictions from Document AI processors</p>
			<p>In this screenshot of<a id="_idIndexMarker915"/> Jupyter Notebook, we are using the <strong class="source-inline">process_document_sample</strong> function. This function is available in Google Cloud’s public GitHub samples. This function is also available in the GitHub repository for this chapter. I ran the following code snippet for <span class="No-Break">this function:</span></p>
			<pre class="source-code">
def process_document_sample(
    project_id: str,
    location: str,
    processor_id: str,
    file_path: str,
    mime_type: str,
    field_mask: str = None,
):</pre>			<p>You must set <strong class="source-inline">api_endpoint</strong> if you’re using a location other <span class="No-Break">than </span><span class="No-Break"><strong class="source-inline">us</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
    opts = ClientOptions(api_endpoint=f"{location}-documentai.googleapis.com")
    client = documentai.DocumentProcessorServiceClient(client_options=opts)    name = client.processor_path(project_id, location, processor_id)
    # Read the file into memory
    with open(file_path, "rb") as image:
        image_content = image.read()</pre>			<p>Now, we must load<a id="_idIndexMarker916"/> binary data into the Document AI <span class="No-Break"><strong class="source-inline">RawDocument</strong></span><span class="No-Break"> object:</span></p>
			<pre class="source-code">
    raw_document = documentai.RawDocument(content=image_content, mime_type=mime_type)
    # Configure the process request
    request = documentai.ProcessRequest(
        name=name, raw_document=raw_document, field_mask=field_mask
    )
    result = client.process_document(request=request)    document = result.document
    # Read the text recognition output from the processor
    print("The document contains the following text:")
    print(document.text)</pre>			<p>With that, we<a id="_idIndexMarker917"/> have a good idea of how to work with prebuilt Document AI processors and get results by using an API call on the underlying ML models. In the next section, we will learn how to create a custom processor if a use case doesn’t quite fit the <span class="No-Break">prebuilt processors.</span></p>
			<h1 id="_idParaDest-201"><a id="_idTextAnchor201"/>Creating custom Document AI processors</h1>
			<p>If we are unable to find a <a id="_idIndexMarker918"/>suitable prebuilt processor for our use case, Document AI Workbench lets us build and train our own tailored processors from scratch and with minimal effort. If we go to the <strong class="bold">Workbench</strong> tab inside Document AI, we’ll get the following options for creating a custom processor (see <span class="No-Break"><em class="italic">Figure 13</em></span><span class="No-Break"><em class="italic">.7</em></span><span class="No-Break">):</span></p>
			<div>
				<div id="_idContainer142" class="IMG---Figure">
					<img src="image/B17792_13_7.jpg" alt="Figure 13.7 – Document AI Workbench for creating custom model-based processors" width="1071" height="595"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.7 – Document AI Workbench for creating custom model-based processors</p>
			<p>In this exercise, we <a id="_idIndexMarker919"/>will work with the <strong class="bold">Custom Document Extractor</strong> solution to create a custom processor. Once we click on <strong class="bold">CREATE PROCESSOR</strong>, we will be able to find this processor within the <strong class="bold">My Processors</strong> tab. If we click on the processor, we will get options for training, evaluating, and testing our custom processor, as well as options for managing deployed versions of custom models. After training a version, we can also configure the <strong class="bold">Human-in-the-loop</strong> feature. See <span class="No-Break"><em class="italic">Figure 13</em></span><em class="italic">.8</em> for <span class="No-Break">these options:</span></p>
			<div>
				<div id="_idContainer143" class="IMG---Figure">
					<img src="image/B17792_13_8.jpg" alt="Figure 13.8 – Custom Document AI processor details in the Google Cloud console UI" width="1210" height="570"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.8 – Custom Document AI processor details in the Google Cloud console UI</p>
			<p>As you can see, creating<a id="_idIndexMarker920"/> a custom processor requires a training dataset so that we can fine-tune existing ML models on our specific use case-related documents. We should only go for a custom processor if the prebuilt general solution is not meeting our business expectations in terms of text extraction accuracy. This is because curating our own training dataset can be a complex process as it requires manual effort. If we have a good dataset already available, then training a custom processor is just a few clicks away using the Document <span class="No-Break">AI platform.</span></p>
			<p>Once our custom processor has finished training and shows good results in testing, we can move on to deploying it as a model version. This version can then be utilized in production by making API calls, much like how prebuilt processors <span class="No-Break">are used.</span></p>
			<h1 id="_idParaDest-202"><a id="_idTextAnchor202"/>Summary</h1>
			<p>This chapter highlighted the fact that every business or company uses many forms of documents (such as emails, contracts, forms, PDFs, and images) to share and store information. Document AI is an end-to-end solution on Google Cloud that lets us extract this information in a structured way such that it can be readily used to train ML models or perform other downstream tasks to make a lot of value out of the information within <span class="No-Break">these documents.</span></p>
			<p>By completing this chapter, you should now be confident about Document AI and its importance for every business. You should also have a good understanding of prebuilt processors within Document AI and should be able to integrate them into their application easily. Finally, if prebuilt processors don’t fulfill your expectations, there are options to build custom processors to meet the goal of your <span class="No-Break">use case.</span></p>
			<p>We now have a good understanding of Document AI on Google Cloud. In the next chapter, we will learn about more Google productions related to vision, NLP, <span class="No-Break">and speech.</span></p>
		</div>
	</div>
</div>
</body></html>
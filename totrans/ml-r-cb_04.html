<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;4.&#xA0;Understanding Regression Analysis"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04" class="calibre1"/>Chapter 4. Understanding Regression Analysis</h1></div></div></div><p class="calibre7">In this chapter, we will cover the following recipes:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Fitting a linear regression model with lm</li><li class="listitem">Summarizing linear model fits</li><li class="listitem">Using linear regression to predict unknown values</li><li class="listitem">Generating a diagnostic plot of a fitted model</li><li class="listitem">Fitting a polynomial regression model with lm</li><li class="listitem">Fitting a robust linear regression model with rlm</li><li class="listitem">Studying a case of linear regression on SLID data</li><li class="listitem">Applying the Gaussian model for generalized linear regression</li><li class="listitem">Applying the Poisson model for generalized linear regression</li><li class="listitem">Applying the Binomial model for generalized linear regression</li><li class="listitem">Fitting a generalized additive model to data</li><li class="listitem">Visualizing a generalized additive model</li><li class="listitem">Diagnosing a generalized additive model</li></ul></div></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Understanding Regression Analysis">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch04lvl1sec40" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre7">Regression is a<a id="id353" class="calibre1"/> supervised learning method, which is employed to model and analyze the relationship between a dependent (response) variable and one or more independent (predictor) variables. One can use regression to build a prediction model, which can first be used to find the best fitted model with minimum squared errors of the fitted values. The fitted model can then be further applied to data for continuous value predictions.</p><p class="calibre7">There are many types of regression. If there is only one predictor variable, and the relationship<a id="id354" class="calibre1"/> between the response variable and independent variable is linear, we can apply a linear model. However, if there is more than one predictor variable, a multiple linear regression method should be used. When the relationship is nonlinear, one can use a nonlinear model to model the relationship between the predictor and response variables.</p><p class="calibre7">In this chapter, we introduce how to fit a linear model into data with the <code class="email">lm</code> function. Next, for distribution in other than the normal Gaussian model (for example, Poisson or Binomial), we use the <code class="email">glm</code> function with an appropriate link function correspondent to the data distribution. Finally, we cover how to fit a generalized additive model into data using the <code class="email">gam</code> function.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Fitting a linear regression model with lm"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec41" class="calibre1"/>Fitting a linear regression model with lm</h1></div></div></div><p class="calibre7">The simplest model in regression is linear regression, which is best used when there is only one <a id="id355" class="calibre1"/>predictor variable, and the relationship between the response variable and the independent variable is linear. In R, we <a id="id356" class="calibre1"/>can fit a linear model to data with the <code class="email">lm</code> function.</p></div>

<div class="book" title="Fitting a linear regression model with lm">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec125" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">We need to prepare data with one predictor and response variable, and with a linear relationship between the two variables.</p></div></div>

<div class="book" title="Fitting a linear regression model with lm">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec126" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to perform linear regression with <code class="email">lm</code>:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">You should install the <code class="email">car</code> package and load its library:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages("car")</strong></span>
<span class="strong"><strong class="calibre2">&gt; library(car)</strong></span>
</pre></div></li><li class="listitem" value="2">From the package, you can load the <code class="email">Quartet</code> dataset:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; data(Quartet)</strong></span>
</pre></div></li><li class="listitem" value="3">You can use the <code class="email">str</code> function to display the structure of the <code class="email">Quartet</code> dataset:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; str(Quartet)</strong></span>
<span class="strong"><strong class="calibre2">'data.frame':   11 obs. of  6 variables:</strong></span>
<span class="strong"><strong class="calibre2"> $ x : int  10 8 13 9 11 14 6 4 12 7 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ y1: num  8.04 6.95 7.58 8.81 8.33 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ y2: num  9.14 8.14 8.74 8.77 9.26 8.1 6.13 3.1 9.13 7.26 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ y3: num  7.46 6.77 12.74 7.11 7.81 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ x4: int  8 8 8 8 8 8 8 19 8 8 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ y4: num  6.58 5.76 7.71 8.84 8.47 7.04 5.25 12.5 5.56 7.91 ...</strong></span>
</pre></div></li><li class="listitem" value="4">Draw<a id="id357" class="calibre1"/> a scatter plot of the <a id="id358" class="calibre1"/>x and y variables with <code class="email">plot</code>, and append a fitted line through the <code class="email">lm</code> and <code class="email">abline</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(Quartet$x, Quartet$y1)</strong></span>
<span class="strong"><strong class="calibre2">&gt; lmfit = lm(y1~x, Quartet) </strong></span>
<span class="strong"><strong class="calibre2">&gt; abline(lmfit, col="red")  </strong></span>
</pre></div><div class="mediaobject"><img src="../images/00078.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">A simple regression plot fitted by lm</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="5">To view the fit model, execute the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lmfit</strong></span>

<span class="strong"><strong class="calibre2">Call:</strong></span>
<span class="strong"><strong class="calibre2">lm(formula = y1 ~ x, data = Quartet)</strong></span>

<span class="strong"><strong class="calibre2">Coefficients:</strong></span>
<span class="strong"><strong class="calibre2">(Intercept)            x  </strong></span>
<span class="strong"><strong class="calibre2">     3.0001       0.5001 </strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Fitting a linear regression model with lm">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec127" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">The <a id="id359" class="calibre1"/>regression model has the <code class="email">response ~ terms</code> form, where <code class="email">response</code> is the response vector, and <code class="email">terms</code> is a series of <a id="id360" class="calibre1"/>terms that specifies a predictor. We can illustrate a simple regression model in the formula <span class="strong"><em class="calibre8">y=α+βx</em></span>, where <span class="strong"><em class="calibre8">α</em></span> is the intercept while the slope, <span class="strong"><em class="calibre8">β</em></span>, describes the change in <span class="strong"><em class="calibre8">y</em></span> when <span class="strong"><em class="calibre8">x</em></span> changes. By using the least squares method, we can estimate <span class="strong"><img src="../images/00079.jpeg" alt="How it works..." class="calibre24"/></span> and <span class="strong"><img src="../images/00080.jpeg" alt="How it works..." class="calibre24"/></span> (where <span class="strong"><img src="../images/00081.jpeg" alt="How it works..." class="calibre24"/></span> indicates the mean value of <span class="strong"><em class="calibre8">y</em></span> and <span class="strong"><img src="../images/00082.jpeg" alt="How it works..." class="calibre24"/></span> denotes the mean value of <span class="strong"><em class="calibre8">x</em></span>).</p><p class="calibre7">To perform linear regression, we first prepare the data that has a linear relationship between the predictor variable and response variable. In this example, we load Anscombe's quartet dataset from the package car. Within the dataset, the <span class="strong"><em class="calibre8">x</em></span> and <span class="strong"><em class="calibre8">y1</em></span> variables have a linear relationship, and we prepare a scatter plot of these variables. To generate the regression line, we use the lm function to generate a model of the two variables. Further, we use <code class="email">abline</code> to plot a regression line on the plot. As per the previous screenshot, the regression line illustrates the linear relationship of <span class="strong"><em class="calibre8">x</em></span> and <span class="strong"><em class="calibre8">y1</em></span> variables. We can see that the coefficient of the fitted model shows the intercept equals 3.0001 and coefficient equals 0.5001. As a result, we can use the intercept and coefficient to infer the response value. For example, we can infer the response value when <span class="strong"><em class="calibre8">x</em></span> at 3 is equal to <span class="strong"><em class="calibre8">4.5103 (3 * 0.5001 + 3.0001)</em></span>.
</p></div></div>

<div class="book" title="Fitting a linear regression model with lm">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec128" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">Besides the <code class="email">lm</code> function, you can also use the <code class="email">lsfit</code> function to perform simple linear regression. For example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(Quartet$x, Quartet$y1)</strong></span>
<span class="strong"><strong class="calibre2">&gt; lmfit2 = lsfit(Quartet$x,Quartet$y1)</strong></span>
<span class="strong"><strong class="calibre2">&gt; abline(lmfit2, col="red")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00083.jpeg" alt="There's more..." class="calibre9"/><div class="caption"><p class="calibre12">A simple regression fitted by the lsfit function.</p></div></div><p class="calibre10"> </p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Summarizing linear model fits"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec42" class="calibre1"/>Summarizing linear model fits</h1></div></div></div><p class="calibre7">The <code class="email">summary</code> function can be used to obtain the formatted coefficient, standard errors, degree <a id="id361" class="calibre1"/>of freedom, and other summarized information of a fitted model. This recipe introduces<a id="id362" class="calibre1"/> how to obtain overall information on a model through the use of the <code class="email">summary</code> function.</p></div>

<div class="book" title="Summarizing linear model fits">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec129" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">You need to have completed the previous recipe by computing the linear model of the <span class="strong"><em class="calibre8">x</em></span> and <span class="strong"><em class="calibre8">y1</em></span> variables from the quartet, and have the fitted model assigned to the <code class="email">lmfit</code> variable.</p></div></div>

<div class="book" title="Summarizing linear model fits">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec130" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following step to summarize linear model fits:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Compute a detailed summary of the fitted model:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; summary(lmfit)</strong></span>

<span class="strong"><strong class="calibre2">Call:</strong></span>
<span class="strong"><strong class="calibre2">lm(formula = y1 ~ x)</strong></span>

<span class="strong"><strong class="calibre2">Residuals:</strong></span>
<span class="strong"><strong class="calibre2">     Min       1Q   Median       3Q      Max </strong></span>
<span class="strong"><strong class="calibre2">-1.92127 -0.45577 -0.04136  0.70941  1.83882 </strong></span>

<span class="strong"><strong class="calibre2">Coefficients:</strong></span>
<span class="strong"><strong class="calibre2">            Estimate Std. Error t value Pr(&gt;|t|)   </strong></span>
<span class="strong"><strong class="calibre2">(Intercept)   3.0001     1.1247   2.667  0.02573 * </strong></span>
<span class="strong"><strong class="calibre2">Quartet$x     0.5001     0.1179   4.241  0.00217 **</strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">Residual standard error: 1.237 on 9 degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">Multiple R-squared:  0.6665,    Adjusted R-squared:  0.6295 </strong></span>
<span class="strong"><strong class="calibre2">F-statistic: 17.99 on 1 and 9 DF,  p-value: 0.00217</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Summarizing linear model fits">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec131" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">The <code class="email">summary</code> function is a generic function used to produce summary statistics. In this case, it <a id="id363" class="calibre1"/>computes and returns a list of the summary statistics of the fitted linear model. Here, it will output information such as residuals, coefficient standard error R-squared, f-statistic, and a degree of freedom. In the <code class="email">Call</code> section, the function called to generate the fitted <a id="id364" class="calibre1"/>model is displayed. In the <code class="email">Residuals</code> section, it provides a quick summary (min, 1Q, median, 3Q, max) of the distribution. </p><p class="calibre7">In the <code class="email">Coefficients</code> section, each coefficient is a Gaussian random variable. Within this section, <code class="email">Estimate</code> represents the mean distribution of the variable; <code class="email">Std.Error</code> displays the standard error of the variable; the <code class="email">t</code> value is <code class="email">Estimate</code> divided by <code class="email">Std.Error</code> and the <code class="email">p</code> value indicates the probability of getting a value larger than the <code class="email">t</code> value. In this sample, the <code class="email">p</code> value of both intercepts (0.002573) and x (0.00217) have a 95 percent level of confidence.</p><p class="calibre7">Residual standard error outputs the standard deviation of residuals, while the degree of freedom indicates the differences between the observation in training samples and the number used in the model. Multiple R-squared is obtained by dividing the sum of squares. One can use R-squared to measure how close the data is to fit into the regression line. Mostly, the higher the R-squared, the better the model fits your data. However, it does not necessarily indicate whether the regression model is adequate. This means you might get a good model with a low R-squared or you can have a bad model with a high R-squared. Since multiple R-squared ignore a degree of freedom, the calculated score is biased. To make the calculation fair, an adjusted R-squared (0.6295) uses an unbiased estimate, and will be slightly less than multiple R-squared (0.6665). F-statistic is retrieved by performing an f-test on the model. A <code class="email">p</code> value equal to 0.00217 (&lt; 0.05) rejects the null hypothesis (no linear correlation between variables) and indicates that the observed <code class="email">F</code> is greater than the critical <code class="email">F</code> value. In other words, the result shows that there is a significant positive linear correlation between the variables.</p></div></div>

<div class="book" title="Summarizing linear model fits">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec132" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">For <a id="id365" class="calibre1"/>more information on the parameters used for obtaining a summary of the fitted model, you can use the <code class="email">help</code> function or <code class="email">?</code> to view the help <a id="id366" class="calibre1"/>page:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; ?summary.lm</strong></span>
</pre></div></li><li class="listitem">Alternatively, you can use the following functions to display the properties of the model:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt;  coefficients(lmfit) # Extract model coefficients</strong></span>
<span class="strong"><strong class="calibre2">&gt;  confint(lmfit, level=0.95)  # Computes confidence intervals for model parameters.</strong></span>
<span class="strong"><strong class="calibre2">&gt;  fitted(lmfit) # Extract model fitted values</strong></span>
<span class="strong"><strong class="calibre2">&gt;  residuals(lmfit) # Extract model residuals </strong></span>
<span class="strong"><strong class="calibre2">&gt;  anova(lmfit) # Compute analysis of variance tables for fitted model object</strong></span>
<span class="strong"><strong class="calibre2">&gt;  vcov(lmfit) # Calculate variance-covariance matrix for a fitted model object</strong></span>
<span class="strong"><strong class="calibre2">&gt;  influence(lmfit) # Diagnose quality of regression fits</strong></span>
</pre></div></li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Using linear regression to predict unknown values"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec43" class="calibre1"/>Using linear regression to predict unknown values</h1></div></div></div><p class="calibre7">With a <a id="id367" class="calibre1"/>fitted regression model, we can apply the model to predict unknown values. For regression models, we can express the precision of prediction with a prediction interval and a confidence interval. In the following recipe, we introduce how to predict unknown values under these two measurements.</p></div>

<div class="book" title="Using linear regression to predict unknown values">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec133" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">You need to have completed the previous recipe by computing the linear model of the x and y1 variables from the <code class="email">quartet</code> dataset.</p></div></div>

<div class="book" title="Using linear regression to predict unknown values">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec134" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to predict values with linear regression:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Fit a linear model with the <code class="email">x</code> and <code class="email">y1</code> variables:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lmfit = lm(y1~x, Quartet)</strong></span>
</pre></div></li><li class="listitem" value="2">Assign <a id="id368" class="calibre1"/>values to be predicted into <code class="email">newdata</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; newdata = data.frame(x = c(3,6,15))</strong></span>
</pre></div></li><li class="listitem" value="3">Compute the prediction result using the confidence interval with <code class="email">level</code> set as <code class="email">0.95</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; predict(lmfit, newdata, interval="confidence", level=0.95)</strong></span>
<span class="strong"><strong class="calibre2">        fit      lwr       upr</strong></span>
<span class="strong"><strong class="calibre2">1  4.500364 2.691375  6.309352</strong></span>
<span class="strong"><strong class="calibre2">2  6.000636 4.838027  7.163245</strong></span>
<span class="strong"><strong class="calibre2">3 10.501455 8.692466 12.310443</strong></span>
</pre></div></li><li class="listitem" value="4">Compute the prediction result using this prediction interval:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; predict(lmfit, newdata, interval="predict")</strong></span>
<span class="strong"><strong class="calibre2">        fit      lwr       upr</strong></span>
<span class="strong"><strong class="calibre2">1  4.500364 1.169022  7.831705</strong></span>
<span class="strong"><strong class="calibre2">2  6.000636 2.971271  9.030002</strong></span>
<span class="strong"><strong class="calibre2">3 10.501455 7.170113 13.832796</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Using linear regression to predict unknown values">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec135" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">We first build a linear fitted model with <code class="email">x</code> and <code class="email">y1</code> variables. Next, we assign values to be predicted into a data frame, <code class="email">newdata</code>. It is important to note that the generated model is in the form of <code class="email">y1 ~ x</code>.</p><p class="calibre7">Next, we compute the prediction result using a confidence interval by specifying <code class="email">confidence</code> in the argument interval. From the output of row 1, we get fitted <code class="email">y1</code> of the <code class="email">x=3</code> input, which equals to <code class="email">4.500364</code>, and a 95 percent confidence interval (set 0.95 in the <code class="email">level</code> argument) of the <code class="email">y1</code> mean for <code class="email">x=3</code> is between <code class="email">2.691375</code> and <code class="email">6.309352</code>. In addition to this, row 2 and 3 give the prediction result of <code class="email">y1</code> with an input of <code class="email">x=6</code> and <code class="email">x=15</code>.</p><p class="calibre7">Next, we compute the prediction result using a prediction interval by specifying <code class="email">prediction</code> in the argument interval. From the output of row 1, we can see fitted <code class="email">y1</code> of the <code class="email">x=3</code> input equals to <code class="email">4.500364</code>, and a 95 percent prediction interval of <code class="email">y1</code> for <code class="email">x=3</code> is between <code class="email">1.169022</code> and <code class="email">7.831705</code>. Row 2 and 3 output the prediction result of <code class="email">y1</code> with an input of <code class="email">x=6</code> and <code class="email">x=15</code>.</p></div></div>

<div class="book" title="Using linear regression to predict unknown values">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec136" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">For<a id="id369" class="calibre1"/> those <a id="id370" class="calibre1"/>who are interested in the differences between prediction intervals and confidence intervals, you can refer to the Wikipedia entry <span class="strong"><em class="calibre8">contrast with confidence intervals</em></span> at <a class="calibre1" href="http://en.wikipedia.org/wiki/Prediction_interval#Contrast_with_confidence_intervals">http://en.wikipedia.org/wiki/Prediction_interval#Contrast_with_confidence_intervals</a>.</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Generating a diagnostic plot of a fitted model"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec44" class="calibre1"/>Generating a diagnostic plot of a fitted model</h1></div></div></div><p class="calibre7">Diagnostics are methods to evaluate assumptions of the regression, which can be used to determine <a id="id371" class="calibre1"/>whether a fitted model adequately represents the data. In the following recipe, we introduce how to diagnose a regression model through the use of a diagnostic plot.</p></div>

<div class="book" title="Generating a diagnostic plot of a fitted model">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec137" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">You need to have completed the previous recipe by computing a linear model of the x and y1 variables from the quartet, and have the model assigned to the <code class="email">lmfit</code> variable.</p></div></div>

<div class="book" title="Generating a diagnostic plot of a fitted model">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec138" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following step to generate a diagnostic plot of the fitted model:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Plot the diagnostic plot of the regression model:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; par(mfrow=c(2,2))</strong></span>
<span class="strong"><strong class="calibre2">&gt; plot(lmfit)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00084.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Diagnostic plots of the regression model</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Generating a diagnostic plot of a fitted model">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec139" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">The plot function<a id="id372" class="calibre1"/> generates four diagnostic plots of a regression model:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The upper-left plot shows residuals versus fitted values. Within the plot, residuals represent the vertical distance from a point to the regression line. If all points fall exactly on the regression line, all residuals will fall exactly on the dotted gray line. The red line within the plot is a smooth curve with regard to residuals, and if all the dots fall exactly on the regression line, the position of the red line should exactly match the dotted gray line.</li><li class="listitem">The <a id="id373" class="calibre1"/>upper-right shows the normal of residuals. This plot verifies the assumption that residuals were normally distributed. Thus, if the residuals were normally distributed, they should lie exactly on the gray dash line.</li><li class="listitem">The <span class="strong"><strong class="calibre2">Scale-Location</strong></span> plot on the bottom-left is used to measure the square root of the<a id="id374" class="calibre1"/> standardized residuals against the fitted value. Therefore, if all dots lie on the regression line, the value of <span class="strong"><em class="calibre8">y</em></span> should be close to zero. Since it is assumed that the variance of residuals does not change the distribution substantially, if the assumption is correct, the red line should be relatively flat.</li><li class="listitem">The bottom-right plot shows standardized residuals versus leverage. The leverage is a measurement of how each data point influences the regression. It is a measurement of the distance from the centroid of regression and level of isolation (measured by whether it has neighbors). Also, you can find the contour of Cook's distance, which is affected by high leverage and large residuals. You can use this to measure how regression would change if a single point is deleted. The red line is smooth with regard to standardized residuals. For a perfect fit regression, the red line should be close to the dashed line with no points over 0.5 in Cook's distance.</li></ul></div></div></div>

<div class="book" title="Generating a diagnostic plot of a fitted model">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec140" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">To see more of the diagnostic plot function, you can use the <code class="email">help</code> function to access further information:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; ?plot.lm</strong></span>
</pre></div><p class="calibre7">In order to discover whether there are points with large Cook's distance, one can use the <code class="email">cooks.distance</code> function to compute the Cook's distance of each point, and analyze the distribution of distance through visualization:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(cooks.distance(lmfit))</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00085.jpeg" alt="There's more..." class="calibre9"/><div class="caption"><p class="calibre12">A plot of Cook's distance</p></div></div><p class="calibre10"> </p><p class="calibre7">In this <a id="id375" class="calibre1"/>case, where the point on index 3 shows greater Cook's distance than other points, one can investigate whether this point might be an outlier.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Fitting a polynomial regression model with lm"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec45" class="calibre1"/>Fitting a polynomial regression model with lm</h1></div></div></div><p class="calibre7">Some <a id="id376" class="calibre1"/>predictor variables and<a id="id377" class="calibre1"/> response variables may have a non-linear relationship, and their relationship can be modeled as an <span class="strong"><em class="calibre8">nth</em></span> order polynomial. In<a id="id378" class="calibre1"/> this recipe, we introduce how to deal with polynomial regression using the <code class="email">lm</code> and <code class="email">poly</code> functions.</p></div>

<div class="book" title="Fitting a polynomial regression model with lm">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec141" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">Prepare the dataset that includes a relationship between the predictor and response variable that can be modeled as an <span class="strong"><em class="calibre8">nth</em></span> order polynomial. In this recipe, we will continue to use the <code class="email">Quartet</code> dataset from the <code class="email">car</code> package.</p></div></div>

<div class="book" title="Fitting a polynomial regression model with lm">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec142" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to fit the polynomial regression model with <code class="email">lm</code>:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, we make a scatter plot of the <code class="email">x</code> and <code class="email">y2</code> variables:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(Quartet$x, Quartet$y2)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00086.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Scatter plot of variables x and y2</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="2">You<a id="id379" class="calibre1"/> can apply the <code class="email">poly</code> function<a id="id380" class="calibre1"/> by specifying <code class="email">2</code> in the argument:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lmfit = lm(Quartet$y2~poly(Quartet$x,2))</strong></span>
<span class="strong"><strong class="calibre2">&gt; lines(sort(Quartet$x), lmfit$fit[order(Quartet$x)], col = "red")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00087.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">A quardratic fit example of the regression plot of variables x and y2</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Fitting a polynomial regression model with lm">
<div class="book" title="How it works"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec143" class="calibre1"/>How it works</h2></div></div></div><p class="calibre7">We <a id="id381" class="calibre1"/>can illustrate the second <a id="id382" class="calibre1"/>order polynomial regression model in formula, <span class="strong"><img src="../images/00088.jpeg" alt="How it works" class="calibre24"/></span>, where <span class="strong"><em class="calibre8">α</em></span> is the intercept while <span class="strong"><em class="calibre8">β</em></span>, illustrates regression coefficients.</p><p class="calibre7">In the preceding screenshot (step 1), the scatter plot of the <code class="email">x</code> and <code class="email">y2</code> variables does not fit in a linear relationship, but shows a concave downward curve (or convex upward) with the turning point at x=11. In order to model the nonlinear relationship, we apply the <code class="email">poly</code> function with an argument of 2 to fit the independent <code class="email">x</code> variable and the dependent <code class="email">y2</code> variable. The red line in the screenshot shows that the model perfectly fits the data.</p></div></div>

<div class="book" title="Fitting a polynomial regression model with lm">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec144" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">You can also fit a second order polynomial model with an independent variable equal to the formula of the combined first order <code class="email">x</code> variable and the second order <code class="email">x</code> variable:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(Quartet$x, Quartet$y2)</strong></span>
<span class="strong"><strong class="calibre2">&gt; lmfit = lm(Quartet$y2~ I(Quartet$x)+I(Quartet$x^2))</strong></span>
</pre></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Fitting a robust linear regression model with rlm"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec46" class="calibre1"/>Fitting a robust linear regression model with rlm</h1></div></div></div><p class="calibre7">An <a id="id383" class="calibre1"/>outlier in the dataset <a id="id384" class="calibre1"/>will move the regression line away from the mainstream. Apart from removing it, we can apply a robust linear regression to fit datasets containing outliers. In this recipe, we introduce how to apply <code class="email">rlm</code> to perform robust linear regression to datasets containing outliers.</p></div>

<div class="book" title="Fitting a robust linear regression model with rlm">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec145" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">Prepare the dataset that contains an outlier that may move the regression line away from the mainstream. Here, we use the <code class="email">Quartet</code> dataset loaded from the previous recipe.</p></div></div>

<div class="book" title="Fitting a robust linear regression model with rlm">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec146" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to fit the robust linear regression model with <code class="email">rlm</code>:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Generate a scatter plot of the <code class="email">x</code> variable against <code class="email">y3</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(Quartet$x, Quartet$y3)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00089.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Scatter plot of variables x and y3</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="2">Next, you should import the <code class="email">MASS</code> library first. Then, you can apply the <code class="email">rlm</code> function to fit the model, and visualize the fitted line with the <code class="email">abline</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; library(MASS)</strong></span>
<span class="strong"><strong class="calibre2">&gt; lmfit = rlm(Quartet$y3~Quartet$x)</strong></span>
<span class="strong"><strong class="calibre2">&gt; abline(lmfit, col="red")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00090.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Robust linear regression to variables x and y3</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Fitting a robust linear regression model with rlm">
<div class="book" title="How it works"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec147" class="calibre1"/>How it works</h2></div></div></div><p class="calibre7">As<a id="id385" class="calibre1"/> per the preceding screenshot (step 1), you may encounter datasets that include outliers away from the mainstream. To remove the effect of an outlier, we demonstrate how to apply a robust linear<a id="id386" class="calibre1"/> regression (<code class="email">rlm</code>) to fit the data. In the second screenshot (step 2), the robust regression line ignores the outlier and matches the mainstream.</p></div></div>

<div class="book" title="Fitting a robust linear regression model with rlm">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec148" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">To see the effect of how an outlier can move the regression line away from the mainstream, you may replace the <code class="email">rlm</code> function used in this recipe to <code class="email">lm</code>, and replot the graph:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(Quartet$x, Quartet$y3)</strong></span>
<span class="strong"><strong class="calibre2">&gt; lmfit = lm(Quartet$y3~Quartet$x)</strong></span>
<span class="strong"><strong class="calibre2">&gt; abline(lmfit, col="red")</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00091.jpeg" alt="There's more..." class="calibre9"/><div class="caption"><p class="calibre12">Linear regression on variables x and y3</p></div></div><p class="calibre10"> </p><p class="calibre7">It is <a id="id387" class="calibre1"/>obvious that outlier (x=13) moves <a id="id388" class="calibre1"/>the regression line away from the mainstream.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Studying a case of linear regression on SLID data"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec47" class="calibre1"/>Studying a case of linear regression on SLID data</h1></div></div></div><p class="calibre7">To<a id="id389" class="calibre1"/> summarize the contents of the previous section, we <a id="id390" class="calibre1"/>explore more complex data with linear regression. In this recipe, we demonstrate how to apply linear regression to analyze the <span class="strong"><strong class="calibre2">Survey of Labor and Income Dynamics</strong></span> (<span class="strong"><strong class="calibre2">SLID</strong></span>) dataset.</p></div>

<div class="book" title="Studying a case of linear regression on SLID data">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec149" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">Check whether the <code class="email">car</code> library is installed and loaded, as it is required to access thedataset SLID.</p></div></div>

<div class="book" title="Studying a case of linear regression on SLID data">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec150" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Follow these steps to perform linear regression on SLID data:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">You can use the <code class="email">str</code> function to get an overview of the data:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; str(SLID)</strong></span>
<span class="strong"><strong class="calibre2">'data.frame':  7425 obs. of  5 variables:</strong></span>
<span class="strong"><strong class="calibre2"> $ wages    : num  10.6 11 NA 17.8 NA ...</strong></span>
<span class="strong"><strong class="calibre2"> $ education: num  15 13.2 16 14 8 16 12 14.5 15 10 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ age      : int  40 19 49 46 71 50 70 42 31 56 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ sex      : Factor w/ 2 levels "Female","Male": 2 2 2 2 2 1 1 1 2 1 ...</strong></span>
<span class="strong"><strong class="calibre2"> $ language : Factor w/ 3 levels "English","French",..: 1 1 3 3 1 1 1 1 1 1 ..</strong></span>
</pre></div></li><li class="listitem" value="2">First, we<a id="id391" class="calibre1"/> visualize the variable wages against language, age, education, and sex:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; par(mfrow=c(2,2))</strong></span>
<span class="strong"><strong class="calibre2">&gt; plot(SLID$wages ~ SLID$language)</strong></span>
<span class="strong"><strong class="calibre2">&gt; plot(SLID$wages ~ SLID$age)</strong></span>
<span class="strong"><strong class="calibre2">&gt; plot(SLID$wages ~ SLID$education)</strong></span>
<span class="strong"><strong class="calibre2">&gt; plot(SLID$wages ~ SLID$sex)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00092.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Plot of wages against multiple combinations</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="3">Then, we can use <code class="email">lm</code> to fit the model:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lmfit = lm(wages ~ ., data = SLID)</strong></span>
</pre></div></li><li class="listitem" value="4">You can examine the summary of the fitted model through the <code class="email">summary</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; summary(lmfit)</strong></span>

<span class="strong"><strong class="calibre2">Call:</strong></span>
<span class="strong"><strong class="calibre2">lm(formula = wages ~ ., data = SLID)</strong></span>

<span class="strong"><strong class="calibre2">Residuals:</strong></span>
<span class="strong"><strong class="calibre2">    Min      1Q  Median      3Q     Max </strong></span>
<span class="strong"><strong class="calibre2">-26.062  -4.347  -0.797   3.237  35.908 </strong></span>

<span class="strong"><strong class="calibre2">Coefficients:</strong></span>
<span class="strong"><strong class="calibre2">                Estimate Std. Error t value Pr(&gt;|t|)    </strong></span>
<span class="strong"><strong class="calibre2">(Intercept)    -7.888779   0.612263 -12.885   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">education       0.916614   0.034762  26.368   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">age             0.255137   0.008714  29.278   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">sexMale         3.455411   0.209195  16.518   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">languageFrench -0.015223   0.426732  -0.036    0.972    </strong></span>
<span class="strong"><strong class="calibre2">languageOther   0.142605   0.325058   0.439    0.661    </strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">Residual standard error: 6.6 on 3981 degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">  (3438 observations deleted due to missingness)</strong></span>
<span class="strong"><strong class="calibre2">Multiple R-squared:  0.2973,	Adjusted R-squared:  0.2964 </strong></span>
<span class="strong"><strong class="calibre2">F-statistic: 336.8 on 5 and 3981 DF,  p-value: &lt; 2.2e-16</strong></span>
</pre></div></li><li class="listitem" value="5">Drop <a id="id392" class="calibre1"/>the <code class="email">language</code> attribute, and refit the model with the <code class="email">lm</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lmfit = lm(wages ~ age + sex + education, data = SLID)</strong></span>
<span class="strong"><strong class="calibre2">&gt; summary(lmfit)</strong></span>

<span class="strong"><strong class="calibre2">Call:</strong></span>
<span class="strong"><strong class="calibre2">lm(formula = wages ~ age + sex + education, data = SLID)</strong></span>

<span class="strong"><strong class="calibre2">Residuals:</strong></span>
<span class="strong"><strong class="calibre2">    Min      1Q  Median      3Q     Max </strong></span>
<span class="strong"><strong class="calibre2">-26.111  -4.328  -0.792   3.243  35.892 </strong></span>

<span class="strong"><strong class="calibre2">Coefficients:</strong></span>
<span class="strong"><strong class="calibre2">             Estimate Std. Error t value Pr(&gt;|t|)    </strong></span>
<span class="strong"><strong class="calibre2">(Intercept) -7.905243   0.607771  -13.01   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">age          0.255101   0.008634   29.55   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">sexMale      3.465251   0.208494   16.62   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">education    0.918735   0.034514   26.62   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">Residual standard error: 6.602 on 4010 degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">  (3411 observations deleted due to missingness)</strong></span>
<span class="strong"><strong class="calibre2">Multiple R-squared:  0.2972,	Adjusted R-squared:  0.2967 </strong></span>
<span class="strong"><strong class="calibre2">F-statistic: 565.3 on 3 and 4010 DF,  p-value: &lt; 2.2e-16</strong></span>
</pre></div></li><li class="listitem" value="6">We <a id="id393" class="calibre1"/>can then draw a diagnostic plot of <code class="email">lmfit</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; par(mfrow=c(2,2))</strong></span>
<span class="strong"><strong class="calibre2">&gt; plot(lmfit)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00093.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Diagnostic plot of fitted model</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="7">Next, we<a id="id394" class="calibre1"/> take the log of wages and replot the diagnostic plot:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lmfit = lm(log(wages) ~ age + sex + education, data = SLID)</strong></span>
<span class="strong"><strong class="calibre2">&gt; plot(lmfit)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00094.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Diagnostic plot of adjusted fitted model</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="8">Next, you can diagnose the multi-colinearity of the regression model using the <code class="email">vif</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; vif(lmfit)</strong></span>
<span class="strong"><strong class="calibre2">      age       sex education </strong></span>
<span class="strong"><strong class="calibre2"> 1.011613  1.000834  1.012179 </strong></span>
<span class="strong"><strong class="calibre2">&gt; sqrt(vif(lmfit)) &gt; 2</strong></span>
<span class="strong"><strong class="calibre2">      age       sex education </strong></span>
<span class="strong"><strong class="calibre2">    FALSE     FALSE     FALSE</strong></span>
</pre></div></li><li class="listitem" value="9">Then, you<a id="id395" class="calibre1"/> can install and load the <code class="email">lmtest</code> package and diagnose the heteroscedasticity of the regression model with the <code class="email">bptest</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages("lmtest")</strong></span>
<span class="strong"><strong class="calibre2">&gt; library(lmtest)</strong></span>
<span class="strong"><strong class="calibre2">&gt; bptest(lmfit)</strong></span>

<span class="strong"><strong class="calibre2">  studentized Breusch-Pagan test</strong></span>

<span class="strong"><strong class="calibre2">data:  lmfit</strong></span>
<span class="strong"><strong class="calibre2">BP = 29.0311, df = 3, p-value = 2.206e-06</strong></span>
</pre></div></li><li class="listitem" value="10">Finally, you can install and load the <code class="email">rms</code> package. Then, you can correct standard errors with <code class="email">robcov</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages("rms")</strong></span>
<span class="strong"><strong class="calibre2">&gt; library(rms)</strong></span>
<span class="strong"><strong class="calibre2">&gt; olsfit = ols(log(wages) ~ age + sex + education, data= SLID, x= TRUE, y= TRUE)</strong></span>
<span class="strong"><strong class="calibre2">&gt; robcov(olsfit)</strong></span>

<span class="strong"><strong class="calibre2">Linear Regression Model</strong></span>

<span class="strong"><strong class="calibre2">ols(formula = log(wages) ~ age + sex + education, data = SLID, </strong></span>
<span class="strong"><strong class="calibre2">    x = TRUE, y = TRUE)</strong></span>

<span class="strong"><strong class="calibre2">Frequencies of Missing Values Due to Each Variable</strong></span>
<span class="strong"><strong class="calibre2">log(wages)        age        sex  education </strong></span>
<span class="strong"><strong class="calibre2">      3278          0          0        249 </strong></span>


<span class="strong"><strong class="calibre2">                Model Likelihood     Discrimination    </strong></span>
<span class="strong"><strong class="calibre2">                   Ratio Test           Indexes        </strong></span>
<span class="strong"><strong class="calibre2">Obs     4014    LR chi2   1486.08    R2       0.309    </strong></span>
<span class="strong"><strong class="calibre2">sigma 0.4187    d.f.            3    R2 adj   0.309    </strong></span>
<span class="strong"><strong class="calibre2">d.f.    4010    Pr(&gt; chi2) 0.0000    g        0.315    </strong></span>

<span class="strong"><strong class="calibre2">Residuals</strong></span>

<span class="strong"><strong class="calibre2">     Min       1Q   Median       3Q      Max </strong></span>
<span class="strong"><strong class="calibre2">-2.36252 -0.27716  0.01428  0.28625  1.56588 </strong></span>

<span class="strong"><strong class="calibre2">          Coef   S.E.   t     Pr(&gt;|t|)</strong></span>
<span class="strong"><strong class="calibre2">Intercept 1.1169 0.0387 28.90 &lt;0.0001 </strong></span>
<span class="strong"><strong class="calibre2">age       0.0176 0.0006 30.15 &lt;0.0001 </strong></span>
<span class="strong"><strong class="calibre2">sex=Male  0.2244 0.0132 16.96 &lt;0.0001 </strong></span>
<span class="strong"><strong class="calibre2">education 0.0552 0.0022 24.82 &lt;0.0001</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Studying a case of linear regression on SLID data">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec151" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">This<a id="id396" class="calibre1"/> recipe demonstrates how to conduct linear regression analysis on the SLID dataset. First, we load the SLID data and display its structure through the use of the <code class="email">str</code> function. From the structure of the data, we know that there are four independent variables that will affect the wages of the dependent variable.</p><p class="calibre7">Next, we explore the relationship of each independent variable to the dependent variable, <code class="email">wages</code>, through visualization; the visualization result is shown in the preceding screenshot (step 2). In the upper-left section of this screenshot, you can find the box plot of three different languages against wages; the correlation between the languages and wages is not obvious. The upper-right section of the screenshot shows that the age appears to have a positive relationship with the dependent variable, <code class="email">wages</code>. In the bottom-left of the screenshot, it is shown that education also appears to have a positive relationship with wages. Finally, the box plot in the bottom-right section of the screenshot shows that the wages of males are slightly higher than females.</p><p class="calibre7">Next, we fit all the attributes except for <code class="email">wages</code> to the model as predictor variables. By summarizing the model, it is shown that education, age, and sex show a significance (<span class="strong"><em class="calibre8">p-value &lt; 0.05</em></span>). As a result, we drop the insignificant <code class="email">language</code> attribute (which has a p-value greater than 0.05) and fit the three independent variables (education, sex, and age) with regard to the dependent variable (<code class="email">wages</code>) in the linear model. This accordingly raises the f-statistic from 336.8 to 565.3.</p><p class="calibre7">Next, we generate the diagnostic plot of the fitted model. Within the diagnostic plot, all the four plots indicate that the regression model follows the regression assumption. However, from residuals versus fitted and scale-location plot, residuals of smaller fitted values are biased toward the regression model. Since wages range over several orders of magnitude, to induce the symmetry, we apply a log transformation to wages and refit the data into a regression model. The red line of residuals versus fitted values plot and the Scale-Location plot are now closer to the gray dashed line.</p><p class="calibre7">Next, we <a id="id397" class="calibre1"/>would like to test whether multi-colinearity exists in the model. Multi-colinearity takes place when a predictor is highly correlated with others. If multi-colinearity exists in the model, you might see some variables have a high R-squared value but are shown as variables insignificant. To detect multi-colinearity, we can calculate the variance inflation and generalized variance inflation factors for linear and generalized linear models with the <code class="email">vif</code> function. If multi-colinearity exists, we should find predictors with the square root of variance inflation factor above 2. Then, we may remove redundant predictors or use a principal component analysis to transform predictors to a smaller set of uncorrelated components.</p><p class="calibre7">Finally, we would like to<a id="id398" class="calibre1"/> test whether <span class="strong"><strong class="calibre2">heteroscedasticity</strong></span> exists in the model. Before discussing the definition of heteroscedasticity, we first have to know that in classic assumptions, the ordinary regression model assumes that the variance of the error is constant or homogeneous across observations. On the contrary, heteroscedasticity means that the variance is unequal across observations. As a result, heteroscedasticity may be biased toward the standard errors of our estimates and, therefore, mislead the testing of the hypothes. To detect and test heteroscedasticity, we <a id="id399" class="calibre1"/>can perform the <span class="strong"><strong class="calibre2">Breusch-Pagan</strong></span> test for heteroscedasticity with the <code class="email">bptest</code> function within the <code class="email">lmtest</code> package. In this case, the p-value shows 2.206e-06 (&lt;0.5), which rejects the null hypothesis of homoscedasticity (no heteroscedasticity). Here, it implies that the standard errors of the parameter estimates are incorrect. However, we can use robust standard errors to correct the standard error (do not remove the heteroscedasticity) and increase the significance of truly significant parameters with <code class="email">robcov</code> from the <code class="email">rms</code> package. However, since it only takes the fitted model from the <code class="email">rms</code> series as an input, we have to fit the ordinary least squares model beforehand.</p></div></div>

<div class="book" title="Studying a case of linear regression on SLID data">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec152" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">For more information about the SLID dataset, you can use the <code class="email">help</code> function to view the related documentation:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt;  ?SLID</strong></span>
</pre></div></li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Applying the Gaussian model for generalized linear regression"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec48" class="calibre1"/>Applying the Gaussian model for generalized linear regression</h1></div></div></div><p class="calibre7">
<span class="strong"><strong class="calibre2">Generalized linear model</strong></span> (<span class="strong"><strong class="calibre2">GLM</strong></span>) is <a id="id400" class="calibre1"/>a generalization of linear regression, which can include a link function to<a id="id401" class="calibre1"/> make a linear prediction. As a default setting, the family object for <code class="email">glm</code> is Gaussian, which makes the <code class="email">glm</code> function perform exactly the<a id="id402" class="calibre1"/> same as <code class="email">lm</code>. In this recipe, we first demonstrate how to fit the model into the data using the <code class="email">glm</code> function, and then show that <code class="email">glm</code> with a Gaussian model performs exactly the same as <code class="email">lm</code>.</p></div>

<div class="book" title="Applying the Gaussian model for generalized linear regression">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec153" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">Check <a id="id403" class="calibre1"/>whether the <code class="email">car</code> library is installed and loaded as we require the SLID dataset from this package.</p></div></div>

<div class="book" title="Applying the Gaussian model for generalized linear regression">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec154" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to fit a generalized linear regression model with the Gaussian model:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Fit the independent variables, <code class="email">age</code>, <code class="email">sex</code>, and <code class="email">education</code>, and dependent variable wages to <code class="email">glm</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lmfit1 = glm(wages ~ age + sex + education, data = SLID, family=gaussian)</strong></span>
<span class="strong"><strong class="calibre2">&gt; summary(lmfit1)</strong></span>

<span class="strong"><strong class="calibre2">Call:</strong></span>
<span class="strong"><strong class="calibre2">glm(formula = wages ~ age + sex + education, family = gaussian, </strong></span>
<span class="strong"><strong class="calibre2">    data = SLID)</strong></span>

<span class="strong"><strong class="calibre2">Deviance Residuals: </strong></span>
<span class="strong"><strong class="calibre2">    Min       1Q   Median       3Q      Max  </strong></span>
<span class="strong"><strong class="calibre2">-26.111   -4.328   -0.792    3.243   35.892  </strong></span>

<span class="strong"><strong class="calibre2">Coefficients:</strong></span>
<span class="strong"><strong class="calibre2">             Estimate Std. Error t value Pr(&gt;|t|)    </strong></span>
<span class="strong"><strong class="calibre2">(Intercept) -7.905243   0.607771  -13.01   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">age          0.255101   0.008634   29.55   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">sexMale      3.465251   0.208494   16.62   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">education    0.918735   0.034514   26.62   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">(Dispersion parameter for Gaussian family taken to be 43.58492)</strong></span>

<span class="strong"><strong class="calibre2">    Null deviance: 248686  on 4013  degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">Residual deviance: 174776  on 4010  degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">  (3411 observations deleted due to missingness)</strong></span>
<span class="strong"><strong class="calibre2">AIC: 26549</strong></span>

<span class="strong"><strong class="calibre2">Number of Fisher Scoring iterations: 2</strong></span>
</pre></div></li><li class="listitem" value="2">Fit the<a id="id404" class="calibre1"/> independent variables, <code class="email">age</code>, <code class="email">sex</code>, and <code class="email">education</code>, and the dependent variable wages to <code class="email">lm</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lmfit2 = lm(wages ~ age + sex + education, data = SLID)</strong></span>
<span class="strong"><strong class="calibre2">&gt; summary(lmfit2)</strong></span>

<span class="strong"><strong class="calibre2">Call:</strong></span>
<span class="strong"><strong class="calibre2">lm(formula = wages ~ age + sex + education, data = SLID)</strong></span>

<span class="strong"><strong class="calibre2">Residuals:</strong></span>
<span class="strong"><strong class="calibre2">    Min      1Q  Median      3Q     Max </strong></span>
<span class="strong"><strong class="calibre2">-26.111  -4.328  -0.792   3.243  35.892 </strong></span>

<span class="strong"><strong class="calibre2">Coefficients:</strong></span>
<span class="strong"><strong class="calibre2">             Estimate Std. Error t value Pr(&gt;|t|)    </strong></span>
<span class="strong"><strong class="calibre2">(Intercept) -7.905243   0.607771  -13.01   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">age          0.255101   0.008634   29.55   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">sexMale      3.465251   0.208494   16.62   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">education    0.918735   0.034514   26.62   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">Residual standard error: 6.602 on 4010 degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">  (3411 observations deleted due to missingness)</strong></span>
<span class="strong"><strong class="calibre2">Multiple R-squared:  0.2972,	Adjusted R-squared:  0.2967 </strong></span>
<span class="strong"><strong class="calibre2">F-statistic: 565.3 on 3 and 4010 DF,  p-value: &lt; 2.2e-16</strong></span>
</pre></div></li><li class="listitem" value="3">Use <code class="email">anova</code> to compare the two fitted models:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; anova(lmfit1, lmfit2)</strong></span>
<span class="strong"><strong class="calibre2">Analysis of Deviance Table</strong></span>

<span class="strong"><strong class="calibre2">Model: gaussian, link: identity</strong></span>

<span class="strong"><strong class="calibre2">Response: wages</strong></span>

<span class="strong"><strong class="calibre2">Terms added sequentially (first to last)</strong></span>


<span class="strong"><strong class="calibre2">          Df Deviance Resid. Df Resid. Dev</strong></span>
<span class="strong"><strong class="calibre2">NULL                       4013     248686</strong></span>
<span class="strong"><strong class="calibre2">age        1    31953      4012     216733</strong></span>
<span class="strong"><strong class="calibre2">sex        1    11074      4011     205659</strong></span>
<span class="strong"><strong class="calibre2">education  1    30883      4010     174776</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Applying the Gaussian model for generalized linear regression">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec155" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">The <code class="email">glm</code> function fits a model to the data in a similar fashion to the <code class="email">lm</code> function. The only difference is<a id="id405" class="calibre1"/> that you can specify a different link function in the parameter, <code class="email">family</code> (you may use <code class="email">?family</code> in the console to find different types of link functions). In this recipe, we first input the independent variables, <code class="email">age</code>, <code class="email">sex</code>, and <code class="email">education</code>, and the dependent <code class="email">wages</code> variable to the <code class="email">glm</code> function, and assign the built model to <code class="email">lmfit1</code>. You can use the built model for further prediction.</p><p class="calibre7">Next, to determine whether <code class="email">glm</code> with a Gaussian model is exactly the same as <code class="email">lm</code>, we fit the independent variables, <code class="email">age</code>, <code class="email">sex</code>, and <code class="email">education</code>, and the dependent variable, <code class="email">wages</code>, to the <code class="email">lm</code> model. By applying the <code class="email">summary</code> function to the two different models, it reveals that the residuals and coefficients of the two output summaries are exactly the same.</p><p class="calibre7">Finally, we <a id="id406" class="calibre1"/>further compare the two fitted models with the <code class="email">anova</code> function. The result of the <code class="email">anova</code> function shows that the two <a id="id407" class="calibre1"/>models are similar, with the same <span class="strong"><strong class="calibre2">residual degrees of freedom</strong></span> (<span class="strong"><strong class="calibre2">Res.DF</strong></span>) and <span class="strong"><strong class="calibre2">residual sum of squares</strong></span> (<span class="strong"><strong class="calibre2">RSS Df</strong></span>).</p></div></div>

<div class="book" title="Applying the Gaussian model for generalized linear regression">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec156" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">For a comparison of generalized linear models with linear models, you can refer to <span class="strong"><em class="calibre8">Venables, W. N., &amp; Ripley, B. D. (2002). Modern applied statistics with S. Springer</em></span>.</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Applying the Poisson model for generalized linear regression"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec49" class="calibre1"/>Applying the Poisson model for generalized linear regression</h1></div></div></div><p class="calibre7">Generalized linear models allow response variables that have error distribution models other than a <a id="id408" class="calibre1"/>normal distribution (Gaussian). In this recipe, we <a id="id409" class="calibre1"/>demonstrate how to apply Poisson as a family object within <code class="email">glm</code> with regard to count data.</p></div>

<div class="book" title="Applying the Poisson model for generalized linear regression">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec157" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">The prerequisite of this task is to prepare the count data, with all the input data values as integers.</p></div></div>

<div class="book" title="Applying the Poisson model for generalized linear regression">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec158" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to fit the generalized linear regression model with the Poisson model:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Load the <code class="email">warpbreaks</code> data, and use <code class="email">head</code> to view the first few lines:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; data(warpbreaks)</strong></span>
<span class="strong"><strong class="calibre2">&gt; head(warpbreaks)</strong></span>
<span class="strong"><strong class="calibre2">  breaks wool tension</strong></span>
<span class="strong"><strong class="calibre2">1     26    A       L</strong></span>
<span class="strong"><strong class="calibre2">2     30    A       L</strong></span>
<span class="strong"><strong class="calibre2">3     54    A       L</strong></span>
<span class="strong"><strong class="calibre2">4     25    A       L</strong></span>
<span class="strong"><strong class="calibre2">5     70    A       L</strong></span>
<span class="strong"><strong class="calibre2">6     52    A       L</strong></span>
</pre></div></li><li class="listitem" value="2">We apply Poisson as a family object for the independent variable, <code class="email">tension</code>, and the dependent variable, <code class="email">breaks</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; rs1 = glm(breaks ~ tension, data=warpbreaks, family="poisson")</strong></span>
<span class="strong"><strong class="calibre2">&gt; summary(rs1)</strong></span>

<span class="strong"><strong class="calibre2">Call:</strong></span>
<span class="strong"><strong class="calibre2">glm(formula = breaks ~ tension, family = "poisson", data = warpbreaks)</strong></span>

<span class="strong"><strong class="calibre2">Deviance Residuals: </strong></span>
<span class="strong"><strong class="calibre2">    Min       1Q   Median       3Q      Max  </strong></span>
<span class="strong"><strong class="calibre2">-4.2464  -1.6031  -0.5872   1.2813   4.9366  </strong></span>

<span class="strong"><strong class="calibre2">Coefficients:</strong></span>
<span class="strong"><strong class="calibre2">            Estimate Std. Error z value Pr(&gt;|z|)    </strong></span>
<span class="strong"><strong class="calibre2">(Intercept)  3.59426    0.03907  91.988  &lt; 2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">tensionM    -0.32132    0.06027  -5.332 9.73e-08 ***</strong></span>
<span class="strong"><strong class="calibre2">tensionH    -0.51849    0.06396  -8.107 5.21e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">(Dispersion parameter for Poisson family taken to be 1)</strong></span>

<span class="strong"><strong class="calibre2">    Null deviance: 297.37  on 53  degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">Residual deviance: 226.43  on 51  degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">AIC: 507.09</strong></span>

<span class="strong"><strong class="calibre2">Number of Fisher Scoring iterations: 4</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Applying the Poisson model for generalized linear regression">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec159" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">Under the <a id="id410" class="calibre1"/>assumption of a Poisson distribution, the count <a id="id411" class="calibre1"/>data can be fitted to a log-linear model. In this recipe, we first loaded a sample count data from the <code class="email">warpbreaks</code> dataset, which contained data regarding the number of warp breaks per loom. Next, we applied the <code class="email">glm</code> function with breaks as a dependent variable, <code class="email">tension</code> as an independent variable, and Poisson as a family object. Finally, we viewed the fitted log-linear model with the summary function.</p></div></div>

<div class="book" title="Applying the Poisson model for generalized linear regression">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec160" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">To understand more on how a Poisson model is related to count data, you can refer to <span class="strong"><em class="calibre8">Cameron, A. C., &amp; Trivedi, P. K. (2013). Regression analysis of count data (No. 53). Cambridge university press.</em></span></li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Applying the Binomial model for generalized linear regression"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec50" class="calibre1"/>Applying the Binomial model for generalized linear regression</h1></div></div></div><p class="calibre7">For a binary <a id="id412" class="calibre1"/>dependent variable, one may apply a<a id="id413" class="calibre1"/> binomial model as the family object in the <code class="email">glm</code> function.</p></div>

<div class="book" title="Applying the Binomial model for generalized linear regression">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec161" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">The prerequisite of this task is to prepare a binary dependent variable. Here, we use the <code class="email">vs</code> variable (V engine or straight engine) as the dependent variable.</p></div></div>

<div class="book" title="Applying the Binomial model for generalized linear regression">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec162" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to fit a generalized linear regression model with the Binomial model:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, we examine the first six elements of <code class="email">vs</code> within <code class="email">mtcars</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; head(mtcars$vs)</strong></span>
<span class="strong"><strong class="calibre2">[1] 0 0 1 1 0 1</strong></span>
</pre></div></li><li class="listitem" value="2">We apply the <code class="email">glm</code> function with <code class="email">binomial</code> as the family object:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lm1 = glm(vs ~ hp+mpg+gear,data=mtcars, family=binomial)</strong></span>
<span class="strong"><strong class="calibre2">&gt; summary(lm1)</strong></span>

<span class="strong"><strong class="calibre2">Call:</strong></span>
<span class="strong"><strong class="calibre2">glm(formula = vs ~ hp + mpg + gear, family = binomial, data = mtcars)</strong></span>

<span class="strong"><strong class="calibre2">Deviance Residuals: </strong></span>
<span class="strong"><strong class="calibre2">     Min        1Q    Median        3Q       Max  </strong></span>
<span class="strong"><strong class="calibre2">-1.68166  -0.23743  -0.00945   0.30884   1.55688  </strong></span>

<span class="strong"><strong class="calibre2">Coefficients:</strong></span>
<span class="strong"><strong class="calibre2">            Estimate Std. Error z value Pr(&gt;|z|)  </strong></span>
<span class="strong"><strong class="calibre2">(Intercept) 11.95183    8.00322   1.493   0.1353  </strong></span>
<span class="strong"><strong class="calibre2">hp          -0.07322    0.03440  -2.129   0.0333 *</strong></span>
<span class="strong"><strong class="calibre2">mpg          0.16051    0.27538   0.583   0.5600  </strong></span>
<span class="strong"><strong class="calibre2">gear        -1.66526    1.76407  -0.944   0.3452  </strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">(Dispersion parameter for binomial family taken to be 1)</strong></span>

<span class="strong"><strong class="calibre2">    Null deviance: 43.860  on 31  degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">Residual deviance: 15.651  on 28  degrees of freedom</strong></span>
<span class="strong"><strong class="calibre2">AIC: 23.651</strong></span>

<span class="strong"><strong class="calibre2">Number of Fisher Scoring iterations: 7</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Applying the Binomial model for generalized linear regression">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec163" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">Within <a id="id414" class="calibre1"/>the binary data, each observation of the<a id="id415" class="calibre1"/> response value is coded as either <code class="email">0</code> or <code class="email">1</code>. Fitting into the regression model of the binary data requires a binomial distribution function. In this example, we first load the binary dependent variable, <code class="email">vs</code>, from the <code class="email">mtcars</code> dataset. The <code class="email">vs</code> is suitable for the binomial model as it contains binary data. Next, we fit the model into the binary data using the <code class="email">glm</code> function by specifying <code class="email">binomial</code> as the family object. Last, by referring to the summary, we can obtain the description of the fitted model.</p></div></div>

<div class="book" title="Applying the Binomial model for generalized linear regression">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec164" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">If you specify the family object in parameters only, you will use the default link to fit the model. However, to use an alternative link function, you can add a link argument. For example:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; lm1 = glm(vs ~ hp+mpg+gear,data=mtcars, family=binomial(link="probit"))</strong></span>
</pre></div></li><li class="listitem">If you would like to know how many alternative links you can use, please refer to the family document via the help function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2"> &gt; ?family</strong></span>
</pre></div></li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Fitting a generalized additive model to data"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec51" class="calibre1"/>Fitting a generalized additive model to data</h1></div></div></div><p class="calibre7">
<span class="strong"><strong class="calibre2">Generalized additive model</strong></span> (<span class="strong"><strong class="calibre2">GAM</strong></span>), which is used to fit generalized additive models, can be <a id="id416" class="calibre1"/>viewed as a semiparametric extension of GLM. While GLM holds the assumption that there is a linear <a id="id417" class="calibre1"/>relationship between dependent and independent variables, GAM fits the model on account of the local behavior of data. As a result, GAM has the ability to deal with highly nonlinear relationships between dependent and independent variables. In the following recipe, we introduce how to fit regression using a generalized additive model.</p></div>

<div class="book" title="Fitting a generalized additive model to data">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec165" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">We<a id="id418" class="calibre1"/> need to prepare a data frame containing variables, where one of the variables is a response variable and the others may be predictor variables.</p></div></div>

<div class="book" title="Fitting a generalized additive model to data">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec166" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to fit a generalized additive model into data:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First, load the <code class="email">mgcv</code> package, which contains the <code class="email">gam</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages("mgcv")</strong></span>
<span class="strong"><strong class="calibre2">&gt; library(mgcv)</strong></span>
</pre></div></li><li class="listitem" value="2">Then, install the <code class="email">MASS</code> package and load the <code class="email">Boston</code> dataset:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; install.packages("MASS")</strong></span>
<span class="strong"><strong class="calibre2">&gt; library(MASS)</strong></span>
<span class="strong"><strong class="calibre2">&gt; attach(Boston)</strong></span>
<span class="strong"><strong class="calibre2">&gt; str(Boston)</strong></span>
</pre></div></li><li class="listitem" value="3">Fit the regression using <code class="email">gam</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; fit = gam(dis ~ s(nox))</strong></span>
</pre></div></li><li class="listitem" value="4">Get the summary information of the fitted model:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; summary(fit)</strong></span>
<span class="strong"><strong class="calibre2">Family: gaussian </strong></span>
<span class="strong"><strong class="calibre2">Link function: identity </strong></span>

<span class="strong"><strong class="calibre2">Formula:</strong></span>
<span class="strong"><strong class="calibre2">dis ~ s(nox)</strong></span>

<span class="strong"><strong class="calibre2">Parametric coefficients:</strong></span>
<span class="strong"><strong class="calibre2">            Estimate Std. Error t value Pr(&gt;|t|)    </strong></span>
<span class="strong"><strong class="calibre2">(Intercept)  3.79504    0.04507   84.21   &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">Approximate significance of smooth terms:</strong></span>
<span class="strong"><strong class="calibre2">         edf Ref.df   F p-value    </strong></span>
<span class="strong"><strong class="calibre2">s(nox) 8.434  8.893 189  &lt;2e-16 ***</strong></span>
<span class="strong"><strong class="calibre2">---</strong></span>
<span class="strong"><strong class="calibre2">Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</strong></span>

<span class="strong"><strong class="calibre2">R-sq.(adj) =  0.768   Deviance explained = 77.2%</strong></span>
<span class="strong"><strong class="calibre2">GCV = 1.0472  Scale est. = 1.0277    n = 506</strong></span>
</pre></div></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Fitting a generalized additive model to data">
<div class="book" title="How it works"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec167" class="calibre1"/>How it works</h2></div></div></div><p class="calibre7">GAM is<a id="id419" class="calibre1"/> designed to maximize the prediction of a dependent variable, <code class="email">y</code>, from various distributions by estimating the nonparametric functions of the predictors that link to the dependent variable through a link function. The notion of GAM is <span class="strong"><img src="../images/00095.jpeg" alt="How it works" class="calibre24"/></span>, where an exponential family, <span class="strong"><em class="calibre8">E</em></span>, is specified for <span class="strong"><em class="calibre8">y</em></span>, along with the <code class="email">g</code> link function; <code class="email">f</code> denotes the link function of predictors.</p><p class="calibre7">The <code class="email">gam</code> function is contained in the <code class="email">mgcv</code> package, so, install this package first and load it into an R session. Next, load the Boston dataset (<span class="strong"><em class="calibre8">Housing Values in the Suburbs of Boston</em></span>) from the <code class="email">MASS</code> package. From the dataset, we use <code class="email">dis</code> (the weighted mean of the distance to five Boston employment centers) as the dependent variable, and <code class="email">nox</code> (nitrogen oxide concentration) as the independent variable, and then input them into the <code class="email">gam</code> function to generate a fitted model.</p><p class="calibre7">Similar to <code class="email">glm</code>, <code class="email">gam</code> allows users to summarize the <code class="email">gam</code> fit. From the summary, one can find the parametric parameter, significance of smoothed terms, and other useful information.</p></div></div>

<div class="book" title="Fitting a generalized additive model to data">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec168" class="calibre1"/>See also</h2></div></div></div><div class="book"><ul class="itemizedlist"><li class="listitem">Apart from <code class="email">gam</code>, the <code class="email">mgcv</code> package provides another generalized additive model, <code class="email">bam</code>, for large datasets. The <a id="id420" class="calibre1"/><code class="email">bam</code> package is very similar to <code class="email">gam</code>, but uses less memory and is relatively more efficient. Please use the <code class="email">help</code> function for more information on this model:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2"> &gt; ? bam</strong></span>
</pre></div></li><li class="listitem">For more information about generalized additive models in R, please refer to <span class="strong"><em class="calibre8">Wood, S. (2006). Generalized additive models: an introduction with R. CRC press</em></span>.</li></ul></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Visualizing a generalized additive model"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec52" class="calibre1"/>Visualizing a generalized additive model</h1></div></div></div><p class="calibre7">In this recipe, we demonstrate how to add a <code class="email">gam</code> fitted regression line to a scatter plot. In addition, we <a id="id421" class="calibre1"/>visualize the gam fit using the <code class="email">plot</code> function.</p></div>

<div class="book" title="Visualizing a generalized additive model">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec169" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">Complete the previous recipe by assigning a <code class="email">gam</code> fitted model to the <code class="email">fit</code> variable.</p></div></div>

<div class="book" title="Visualizing a generalized additive model">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec170" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform the following steps to visualize the generalized additive model:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Generate a scatter plot using the <code class="email">nox</code> and <code class="email">dis</code> variables:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(nox, dis)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00096.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Scatter plot of variable nox against dis</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="2">Add the regression to the scatter plot:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; x = seq(0, 1, length = 500)</strong></span>
<span class="strong"><strong class="calibre2">&gt; y = predict(fit, data.frame(nox = x))</strong></span>
<span class="strong"><strong class="calibre2">&gt; lines(x, y, col = "red", lwd = 2)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00097.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Fitted regression of gam on a scatter plot</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="3">Alternatively, you <a id="id422" class="calibre1"/>can plot the fitted model using the <code class="email">plot</code> function:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; plot(fit)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00098.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Plot of fitted gam</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Visualizing a generalized additive model">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec171" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">To <a id="id423" class="calibre1"/>visualize the fitted regression, we first generate a scatter plot using the <code class="email">dis</code> and <code class="email">nox</code> variables. Then, we generate the sequence of <span class="strong"><em class="calibre8">x</em></span>-axis, and respond <span class="strong"><em class="calibre8">y</em></span> through the use of the <code class="email">predict</code> function on the fitted model, <code class="email">fit</code>. Finally, we use the <code class="email">lines</code> function to add the regression line to the scatter plot.</p><p class="calibre7">Besides using the lines to add fitted regression lines on the scatter plot, <code class="email">gam</code> has a <code class="email">plot</code> function to visualize the fitted regression lines containing the confidence region. To shade the confidence region, we assign <code class="email">shade = TRUE</code> within the function.</p></div></div>

<div class="book" title="Visualizing a generalized additive model">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec172" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">The <code class="email">vis.gam</code> function is used to produce perspective or contour plot views of the <code class="email">gam</code> model predictions. It is helpful to observe how response variables interact with two predictor variables. The following is an example of a contour plot on the <code class="email">Boston</code> dataset:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; fit2=gam(medv~crim+zn+crim:zn, data=Boston)</strong></span>
<span class="strong"><strong class="calibre2">&gt; vis.gam(fit2)</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00099.jpeg" alt="There's more..." class="calibre9"/><div class="caption"><p class="calibre12">A sample contour plot produced by vis.gam</p></div></div><p class="calibre10"> </p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Diagnosing a generalized additive model"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec53" class="calibre1"/>Diagnosing a generalized additive model</h1></div></div></div><p class="calibre7">GAM also <a id="id424" class="calibre1"/>provides diagnostic information about the fitting procedure and results of the generalized additive model. In this recipe, we demonstrate how to plot diagnostic plots through the <code class="email">gam.check</code> function.</p></div>

<div class="book" title="Diagnosing a generalized additive model">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec173" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre7">Ensure that the previous recipe is completed with the <code class="email">gam</code> fitted model assigned to the <code class="email">fit</code> variable.</p></div></div>

<div class="book" title="Diagnosing a generalized additive model">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec174" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre7">Perform <a id="id425" class="calibre1"/>the following step to diagnose the generalized additive model:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Generate the diagnostic plot using <code class="email">gam.check</code> on the fitted model:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; gam.check(fit)</strong></span>

<span class="strong"><strong class="calibre2">Method: GCV   Optimizer: magic</strong></span>
<span class="strong"><strong class="calibre2">Smoothing parameter selection converged after 7 iterations.</strong></span>
<span class="strong"><strong class="calibre2">The RMS GCV score gradient at convergence was 8.79622e-06 .</strong></span>
<span class="strong"><strong class="calibre2">The Hessian was positive definite.</strong></span>
<span class="strong"><strong class="calibre2">The estimated model rank was 10 (maximum possible: 10)</strong></span>
<span class="strong"><strong class="calibre2">Model rank =  10 / 10 </strong></span>

<span class="strong"><strong class="calibre2">Basis dimension (k) checking results. Low p-value (k-index&lt;1) may</strong></span>
<span class="strong"><strong class="calibre2">indicate that k is too low, especially if edf is close to k'.</strong></span>

<span class="strong"><strong class="calibre2">          k'   edf k-index p-value</strong></span>
<span class="strong"><strong class="calibre2">s(nox) 9.000 8.434   0.397       0</strong></span>
</pre></div><div class="mediaobject"><img src="../images/00100.jpeg" alt="How to do it..." class="calibre9"/><div class="caption"><p class="calibre12">Diagnostic plot of fitted gam</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Diagnosing a generalized additive model">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec175" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre7">The <code class="email">gam.check</code> function first produces the smoothing parameter estimation convergence information. In <a id="id426" class="calibre1"/>this example, the smoothing parameter, <span class="strong"><strong class="calibre2">GCV/UBRE</strong></span> (<span class="strong"><strong class="calibre2">Generalized Cross Validation/ Unbiased Risk Estimator</strong></span>) score converges<a id="id427" class="calibre1"/> after seven iterations. The mean<a id="id428" class="calibre1"/> absolute gradient of the GCV/UBRE function at the minimum is 8.79622e-06 and the estimated rank is <code class="email">10</code>. The dimension check is to test whether the basis dimension for a smooth function is adequate. From this example, the low p-value indicates that the k is set too low. One may adjust the dimension choice for smooth by specifying the argument, k, by fitting <code class="email">gam</code> to the data.</p><p class="calibre7">In addition to providing information regarding smoothing parameter estimation convergence, the function returns four diagnostic plots. The upper-left section of the plot in the screenshot shows a <span class="strong"><strong class="calibre2">quantile-comparison</strong></span> plot. This plot is useful to identify outliers <a id="id429" class="calibre1"/>and heavy tails. The upper-right section of the plot shows residuals versus linear predictors, which are useful in finding nonconstant error variances. The bottom-left section of the plot shows a histogram of the residuals, which is helpful in detecting non-normality. The bottom-right section shows response versus the fitted value.</p></div></div>

<div class="book" title="Diagnosing a generalized additive model">
<div class="book" title="There's more..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec176" class="calibre1"/>There's more...</h2></div></div></div><p class="calibre7">You can access the <code class="email">help</code> function for more information on <code class="email">gam.check</code>. In particular, this includes a detailed illustration of smoothing parameter estimation convergence and four returned plots:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; ?gam.check</strong></span>
</pre></div><p class="calibre7">In addition, more<a id="id430" class="calibre1"/> information for <code class="email">choose.k</code> can be accessed by the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre2">&gt; ?choose.k</strong></span>
</pre></div></div></div></body></html>
<html><head></head><body>
		<div id="_idContainer028">
			<h1 id="_idParaDest-16"><em class="italic"><a id="_idTextAnchor016"/>Chapter 1</em>: Introduction to Google Cloud and BigQuery</h1>
			<p>The adoption of the public cloud enables companies and users to access innovative and cost-effective technologies. This is particularly valuable in the big data and <strong class="bold">Artificial Intelligence</strong> (<strong class="bold">AI</strong>) areas, where new solutions are providing possibilities that seemed impossible to achieve with on-premises systems only a few years ago. In order to be effective in the day-to-day business of a company, the new AI capabilities need to be shared between different roles and not concentrated only with technicians. Most cloud providers are currently addressing the challenge of democratizing AI across different departments and employees with different skills.</p>
			<p>In this context, <strong class="bold">Google Cloud</strong> provides several services to accelerate the processing of large amounts of data and build <strong class="bold">Machine Learning</strong> (<strong class="bold">ML</strong>) applications that can make better decisions.</p>
			<p>In this chapter, we'll gradually introduce the main concepts that will be useful in the upcoming hands-on activities. Using an incremental approach, we'll go through the following topics:</p>
			<ul>
				<li>Introducing Google Cloud Platform</li>
				<li>Exploring AI and ML services on GCP</li>
				<li>Introducing BigQuery</li>
				<li>Discovering BigQuery ML</li>
				<li>Understanding BigQuery pricing</li>
			</ul>
			<h1 id="_idParaDest-17"><a id="_idTextAnchor017"/>Introducing Google Cloud Platform</h1>
			<p>Starting<a id="_idIndexMarker000"/> from 1998 with the launch of <strong class="bold">Google Search</strong>, Google has<a id="_idIndexMarker001"/> developed one of the largest and most powerful IT infrastructures in <a id="_idIndexMarker002"/>the world. Today, this infrastructure is used by billions of users to use services <a id="_idIndexMarker003"/>such as <strong class="bold">Gmail</strong>, <strong class="bold">YouTube</strong>, <strong class="bold">Google Photo</strong>, and <strong class="bold">Maps</strong>. After 10 years, in 2008, Google decided to open its network and IT <a id="_idIndexMarker004"/>infrastructure to business customers, taking an<a id="_idIndexMarker005"/> infrastructure that was initially developed for consumer applications to public <a id="_idIndexMarker006"/>service and launching <strong class="bold">Google Cloud Platform</strong> (<strong class="bold">GCP</strong>).</p>
			<p>The 90+ services that Google currently provides to large enterprises and small- and medium-sized businesses cover the following categories:</p>
			<ul>
				<li><strong class="bold">Compute</strong>: Used to<a id="_idIndexMarker007"/> support workloads or applications with virtual machines such as Google Compute Engine, containers with Google Kubernetes Engine, or platforms such as AppEngine.</li>
				<li><strong class="bold">Storage and databases</strong>: Used to store datasets and objects in an easy and convenient way. Some<a id="_idIndexMarker008"/> examples are Google Cloud Storage, Cloud SQL, and Spanner.</li>
				<li><strong class="bold">Networking</strong>: Used to<a id="_idIndexMarker009"/> easily connect different locations and data centers across the globe <a id="_idIndexMarker010"/>with <strong class="bold">Virtual Private Clouds</strong> (<strong class="bold">VPCs</strong>), firewalls, and fully managed global routers.</li>
				<li><strong class="bold">Big data</strong>: Used to<a id="_idIndexMarker011"/> store and process large amounts of information in a structured, semi-structured, or unstructured format. Among these services are Google DataProc, the Hadoop services offered by GCP, and BigQuery, which is the main focus of this book.</li>
				<li><strong class="bold">AI and machine learning</strong>: This product area provides various tools for different <a id="_idIndexMarker012"/>kinds of users, enabling them to leverage<a id="_idIndexMarker013"/> AI and ML  in their everyday business. Some examples are TensorFlow, AutoML, Vision APIs, and BigQuery ML, the main focus of this book.  </li>
				<li><strong class="bold">Identity, security, and management tools</strong>: This area includes all the services that are necessary to prevent <a id="_idIndexMarker014"/>unauthorized access, ensure security, and monitor all other cloud infrastructure. Identity Access Management, Key Management Service, Cloud Logging, and Cloud Audit Logs are just some of these tools.</li>
				<li><strong class="bold">Internet of Things</strong> (<strong class="bold">IoT</strong>): Used to <a id="_idIndexMarker015"/>connect plants, vehicles, or any other objects to the GCP infrastructure, enabling the development of modern IoT use cases. The core component of this area is Google IoT Core. </li>
				<li><strong class="bold">API management</strong>: Tools to<a id="_idIndexMarker016"/> expose services to customers and partners through REST APIs, providing the ability to fully leverage the benefits of interconnectivity. In this pillar, Google Apigee is one of the most famous products and is recognized as the leader of this market segment. </li>
				<li><strong class="bold">Productivity</strong>: Used to improve productivity<a id="_idIndexMarker017"/> and collaboration for all companies that want to start working with Google and embracing its way of doing business through the powerful tools of Google Workplace (previously GSuite).</li>
			</ul>
			<h2 id="_idParaDest-18"><a id="_idTextAnchor018"/>Interacting with GCP</h2>
			<p>All the services just <a id="_idIndexMarker018"/>mentioned can be accessed through four different interfaces:</p>
			<ul>
				<li><strong class="bold">Google Cloud Console</strong>: The <a id="_idIndexMarker019"/>web-based user interface of GCP, easily accessible from compatible web browsers such as Google Chrome, Edge, or Firefox. For the hands-on exercises in this book, we'll mainly use Google Cloud Console:</li>
			</ul>
			<div>
				<div id="_idContainer010" class="IMG---Figure">
					<img src="image/B16772_01_001.jpg" alt="Figure 1.1 – Screenshot of Google Cloud Console&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.1 – Screenshot of Google Cloud Console</p>
			<ul>
				<li><strong class="bold">Google Cloud SDK</strong>: The<a id="_idIndexMarker020"/> client SDK can be installed in order to interact with GCP services through the command line. It can be very useful to automate tasks and operations by scheduling them into scripts.</li>
				<li><strong class="bold">Client libraries</strong>: The <a id="_idIndexMarker021"/>SDK also includes some client libraries to interact with GCP using the most common programming languages, such as Python, Java, and Node.js.</li>
				<li><strong class="bold">REST APIs</strong>: Any <a id="_idIndexMarker022"/>task or operation performed on GCP can be executed by <a id="_idIndexMarker023"/>invoking a specific REST API from any compatible software.</li>
			</ul>
			<p>Now that we've learned how to interact with GCP, let's discover how GCP is different from other cloud providers.</p>
			<h2 id="_idParaDest-19"><a id="_idTextAnchor019"/>Discovering GCP's key differentiators</h2>
			<p>GCP is<a id="_idIndexMarker024"/> not the only public cloud provider on <a id="_idIndexMarker025"/>the market. Other companies have embarked on this kind of <a id="_idIndexMarker026"/>business, for example, with <strong class="bold">Amazon Web Services</strong> (<strong class="bold">AWS</strong>), <strong class="bold">Microsoft Azure</strong>, <strong class="bold">IBM</strong>, and <strong class="bold">Oracle</strong>. For this reason, before we get too deep into this <a id="_idIndexMarker027"/>book, it <a id="_idIndexMarker028"/>could be valuable to understand how GCP is different from the other offerings in the cloud market.</p>
			<p>Each cloud provider has its own mission, strategy, history, and strengths. Let's take a look at why Google Cloud can be considered different from all the other cloud providers.</p>
			<h3>Security</h3>
			<p>Google <a id="_idIndexMarker029"/>provides an end-to-end security model for its data centers across the globe, using customized hardware developed and used by Google, and application encryption is enabled by default. The security best practices adopted by Google for GCP are the same as those developed to run applications with more than 1 billion users, such as Gmail and Google Maps.</p>
			<h3>Global network and infrastructure</h3>
			<p>At the time of writing, Google's<a id="_idIndexMarker030"/> infrastructure is available in 24 different regions, 74 availability zones, and 144 network edge locations, enabling customers to connect to Google's network and ensuring the best experience in terms of bandwidth, network latency, and security. This network allows GCP users to move data across different regions without leaving Google's proprietary network, minimizing the risk of sending information across the public internet. As of today, it is estimated that about 40% of internet traffic goes through Google's proprietary network.</p>
			<p>In the following figure, we can see how GCP regions are distributed across the globe:</p>
			<div>
				<div id="_idContainer011" class="IMG---Figure">
					<img src="image/B16772_01_002.jpg" alt="Figure 1.2 – A map of Google's global availability&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.2 – A map of Google's global availability</p>
			<p>The latest<a id="_idIndexMarker031"/> version of the map can be seen at the following URL: <a href="https://cloud.google.com/about/locations">https://cloud.google.com/about/locations</a>.</p>
			<h3>Serverless and fully managed approach</h3>
			<p>Google provides a lot of fully <a id="_idIndexMarker032"/>managed and serverless services to allow its customers to focus on high-value activities rather than maintenance operations. A great example is BigQuery, the serverless data warehouse that will be introduced in the next section of this chapter.</p>
			<h3>Environmental sustainability</h3>
			<p>100% of the energy used for <a id="_idIndexMarker033"/>Google's data centers comes from renewable energy sources. Furthermore, Google has committed to being the first major company to operate carbon-free for all its operations, such as its data centers and campuses, by 2030.</p>
			<h3>Pervasive AI</h3>
			<p>Google is a pioneer of the AI industry<a id="_idIndexMarker034"/> and is leveraging AI and ML to improve its consumer products, such as Google Photos, but also to improve the performance and efficiency of its data centers. All of Google's expertise in terms of AI and ML can be leveraged by customers through adopting GCP services such as AutoML and BigQuery ML. That will be the main focus of this book.</p>
			<p>Now that we have discussed some of the key elements of GCP as a service, let's look at AI and ML more specifically.</p>
			<h1 id="_idParaDest-20"><a id="_idTextAnchor020"/>Exploring AI and ML services on GCP</h1>
			<p>Before we get too <a id="_idIndexMarker035"/>deep into our look at all of the AI and ML tools of GCP, it is very important to remember that Google is an AI company and embeds AI and ML features within many of its other products, providing the best user experience to its customers. Simply looking at Google's products, we can easily perceive how AI can be a key asset for a business. Some examples follow:</p>
			<ul>
				<li>Gmail Smart Reply allows users to quickly reply to emails, providing meaningful suggestions according to the context of the conversation.</li>
				<li>Google Maps is able to precisely predict our time of arrival when we move from one place to another by combining different data sources.</li>
				<li>Google Translate provides translation services for more than one hundred languages.</li>
				<li>YouTube and the Google Play Store are able to recommend the best video to watch or the most useful mobile application to install according to user preferences.</li>
				<li>Google Photos recognizes people, animals, and places in our pictures, simplifying the job of archiving and organizing our photos.</li>
			</ul>
			<p>Google proves that leveraging AI and ML capabilities in our business opens new opportunities for us, increases our revenue, saves money and time, and provides better experiences to our customers. </p>
			<p>To better understand the<a id="_idIndexMarker036"/> richness of the GCP portfolio in terms of AI and ML services, it is important to emphasize that GCP services are able to address all the needs that emerge in a typical life cycle of an ML model:</p>
			<ol>
				<li>Ingestion and preparation of the datasets</li>
				<li>Building and training of the model</li>
				<li>Evaluation and validation</li>
				<li>Deployment</li>
				<li>Maintenance and further improvements of the model</li>
			</ol>
			<p>In the following figure, you can see the entire AI and ML GCP portfolio:</p>
			<div>
				<div id="_idContainer012" class="IMG---Figure">
					<img src="image/B16772_01_003.jpg" alt="Figure 1.3 – GCP AI and ML services represented by their icons&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.3 – GCP AI and ML services represented by their icons</p>
			<p>Each one of the previously mentioned five stages can be fully managed by the user or delegated to the automation capabilities of GCP, according to the customer's needs and skills. For this reason, it is possible to divide the AI and ML services provided by GCP into three subcategories:</p>
			<ul>
				<li><strong class="bold">Core platform services</strong></li>
				<li><strong class="bold">AI Applications</strong></li>
				<li><strong class="bold">Solutions</strong></li>
			</ul>
			<p>For each of these subcategories, we'll go through the most important services currently available and some typical users that could benefit from them.</p>
			<h2 id="_idParaDest-21"><a id="_idTextAnchor021"/>Core platform services</h2>
			<p>The core AI and ML <a id="_idIndexMarker037"/>services are the most <a id="_idIndexMarker038"/>granular items that a customer can use on GCP to develop AI and ML use cases. They provide the most control and flexibility to their users in exchange for less automation; users will also need to have more expertise in ML.</p>
			<h3>Processing units (CPU, GPU, and TPU)</h3>
			<p>With a <a id="_idIndexMarker039"/>traditional <strong class="bold">Infrastructure-as-a-Service</strong> (<strong class="bold">IaaS</strong>) approach, developers can equip their Google Compute<a id="_idIndexMarker040"/> Engine instances with powerful processing units to<a id="_idIndexMarker041"/> accelerate the training phases of ML models that might otherwise take a long time to run, particularly if complex contexts or large amounts of data need to be processed. Beyond the <strong class="bold">Central Processing Units</strong> (<strong class="bold">CPUs</strong>) that<a id="_idIndexMarker042"/> are available on our laptops, GCP offers the use of high-performance <strong class="bold">Graphical Processing Units</strong> (<strong class="bold">GPUs</strong>) made by Nvidia and available in the <a id="_idIndexMarker043"/>cloud to speed up computationally heavy jobs. Beyond that, there are <strong class="bold">Tensor Processing Units</strong> (<strong class="bold">TPUs</strong>), which are <a id="_idIndexMarker044"/>specifically designed to support ML workloads and perform matrix calculations. </p>
			<h3>Deep Learning VM Image </h3>
			<p>One of the biggest <a id="_idIndexMarker045"/>challenges for data scientists is quickly provisioning environments to develop their ML models. For this reason, Google<a id="_idIndexMarker046"/> Cloud provides pre-configured <strong class="bold">Google Compute Engine</strong> (<strong class="bold">GCE</strong>) images that can be easily provisioned with a pre-built set of components and libraries dedicated to ML.</p>
			<p>In the following screenshot, you can see <a id="_idIndexMarker047"/>how these <strong class="bold">Virtual Machines</strong> (<strong class="bold">VMs</strong>) are presented in the GCP marketplace:</p>
			<div>
				<div id="_idContainer013" class="IMG---Figure">
					<img src="image/B16772_01_004.jpg" alt="Figure 1.4 – Deep Learning VM in the GCP marketplace&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.4 – Deep Learning VM in the GCP marketplace</p>
			<p><strong class="bold">Deep Learning VM Image</strong> is<a id="_idIndexMarker048"/> also optimized for ML workloads and is already pre-configured to use GPUs. When a GCE image is provisioned from the GCP<a id="_idIndexMarker049"/> marketplace, it is already configured with the most common ML frameworks and programming languages, such as Python, TensorFlow, scikit-learn, and others. This allows data scientists to focus on the development of the model rather than on the provisioning and configuration of the development environment.</p>
			<h3>TensorFlow</h3>
			<p><strong class="bold">TensorFlow</strong> is<a id="_idIndexMarker050"/> an open source framework for math, statistics, and ML. It was launched by Google<a id="_idIndexMarker051"/> Brain for internal use at Google and then released under the Apache License 2.0. It is still the core of the most successful Google products. The framework natively supports Python but can be used also with other programming languages such as Java, C++, and Go. It requires ML expertise, but it allows users to achieve great results in terms of customization and flexibility to develop the best ML model.</p>
			<h3>AI Platform</h3>
			<p><strong class="bold">AI Platform</strong> is an<a id="_idIndexMarker052"/> integrated service of GCP that provides serverless tools to train, evaluate, deploy, and maintain<a id="_idIndexMarker053"/> ML models. With this service, data scientists are able to focus only on their code, simplifying all the side activities of ML development, such as provisioning, maintenance, and scalability.</p>
			<h3>AI Platform Notebooks</h3>
			<p>AI Platform Notebooks is a<a id="_idIndexMarker054"/> fully managed service that provides data scientists with a <strong class="bold">JupyterLab</strong> environment <a id="_idIndexMarker055"/>already integrated and connected with all other GCP resources. Similar to Deep Learning<a id="_idIndexMarker056"/> VM Image, <strong class="bold">AI Platform Notebooks</strong> instances come pre-configured with the latest versions of the AI and ML frameworks and allow you to develop an ML model with diagrams and written explanations.</p>
			<p>All the services described so far require good knowledge of ML and proven experience in hand-coding with the most common programming languages. The core platform services address the needs of data scientists and ML engineers who need full control over and flexibility with the solutions that they're building and who already have strong technical skills.</p>
			<h2 id="_idParaDest-22"><a id="_idTextAnchor022"/>Building blocks</h2>
			<p>On top of the core platform services, Google Cloud provides pre-built components<a id="_idIndexMarker057"/> that can be used to accelerate the development of new ML use cases. This category encompasses the following aspects:</p>
			<h3>AutoML</h3>
			<p>Unlike the services outlined<a id="_idIndexMarker058"/> in the previous <a id="_idIndexMarker059"/>section, <strong class="bold">AutoML</strong> offers the ability to build ML models even if you have limited expertise in the field. It leverages Google's ML capabilities and allows users to provide their data to train customized versions of algorithms already developed by Google. AutoML currently <a id="_idIndexMarker060"/>provides the <a id="_idIndexMarker061"/>ability to train models for images (<strong class="bold">AutoML Vision</strong>), video (<strong class="bold">AutoML Video Intelligence</strong>), free text (<strong class="bold">AutoML Natural Language</strong>), translation (AutoML Translation), and <a id="_idIndexMarker062"/>structured data (<strong class="bold">AutoML Tables</strong>). When the ML model is trained and ready<a id="_idIndexMarker063"/> to use, it is automatically deployed and made available through a REST endpoint.</p>
			<h3>Pre-built APIs</h3>
			<p>Google Cloud <a id="_idIndexMarker064"/>provides pre-built APIs that leverage ML technology under the surface but are already trained and ready to use. The APIs are exposed through a <a id="_idIndexMarker065"/>standard REST interface that can be easily integrated <a id="_idIndexMarker066"/>into applications to work <a id="_idIndexMarker067"/>with images (<strong class="bold">Vision API</strong>), videos (<strong class="bold">Video API</strong>), free text (<strong class="bold">Natural Language API</strong>), translations (<strong class="bold">Translation API</strong>), e-commerce<a id="_idIndexMarker068"/> data (<strong class="bold">Recommendations AI</strong>), and<a id="_idIndexMarker069"/> conversational <a id="_idIndexMarker070"/>scenarios (<strong class="bold">Speech-to-Text API</strong>, <strong class="bold">Text-to-Speech API</strong>, and <strong class="bold">Dialogflow</strong>). Using a pre-built ML API is<a id="_idIndexMarker071"/> the best choice for general-purpose <a id="_idIndexMarker072"/>applications where generic training datasets can be used.</p>
			<h3>BigQuery ML</h3>
			<p>As <strong class="bold">BigQuery ML</strong> will <a id="_idIndexMarker073"/>be discussed in detail in the following sections of this chapter, for the moment you just need to know that this component enables users to build ML <a id="_idIndexMarker074"/>models with SQL language, using structured data stored in BigQuery and a list of supported algorithms.</p>
			<p>None of the building blocks described here requires any specific knowledge of ML or any proven coding experience with programming languages. In fact, these services are intended for developers or business analysts who are not very familiar with ML but want to start using it quickly and with little effort. On the other hand, a data scientist with ML expertise can also leverage the building blocks to accelerate the development of a model, reducing the time to market of a solution.</p>
			<p>To see a summary of the building blocks, their usage, and their target users, let's take a look at the following table:</p>
			<div>
				<div id="_idContainer014" class="IMG---Figure">
					<img src="image/B16772_01_005.jpg" alt="Figure 1.5 – Building blocks summary table&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.5 – Building blocks summary table</p>
			<p>Now that we've learned the basics of building blocks, let's take a look at the solutions offered by GCP.</p>
			<h2 id="_idParaDest-23"><a id="_idTextAnchor023"/>Solutions</h2>
			<p>Following <a id="_idIndexMarker075"/>the incremental approach, building blocks and core platform services are also bundled to provide out-of-the-box solutions. These pre-built modules can be adopted by companies and immediately used to improve their business. These solutions are covered in this section.</p>
			<h3>AI Hub</h3>
			<p>Google Cloud's <strong class="bold">AI Hub</strong> acts <a id="_idIndexMarker076"/>as a marketplace for AI components. It can be used in <a id="_idIndexMarker077"/>public mode to share and use assets developed by the community, which actively works on GCP, or it can be used privately to share ML assets inside your company. The goal of this service is to simplify the sharing of valuable assets across different users, favoring re-use and accelerating the deployment of new use cases. </p>
			<p>In the following screenshot, you can see AI Hub's home page:</p>
			<div>
				<div id="_idContainer015" class="IMG---Figure">
					<img src="image/B16772_01_006.jpg" alt="Figure 1.6 – Screenshot of AI Hub on GCP&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.6 – Screenshot of AI Hub on GCP</p>
			<p>Now that we've understood the role of AI Hub, let's look at Cloud Talent Solution.</p>
			<h3>Cloud Talent Solution</h3>
			<p>Cloud Talent Solution <a id="_idIndexMarker078"/>is basically a solution for HR offices that improves the <a id="_idIndexMarker079"/>candidate discovery and hiring processes using AI. We will not go any further with the description of this solution, but there will be a link in the <em class="italic">Further resources</em> section at the end of this chapter.</p>
			<h3>Contact Center AI</h3>
			<p><strong class="bold">Contact Center AI</strong> is a<a id="_idIndexMarker080"/> solution that can be used to improve the effectiveness of the <a id="_idIndexMarker081"/>customer experience with a contact center powered by AI and automation. The solution is based on Dialogflow and the Text-to-Speech and Speech-to-Text APIs.</p>
			<h3>Document AI</h3>
			<p>This solution is<a id="_idIndexMarker082"/> focused on<a id="_idIndexMarker083"/> document processing to extract relevant information and streamline business processes that usually require manual effort. The solution is able to parse PDF files, images, and handwritten text to convert this information into a digitally structured format, making them accessible and researchable.</p>
			<p>As can be easily seen from their descriptions, the AI solutions provided by Google are more business-oriented and designed to solve specific challenges. They can be configured and customized but are basically dedicated to business users.</p>
			<p>Before going on, let's<a id="_idIndexMarker084"/> take a look at the following table, which summarizes the concepts<a id="_idIndexMarker085"/> explained in this section and provides a clear overview of the different AI and ML service categories:</p>
			<div>
				<div id="_idContainer016" class="IMG---Figure">
					<img src="image/B16772_01_007.jpg" alt="Figure 1.7 – Summary of GCP AI and ML services&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.7 – Summary of GCP AI and ML services</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">When you need to develop a new use case, we recommend using pre-built solutions and building blocks before trying to reinvent the wheel. If a building block already satisfies all the requirements of your use case, it can be extremely valuable to use it. It will save time and effort during the development and maintenance phases. Start considering the use of core services only if the use case is complex or so particular that it cannot be addressed with building blocks or solutions.</p>
			<p>As we've seen in this section, GCP's AI and ML services are extensive. Now, let's take a closer look at the main topic of this book: Google BigQuery.</p>
			<h1 id="_idParaDest-24"><a id="_idTextAnchor024"/>Introducing BigQuery</h1>
			<p>Google BigQuery<a id="_idIndexMarker086"/> is a highly scalable, serverless, distributed data warehouse technology built internally by Google in 2006 and then released for public use on GCP in 2010. Thanks to its architecture, it can store petabytes of data and query them with high performance and on-demand scaling. Due to its serverless nature, users who store and query data on BigQuery don't have to manage the underlying infrastructure and can focus on implementing the logic that brings the business value, saving time and resources.</p>
			<p>BigQuery is currently used by many large enterprises that leverage it to make data-driven decisions, including Twitter, The Home Depot, and Dow Jones.</p>
			<h2 id="_idParaDest-25"><a id="_idTextAnchor025"/>BigQuery architecture</h2>
			<p>BigQuery has a <a id="_idIndexMarker087"/>distributed architecture running on thousands of nodes across Google's data centers. Your datasets are not stored in a unique server but are chunked and replicated across different regions to guarantee maximum performance and availability.</p>
			<p>The storage and compute layers are fully decoupled in BigQuery. This means that the query engine runs on different servers from the servers where the data is stored. This feature enables BigQuery to provide great scalability both in terms of data volume and query execution. This decoupled paradigm is only possible thanks to Google's Petabit network, which moves data very quickly from one server to another, leveraging Google's proprietary fiber cables across the globe.</p>
			<p>Now let's look deeper into how BigQuery manages storage and the compute engine.</p>
			<h3>Storage layer</h3>
			<p>Unlike traditional <a id="_idIndexMarker088"/>data warehouses, BigQuery stores data in columnar format rather than in row format. This approach enables you to do the following:</p>
			<ul>
				<li>Achieve a better compression ratio for each column, because the data in a column is typically homogeneous and simpler to compress.</li>
				<li>Reduce the amount of data to read and get the best possible performance for data warehouse use cases that are usually based on a small selection of columns in a table and aggregating operations such as sums, average, and maximum.</li>
			</ul>
			<p>All the data is stored in Google's proprietary distributed filesystem named Google File System (codename Colossus). The distribution of the data allows it to guarantee faster I/O performance and better availability of data in the case of failures. Google File System is based on two different server types:</p>
			<ul>
				<li><strong class="bold">Master servers:</strong> Nodes <a id="_idIndexMarker089"/>that don't store data but are responsible for managing the metadata of each file, such as the location and available number of replicas of each chunk that compose a file.</li>
				<li><strong class="bold">Chunk servers:</strong> Nodes<a id="_idIndexMarker090"/> that actually store the chunks of files that are replicated across different servers.</li>
			</ul>
			<p>In the following diagram, you can see how<a id="_idIndexMarker091"/> Google File System manages data:</p>
			<div>
				<div id="_idContainer017" class="IMG---Figure">
					<img src="image/B16772_01_008.jpg" alt="Figure 1.8 – Google File System (Colossus) storage strategy&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.8 – Google File System (Colossus) storage strategy</p>
			<p>Now that we've learned how BigQuery handles large volumes of data, let's see how this data can be accessed by the compute layer.</p>
			<h3>Compute (query) layer</h3>
			<p>Fully decoupled<a id="_idIndexMarker092"/> from storage, the compute layer is responsible for receiving query statements from BigQuery users and executing them in the fastest way. The query engine is based on Dremel, a technology developed by Google and then published in a paper in 2010. This engine leverages a multi-level tree architecture:</p>
			<ol>
				<li value="1">The root node of the tree receives the query to execute.</li>
				<li>The root node splits and distributes the query to other intermediate nodes named mixers.</li>
				<li>Mixer nodes have the task of rewriting queries before passing them to the leaf nodes or to other intermediate mixer nodes.</li>
				<li>Leaf nodes are responsible for parallelizing the reading of the chunks of data from Google File System.</li>
				<li>When the right chunks of data are extracted from the filesystem, leaf nodes perform computations on the data and eventually shuffle them across other leaf nodes.</li>
				<li>At the end of the computation, each leaf node produces a result that is returned to the parent node.</li>
				<li>When all the results are returned to the root node, the outcome of the query is sent to the <a id="_idIndexMarker093"/>user or application that requested the execution. </li>
			</ol>
			<p>The execution process of a query on BigQuery based on the multi-level tree is represented in the following diagram:</p>
			<div>
				<div id="_idContainer018" class="IMG---Figure">
					<img src="image/B16772_01_009.jpg" alt="Figure 1.9 – The BigQuery engine is a multi-level tree&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.9 – The BigQuery engine is a multi-level tree</p>
			<p>Each node provides a number of processing units called BigQuery slots to execute the business logic of the query. A BigQuery slot can be considered a virtual CPU on a Dremel node. The calculation of the slots needed to perform a specific query is automatically managed by BigQuery depending on the complexity of the query and the impacted data volumes.</p>
			<h2 id="_idParaDest-26"><a id="_idTextAnchor026"/>BigQuery's advantages over traditional data warehouses</h2>
			<p>Now that we've<a id="_idIndexMarker094"/> learned about the technical architecture underneath BigQuery, let's take a look at how this architecture translates into benefits for the enterprises that use it to become data-driven companies compared to other traditional on-premises data warehouses.</p>
			<h3>Serverless</h3>
			<p>As we have <a id="_idIndexMarker095"/>mentioned, BigQuery has a serverless architecture that saves users from having to manage not only the provisioning and maintenance of the servers but also all the maintenance operations related to the upgrading and patching of the operative system and of the database software that supports the functioning of the data warehouse. Thanks to the serverless approach, the user can easily start ingesting data into BigQuery and using it without having to perform capacity planning or any hardware and software provisioning upfront. This is particularly important for prototyping and to enable a fail-fast approach that favors a culture of innovation and experimentation.</p>
			<h3>Scalability</h3>
			<p>It doesn't matter if <a id="_idIndexMarker096"/>you need to store megabytes of data or petabytes; BigQuery can provide you with maximum flexibility and scalability in terms of both data storage and processing. Thanks to its multi-tenant architecture, a small or medium-sized business can leverage the same innovative capabilities as the largest enterprises, or they can start with a small use case to scale later, according to business needs. Traditional data warehouse technologies leverage the same servers to store and compute. For this reason, they are not particularly suitable for unbalanced use cases, such as when large volumes of data storage are needed but high computing performance is not required, or vice versa. Thanks to its decoupled architecture, as we've seen in the previous section, BigQuery is designed to independently scale storage and compute power according to the user's actual <a id="_idIndexMarker097"/>requirements, reducing the total cost of ownership of the solution.</p>
			<h3>Availability</h3>
			<p>Thanks to<a id="_idIndexMarker098"/> its resilient, distributed architecture, BigQuery is able to offer a <strong class="bold">Service Level Agreement</strong> (<strong class="bold">SLA</strong>) of <a id="_idIndexMarker099"/>monthly uptime percentage greater than 99.99%. This very high availability standard is granted by Google without any extra effort from the BigQuery users, who don't need to take care of high availability or disaster recovery strategies.</p>
			<h3>Performances</h3>
			<p>The BigQuery engine<a id="_idIndexMarker100"/> offers the ability to query terabytes of data in seconds and petabytes in minutes. This kind of performance is very hard to achieve with a traditional on-premises data warehouse. Higher performance means getting insights faster, as well as processing large volumes of data that very often would be impossible to manage on-premises without huge hardware and software investments. To further improve performance, BigQuery offers the possibility of enabling BigQuery BI Engine. BigQuery BI Engine is an in-memory analytics layer that can be activated on top of BigQuery to execute queries faster, with sub-second latencies. </p>
			<h3>Real-time</h3>
			<p>Traditional data <a id="_idIndexMarker101"/>warehouses are designed for long batch operations and are often unable to manage real-time workloads. BigQuery, however, provides a specific interface to ingest data in real time, making it immediately available for analysis. This feature opens up new possibilities to companies that want to accelerate their analytics and overcome the typical approach of data warehouses, which usually involves dealing with the business situation of the day before.</p>
			<h3>Format flexibility</h3>
			<p>BigQuery <a id="_idIndexMarker102"/>stores files in a compressed and optimized format in Google File System but provides the option to load data in various formats that are typically used in data lake technologies. Users can load data into BigQuery using Avro, ORC, CSV, and JSON formats.</p>
			<h3>Innovative capabilities</h3>
			<p>BigQuery offers two <a id="_idIndexMarker103"/>SQL extensions that are not available in traditional data warehouses:</p>
			<ul>
				<li><strong class="bold">BigQuery GIS</strong>: Provides<a id="_idIndexMarker104"/> the ability to easily manage geospatial data with SQL statements to execute geographic calculations and operations</li>
				<li><strong class="bold">BigQuery ML</strong>: Allows users <a id="_idIndexMarker105"/>to train, evaluate, and run ML models leveraging SQL language with no programming experience, accelerating the development of innovative use cases with ML</li>
			</ul>
			<h3>Security</h3>
			<p>By default, BigQuery<a id="_idIndexMarker106"/> automatically encrypts and decrypts customer's data before storing it in Google File System. BigQuery is also responsible for managing and rotating the encryption and decryption keys. To <a id="_idIndexMarker107"/>further improve security, BigQuery provides the option to use <strong class="bold">Customer-Managed Encryption Keys</strong> (<strong class="bold">CMEKs</strong>). In this case, the keys are managed directly by the customer in Google Cloud Key Management System.</p>
			<p>Unauthorized access and use of data <a id="_idIndexMarker108"/>can be prevented by setting the right roles in Google <strong class="bold">Identity Access Management System</strong> (<strong class="bold">IAM</strong>).</p>
			<h3>Integration with other GCP services</h3>
			<p>One of the<a id="_idIndexMarker109"/> great benefits of using BigQuery is the native integration with a lot of other GCP services:</p>
			<div>
				<div id="_idContainer019" class="IMG---Figure">
					<img src="image/B16772_01_010.jpg" alt="Figure 1.10 – BigQuery integration with other GCP services&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.10 – BigQuery integration with other GCP services</p>
			<p>As <a id="_idIndexMarker110"/>we can <a id="_idIndexMarker111"/>see in<a id="_idIndexMarker112"/> the preceding screenshot, Google BigQuery can read data from <strong class="bold">Google Bigtable</strong>, <strong class="bold">Google Cloud Storage</strong>, <strong class="bold">Google Cloud SQL</strong>, and <strong class="bold">Google Drive</strong> using external tables. This <a id="_idIndexMarker113"/>feature can simplify data ingestion into BigQuery from other databases, which can also be<a id="_idIndexMarker114"/> performed using ETL/ELT tools<a id="_idIndexMarker115"/> such as <strong class="bold">Google Dataflow</strong> and <strong class="bold">Data Fusion</strong>. When the datasets are stored in BigQuery, they can be accessed from other GCP <a id="_idIndexMarker116"/>components, such as <strong class="bold">Google DataProc</strong>, <strong class="bold">DataPrep</strong> for data <a id="_idIndexMarker117"/>processing and <a id="_idIndexMarker118"/>preparation, <strong class="bold">Data Studio</strong>, <strong class="bold">Looker</strong>, and <strong class="bold">Google Sheets</strong> for data <a id="_idIndexMarker119"/>visualization. BigQuery is integrated with AI Platform <a id="_idIndexMarker120"/>Notebooks to allow data scientists and engineers to easily access data from their Jupyter environments. </p>
			<p>To summarize, bringing data into BigQuery opens a vast plethora of options that can be used according to the user's needs.</p>
			<h3>Rich ecosystem of partners</h3>
			<p>Beyond the<a id="_idIndexMarker121"/> integration with other GCP services, Google's partners provide connectors and integrations with BigQuery, creating a rich data management ecosystem. Some examples include Informatica, Tableau, Fivetran, Talend, and Confluent.</p>
			<h3>Public datasets</h3>
			<p>If you want to <a id="_idIndexMarker122"/>start from scratch using BigQuery, you can leverage existing public tables that are available from the <strong class="bold">BigQuery Public Datasets Program</strong>. The program contains interesting datasets <a id="_idIndexMarker123"/>coming from different industries and different countries about different topics. Some examples that we'll use in the next chapter to train our ML models include transactions from bike sharing services, open data on New York City, and records of taxi trips.</p>
			<h2 id="_idParaDest-27"><a id="_idTextAnchor027"/>Interacting with BigQuery</h2>
			<p>There are different ways to<a id="_idIndexMarker124"/> interact with BigQuery. They are:</p>
			<ul>
				<li>The BigQuery web UI in the Google Cloud Console, the graphical user interface accessible from web browsers, represents the easiest way to interact with BigQuery.</li>
				<li>The <strong class="source-inline">bq</strong> command line, available with the installation of the Google Cloud SDK. It can be used to automate jobs and commands by including them in scripts.</li>
				<li>BigQuery REST APIs. The API layer natively provided by BigQuery can be used to integrate this service with other applications.</li>
				<li>Client libraries to favor the use of the most common programming languages, such as C#, Go, Java, Node.js, PHP, Python, and Ruby.</li>
				<li>JDBC/ODBC drivers, developed by Google's partner, Magnitude Simba Driver, are available for Windows, macOS, and Linux systems.</li>
				<li>Third parties and Google's partners have developed BigQuery connectors for their applications, such as Tableau for business intelligence, Informatica, and Talend for data ingestion and integration.</li>
			</ul>
			<p>For our purposes, we'll take a look at the BigQuery web UI available in Google Cloud Console that will be used in the coming chapters to develop with BigQuery ML.</p>
			<p>In the following screenshot, you<a id="_idIndexMarker125"/> can see how the BigQuery UI appears in the GCP console:</p>
			<div>
				<div id="_idContainer020" class="IMG---Figure">
					<img src="image/B16772_01_011.jpg" alt="Figure 1.11 – BigQuery web and graphical user interface available in the GCP console&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.11 – BigQuery web and graphical user interface available in the GCP console</p>
			<p>In the left column, the main BigQuery features are available and the datasets are listed and visible to the user. In this case, there is only one dataset.</p>
			<p>The remaining part of the screen is occupied by the development canvas with the results and outcomes at the bottom. We'll learn how to use the BigQuery web UI in <a href="B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039"><em class="italic">Chapter 2</em></a>,<em class="italic"> Setting Up Your GCP and BigQuery Environment</em>, when we'll create a GCP project and start using BigQuery.</p>
			<h2 id="_idParaDest-28"><a id="_idTextAnchor028"/>BigQuery data structures</h2>
			<p>BigQuery structures, such as tables, views, and ML models, are organized in datasets. Each dataset is a container for different structures and can be used to control access to underlying data structures. A dataset is directly linked to the following:</p>
			<ul>
				<li>A GCP<a id="_idIndexMarker126"/> project that hosts the dataset itself and is usually linked to the billing account where the storage cost is billed</li>
				<li>A geographic location (regional or multi-regional) that is defined at creation time and cannot be changed later</li>
				<li>A specific name assigned to the dataset that should be unique in the GCP project</li>
			</ul>
			<p>In the following diagram, you can see an example of a hierarchy composed of projects, datasets, tables, and BigQuery ML models:</p>
			<div>
				<div id="_idContainer021" class="IMG---Figure">
					<img src="image/B16772_01_012.jpg" alt="Figure 1.12 – BigQuery hierarchy: datasets, tables, views, and ML models&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.12 – BigQuery hierarchy: datasets, tables, views, and ML models</p>
			<p>A dataset hosted in GCP, <em class="italic">Project A</em>, can also be queried by users linked to another GCP project, <em class="italic">Project B</em>, if the right permissions are set. In this case, the storage costs are charged to <em class="italic">Project A</em>, which hosts the dataset structures, while the compute costs are billed on the billing account related to <em class="italic">Project B</em>. This is exactly what will happen when we use BigQuery <a id="_idIndexMarker127"/>public datasets in future chapters for hands-on exercises. </p>
			<p class="callout-heading">Tip</p>
			<p class="callout">Remember, your queries can only include tables that reside in the same region. In BigQuery, you cannot query tables that are stored in different geographic locations. If you want to execute queries on tables located in different regions, you need to export and import the data into a dataset in the same region, passing through Google Cloud Storage.</p>
			<p>Now that we've learned the main characteristics of BigQuery, let's focus more specifically on the core of this book: BigQuery ML.</p>
			<h1 id="_idParaDest-29"><a id="_idTextAnchor029"/>Discovering BigQuery ML</h1>
			<p>Developing a new ML<a id="_idIndexMarker128"/> model can require a lot of effort and can be a time-consuming activity. It usually requires different skills and is a complex activity, especially in large enterprises. The typical journey of an ML model can be summarized with the following flow:</p>
			<div>
				<div id="_idContainer022" class="IMG---Figure">
					<img src="image/B16772_01_013.jpg" alt="Figure 1.13 – An ML model's typical development life cycle&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.13 – An ML model's typical development life cycle</p>
			<p>The first two steps involve<a id="_idIndexMarker129"/> preliminary raw data analyses and operations:</p>
			<ol>
				<li value="1">In the <strong class="bold">Data Exploration and Understanding</strong> phase, the data engineer or data scientist takes a first look at the data, tries to understand the meaning of all the columns in the dataset, and then selects the fields to take into consideration for the new use case.</li>
				<li>During <strong class="bold">Data Preparation</strong>, the data engineer filters, aggregates, and cleans up the datasets, making them available and ready to use for the subsequent training phase. </li>
			</ol>
			<p>After these two first stages, the actual ML developing process starts:</p>
			<ol>
				<li value="1">Leveraging ML frameworks such as TensorFlow and programming languages such as Python, the data scientist will engage in the <strong class="bold">Design the ML model</strong> step, experimenting with different algorithms on the training dataset.</li>
				<li>When the right ML algorithm is selected, the data scientist performs the <strong class="bold">Tuning of the ML model</strong> step, applying feature engineering techniques and hyperparameter tuning to get better performance out of the ML model.</li>
				<li>When the model is ready, a final <strong class="bold">Evaluation</strong> step is executed on the evaluation dataset. This phase proves the effectiveness of the ML model on a new dataset that's different from the training one and eventually leads to further refinements of the asset.</li>
				<li>After the development process, the ML model is generally deployed and used in a production environment with scalability and robustness requirements.</li>
				<li>The ML model is also eventually updated in a subsequent stage due to different incoming data or to apply further improvements.</li>
			</ol>
			<p>All of these steps require different skills and are based on the collaboration of different stakeholders, such as business analysts for data exploration and understanding, data engineers for data preparation, data scientists for the development of the ML model, and finally the IT department to make the model usable in a safe, robust, and scalable production environment.</p>
			<p>BigQuery ML simplifies and<a id="_idIndexMarker130"/> accelerates the entire development process of a new ML model, allowing you to do the following:</p>
			<ul>
				<li>Design, train, evaluate, and serve the ML model, leveraging SQL and the existing skills in your company.</li>
				<li>Automate most of the tuning activities that are usually highly time-consuming to get an effective model.</li>
				<li>Ensure that you have a robust, scalable, and easy-to-use ML model, leveraging all the native features of BigQuery that we've already discussed in the <em class="italic">BigQuery's advantages over traditional data warehouses</em> section of this chapter.</li>
			</ul>
			<p>In the following diagram, you can see the life cycle of an ML model that uses BigQuery ML: </p>
			<div>
				<div id="_idContainer023" class="IMG---Figure">
					<img src="image/B16772_01_014.jpg" alt="Figure 1.14 – An ML model's development life cycle with BigQuery ML&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.14 – An ML model's development life cycle with BigQuery ML</p>
			<p>Now that we've learned the basics of BigQuery ML, let's take a look at the main benefits that it can bring.</p>
			<h2 id="_idParaDest-30"><a id="_idTextAnchor030"/>BigQuery ML benefits</h2>
			<p>BigQuery ML can bring both<a id="_idIndexMarker131"/> business and technical benefits during the life cycle of an ML model:</p>
			<ul>
				<li>Business users and data analysts can evolve from a traditional descriptive and reporting approach to a new predictive approach to take better decisions using their existing SQL skills. </li>
				<li>Technical users can benefit from the automation of BigQuery ML during the tuning phase of the model, using a unique, centralized tool that can accelerate the entire development process of an ML model.</li>
				<li>The development process is further sped up because the datasets required to build the ML model are already available to the right users and don't need to be moved from one data repository to another, which carries compliance and data duplication risks.</li>
				<li>The IT department does not need to manage the infrastructure to serve and use the ML model in a production environment because the BigQuery serverless architecture natively supports the model in a scalable, safe, and robust manner.</li>
			</ul>
			<p>After our analysis of the benefits that BigQuery ML can bring, let's now see what the supported ML algorithms are.</p>
			<h2 id="_idParaDest-31"><a id="_idTextAnchor031"/>BigQuery ML algorithms</h2>
			<p>The list of ML algorithms<a id="_idIndexMarker132"/> supported by BigQuery ML is growing quickly. Currently, the following supervised ML techniques are currently supported:</p>
			<ul>
				<li><strong class="bold">Linear regression</strong>: To forecast numerical values with a linear model</li>
				<li><strong class="bold">Binary logistic regression</strong>: For classification use cases when the choice is between only two different options (Yes or No, 1 or 0, True or False)</li>
				<li><strong class="bold">Multiclass logistic regression</strong>: For classification scenarios when the choice is between multiple options</li>
				<li><strong class="bold">Matrix factorization</strong>: For developing recommendation engines based on past information</li>
				<li><strong class="bold">Time series</strong>: To forecast business KPIs leveraging timeseries data from the past</li>
				<li><strong class="bold">Boosted tree</strong>: For classification and regression use cases with XGBoost</li>
				<li><strong class="bold">AutoML table</strong>: To leverage <a id="_idIndexMarker133"/>AutoML capabilities from the BigQuery SQL interface</li>
				<li><strong class="bold">Deep Neural Network</strong> (<strong class="bold">DNN</strong>): For developing TensorFlow models for classification or regression scenarios, avoiding any lines of code</li>
			</ul>
			<p>When the training dataset doesn't contain labeled data, the learning is defined as unsupervised. BigQuery ML currently supports the following:</p>
			<ul>
				<li><strong class="bold">K-means clustering</strong>: For data <a id="_idIndexMarker134"/>segmentation of similar objects (people, facts, events)</li>
			</ul>
			<p>In addition to what is listed, BigQuery ML allows you to import and use pre-trained TensorFlow models using SQL statements.</p>
			<h1 id="_idParaDest-32"><a id="_idTextAnchor032"/>Understanding BigQuery pricing</h1>
			<p>In this section, the pricing model for BigQuery and BigQuery ML is explained. Since the pricing of GCP services is ever-evolving, we suggest that you consult <a href="https://cloud.google.com/bigquery/pricing">https://cloud.google.com/bigquery/pricing</a> to get the latest updates. </p>
			<p>Let's look at the models for BigQuery.</p>
			<h2 id="_idParaDest-33"><a id="_idTextAnchor033"/>BigQuery pricing</h2>
			<p>BigQuery pricing is<a id="_idIndexMarker135"/> scalable according to the use of this technology. There are three main cost drivers:</p>
			<ul>
				<li><strong class="bold">Storage</strong>: Price <a id="_idIndexMarker136"/>calculated on the volumes of data stored in BigQuery.</li>
				<li><strong class="bold">Compute</strong>: Resources <a id="_idIndexMarker137"/>used to query, transform, and process the data or to train, evaluate, and use ML models.</li>
				<li><strong class="bold">Streaming</strong>: Price <a id="_idIndexMarker138"/>calculated on the number of records that are ingested through the BigQuery streaming API. </li>
			</ul>
			<h3>Storage </h3>
			<p>BigQuery storage <a id="_idIndexMarker139"/>costs are calculated based on the uncompressed size of your datasets. BigQuery offers two layers of storage:</p>
			<ul>
				<li><strong class="bold">Active</strong>: All data stored in tables that have been inserted or updated in the last 90 days is considered active. At the time of writing, active storage is charged at $20.00 per terabyte per month.</li>
				<li><strong class="bold">Long-term</strong>: All<a id="_idIndexMarker140"/> data stored in tables that have not been modified in the last 90 days is considered long-term storage. At the time of writing, long-term storage is charged at $10.00 per terabyte per month. The change to long-term storage is automatically applied by Google and does not require any action by the BigQuery user.<p class="callout-heading">Tip</p><p class="callout">Thanks to BigQuery long-term storage, it is no longer necessary to transfer archived data to Google Cloud Storage to save money. You can keep your data online and accessible at a very low cost.</p></li>
			</ul>
			<h3>Compute</h3>
			<p>BigQuery compute costs are calculated based on the volumes of data that are processed by the executed queries. The compute cost can vary according to the model that the customer has chosen:</p>
			<ul>
				<li><strong class="bold">On-demand</strong>: This<a id="_idIndexMarker141"/> is the default option. In this case, the user is charged only for the resources that are actually consumed.</li>
				<li><strong class="bold">Flat rate</strong>: This option can be enabled by users or companies that want to have a precise estimation of BigQuery costs and want to keep them stable over time. In this case, a reservation for a specific timeframe is needed and a fixed number of BigQuery slots are assigned to one or multiple GCP projects. As of October 2020, the minimum number of slots that can be reserved is 100 and the minimum time of commitment is 60 seconds. Currently, Google allows you to choose different flat rate options according to the actual requirements. This option can be enabled with a monthly, annual, or flex commitment. The flex option allows you to purchase BigQuery slots for short durations (a minimum of 60 seconds).<p class="callout-heading">Tip</p><p class="callout">Keep in mind that you're not charged to store BigQuery public datasets: you pay only to access and query them. For this reason, using BigQuery public datasets can be a cost-effective way to perform tests on BigQuery, paying only for compute and not for storage.</p></li>
			</ul>
			<h3>Streaming</h3>
			<p>Loading data into BigQuery is usually free, apart from the ingestion processes that happen through the BigQuery streaming<a id="_idIndexMarker142"/> API. As of October 2020, you will be charged $0.010 for every 200 MB ingested with this interface. Each row is treated as a minimum of 1 KB.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">If your use case doesn't require you to ingest data in real time, we suggest you use the bulk loading mechanism to ingest data into BigQuery, which is always free of charge. </p>
			<h2 id="_idParaDest-34"><a id="_idTextAnchor034"/>BigQuery ML pricing</h2>
			<p>The pricing model <a id="_idIndexMarker143"/>of BigQuery ML is similar to that for BigQuery compute costs. As we saw in the previous section, customers can choose between the following options:</p>
			<ul>
				<li>On-demand (pay-as-you-go) pricing model</li>
				<li>Flat rate pricing model</li>
			</ul>
			<p>If the customer has already chosen to activate flat rate mode with a fixed number of BigQuery slots available, BigQuery slots are also leveraged to train, evaluate, and run the BigQuery ML models.</p>
			<p>If the customer is using the on-demand pricing model, it is necessary to split the BigQuery ML algorithms into two different categories:</p>
			<ul>
				<li><strong class="bold">External models</strong>: This<a id="_idIndexMarker144"/> category includes boosted trees, DNNs, TensorFlow, and AutoML. These models are trained on other GCP services integrated with BigQuery and are charged differently.</li>
				<li><strong class="bold">Internal models</strong>: This <a id="_idIndexMarker145"/>category includes all the remaining algorithms mentioned before that are trained directly on BigQuery.</li>
			</ul>
			<p>At the time of writing, the pricing of internal models is based on the volumes of data processed during the main stages of the ML life cycle (training, evaluation, and prediction):</p>
			<div>
				<div id="_idContainer024" class="IMG---Figure">
					<img src="image/B16772_01_015.jpg" alt="Figure 1.15 – BigQuery ML pricing for internal ML models&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.15 – BigQuery ML pricing for internal ML models</p>
			<p>The pricing of external models is based on the cost of the external AI Platform resources used for the training of the model plus an additional BigQuery ML fee applied on top:</p>
			<div>
				<div id="_idContainer025" class="IMG---Figure">
					<img src="image/B16772_01_016.jpg" alt="Figure 1.16 – BigQuery ML pricing for external ML models&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.16 – BigQuery ML pricing for external ML models</p>
			<p>Prices are always <a id="_idIndexMarker146"/>under review and subject to change on GCP. For this reason, we suggest consulting <a href="https://cloud.google.com/bigquery-ml/pricing">https://cloud.google.com/bigquery-ml/pricing</a>.</p>
			<h2 id="_idParaDest-35"><a id="_idTextAnchor035"/>Free operations and free tiers</h2>
			<p>BigQuery offers a wide variety of operations free of charge, as well as free tiers to experiment with this technology at no cost.</p>
			<p>The following operations<a id="_idIndexMarker147"/> are always free in BigQuery:</p>
			<ul>
				<li>Loading data</li>
				<li>Copying data (apart from the additional storage requested for the copy)</li>
				<li>Exporting data </li>
				<li>Deleting datasets, tables, views, partitions, or functions</li>
				<li>Any metadata operations</li>
				<li>Reading metadata tables and columns</li>
				<li>Creating or replacing <strong class="bold">User-Defined Functions</strong> (<strong class="bold">UDFs</strong>)</li>
			</ul>
			<p>To encourage <a id="_idIndexMarker148"/>experimentation with BigQuery, every month a user has the ability to leverage a free budget of operations under a certain threshold, as seen in the following table:</p>
			<div>
				<div id="_idContainer026" class="IMG---Figure">
					<img src="image/B16772_01_017.jpg" alt="Figure 1.17 –  BigQuery ML free tiers&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.17 –  BigQuery ML free tiers</p>
			<p>Now that we've seen the BigQuery free tiers that we can use, let's take a look at the pricing calculator.</p>
			<h2 id="_idParaDest-36"><a id="_idTextAnchor036"/>Pricing calculator</h2>
			<p>If you want to have a good <a id="_idIndexMarker149"/>estimation of the cost of using BigQuery with on-demand pricing, you can use the Google Cloud pricing calculator: <a href="https://cloud.google.com/products/calculator">https://cloud.google.com/products/calculator</a>. The following screenshot shows the monthly cost of storing, ingesting through streaming, and processing the following data volumes:</p>
			<ul>
				<li>Uncompressed storage volume: 10 TB</li>
				<li>Volume of streaming inserts: 1 GB</li>
				<li>Data processed by queries: 150 TB:</li>
			</ul>
			<div>
				<div id="_idContainer027" class="IMG---Figure">
					<img src="image/B16772_01_018.jpg" alt="Figure 1.18 – BigQuery pricing calculator&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.18 – BigQuery pricing calculator</p>
			<p>You can use the <a id="_idIndexMarker150"/>pricing calculator to estimate the consumption of all the other GCP services to get a better understanding of your GCP costs.</p>
			<h1 id="_idParaDest-37"><a id="_idTextAnchor037"/>Summary</h1>
			<p>Throughout this first chapter, we've taken the first steps into learning what GCP offers, how it is different from other public cloud providers, and how Google is building on its ubiquitous applications such as Gmail and Google Maps to provide great services to companies via GCP.</p>
			<p>We've also discovered that Google's proven experience in AI and ML, developed through the making of products such as Google Photos, also forms part of the services of GCP. Each AI and ML service can address various use cases and different types of users according to their skills and background. For example, most technical users, such as data scientists, can leverage TensorFlow to have great flexibility and control over their developed ML models, while business users can use Google's solutions to solve specific challenges with Document AI and Contact Center AI. The intermediate category is composed of AI and ML building blocks; these services can accelerate the development of new ML use cases or spread the usage of innovative techniques through a company. </p>
			<p>One of these building blocks is BigQuery: its extension, BigQueryML, enables the development of ML models by leveraging existing SQL skills. The use of BigQuery ML can bring great benefits to companies that want to democratize ML, enabling a large segment of employees to participate by simplifying the heaviest and most time-consuming activities that usually require the involvement of different stakeholders, skills, and tools.</p>
			<p>In the next chapter, we will get hands-on by creating a new Google Cloud project and accessing BigQuery for the first time.</p>
			<h1 id="_idParaDest-38"><a id="_idTextAnchor038"/>Further resources</h1>
			<ul>
				<li><strong class="bold">Google Cloud products</strong>: <a href="https://cloud.google.com/products/">https://cloud.google.com/products/</a> </li>
				<li><strong class="bold">GCP overview</strong>: <a href="https://cloud.google.com/docs/overview">https://cloud.google.com/docs/overview</a> </li>
				<li><strong class="bold">Why GCP is different</strong>: <a href="https://cloud.google.com/free/docs/what-makes-google-cloud-platform-different">https://cloud.google.com/free/docs/what-makes-google-cloud-platform-different</a></li>
				<li><strong class="bold">Google regions and locations</strong>: <a href="https://cloud.google.com/about/locations">https://cloud.google.com/about/locations</a></li>
				<li><strong class="bold">Google's sustainability program</strong>: <a href="https://sustainability.google/commitments/">https://sustainability.google/commitments/</a></li>
				<li><strong class="bold">AI Hub</strong>: <a href="https://aihub.cloud.google.com/?hl=en">https://aihub.cloud.google.com/?hl=en</a></li>
				<li><strong class="bold">Cloud Talent Solution</strong>: <a href="https://cloud.google.com/solutions/talent-solution?hl=en">https://cloud.google.com/solutions/talent-solution?hl=en</a></li>
				<li><strong class="bold">BigQuery technical architecture</strong>:<strong class="bold"> </strong><a href="https://cloud.google.com/files/BigQueryTechnicalWP.pdf">https://cloud.google.com/files/BigQueryTechnicalWP.pdf</a> </li>
				<li><strong class="bold">BigQuery interfaces</strong>: <a href="https://cloud.google.com/bigquery/docs/interacting-with-bigquery">https://cloud.google.com/bigquery/docs/interacting-with-bigquery</a></li>
				<li><strong class="bold">BigQuery ML</strong>: <a href="https://cloud.google.com/bigquery-ml/docs">https://cloud.google.com/bigquery-ml/docs</a> </li>
			</ul>
		</div>
	</body></html>
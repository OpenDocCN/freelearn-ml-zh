- en: Introduction to R and SQL Server
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: R 和 SQL Server 简介
- en: SQL Server 2016 came with great new features, and among them was R integration
    into SQL Server, partly with advanced analytics and partly with new programmability
    capabilities. Microsoft R Services for SQL Server is part of the family of new
    extensibilities for highly scalable and parallel advanced analytics. R Services
    allows you to perform advanced analytics (statistical, multivariate statistics,
    predictive analytics, machine learning, and deep learning) on large quantities
    of data stored in the database. Microsoft published R Services as part of **Microsoft
    R Server** (**MRS**), which was specially designed for reading data directly from
    the SQL Server database within the same SQL Server computational context.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: SQL Server 2016 带来了许多新功能，其中之一是将 R 集成到 SQL Server 中，部分是为了高级分析，部分是为了新的可编程能力。Microsoft
    R Services for SQL Server 是新扩展性家族的一部分，旨在实现高度可扩展和并行的高级分析。R Services 允许您在数据库中存储的大量数据上执行高级分析（统计、多元统计、预测分析、机器学习和深度学习）。Microsoft
    将 R Services 作为**Microsoft R Server**（**MRS**）的一部分发布，该服务器专门设计用于在相同的 SQL Server
    计算环境中直接从 SQL Server 数据库读取数据。
- en: 'We will cover the following aspects in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下方面：
- en: Using R prior to SQL Server 2016
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 SQL Server 2016 之前使用 R
- en: Microsoft's commitment on open source R language
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 微软对开源 R 语言的承诺
- en: Boosting analytics with SQL Server R integration
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用 SQL Server R 集成增强分析
- en: Outline of the book
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本书概要
- en: Using R prior to SQL Server 2016
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 SQL Server 2016 之前使用 R
- en: The R language has been in the community since the 90's (even though it was
    developed a decade before). With its open source GNU license, R gained popularity
    for its no-fuss installation and ability to evoke any available package for additional
    statistical learning functions. This was a clear advantage to R as there were
    not that many statistical programs available on the market in the '80s and '90s;
    in addition, most of them were not free. The extensibility with emerging new packages
    for the core R engine gave a broader community and users more and more abilities
    to use the R language for multiple purposes, in addition to its strong statistical
    analysis and predictive modeling capabilities.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: R 语言自 90 年代以来就在社区中（尽管它是在十年前开发的）。凭借其开源 GNU 许可证，R 因其无需麻烦的安装和能够调用任何可用的包以提供额外的统计学习功能而受到欢迎。这对于
    R 来说是一个明显的优势，因为在 80 年代和 90 年代，市场上可用的统计程序并不多；此外，大多数都不是免费的。与核心 R 引擎的新包的扩展性为更广泛的社区和用户提供了更多使用
    R 语言的多用途能力，除了其强大的统计分析能力和预测建模能力。
- en: SQL Server 2005 introduced **SQL Server Analysis Services** (**SSAS**) data
    mining features to be applied against the customer's existing rich data stored
    in SQL Server and SSAS OLAP cubes. This feature allows users to use **Data Mining
    eXpression** (**DMX**) for creating predictive queries. In the next couple of
    years, several questions, requests, and ideas emerged on SQL forums, blogs, and
    community websites regarding additional statistical and predictive methods and
    approaches.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: SQL Server 2005 引入了**SQL Server Analysis Services**（**SSAS**）数据挖掘功能，以便应用于存储在
    SQL Server 和 SSAS OLAP 立方体中的客户现有丰富数据。此功能允许用户使用**数据挖掘表达式**（**DMX**）来创建预测查询。在接下来的几年里，在
    SQL 论坛、博客和社区网站上出现了许多关于额外统计和预测方法和方法的疑问、请求和想法。
- en: Back in 2011, I started working on the idea of extending the capabilities of
    statistical analysis in SQL Server 2008 R2 with the help of open source R language.
    One reason for that decision was to have flexibility of running statistical analysis
    (from data provisioning to multivariate analysis) without feeding the data into
    OLAP cube first, and another reason was more business orientated, with the need
    to get faster, statistical insights from all the people involved in data preparing,
    data munging, and data cleaning.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 回到 2011 年，我开始着手扩展 SQL Server 2008 R2 中统计分析功能的想法，这得益于开源 R 语言。做出这一决定的一个原因是希望能够灵活地运行统计分析（从数据提供到多元分析），而无需首先将数据输入到
    OLAP 立方体中，另一个原因是更偏向于商业，需要从所有参与数据准备、数据整理和数据清洗的人员那里获得更快、更深入的统计洞察。
- en: 'I kicked in and started working on a framework that was based on a combination
    of T-SQL stored procedure and R package RODBC ([https://cran.r-project.org/web/packages/RODBC](https://cran.r-project.org/web/packages/RODBC)).
    The idea was simple; get the transactional or OLAP data, select the columns you
    want to perform analysis against, and the analysis itself (from simple to predictive
    analytics, which would stretch beyond SSAS, T-SQL, or CLR capabilities):'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我开始着手构建一个基于T-SQL存储过程和R包RODBC（[https://cran.r-project.org/web/packages/RODBC](https://cran.r-project.org/web/packages/RODBC)）的框架。这个想法很简单；获取事务或OLAP数据，选择你想要进行分析的列，以及分析本身（从简单的预测分析到超越SSAS、T-SQL或CLR能力的分析）：
- en: '![](img/00005.gif)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/00005.gif)'
- en: 'Figure 1: Process flow of a framework'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 图1：框架的处理流程
- en: The framework was far from simple, and calling the procedure considered calling
    a mixture of R code, T-SQL select statements, and configurations to your R engine.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 这个框架远非简单，调用该过程相当于调用R代码、T-SQL选择语句和配置R引擎的混合体。
- en: 'The stored procedure with all its parameters looked like this:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 包含所有参数的存储过程看起来是这样的：
- en: '[PRE0]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The nuts and bolts explanation is outside the scope of this book and is well-documented
    at: [http://www.sqlservercentral.com/articles/R+Language/106760/](http://www.sqlservercentral.com/articles/R+Language/106760/).'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个框架的“螺丝和螺母”解释超出了本书的范围，并且已在[http://www.sqlservercentral.com/articles/R+Language/106760/](http://www.sqlservercentral.com/articles/R+Language/106760/)上进行了很好的记录。
- en: Looking back on this framework and the feedback from the community and people
    on forums, it was accepted positively and many commented that they needed something
    similar for their daily business.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 回顾这个框架以及社区和论坛上人们的反馈，它得到了积极的接受，许多人评论说他们需要类似的东西来处理日常业务。
- en: 'The framework in general had, besides pioneering the idea and bringing R engine
    one step closer to SQL Server, many flaws. The major one was security. Because
    it needed access to a working local directory for generating R files to be run
    by the vanilla R engine, it needed `xp_cmdshell` enabled. The following reconfiguration
    was mandatory and many sysadmins would not approve of it:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 总体而言，这个框架除了开创性的想法和将R引擎更近一步地引入SQL Server之外，还有很多缺陷。最主要的是安全问题。因为它需要访问一个工作本地目录来生成由vanilla
    R引擎运行的R文件，所以它需要启用`xp_cmdshell`。以下重新配置是强制性的，许多系统管理员可能不会同意：
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In addition, the framework needed to have access to R engine installation, together
    with R packages to execute the desired code. Installing open source programs and
    providing read/write access was again a drawback in terms of security and corporate
    software decisions. Nevertheless, one of the bigger issues—later when everything
    was installed and put into production—was performance and memory issues. R is
    memory-based, meaning all the computations are done in the memory. So, if your
    dataset is bigger than the size of the available memory, the only result you will
    get will be error messages. Another aspect of performance issues was also the
    speed. With no parallel and distributive computations, the framework was bound
    to dexterity of an author of the package. For example, if the package was written
    in C or C++, rather than in Fortran, the framework performed better, respectively.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，框架需要访问R引擎安装，以及执行所需代码的R包。安装开源程序并提供读写访问在安全性和企业软件决策方面又是一个缺点。尽管如此，更大的问题之一——在所有东西都安装并投入生产后——是性能和内存问题。R是基于内存的，这意味着所有的计算都是在内存中完成的。所以，如果你的数据集大小超过了可用内存的大小，你将得到的唯一结果将是错误信息。性能问题的另一个方面也是速度。由于没有并行和分布式计算，框架的性能取决于包作者的灵活性。例如，如果包是用C或C++编写的，而不是Fortran，那么框架的性能会更好。
- en: The great part of this framework was the ability to deliver results from statistical
    analysis or predictive modeling much faster, because it could take OLTP or any
    other data that needed statistical analysis. Furthermore, statisticians and data
    scientists could prepare the R code that was stored in the table, which was later
    run by data wranglers, data analysts, or data stewards. Therefore, one version
    of truth is maintained, because there was no need for data movement or data copying
    and all users were reading the same data source. In terms of predictive modeling,
    the framework also enabled users to take advantage of various additional predictive
    algorithms (for example, decision forest, glm, CNN, SVM, and word cloud) that
    were not part of SSAS Data Mining at that time.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 这个框架的亮点在于能够更快地提供统计分析或预测建模的结果，因为它可以处理需要统计分析的 OLTP 或任何其他数据。此外，统计学家和数据科学家可以准备存储在表中的
    R 代码，这些代码随后由数据整理者、数据分析师或数据管理员运行。因此，可以保持一个版本的真相，因为没有必要移动或复制数据，所有用户都在读取相同的数据源。在预测建模方面，该框架还使用户能够利用各种额外的预测算法（例如，决策森林、glm、CNN、SVM
    和词云）的优势，这些算法当时并不属于 SSAS 数据挖掘。
- en: Besides the pros and cons, the framework was a successful initial attempt to
    get more data insights that were easily distributable among different business
    units through pushing visualizations in SQL Server Reporting Services. In the
    years prior to the release of SQL Server 2016, I had met people from the SQL Server
    community that developed similar frameworks, in order to push predictions to the
    SQL Server database to support business applications and solutions. With SQL Server
    2016, many such similar solutions were internalized and brought closer to the
    SQL Server engine to achieve better performance and to address many of the issues
    and cons.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 除了优点和缺点之外，该框架是成功尝试获取更多易于在不同业务单元之间分发的数据洞察的初步尝试，通过在 SQL Server 报告服务中推送可视化。在 SQL
    Server 2016 发布之前的那几年里，我遇到了来自 SQL Server 社区的开发类似框架的人，目的是将预测推送到 SQL Server 数据库以支持业务应用和解决方案。随着
    SQL Server 2016 的推出，许多类似的解决方案被内部化，并更接近 SQL Server 引擎以实现更好的性能，并解决许多问题和缺点。
- en: Microsoft's commitment to the open source R language
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 微软对开源 R 语言的承诺
- en: With a growing popularity and community, R has become and continues to be a
    big player in the field of advanced analytics and data visualization. R and machine
    learning servers (or services) are not just buzzword that will be forgotten in
    the next cycle of SQL Server, but it is infiltrating more and more into different
    layers of open source and corporate software. In the past five years, many big
    analytical players have introduced R integration, interpreters, and wrappers for
    the R language, because of the language's practicality, usability, and inter-disciplinarily
    and open source orientation. As Microsoft's making a bold and strategic move toward
    being open source friendly, the use cases for integrating R in SQL Server are
    growing, making this move even more natural and at the right point in time. This
    move had been very well appreciated in the SQL community and the business as well.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 随着其日益增长的受欢迎程度和社区规模，R 已经成为并在继续成为高级分析和数据可视化领域的重要参与者。R 和机器学习服务器（或服务）不仅仅是下一个 SQL
    Server 周期中会被遗忘的流行语，它们正在越来越多地渗透到开源和公司软件的不同层次。在过去五年中，许多大型分析公司都引入了 R 集成、解释器和 R 语言的包装，因为这种语言的实用性、可用性以及跨学科和开源导向。随着微软大胆且战略性地向开源友好型转变，将
    R 集成到 SQL Server 中的用例正在增长，这使得这一举措更加自然，并且是在正确的时间点。这一举措在 SQL 社区和商业界都受到了高度赞赏。
- en: In comparison to other big analytical tools, Microsoft took integration very
    seriously. It addressed many of the issues and limitations of the language itself,
    and created complete integration of R with the SQL Server in order to give the
    best user experience. Many competitors (such as SAS, IBM, SAP, and Oracle) have
    done similar integration, but failed to take into account many aspects that contribute
    to a holistic user experience. Microsoft has announced that joining the R consortium
    will give them the ability to help the development of the R language and to support
    future development.  In addition, Microsoft has created its own package repository
    called MRAN (from CRAN, where M stands for Microsoft) and is giving support and
    SLA agreement for R as well, even though the language and engine is based on Open
    R (a free, open-sourced version). All these steps tell us how dedicated Microsoft
    is in bringing an open source, statistical and programming language into the SQL
    Server environment.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 与其他大型分析工具相比，微软对集成非常重视。它解决了语言本身的许多问题和限制，并创建了 R 与 SQL Server 的完整集成，以提供最佳的用户体验。许多竞争对手（如
    SAS、IBM、SAP 和 Oracle）已经进行了类似的集成，但未能考虑到许多对整体用户体验有贡献的方面。微软宣布加入 R 联盟将使他们能够帮助 R 语言的开发并支持未来的发展。此外，微软还创建了自己的软件包仓库，称为
    MRAN（来自 CRAN，其中 M 代表微软），并为 R 提供支持和 SLA 协议，尽管语言和引擎基于 Open R（一个免费、开源的版本）。所有这些步骤都告诉我们微软在将开源、统计和编程语言引入
    SQL Server 环境中的承诺。
- en: We can only expect more R integration into other services. For example, Power
    BI supports native R visuals ([https://powerbi.microsoft.com/en-us/blog/r-powered-custom-visuals](https://powerbi.microsoft.com/en-us/blog/r-powered-custom-visuals))
    since October 2016, and R language since December 2015\. Therefore, I am a strong
    believer that R will soon be part of the whole SQL Server ecosystem such as SSAS,
    SSIS, and SSRS natively as well. With Azure Analysis Services, R is again one
    step closer to analysis services.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只能期待 R 集成将更多地融入其他服务。例如，Power BI 自 2016 年 10 月起支持原生 R 可视化（[https://powerbi.microsoft.com/en-us/blog/r-powered-custom-visuals](https://powerbi.microsoft.com/en-us/blog/r-powered-custom-visuals)），自
    2015 年 12 月起支持 R 语言。因此，我坚信 R 将很快成为整个 SQL Server 生态系统（如 SSAS、SSIS 和 SSRS）的组成部分，并且以原生方式集成。随着
    Azure Analysis Services 的推出，R 又向分析服务迈进了一步。
- en: Boosting analytics with SQL Server R integration
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 利用 SQL Server R 集成增强分析
- en: Data science is in the forefront of the SQL Server and R integration. Every
    task performed by DBA, sysadmin, the analyst, wrangler, or any other role that
    is working with SQL server can have these tasks supported with any kind of statistics,
    data correlation, data analysis, or data prediction. R integration should not
    be restricted only to the fields of data science. Instead, it should be explored
    and used in all tasks. DBA can gain from R integration by using switching from
    monitoring tasks to understanding and predicting what might or will happen next.
    Likewise, this idea can be applied to sysadmin, data wranglers, and so on. R integration
    also brings different roles of people closer to understand statistics, metrics,
    measures, and learn how to improve them by using statistical analysis and predictions.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 数据科学是 SQL Server 和 R 集成的最前沿。DBA、系统管理员、分析师、数据整理员或任何其他与 SQL Server 一起工作的角色执行的任务都可以通过任何类型的统计、数据相关性、数据分析或数据预测得到支持。R
    集成不应仅限于数据科学领域。相反，它应该在所有任务中探索和使用。DBA 可以通过从监控任务切换到理解和预测可能或将要发生的事情来从 R 集成中受益。同样，这个想法可以应用到系统管理员、数据整理员等等。R
    集成还使不同角色的个人更接近理解统计、指标、度量，并学习如何通过统计分析预测来改进它们。
- en: Besides bringing siloed individual teamwork into more coherent and cohesive
    teams, R integration also brings less data movement, because different users can
    now—with the help of R code—execute, drill down, and feel the data, instead of
    waiting to have data first prepared, exported, and imported again. With smoother
    workflows comes faster time to deployment, whether it is a simple report, a predictive
    model, or analysis. This allows the boundaries of data ownership to shift into
    insights ownership, which is a positive aspect of faster reactions to business
    needs.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 除了将孤立的个体团队合作转变为更加协调和紧密的团队之外，R 集成还减少了数据移动，因为现在不同的用户可以在 R 代码的帮助下执行、深入挖掘并感受数据，而不是等待首先准备、导出和再次导入数据。随着工作流程的更加顺畅，部署时间也更快，无论是简单的报告、预测模型还是分析。这使得数据所有权的边界转移到洞察力所有权，这是对业务需求更快反应的积极方面。
- en: In the past year, we have also seen much more interest in data science in Microsoft
    stack. With R integration, Azure Machine Learning, and Power BI, all users who
    want to learn new skills and virtues have great starting points from the available
    products.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在过去的一年里，我们也看到了对微软数据科学栈中数据科学的高度兴趣。随着R的集成、Azure机器学习和Power BI，所有想要学习新技能和美德的用户都有很多起点，可以从现有的产品中选择。
- en: Summary
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Starting with SQL Server 2016, R integration became a very important part of
    the SQL Server platform. Since the public release of SQL server 2016, until February
    2018 (the time of writing this), the community had embraced R as well as Python
    very well, making data exploration and data analysis part of the general database
    task. Microsoft addressed many of the issues, and broadened the SQL Server as
    a product.  With SQL Server 2017, Python was added as a secondary analytical language,
    reaching to an even broader community as well as businesses, and at the same time,
    taking are of data scalability, performance, and security.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 从SQL Server 2016开始，R的集成成为了SQL Server平台的一个重要部分。自从SQL Server 2016公开发布以来，直到2018年2月（撰写本文时），社区已经很好地接纳了R和Python，使数据探索和数据分析成为一般数据库任务的一部分。微软解决了许多问题，并扩大了SQL
    Server作为产品的范围。在SQL Server 2017中，Python被添加为次要分析语言，使更多的社区和企业受益，同时，也关注数据的可扩展性、性能和安全。
- en: In the next chapter, we will cover different R distributions and IDE tools for
    using R as a standalone or within the SQL Server, and what the differences among
    them are when deciding which one to choose.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍不同的R发行版和IDE工具，用于将R作为独立工具或SQL Server内部使用，以及在选择时它们之间的区别。

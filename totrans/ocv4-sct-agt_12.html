<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Making WxUtils.py Compatible with Raspberry Pi</h1>
                </header>
            
            <article>
                
<p>In <a href="4ec4e82a-b63d-4fc1-bf3b-47c653c25a79.xhtml">Chapter 2</a><em>, Searching for Luxury Accommodations Worldwide</em>, we wrote a file, <span><kbd>WxUtils.py</kbd>,</span> that contains a utility function, <kbd>wxBitmapFromCvImage</kbd>, to convert OpenCV images to wxPython bitmaps. We used this utility function in our Python projects throughout this book.</p>
<p><span>Our implementation of <kbd>wxBitmapFromCvImage</kbd> relied in part on wxPython's <kbd>wx.BitmapFromBuffer</kbd> function. On some versions of Raspberry Pi and Raspbian,</span><span> </span><kbd>wx.BitmapFromBuffer</kbd><span> </span><span>suffers from a platform-specific bug that causes it to fail. As a workaround, we can do a less efficient, two-step conversion using the</span> <kbd>wx.ImageFromBuffer</kbd><span> </span><span>and</span><span> </span><kbd>wx.BitmapFromImage</kbd><span> functions. Here is some code to check whether we are running on an early model of Raspbperry Pi (based on the CPU model) and to implement our</span><span> </span><kbd>wxBitmapFromCVImage</kbd><span> </span><span>function appropriately:</span></p>
<pre class="mce-root">import numpy # Hint to PyInstaller<br/>import cv2<br/>import wx<br/><br/><br/>WX_MAJOR_VERSION = int(wx.__version__.split('.')[0])<br/><br/># Try to determine whether we are on Raspberry Pi.<br/>IS_RASPBERRY_PI = False<br/>try:<br/>    with open('/proc/cpuinfo') as f:<br/>        for line in f:<br/>            line = line.strip()<br/>            if line.startswith('Hardware') and \<br/>                    line.endswith('BCM2708'):<br/>                IS_RASPBERRY_PI = True<br/>                break<br/>except:<br/>    pass<br/><br/>if IS_RASPBERRY_PI:<br/>    def wxBitmapFromCvImage(image):<br/>        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)<br/>        h, w = image.shape[:2]<br/>        wxImage = wx.ImageFromBuffer(w, h, image)<br/>        if WX_MAJOR_VERSION &lt; 4:<br/>            bitmap = wx.BitmapFromImage(wxImage)<br/>        else:<br/>            bitmap = wx.Bitmap(wxImage)<br/>        return bitmap<br/>else:<br/>    def wxBitmapFromCvImage(image):<br/>        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)<br/>        h, w = image.shape[:2]<br/>        # The following conversion fails on Raspberry Pi.<br/>        if WX_MAJOR_VERSION &lt; 4:<br/>            bitmap = wx.BitmapFromBuffer(w, h, image)<br/>        else:<br/>            bitmap = wx.Bitmap.FromBuffer(w, h, image)<br/>        return bitmap<br/><br/></pre>
<p>If you replace the contents of <span><kbd>WxUtils.py</kbd> with the code shown previously, our <kbd>wxBitmapFromCvImage</kbd> utility function will work on Raspberry Pi, as well as other systems. </span></p>


            </article>

            
        </section>
    </body></html>
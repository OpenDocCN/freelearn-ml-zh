- en: '15'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '15'
- en: Correlation versus Causality
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 相关性与因果性
- en: In previous chapters of this book, you learned how to train, evaluate, and build
    high-performance and low-bias machine learning models. However, the algorithms
    and example methods we used to practice the concepts that were introduced in this
    book do not necessarily provide you with a causal relationship between features
    and output variables in a supervised learning setting. In this chapter, we will
    discuss how causal inference and modeling could help you increase the reliability
    of your models in production.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的前几章中，你学习了如何训练、评估和构建高性能和低偏差的机器学习模型。然而，我们用来练习本书中引入的概念的算法和示例方法并不一定能在监督学习设置中为你提供特征和输出变量之间的因果关系。在本章中，我们将讨论因果推理和建模如何帮助你提高模型在生产中的可靠性。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Correlation as part of machine learning models
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 相关性作为机器学习模型的一部分
- en: Causal modeling to reduce risks and improve performance
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 因果建模以降低风险和提高性能
- en: Assessing causation in machine learning models
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在机器学习模型中评估因果关系
- en: Causal modeling using Python
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Python进行因果建模
- en: By the end of this chapter, you will have learned about the benefits of causal
    modeling and inference compared to correlative modeling and practice with available
    Python functionalities to identify the causal relationship between features and
    output variables.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，你将了解因果建模和推理相对于相关性建模和练习可用Python功能来识别特征和输出变量之间因果关系的益处。
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'You need the following for this chapter as they will help you better understand
    the concepts, use them in your projects, and practice with the provided code:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解概念、在项目中使用它们以及使用提供的代码进行练习，你需要以下内容：
- en: 'Python library requirements:'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python库需求：
- en: '`dowhy` == 0.5.1'
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dowhy` == 0.5.1'
- en: '`bnlearn` == 0.7.16'
  id: totrans-13
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bnlearn` == 0.7.16'
- en: '`sklearn` >= 1.2.2'
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sklearn` >= 1.2.2'
- en: '`d3blocks` == 1.3.0'
  id: totrans-15
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`d3blocks` == 1.3.0'
- en: You will also require basic knowledge of machine learning model training, validation,
    and testing
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你还需要了解机器学习模型训练、验证和测试的基本知识
- en: The code files for this chapter are available on GitHub at [https://github.com/PacktPublishing/Debugging-Machine-Learning-Models-with-Python/tree/main/Chapter15](https://github.com/PacktPublishing/Debugging-Machine-Learning-Models-with-Python/tree/main/Chapter15).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的代码文件可在GitHub上找到，地址为[https://github.com/PacktPublishing/Debugging-Machine-Learning-Models-with-Python/tree/main/Chapter15](https://github.com/PacktPublishing/Debugging-Machine-Learning-Models-with-Python/tree/main/Chapter15)。
- en: Correlation as part of machine learning models
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 相关性作为机器学习模型的一部分
- en: The majority of machine learning modeling and data analysis projects result
    in correlative relationships between features and output variables in supervised
    learning settings and statistical modeling. Although these relationships are not
    causal, identifying causal relationships is of high value, even if it’s not a
    necessity in most problems we try to solve. For example, we can define medical
    diagnosis as “*The identification of the diseases that are most likely to be causing
    the patient’s symptoms, given their medical history.*” (Richens et al., 2020).
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数机器学习建模和数据分析项目在监督学习设置和统计建模中导致特征和输出变量之间的相关性关系。尽管这些关系不是因果的，但识别因果关系具有很高的价值，即使在我们试图解决的多数问题中它不是必需的。例如，我们可以将医学诊断定义为“*根据患者的医疗历史，识别最有可能导致患者症状的疾病*”（Richens等人，2020年）。
- en: 'Identifying causal relationships resolves issues in identifying misleading
    relationships between variables. Relying solely on correlations rather than causality
    could result in spurious and bizarre associations such as the following ([https://www.tylervigen.com/spurious-correlations](https://www.tylervigen.com/spurious-correlations);
    [https://www.buzzfeednews.com/article/kjh2110/the-10-most-bizarre-correlations](https://www.buzzfeednews.com/article/kjh2110/the-10-most-bizarre-correlations)):'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 识别因果关系解决在识别变量之间误导性关系时的问题。仅仅依赖相关性而不是因果关系可能会导致虚假和奇怪的关联，如下所示（[https://www.tylervigen.com/spurious-correlations](https://www.tylervigen.com/spurious-correlations)；[https://www.buzzfeednews.com/article/kjh2110/the-10-most-bizarre-correlations](https://www.buzzfeednews.com/article/kjh2110/the-10-most-bizarre-correlations)）：
- en: US spending on science, space, and technology correlates with suicides by hanging,
    strangulation, and suffocation
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 美国在科学、太空和技术上的支出与吊死、勒死和窒息自杀相关
- en: Total revenue generated by arcades correlates with computer science doctorates
    awarded in the US
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 美国电子游戏产生的总收入与在美国授予的计算机科学博士学位相关
- en: US crude oil imports from Norway correlates with drivers killed in collisions
    with railway trains
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 美国从挪威进口的原油与在铁路列车碰撞中丧生的驾驶员相关
- en: Eating organic food correlates with autism
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 吃有机食品与自闭症相关
- en: Obesity correlates with the debt bubble
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 肥胖与债务泡沫相关
- en: You can find more of these spurious correlations in the sources for these examples.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在这些例子的来源中找到更多这些虚假的相关性。
- en: Relying on correlations versus causation could decrease the reliability of different
    aspects of technology development and improvement processes such as AB testing.
    For example, understanding “if we get more visitors to search, we’ll see an increase
    in purchases and revenue” ([https://conversionsciences.com/correlation-causation-impact-ab-testing/](https://conversionsciences.com/correlation-causation-impact-ab-testing/))
    helps in proper decision-making and investment in technology development.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 依赖于相关性而非因果关系可能会降低技术发展和改进过程中不同方面的可靠性，例如A/B测试。例如，理解“如果我们能让更多的访客进行搜索，我们将看到购买和收入的增加”([https://conversionsciences.com/correlation-causation-impact-ab-testing/](https://conversionsciences.com/correlation-causation-impact-ab-testing/))有助于正确的决策和对技术发展的投资。
- en: Now that you understand the problems with relying solely on correlative relationships,
    let’s discuss what causal modeling means in a machine learning setting.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经了解了仅仅依赖相关关系的问题，让我们来讨论在机器学习环境中因果建模的含义。
- en: Causal modeling to reduce risks and improve performance
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 因果建模以降低风险和提高性能
- en: Causal modeling helps in eliminating unreliable correlative relationships between
    variables. Eliminating such unreliable relationships reduces the risks of wrong
    decision-making across different domains of applications for machine learning,
    such as healthcare. Decisions in healthcare, such as diagnosing diseases and assigning
    effective treatment regimens to patients, have a direct effect on quality of life
    and survival. Hence, decisions need to be based on reliable models and relationships
    in which causal modeling and inference could help us (Richens et al., 2020; Prosperi
    et al., 2020; Sanchez et al., 2022).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 因果建模有助于消除变量之间不可靠的相关关系。消除这种不可靠的关系可以降低机器学习在不同应用领域（如医疗保健）中错误决策的风险。医疗保健中的决策，如诊断疾病和为患者指定有效的治疗方案，对生活质量及生存有直接影响。因此，决策需要基于可靠的模型和关系，其中因果建模和推理可以帮助我们（Richens
    et al., 2020; Prosperi et al., 2020; Sanchez et al., 2022）。
- en: 'Causal modeling techniques help in eliminating bias, such as confounding and
    collider bias, in our models (Prosperi et al., 2020) (*Figure 15**.1*). An example
    of such bias is smoking as a confounder of the relationship between yellow fingers
    and lung cancer (Prosperi et al., 2020). As shown in *Figure 15**.1*, the existence
    of collider variables results in correlative, but biased and unreal, associations
    between some of the input variables and outcome. Also, not having some of the
    variables that could be confounding in our modeling could result in us concluding
    other variables are associated with the outcome:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 因果建模技术有助于消除模型中的偏差，如混淆和碰撞偏差（Prosperi et al., 2020）(*图15*.1)。这种偏差的一个例子是吸烟作为黄手指与肺癌之间关系的混淆因素（Prosperi
    et al., 2020）。如图*图15*.1所示，碰撞变量的存在导致某些输入变量与结果之间存在相关但偏差和虚假的关联。此外，在建模中缺少可能造成混淆的一些变量可能导致我们得出其他变量与结果相关的结论：
- en: "![Figure 15.1 – Schematic representation of confounding and collider bi\uFEFF\
    as](img/B16369_15_01.jpg)"
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![图15.1 – 混淆和碰撞偏差的示意图](img/B16369_15_01.jpg)'
- en: Figure 15.1 – Schematic representation of confounding and collider bias
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.1 – 混淆和碰撞偏差的示意图
- en: Next, we will mention some concepts and techniques in causal modeling such as
    causal inference and how to test causation in a machine learning model.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将介绍因果建模中的一些概念和技术，例如因果推理以及如何在机器学习模型中测试因果关系。
- en: Assessing causation in machine learning models
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估机器学习模型中的因果关系
- en: 'Calculating the correlation between features and outcomes in machine learning
    modeling has been a common approach in many fields and industries. For example,
    we can simply calculate the Pearson correlation coefficient to identify correlative
    features with the target variable. There are also features in many of our machine
    learning models that contribute to the prediction of outcomes not as causal but
    rather as correlative predictors. There are several ways to differentiate between
    such correlative and causal features with the available functionalities in Python.
    Here are a few examples:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在机器学习建模中计算特征与结果之间的相关性在许多领域和行业中已经成为一种常见的方法。例如，我们可以简单地计算皮尔逊相关系数来识别与目标变量相关的特征。在我们的许多机器学习模型中，也有一些特征对结果的预测不是作为因果因素，而是作为相关预测因素。我们可以使用Python中可用的功能来区分这些相关和因果特征。以下是一些示例：
- en: '**Experimental design**: One way to establish causality is to conduct experiments
    where we measure the effect of changes in the causal feature on the target variable.
    However, such experimental studies may not always be feasible or ethical.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**实验设计**：建立因果关系的一种方式是通过进行实验，测量因果特征变化对目标变量的影响。然而，这样的实验研究可能并不总是可行或道德的。'
- en: '**Feature importance**: We can use explainability techniques, as presented
    in [*Chapter 6*](B16369_06.xhtml#_idTextAnchor201), *Interpretability and Explainability
    in Machine Learning Modeling*, to identify feature importance and use such information
    to discriminate between correlation and causality.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**特征重要性**：我们可以使用在[*第六章*](B16369_06.xhtml#_idTextAnchor201)《机器学习建模中的可解释性和可解释性》中介绍的可解释性技术来识别特征重要性，并利用这些信息来区分相关性和因果关系。'
- en: '**Causal inference**: Causal inference methods aim to identify the causal relationship
    between variables. You can use causal inference to determine whether a change
    in one variable causes a change in another variable.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**因果推断**：因果推断方法旨在识别变量之间的因果关系。你可以使用因果推断来确定一个变量的变化是否会导致另一个变量的变化。'
- en: We discussed different explainability techniques such as SHAP, LIME, and counterfactual
    explanations in [*Chapter 6*](B16369_06.xhtml#_idTextAnchor201), *Interpretability
    and Explainability in Machine Learning Modeling*. You can use these techniques
    to identify features that are not causal in your models. For example, features
    with low SHAP values most probably are not causal in the model under investigation.
    If there is a feature with low importance in the local approximation, according
    to LIME, then it is likely to not be causal regarding the output of your model.
    Or if changing a feature has little or no effect on the output of your model,
    through counterfactual analysis, then it is likely not a causal feature.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在[*第六章*](B16369_06.xhtml#_idTextAnchor201)《机器学习建模中的可解释性和可解释性》中讨论了不同的可解释性技术，如SHAP、LIME和反事实解释。你可以使用这些技术来识别模型中非因果的特征。例如，SHAP值低的特征很可能在所研究的模型中不是因果特征。如果根据LIME，在局部近似中有低重要性的特征，那么它很可能与模型的输出无关。或者，如果改变一个特征对模型输出的影响很小或没有影响，通过反事实分析，那么它很可能不是一个因果特征。
- en: We can also use another technique, called **permutation feature importance**,
    which is also considered under the umbrella of explainability techniques to identify
    features with a low chance of being causal. In this approach, we change the values
    of a feature and measure the effect of change on the model’s performance. Then
    we can identify features with low effects that are likely to not be causal.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用另一种技术，称为**置换特征重要性**，它也被认为是可解释性技术的一部分，用于识别低概率的因果特征。在这种方法中，我们改变一个特征的价值，并测量这种变化对模型性能的影响。然后我们可以识别出低影响的特征，这些特征很可能不是因果特征。
- en: We already practiced explainability techniques in [*Chapter 6*](B16369_06.xhtml#_idTextAnchor201),
    *Interpretability and Explainability in Machine Learning Modeling*. We will focus
    on causal inference for the remainder of this chapter.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在[*第六章*](B16369_06.xhtml#_idTextAnchor201)《机器学习建模中的可解释性和可解释性》中实践了可解释性技术。接下来我们将专注于本章剩余部分的因果推断。
- en: Causal inference
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 因果推断
- en: 'In causal inference, we aim to identify and understand the causal relationship
    between variables in a dataset or model. In this process, we might rely on different
    statistical and machine learning techniques to analyze data and infer causal relationships
    between variables. *Figure 15**.2* shows five such methods: **experimental design**,
    **observational studies**, **propensity score matching**, **instrumental variables**,
    and **machine** **learning-based methods**:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在因果推断中，我们的目标是识别和理解数据集或模型中变量之间的因果关系。在这个过程中，我们可能会依赖不同的统计和机器学习技术来分析数据并推断变量之间的因果关系。*图15.2*展示了五种这样的方法：**实验设计**、**观察性研究**、**倾向得分匹配**、**工具变量**和**基于机器学习的方法**：
- en: '![Figure 15.2 – Five causal inference techniques](img/B16369_15_02.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![图15.2 – 五种因果推断技术](img/B16369_15_02.jpg)'
- en: Figure 15.2 – Five causal inference techniques
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.2 – 五种因果推断技术
- en: 'In **experimental design**, you design experiments to compare outcome variables
    for samples with differences in a treatment variable, or different conditions
    based on a specific feature or characteristics. Examples of treatment and outcome
    variables are provided in *Table 15.1* to help you understand the difference between
    these two terms:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在**实验设计**中，你设计实验来比较具有不同治疗变量或基于特定特征或特征的条件的样本的结局变量。*表15.1*中提供了治疗和结果变量的示例，以帮助您理解这两个术语之间的区别：
- en: '| **Treatment Variable** | **Outcome Variable** |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| **治疗变量** | **结果变量** |'
- en: '| Education level | Income level |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| 教育水平 | 收入水平 |'
- en: '| Smoking | Lung cancer |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| 吸烟 | 肺癌 |'
- en: '| Physical activity | Cardiovascular health |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| 体力活动 | 心血管健康 |'
- en: '| Family income | Academic performance |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| 家庭收入 | 学术表现 |'
- en: Table 15.1 – Examples of treatment and outcome variables in causal modeling
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.1 – 因果建模中治疗和结果变量的示例
- en: In **observational studies**, we use observational data, instead of controlled
    experiments, and try to identify causal relationships by controlling confounding
    variables. **Propensity score matching** matches treatment and control groups
    based on the probability of receiving the treatment given the observed variables.
    **Instrumental variables** is used to overcome a common problem in observational
    studies where the treatment and outcome variables are jointly determined by other
    variables, or confounders, that are not included in the model. This approach starts
    with identifying an instrument that is correlated with the treatment variable
    and uncorrelated with the outcome variable, except through its effect on the treatment
    variable. **Machine learning-based methods** are other categories of techniques
    where machine learning methods such as Bayesian networks and decision trees are
    used to identify causal relationships between variables and outcomes.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在**观察性研究中**，我们使用观察数据，而不是受控实验，并试图通过控制混杂变量来识别因果关系。**倾向得分匹配**根据观察变量的概率来匹配治疗组和对照组。**工具变量**用于克服观察性研究中常见的难题，即治疗和结果变量由其他变量（或混杂变量）共同决定，而这些变量未包含在模型中。这种方法从识别一个与治疗变量相关但与结果变量不相关的工具变量开始，除了通过其对治疗变量的影响之外。**基于机器学习的方法**是其他技术类别，其中使用贝叶斯网络和决策树等机器学习方法来识别变量和结果之间的因果关系。
- en: Bayesian networks
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 贝叶斯网络
- en: 'You can benefit from Bayesian networks in causal modeling and identifying causal
    relationships between variables. Bayesian networks are graphical models that show
    the relationship between variables through **directed acyclic graphs** (**DAGs**),
    where each variable, including the input features and outputs, is a node and directions
    show the relationship between variables (*Figure 15**.3*):'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从贝叶斯网络中受益，在因果建模和识别变量之间的因果关系时。贝叶斯网络是图形模型，通过**有向无环图**（**DAGs**）展示变量之间的关系，其中每个变量（包括输入特征和输出）都是一个节点，方向显示变量之间的关系（*图15.3*）：
- en: '![Figure 15.3 – Illustrating an example Bayesian network](img/B16369_15_03.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![图15.3 – 示例贝叶斯网络的说明](img/B16369_15_03.jpg)'
- en: Figure 15.3 – Illustrating an example Bayesian network
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.3 – 示例贝叶斯网络的说明
- en: What this network tells us is that higher values of **Feature A** and **Feature
    B** make it more likely for the outcome to occur. Note that the features could
    be numerical or categorical. Although the directions, such as from Feature A to
    the outcome (*Figure 15**.3*), don’t necessarily mean causality, Bayesian networks
    can be used for estimating the causal effects of variables on the outcome while
    controlling the confounding variables.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这个网络告诉我们，**特征A**和**特征B**的值越高，结果发生的可能性就越大。请注意，特征可以是数值的或分类的。尽管从特征A到结果的方向（*图15.3*）不一定意味着因果关系，但贝叶斯网络可以用来估计变量对结果的因果效应，同时控制混杂变量。
- en: 'From a probabilistic perspective, the network can be used to simplify the joint
    probability of all the variables, including the features and outcome, as follows:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 从概率的角度来看，网络可以用来简化所有变量的联合概率，包括特征和结果，如下所示：
- en: p(F A, F B, F C, Outcome) = p(Outcome| F A, F B)p(F B| F C)p(F C| F A)p(F A)
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: p(F A, F B, F C, Outcome) = p(Outcome| F A, F B)p(F B| F C)p(F C| F A)p(F A)
- en: Here, p(Outcome| F A, F B) is the **conditional probability distribution** (**CPD**)
    of the outcome given the values of Features A and B, p(F B| F C) is the CPD of
    Feature B given Feature C, p(F C| F A) is the CPD of Feature C given Feature A,
    and p(F A) is the probability of Feature A that is not conditional to other features
    as no edge is directed toward it in the graph. These CPDs can help us estimate
    the effect of change one feature value has on another. It tells us about the likelihood
    of the occurrence of one variable given the occurrence of one or more variables.
    You will learn how to make a Bayesian network in a data-driven way for a given
    dataset and how to identify the CPDs of the network using Python by the end of
    this chapter.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，p(Outcome| F A, F B)是给定特征A和B值的**条件概率分布**（**CPD**），p(F B| F C)是给定特征C的特征B的CPD，p(F C|
    F A)是给定特征A的特征C的CPD，p(F A)是特征A的概率，它不是其他特征的函数，因为在图中没有指向它的边。这些CPD可以帮助我们估计一个特征值的变化对另一个特征的影响。它告诉我们，在给定一个或多个变量发生的情况下，一个变量的发生可能性。你将在本章结束时学习如何以数据驱动的方式为给定的数据集创建贝叶斯网络，以及如何使用Python识别网络的CPD。
- en: There are several methods available in Python for causal inference. We’ll cover
    these next.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: Python中有几种可用于因果推断的方法。我们将在下一节中介绍这些方法。
- en: Causal modeling using Python
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Python进行因果建模
- en: 'Several Python libraries provide you with easy-to-use functionalities for using
    causal methods and conducting causal inference. Some of these are as follows:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 几个Python库为你提供了使用因果方法和进行因果推断的易于使用的功能。以下是一些：
- en: '`dowhy` ([https://pypi.org/project/dowhy/](https://pypi.org/project/dowhy/))'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dowhy` ([https://pypi.org/project/dowhy/](https://pypi.org/project/dowhy/))'
- en: '`pycausalimpact` ([https://pypi.org/project/pycausalimpact/](https://pypi.org/project/pycausalimpact/))'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`pycausalimpact` ([https://pypi.org/project/pycausalimpact/](https://pypi.org/project/pycausalimpact/))'
- en: '`causalnex` ([https://pypi.org/project/causalnex/](https://pypi.org/project/causalnex/))'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`causalnex` ([https://pypi.org/project/causalnex/](https://pypi.org/project/causalnex/))'
- en: '`econml` ([https://pypi.org/project/econml/](https://pypi.org/project/econml/))'
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`econml` ([https://pypi.org/project/econml/](https://pypi.org/project/econml/))'
- en: '`bnlearn` ([https://pypi.org/project/bnlearn/](https://pypi.org/project/bnlearn/))'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bnlearn` ([https://pypi.org/project/bnlearn/](https://pypi.org/project/bnlearn/))'
- en: In the next few subsections, we will review `dowhy` and `bnlearn`.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的几个小节中，我们将回顾`dowhy`和`bnlearn`。
- en: Using dowhy for causal effect estimation
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用dowhy进行因果效应估计
- en: First, we want to practice with a propensity score matching approach that is
    useful when you have a treatment variable in mind – for example, when you want
    to identify the effect of a drug on patients and have other variables in the model,
    such as their diet, age, sex, and so on. Here, we will use the breast cancer dataset
    of `scikit-learn`, where the target variable is a binary outcome telling us about
    the cells, from masses of breast cancer patients, as being from malignant or benign
    masses. Here, we will use the mean *radius* feature – the mean distance from the
    center to points on the perimeter – as the treatment variable.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们想要练习一种倾向得分匹配方法，这种方法在你有一个治疗变量在心中时很有用——例如，当你想要确定药物对患者的效果，并在模型中有其他变量，如他们的饮食、年龄、性别等时。在这里，我们将使用`scikit-learn`的乳腺癌数据集，其中目标变量是一个二元结果，告诉我们来自乳腺癌患者的细胞是恶性还是良性。在这里，我们将使用平均*半径*特征——即从中心到边缘上的点的平均距离——作为治疗变量。
- en: 'First, we must import the required libraries and modules in Python:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们必须在Python中导入所需的库和模块：
- en: '[PRE0]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Then, we must load the breast cancer dataset and convert it into a DataFrame:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们必须加载乳腺癌数据集并将其转换为 DataFrame：
- en: '[PRE1]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, we need to convert the numerical values of the treatment variable, the
    mean radius, into a binary as propensity scoring matching only accepts binary
    treatment variables:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要将治疗变量的数值（平均半径）转换为二进制，因为倾向得分匹配仅接受二进制治疗变量：
- en: '[PRE2]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'We also need to make a list of common causes, which in this case we consider
    as being all the other attributes in the dataset:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要列出共同原因列表，在这种情况下，我们将所有其他数据集中的属性视为共同原因：
- en: '[PRE3]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, we can build a model using `CausalModel()` from `dowhy` by specifying
    the data, treatment, outcome variable, and common causes. The `CausalModel()`
    object helps us estimate the causal effect of the `treatment` variable (mean radius)
    on the outcome variable (`target`):'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以通过指定数据、治疗、结果变量和共同原因来使用 `dowhy` 的 `CausalModel()` 构建模型。`CausalModel()`
    对象帮助我们估计 `treatment` 变量（平均半径）对结果变量（`target`）的因果效应：
- en: '[PRE4]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Now, we can estimate the causal effect of the specified treatment variable,
    the mean radius, on the target variable. Note that propensity score matching,
    which we’re using here, is applicable only for discrete treatment variables:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以估计指定治疗变量（平均半径）对目标变量的因果效应。请注意，我们在这里使用的倾向得分匹配仅适用于离散治疗变量：
- en: '[PRE5]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The `estimate` value is -0.279, which means that the probability of the outcome
    is decreased by ~28% with the high mean radius as the treatment variable. This
    propensity score is the conditional probability of receiving the treatment (high
    mean radius) given a set of observed covariates. The backdoor adjustment controls
    the confounding variables, which are associated with both the treatment and outcome
    variables.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '`estimate` 值为 -0.279，这意味着当平均半径作为治疗变量时，结果发生的概率降低了约 28%。这个倾向得分是在给定一组观察到的协变量条件下接受治疗的条件概率。后门调整控制了混杂变量，这些变量与治疗和结果变量都有关联。'
- en: 'We can also use `refute_estimate()` to assess the validity of our hypothesis
    regarding the causal variables and their data-driven estimated effects on the
    outcome. For example, we can use the `''placebo_treatment_refuter''` method, which
    replaces the specified treatment variable with an independent random variable.
    If our assumption of causality between the treatment and outcome is correct, then
    the new estimate goes close to zero. Here is the code to check the validity of
    our assumption using `''placebo_treatment_refuter''`:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用 `refute_estimate()` 函数来评估我们对因果变量及其对结果数据驱动估计效应的假设的有效性。例如，我们可以使用 `'placebo_treatment_refuter'`
    方法，该方法将指定的治疗变量替换为一个独立的随机变量。如果我们对治疗和结果之间因果关系的假设是正确的，那么新的估计值将接近零。以下是使用 `'placebo_treatment_refuter'`
    检查我们假设有效性的代码：
- en: '[PRE6]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This results in the new effect of 0.0014, which is an assurance about the validity
    of our assumption. However, the *p*-value estimate, which is another output of
    this command, is 0.48, which shows the level of statistical confidence.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 这导致新的效应为 0.0014，这保证了我们假设的有效性。然而，此命令的另一个输出 *p*-值估计为 0.48，这显示了统计置信水平。
- en: A low *p*-value from `refute_estimate()` does not mean that the treatment variable
    is not causal. A low *p*-value shows the sensitivity of the estimated causal effect
    to the specific assumption being tested. The significance of the refutation result
    does not imply the absence of a causal relationship between the treatment variable
    and the outcome variable.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '`refute_estimate()` 函数返回的低 *p*-值并不意味着治疗变量不具有因果性。低 *p*-值表明估计的因果效应对特定假设的敏感性。反驳结果的显著性并不暗示治疗变量和结果变量之间不存在因果关系。'
- en: Using bnlearn for causal inference through Bayesian networks
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 bnlearn 通过贝叶斯网络进行因果推理
- en: One of the libraries that exists in both the Python and R programming languages
    for Bayesian network learning and inference is `bnlearn`. We can learn a Bayesian
    network for a given dataset using this library and then use the learned graph
    to infer causal relationships.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Python 和 R 编程语言中都存在的用于贝叶斯网络学习和推理的库之一是 `bnlearn`。我们可以使用这个库学习给定数据集的贝叶斯网络，然后使用学习到的图来推断因果关系。
- en: 'To practice with `bnlearn`, we must install and then import this library and
    load the Sprinkler dataset that exists as part of it:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用 `bnlearn` 进行练习，我们必须安装并导入这个库，然后加载作为其一部分存在的 Sprinkler 数据集：
- en: '[PRE7]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Next, we must fit a `structure_learning()` model to generate a Bayesian network
    or a DAG:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们必须拟合一个 `structure_learning()` 模型来生成贝叶斯网络或 DAG：
- en: '[PRE8]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Then, we must define the properties of the nodes and visualize the DAG, as
    follows:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们必须定义节点属性并可视化DAG，如下所示：
- en: '[PRE9]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'This results in the network shown in *Figure 15**.4*. As shown in this DAG,
    `''Sprinkler''` could be a causal variable for both cloudy weather and wet grass.
    And wet grass could be potentially caused by rain and sprinklers. But there are
    functionalities to quantify these dependencies:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 这导致了*图15.4*中显示的网络。如图所示，`'Sprinkler'`可能是多云天气和湿草的因果变量。湿草可能由雨和水龙头引起。但存在量化这些依赖性的功能：
- en: '![Figure 15.4 – Learned DAG using bnlearn for the Sprinkler dataset](img/B16369_15_04.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![图15.4 – 使用bnlearn为Sprinkler数据集学习的DAG](img/B16369_15_04.jpg)'
- en: Figure 15.4 – Learned DAG using bnlearn for the Sprinkler dataset
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.4 – 使用bnlearn学习Sprinkler数据集的DAG
- en: 'You can use `independence_test()` as follows to test the dependency of the
    variables:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用`independence_test()`如下测试变量的依赖性：
- en: '[PRE10]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '*Table 15.2* includes a summary of the output of the previous command, clearly
    showing the significance of the dependency of the paired variables in the DAG:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '*表15.2*包括了前一个命令的输出总结，清楚地显示了DAG中成对变量依赖性的显著性：'
- en: '| **Source** | **Target** | **p-value (from** **chi_sqare test)** | **chi-square**
    |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| **来源** | **目标** | **p-value（来自** **chi_square test）** | **chi-square** |'
- en: '| Cloudy | Rain | 1.080606e-87 | 394.061629 |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| 多云 | 雨 | 1.080606e-87 | 394.061629 |'
- en: '| Sprinkler | Wet_Grass | 1.196919e-23 | 100.478455 |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| 水龙头 | 湿草 | 1.196919e-23 | 100.478455 |'
- en: '| Sprinkler | Cloudy | 8.383708e-53 | 233.906474 |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| 水龙头 | 多云 | 8.383708e-53 | 233.906474 |'
- en: '| Rain | Wet_Grass | 3.886511e-64 | 285.901702 |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| 雨 | 湿草 | 3.886511e-64 | 285.901702 |'
- en: Table 15.2 – Summary of using bnlearn.independence_test() on the Sprinkler dataset
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 表15.2 – 使用bnlearn.independence_test()在Sprinkler数据集上的总结
- en: 'You can also use `bnlearn.parameter_learning.fit()` to learn about the CPDs,
    as follows:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以使用`bnlearn.parameter_learning.fit()`如下学习CPD：
- en: '[PRE11]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '*Figure 15**.5* shows the CPDs of the `Cloudy`, `Rain`, and `Sprinkler` variables.
    These CPDs, in combination with the identified DAG (*Figure 15**.4*), provide
    the required information to not only identify potentially causal relationships
    between the variables but also do a quantitative assessment of them:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '*图15.5*显示了`Cloudy`、`Rain`和`Sprinkler`变量的CPD。这些CPD与已识别的DAG（*图15.4*）相结合，不仅提供了识别变量之间潜在因果关系所需的信息，而且还可以对这些关系进行定量评估：'
- en: '![Figure 15.5 – Examples of CPDs identified by bnlearn for the Sprinkler dataset](img/B16369_15_05.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![图15.5 – bnlearn为Sprinkler数据集识别的CPD示例](img/B16369_15_05.jpg)'
- en: Figure 15.5 – Examples of CPDs identified by bnlearn for the Sprinkler dataset
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 图15.5 – bnlearn为Sprinkler数据集识别的CPD示例
- en: In this chapter, you practiced using causal modeling, but there is much more
    to this topic. This is one of the most important topics in machine learning and
    you will benefit from learning more about this subject.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你练习了使用因果建模，但这个主题还有更多内容。这是机器学习中最重要的话题之一，你将受益于对这个主题的更多了解。
- en: Summary
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned about the difference between correlative and causal
    relationships, the importance of causal modeling, and techniques such as Bayesian
    networks for causal inference. Later, we went through Python practices to help
    you start working with causal modeling and inference in your projects so that
    you can identify more reliable relationships between variables in your datasets
    and design reliable models.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了相关关系和因果关系之间的区别，因果建模的重要性，以及贝叶斯网络等因果推理技术。随后，我们通过Python实践帮助你开始在你的项目中使用因果建模和推理，以便你能识别出数据集中变量之间更可靠的关系，并设计出可靠的模型。
- en: In the next chapter, you will learn techniques for preserving privacy and ensuring
    security while maximizing the benefits of using private and proprietary data in
    building reliable machine learning models.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，你将学习在构建可靠的机器学习模型时，如何保护隐私并确保安全，同时最大化使用私有和专有数据的益处。
- en: Questions
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Could you have a feature that is highly correlated with the output but not causal
    in a supervised learning model?
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在监督学习模型中，你能否有一个与输出高度相关但不是因果的特征？
- en: What is the difference between experimental design and observation studies for
    causal inference?
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 实验设计和观察研究在因果推理中有何区别？
- en: What are the requirements for using instrumental variables for causal inference?
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用工具变量进行因果推理有哪些要求？
- en: Could relationships in a Bayesian network necessarily be considered causal?
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 贝叶斯网络中的关系是否必然可以被认为是因果的？
- en: References
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考文献
- en: 'Schölkopf, Bernhard. *Causality for machine learning*. Probabilistic and Causal
    Inference: The Works of Judea Pearl. 2022\. 765-804.'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Schölkopf, Bernhard. *机器学习的因果性*. 概率与因果推理：朱迪亚·佩尔的工作. 2022. 765-804.
- en: 'Kaddour, Jean, et al. *Causal machine learning: A survey and open problems*.
    arXiv preprint arXiv:2206.15475 (2022).'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kaddour, Jean, 等人. *因果机器学习：综述与开放问题*. arXiv预印本 arXiv:2206.15475 (2022).
- en: Pearl, Judea. *Bayesian* *networks*. (2011).
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Pearl, Judea. *贝叶斯* *网络*. (2011).
- en: 'Richens, Jonathan G., Ciarán M. Lee, and Saurabh Johri. *Improving the accuracy
    of medical diagnosis with causal machine learning*. Nature communications 11.1
    (2020): 3923.'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Richens, Jonathan G., Ciarán M. Lee, 和 Saurabh Johri. *利用因果机器学习提高医疗诊断的准确性*.
    Nature communications 11.1 (2020): 3923.'
- en: 'Prosperi, Mattia, et al. *Causal inference and counterfactual prediction in
    machine learning for actionable healthcare*. Nature Machine Intelligence 2.7 (2020):
    369-375.'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Prosperi, Mattia, 等人. *在可操作的医疗保健中，机器学习的因果推理和反事实预测*. Nature Machine Intelligence
    2.7 (2020): 369-375.'
- en: 'Sanchez, Pedro, et al. *Causal machine learning for healthcare and precision
    medicine*. Royal Society Open Science 9.8 (2022): 220638.'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Sanchez, Pedro, 等人. *因果机器学习在医疗和精准医学中的应用*. Royal Society Open Science 9.8 (2022):
    220638.'

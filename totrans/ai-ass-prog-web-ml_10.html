<html><head></head><body>
  <div id="_idContainer098" class="calibre1">
    <h1 class="chapternumber">10</h1>
    <h1 class="chaptertitle" id="_idParaDest-199">Maintaining Existing Codebases</h1>
    <h1 class="heading" id="_idParaDest-200">Introduction</h1>
    <p class="normal"><strong class="screentext">Brownfield</strong> is <a id="_idIndexMarker229" class="calibre3"/>another word for working with existing code. In my career as a developer, most of the work carried out has been on existing code. The opposite of brownfield is <strong class="screentext">greenfield</strong>, which is a new project with no existing code.</p>
    <p class="normal1">For that reason, it’s important to cover how to work with existing codebases, and there’s a lot to get excited about when working with an AI assistant like GitHub Copilot in a brownfield context.</p>
    <p class="normal1">In this chapter, we will:</p>
    <ul class="calibre15">
      <li class="bulletlist">Learn about the different types of maintenance.</li>
      <li class="bulletlist1">Understand how we work with maintenance in a process to de-risk introduced changes.</li>
      <li class="bulletlist1">Use GitHub Copilot to help us with maintenance.</li>
    </ul>
    <h1 class="heading" id="_idParaDest-201">Prompt strategy</h1>
    <p class="normal">This chapter is a bit different from other chapters in the book. The focus is on describing various problems you may encounter in the space of existing codebases. You’re recommended to use the prompt suggestion approach with which you’re the most comfortable, be it prompt comments or the chat interface. As for patterns, you’re encouraged to try out all three major patterns introduced, that is, PIC, TAG, or Exploratory patterns as described in <em class="italic">Chapter 2</em>. This chapter however focuses on using the “Exploratory pattern”.</p>
    <h1 class="heading" id="_idParaDest-202">Different types of maintenance</h1>
    <p class="normal">There are different types<a id="_idIndexMarker230" class="calibre3"/> of maintenance, and it’s important to understand<a id="_idIndexMarker231" class="calibre3"/> the differences between them. Here are some different types that you’re likely to encounter:</p>
    <ul class="calibre15">
      <li class="bulletlist"><strong class="screentext">Corrective maintenance</strong>: This <a id="_idIndexMarker232" class="calibre3"/>is when we’re fixing bugs.</li>
      <li class="bulletlist1"><strong class="screentext">Adaptive maintenance</strong>: In<a id="_idIndexMarker233" class="calibre3"/> this case, we change code to adapt to new requirements.</li>
      <li class="bulletlist1"><strong class="screentext">Perfective maintenance</strong>: When<a id="_idIndexMarker234" class="calibre3"/> we improve code without changing the functionality. Examples of this could be refactoring or improving the performance of the code.</li>
      <li class="bulletlist1"><strong class="screentext">Preventive maintenance</strong>: Changing<a id="_idIndexMarker235" class="calibre3"/> the code to prevent future bugs or issues.</li>
    </ul>
    <h1 class="heading" id="_idParaDest-203">The maintenance process</h1>
    <p class="normal">Every time you <a id="_idIndexMarker236" class="calibre3"/>change code, you introduce risk. For example, a bug fix could introduce a new bug. To mitigate this risk, we need to follow a process. A suggested process could be the following steps:</p>
    <ol class="calibre16">
      <li class="bulletlist1" value="1"><strong class="screentext">Identify</strong>: Identify the problem or the change that needs to be made.</li>
      <li class="bulletlist1"><strong class="screentext">Inspect</strong>: Inspect the test coverage and how well your code is covered by tests. The better it’s covered, the more likely you are to detect any introduced bugs or other issues.</li>
      <li class="bulletlist1"><strong class="screentext">Plan</strong>: Plan the change. How are you going to make it? What tests are you going to write? What tests are you going to run?</li>
      <li class="bulletlist1"><strong class="screentext">Implement</strong>: Implement the change. </li>
      <li class="bulletlist1"><strong class="screentext">Verify</strong>: Verify that the change works as expected. Run the tests, run the application, check the logs, etc.</li>
      <li class="bulletlist1"><strong class="screentext">Integrate: </strong>This is about ensuring any change you make in a branch is merged into the main branch. </li>
      <li class="bulletlist1"><strong class="screentext">Release/deploy the change</strong>: You want to make sure the end customer can leverage the benefit of this change. For that to happen, you need to deploy it.</li>
    </ol>
    <p class="normal1">Do we need to cover all these steps for every change? No, it depends on the change; some changes might be so small that we might want to bundle many of them before we make a release that we want the end customer to have. The good news is that we have a great tool in GitHub Copilot that can help us with some of these minor steps, allowing us to focus on the more important steps.</p>
    <h1 class="heading" id="_idParaDest-204">Addressing a bug</h1>
    <p class="normal">Some bugs are<a id="_idIndexMarker237" class="calibre3"/> more severe than others. In a best-case scenario, your bug<a id="_idIndexMarker238" class="calibre3"/> is seldom encountered, or when it does occur it’s not a big deal. In a worst-case scenario, your bug loses you money. Let’s focus on a case where the bug loses you money in a scenario where you’re running an e-commerce site.</p>
    <p class="normal1">Hopefully, this <a id="_idIndexMarker239" class="calibre3"/>code has never been shipped in production, but it’s a good example of a bug that could be catastrophic for an e-commerce site:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">def</span> <span class="hljs-meta">process_cart</span>():
    <span class="hljs-comment"># get cart from database</span>
    cart = get_cart()
    card = cart.get_card()
    process_payment(card, cart)
    ship_order(cart)
</code></pre>
    <p class="normal1">The<a id="_idIndexMarker240" class="calibre3"/> problem you might have is that <code class="inlinecode">ship_order</code> is called even if <code class="inlinecode">process_payment</code> fails, which means you ship orders without getting paid, losing you money.</p>
    <p class="normal1">Looking at this code, you might not have a problem if <code class="inlinecode">process_payment</code> throws an error and you don’t even get to <code class="inlinecode">ship_order</code>.</p>
    <p class="normal1">What if it doesn’t and, instead, returns a numerical code that depends on payment results, like so?</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">def</span> <span class="hljs-meta">process_payment</span>(<span>card, cart</span>): 
    <span class="hljs-keyword">if</span> card.is_valid():
        <span class="hljs-keyword">if</span> card.has_funds(cart.total):
            charge_card(card, cart.total)
            <span class="hljs-keyword">return</span> <span class="hljs-attr">0</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-attr">1</span>
</code></pre>
    <p class="normal1">If you don’t read the error code, you might not notice that the payment failed, and the order is shipped. So, what’s our approach here?</p>
    <h2 class="heading1" id="_idParaDest-205">1. Identify the problem</h2>
    <p class="normal">First, we need to<a id="_idIndexMarker241" class="calibre3"/> identify the problem; in this case, there are two things you can do, namely: </p>
    <ul class="calibre15">
      <li class="bulletlist"><strong class="screentext">Read the code</strong>: What does our code look like? Are errors thrown, does it return a code, or something else entirely? </li>
      <li class="bulletlist1"><strong class="screentext">Check the tests</strong>: Do we have a test that covers this scenario? If not, we need to write one. The test should show that we have a bug.</li>
    </ul>
    <p class="normal1">Let’s use Copilot for this, with a prompt like so (here, we simulate <code class="inlinecode">process_payment</code> to return error codes instead of throwing errors). Select the <code class="inlinecode">ship_order</code> code in the main window, and then<a id="_idIndexMarker242" class="calibre3"/> type a prompt as follows in the chat window:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Write a test for the code; <code class="inlinecode">ship_order</code> should not be called if <code class="inlinecode">process_payment</code> returns 1.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <div class="note">
      <p class="normal1">We’re using the GitHub Copilot Chat function and selecting the <code class="inlinecode">process_cart</code> code in our text editor. </p>
    </div>
    <p class="normal1">You should see a response similar to the below code:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <pre class="programlisting"><code class="hljs-code">```python
<span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">from</span> unittest.mock <span class="hljs-keyword">import</span> Mock, patch
<span class="hljs-keyword">from</span> your_module <span class="hljs-keyword">import</span> process_cart  <span class="hljs-comment"># replace with the actual module name</span>
<span class="hljs-keyword">class</span> <span class="hljs-meta">TestProcessCart</span>(unittest.TestCase):
<span class="hljs-meta">    @patch(</span><span class="hljs-string">'your_module.get_cart'</span><span class="hljs-meta">)  </span><span class="hljs-comment"># replace with the actual module name</span>
<span class="hljs-meta">    @patch(</span><span class="hljs-string">'your_module.process_payment'</span><span class="hljs-meta">)</span>
<span class="hljs-meta">    @patch(</span><span class="hljs-string">'your_module.ship_order'</span><span class="hljs-meta">)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_order_not_shipped_if_payment_fails</span>(<span>self, mock_ship_order, mock_process_payment, mock_get_cart</span>):
        <span class="hljs-comment"># Arrange</span>
        mock_cart = Mock()
        mock_cart.get_card.return_value = <span class="hljs-string">'test_card'</span>
        mock_get_cart.return_value = mock_cart
        mock_process_payment.return_value = <span class="hljs-attr">1</span>
        <span class="hljs-comment"># Act</span>
        process_cart()
        <span class="hljs-comment"># Assert</span>
        mock_ship_order.assert_not_called()
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    unittest.main()
```
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">The above code contains a test that tests what happens if we get error code 1 from <code class="inlinecode">process_payment</code>. What<a id="_idIndexMarker243" class="calibre3"/> we want to have happen is for <code class="inlinecode">ship_order</code> not to be called.</p>
    <p class="normal1">This test will fail, as we have a bug in our code, which is a good thing, as we’ve identified a bug and can prove it exists with a test.</p>
    <h2 class="heading1" id="_idParaDest-206">2. Implement the change</h2>
    <p class="normal">Now that we<a id="_idIndexMarker244" class="calibre3"/> have a test that shows we have a bug, we can implement the change. We can be confident to make the code change, as we have a test that shows that we have a bug, and we’ve hopefully also improved test coverage enough.</p>
    <div class="note">
      <p class="normal1">Don’t start refactoring unless you have good test coverage or the change is so small that you are confident that you won’t introduce a bug.</p>
    </div>
    <p class="normal1">How do we now improve the code? Simple – we can use GitHub Copilot to help us with the implementation. Let’s use the following prompt to help us with the code change we need to do:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Implement the change; <code class="inlinecode">ship_order</code> should not be called if <code class="inlinecode">process_payment</code> returns 1.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">Your code for <code class="inlinecode">process_cart</code> should now look like this:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <pre class="programlisting"><code class="hljs-code">```python
<span class="hljs-keyword">def</span> <span class="hljs-meta">process_cart</span>():
    <span class="hljs-comment"># get cart from database</span>
    cart = get_cart()
    card = cart.get_card()
    payment_status = process_payment(card, cart)
    <span class="hljs-comment"># Only ship the order if the payment was successful</span>
    <span class="hljs-keyword">if</span> payment_status != <span class="hljs-attr">1</span>:
        ship_order(cart)
```
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">This code above is a step in the right direction, as it now contains an <code class="inlinecode">if</code> statement that checks the payment status.</p>
    <p class="normal1">To further<a id="_idIndexMarker245" class="calibre3"/> improve the code, we can use Copilot to help us make the code more robust and easier to read. Let’s use the following prompt for additional improvements:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Refactor the code, making it easier to maintain.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">This might give you the following code:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">def</span> <span class="hljs-meta">get_payment_status</span>(<span>cart</span>):
    card = cart.get_card()
    <span class="hljs-keyword">return</span> process_payment(card, cart)
<span class="hljs-keyword">def</span> <span class="hljs-meta">process_cart</span>():
    <span class="hljs-comment"># get cart from database</span>
    cart = get_cart()
    payment_status = get_payment_status(cart)
    <span class="hljs-comment"># Only ship the order if the payment was successful</span>
    <span class="hljs-keyword">if</span> payment_status != <span class="hljs-attr">1</span>:
        ship_order(cart)
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">Here, Copilot has suggested that we extract the payment status into a separate function. This is a good suggestion, as it makes the code easier to read and maintain.</p>
    <h1 class="heading" id="_idParaDest-207">Adding a new feature</h1>
    <p class="normal">In this <a id="_idIndexMarker246" class="calibre3"/>example, we’ll look at an existing codebase and add<a id="_idIndexMarker247" class="calibre3"/> a new feature. The codebase is like the one we used in the previous example, but it’s a bit more complex. This is because it has a few more functions involving different types of payment methods. Here’s the code:</p>
    <pre class="programlisting"><code class="hljs-code">```python
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">def</span> <span class="hljs-meta">validate_card</span>(<span>card</span>):
    <span class="hljs-comment"># Visa cards start with 4 and have 13 or 16 digits.</span>
    <span class="hljs-comment"># MasterCard cards start with 51 through 55 and have 16 digits.</span>
    visa_pattern = <span class="hljs-string">r'^4[0-9]{12}(?:[0-9]{3})?$'</span>
    mastercard_pattern = <span class="hljs-string">r'^5[1-5][0-9]{14}$'</span>
    <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(visa_pattern, card):
        <span class="hljs-keyword">return</span> <span class="hljs-string">'Visa'</span>
    <span class="hljs-keyword">elif</span> re.<span class="hljs-keyword">match</span>(mastercard_pattern, card):
        <span class="hljs-keyword">return</span> <span class="hljs-string">'MasterCard'</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
<span class="hljs-keyword">def</span> <span class="hljs-meta">process_payment</span>(<span>card, cart</span>):
    card_type = validate_card(card)
    <span class="hljs-keyword">if</span> card_type <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-attr">1</span>  <span class="hljs-comment"># Invalid card</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># Process the payment here</span>
        <span class="hljs-comment"># Return 0 if the payment is successful, 1 otherwise</span>
        <span class="hljs-keyword">pass</span>
<span class="hljs-keyword">def</span> <span class="hljs-meta">process_cart</span>():
    <span class="hljs-comment"># Get cart from database</span>
    cart = get_cart()
    card = cart.get_card()
    payment_status = process_payment(card, cart)
    <span class="hljs-comment"># Only ship the order if the payment was successful</span>
    <span class="hljs-keyword">if</span> payment_status == <span class="hljs-attr">0</span>:
        ship_order(cart)
```
</code></pre>
    <p class="normal1">In the above<a id="_idIndexMarker248" class="calibre3"/> code, we have the following:</p>
    <ul class="calibre15">
      <li class="bulletlist"><code class="inlinecode">validate_card</code> validates the card number and returns the card type if valid; otherwise, it returns <code class="inlinecode">None</code>.</li>
      <li class="bulletlist1"><code class="inlinecode">process_payment</code> processes the payment and returns <code class="inlinecode">0</code> if the payment was successful; otherwise, it returns <code class="inlinecode">1</code>.</li>
      <li class="bulletlist1"><code class="inlinecode">process_cart</code> processes the cart, gets the card, processes the payment, and ships the order if the payment is successful.</li>
    </ul>
    <h2 class="heading1" id="_idParaDest-208"> 1. Identify a problem and find the function/s to change</h2>
    <p class="normal">Our task is to<a id="_idIndexMarker249" class="calibre3"/> make our code also support American Express cards. Implementing a new card means that we need to update the <code class="inlinecode">validate_card</code> function to support American Express cards.</p>
    <p class="normal1">Now, we know <a id="_idIndexMarker250" class="calibre3"/>what functions need to change, but does GitHub Copilot know?</p>
    <p class="normal1">Let’s ask GitHub Copilot, with a prompt.</p>
    <div class="note">
      <p class="normal1">In the identification step, we used our know-how to identify what and where to change. A good practice is to rely on a combination of your own skills and the Copilot tool to help analyze and identify problems. </p>
    </div>
    <h2 class="heading1" id="_idParaDest-209">2. Implement change, and add a new feature and tests</h2>
    <p class="normal">Let’s use GitHub <a id="_idIndexMarker251" class="calibre3"/>Copilot to help us with this. We can use the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Add support for American Express cards.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">You will get code similar to this:</p>
    <p class="normal1">[<strong class="screentext">Prompt response]</strong></p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">import</span> re
<span class="hljs-keyword">def</span> <span class="hljs-meta">validate_card</span>(<span>card</span>):
    <span class="hljs-comment"># Visa cards start with 4 and have 13 or 16 digits.</span>
    <span class="hljs-comment"># MasterCard cards start with 51 through 55 and have 16 digits.</span>
    <span class="hljs-comment"># American Express cards start with 34 or 37 and have 15 digits.</span>
    visa_pattern = <span class="hljs-string">r'^4[0-9]{12}(?:[0-9]{3})?$'</span>
    mastercard_pattern = <span class="hljs-string">r'^5[1-5][0-9]{14}$'</span>
    amex_pattern = <span class="hljs-string">r'^3[47][0-9]{13}$'</span>
    <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(visa_pattern, card):
        <span class="hljs-keyword">return</span> <span class="hljs-string">'</span><span class="hljs-string">Visa'</span>
    <span class="hljs-keyword">elif</span> re.<span class="hljs-keyword">match</span>(mastercard_pattern, card):
        <span class="hljs-keyword">return</span> <span class="hljs-string">'MasterCard'</span>
    <span class="hljs-keyword">elif</span> re.<span class="hljs-keyword">match</span>(amex_pattern, card):
        <span class="hljs-keyword">return</span> <span class="hljs-string">'American Express'</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">In the above code, Copilot has made the following changes:</p>
    <ul class="calibre15">
      <li class="bulletlist">Created a new regular expression in the <code class="inlinecode">validate_card</code> function to support American Express cards.</li>
      <li class="bulletlist1">Added a new <code class="inlinecode">elif</code> statement to return American Express if the card matches the new regular expression.</li>
    </ul>
    <p class="normal1">Of course, we’re not<a id="_idIndexMarker252" class="calibre3"/> done yet; we need to add a test to verify that the code works as expected. Let’s use the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Write a test for the code; validate_card should return American Express for a valid card.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">Your test should look like below:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <pre class="programlisting"><code class="hljs-code">```python
<span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">from</span> your_module <span class="hljs-keyword">import</span> validate_card  <span class="hljs-comment"># replace with the actual module name</span>
<span class="hljs-keyword">class</span> <span class="hljs-meta">TestValidateCard</span>(unittest.TestCase):
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_validate_card_returns_amex_for_valid_amex_card</span>(<span>self</span>):
        <span class="hljs-comment"># Arrange</span>
        valid_amex_card = <span class="hljs-string">'378282246310005'</span>
        <span class="hljs-comment"># Act</span>
        result = validate_card(valid_amex_card)
        <span class="hljs-comment"># Assert</span>
        self.assertEqual(result, <span class="hljs-string">'</span><span class="hljs-string">American Express'</span>)
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    unittest.main()
```
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">The new test, <code class="inlinecode">test_validate_card_returns_amex_for_valid_amex_card</code>, was added by Copilot and tests that the <code class="inlinecode">validate_card</code> function returns <code class="inlinecode">American Express</code> for a valid American Express card.</p>
    <p class="normal1">At this point, it’s a good idea to keep iterating; you not only want to test that the code works for a valid card but also for an invalid card, and so on. </p>
    <div class="packt_tip">
      <p class="normal1">You can use Copilot as a challenge to write more tests.</p>
    </div>
    <h1 class="heading" id="_idParaDest-210">Improving performance</h1>
    <p class="normal">Improving <a id="_idIndexMarker253" class="calibre3"/>performance is a common task but can be tricky to achieve. Usually, you need specific tools to measure performance, and you need to know what to measure. A good way to find out how to improve your code in this way is to <a id="_idIndexMarker254" class="calibre3"/>use a decorator to <em class="italic">profile</em> how long a method takes to execute. Then, you can measure specific methods and find out which methods to improve.</p>
    <p class="normal1">Here’s an <a id="_idIndexMarker255" class="calibre3"/>example of a decorator being used on a function that sleeps for 2 seconds:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">def</span> <span class="hljs-meta">profile</span>(<span>func</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-meta">wrapper</span>(<span>*args, **kwargs</span>):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'</span><span class="hljs-name">{func.__name__}</span><span class="hljs-string"> took </span><span class="hljs-name">{end - start}</span><span class="hljs-string"> seconds'</span>)
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> wrapper
<span class="hljs-meta">@profile</span>
<span class="hljs-keyword">def</span> <span class="hljs-meta">sleep_two_seconds</span>():
    time.sleep(<span class="hljs-attr">2</span>)
sleep_two_seconds()
</code></pre>
    <p class="normal1">The <code class="inlinecode">profile</code> function is a decorator that takes a function as input and returns a function that wraps the input function. The <code class="inlinecode">wrapper</code> function measures the time it takes to execute the input function and prints the result.</p>
    <p class="normal1">Were you to run this code via the terminal, you would see output similar to the following:</p>
    <pre class="programlisting2"><code class="hljs-con">sleep_two_seconds took 2.000000238418579 seconds
</code></pre>
    <p class="normal1">OK, so how do we use this to improve performance? Let’s use GitHub Copilot and see how we can get advice on improving performance on a piece of code.</p>
    <p class="normal1">Here’s the code we want to improve. This processes records and looks for duplicates:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">def</span> <span class="hljs-meta">process_records</span>(<span>records</span>):
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(records)):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(records)):
            <span class="hljs-keyword">if</span> i != j <span class="hljs-keyword">and</span> records[i] == records[j]:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Duplicate record found: </span><span class="hljs-name">{records[i]}</span><span class="hljs-string">'</span>)
</code></pre>
    <p class="normal1">Most <a id="_idIndexMarker256" class="calibre3"/>developers looking at this will refer back to their algorithms and data structures books and start thinking about things like <em class="italic">Big O notation</em>, a way to<a id="_idIndexMarker257" class="calibre3"/> measure the performance of an algorithm. The main thing to focus on is reducing the number of costly operations to improve performance while retaining the same functionality.</p>
    <p class="normal1">So, the question we should ask GitHub Copilot is, how do we improve this code? Let’s use the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Improve the performance of the code.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">We get something like this back:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">def</span> <span class="hljs-meta">process_records</span>(<span>records</span>):
    record_set = <span class="hljs-built_in">set</span>()
    <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> records:
        <span class="hljs-keyword">if</span> record <span class="hljs-keyword">in</span> record_set:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Duplicate record found: </span><span class="hljs-name">{record}</span><span class="hljs-string">'</span>)
        <span class="hljs-keyword">else</span>:
            record_set.add(record)
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">So, why is this code better? Well, let’s prove it:</p>
    <ol class="calibre16">
      <li class="bulletlist1" value="1">First, by calculating the Big O notation for the original code and then for the new code.</li>
      <li class="bulletlist1">Second, by using the decorator we created earlier.</li>
    </ol>
    <h2 class="heading1" id="_idParaDest-211">Big O notation calculation</h2>
    <p class="normal">Try this<a id="_idIndexMarker258" class="calibre3"/> prompt:</p>
    <p class="normal1">[<strong class="screentext">Prompt]</strong></p>
    <p class="normal1">What’s the Big O complexity for this code? Show me how you calculated it as well.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">You should get something like this:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <p class="normal1">The time complexity of the provided code is <em class="italic">O(n^2)</em>, where n is the number of records.</p>
    <p class="normal1">Here’s how it’s calculated:</p>
    <ul class="calibre15">
      <li class="bulletlist">The outer loop runs n times, where n is the number of records. This is because it iterates over each record in the list.</li>
      <li class="bulletlist1">Inside the outer loop, there’s an inner loop that also runs n times for the same reason.</li>
      <li class="bulletlist1">Since the inner loop runs n times for each iteration of the outer loop, the total number of iterations is <em class="italic">n * n</em>, or <em class="italic">n^2</em>.</li>
    </ul>
    <p class="normal1">Therefore, the time complexity is <em class="italic">O(n^2)</em>.</p>
    <p class="normal1">This means that if you double the number of records, the time it takes to process them will increase by about four times. This is a characteristic of quadratic time complexity.</p>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">OK, <em class="italic">O(n^2)</em> is <a id="_idIndexMarker259" class="calibre3"/>not great, but what about the new code?</p>
    <p class="normal1">Run the same prompt but on the new code:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <p class="normal1">The time complexity of the provided code is <em class="italic">O(n)</em>, where n is the number of records.</p>
    <p class="normal1">Here’s how it’s calculated:</p>
    <ul class="calibre15">
      <li class="bulletlist">The loop runs n times, where n is the number of records. This is because it iterates over each record in the list.</li>
      <li class="bulletlist1">Inside the loop, the operations (checking if a record is in the set and potentially adding it to the set) are constant time, <em class="italic">O(1)</em>, because set operations in Python are typically constant time on average.</li>
    </ul>
    <p class="normal1">Therefore, the time complexity is <em class="italic">O(n)</em> <em class="italic">* O(1)</em>, which simplifies to <em class="italic">O(n)</em>.</p>
    <p class="normal1">This means that if you double the number of records, the time it takes to process them will also double, which is a characteristic of linear time complexity.</p>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1"><em class="italic">O(n)</em> is better than <em class="italic">O(n^2)</em>, but how much better? Let’s measure this in the next section.</p>
    <h2 class="heading1" id="_idParaDest-212">Measuring performance</h2>
    <p class="normal">OK, so algorithmically, we<a id="_idIndexMarker260" class="calibre3"/> know that the new code is better, but how much better? Let’s measure it by using the decorator and calling the code. Let’s use the input of 1,000 records and 10,000 records and compare the time it takes to execute the code.</p>
    <p class="normal1">OK, let’s see if the <a id="_idIndexMarker261" class="calibre3"/>new code is faster than the old code. Let’s try with 10,000 records:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-comment"># old code</span>
<span class="hljs-meta">@profile</span>
<span class="hljs-keyword">def</span> <span class="hljs-meta">process_records</span>(<span>records</span>):
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(records)):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(records)):
            <span class="hljs-keyword">if</span> i != j <span class="hljs-keyword">and</span> records[i] == records[j]:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Duplicate record found: </span><span class="hljs-name">{records[i]}</span><span class="hljs-string">'</span>)
records_10000 = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-attr">10000</span>)]
process_records(records_10000)
</code></pre>
    <p class="normal1">Running this code, you should see the following output:</p>
    <pre class="programlisting2"><code class="hljs-con">process_records took 5.193912506103516 seconds
</code></pre>
    <p class="normal1">Now, let’s run the new code:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-comment"># new code</span>
<span class="hljs-meta">@profile</span>
<span class="hljs-keyword">def</span> <span class="hljs-meta">process_records</span>(<span>records</span>):
    record_set = <span class="hljs-built_in">set</span>()
    <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> records:
        <span class="hljs-keyword">if</span> record <span class="hljs-keyword">in</span> record_set:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Duplicate record found: </span><span class="hljs-name">{record}</span><span class="hljs-string">'</span>)
        <span class="hljs-keyword">else</span>:
            record_set.add(record)
records_10000 = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-attr">10000</span>)]
process_records(records_10000)
</code></pre>
    <p class="normal1">Running this code, you should see the following output:</p>
    <pre class="programlisting2"><code class="hljs-con">process_records took 0.0011200904846191406 seconds
</code></pre>
    <p class="normal1">As you can see, by combining your knowledge with GitHub Copilot, you can improve your code.</p>
    <div class="note">
      <p class="normal1">Your code won’t always look this obvious, and you might need to do more work to improve performance. You’re recommended to use a profiler to measure performance, and then use GitHub Copilot to help you improve the code.</p>
    </div>
    <h1 class="heading" id="_idParaDest-213">Improving maintainability</h1>
    <p class="normal">Another<a id="_idIndexMarker262" class="calibre3"/> interesting use case is using GitHub Copilot to help you improve the maintainability of your code. So what are some things that you can do to<a id="_idIndexMarker263" class="calibre3"/> improve the maintainability of your code? Here’s a list:</p>
    <ul class="calibre15">
      <li class="bulletlist"><strong class="screentext">Improve the naming</strong> of variables, functions, classes, etc.</li>
      <li class="bulletlist1"><strong class="screentext">Separate concerns</strong>: For example, separate business logic from presentation logic.</li>
      <li class="bulletlist1"><strong class="screentext">Remove duplication</strong>: Especially in large codebases, you’re likely to find duplication.</li>
      <li class="bulletlist1"><strong class="screentext">Improve readability</strong>: You can improve readability by, for example, using comments, docstrings, event tests, and more.</li>
    </ul>
    <p class="normal1">Let’s start with a codebase and see how we can improve it. Here’s the code:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">def</span> <span class="hljs-meta">calculate_total</span>(<span>cart, discounts</span>):
    <span class="hljs-comment"># Define discount functions</span>
    <span class="hljs-keyword">def</span> <span class="hljs-meta">three_for_two</span>(<span>items</span>):
        total = <span class="hljs-attr">0</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:
            total += item.price * (item.quantity - item.quantity // <span class="hljs-attr">3</span>)
        <span class="hljs-keyword">return</span> total
    <span class="hljs-keyword">def</span> <span class="hljs-meta">christmas_discount</span>(<span>items</span>):
        total = <span class="hljs-attr">0</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:
            total += item.price * item.quantity * <span class="hljs-attr">0.5</span>
        <span class="hljs-keyword">return</span> total
    <span class="hljs-keyword">def</span> <span class="hljs-meta">cheapest_free</span>(<span>items</span>):
        items_sorted = <span class="hljs-built_in">sorted</span>(items, key=<span class="hljs-keyword">lambda</span> x: x.price)
        total = <span class="hljs-attr">0</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items_sorted[<span class="hljs-attr">1</span>:]:
            total += item.price * item.quantity
        <span class="hljs-keyword">return</span> total
    <span class="hljs-comment"># Calculate totals for each discount</span>
    totals = []
    <span class="hljs-keyword">for</span> discount <span class="hljs-keyword">in</span> discounts:
        <span class="hljs-keyword">if</span> discount == <span class="hljs-string">'3 for 2'</span>:
            totals.append((discount, three_for_two(cart)))
        <span class="hljs-keyword">elif</span> discount == <span class="hljs-string">'Christmas Discount'</span>:
            totals.append((discount, christmas_discount(cart)))
        <span class="hljs-keyword">elif</span> discount == <span class="hljs-string">'Cheapest Free'</span>:
            totals.append((discount, cheapest_free(cart)))
    <span class="hljs-comment"># Sort totals and return the lowest one</span>
    totals_sorted = <span class="hljs-built_in">sorted</span>(totals, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-attr">1</span>])
    <span class="hljs-keyword">return</span> totals_sorted[<span class="hljs-attr">0</span>][<span class="hljs-attr">1</span>] <span class="hljs-keyword">if</span> totals_sorted <span class="hljs-keyword">else</span> <span class="hljs-built_in">sum</span>(item.price * item.quantity <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> cart)
<span class="hljs-comment"># Define discounts</span>
discounts = [<span class="hljs-string">'3 for 2'</span>, <span class="hljs-string">'Christmas Discount'</span>, <span class="hljs-string">'Cheapest Free'</span>]
<span class="hljs-comment"># Define cart</span>
cart = [
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item1'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">10</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">3</span>},
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item2'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">20</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>},
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'</span><span class="hljs-string">item3'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">30</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>}
]
<span class="hljs-comment"># Calculate total</span>
total = calculate_total(cart, discounts)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'Total: </span><span class="hljs-name">{total}</span><span class="hljs-string">'</span>)
</code></pre>
    <p class="normal1">The <a id="_idIndexMarker264" class="calibre3"/>above <a id="_idIndexMarker265" class="calibre3"/>codebase describes the following at a high level:</p>
    <ul class="calibre15">
      <li class="bulletlist">A function, <code class="inlinecode">calculate_total</code>, that calculates the total for a cart and a list of discounts</li>
      <li class="bulletlist1">A list of discounts</li>
      <li class="bulletlist1">A cart</li>
    </ul>
    <p class="normal1">What you can see from this codebase is that it’s not very maintainable, as it’s hard to understand what’s going on.</p>
    <h2 class="heading1" id="_idParaDest-214">1. Identify the problems. What problems do you see?</h2>
    <p class="normal">Let’s first <a id="_idIndexMarker266" class="calibre3"/>ask GitHub Copilot what it thinks about the code and decide what to do next. Let’s use the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">What do you think about the code? What would you do to improve it?</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">You get a lengthy response back with a bullet list and improved code. Let’s look at the bullet list first:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <ul class="calibre15">
      <li class="bulletlist"><strong class="screentext">Use Classes for Items and Discounts</strong>: Right now, items and discounts are represented as dictionaries and strings, respectively. Using classes for these entities would make the code more readable and flexible.</li>
      <li class="bulletlist1"><strong class="screentext">Separate Discount Functions</strong>: The discount functions are currently defined inside the <code class="inlinecode">calculate_total</code> function. It would be better to define these functions separately to improve readability and make the code easier to test and maintain.</li>
      <li class="bulletlist1"><strong class="screentext">Use a More Extensible Approach for Applying Discounts</strong>: The current approach for applying discounts involves a series of <code class="inlinecode">if-elif</code> statements. This could be made more extensible by storing the discount functions in a dictionary or a list of <code class="inlinecode">Discount</code> objects, and then iterating over that collection to apply the discounts.</li>
    </ul>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">The problems identified above all seem reasonable – using classes, separating functions, and using dictionary.</p>
    <h2 class="heading1" id="_idParaDest-215">2. Add tests and de-risk change</h2>
    <p class="normal">Before we look at a<a id="_idIndexMarker267" class="calibre3"/> suggested code change, we need to minimize the risk of introducing a bug. The first thing we should<a id="_idIndexMarker268" class="calibre3"/> do is check our test coverage. In this case, we don’t have any tests, so we need to write some. Let’s use the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Write tests for this code, covering all possible execution paths.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">class</span> <span class="hljs-meta">TestCalculateTotal</span>(unittest.TestCase):
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_no_discounts</span>(<span>self</span>):
        cart = [
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item1'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">10</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">3</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item2'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">20</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'</span><span class="hljs-string">item3'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">30</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>}
        ]
        discounts = []
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">80</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_three_for_two_discount</span>(<span>self</span>):
        cart = [
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'</span><span class="hljs-string">item1'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">10</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">3</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item2'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">20</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item3'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">30</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>}
        ]
        discounts = [<span class="hljs-string">'3 for 2'</span>]
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">70</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_christmas_discount</span>(<span>self</span>):
        cart = [
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item1'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">10</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">3</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item2'</span>, <span class="hljs-string">'</span><span class="hljs-string">price'</span>: <span class="hljs-attr">20</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item3'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">30</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>}
        ]
        discounts = [<span class="hljs-string">'</span><span class="hljs-string">Christmas Discount'</span>]
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">40</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_cheapest_free_discount</span>(<span>self</span>):
        cart = [
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item1'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">10</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">3</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item2'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">20</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item3'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">30</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>}
        ]
        discounts = [<span class="hljs-string">'Cheapest Free'</span>]
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">70</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_multiple_discounts</span>(<span>self</span>):
        cart = [
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item1'</span>, <span class="hljs-string">'</span><span class="hljs-string">price'</span>: <span class="hljs-attr">10</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">3</span>},
            {<span class="hljs-string">'name'</span>: <span class="hljs-string">'item2'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">20</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>},
            {<span class="hljs-string">'</span><span class="hljs-string">name'</span>: <span class="hljs-string">'item3'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">30</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span>}
        ]
        discounts = [<span class="hljs-string">'3 for 2'</span>, <span class="hljs-string">'Christmas Discount'</span>, <span class="hljs-string">'Cheapest Free'</span>]
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">40</span>)
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    unittest.main()
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <div class="note">
      <p class="normal1">Now, you should never trust what an AI generates, so take your time to review the code, run a test coverage tool, and ensure that you’re happy with the code before you proceed to the next step, which is to improve the code.</p>
    </div>
    <p class="normal1">To improve<a id="_idIndexMarker269" class="calibre3"/> the <a id="_idIndexMarker270" class="calibre3"/>code from the first suggestion from Copilot, you want to ensure that it runs and uses classes like <code class="inlinecode">Item</code> when you add items to a cart, for example. Below is the result of those alterations:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">from</span> discount_old <span class="hljs-keyword">import</span> calculate_total, Item
<span class="hljs-keyword">from</span> item <span class="hljs-keyword">import</span> Item
<span class="hljs-keyword">class</span> <span class="hljs-meta">TestCalculateTotal</span>(unittest.TestCase):
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_no_discounts</span>(<span>self</span>):
        cart = [
            Item(<span class="hljs-string">'item1'</span>, <span class="hljs-attr">10</span>, <span class="hljs-attr">3</span>),
            Item(<span class="hljs-string">'item2'</span>, <span class="hljs-attr">20</span>, <span class="hljs-attr">1</span>),
            Item(<span class="hljs-string">'item3'</span>, <span class="hljs-attr">30</span>, <span class="hljs-attr">1</span>)
        ]
        discounts = []
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">80</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_three_for_two_discount</span>(<span>self</span>):
        cart = [
            Item(<span class="hljs-string">'item1'</span>, <span class="hljs-attr">10</span>, <span class="hljs-attr">3</span>),
            Item(<span class="hljs-string">'item2'</span>, <span class="hljs-attr">20</span>, <span class="hljs-attr">1</span>),
            Item(<span class="hljs-string">'item3'</span>, <span class="hljs-attr">30</span>, <span class="hljs-attr">1</span>)
        ]
        discounts = [<span class="hljs-string">'3 for 2'</span>]
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">70</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_christmas_discount</span>(<span>self</span>):
        cart = [
            Item(<span class="hljs-string">'item1'</span>, <span class="hljs-attr">10</span>, <span class="hljs-attr">3</span>),
            Item(<span class="hljs-string">'item2'</span>, <span class="hljs-attr">20</span>, <span class="hljs-attr">1</span>),
            Item(<span class="hljs-string">'item3'</span>, <span class="hljs-attr">30</span>, <span class="hljs-attr">1</span>)
        ]
        discounts = [<span class="hljs-string">'Christmas Discount'</span>]
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">40</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_cheapest_free_discount</span>(<span>self</span>):
        cart = [
            Item(<span class="hljs-string">'item1'</span>, <span class="hljs-attr">10</span>, <span class="hljs-attr">3</span>), <span class="hljs-comment">#30</span>
            Item(<span class="hljs-string">'item2'</span>, <span class="hljs-attr">20</span>, <span class="hljs-attr">1</span>), <span class="hljs-comment"># 20</span>
            Item(<span class="hljs-string">'item3'</span>, <span class="hljs-attr">30</span>, <span class="hljs-attr">1</span>) <span class="hljs-comment"># 30</span>
        ]
        discounts = [<span class="hljs-string">'Cheapest Free'</span>]
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">60</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-meta">test_multiple_discounts</span>(<span>self</span>):
        cart = [
            Item(<span class="hljs-string">'item1'</span>, <span class="hljs-attr">10</span>, <span class="hljs-attr">3</span>),
            Item(<span class="hljs-string">'item2'</span>, <span class="hljs-attr">20</span>, <span class="hljs-attr">1</span>),
            Item(<span class="hljs-string">'item3'</span>, <span class="hljs-attr">30</span>, <span class="hljs-attr">1</span>)
        ]
        discounts = [<span class="hljs-string">'3 for 2'</span>, <span class="hljs-string">'Christmas Discount'</span>, <span class="hljs-string">'Cheapest Free'</span>]
        total = calculate_total(cart, discounts)
        self.assertEqual(total, <span class="hljs-attr">40</span>)
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    unittest.main()
</code></pre>
    <p class="normal1">And for<a id="_idIndexMarker271" class="calibre3"/> the<a id="_idIndexMarker272" class="calibre3"/> application code:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">from</span> item <span class="hljs-keyword">import</span> Item
<span class="hljs-keyword">def</span> <span class="hljs-meta">calculate_total</span>(<span>cart, discounts</span>):
    <span class="hljs-comment"># Define discount functions</span>
    <span class="hljs-keyword">def</span> <span class="hljs-meta">three_for_two</span>(<span>items</span>):
        total = <span class="hljs-attr">0</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:
            total += item.price * (item.quantity - item.quantity // <span class="hljs-attr">3</span>)
        <span class="hljs-keyword">return</span> total
    <span class="hljs-keyword">def</span> <span class="hljs-meta">christmas_discount</span>(<span>items</span>):
        total = <span class="hljs-attr">0</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:
            total += item.price * item.quantity * <span class="hljs-attr">0.5</span>
        <span class="hljs-keyword">return</span> total
    <span class="hljs-keyword">def</span> <span class="hljs-meta">cheapest_free</span>(<span>items</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> items:
            <span class="hljs-keyword">return</span> <span class="hljs-attr">0</span>
        items_sorted = <span class="hljs-built_in">sorted</span>(items, key=<span class="hljs-keyword">lambda</span> x: x.price * x.quantity)
        cheapest_item = items_sorted[<span class="hljs-attr">0</span>]
        total = <span class="hljs-attr">0</span>
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:
            total += item.price * item.quantity
        total -= cheapest_item.price * cheapest_item.quantity <span class="hljs-keyword">if</span> cheapest_item.quantity &gt; <span class="hljs-attr">0</span> <span class="hljs-keyword">else</span> <span class="hljs-attr">0</span>
        <span class="hljs-keyword">return</span> total
    <span class="hljs-comment"># Calculate totals for each discount</span>
    totals = []
    <span class="hljs-keyword">for</span> discount <span class="hljs-keyword">in</span> discounts:
        <span class="hljs-keyword">if</span> discount == <span class="hljs-string">'3 for 2'</span>:
            totals.append((discount, three_for_two(cart)))
        <span class="hljs-keyword">elif</span> discount == <span class="hljs-string">'Christmas Discount'</span>:
            totals.append((discount, christmas_discount(cart)))
        <span class="hljs-keyword">elif</span> discount == <span class="hljs-string">'Cheapest Free'</span>:
            totals.append((discount, cheapest_free(cart)))
    <span class="hljs-comment"># Sort totals and return the lowest one</span>
    totals_sorted = <span class="hljs-built_in">sorted</span>(totals, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-attr">1</span>])
    <span class="hljs-keyword">return</span> totals_sorted[<span class="hljs-attr">0</span>][<span class="hljs-attr">1</span>] <span class="hljs-keyword">if</span> totals_sorted <span class="hljs-keyword">else</span> <span class="hljs-built_in">sum</span>(item.price * item.quantity <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> cart)
<span class="hljs-comment"># if run as script,</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-comment"># Define discounts</span>
    discounts = [<span class="hljs-string">'3 for 2'</span>, <span class="hljs-string">'Christmas Discount'</span>, <span class="hljs-string">'Cheapest Free'</span>]
    <span class="hljs-comment"># Define cart</span>
    cart = [
        Item(<span class="hljs-string">'item1'</span>, <span class="hljs-attr">10</span>, <span class="hljs-attr">3</span>),
        Item(<span class="hljs-string">'</span><span class="hljs-string">item2'</span>, <span class="hljs-attr">20</span>, <span class="hljs-attr">1</span>),
        Item(<span class="hljs-string">'item3'</span>, <span class="hljs-attr">30</span>, <span class="hljs-attr">1</span>)
    ]
    <span class="hljs-comment"># Calculate total</span>
    total = calculate_total(cart, discounts)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Total: </span><span class="hljs-name">{total}</span><span class="hljs-string">'</span>)
</code></pre>
    <p class="normal1">OK, so we <a id="_idIndexMarker273" class="calibre3"/>now have a<a id="_idIndexMarker274" class="calibre3"/> codebase that we’re happy with and that’s passing tests. Let’s now look at the suggested code change from GitHub Copilot.</p>
    <h2 class="heading1" id="_idParaDest-216">3. Implement change and improve maintainability</h2>
    <p class="normal">OK, we feel confident <a id="_idIndexMarker275" class="calibre3"/>that we have good test coverage and we’re ready to improve the code. Let’s use the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Improve the maintainability of the code.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">You should get something like this:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <p class="normal1">To improve the maintainability of the code, we can make the following changes:</p>
    <ul class="calibre15">
      <li class="bulletlist">Move the discount functions out of <code class="inlinecode">calculate_total</code> to make them standalone functions. This improves readability and makes it easier to test these functions individually.</li>
      <li class="bulletlist1">Use a dictionary to map discount names to their corresponding functions. This eliminates the need for multiple <code class="inlinecode">if/elif</code> statements when applying discounts.</li>
    </ul>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">from</span> item <span class="hljs-keyword">import</span> Item
<span class="hljs-comment"># Define discount functions</span>
<span class="hljs-keyword">def</span> <span class="hljs-meta">three_for_two</span>(<span>items</span>):
    total = <span class="hljs-attr">0</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:
        total += item.price * (item.quantity - item.quantity // <span class="hljs-attr">3</span>)
    <span class="hljs-keyword">return</span> total
<span class="hljs-keyword">def</span> <span class="hljs-meta">christmas_discount</span>(<span>items</span>):
    total = <span class="hljs-attr">0</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:
        total += item.price * item.quantity * <span class="hljs-attr">0.5</span>
    <span class="hljs-keyword">return</span> total
<span class="hljs-keyword">def</span> <span class="hljs-meta">cheapest_free</span>(<span>items</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> items:
        <span class="hljs-keyword">return</span> <span class="hljs-attr">0</span>
    items_sorted = <span class="hljs-built_in">sorted</span>(items, key=<span class="hljs-keyword">lambda</span> x: x.price * x.quantity)
    cheapest_item = items_sorted[<span class="hljs-attr">0</span>]
    total = <span class="hljs-attr">0</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:
        total += item.price * item.quantity
    total -= cheapest_item.price * cheapest_item.quantity <span class="hljs-keyword">if</span> cheapest_item.quantity &gt; <span class="hljs-attr">0</span> <span class="hljs-keyword">else</span> <span class="hljs-attr">0</span>
    <span class="hljs-keyword">return</span> total
<span class="hljs-keyword">def</span> <span class="hljs-meta">calculate_total</span>(<span>cart, discounts</span>):
    <span class="hljs-comment"># Map discount names to functions</span>
    discount_functions = {
        <span class="hljs-string">'3 for 2'</span>: three_for_two,
        <span class="hljs-string">'Christmas Discount'</span>: christmas_discount,
        <span class="hljs-string">'Cheapest Free'</span>: cheapest_free
    }
    <span class="hljs-comment"># Calculate totals for each discount</span>
    totals = []
    <span class="hljs-keyword">for</span> discount <span class="hljs-keyword">in</span> discounts:
        <span class="hljs-keyword">if</span> discount <span class="hljs-keyword">in</span> discount_functions:
            totals.append((discount, discount_functions[discount](cart)))
    <span class="hljs-comment"># Sort totals and return the lowest one</span>
    totals_sorted = <span class="hljs-built_in">sorted</span>(totals, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-attr">1</span>])
    <span class="hljs-keyword">return</span> totals_sorted[<span class="hljs-attr">0</span>][<span class="hljs-attr">1</span>] <span class="hljs-keyword">if</span> totals_sorted <span class="hljs-keyword">else</span> <span class="hljs-built_in">sum</span>(item.price * item.quantity <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> cart)
<span class="hljs-comment"># if run as script,</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-comment"># Define discounts</span>
    discounts = [<span class="hljs-string">'3 for 2'</span>, <span class="hljs-string">'Christmas Discount'</span>, <span class="hljs-string">'Cheapest Free'</span>]
    <span class="hljs-comment"># Define cart</span>
    cart = [
        Item(<span class="hljs-string">'item1'</span>, <span class="hljs-attr">10</span>, <span class="hljs-attr">3</span>),
        Item(<span class="hljs-string">'item2'</span>, <span class="hljs-attr">20</span>, <span class="hljs-attr">1</span>),
        Item(<span class="hljs-string">'item3'</span>, <span class="hljs-attr">30</span>, <span class="hljs-attr">1</span>)
    ]
    <span class="hljs-comment"># Calculate total</span>
    total = calculate_total(cart, discounts)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Total: </span><span class="hljs-name">{total}</span><span class="hljs-string">'</span>)
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">The code is<a id="_idIndexMarker276" class="calibre3"/> now easier to maintain, as the following changes have been introduced:</p>
    <ul class="calibre15">
      <li class="bulletlist"><code class="inlinecode">calculate_total</code> is a vastly smaller function, where each of the functions it used to contain has been moved out</li>
      <li class="bulletlist1">The same method mentioned also now uses a dictionary to map names to functions </li>
    </ul>
    <div class="packt_tip">
      <p class="normal1">The key to using Copilot effectively is to keep iterating, keep making small changes, and see what Copilot suggests. Change the prompt slightly, see what happens, and go with the output that best suits your needs.</p>
    </div>
    <h1 class="heading" id="_idParaDest-217">Challenge</h1>
    <p class="normal">Try improving the code further using a prompt and GitHub Copilot. What should happen if there’s a problem with the payment? Should you log it, maybe raise an error, etc.? </p>
    <h1 class="heading" id="_idParaDest-218">Updating an existing e-commerce site</h1>
    <p class="normal">Let’s continue <a id="_idIndexMarker277" class="calibre3"/>working on the e-commerce site that we presented in previous chapters. In this chapter, we’ll focus on improving the codebase and adding new features.</p>
    <p class="normal1">For reference, let’s show the <code class="inlinecode">basket.html</code> file we’ve started to create:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-comment">&lt;!-- a page showing a list of items in a basket, each item should have title, price, quantity, sum and buttons to increase or decrease quantity and the page should have a link to "checkout" at the bottom  --&gt;</span>
<span>&lt;</span><span class="hljs-name">html</span><span>&gt;</span>
<span>&lt;</span><span class="hljs-name">head</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">title</span><span>&gt;</span>Basket<span>&lt;/</span><span class="hljs-name">title</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">link</span><span> </span><span class="hljs-attr">rel</span><span>=</span><span class="hljs-string">"stylesheet"</span><span> </span><span class="hljs-attr">href</span><span>=</span><span class="hljs-string">"css/basket.css"</span><span>&gt;</span>
   
    <span class="hljs-comment">&lt;!-- add bootstrap --&gt;</span>
    <span>&lt;</span><span class="hljs-name">link</span><span> </span><span class="hljs-attr">rel</span><span>=</span><span class="hljs-string">"stylesheet"</span><span> </span><span class="hljs-attr">href</span><span>=</span><span class="hljs-string">"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"</span><span>&gt;</span>
<span>&lt;/</span><span class="hljs-name">head</span><span>&gt;</span>
<span>&lt;</span><span class="hljs-name">body</span><span>&gt;</span>
    <span class="hljs-comment">&lt;!-- add 3  basket items with each item having id, name, price, quantity, use card css class --&gt;</span>
  
<span class="hljs-comment">&lt;!-- </span>
<span class="hljs-comment">    &lt;div class="container"&gt;</span>
<span class="hljs-comment">        &lt;div id="basket" class="basket"&gt;</span>
<span class="hljs-comment">        &lt;/div&gt;</span>
<span class="hljs-comment">    &lt;/div&gt; --&gt;</span>
    <span class="hljs-comment">&lt;!-- add app.js  --&gt;</span>
    <span class="hljs-comment">&lt;!-- add app.js, type javascript --&gt;</span>
    
    
    <span>&lt;</span><span class="hljs-name">div</span><span> </span><span class="hljs-attr">id</span><span>=</span><span class="hljs-string">"basket"</span><span> </span><span class="hljs-attr">class</span><span>=</span><span class="hljs-string">"basket"</span><span>&gt;</span>
        <span class="hljs-comment">&lt;!-- render basket from Vue app, use Boostrap  --&gt;</span>
        <span>&lt;</span><span class="hljs-name">div</span><span> </span><span class="hljs-attr">v-for</span><span>=</span><span class="hljs-string">"(item, index) in basket"</span><span> </span><span class="hljs-attr">class</span><span>=</span><span class="hljs-string">"basket-item"</span><span>&gt;</span>
            <span>&lt;</span><span class="hljs-name">div</span><span> </span><span class="hljs-attr">class</span><span>=</span><span class="hljs-string">"basket-item-text"</span><span>&gt;</span>
                <span>&lt;</span><span class="hljs-name">h2</span><span>&gt;</span>{{ item.name }}<span>&lt;/</span><span class="hljs-name">h2</span><span>&gt;</span>
                <span>&lt;</span><span class="hljs-name">p</span><span>&gt;</span>Price: {{ item.price }}<span>&lt;/</span><span class="hljs-name">p</span><span>&gt;</span>
                <span>&lt;</span><span class="hljs-name">p</span><span>&gt;</span>Quantity: {{ item.quantity }}<span>&lt;/</span><span class="hljs-name">p</span><span>&gt;</span>
                <span>&lt;</span><span class="hljs-name">p</span><span>&gt;</span>Sum: {{ item.price * item.quantity }}<span>&lt;/</span><span class="hljs-name">p</span><span>&gt;</span>
            <span>&lt;/</span><span class="hljs-name">div</span><span>&gt;</span>
            <span>&lt;</span><span class="hljs-name">div</span><span> </span><span class="hljs-attr">class</span><span>=</span><span class="hljs-string">"basket-item-buttons"</span><span>&gt;</span>
                <span>&lt;</span><span class="hljs-name">button</span><span> </span><span class="hljs-attr">type</span><span>=</span><span class="hljs-string">"submit"</span><span> </span><span class="hljs-attr">class</span><span>=</span><span class="hljs-string">"btn btn-primary btn-block btn-large"</span><span> @</span><span class="hljs-attr">click</span><span>=</span><span class="hljs-string">"increaseQuantity(index)"</span><span>&gt;</span>+<span>&lt;/</span><span class="hljs-name">button</span><span>&gt;</span>
                <span>&lt;</span><span class="hljs-name">button</span><span> </span><span class="hljs-attr">type</span><span>=</span><span class="hljs-string">"submit"</span><span> </span><span class="hljs-attr">class</span><span>=</span><span class="hljs-string">"btn btn-primary btn-block btn-large"</span><span> @</span><span class="hljs-attr">click</span><span>=</span><span class="hljs-string">"decreaseQuantity(index)"</span><span>&gt;</span>-<span>&lt;/</span><span class="hljs-name">button</span><span>&gt;</span>
            <span>&lt;/</span><span class="hljs-name">div</span><span>&gt;</span>
        <span>&lt;/</span><span class="hljs-name">div</span><span>&gt;</span>
    <span>&lt;/</span><span class="hljs-name">div</span><span>&gt;</span>
     <span class="hljs-comment">&lt;!-- add Vue 3  --&gt;</span>
     <span>&lt;</span><span class="hljs-name">script</span><span> </span><span class="hljs-attr">src</span><span>=</span><span class="hljs-string">"https://unpkg.com/vue@next"</span><span>&gt;&lt;/</span><span class="hljs-name">script</span><span>&gt;</span>
    <span class="hljs-comment">&lt;!-- add boostrap code for Vue 3 --&gt;</span>
    <span>&lt;</span><span class="hljs-name">script</span><span>&gt;</span>
        <span class="hljs-keyword">let</span> app = <span class="hljs-meta">Vue</span>.<span class="hljs-meta">createApp</span>({
            <span class="hljs-meta">data</span>() {
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">basket</span>: [
                        {
                            <span class="hljs-attr">id</span>: <span class="hljs-attr">1</span>,
                            <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 1'</span>,
                            <span class="hljs-attr">price</span>: <span class="hljs-attr">100</span>,
                            <span class="hljs-attr">quantity</span>: <span class="hljs-attr">1</span>
                        },
                        {
                            <span class="hljs-attr">id</span>: <span class="hljs-attr">2</span>,
                            <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 2'</span>,
                            <span class="hljs-attr">price</span>: <span class="hljs-attr">200</span>,
                            <span class="hljs-attr">quantity</span>: <span class="hljs-attr">2</span>
                        },
                        {
                            <span class="hljs-attr">id</span>: <span class="hljs-attr">3</span>,
                            <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 3'</span>,
                            <span class="hljs-attr">price</span>: <span class="hljs-attr">300</span>,
                            <span class="hljs-attr">quantity</span>: <span class="hljs-attr">3</span>
                        },
                        {
                            <span class="hljs-attr">id</span>: <span class="hljs-attr">4</span>,
                            <span class="hljs-attr">name</span>: <span class="hljs-string">'</span><span class="hljs-string">Product 4'</span>,
                            <span class="hljs-attr">price</span>: <span class="hljs-attr">400</span>,
                            <span class="hljs-attr">quantity</span>: <span class="hljs-attr">4</span>
                        }
                    ]
                }
            },
            <span class="hljs-attr">methods</span>: {
                <span class="hljs-meta">increaseQuantity</span>(<span>index</span>) {
                    <span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span>++;
                },
                <span class="hljs-meta">decreaseQuantity</span>(<span>index</span>) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span> &gt; <span class="hljs-attr">0</span>) {
                        <span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span>--;
                    }
                }
            },
            <span class="hljs-attr">computed</span>: {
                <span class="hljs-meta">total</span>() {
                    <span class="hljs-keyword">let</span> total = <span class="hljs-attr">0</span>;
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-attr">0</span>; i &lt; <span class="hljs-attr">this</span>.<span>basket</span>.<span>length</span>; i++) {
                        total += <span class="hljs-attr">this</span>.<span>basket</span>[i].<span>price</span> * <span class="hljs-attr">this</span>.<span>basket</span>[i].<span>quantity</span>;
                    }
               
     <span class="hljs-keyword">return</span> total;
                }
            }
        });
        app.<span class="hljs-meta">mount</span>(<span class="hljs-string">'#basket'</span>);
    <span>&lt;/</span><span class="hljs-name">script</span><span>&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;script src="js/app.js"&gt;&lt;/script&gt; --&gt;</span>
<span>&lt;/</span><span class="hljs-name">body</span><span>&gt;</span>
</code></pre>
    <div class="note">
      <p class="normal1">This is an early version of a prototype; it’s not meant to be production-ready code. However, we can use this code to improve it and make it production-ready.</p>
    </div>
    <p class="normal1">Now that we know <a id="_idIndexMarker278" class="calibre3"/>this code isn’t great, let’s improve it with Copilot and the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Improve the code, making it production-ready.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">This prompt highlights some of the problems with the code, namely:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <ul class="calibre15">
      <li class="bulletlist"><strong class="screentext">Separate JavaScript and CSS into external files</strong>: This makes the code more maintainable and allows for caching of these resources.</li>
      <li class="bulletlist1"><strong class="screentext">Use a build tool or a module bundler</strong>: Tools like Webpack or Parcel can help you manage dependencies, transpile modern JavaScript to older versions for better browser compatibility, and minify your code for production.</li>
      <li class="bulletlist1"><strong class="screentext">Error Handling</strong>: Add error handling to your methods to ensure your application can gracefully handle unexpected situations.</li>
      <li class="bulletlist1"><strong class="screentext">Vue Component Structure</strong>: Instead of creating the entire <code class="inlinecode">Vue app</code> in one script, break it down into reusable components.</li>
      <li class="bulletlist1"><strong class="screentext">Accessibility</strong>: Ensure that your HTML is accessible by using appropriate ARIA roles and properties.</li>
    </ul>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">That’s a great<a id="_idIndexMarker279" class="calibre3"/> list of things we can ask about next, but let’s see what code changes it suggests. It suggests code separated into two different files, one for the HTML and one for the JavaScript:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-comment">&lt;!-- index.html --&gt;</span>
<span>&lt;</span><span class="hljs-name">html</span><span>&gt;</span>
<span>&lt;</span><span class="hljs-name">head</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">title</span><span>&gt;</span>Basket<span>&lt;/</span><span class="hljs-name">title</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">link</span><span> </span><span class="hljs-attr">rel</span><span>=</span><span class="hljs-string">"stylesheet"</span><span> </span><span class="hljs-attr">href</span><span>=</span><span class="hljs-string">"css/basket.css"</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">link</span><span> </span><span class="hljs-attr">rel</span><span>=</span><span class="hljs-string">"stylesheet"</span><span> </span><span class="hljs-attr">href</span><span>=</span><span class="hljs-string">"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"</span><span>&gt;</span>
<span>&lt;/</span><span class="hljs-name">head</span><span>&gt;</span>
<span>&lt;</span><span class="hljs-name">body</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">div</span><span> </span><span class="hljs-attr">id</span><span>=</span><span class="hljs-string">"basket"</span><span> </span><span class="hljs-attr">class</span><span>=</span><span class="hljs-string">"basket"</span><span>&gt;&lt;/</span><span class="hljs-name">div</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">script</span><span> </span><span class="hljs-attr">src</span><span>=</span><span class="hljs-string">"https://unpkg.com/vue@next"</span><span>&gt;&lt;/</span><span class="hljs-name">script</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">script</span><span> </span><span class="hljs-attr">src</span><span>=</span><span class="hljs-string">"js/app.js"</span><span>&gt;&lt;/</span><span class="hljs-name">script</span><span>&gt;</span>
<span>&lt;/</span><span class="hljs-name">body</span><span>&gt;</span>
<span>&lt;/</span><span class="hljs-name">html</span><span>&gt;</span>
</code></pre>
    <p class="normal1">Now, let’s look at how the JavaScript was improved:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-comment">// app.js</span>
<span class="hljs-keyword">let</span> app = <span class="hljs-meta">Vue</span>.<span class="hljs-meta">createApp</span>({
    <span class="hljs-meta">data</span>() {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">basket</span>: [
                { <span class="hljs-attr">id</span>: <span class="hljs-attr">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 1'</span>, <span class="hljs-attr">price</span>: <span class="hljs-attr">100</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-attr">1</span> },
                { <span class="hljs-attr">id</span>: <span class="hljs-attr">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 2'</span>, <span class="hljs-attr">price</span>: <span class="hljs-attr">200</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-attr">2</span> },
                { <span class="hljs-attr">id</span>: <span class="hljs-attr">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 3'</span>, <span class="hljs-attr">price</span>: <span class="hljs-attr">300</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-attr">3</span> },
                { <span class="hljs-attr">id</span>: <span class="hljs-attr">4</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 4'</span>, <span class="hljs-attr">price</span>: <span class="hljs-attr">400</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-attr">4</span> }
            ]
        }
    },
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-meta">increaseQuantity</span>(<span>index</span>) {
            <span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span>++;
        },
        <span class="hljs-meta">decreaseQuantity</span>(<span>index</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span> &gt; <span class="hljs-attr">0</span>) {
                <span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span>--;
            }
        }
    },
    <span class="hljs-attr">computed</span>: {
        <span class="hljs-meta">total</span>() {
            <span class="hljs-keyword">return</span> <span class="hljs-attr">this</span>.<span>basket</span>.<span class="hljs-meta">reduce</span>(<span>(</span><span>total, item</span><span>) =&gt;</span> total + item.<span>price</span> * item.<span>quantity</span>, <span class="hljs-attr">0</span>);
        }
    }
});
app.<span class="hljs-meta">mount</span>(<span class="hljs-string">'#basket'</span>);
</code></pre>
    <p class="normal1">A great step<a id="_idIndexMarker280" class="calibre3"/> forward. As a developer, you can see that the JavaScript code uses static data, so let’s change that with the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Improve the code, use dynamic data by calling an API, and also generate a separate Python API with Flask that has the route /api/basket, containing the basket data.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">Now, we get two files, the API and the JavaScript code. Let’s look at the API first:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-comment"># app.py</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify
app = Flask(__name__)
<span class="hljs-meta">@app.route(</span><span class="hljs-string">'/api/basket'</span><span class="hljs-meta">)</span>
<span class="hljs-keyword">def</span> <span class="hljs-meta">get_basket</span>():
    basket = [
        { <span class="hljs-string">'id'</span>: <span class="hljs-attr">1</span>, <span class="hljs-string">'name'</span>: <span class="hljs-string">'Product 1'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">100</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">1</span> },
        { <span class="hljs-string">'id'</span>: <span class="hljs-attr">2</span>, <span class="hljs-string">'name'</span>: <span class="hljs-string">'Product 2'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">200</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">2</span> },
        { <span class="hljs-string">'id'</span>: <span class="hljs-attr">3</span>, <span class="hljs-string">'name'</span>: <span class="hljs-string">'Product 3'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">300</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">3</span> },
        { <span class="hljs-string">'id'</span>: <span class="hljs-attr">4</span>, <span class="hljs-string">'name'</span>: <span class="hljs-string">'Product 4'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-attr">400</span>, <span class="hljs-string">'quantity'</span>: <span class="hljs-attr">4</span> }
    ]
    <span class="hljs-keyword">return</span> jsonify(basket)
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(debug=<span class="hljs-literal">True</span>)
</code></pre>
    <p class="normal1">Above you get <a id="_idIndexMarker281" class="calibre3"/>a route <code class="inlinecode">/api/basket</code> that returns the basket data. Let’s look at the improved JavaScript code:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-keyword">let</span> app = <span class="hljs-meta">Vue</span>.<span class="hljs-meta">createApp</span>({
    <span class="hljs-meta">data</span>() {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">basket</span>: []
        }
    },
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-meta">increaseQuantity</span>(<span>index</span>) {
            <span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span>++;
        },
        <span class="hljs-meta">decreaseQuantity</span>(<span>index</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span> &gt; <span class="hljs-attr">0</span>) {
                <span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span>--;
            }
        }
    },
    <span class="hljs-attr">computed</span>: {
        <span class="hljs-meta">total</span>() {
            <span class="hljs-keyword">return</span> <span class="hljs-attr">this</span>.<span>basket</span>.<span class="hljs-meta">reduce</span>(<span>(</span><span>total, item</span><span>) =&gt;</span> total + item.<span>price</span> * item.<span>quantity</span>, <span class="hljs-attr">0</span>);
        }
    },
    <span class="hljs-meta">mounted</span>() {
        <span class="hljs-meta">fetch</span>(<span class="hljs-string">'/api/basket'</span>)
            .<span class="hljs-meta">then</span>(<span>response</span><span> =&gt;</span> response.<span class="hljs-meta">json</span>())
            .<span class="hljs-meta">then</span>(<span>data</span><span> =&gt;</span> {
                <span class="hljs-attr">this</span>.<span>basket</span> = data;
            });
    }
});
app.<span class="hljs-meta">mount</span>(<span class="hljs-string">'#basket'</span>);
</code></pre>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">Great! We’re now getting data from the API. How can we improve the code? If you’ve built a Vue app before, you <a id="_idIndexMarker282" class="calibre3"/>will know that it involves using the Vue CLI and has a build step. Let’s ask GitHub Copilot about this with the following prompt:</p>
    <p class="normal1"><strong class="screentext">[Prompt]</strong></p>
    <p class="normal1">Improve the code, use the Vue CLI, and add a build step.</p>
    <p class="normal1"><strong class="screentext">[End of prompt]</strong></p>
    <p class="normal1">Now, we get both commands and file changes back as a response, as follows:</p>
    <p class="normal1"><strong class="screentext">[Prompt response]</strong></p>
    <p class="normal1">Install <code class="inlinecode">Vue</code> CLI globally on your machine:</p>
    <pre class="programlisting2"><code class="hljs-con">npm install -g @vue/cli
</code></pre>
    <p class="normal1">Create a new <code class="inlinecode">Vue</code> project</p>
    <pre class="programlisting"><code class="hljs-code">vue create my-project
<span class="hljs-built_in">cd</span> my-project
</code></pre>
    <p class="normal1">Now, let’s create a new <code class="inlinecode">Vue</code> component for the basket. Create a new file <code class="inlinecode">Basket.vue</code> in the <code class="inlinecode">src/components</code> directory:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-comment">&lt;!-- src/components/Basket.vue --&gt;</span>
<span>&lt;</span><span class="hljs-name">template</span><span>&gt;</span>
  <span>&lt;</span><span class="hljs-name">div</span><span> </span><span class="hljs-attr">id</span><span>=</span><span class="hljs-string">"basket"</span><span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Your basket template goes here --&gt;</span>
  <span>&lt;/</span><span class="hljs-name">div</span><span>&gt;</span>
<span>&lt;/</span><span class="hljs-name">template</span><span>&gt;</span>
<span>&lt;</span><span class="hljs-name">script</span><span>&gt;</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-meta">data</span>() {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">basket</span>: []
    };
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-meta">increaseQuantity</span>(<span>index</span>) {
      <span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span>++;
    },
    <span class="hljs-meta">decreaseQuantity</span>(<span>index</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span> &gt; <span class="hljs-attr">0</span>) {
        <span class="hljs-attr">this</span>.<span>basket</span>[index].<span>quantity</span>--;
      }
    }
  },
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-meta">total</span>() {
      <span class="hljs-keyword">return</span> <span class="hljs-attr">this</span>.<span>basket</span>.<span class="hljs-meta">reduce</span>(<span>(</span><span>total, item</span><span>) =&gt;</span> total + item.<span>price</span> * item.<span>quantity</span>, <span class="hljs-attr">0</span>);
    }
  },
  <span class="hljs-meta">mounted</span>() {
    <span class="hljs-meta">fetch</span>(<span class="hljs-string">'/api/basket'</span>)
      .<span class="hljs-meta">then</span>(<span>response</span><span> =&gt;</span> response.<span class="hljs-meta">json</span>())
      .<span class="hljs-meta">then</span>(<span>data</span><span> =&gt;</span> {
        <span class="hljs-attr">this</span>.<span>basket</span> = data;
      });
  }
};
<span>&lt;/</span><span class="hljs-name">script</span><span>&gt;</span>
<span>&lt;</span><span class="hljs-name">style</span><span> </span><span class="hljs-attr">scoped</span><span>&gt;</span>
<span class="hljs-comment">/* Your CSS goes here */</span>
<span>&lt;/</span><span class="hljs-name">style</span><span>&gt;</span>
</code></pre>
    <p class="normal1">Then, import and use this component in your main <code class="inlinecode">App.vue</code>:</p>
    <pre class="programlisting"><code class="hljs-code"><span class="hljs-comment">&lt;!-- src/App.vue --&gt;</span>
<span>&lt;</span><span class="hljs-name">template</span><span>&gt;</span>
  <span>&lt;</span><span class="hljs-name">div</span><span> </span><span class="hljs-attr">id</span><span>=</span><span class="hljs-string">"app"</span><span>&gt;</span>
    <span>&lt;</span><span class="hljs-name">Basket</span><span> /&gt;</span>
  <span>&lt;/</span><span class="hljs-name">div</span><span>&gt;</span>
<span>&lt;/</span><span class="hljs-name">template</span><span>&gt;</span>
<span>&lt;</span><span class="hljs-name">script</span><span>&gt;</span>
<span class="hljs-keyword">import</span> <span class="hljs-meta">Basket</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Basket.vue'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'App'</span>,
  <span class="hljs-attr">components</span>: {
    <span class="hljs-meta">Basket</span>
  }
};
<span>&lt;/</span><span class="hljs-name">script</span><span>&gt;</span>
<span>&lt;</span><span class="hljs-name">style</span><span>&gt;</span>
<span class="hljs-comment">/* Your CSS goes here */</span>
<span>&lt;/</span><span class="hljs-name">style</span><span>&gt;</span>
</code></pre>
    <p class="normal1">Now, you can use the <code class="inlinecode">Vue</code> CLI’s build command to create a production-ready version of your app:</p>
    <pre class="programlisting2"><code class="hljs-con">npm run build
</code></pre>
    <p class="normal1">This will create a dist directory with a production-ready version of your app.</p>
    <p class="normal1"><strong class="screentext">[End of response]</strong></p>
    <p class="normal1">This looks like a<a id="_idIndexMarker283" class="calibre3"/> step in the right direction. However, you should always test the code to make sure it works as expected.</p>
    <p class="normal1">As a challenge, see if the above code works and if you can improve it further.</p>
    <div class="note">
      <p class="normal1">Code is likely to change between versions of a framework. In this case, we’re using Vue.js, so make sure to consult the documentation for the version that you use.</p>
    </div>
    <h1 class="heading" id="_idParaDest-219">Assignment</h1>
    <p class="normal">Find a piece of code you want to improve. Follow the process outlined in this chapter to:</p>
    <ol class="calibre16">
      <li class="bulletlist1" value="1">Identify the problems. What problems do you see?</li>
      <li class="bulletlist1">Add tests and de-risk changes.</li>
      <li class="bulletlist1">Implement the changes and improve maintainability.</li>
    </ol>
    <p class="normal1">If you don’t have a piece of code you want to improve, try using the code from this chapter or the code from the Kata (Gilded Rose) GitHub page: <a href="https://github.com/emilybache/GildedRose-Refactoring-Kata" class="calibre3"><span class="calibre3">https://github.com/emilybache/GildedRose-Refactoring-Kata</span></a>.</p>
    <h1 class="heading" id="_idParaDest-220">Knowledge check</h1>
    <ol class="calibre20">
      <li class="bulletlist1" value="1">What’s the difference between greenfield and brownfield development?</li>
    </ol>
    <p class="normal-one">A: Greenfield development is when you start coding from scratch; brownfield development is when you update existing code.</p>
    <ol class="calibre16">
      <li class="bulletlist1" value="2">What’s the best way to update existing code?</li>
    </ol>
    <p class="normal-one">A: The best way is to make small changes and have plenty of tests in place.</p>
    <h1 class="heading" id="_idParaDest-221">Summary</h1>
    <p class="normal">In this chapter, we established that a very important aspect of writing code is to update existing code, which is known as brownfield development. We also looked at how GitHub Copilot can help you with this task.</p>
    <p class="normal1">The most important message to take away from this chapter is to ensure that you have an approach to updating code that de-risks the changes you’re about to make. It’s better to make a small change several times than a big one once. It’s also strongly recommended to have plenty of tests in place before you start changing code.</p>
    <h1 class="heading" id="_idParaDest-222">Join our community on Discord </h1>
    <p class="normal">Join our community’s Discord space for discussions with the author and other readers: </p>
    <p class="normal1"><a href="https://packt.link/aicode" class="calibre3"><span class="calibre3">https://packt.link/aicode</span></a></p>
    <p class="normal1"><span class="calibre3"><img alt="" src="../Images/QR_Code510410532445718281.png" class="calibre4"/></span></p>
  </div>
</body></html>
- en: Correlations and the Importance of Variables
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 变量之间的相关性及其重要性
- en: Correlation between variables, in general, means that a change in one variable
    reflects on the other. However, it does not mean that the change in one variable
    is *caused* by the change in the correlated variable. For example, the selling
    price of a product is correlated to its manufacturing cost, but the price increase
    is not totally caused by it, since there are other factors such as transportation
    and inflation to take into account.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 变量之间的相关性通常意味着一个变量的变化会反映在另一个变量上。但这并不意味着一个变量的变化是由相关变量的变化*引起*的。例如，产品的销售价格与制造成本相关，但价格的增加并不完全由它引起，因为还有其他因素如运输和通货膨胀需要考虑。
- en: Not every variable or feature in a dataset is useful for the analysis that we
    are planning and, sometimes, many of them are redundant. Strong correlations between
    pairs of variables tell us which ones can be discarded and which ones are important
    to predict or explain the target variable.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 并非数据集中每个变量或特征都对我们的分析有用，有时其中许多是冗余的。变量对之间的强相关性告诉我们哪些可以被丢弃，哪些对于预测或解释目标变量是重要的。
- en: Different correlation calculations can be performed in Excel and used to determine
    the relative importance of the input features. We will show some of them in this
    chapter, together with graphical methods.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在Excel中可以执行不同的相关性计算，并用于确定输入特征的相对重要性。我们将在本章中展示其中的一些，以及图形方法。
- en: The dataset that will be used in this chapter has been taken from the StatLib
    library, which is maintained at Carnegie Mellon University, and relates the different
    variables of a car to its fuel consumption.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章所使用的数据集是从Carnegie Mellon大学维护的StatLib库中获取的，它将汽车的不同变量与其燃油消耗相关联。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们将涵盖以下主题：
- en: Building a scatter diagram
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 建立散点图
- en: Calculating the covariance
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算协方差
- en: Calculating the Pearson's coefficient of correlation
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算皮尔逊相关系数
- en: Studying the Spearman's correlation
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 研究斯皮尔曼相关系数
- en: Understanding least squares
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解最小二乘法
- en: Focusing on feature selection
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 专注于特征选择
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: You will need to download the `auto-mpg.xlsx` file from the GitHub repository
    at [https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter05](https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter05)[.](https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter05)
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要从GitHub仓库[https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter05](https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter05)下载`auto-mpg.xlsx`文件[.]。
- en: Building a scatter diagram
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 建立散点图
- en: First, load the `auto-mpg.xlsx` file. We will use the data in it to illustrate
    different aspects of this chapter. The meaning of the variables are described
    in the Excel file and in its references.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，加载`auto-mpg.xlsx`文件。我们将使用其中的数据来展示本章的不同方面。变量的含义在Excel文件及其参考中描述。
- en: The simplest way of assessing correlations between variables is to create a
    scatter diagram, taking all features in pairs. If we plot, for example, the `Cylinders` variable
    in the *x *axis against the `Displacement` variable in the *y *axis, we will see
    a *positive* *correlation* (that is, the greater the number of cylinders the higher
    the displacement value). This is to be expected, since the calculation of the
    engine displacement, here expressed in cubic inches, is linearly dependent on
    the number of cylinders.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 评估变量之间相关性的最简单方法是创建一个散点图，将所有特征成对展示。例如，如果我们把`Cylinders`变量放在*x*轴上，与*y*轴上的`Displacement`变量作图，我们会看到一个*正相关*（即，气缸数量越多，排量值越高）。这是可以预料的，因为发动机排量的计算（这里以立方英寸表示）与气缸数量呈线性相关。
- en: 'The scatter diagram can be seen in the following diagram:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 散点图可以在以下图表中看到：
- en: '![](img/cbb435b0-cc7e-46b7-b0c1-756db3eb7a9f.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/cbb435b0-cc7e-46b7-b0c1-756db3eb7a9f.png)'
- en: 'If we, instead, look at the relationship between fuel consumption and car weight,
    the diagram will be similar to the following:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们观察燃油消耗与汽车重量之间的关系，图表将类似于以下：
- en: '![](img/7290f2f2-a217-4d79-b998-542b38460ff8.png)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/7290f2f2-a217-4d79-b998-542b38460ff8.png)'
- en: In this case, there is a negative correlation between the weight of the car
    and the number of miles per fuel gallon (that is, the heavier the car, the fewer
    number of miles it can run on a gallon of fuel). We also notice that the correlation
    is non-linear, meaning that a straight line will not describe the relationship
    between these variables.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，汽车的重量和每加仑燃油行驶的英里数之间存在负相关性（也就是说，汽车越重，每加仑燃油能行驶的英里数就越少）。我们还注意到，这种相关性是非线性的，这意味着直线不能描述这些变量之间的关系。
- en: 'So, what if we plot two uncorrelated variables? Could there be any correlation
    between, for example, the number of cylinders in the engine and the year that
    the car was manufactured? Let''s take a look at the following diagram:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如果我们绘制两个不相关的变量会怎样呢？例如，发动机的气缸数和汽车制造的年份之间是否存在任何相关性？让我们看一下下面的图表：
- en: '![](img/b9267c13-4116-4d9c-81da-a133e48cbeae.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/b9267c13-4116-4d9c-81da-a133e48cbeae.png)'
- en: Here, we notice that cars with **3** or **5** cylinders were not very common
    in the time period that we are analyzing, as there are only a few examples of
    them. Years **78** to **80** seem to be the **5**-cylinder engine period, but,
    apart from these facts, there were also **4**-, **6**-, and **8**-cylinder engines
    being produced for each year of our dataset. There is no clear correlation between
    these two variables, and one of them cannot give us any information about the
    other.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们注意到，在分析的时间段内，**3**或**5**气缸的汽车并不常见，因为它们的例子很少。**78**到**80**年似乎是**5**气缸发动机的时期，但除了这些事实之外，还有**4**、**6**和**8**气缸发动机在数据集中的每一年都在生产。这两个变量之间没有明显的相关性，其中一个变量不能给我们关于另一个变量的任何信息。
- en: 'This method of finding correlations in scatter diagrams is fine if we have
    a few variables, but the number of diagrams needs scales fast. In fact, if the
    number of variables is *N[v]*, then the number of combinations needed to see all
    correlations is as follows:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们只有几个变量，这种在散点图中寻找相关性的方法是好的，但图表的数量需要快速增加。事实上，如果变量的数量是*N[v]*，那么查看所有相关性的组合数量如下：
- en: '*N[v ]* (N[v ]-1)*'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '*N[v ]* (N[v ]-1)*'
- en: Even with a small dataset such as ours, to include 8 numerical variables, we
    need 28 diagrams to cover all the possible combinations. If we were to have hundreds
    of variables, then the task of finding which variables are correlated by eye is
    simply impossible. In the next section, we will describe methods to automatically
    calculate correlations, making it possible to deal with big datasets and a large
    number of features.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 即使像我们这样的小数据集，要包含8个数值变量，我们也需要28个图表来覆盖所有可能的组合。如果我们有数百个变量，那么通过肉眼找到相关变量的任务将变得简单不可能。在下一节中，我们将描述自动计算相关性的方法，使其能够处理大数据集和大量特征。
- en: Calculating the covariance
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 计算协方差
- en: 'We need to define a statistical method that quantitatively measures the degree
    of association between two features. The covariance of two variables does exactly
    that, so let''s see how it is calculated. If there are two variables, *x* and
    *y*, we first center their values around their mean values, ![](img/69efd6ca-3339-4487-b25a-d98481e9c20a.png) and ![](img/11a5b30d-ca86-4e2c-8eae-20607818ddf9.png);
    then, we multiply the new values and take the mean of the product:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要定义一种统计方法，定量地衡量两个特征之间的关联程度。两个变量的协方差正是这样做的，那么让我们看看它是如何计算的。如果有两个变量，*x*和*y*，我们首先将它们的值围绕它们的平均值进行中心化，![](img/69efd6ca-3339-4487-b25a-d98481e9c20a.png)和![](img/11a5b30d-ca86-4e2c-8eae-20607818ddf9.png)；然后，我们乘以新的值并取乘积的平均值：
- en: '![](img/de5b5ebf-f471-42fa-9bb1-ebd671867b85.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/de5b5ebf-f471-42fa-9bb1-ebd671867b85.png)'
- en: This definition implies that if both variables increase or decrease at the same
    time, then the covariance is positive, whereas if they move in opposite directions,
    then the covariance is negative. If there is no correlation, the covariance value
    will be small, that is, close to zero.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 这种定义意味着如果两个变量同时增加或减少，那么协方差是正的，而如果它们朝相反的方向移动，那么协方差是负的。如果没有相关性，协方差值将很小，即接近零。
- en: It is also clear from the definition that, since the variables keep their scale,
    it is difficult to compare features that have very different mean values and it
    is impossible to compare two covariances.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 从定义中也很清楚，由于变量保持了它们的尺度，比较具有非常不同平均值的特征很困难，比较两个协方差也是不可能的。
- en: It is easy to calculate covariances in Excel by using the Data analysis add-in
    (we explain how to activate it in the Appendix).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在Excel中，通过使用数据分析插件（我们将在附录中解释如何激活它）可以轻松计算协方差。
- en: 'To calculate the covariances, perform the following steps:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 要计算协方差，请执行以下步骤：
- en: Open the data file.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开数据文件。
- en: Navigate to Data | Data Analysis.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到数据 | 数据分析。
- en: 'In the pop-up window, select Covariance, as shown in the following screenshot:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在弹出窗口中，选择协方差，如图下所示：
- en: '![](img/3188dae5-2b12-4074-86b5-6c369067ca59.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/3188dae5-2b12-4074-86b5-6c369067ca59.png)'
- en: 'Select the data range; in this case, it is the whole table except the last
    column, which contains the car name and is non-numeric:'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择数据范围；在这种情况下，它是除了最后一列之外的全部表格，最后一列包含汽车名称，是非数值的：
- en: '![](img/b25c1e26-4f31-45d5-996d-9413910fc748.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/b25c1e26-4f31-45d5-996d-9413910fc748.png)'
- en: 'The result is the following table:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 结果如下表所示：
- en: '![](img/d68062e0-ddfb-4091-a3f1-999cecaf14d8.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/d68062e0-ddfb-4091-a3f1-999cecaf14d8.png)'
- en: We can see a positive covariance value between `displacement` and `cylinders`,
    and a negative value between `weight` and `mpg`. We cannot say much more, since
    comparing the values is impossible, as we explained previously. The big change
    here is that we calculated all that values at the same time, and so we don't need
    to watch the diagrams one by one. The matrix is symmetrical, so only one half
    is shown.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到`位移`和`汽缸数`之间存在正协方差值，而`重量`和`mpg`之间存在负值。由于我们之前解释过，比较这些值是不可能的，所以我们不能说更多。这里的大变化是我们同时计算了所有这些值，所以我们不需要逐个查看图表。矩阵是对称的，所以只显示了其中一半。
- en: There is a way to quantify correlations and compare them, and it was developed
    by Karl Pearson in the 1880s. Let's explore it in more detail in the next section.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 有一种方法可以量化相关性并比较它们，这是卡尔·皮尔逊在19世纪80年代开发的。让我们在下一节中更详细地探讨它。
- en: Calculating the Pearson's coefficient of correlation
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 计算皮尔逊相关系数
- en: 'The Pearson''s coefficient is most commonly used when comparing two variables
    and it works by measuring the linear relationship between them. The original definition
    given by Pearson is as follows:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 皮尔逊系数在比较两个变量时最常用，它通过测量它们之间的线性关系来工作。皮尔逊给出的原始定义如下：
- en: '![](img/2171e11a-435a-4b49-96bd-f7cbcb0ce262.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/2171e11a-435a-4b49-96bd-f7cbcb0ce262.png)'
- en: The numerator is proportional to the covariance, and the denominator is the
    product of the standard deviations (σ) of the centered variables. This normalization
    ensures that the limits in the possible values of *ρ* are *-1* and *1*.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 分子与协方差成正比，分母是中心变量的标准差（σ）的乘积。这种归一化确保了*ρ*可能值的范围在*-1*和*1*之间。
- en: We can repeat the steps outlined in the *Calculating the covariance* section
    to calculate the Pearson correlation in Excel by selecting Correlation in the
    pop-up window.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过重复在*计算协方差*部分中概述的步骤，通过在弹出窗口中选择相关性来在Excel中计算皮尔逊相关系数。
- en: 'The resulting table is as follows:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 结果表如下所示：
- en: '![](img/8ea53abc-e1dc-4de7-849a-817a21ec4bcd.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/8ea53abc-e1dc-4de7-849a-817a21ec4bcd.png)'
- en: The cells containing a value of `1` represent the linear relationship between
    itself and each variable. A negative correlation implies, again, that one variable
    increases while the other decreases, while a positive correlation implies that
    both variables change in the same direction.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 包含值为`1`的单元格表示自身与每个变量之间的线性关系。负相关性再次表明一个变量增加而另一个变量减少，而正相关性表明两个变量在同一方向上变化。
- en: Pearson's coefficient is good for comparing feature relationships. For example,
    we can see that `cylinders` and `displacement` are more linearly correlated (by
    the definition of displacement, in fact) than `weight` and `mpg`, even when the
    ones in the second pair are related.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 皮尔逊系数非常适合比较特征关系。例如，我们可以看到`汽缸数`和`位移`比`重量`和`mpg`更线性相关（根据位移的定义，实际上），即使第二对中的那些相关。
- en: 'Another definition for the Pearson coefficient is as follows:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 皮尔逊系数的另一个定义如下：
- en: '![](img/94bae1ba-6a8f-4afe-8364-eac87f254abe.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/94bae1ba-6a8f-4afe-8364-eac87f254abe.png)'
- en: Here, *b* is the slope of the linear regression that best fits *x* versus *y*,
    and *σ[i]* are the standard deviations of *x* and *y*. This definition clearly
    shows that the coefficient measures the linearity of the relationship and, at
    the same time, how much the two features can vary.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*b*是最佳拟合线性回归的斜率，该回归拟合*x*与*y*，而*σ[i]*是*x*和*y*的标准差。这个定义清楚地表明，系数衡量关系的线性程度，同时衡量两个特征可以变化的程度。
- en: So, what if the relationship is not linear? In the next section, we can discuss
    another coefficient that will help us calculate a non-linear correlation.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如果关系不是线性的会怎样？在下一节中，我们可以讨论另一个系数，它将帮助我们计算非线性相关性。
- en: Studying the Spearman's correlation
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 研究Spearman相关系数
- en: To calculate the Spearman's coefficient, we need to first rank the values of
    each variable, that is, the order of the values when we sort them from highest
    to lowest. Once we have the new table, we will calculate Pearson's *ρ* on it.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 要计算Spearman系数，我们首先需要为每个变量的值进行排名，即从最高到最低排序时的值顺序。一旦我们有了新的表格，我们将在其上计算皮尔逊的ρ。
- en: 'In a new sheet, we define the following formula in a cell:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个新的工作表中，我们在一个单元格中定义以下公式：
- en: '*=RANK.AVG(Data!A2;auto_mpg[mpg])*'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '*=RANK.AVG(Data!A2;auto_mpg[mpg])*'
- en: 'Here, we are asking Excel to write in that cell the ranking corresponding to
    the first cell of the `mpg` column in our data table, taking into account the
    full range of the column. We copy the formula to the cells on the right until
    we complete the number of columns of the data table (8 columns). It doesn''t matter
    if you copy the formula to an extra cell – you will just get an error message
    since you are out of the data table range. In a similar way, we can copy the formulas
    to the remaining rows until we get to row **399** (the vertical range of the data
    table). We can even add a title to the new columns by using the following formula:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们要求Excel在单元格中写入与我们数据表中`mpg`列的第一个单元格相对应的排名，考虑到该列的全范围。我们将公式复制到右侧的单元格中，直到完成数据表列数（8列）。即使你复制公式到额外的单元格，也不会影响结果——你只会得到一个错误信息，因为你超出了数据表的范围。以类似的方式，我们可以将公式复制到剩余的行中，直到我们到达第**399**行（数据表的垂直范围）。我们甚至可以使用以下公式为新列添加标题：
- en: '*=CONCAT("Rank_";auto_mpg[[#Headers];[mpg]])*'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '*=CONCAT("Rank_";auto_mpg[[#Headers];[mpg]])*'
- en: Then, we copy it to all the cells in the first row.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将它复制到第一行的所有单元格中。
- en: 'A sample of the table that we obtain is as follows:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 我们获得表格的一个样本如下：
- en: '![](img/b8b0b6ca-d128-4561-a8c5-5bf4a2206932.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b8b0b6ca-d128-4561-a8c5-5bf4a2206932.png)'
- en: 'Because `horsepower`is missing some values, they cannot be ranked and so appear
    as `#N/A`*.* Since there are only a few of them, we can remove them manually.
    This will avoid errors when calculating the Pearson coefficient in the next step, exactly
    as we did before; the result is as follows:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 因为`horsepower`缺失一些值，它们无法排名，因此显示为`#N/A`*.* 由于这些值很少，我们可以手动删除它们。这将避免在计算下一步的皮尔逊系数时出错，正如我们之前所做的那样；结果是如下：
- en: '![](img/33243ad4-e948-4605-bacf-f5af6f1fe46b.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![](img/33243ad4-e948-4605-bacf-f5af6f1fe46b.png)'
- en: We get similar values to that of the Pearson's coefficients, but they are slightly
    higher when there is a non-linear but strong correlation.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到与皮尔逊系数相似的结果，但在非线性但相关性强的情形下，它们会略高一些。
- en: 'Spearman is only close to **1** if the correlation is monotonically increasing
    or decreasing. This is better shown in the following screenshot:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 当相关系数单调递增或递减时，Spearman系数才接近**1**。这可以在以下屏幕截图中更好地展示：
- en: '![](img/942e1f3a-667e-410d-8b06-41966fc144d5.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/942e1f3a-667e-410d-8b06-41966fc144d5.png)'
- en: In the first diagram, Pearson is high, since the relationship can be adjusted
    by a straight line, even if it is not the best fit. Spearman is **1** since there
    is a relationship and it is monotonically increasing. The second diagram shows
    a relationship with an abrupt change, giving a small value for both coefficients.
    The third diagram shows a quadratic relationship between variables, which is neither
    linear nor monotonic. Looking at the three examples, we can understand that coefficients
    don't always give all the necessary information about the correlation between
    variables, but they are useful to get a general idea.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个图表中，皮尔逊系数较高，因为关系可以通过直线调整，即使它不是最佳拟合。Spearman系数为**1**，因为存在关系且它是单调递增的。第二个图表显示了具有突然变化的关系，两个系数都给出了较小的值。第三个图表显示了变量之间的二次关系，它既不是线性的也不是单调的。通过观察这三个例子，我们可以理解系数并不总是提供关于变量之间相关性的所有必要信息，但它们对于获得一个总体概念是有用的。
- en: Understanding least squares
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解最小二乘法
- en: 'In some instances, we might want to prove that there is a functional relationship
    between two variables and, hence, just use one of them in our model – since the
    other can be easily approximated by an expression. In this case, it is useful
    to rely on the least squares method. Given a set of points (*x[i],y[i]*) and a
    function such as *y''[i] = f(x[i])*, this method minimizes the square of the differences
    between *y''[i]* and *y[i]*. The general expression for the minimization that
    we are calculating is as follows:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，我们可能想要证明两个变量之间存在函数关系，因此只需在我们的模型中使用其中一个变量——因为另一个可以通过一个表达式轻松近似。在这种情况下，使用最小二乘法是有用的。给定一组点
    (*x[i],y[i]*) 和一个函数，如 *y'[i] = f(x[i])*，这种方法最小化 *y'[i]* 和 *y[i]* 之间的差的平方。我们正在计算的优化的一般表达式如下：
- en: '![](img/e1580832-57ab-4e80-9900-c20bd1c646d9.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e1580832-57ab-4e80-9900-c20bd1c646d9.png)'
- en: 'We will use two columns from our data table, namely `weight` and `mpg`:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用数据表中的两列，即“重量”和“mpg”：
- en: Create a new table in a new sheet.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在新工作表中创建一个新的表格。
- en: Copy the values of the `weight` and `mpg` columns.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制“重量”和“mpg”列的值。
- en: 'Order the rows by the value of `weight`; the resulting table is as follows:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照重量值对行进行排序；结果表格如下：
- en: '![](img/0e981124-8900-4e46-9cdb-c7cae4f4f009.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0e981124-8900-4e46-9cdb-c7cae4f4f009.png)'
- en: 'Insert a line chart to see what the functional relationship looks like, as
    follows:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 插入一个折线图来查看函数关系看起来像什么，如下所示：
- en: '![](img/406a31b6-bcca-4f3e-babb-ea52ab3d1997.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![](img/406a31b6-bcca-4f3e-babb-ea52ab3d1997.png)'
- en: Let's say that we assume that *mpg = A*weight^(-b)* and try to find the constants, *a*
    and *b*.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们假设 *mpg = A*weight^(-b)* 并尝试找到常数 *a* 和 *b*。
- en: 'Create a new column, `prediction`, using the following formula:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下公式创建一个新的列，名为“预测”：
- en: '*=$H$2*POWER([@weight];$H$3)*'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '*=$H$2*POWER([@weight];$H$3)*'
- en: 'The resulting table is as follows:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 结果表格如下：
- en: '![](img/47292ee2-d5eb-41a2-b63e-84b02b6efbff.png)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![](img/47292ee2-d5eb-41a2-b63e-84b02b6efbff.png)'
- en: In order to fill the table, we choose the initial values of *a = 60* (in cell
    *H2*) and *b = -0.5* (in cell *H3*). These will be the starting points of the
    least squares method.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了填充表格，我们选择 *a = 60*（在单元格 *H2* 中）和 *b = -0.5*（在单元格 *H3* 中）的初始值。这些将是最小二乘法的起点。
- en: 'The quantity to minimize is the sum of the squares of the errors. To calculate
    it, we create a new column, `Squared error`, with the following formula:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要最小化的量是误差平方和。为了计算它，我们创建一个新的列，名为“平方误差”，使用以下公式：
- en: '*=([@mpg]-[@prediction])^2*'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '*=([@mpg]-[@prediction])^2*'
- en: 'Then, use the following formula to sum all the values in that column in a cell:'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，使用以下公式在一个单元格中对该列的所有值进行求和：
- en: '*=SUM(Table9[Squared error])*'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '*=SUM(Table9[Squared error])*'
- en: 'Navigate to Data | Solver; if you cannot see this option, please refer to the
    Appendix for instructions on how to activate Solver. You will see the following
    window pop up on your screen:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到“数据”|“求解器”；如果您看不到此选项，请参阅附录中如何激活求解器的说明。您将在屏幕上看到一个以下窗口弹出：
- en: '![](img/7aef1ec0-6598-4927-a310-1f6e1b31b3a2.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7aef1ec0-6598-4927-a310-1f6e1b31b3a2.png)'
- en: The Set Objective option is filled with the cell ID where we calculated the
    sum of the squared errors, and the By Changing Variable Cells option is filled
    with the ID of the two cells containing the values of *a* and *b*. We can leave
    the rest of the parameters as their default value settings.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: “设置目标”选项填写了我们计算平方误差和的单元格ID，而“通过更改变量单元格”选项填写了包含 *a* 和 *b* 值的两个单元格的ID。我们可以将其他参数保留为默认值设置。
- en: 'Click on Solve; if the regression converges, then you will see the following
    window:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“求解”；如果回归收敛，你将看到以下窗口：
- en: '![](img/0684e405-de49-43f1-b240-b8ba8e9df0a9.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0684e405-de49-43f1-b240-b8ba8e9df0a9.png)'
- en: Choose Keep Solver Solution to replace the values of *a* and *b* by the ones
    calculated, and get new values for all predictions.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择“保持求解器解决方案”以用计算出的值替换 *a* 和 *b*，并获取所有预测的新值。
- en: 'If we include the real values and the prediction in the same diagram, you should
    see something similar to the following screenshot:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们将实际值和预测值放在同一个图表中，你应该会看到以下截图类似的内容：
- en: '![](img/21a796f8-d911-490e-a168-808e667456bb.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](img/21a796f8-d911-490e-a168-808e667456bb.png)'
- en: So, the adjusted function of the data points is approximately *mpg = 68564/weight*.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，数据点的调整函数大约为 *mpg = 68564/重量*。
- en: This adjustment is not precise due to the large dispersion in the y variable,
    but it could be used as a quick estimation of the fuel consumption, given the
    weight of the car.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 由于y变量的大分散性，这种调整并不精确，但考虑到汽车重量，它可以作为燃油消耗的快速估算。
- en: We have explored a number of methods for finding correlated variables. This
    is useful for understanding which ones are related and which ones are redundant.
    The next section explains how to use this knowledge to simplify the input to our
    machine learning models.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经探索了多种寻找相关变量的方法。这有助于理解哪些是相关的，哪些是冗余的。下一节将解释如何使用这些知识来简化机器学习模型的输入。
- en: Focusing on feature selection
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 专注于特征选择
- en: As we mentioned previously, none of these described methods will tell us precisely
    how to choose the input features by themselves. It is true that in some particular
    cases, if the correlations are strong enough, we could discard one or more features
    and just keep the ones that represent them by correlation. In general, feature
    engineering is a long and time-consuming task that became almost a separate field
    of study within machine learning.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们之前提到的，这些描述的方法本身都不能精确地告诉我们如何选择输入特征。确实，在某些特定情况下，如果相关性足够强，我们可以丢弃一个或多个特征，只保留那些通过相关性代表它们的特征。通常，特征工程是一个漫长且耗时的工作，在机器学习领域几乎成为了一个独立的研究领域。
- en: There are automatic techniques to perform feature engineering, which are part
    of what is generically called **Automatic Machine Learning** (**AutoML**). The
    method consists of letting the computer try different feature sets, including
    combinations of them, and test the results until the best set is found. In spite
    of this, there is no general recipe for selecting features, and each problem has
    to be analyzed—in particular, finding the set of features that lead to a better
    model training and predictive power.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 存在自动技术来执行特征工程，这是通常被称为**自动机器学习**（**AutoML**）的一部分。该方法包括让计算机尝试不同的特征集，包括它们的组合，并测试结果，直到找到最佳集。尽管如此，没有通用的特征选择配方，每个问题都需要分析——特别是找到导致更好的模型训练和预测能力的特征集。
- en: Summary
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we described the most widely used methods to establish correlations
    between variables, which will later be used as features in a machine learning
    model. This is a long and difficult task, but is the basis of a good predictive
    model.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们描述了建立变量之间相关性的最广泛使用的方法，这些方法将后来用作机器学习模型中的特征。这是一个漫长且困难的任务，但它是良好预测模型的基础。
- en: No method can be used alone to determine which features are important and which
    can be discarded. A combination of methods, plus a deep knowledge of the dataset,
    are fundamental to complete this task.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 没有一种方法可以单独用来确定哪些特征是重要的，哪些可以被丢弃。结合方法以及对该数据集的深入了解是完成此任务的基础。
- en: In the next chapter, we will leave the preliminary tasks and start focusing
    on some real use cases of the machine learning models.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将结束初步任务，开始关注机器学习模型的实际应用案例。
- en: Questions
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: What method would be better to find a correlation between a numerical and a
    categorical variable?
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 哪种方法更适合寻找数值变量和分类变量之间的相关性？
- en: Build some other plot graphs between a pair of variables and study the correlations
    and the logic behind them.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在一对变量之间构建一些其他图表，并研究它们之间的相关性及其背后的逻辑。
- en: Does a negative Pearson coefficient value imply that one of the variables has
    negative values?
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 负的皮尔逊系数值是否意味着其中一个变量具有负值？
- en: The table of the Pearson's coefficient can be colored or have bars added to
    it in order to better compare the different values. Explore these options in Quick
    Analysis | Formatting.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 皮尔逊相关系数表可以通过着色或添加条形来更好地比较不同值。在快速分析 | 格式化中探索这些选项。
- en: 'The quality of the least square regression is usually measured by the value
    of R². Calculate this value for the function that was adjusted in the `mpg` column
    versus the `weight` data value (hint: you only need to calculate one more sum
    of values – refer to the literature for more information).'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最小二乘回归的质量通常通过R²值来衡量。计算调整后的`mpg`列与`weight`数据值对应的函数的此值（提示：你只需要计算一个额外的值总和 - 参考文献以获取更多信息）。
- en: The value that was calculated in the previous question should be close to 0.7,
    which is not good enough to prove that the function reproduces the data well.
    Try a different function and see what the result is.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在上一个问题中计算出的值应该接近0.7，这不足以证明函数很好地复制了数据。尝试不同的函数并查看结果。
- en: Further reading
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: '*Statistics: A Gentle Introduction*, written by Frederick L. Coolidge (refer
    to Chapter 6 and the references within)'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*《统计学：温和的介绍》*，由Frederick L. Coolidge撰写（参考第6章及其参考文献）'

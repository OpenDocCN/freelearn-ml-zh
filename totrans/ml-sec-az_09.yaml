- en: '9'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '9'
- en: Logging, Monitoring, and Threat Detection
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 日志记录、监控和威胁检测
- en: Following best practices is not enough. The threat landscape changes every day
    and adversaries find new ways to gain access to our resources. Monitoring the
    safeguards we have put in place is vital to maintaining our security posture.
    In this chapter, we will see how to monitor our resources and see how effective
    our security measures are in preventing and detecting threats. We will learn how
    Azure Monitor works and how to configure logging, retention, and notifications.
    Finally, we will explore some features of Defender for Cloud and Microsoft Sentinel
    that can further help us protect our resources and mitigate threats even in real
    time.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 仅遵循最佳实践是不够的。威胁领域每天都在变化，对手找到新的方法来访问我们的资源。监控我们已实施的保障措施对于维护我们的安全态势至关重要。在本章中，我们将了解如何监控我们的资源，并查看我们的安全措施在防止和检测威胁方面的有效性。我们将学习
    Azure Monitor 的工作原理以及如何配置日志记录、保留和通知。最后，我们将探索 Defender for Cloud 和 Microsoft Sentinel
    的某些功能，这些功能可以帮助我们进一步保护资源并减轻威胁，甚至在实时中。
- en: 'In this chapter, we’re going to cover the following main topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主要主题：
- en: Enabling logging and configuring data retention for Azure services
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启用日志记录并配置 Azure 服务的数据保留
- en: Securing resources with Microsoft Defender
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Microsoft Defender 保护资源
- en: Exploring threat management with Sentinel
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Sentinel 探索威胁管理
- en: By the end of this chapter, we will be able to set up alerts, create analytics
    queries, improve our organization’s security posture, and see what the next steps
    are in skilling up to mitigate threats in real time.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，我们将能够设置警报、创建分析查询、提高我们组织的网络安全态势，并了解在实时减轻威胁方面的下一步是什么。
- en: Technical requirements
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: Although this chapter deals mostly with monitoring and logging, knowing the
    **Kusto Query Language** (**KQL**) might come in handy when implementing solutions.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然本章主要涉及监控和日志记录，但在实施解决方案时，了解 **Kusto 查询语言**（**KQL**）可能会很有用。
- en: KQL is a query language used to query, analyze, and visualize large datasets
    stored in Azure Data Explorer, Azure Monitor, Microsoft Sentinel, and Application
    Insights. KQL is a powerful language that allows you to perform various operations
    on your data, including filtering, aggregating, joining, and visualizing it.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: KQL 是一种查询语言，用于查询、分析和可视化存储在 Azure Data Explorer、Azure Monitor、Microsoft Sentinel
    和 Application Insights 中的大数据集。KQL 是一种强大的语言，允许您对数据进行各种操作，包括过滤、聚合、连接和可视化。
- en: KQL learning resources
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: KQL 学习资源
- en: 'Some resources to learn KQL can be found here: https://learn.microsoft.com/en-us/azure/data-explorer/kql-learning-resources.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 可以在这里找到学习 KQL 的资源：https://learn.microsoft.com/en-us/azure/data-explorer/kql-learning-resources。
- en: Enabling logging and configuring data retention for Azure services
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用日志记录并配置 Azure 服务的数据保留
- en: As soon as we create an Azure subscription, we get full monitoring capabilities
    with the **Azure Monitor** service. This is a service where we do not need to
    enable or do any action, it is automatically available for our subscriptions.
    Although it provides us with full stack monitoring and advanced analytics, there
    are different things we can do with services that work on top of Azure Monitor.
    Azure Monitor can monitor and combine data in Azure, on-premises, and other clouds.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们创建了一个 Azure 订阅，我们就可以通过 **Azure Monitor** 服务获得完整的监控能力。这是一个我们无需启用或执行任何操作的服务，它自动对我们订阅可用。尽管它为我们提供了完整的堆栈监控和高级分析，但我们可以使用在
    Azure Monitor 之上工作的服务做不同的事情。Azure Monitor 可以监控和组合 Azure、本地和其它云中的数据。
- en: 'You can access the Azure Monitor service by searching for `monitor` on the
    search bar and clicking on the resource. In this blade, you will see all Monitor
    has to offer:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过在搜索栏中搜索 `monitor` 并点击资源来访问 Azure Monitor 服务。在这个页面上，您将看到 Monitor 提供的所有内容：
- en: '![Figure 9.1 – An Azure Monitor overview](img/B21076_09_1.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.1 – Azure Monitor 概览](img/B21076_09_1.jpg)'
- en: Figure 9.1 – An Azure Monitor overview
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.1 – Azure Monitor 概览
- en: Let us see the key components of Azure Monitor.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看 Azure Monitor 的关键组件。
- en: Working with Azure Monitor
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Azure Monitor
- en: There are two types of data Monitor gathers, **metrics** and **logs**. Metrics
    are numerical values that represent various aspects of the performance and health
    of Azure resources at a specific point in time. These metrics provide real-time
    data about how a resource is functioning and can be used to monitor and troubleshoot
    applications and infrastructure in Azure. Azure Monitor collects a wide range
    of metrics, including performance indicators such as CPU usage, memory usage,
    network traffic, and disk activity. These metrics are specific to different types
    of resources, such as virtual machines, databases, and web apps.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 监控器收集两种类型的数据，**指标**和**日志**。指标是表示特定时间点Azure资源性能和健康状况的数值。这些指标提供了关于资源如何运行的实时数据，可用于监控和解决Azure中的应用程序和基础设施问题。Azure
    Monitor收集了广泛的指标，包括性能指标，如CPU使用率、内存使用率、网络流量和磁盘活动。这些指标针对不同类型的资源，如虚拟机、数据库和Web应用程序。
- en: Metrics in Azure Monitor are collected at different time frames, depending on
    the type of resource. For example, some metrics might be collected every minute,
    while others might be collected every hour. Metrics collected by Azure Monitor
    metrics are also used in Azure autoscale to automatically adjust the number of
    resources in a resource group, based on demand. Data is retained in the service
    for 90 days. For longer retention, there are other services such as *Log Analytics*
    or infinite retention in a *Storage account* using the Azure APIs.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Monitor中的指标在不同的时间框架内收集，具体取决于资源类型。例如，某些指标可能每分钟收集一次，而其他指标可能每小时收集一次。Azure
    Monitor收集的指标也用于Azure自动扩展，根据需求自动调整资源组中的资源数量。数据在服务中保留90天。对于更长的保留期，还有其他服务，如*日志分析*或使用Azure
    API在*存储帐户*中的无限保留。
- en: 'In the following screenshot, we can see how metrics are visualized in graphs:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的截图中，我们可以看到指标如何在图表中可视化：
- en: '![Figure 9.2 – Azure Monitor metrics](img/B21076_09_2.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![图9.2 – Azure Monitor指标](img/B21076_09_2.jpg)'
- en: Figure 9.2 – Azure Monitor metrics
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.2 – Azure Monitor指标
- en: These graphs can be filtered and modified to show different metrics, can be
    used to generate alerts, and can be saved and added to Azure dashboards.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 这些图表可以过滤和修改以显示不同的指标，可用于生成警报，并可以保存并添加到Azure仪表板中。
- en: Azure Monitor also collects logs. Logs are records of events from various sources
    across your Azure subscriptions and tenants. Logs can be collected from a wide
    variety of sources, including Azure resources, guest operating systems, databases,
    security events, networking event applications, and custom logs from external
    sources that use APIs to import data.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Monitor还收集日志。日志是来自您Azure订阅和租户中各种来源的事件记录。日志可以从广泛的来源收集，包括Azure资源、虚拟机操作系统、数据库、安全事件、网络事件应用程序以及使用API导入数据的来自外部源的自定义日志。
- en: 'Logs and metrics work together in Azure Monitor. You can correlate metrics
    data with log data to gain a comprehensive view of the health and performance
    of your resources. We can view individual logs for each resource by going to the
    **Resource** blade and clicking on **Activity log**, as shown in the following
    screenshot:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 日志和指标在Azure Monitor中协同工作。您可以将指标数据与日志数据相关联，以全面了解您资源的健康和性能。我们可以通过访问**资源**选项卡并点击**活动日志**来查看每个资源的单个日志，如下面的截图所示：
- en: '![Figure 9.3 – Azure Monitor logs](img/B21076_09_3.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![图9.3 – Azure Monitor日志](img/B21076_09_3.jpg)'
- en: Figure 9.3 – Azure Monitor logs
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.3 – Azure Monitor日志
- en: The activity log is also available from the Monitor main page or the top bar
    in the Azure portal by clicking the bell icon. You can get metrics and logs via
    the Rest API and command-line tools.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 活动日志也可以通过Azure门户的主页或顶部栏中的铃声图标获取。您可以通过Rest API和命令行工具获取指标和日志。
- en: 'Monitor also has built-in RBAC roles when interacting with monitoring or **Log
    Analytics** data. Take a look at the following screenshot of the table to see
    what these roles can do:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 当与监控或**日志分析**数据交互时，监控器还内置了RBAC角色。请查看以下表格截图，了解这些角色可以做什么：
- en: '![Figure 9.4 – Azure Monitor RBAC](img/B21076_09_4.jpg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![图9.4 – Azure Monitor RBAC](img/B21076_09_4.jpg)'
- en: Figure 9.4 – Azure Monitor RBAC
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.4 – Azure Monitor RBAC
- en: Moving forward, let us see how we can query and gain insights from the logs
    using Log Analytics.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们看看如何使用日志分析查询和从日志中获得洞察。
- en: Setting up Log Analytics
  id: totrans-35
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置日志分析
- en: Azure Monitor holds data for 90 days as we saw previously. If we need to hold
    data for a longer time period, we can use Log Analytics. It is a powerful tool
    that helps us collect data from multiple sources and save it in one or more workspaces,
    which act as containers for our logs. They provide a scope for queries, views,
    and other configurations. We can have multiple workspaces to organize and manage
    log data from different sources. These queries can be visualized, exported, and
    saved for continuous monitoring. Azure Monitor Logs uses KQL to query and analyze
    log data. KQL is a powerful, SQL-like language specifically designed to query
    large datasets efficiently. It allows us to perform complex searches and analytics
    on our logs.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Azure Monitor 会保留数据 90 天。如果我们需要保留更长时间的数据，我们可以使用日志分析。这是一个强大的工具，可以帮助我们从多个来源收集数据，并将其保存到一个或多个工作区中，这些工作区充当日志的容器。它们为查询、视图和其他配置提供了范围。我们可以拥有多个工作区来组织和管理工作来自不同来源的日志数据。这些查询可以可视化、导出并保存以进行持续监控。Azure
    Monitor 日志使用 KQL 查询和分析日志数据。KQL 是一种类似于 SQL 的强大语言，专门设计用于高效查询大型数据集。它允许我们在日志上执行复杂的搜索和分析。
- en: 'To start collecting logs, we need to create a Log Analytics workspace. Search
    for `Log Analytics workspaces` and then click on **+ Create** to create a new
    workspace, as shown here:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始收集日志，我们需要创建一个日志分析工作区。搜索“日志分析工作区”，然后点击**+ 创建**以创建一个新的工作区，如图所示：
- en: '![Figure 9.5 – Azure Log Analytics workspaces](img/B21076_09_5.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.5 – Azure 日志分析工作区](img/B21076_09_5.jpg)'
- en: Figure 9.5 – Azure Log Analytics workspaces
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.5 – Azure 日志分析工作区
- en: On the creation form, fill in the name and the rest of the required information,
    and then click the **Review + Create** button to deploy the resource.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建表单中，填写名称和其他所需信息，然后点击**审查 + 创建**按钮以部署资源。
- en: '![Figure 9.6 – Create Log Analytics workspace](img/B21076_09_6.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.6 – 创建日志分析工作区](img/B21076_09_6.jpg)'
- en: Figure 9.6 – Create Log Analytics workspace
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.6 – 创建日志分析工作区
- en: Now that we have a Log Analytics workspace, all we need is some data. In the
    next section, let us see how to enable diagnostics settings for our Azure Machine
    Learning resource and send them to the workspace.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经有一个日志分析工作区，我们需要的只是一些数据。在下一节中，让我们看看如何为我们的 Azure 机器学习资源启用诊断设置并将它们发送到工作区。
- en: Enabling diagnostic settings
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启用诊断设置
- en: Azure diagnostic settings allow us to collect and route diagnostic data from
    various Azure resources to different destinations for analysis, monitoring, and
    compliance. This feature helps you gain insights into the performance and operational
    health of our resources and provides us with filtering and bigger retention, depending
    on what the destination is. Common destinations include an Azure **Storage account**,
    **Log****Analytics workspace**, and **Event Hubs**. We can send data to multiple
    destinations simultaneously. For example, we can send data to both, a Log Analytics
    workspace and an Azure Storage account, for redundancy or different types of analysis.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 诊断设置允许我们从各种 Azure 资源收集和路由诊断数据到不同的目的地进行分析、监控和合规性。此功能有助于我们深入了解资源的性能和运行状况，并根据目标提供过滤和更大的保留时间。常见的目的地包括
    Azure **存储帐户**、**日志分析工作区**和**事件中心**。我们可以同时发送数据到多个目的地。例如，我们可以将数据发送到日志分析工作区和 Azure
    存储帐户，以实现冗余或不同类型的分析。
- en: Let us enable **Diagnostic settings** on our Azure Machine Learning resource.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们在我们的 Azure 机器学习资源上启用**诊断设置**。
- en: 'To start, open your Azure Machine Learning resource, select **Diagnostic settings**,
    and click on **Add diagnostic setting**, as shown in the following screenshot:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，打开您的 Azure 机器学习资源，选择**诊断设置**，然后点击**添加诊断设置**，如图下所示：
- en: '![Figure 9.7 – Add diagnostic setting](img/B21076_09_7.jpg)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.7 – 添加诊断设置](img/B21076_09_7.jpg)'
- en: Figure 9.7 – Add diagnostic setting
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.7 – 添加诊断设置
- en: 'Select the log categories you are interested in and click to choose the destination
    details. For this one, we will use the **Log Analytics** resource we created in
    the previous section. Check the **Send to Log Analytics workspace** checkbox and
    provide the required details, as shown in the following screenshot. Then, click
    on **Save**:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 选择您感兴趣的日志类别，并点击选择目标详情。对于这个，我们将使用上一节中创建的**日志分析**资源。勾选**发送到日志分析工作区**复选框，并提供所需详情，如图下所示。然后，点击**保存**：
- en: '![Figure 9.8 – Selecting log categories and a destination](img/B21076_09_8.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.8 – 选择日志类别和目标](img/B21076_09_8.jpg)'
- en: Figure 9.8 – Selecting log categories and a destination
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: One of the most important reasons we have to enable additional logs and more
    data is to get notifications when something is happening in our system. Let us
    review how to set up alerts in Azure Monitor.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: Working with alerts
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Alerts help us to monitor and manage resources in Azure. We can use alerts and
    get notifications when certain conditions are met, which can help us proactively
    respond to issues or changes. There are a lot of components that go into creating
    and working with alerts, so let us see what they are.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: 'We will start by going to **Alerts** under the **Monitor** blade. Here, we
    can see **Alerts** that have been fired by priority and create new alerts:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: n
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 9.9 – Monitor | Alerts](img/B21076_09_9.jpg)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
- en: Figure 9.9 – Monitor | Alerts
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: However, before we dive into **Alerts** creation, let us review action groups.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: Creating an action group
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: It is better to create an action group before we create an alert. Action groups
    define a set of notifications and actions to be taken when an alert is triggered.
    This can include sending emails and SMS messages, making HTTP requests, and triggering
    Azure functions. We can create am action group directly from the alert form, but
    it makes things simpler if it already exists.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: Click on **Create**, and from the dropdown, choose **Action group**. This will
    take you to the **Create action group** form. Fill in some basic details, as shown
    in the following screenshot, and click **Next**.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 9.10 – The Create action group basic details](img/B21076_09_10.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
- en: Figure 9.10 – The Create action group basic details
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, in the **Notifications** tab, there are two types of notifications we
    can create – email to a specific role or email/send an SMS to a specific account/number.
    We will configure both options here. Choose **Email Azure Resource Manager Role**
    on the dropdown to reveal the menu on the right. Choose **Owner** as the role,
    and click **OK**. There are other options for the role to be notified, including
    **Contributor** and **Reader**. On this screen, you also need to provide a name:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 9.11 – Creating a role notification](img/B21076_09_11.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
- en: Figure 9.11 – Creating a role notification
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: 'On the next row, choose the second option of the **Email/SMS message/Push/Voice**
    dropdown to reveal the menu on the right. Here, the easiest way to get notifications
    is to provide an email or send a push notification to the Azure mobile app; however,
    there are more options available that might incur extra charges, such as **SMS**
    and **Voice**. Check the desired option and provide the necessary details. For
    example, in the **Email** section, you have to provide an individual email as
    shown here:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 9.12 – Creating an email notification](img/B21076_09_12.jpg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
- en: Figure 9.12 – Creating an email notification
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: 'If you need more roles or more emails, you can always add more rows and configure
    them accordingly. This is how it looks:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 9.13 – Multiple notifications enabled](img/B21076_09_13.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![图9.13 – 启用多个通知](img/B21076_09_13.jpg)'
- en: Figure 9.13 – Multiple notifications enabled
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.13 – 启用多个通知
- en: As soon as you are done, click **Next** to go to the next tab, **Actions**.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，点击**下一步**进入下一个标签页，**操作**。
- en: 'In the **Actions** tab, we can set up actions. Actions are not required; however,
    it is another way for doing both, sending a notification and triggering some other
    action in one step. Our options include the following, as shown in the following
    screenshot:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在**操作**选项卡中，我们可以设置操作。操作不是必需的；然而，这是在一步中同时发送通知和触发其他操作的方式。我们的选项包括以下内容，如以下截图所示：
- en: '![Figure 9.14 – Action types](img/B21076_09_14.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![图9.14 – 操作类型](img/B21076_09_14.jpg)'
- en: Figure 9.14 – Action types
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.14 – 操作类型
- en: 'We will not set anything, but let us review our options anyway. Some of these
    we have already seen in [*Chapter 8*](B21076_08.xhtml#_idTextAnchor176):'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将不会设置任何内容，但让我们仍然回顾一下我们的选项。其中一些我们在[*第8章*](B21076_08.xhtml#_idTextAnchor176)中已经见过：
- en: '**Automation Runbook**: Runbooks are a way to automate tasks in Azure. They
    are built using PowerShell, Python, or a graphical workflow designer. They can
    perform a wide range of tasks, from simple scripts to complex workflows involving
    multiple Azure services.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自动化运行手册**：运行手册是自动化Azure中任务的一种方式。它们使用PowerShell、Python或图形工作流设计器构建。它们可以执行从简单脚本到涉及多个Azure服务的复杂工作流的各种任务。'
- en: '**Azure Function**: This is a serverless compute service that allows us to
    run event-triggered code without having to explicitly provision or manage infrastructure.'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Function**：这是一个无服务器计算服务，允许我们在不显式配置或管理基础设施的情况下运行由事件触发的代码。'
- en: '**Event Hub**: This is designed to collect, process, and analyze large streams
    of events or data. An event hub can handle millions of events per second, making
    it a powerful tool to process high-throughput data streams.'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件中心**：这是设计用来收集、处理和分析大量事件或数据流。事件中心可以每秒处理数百万个事件，使其成为处理高吞吐量数据流的强大工具。'
- en: '**ITSM**: This is a way to integrate Azure Monitor alerts with **IT Service
    Management** (**ITSM**) tools such as ServiceNow or System Center Service Manager.
    It allows you to automatically create incidents or tickets in your ITSM system
    when specific conditions in your alerts are met.'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ITSM**：这是一种将Azure Monitor警报与IT服务管理（**ITSM**）工具（如ServiceNow或System Center
    Service Manager）集成的方法。它允许在您的警报中满足特定条件时，在您的ITSM系统中自动创建事件或工单。'
- en: '**Logic App**: This is a cloud-based workflow automation platform that enables
    you to automate and integrate various tasks and business processes across different
    applications and services, using a visual designer and connectors.'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**逻辑应用**：这是一个基于云的工作流自动化平台，使您能够使用可视化设计器和连接器自动化和集成不同应用程序和服务中的各种任务和业务流程。'
- en: '**Secure Webhook**/**Webhook**: Another way for an application to provide other
    apps with real-time information is by using a webhook.'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**安全Webhook**/**Webhook**：应用程序提供其他应用程序实时信息的另一种方式是通过使用webhook。'
- en: These are all our options under **Actions**. Depending on the specific case,
    we might need multiple action groups, and as soon as we have them in place, we
    are ready to start creating alert rules.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 这些都是在**操作**下的所有选项。根据具体情况，我们可能需要多个操作组，一旦我们设置了这些操作组，我们就可以开始创建警报规则。
- en: Creating alert rules
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建警报规则
- en: 'To create a new alert rule, click on **Create**, and on the dropdown, choose
    **Alert rules**. This will take us to the **Create an alert** **rule** form:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个新的警报规则，点击**创建**，然后在下拉菜单中选择**警报规则**。这将带我们到**创建警报规则**表单：
- en: '![Figure 9.15 – The Alerts blade](img/B21076_09_15.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![图9.15 – 警报选项卡](img/B21076_09_15.jpg)'
- en: Figure 9.15 – The Alerts blade
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.15 – 警报选项卡
- en: The first step is to choose the scope of the rule. This can be a subscription,
    a resource, or a resource group. Here, we can choose the Azure Machine Learning
    resource.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是选择规则的范围。这可以是一个订阅、一个资源或一个资源组。在这里，我们可以选择Azure机器学习资源。
- en: '![Figure 9.16 – Selecting a scope](img/B21076_09_16.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![图9.16 – 选择范围](img/B21076_09_16.jpg)'
- en: Figure 9.16 – Selecting a scope
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.16 – 选择范围
- en: 'On the second tab, we can select **Condition**. There are different types of
    conditions:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二个选项卡中，我们可以选择**条件**。有不同的条件类型：
- en: '**Based on metrics emitted by Azure resources**: For example, you can set an
    alert to trigger when CPU usage exceeds a certain threshold'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基于Azure资源发出的指标**：例如，您可以将警报设置为当CPU使用率超过某个阈值时触发。'
- en: '**Based on operations performed on resources**: For instance, you can set an
    alert to trigger when a specific type of operation occurs, such as a virtual machine
    being deleted'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基于对资源的操作**：例如，你可以设置一个警报，当发生特定类型的操作时触发，例如虚拟机的删除'
- en: '**Based on log queries against data collected by Azure Monitor Logs**: You
    can create complex queries to define the conditions for your alert'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**基于对Azure Monitor Logs收集的数据的日志查询**：你可以创建复杂的查询来定义警报的条件'
- en: 'Here, go to the **Select a signal** dropdown, and select the **All Administrative
    operations** option. This will send an alert for any administrative change on
    the Azure Machine Learning resource:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，转到**选择信号**下拉菜单，并选择**所有管理操作**选项。这将发送任何对Azure机器学习资源的行政变更警报：
- en: '![Figure 9.17 – Select a signal](img/B21076_09_17.jpg)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![图9.17 – 选择信号](img/B21076_09_17.jpg)'
- en: Figure 9.17 – Select a signal
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.17 – 选择信号
- en: 'Depending on the signal, you might get more options, such as frequency, but
    here, we have only a few in terms of **Alert logic**, as shown in the following
    screenshot. Leave the values as default and click **Next**:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 根据信号的不同，你可能会有更多选项，例如频率，但在这里，我们只有关于**警报逻辑**的少数几个选项，如下面的截图所示。保留默认值并点击**下一步**：
- en: '![Figure 9.18 – Alert logic](img/B21076_09_18.jpg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![图9.18 – 警报逻辑](img/B21076_09_18.jpg)'
- en: Figure 9.18 – Alert logic
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.18 – 警报逻辑
- en: 'On the **Actions** tab, choose the action group we created previously and click
    **Next**:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在**操作**选项卡中，选择我们之前创建的操作组并点击**下一步**：
- en: '![Figure 9.19 – Select action groups](img/B21076_09_19.jpg)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![图9.19 – 选择操作组](img/B21076_09_19.jpg)'
- en: Figure 9.19 – Select action groups
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.19 – 选择操作组
- en: 'On the **Details** tab, we can fill in some basic details to ensure that we
    can recognize the alert in the list, as shown in the following screenshot:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在**详细信息**选项卡中，我们可以填写一些基本详情以确保我们能在列表中识别出警报，如下面的截图所示：
- en: '![Figure 9.20 – The alert name and description](img/B21076_09_20.jpg)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![图9.20 – 警报名称和描述](img/B21076_09_20.jpg)'
- en: Figure 9.20 – The alert name and description
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.20 – 警报名称和描述
- en: Now that we have completed the configuration, all we have to do is wait for
    the alert to fire.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了配置，我们只需要等待警报触发。
- en: Let us see in the following section how we can manage multiple alerts.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将看到如何管理多个警报。
- en: Managing alerts
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 管理警报
- en: 'When events fire, you will get notified depending on how you have set up the
    action group. Another way to monitor alerts is from the **Alerts** menu in the
    **Monitor** blade, as shown in the following screenshot, where we can see an event
    firing. Alerts can be filtered by resource or severity:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 当事件触发时，你将根据你设置的操作组收到通知。另一种监控警报的方法是从**监控**选项卡中的**警报**菜单，如下面的截图所示，我们可以看到事件正在触发。警报可以根据资源或严重性进行筛选：
- en: '![Figure 9.21 – Alerts fired](img/B21076_09_21.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![图9.21 – 触发的警报](img/B21076_09_21.jpg)'
- en: Figure 9.21 – Alerts fired
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.21 – 触发的警报
- en: 'To ensure that not everyone works on the same alert, we can change the user
    response on this alert by clicking the three-dot menu on the right, switching
    from **New** to either **Acknowledged** or even **Closed**, as shown here:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保不是每个人都处理同一个警报，我们可以通过点击右侧的三点菜单，从**新建**切换到**已确认**或甚至**关闭**，来更改此警报的用户响应，如下面所示：
- en: '![Figure 9.22 – Changing a user response](img/B21076_09_22.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![图9.22 – 更改用户响应](img/B21076_09_22.jpg)'
- en: Figure 9.22 – Changing a user response
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.22 – 更改用户响应
- en: Remember that Azure Monitor alerts are a critical part of maintaining the health
    and performance of your Azure resources. Properly configured alerts can help you
    stay proactive in managing your resources and responding to any issues promptly.
    Although throughout this chapter we will see more ways to monitor our resources,
    this is the fastest and simplest way to get started.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，Azure Monitor警报是维护你的Azure资源健康和性能的关键部分。正确配置的警报可以帮助你保持积极主动地管理资源，并迅速响应任何问题。尽管在本章中我们将看到更多监控资源的方法，但这是最快、最简单的方法来开始。
- en: Now, let us see how to monitor our models and endpoints using Application Insights.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看如何使用Application Insights监控我们的模型和端点。
- en: Working with Application Insights
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Application Insights
- en: 'When we created a workspace, one of the associated resources was **Application
    Insights**. Application Insights works on top of Monitor and provides real-time
    monitoring of your applications. It tracks various metrics such as request rates,
    response times, failure rates, and dependencies. This helps you identify performance
    bottlenecks, errors, and exceptions. Applications Insights can help us troubleshoot
    ML endpoints deployed in **Azure Kubernetes Service** (**AKS**) or **Azure Container
    Instances** (**ACI**). Application Insights collects the following information:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们创建工作区时，其中一个相关资源是**应用洞察**。应用洞察在Monitor之上工作，提供对应用程序的实时监控。它跟踪各种指标，如请求率、响应时间、失败率和依赖关系。这有助于你识别性能瓶颈、错误和异常。应用洞察可以帮助我们排查部署在**Azure
    Kubernetes服务**（**AKS**）或**Azure容器实例**（**ACI**）中的ML端点。应用洞察收集以下信息：
- en: Exceptions
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 异常
- en: Responses
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 响应
- en: Output data
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出数据
- en: Request rates, response times, and failure rates
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求率、响应时间和失败率
- en: Dependency rates, response times, and failure rates
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 依赖率、响应时间和失败率
- en: Let us see how to enable Insights via the Azure Machine Learning Studio or the
    SDK.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何通过Azure机器学习Studio或SDK启用洞察。
- en: Configuring logging via the Studio and SDK
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 通过Studio和SDK配置日志
- en: 'In [*Chapter 1*](B21076_01.xhtml#_idTextAnchor015), we deployed a model to
    an ACI endpoint. In the model deployment screen, all we have to do to enable Application
    Insights is to expand the **Advanced** dropdown and check the **Enable Application
    Insights diagnostics and data collection** checkbox, as shown here:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在[*第一章*](B21076_01.xhtml#_idTextAnchor015)中，我们将一个模型部署到了ACI端点。在模型部署界面，要启用应用洞察，我们只需展开**高级**下拉菜单并勾选**启用应用洞察诊断和数据收集**复选框，如图所示：
- en: '![Figure 9.23 – Model deployment advanced settings](img/B21076_09_23.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![图9.23 – 模型部署高级设置](img/B21076_09_23.jpg)'
- en: Figure 9.23 – Model deployment advanced settings
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.23 – 模型部署高级设置
- en: Now, after deployment, we will get insights regarding this endpoint. If you
    are already using the SDK, the process might be simpler. Depending on the service,
    all you need to do is set the `enable_app_insights` flag to `true` or `false`
    to enable or disable logging, respectively.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在部署之后，我们将获得关于此端点的洞察。如果你已经在使用SDK，过程可能更简单。根据服务不同，你只需将`enable_app_insights`标志设置为`true`或`false`来分别启用或禁用日志记录。
- en: 'First, we need to get a reference to the web service and then update the flag,
    as shown in the following code snippet:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要获取Web服务的引用，然后更新标志，如下面的代码片段所示：
- en: '[PRE0]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Then, we can see the results in the **Applications Insights** resource blade:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以在**应用洞察**资源视图中查看结果：
- en: '![Figure 9.24 – Application Insights](img/B21076_09_24.jpg)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![图9.24 – 应用洞察](img/B21076_09_24.jpg)'
- en: Figure 9.24 – Application Insights
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.24 – 应用洞察
- en: Here, besides the logs and metrics available, we can integrate with DevOps,
    create a live metrics stream, and track users and sessions along with dependent
    apps and services. By clicking on **Logs**, we can run log analytics queries.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，除了可用的日志和指标外，我们还可以与DevOps集成，创建实时指标流，并跟踪用户和会话，以及依赖的应用和服务。通过点击**日志**，我们可以运行日志分析查询。
- en: 'Here is an example of a simple KQL query:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一个简单的KQL查询的示例：
- en: '[PRE1]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Let’s examine the query:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们分析一下查询：
- en: '`requests`: This is the table that contains information about all the HTTP
    requests made to your application.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`requests`：这是包含所有发送到你的应用程序的HTTP请求信息的表。'
- en: '`where timestamp > ago(24h)`: This line filters the requests to only include
    those that occurred in the last 24 hours. You can adjust the time frame as needed.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`where timestamp > ago(24h)`：这一行筛选出过去24小时内发生的请求。你可以根据需要调整时间范围。'
- en: '`where resultCode !startswith "2"`: This line filters for requests where `resultCode`
    does not start with `2`. This effectively filters for non-`2xx` status codes,
    which usually indicate an error.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`where resultCode !startswith "2"`：这一行用于筛选那些`resultCode`不以`2`开头的请求。这实际上筛选出了非`2xx`状态码的请求，通常表示错误。'
- en: '`project`: This selects specific columns to display in the result. You can
    adjust this to include more or fewer columns, depending on your needs.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`project`：这用于选择要在结果中显示的特定列。你可以根据需要调整它以包含更多或更少的列。'
- en: '`order by timestamp desc`: This line orders results by timestamp in descending
    order so that you see the most recent errors first.'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`order by timestamp desc`：这一行按时间戳降序排序结果，以便首先看到最新的错误。'
- en: This query will provide you with information about recent requests that resulted
    in errors, including details such as the timestamp, request name, URL, status
    code, operation ID, duration, and client type. Depending on what we need to monitor,
    we would need to change the query to the appropriate tables. On top of that, we
    can add our own custom exceptions to the logs.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 此查询将为您提供有关导致错误的最近请求的信息，包括时间戳、请求名称、URL、状态码、操作ID、持续时间以及客户端类型等详细信息。根据我们需要监控的内容，我们可能需要更改查询以适应适当的表。除此之外，我们还可以将自定义异常添加到日志中。
- en: The Application Insights API for custom events and metrics
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Application Insights API用于自定义事件和指标
- en: 'To ingest or send data to the Applications Insight resource, make sure you
    familiarize yourselves with the available API and SDKs here: [https://learn.microsoft.com/en-us/azure/azure-monitor/app/api-custom-events-metrics](https://learn.microsoft.com/en-us/azure/azure-monitor/app/api-custom-events-metrics).
    Application Insights also provides a dashboard to monitor everything.'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 要将数据摄取或发送到应用程序洞察资源，请确保您熟悉此处提供的可用API和SDK：[https://learn.microsoft.com/en-us/azure/azure-monitor/app/api-custom-events-metrics](https://learn.microsoft.com/en-us/azure/azure-monitor/app/api-custom-events-metrics)。Application
    Insights还提供了一个仪表板来监控一切。
- en: '![Figure 9.25 – The Application Insights dashboard](img/B21076_09_25.jpg)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![图9.25 – Application Insights仪表板](img/B21076_09_25.jpg)'
- en: Figure 9.25 – The Application Insights dashboard
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.25 – Application Insights仪表板
- en: We can access this dashboard from the **Overview** blade of the Application
    Insights resource. All we need to do is click on **Application Dashboard** to
    open the dashboard view (as shown in *Figure 9**.24*).
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以从Application Insights资源的**概览**选项卡访问此仪表板。我们所需做的只是点击**应用程序仪表板**以打开仪表板视图（如图9.24所示）。
- en: Creating Azure dashboards
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 创建Azure仪表板
- en: 'To learn more about the Application Insights dashboard, read this documentation:
    [https://learn.microsoft.com/en-us/azure/azure-monitor/app/overview-dashboard](https://learn.microsoft.com/en-us/azure/azure-monitor/app/overview-dashboard).'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多关于Application Insights仪表板的信息，请阅读此文档：[https://learn.microsoft.com/en-us/azure/azure-monitor/app/overview-dashboard](https://learn.microsoft.com/en-us/azure/azure-monitor/app/overview-dashboard)。
- en: 'To learn how to work with Azure dashboards in general, see here: [https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards](https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards).'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解如何一般地使用Azure仪表板，请参阅此处：[https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards](https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards)。
- en: 'Dashboards can also be created programmatically by using templates. Find out
    more information in this link: [https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards-create-programmatically](https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards-create-programmatically).'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 仪表板也可以通过使用模板编程创建。更多详细信息请在此链接中查找：[https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards-create-programmatically](https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards-create-programmatically)。
- en: Application Insights is designed to help developers monitor the performance
    and usage of their applications, identify and diagnose issues, and gain insights
    into how users interact with our applications. It is very useful in Azure Machine
    Learning, as it can monitor your endpoints, and by using the connection string,
    we can also gather logs from our applications.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: Application Insights旨在帮助开发者监控其应用程序的性能和用法，识别和诊断问题，并深入了解用户如何与我们的应用程序互动。它在Azure机器学习中非常有用，因为它可以监控您的端点，并且通过使用连接字符串，我们还可以从我们的应用程序中收集日志。
- en: Logs and metrics can be difficult to read, but in large datasets, it is easier
    to visualize them. Let us see some ways that we can visualize metrics and logs
    gathered from Azure Monitor.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 日志和指标可能难以阅读，但在大数据集中，可视化它们则更为容易。让我们看看一些我们可以用来可视化从Azure Monitor收集的指标和日志的方法。
- en: Visualizing the data
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据可视化
- en: To visualize data from Azure Monitor, we have various tools and techniques.
    Let us see some of those here.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 要可视化Azure Monitor中的数据，我们有各种工具和技术。让我们在这里看看其中的一些。
- en: '**Dashboards**: Azure dashboards allow us to combine multiple visualizations
    (such as charts, tables, and other widgets) in a single view. We can pin visualizations
    from Azure Monitor Logs to a dashboard for easy access and monitoring. Dashboards
    can also be set as the Azure portal start page so that we can see them right away.'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**仪表板**：Azure仪表板允许我们在单个视图中组合多个可视化（如图表、表格和其他小部件）。我们可以将Azure Monitor日志中的可视化固定到仪表板上，以便于访问和监控。仪表板还可以设置为Azure门户的起始页面，这样我们就可以立即看到它们。'
- en: '**Workbooks**: Azure Workbooks provides a flexible and customizable way to
    visualize data from Azure Monitor logs. It includes a range of pre-built workbook
    templates for common scenarios, such as virtual machines, that can be customized
    to suit our specific needs. Workbooks can be shared with team members and scheduled
    for regular updates.'
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**工作簿**：Azure 工作簿提供了一种灵活且可定制的可视化 Azure 监控日志数据的方法。它包括一系列预构建的工作簿模板，适用于常见的场景，如虚拟机，可以根据我们的具体需求进行定制。工作簿可以与团队成员共享，并安排定期更新。'
- en: '**Log Analytics language**: You can write queries in the Azure Log Analytics
    query language to retrieve specific data from your logs. Once you have the data,
    you can use visualization functions to display it in a graphical format.'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**日志分析语言**：您可以使用 Azure 日志分析查询语言编写查询，以从您的日志中检索特定数据。一旦您有了数据，您可以使用可视化功能将其以图形格式显示。'
- en: '**PowerBI**: Power BI can connect to Azure Monitor logs and help you create
    more complex and interactive visualizations.'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PowerBI**：Power BI 可以连接到 Azure 监控日志，并帮助您创建更复杂和交互式的可视化。'
- en: Azure Monitor is a critical tool to maintain the health and performance of your
    Azure infrastructure and applications. It’s particularly valuable for businesses
    running mission-critical applications in the cloud, as it helps in identifying
    and resolving issues quickly, optimizing resource utilization, and ensuring a
    smooth user experience.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Monitor 是维护您的 Azure 基础设施和应用程序健康和性能的关键工具。它对于在云中运行关键任务应用程序的企业尤其有价值，因为它有助于快速识别和解决问题，优化资源利用，并确保流畅的用户体验。
- en: Now, let us see a couple of other tools to help us monitor our resources, which
    can also provide security recommendations.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看一些其他工具，这些工具可以帮助我们监控资源，并提供安全建议。
- en: Securing resources with Microsoft Defender
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用微软防御来保护资源
- en: '**Microsoft Defender for Cloud** is a **cloud-native application protection
    platform** (**CNAPP**) designed specifically for cloud environments. It offers
    a comprehensive set of security measures and best practices, aimed at safeguarding
    cloud-based applications against a wide range of cyber attacks and vulnerabilities.
    Microsoft Defender for Cloud combines several functionalities, including a **cloud
    workload protection platform** (**CWPP**) focusing on infrastructure, storage,
    and so on, a **cloud security posture management** (**CSPM**) solution to prevent
    security issues, and a **DevSecOps** solution that helps to secure code across
    different clouds if needed. Defender includes a basic CSPM without additional
    cost. There are advanced features that you can enable on top of that, including
    attack path analysis, the cloud security explorer, advanced threat hunting, security
    governance, as well as tools to evaluate your security compliance across regulatory
    standards that apply to specific industries’ locations.'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '**微软云防御**是一个专为云环境设计的**云原生应用程序保护平台**（**CNAPP**）。它提供了一套全面的安保措施和最佳实践，旨在保护基于云的应用程序免受各种网络攻击和漏洞的侵害。微软云防御结合了多个功能，包括一个专注于基础设施、存储等方面的**云工作负载保护平台**（**CWPP**），一个用于预防安全问题的**云安全态势管理**（**CSPM**）解决方案，以及一个**DevSecOps**解决方案，如果需要，它可以帮助在不同云环境中保护代码。防御器包括一个无需额外费用的基本CSPM。您可以在其基础上启用高级功能，包括攻击路径分析、云安全探索器、高级威胁搜索、安全治理以及评估您在特定行业和地区适用的监管标准下的安全合规性的工具。'
- en: Microsoft Defender for Cloud pricing
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 微软云防御定价
- en: 'You can check out Defender pricing and features here: [https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/?v=17.23h](https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/?v=17.23h).'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在此处查看防御器的定价和功能：[https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/?v=17.23h](https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/?v=17.23h)。
- en: Let us walk through the service and see how we can leverage it in our Azure
    Machine Learning resources.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们了解这项服务，看看我们如何利用它来增强我们的 Azure 机器学习资源。
- en: 'The following is the main blade of `Defender for Cloud` in the top search box:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在顶部搜索框中“云防御”的主要选项卡：
- en: '![Figure 9.26 – Microsoft Defender for Cloud](img/B21076_09_26.jpg)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![图9.26 – 微软云防御](img/B21076_09_26.jpg)'
- en: Figure 9.26 – Microsoft Defender for Cloud
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.26 – 微软云防御
- en: At first glance, we can see the **Security posture** secure score of our workloads,
    which is based on implemented security recommendations in our resources; our **Regulatory
    compliance** score, which is based on applied policies; our **Workload protections**
    percentage; and an inventory of monitored assets. There are also other articles
    available on the rest of the screen and announcements regarding Defender.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 初看之下，我们可以看到我们工作负载的**安全态势**安全分数，这是基于我们资源中实施的安全推荐；我们的**合规性**分数，基于应用的政策；我们的**工作负载保护**百分比；以及监控资产的清单。屏幕上还有其他关于Defender的文章和公告。
- en: Let us see how we can use the information provided to secure our Azure Machine
    Learning resources.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何利用提供的信息来保护我们的Azure机器学习资源。
- en: Improving our security posture
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 提升我们的安全态势
- en: The first thing is to click on **Security posture** to see recommendations to
    improve our secure score. The secure score is an indicator that evaluates and
    assigns a score to the security status of your Azure resources and workloads.
    The lower the score, the less your resources are following security recommendations.
    To improve our score, we need to implement recommendations for each of our resources.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 第一件事是点击**安全态势**以查看提高我们安全分数的推荐。安全分数是一个指标，它评估并分配一个分数来衡量您的Azure资源和工作负载的安全状态。分数越低，您的资源就越少遵循安全推荐。为了提高我们的分数，我们需要为我们的每个资源实施推荐。
- en: Note in the following screenshot that the security posture is evaluated for
    Azure, **Amazon Web Services** (**AWS**), and the **Google Cloud Platform** (**GCP**).
    You can connect your analytics and create a unified security blade.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 注意在下面的屏幕截图中，安全态势评估针对的是Azure、**亚马逊网络服务**（**AWS**）和**谷歌云平台**（**GCP**）。您可以将您的分析连接起来，创建一个统一的安全面板。
- en: '![Figure 9.27 – Security posture](img/B21076_09_27.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![图9.27 – 安全态势](img/B21076_09_27.jpg)'
- en: Figure 9.27 – Security posture
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.27 – 安全态势
- en: To get started with recommendations, click on your subscription on the **View**
    **recommendations** link.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始查看推荐，请点击**查看推荐**链接下的您的订阅。
- en: 'Then, we can see the recommendations for all our resources:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以看到我们所有资源的推荐：
- en: "![Figure 9.28 – \uFEFFRecommendations](img/B21076_09_28.jpg)"
  id: totrans-185
  prefs: []
  type: TYPE_IMG
  zh: '![图9.28 – 推荐项](img/B21076_09_28.jpg)'
- en: Figure 9.28 – Recommendations
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.28 – 推荐项
- en: 'To focus on the Azure Machine Learning recommendations, filter this list appropriately.
    As my ML resources are in the same resource group, I will filter by **Resource
    group**, containing my Azure Machine Learning workspace and associated services:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 要专注于Azure机器学习推荐，请适当筛选此列表。由于我的ML资源位于同一资源组中，我将通过**资源组**进行筛选，包含我的Azure机器学习工作区和相关服务：
- en: '![Figure 9.29 – Adding a filter to the resource group](img/B21076_09_29.jpg)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![图9.29 – 向资源组添加过滤器](img/B21076_09_29.jpg)'
- en: Figure 9.29 – Adding a filter to the resource group
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.29 – 向资源组添加过滤器
- en: 'For each recommendation, we can see how the implementation will improve our
    score. All recommendations under each category must be implemented to get the
    aforementioned score increase. For example, the **Apply system updates** recommendation
    only has one action in the following screenshot, but the implementation will improve
    our score by **5%**. To implement the recommendation, you can click on the link
    to see more information:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每项推荐，我们可以看到实施方式将如何提高我们的分数。每个类别下的所有推荐都必须实施，才能获得上述分数提升。例如，**应用系统更新**推荐在下面的屏幕截图中只有一个操作，但实施将提高我们的分数**5%**。要实施推荐，您可以点击链接查看更多信息：
- en: '![Figure 9.30 – Security posture recommendations](img/B21076_09_30.jpg)'
  id: totrans-191
  prefs: []
  type: TYPE_IMG
  zh: '![图9.30 – 安全态势推荐](img/B21076_09_30.jpg)'
- en: Figure 9.30 – Security posture recommendations
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.30 – 安全态势推荐
- en: 'Here, we can see the issue severity, a description, the remediation steps,
    and the affected resources. We can then manually proceed and update the resources
    as instructed:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到问题严重性、描述、修复步骤以及受影响的资源。然后我们可以手动进行并按照指示更新资源：
- en: '![Figure 9.31 – Recommendation remediation](img/B21076_09_31.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![图9.31 – 推荐修复](img/B21076_09_31.jpg)'
- en: Figure 9.31 – Recommendation remediation
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.31 – 推荐修复
- en: We can even enforce this in the future by clicking the **Enforce** button, as
    shown in the previous screenshot, which will assign this recommendation as a policy.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们甚至可以通过点击之前屏幕截图中的**强制执行**按钮来在未来强制执行此操作，这将把这个推荐作为一项策略分配。
- en: Similarly, we can implement security recommendations in our Azure Machine Learning
    instance and any other resources in our subscriptions. The recommendations are
    part of the Azure security baseline, which we will analyze in more detail in [*Chapter
    10*](B21076_10.xhtml#_idTextAnchor203), where we will create a security baseline
    for our Azure Machine Learning environment by using security best practices.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，我们可以在 Azure Machine Learning 实例和订阅中的任何其他资源中实施安全建议。这些建议是 Azure 安全基线的一部分，我们将在[*第
    10 章*](B21076_10.xhtml#_idTextAnchor203)中更详细地分析，我们将使用安全最佳实践为我们的 Azure Machine
    Learning 环境创建安全基线。
- en: Now, let us explore Microsoft Sentinel to help us secure and automate our response
    to security incidents.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们探索 Microsoft Sentinel，以帮助我们确保和自动化对安全事件的响应。
- en: Exploring threat management with Sentinel
  id: totrans-199
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Sentinel 探索威胁管理
- en: 'Microsoft Sentinel is a cloud-native **Security Information and Event Management**
    (**SIEM**) and **Security Orchestration, Automation, and Response** (**SOAR**)
    solution. It offers intelligent security analytics and threat intelligence centrally
    for Azure and other clouds. With Sentinel, we have smart alert detection, threat
    visibility, hunting, and response, all in a single pane. There are several benefits
    to using Sentinel for the aforementioned tasks:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Sentinel 是一个云原生 **安全信息和事件管理**（**SIEM**）和**安全编排、自动化和响应**（**SOAR**）解决方案。它为
    Azure 和其他云提供集中的智能安全分析和威胁情报。使用 Sentinel，我们可以在一个面板中实现智能警报检测、威胁可见性、狩猎和响应。使用 Sentinel
    进行上述任务有以下几个好处：
- en: As a cloud solution, it scales with our data, and we pay for what we use.
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为云解决方案，它随着我们的数据扩展，我们只为使用的内容付费。
- en: Microsoft Sentinel gathers data using connectors from a wide range of sources,
    including Azure services, on-premises environments, and other clouds.
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft Sentinel 使用来自广泛来源的连接器收集数据，包括 Azure 服务、本地环境和其他云。
- en: The service comes with built-in ML models that help to identify suspicious activities
    and reduce false positives. Over time, these models can be trained to improve
    their accuracy based on your organization’s unique patterns.
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 该服务内置了帮助识别可疑活动和减少误报的 ML 模型。随着时间的推移，这些模型可以根据您组织的独特模式进行训练，以提高其准确性。
- en: Threat hunting is done using KQL to identify threats, anomalies, and patterns,
    and there are templates available to get you started.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 KQL 进行威胁狩猎，以识别威胁、异常和模式，并提供模板以帮助您开始。
- en: Beyond just detection, Microsoft Sentinel also allows you to automate common
    tasks and responses. This can help organizations respond more quickly to threats.
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 除了检测之外，Microsoft Sentinel 还允许您自动化常见任务和响应。这可以帮助组织更快地响应威胁。
- en: We can use workbooks to visualize and help teams drill down into data, find
    patterns, and understand security postures better.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以使用工作簿来可视化数据，并帮助团队深入挖掘数据，发现模式，更好地理解安全态势。
- en: Microsoft Sentinel provides tools to handle incidents, from identification to
    investigation to remediation.
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft Sentinel 提供从识别到调查再到修复处理事件的工具。
- en: Default data retention is at 30 days, but it can be increased to 90 days.
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认数据保留期为 30 天，但可以增加到 90 天。
- en: To work with Sentinel, we need a Log Analytics workspace to gather logs. Refer
    to the previous sections of this chapter to create a new Log Analytics workspace.
    After you have a workspace, you can add Microsoft Sentinel to the workspace. Find
    `Microsoft Sentinel` from the search bar of the Azure portal, and on the page
    that loads, click on **Create**.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 要与 Sentinel 一起工作，我们需要一个 Log Analytics 工作区来收集日志。请参考本章前面的部分以创建一个新的 Log Analytics
    工作区。创建工作区后，您可以将 Microsoft Sentinel 添加到工作区。在 Azure 门户的搜索栏中查找 `Microsoft Sentinel`，在加载的页面上点击
    **创建**。
- en: '![Figure 9.32 – Microsoft Sentinel](img/B21076_09_32.jpg)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.32 – Microsoft Sentinel](img/B21076_09_32.jpg)'
- en: Figure 9.32 – Microsoft Sentinel
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.32 – Microsoft Sentinel
- en: In the next step, **Add Microsoft Sentinel to a workspace**, choose the workspace
    we created previously, as shown in the next screenshot.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，**将 Microsoft Sentinel 添加到工作区**，选择之前创建的工作区，如图 9.33 所示的下一张截图。
- en: '![Figure 9.33 – Adding Sentinel to a workspace](img/B21076_09_33.jpg)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.33 – 将 Sentinel 添加到工作区](img/B21076_09_33.jpg)'
- en: Figure 9.33 – Adding Sentinel to a workspace
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.33 – 将 Sentinel 添加到工作区
- en: As soon as you add a workspace, you can leverage the Sentinel threat management
    capabilities. This is the main page of Sentinel. Everything you need to work with
    threat management can be found on the left menu.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦添加了工作区，您就可以利用 Sentinel 的威胁管理功能。这是 Sentinel 的主页面。您需要用于威胁管理的所有内容都可以在左侧菜单中找到。
- en: 'Let us explore the most useful features of Microsoft Sentinel:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们探索Microsoft Sentinel最有用的功能：
- en: '**Incidents**: In Microsoft Sentinel, incidents are compilations of related
    alerts, representing potentially harmful activities or patterns within a system.
    They provide a consolidated view to help security analysts estimate the scope
    and sequence of a potential attack. Incidents in Microsoft Sentinel are equipped
    with information such as the entities involved, a timeline of related alerts,
    and other relevant details. Incidents allow security teams to focus on broader
    events rather than individual alerts, helping prioritize responses based on the
    combined severity of related alerts.'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件**：在Microsoft Sentinel中，事件是相关警报的集合，代表系统内可能有害的活动或模式。它们提供了一个综合的视图，以帮助安全分析师估计潜在攻击的范围和顺序。Microsoft
    Sentinel中的事件配备了涉及实体、相关警报的时间线和其他相关细节等信息。事件允许安全团队关注更广泛的事件，而不是单个警报，有助于根据相关警报的综合严重程度优先响应。'
- en: '![Figure 9.34 – Incidents](img/B21076_09_34.jpg)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![图9.34 – 事件](img/B21076_09_34.jpg)'
- en: Figure 9.34 – Incidents
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.34 – 事件
- en: '**Hunting**: Hunting in Microsoft Sentinel refers to proactive queries and
    exploration of data to identify signs of malicious or suspicious activities that
    haven’t necessarily raised automatic alerts. We can run predefined or custom KQL
    queries to filter through collected data, searching for anomalies or patterns
    of interest. The goal is to discover hidden threats, identify previously unnoticed
    patterns, and strengthen detection capabilities.'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**搜索**：在Microsoft Sentinel中，搜索是指主动查询和对数据的探索，以识别可能没有触发自动警报的恶意或可疑活动的迹象。我们可以运行预定义或自定义的KQL查询来过滤收集的数据，寻找异常或感兴趣的模式。目标是发现隐藏的威胁，识别以前未注意到的模式，并加强检测能力。'
- en: To access hunting queries, click on **Hunting**. The process of creating a hunt
    is easy. From the main page, click on **New hunt**.
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要访问搜索查询，请点击**搜索**。创建搜索的过程很简单。从主页点击**新建搜索**。
- en: '![Figure 9.35 – Hunting queries](img/B21076_09_35.jpg)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
  zh: '![图9.35 – 搜索查询](img/B21076_09_35.jpg)'
- en: Figure 9.35 – Hunting queries
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.35 – 搜索查询
- en: Provide a *name* and more information if necessary, and then click **Create**.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 提供一个*名称*和必要时的更多信息，然后点击**创建**。
- en: '![Figure 9.36 – A new hunt](img/B21076_09_36.jpg)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![图9.36 – 新建搜索](img/B21076_09_36.jpg)'
- en: Figure 9.36 – A new hunt
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.36 – 新建搜索
- en: A hunt is composed of one or more queries. To add your query, click on the hunt
    name you just created, and under **Query actions**, you can select **New query**
    or **Add queries to hunt** to choose from existing queries. Queries are written
    in KQL.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 一个搜索由一个或多个查询组成。要添加您的查询，点击您刚刚创建的搜索名称，在**查询操作**下，您可以选择**新建查询**或**将查询添加到搜索**以从现有查询中选择。查询是用KQL编写的。
- en: '![Figure 9.37 – Adding queries](img/B21076_09_37.jpg)'
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![图9.37 – 添加查询](img/B21076_09_37.jpg)'
- en: Figure 9.37 – Adding queries
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.37 – 添加查询
- en: I chose the latter and selected these two queries from the list, as shown in
    the next screenshot.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 我选择了后者，并从列表中选择了这两个查询，如下一张截图所示。
- en: '![Figure 9.38 – Adding existing queries](img/B21076_09_38.jpg)'
  id: totrans-231
  prefs: []
  type: TYPE_IMG
  zh: '![图9.38 – 添加现有查询](img/B21076_09_38.jpg)'
- en: Figure 9.38 – Adding existing queries
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.38 – 添加现有查询
- en: Now, you can run these queries to confirm your hypothesis and discover suspected
    threats. Upon discovery, we can create an incident directly from the hunting page.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以通过运行这些查询来验证您的假设并发现疑似威胁。发现后，我们可以在搜索页面上直接创建事件。
- en: '**Threat intelligence**: Threat intelligence in Microsoft Sentinel involves
    leveraging information about existing and emerging threats and vulnerabilities.
    Microsoft Sentinel integrates with Microsoft Defender’s Threat Intelligence, which
    provides data about known malicious IP addresses, URLs, file hashes, and so on.
    When this data matches activity in your environment, Sentinel can raise alerts.
    The integration of threat intelligence allows organizations to cross-reference
    their real-time data with known threat indicators, improving the detection of
    potential security breaches and understanding the broader threat landscape.'
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**威胁情报**：Microsoft Sentinel中的威胁情报涉及利用有关现有和新兴威胁和漏洞的信息。Microsoft Sentinel与Microsoft
    Defender的威胁情报集成，提供有关已知恶意IP地址、URL、文件哈希等信息。当这些数据与您环境中的活动匹配时，Sentinel可以发出警报。威胁情报的集成允许组织将其实时数据与已知威胁指标进行交叉引用，提高潜在安全漏洞的检测，并了解更广泛的威胁格局。'
- en: These are just the basics. Sentinel has a lot of capabilities, as it integrates
    with multiple Microsoft services such as Defender for Cloud and Microsoft 365\.
    To skill up in Sentinel, take a look at the following resources, ranging from
    learning paths to certifications.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 这些只是基础知识。Sentinel 集成了多个微软服务，例如云端的 Defender 和 Microsoft 365，因此具有很多功能。要提升 Sentinel
    的技能，请查看以下资源，从学习路径到认证。
- en: Get started with Microsoft Sentinel
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 开始使用 Microsoft Sentinel
- en: 'To get started with Microsoft Sentinel, check out the following learning paths:
    [https://learn.microsoft.com/en-us/azure/sentinel/skill-up-resources](https://learn.microsoft.com/en-us/azure/sentinel/skill-up-resources).'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用 Microsoft Sentinel，请查看以下学习路径：[https://learn.microsoft.com/en-us/azure/sentinel/skill-up-resources](https://learn.microsoft.com/en-us/azure/sentinel/skill-up-resources)。
- en: Summary
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we learned to utilize multiple services, ensuring we can monitor
    our resources effectively by enabling different services and learning how we can
    start to use the logs we gather to prevent security incidents. The first one we
    worked with was Azure Monitor, using Monitor alerts to make sure we can be notified
    about any issues. By combining the capabilities of Monitor Log Analytics and Application
    Insights, we can have end-to-end monitoring of our resources and our model endpoints.
    Additionally, by using Microsoft Defender for Cloud, we can get recommendations
    to implement best practices, and we can use Microsoft Sentinel for advanced threat
    management. Now that we have a comprehensive view of the best practices across
    different surface areas included in a ML project, we can combine them and see
    how we can build a security baseline for our Azure resources in the next chapter.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了如何利用多个服务，通过启用不同的服务并学习如何开始使用我们收集的日志来预防安全事件，从而有效地监控我们的资源。我们首先使用的是 Azure
    Monitor，通过监控警报来确保我们能够被通知任何问题。通过结合 Monitor Log Analytics 和 Application Insights
    的功能，我们可以对我们的资源和模型端点进行端到端监控。此外，通过使用 Microsoft Defender for Cloud，我们可以获得实施最佳实践的推荐，并且可以使用
    Microsoft Sentinel 进行高级威胁管理。现在，我们已经对包含在机器学习项目中的不同表面区域内的最佳实践有了全面的了解，我们可以在下一章中结合它们，看看我们如何为
    Azure 资源建立一个安全基线。
- en: 'Part 4: Best Practices for Enterprise Security in Azure Machine Learning'
  id: totrans-240
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 4 部分：Azure 机器学习中企业安全最佳实践
- en: In this part, you will review the best practices outlined in this book and explore
    more services that could be used to further secure your cloud resources. You will
    also see a sample solution architecture that incorporates all those practices.
    Finally, you will learn how to work with threat modeling, developing a strategy
    to maintain the same level of security and stay protected in the future.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 在本部分中，您将回顾本书中概述的最佳实践，并探索更多可用于进一步保护云资源的服务。您还将看到一个包含所有这些实践的示例解决方案架构。最后，您将学习如何与威胁建模合作，制定策略以保持相同的保护水平并在未来保持安全。
- en: 'This part has the following chapter:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 本部分包含以下章节：
- en: '[*Chapter 10*](B21076_10.xhtml#_idTextAnchor203)*, Setting a Security Baseline
    for Your Azure Machine Learning Workloads*'
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第 10 章*](B21076_10.xhtml#_idTextAnchor203)*，为您的 Azure 机器学习工作负载设置安全基线*'

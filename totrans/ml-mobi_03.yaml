- en: Random Forest on iOS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: iOS上的随机森林
- en: This chapter will provide you with an overview of the random forest algorithm.
    We will first look at the decision tree algorithm and, once we have a handle on
    it, try to understand the random forest algorithm. Then, we will use Core ML to
    create a machine learning program that leverages the random forest algorithm and
    predicts the possibility of a patient being diagnosed with breast cancer based
    on a given set of breast cancer patient data.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将为您概述随机森林算法。我们首先将探讨决策树算法，一旦我们掌握了它，我们将尝试理解随机森林算法。然后，我们将使用Core ML创建一个利用随机森林算法的机器学习程序，根据给定的一组乳腺癌患者数据预测患者被诊断为乳腺癌的可能性。
- en: 'As we already saw in [Chapter 1](51fcaf51-eb68-4493-afc2-0b02f1c1d50e.xhtml), *Introduction
    to Machine Learning on Mobile,* any machine learning program has four phases:
    define the machine learning problem, prepare the data, build/rebuild/test the
    model, and deploy it for usage. In this chapter, we will try to relate these with
    random forest and solve the underlying machine learning problem.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在[第1章](51fcaf51-eb68-4493-afc2-0b02f1c1d50e.xhtml)，“移动机器学习简介”中已经看到的，任何机器学习程序都有四个阶段：定义机器学习问题、准备数据、构建/重建/测试模型以及部署使用。在本章中，我们将尝试将这些与随机森林联系起来，并解决背后的机器学习问题。
- en: '**Problem definition**: The breast cancer data for certain patients is provided
    and we want to predict the possibility of diagnosing breast cancer for a new data
    item.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '**问题定义**：提供了某些患者的乳腺癌数据，我们想要预测新数据项被诊断为乳腺癌的可能性。'
- en: 'We will be covering the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将涵盖以下主题：
- en: Understanding decision trees and how to apply them to solve an ML problem
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解决策树及其如何应用于解决机器学习问题
- en: Understanding decision trees through a sample dataset and Excel
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过示例数据集和Excel理解决策树
- en: Understanding random forests
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解随机森林
- en: 'Solving the problem using a random forest in Core ML:'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Core ML中使用随机森林解决问题：
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 技术要求
- en: Creating a model file using the scikit-learn and pandas libraries
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用scikit-learn和pandas库创建模型文件
- en: Testing the model
  id: totrans-11
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试模型
- en: Importing the scikit-learn model into the Core ML project
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将scikit-learn模型导入Core ML项目
- en: Writing an iOS mobile application and using the scikit-learn model in it to
    perform the breast cancer prediction
  id: totrans-13
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编写iOS移动应用程序并在其中使用scikit-learn模型进行乳腺癌预测
- en: Introduction to algorithms
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 算法简介
- en: In this section, we will look at the decision tree algorithm. We will go through
    an example to understand the algorithm. Once we get some clarity on the algorithm,
    we will try to understand the random forest algorithm with an example.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨决策树算法。我们将通过一个示例来理解该算法。一旦我们对算法有了清晰的认识，我们将通过示例尝试理解随机森林算法。
- en: Decision tree
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 决策树
- en: To understand the random forest model, we must first learn about the decision
    tree, the basic building block of a random forest. We all use decision trees in
    our daily lives, even if you don't know it by that name. You will be able to relate
    to the concepts of a decision tree once we start going through the example.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 要理解随机森林模型，我们首先必须了解决策树，这是随机森林的基本构建块。我们每天都在使用决策树，即使你不认识这个名字。一旦我们开始通过示例进行讲解，你将能够与决策树的概念联系起来。
- en: Imagine you approach a bank for a loan. The bank will scan you for a series
    of eligibility criteria before they approve the loan. For each individual, the
    loan amount they offer will vary, based on the different eligibility criteria
    they satisfy.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，您去银行申请贷款。银行会在批准贷款之前对您的一系列资格标准进行审查。对于每个人，他们提供的贷款金额将根据他们满足的不同资格标准而有所不同。
- en: 'They may go ahead with various decision points to make the final decision to
    arrive at the possibility of granting a loan and the amount that can be given,
    such as the following:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 他们可能会通过一系列决策点来做出最终决定，以确定是否批准贷款以及可以提供的金额，例如以下内容：
- en: '**Source of income**: Employed or self-employed?'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**收入来源**：受雇还是自雇？'
- en: '**If employed, place of employment**: Private sector or government sector?'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**如果受雇，工作地点**：私营部门还是政府部门？'
- en: '**If private sector, range of salary**: Low, medium, or high?'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**如果私营部门，薪资范围**：低、中或高？'
- en: '**If government sector, range of salary**: Low, medium, or high?'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**如果政府部门，薪资范围**：低、中或高？'
- en: 'There may be further questions, such as how long you''ve been employed with
    that company, or whether you have any outstanding loans. This process, in its
    most basic form, is a decision tree:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 可能会有更多问题，例如你在那家公司工作了多少年，或者你是否有任何未偿还的贷款。这个过程在最基本的形式上是一个决策树：
- en: '![](img/8ed81da7-31ba-4376-b2ef-ca932251b95e.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/8ed81da7-31ba-4376-b2ef-ca932251b95e.png)'
- en: As you can see in the preceding diagram, a decision tree is a largely used non-parametric
    effective machine learning modeling technique for classification problems. To
    find solutions, a decision tree makes sequential, hierarchical decisions about
    the outcomes based on the predictor data.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 如前图所示，决策树是非参数有效机器学习建模技术，广泛用于分类问题。为了找到解决方案，决策树根据预测数据对结果进行顺序、分层决策。
- en: For any given data item, a series of questions is asked, which leads to a class
    label or a value. This model asks a series of predefined questions of the incoming
    data item and, based on these answers, branches out to that series and proceeds
    until it arrives at the resulting data value or class label. The model is constructed
    based on the observed data, and there are no assumptions made about the distribution
    of the errors or the distribution of data itself.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 对于任何给定的数据项，会问一系列问题，这些问题会导致一个类别标签或值。该模型对传入的数据项提出一系列预定义的问题，并根据这些答案分支到那个系列，并继续进行，直到到达最终的数据值或类别标签。该模型基于观察到的数据构建，没有对错误分布或数据本身的分布做出任何假设。
- en: In the decision tree models where the target variable uses a discrete set of
    values, this is called a **classification tree**. In these trees, each node, or
    leaf, represents class labels, while the branches represent features leading to
    class labels.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在决策树模型中，如果目标变量使用一组离散值，这被称为**分类树**。在这些树中，每个节点或叶子代表类别标签，而分支代表导致类别标签的特征。
- en: A decision tree where the target variable takes a continuous value, usually
    numbers, is called a **regression tree**.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 目标变量取连续值（通常是数字）的决策树称为**回归树**。
- en: These decision trees are well represented using **directed acyclic graphs**
    (**DAGs**). In these graphs, nodes represent decision points and edges are the
    connections between the nodes. In the preceding loan scenario, the salary range
    of $30,000-$70,000 would be an edge and the medium are nodes.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 这些决策树可以用**有向无环图**（**DAGs**）很好地表示。在这些图中，节点代表决策点，边是节点之间的连接。在前面的贷款场景中，$30,000-$70,000的薪资范围将是一条边，而中等将是节点。
- en: Advantages of the decision tree algorithm
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 决策树算法的优点
- en: The goal of the decision tree is to arrive at the optimal choice for the given
    problem. The final leaf node should be the best choice for the problem at hand.
    The algorithm behaves greedily and tries to come to the optimal choice in each
    decision it takes.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 决策树的目标是为给定的问题找到最佳选择。最终的叶子节点应该是手头问题的最佳选择。算法行为贪婪，试图在每个决策中都做出最佳选择。
- en: The whole problem is divided into multiple sub-problems, with each sub-problem
    branching out to other sub-problems. The subsets arrived are based on a parameter
    called **purity**. A node is said to be 100% pure when all decisions will lead
    to data belonging to the same class. It will be 100% impure when there is a possibility
    of splitting its subsets into categories. The goal of the algorithm is to reach
    100% purity for each node in the tree.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 整个问题被划分为多个子问题，每个子问题又分支出其他子问题。这些子集是基于一个称为**纯度**的参数。当一个节点的所有决策都将导致属于同一类别的数据时，该节点被认为是100%纯的。如果有可能将其子集分割成类别，则将是100%不纯的。算法的目标是使树中的每个节点达到100%的纯度。
- en: The purity of a node is measured using Gini impurity, and Gini impurity is a
    standard metric that helps in splitting the node of a decision tree.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 节点的纯度使用Gini不纯度来衡量，Gini不纯度是一个标准指标，有助于分割决策树的节点。
- en: The other metric that would be used in a decision tree is information gain,
    which will be used to decide what feature of the dataset should be used to split
    at each step in the tree. The information gain is the decrease in entropy (randomness)
    after a dataset is split on an attribute. Constructing a decision tree is all
    about finding attributes that return the highest information gain, that is, the
    most homogeneous branches, which means all data belonging to the same subset or
    class.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在决策树中还会使用另一个指标，即信息增益，它将用于决定在树的每个步骤中应该使用数据集的哪个特征进行分割。信息增益是在数据集根据属性分割后的熵（随机性）的减少。构建决策树就是寻找能够返回最高信息增益的属性，即最同质的分支，这意味着所有属于同一子集或类的数据。
- en: Disadvantages of decision trees
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 决策树的缺点
- en: The model stops only when all data points can fit into a single class/category.
    So there is a possibility that it may not generalize well for complex problems
    and the chance of bias is high.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 模型仅在所有数据点都可以适合单个类别时停止。因此，它可能不适合复杂问题，并且偏差的可能性很高。
- en: These problems can be solved by defining the maximum depth of the tree or by
    specifying the minimum number of data points needed to split the node further
    in the tree.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这些问题可以通过定义树的最大深度或指定在树中进一步分割节点所需的最小数据点数量来解决。
- en: Advantages of decision trees
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 决策树的优势
- en: 'The following are the advantages listed:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列出了优势：
- en: Simple to understand and visualize
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 简单易懂且易于可视化
- en: Very easy to build and can handle both qualitative and quantitative data
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 非常容易构建，可以处理定性和定量数据
- en: Easy to validate
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 容易验证
- en: Computationally, it is not very expensive
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从计算角度来看，这并不昂贵
- en: To summarize the decision tree model, we can conclude that it is basically a flowchart
    of questions leading to a prediction.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 总结决策树模型，我们可以得出结论，它基本上是一个通向预测的问题流程图。
- en: Random forests
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 随机森林
- en: 'Now, let''s move from a single decision tree to a random forest. If you wanted
    to guess who the next President will be, how would you go about predicting this?  Let''s
    see the different kinds of questions that we would ask to predict this:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们从单个决策树转向随机森林。如果你想要猜测下一位总统是谁，你会如何进行预测？让我们看看预测这个问题我们会问的不同类型的问题：
- en: How many candidates are there? Who are they?
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有多少候选人？他们是谁？
- en: Who is the current President?
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 现任总统是谁？
- en: How are they performing?
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们表现如何？
- en: Which party do they belong to?
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们属于哪个政党？
- en: Is there any current movement against that party?
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 是否有任何针对该党的当前运动？
- en: In how many states the political party has probability to win
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在多少个州政治党派有获胜的概率
- en: Were they the incumbent President?
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们是否是现任总统？
- en: What are the major voting issues?
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主要的投票问题有哪些？
- en: Many questions like this will come to our mind and we will attach different
    weights/importance to them.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们脑海中会涌现出许多类似的问题，并且我们会为它们分配不同的权重/重要性。
- en: Each person's prediction to the preceding questions may be different. There
    are too many factors to take into account, and the possibility are, each person's
    guess will be different. Every person comes to these questions with different
    backgrounds and knowledge levels, and may interpret the question differently.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 每个人对先前问题的预测可能不同。需要考虑的因素太多，每个人的猜测可能不同。每个人带着不同的背景和知识水平来到这些问题面前，可能会对问题有不同的解读。
- en: So there is chance of having a high variance for the answers. If we take all
    the predictions given by different individuals separately and then average them
    out, it becomes a random forest.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，答案的方差可能很高。如果我们分别取不同个体给出的所有预测并平均它们，就变成了随机森林。
- en: A random forest combines many decision trees into a single model. Individually,
    predictions made by decision trees (or humans) may not be accurate, but, when
    combined, the predictions will be closer to the mark, on average.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 随机森林将多个决策树组合成一个单一模型。单个决策树（或人类）做出的预测可能并不准确，但结合在一起，预测的平均值将更接近真实值。
- en: 'The following diagram will help us understand the voting prediction using the
    random forest algorithm:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表将帮助我们理解使用随机森林算法进行投票预测：
- en: '![](img/5bf737ee-2d42-4d41-b7ce-7ebeb1966472.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/5bf737ee-2d42-4d41-b7ce-7ebeb1966472.png)'
- en: 'The following diagram gives a flowchart view of the previous diagram:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表给出了前一个图表的流程图视图：
- en: '![](img/531ae8f1-7db7-4759-b594-4fc3ce0d9a31.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/531ae8f1-7db7-4759-b594-4fc3ce0d9a31.png)'
- en: 'Let''s look at why a random forest is better than a decision tree:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看为什么随机森林比决策树更好：
- en: A random forest is a combination of many decision trees and, hence, there is
    a greater probability that there would be many viewpoints to arrive at the final
    prediction.
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随机森林是由许多决策树组合而成的，因此，最终预测会有更多观点的可能性更大。
- en: If only a single decision tree is considered for prediction, there is less information
    considered for prediction. But, in a random forest, when there are many trees
    involved, there is more information and it is more diverse.
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果只考虑单个决策树进行预测，则考虑的预测信息较少。但是，在随机森林中，当涉及许多树时，信息更多且更多样化。
- en: The random forest may not be biased, as may be the case with the decision tree,
    since it is not dependent on a single source.
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随机森林可能不会像决策树那样有偏差，因为它不依赖于单一来源。
- en: Why the name random forest? Well, as much as people might rely on different
    sources to make a prediction, each decision tree in the forest considers a random
    subset of features when forming questions and only has access to a random set
    of the training data points. This increases diversity in the forest, leading to
    more robust overall predictions and hence, the name random forest.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么叫随机森林？嗯，尽管人们可能依赖于不同的来源来做出预测，但森林中的每个决策树在形成问题时都会考虑特征的一个随机子集，并且只能访问训练数据点的随机集合。这增加了森林的多样性，导致更稳健的整体预测，因此得名随机森林。
- en: Solving the problem using random forest in Core ML
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Core ML中使用随机森林解决问题
- en: In this section, we will try to understand the random forest through a detailed
    example with a specific dataset. We are going to use the same dataset to work
    out the iOS Core ML example.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将通过一个具体的示例数据集的详细示例来了解随机森林。我们将使用相同的数据集来处理iOS Core ML示例。
- en: Dataset
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据集
- en: We will use the breast cancer dataset for the random forest problem. Features
    are computed from a digitized image of a **fine needle aspirate** (**FNA**) of
    a breast mass. They describe the characteristics of the cell nuclei present in
    the image. The dataset can be found at [https://archive.ics.uci.edu/ml/datasets/Breast+Cancer+Wisconsin+(Diagnostic)](https://archive.ics.uci.edu/ml/datasets/Breast+Cancer+Wisconsin+(Diagnostic)).
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用乳腺癌数据集来处理随机森林问题。特征是从乳腺肿块细针吸取（**FNA**）的数字化图像中计算的。它们描述了图像中存在的细胞核的特征。数据集可以在[https://archive.ics.uci.edu/ml/datasets/Breast+Cancer+Wisconsin+(Diagnostic)](https://archive.ics.uci.edu/ml/datasets/Breast+Cancer+Wisconsin+(Diagnostic))找到。
- en: Naming the dataset
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 命名数据集
- en: 'We will be using the Breast Cancer dataset. The following list contains the
    various conventions used in the dataset:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用乳腺癌数据集。以下列表包含了数据集中使用的各种约定：
- en: ID number
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 身份编号
- en: Diagnosis (*M* = malignant, and *B* = benign)
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 诊断（*M* = 恶性，*B* = 良性）
- en: '10 real-valued features are computed for each cell nucleus:'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个细胞核计算10个实值特征：
- en: Radius (mean of the distances from the center to points on the perimeter)
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 半径（从中心到轮廓上点的距离的平均值）
- en: Texture (standard deviation of gray scale values)
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 纹理（灰度值的标准差）
- en: Perimeter
  id: totrans-80
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 周长
- en: Area
  id: totrans-81
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 面积
- en: Smoothness (local variation in radius lengths)
  id: totrans-82
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平滑度（半径长度的局部变化）
- en: Compactness (*perimeter^2/area - 1.0*)
  id: totrans-83
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 紧凑度（*周长^2/面积 - 1.0*）
- en: Concavity (severity of concave portions of the contour)
  id: totrans-84
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 凸度（轮廓凹部分的严重程度）
- en: Concave points (number of concave portions of the contour)
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 凸点（轮廓凹部分的数量）
- en: Symmetry
  id: totrans-86
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对称性
- en: Fractal dimension (coastline approximation-1)
  id: totrans-87
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分形维度（海岸线近似-1）
- en: We will use random forest through Excel, applying the breast cancer dataset,
    to understand random forest in detail.  We will consider only data elements from
    569 sample pieces of data from the breast cancer dataset for the purposes of analysis.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过Excel使用随机森林，应用乳腺癌数据集，以详细了解随机森林。在分析目的上，我们只考虑来自乳腺癌数据集的569个样本数据中的数据元素。
- en: Technical requirements
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'The following software needs to be installed on the developer machine:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 需要在开发者机器上安装以下软件：
- en: Python
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python
- en: Xcode in the macOS environment
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: macOS环境下的Xcode
- en: 'The exercise programs for the chapter can be found on the GitHub repository
    ([https://github.com/PacktPublishing/Machine-Learning-for-Mobile](https://github.com/PacktPublishing/Machine-Learning-for-Mobile))
    under the `Chapter03` folder. Let''s start by entering the command to install
    the Python package:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的练习程序可以在GitHub仓库（[https://github.com/PacktPublishing/Machine-Learning-for-Mobile](https://github.com/PacktPublishing/Machine-Learning-for-Mobile)）的`Chapter03`文件夹中找到。让我们先输入安装Python包的命令：
- en: '[PRE0]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Then, issue the command to install `coremltools`:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，发出安装`coremltools`的命令：
- en: '[PRE1]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Creating the model file using scikit-learn
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用scikit-learn创建模型文件
- en: This section will explain how we are going to create the random forest model
    file using scikit-learn and convert it into the `.mlmodel` file that is compatible
    with Core ML. We are going to use the Breast Cancer dataset to create the model.
    The following is a Python program that creates a simple random forest model using
    scikit-learn and the Breast Cancer dataset. Then, the Core ML tools convert it
    into the Core ML—compatible model file. Let's go through the program in detail.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将解释我们将如何使用scikit-learn创建随机森林模型文件并将其转换为与Core ML兼容的`.mlmodel`文件。我们将使用乳腺癌数据集来创建模型。以下是一个Python程序，它使用scikit-learn和乳腺癌数据集创建一个简单的随机森林模型。然后，Core
    ML工具将其转换为Core ML兼容的模型文件。让我们详细地审查这个程序。
- en: 'First, we need to import the required packages:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要导入所需的包：
- en: '[PRE2]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'NumPy is the fundamental package for scientific computing with Python. It contains a
    powerful N-dimensional array object. This `numpy` array will be used in this program
    for storing the dataset, which has 14 dimensions:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: NumPy是Python科学计算的基础包。它包含一个强大的N维数组对象。这个`numpy`数组将在这个程序中用于存储数据集，该数据集有14个维度：
- en: '[PRE3]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Here, we are using pandas ([https://pandas.pydata.org/pandas-docs/stable/10min.html](https://pandas.pydata.org/pandas-docs/stable/10min.html))
    which is an open source, BSD-licensed library providing high-performing, easy-to-use
    data structures and data analysis tools for the Python programming language. Using
    pandas, we can create a data frame. You can assume that a pandas dataframe is
    an Excel sheet in which every sheet has headings and data.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们使用pandas（[https://pandas.pydata.org/pandas-docs/stable/10min.html](https://pandas.pydata.org/pandas-docs/stable/10min.html)），这是一个开源的BSD许可库，为Python编程语言提供高性能、易于使用的数据结构和数据分析工具。使用pandas，我们可以创建一个数据框。您可以假设pandas数据框是一个Excel表，其中每个表都有标题和数据。
- en: 'Now, let''s move on to understand the program written for solving the machine
    learning problem at hand:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们继续了解为解决当前机器学习问题编写的程序：
- en: '[PRE4]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The preceding lines import the `sklearn` packages. Now, we will import built-in
    datasets in the `sklearn` package:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 上一行导入了`sklearn`包。现在，我们将导入`sklearn`包中的内置数据集：
- en: '[PRE5]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The preceding line loads the Breast Cancer dataset from the `sklearn` dataset
    package:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 上一行从`sklearn`数据集包中加载了乳腺癌数据集：
- en: '[PRE6]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'This will create a dataframe from the data present in the dataset. Let''s assume
    that the dataset is an Excel sheet with rows and columns with column headings:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建一个从数据集中现有数据生成的数据框。假设数据集是一个Excel表，其中包含行和列，列有标题：
- en: '[PRE7]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The following piece of code will add the column headings to the columns in
    the dataset:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码将添加列标题到数据集的列中：
- en: '[PRE8]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The preceding lines will delete all the columns other than the following:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 上一行将删除除以下列之外的所有列：
- en: Mean concave points
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平均凹点
- en: Mean area
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平均面积
- en: Mean radius
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平均半径
- en: Mean perimeter
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平均周长
- en: Mean concavity
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平均凹度
- en: 'To reduce the number of feature columns in the dataset, I am deleting some
    of the columns that have less impact on the model:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 为了减少数据集中特征列的数量，我正在删除一些对模型影响较小的列：
- en: '[PRE9]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'This line will save the data to a CSV file; you can open it and see in Excel
    to find out what is present in the dataset:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 这行代码将数据保存到CSV文件中；您可以在Excel中打开它，查看数据集包含的内容：
- en: '[PRE10]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'In the Excel dataset, when you examine it, you will know that the diagnosis
    will include the value as 0 or 1, where 0 is malignant and 1 is benign. To change these
    numeric values to the real names, we write the following piece of code:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在Excel数据集中，当您检查它时，您将知道诊断将包括0或1的值，其中0是恶性，1是良性。为了将这些数值转换为真实名称，我们编写以下代码：
- en: '[PRE11]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This line of code will split the dataset into two—one for training and one
    for testing, and will save it in the corresponding variables defined for the purpose:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 这行代码将数据集分成两个——一个用于训练，一个用于测试，并将其保存到为该目的定义的相应变量中：
- en: '[PRE12]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The following will create a classifier:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的代码将创建一个分类器：
- en: '[PRE13]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'This code will feed the training data and train the model:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码将提供训练数据并训练模型：
- en: '[PRE14]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The preceding line will print the predicted cancer types for the testing data
    to the console, as shown here:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 上一行将打印测试数据的预测癌症类型到控制台，如下所示：
- en: '![](img/db7a7788-e16b-434d-8d39-2c5c91e3eddc.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/db7a7788-e16b-434d-8d39-2c5c91e3eddc.png)'
- en: Converting the scikit model to the Core ML model
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将scikit模型转换为Core ML模型
- en: 'Let me explain using an example: let''s assume you''re from France and you
    only speak French and English. Imagine you went to India on vacation. And you
    went to your hotel restaurant, where the waiter offered you a menu that was written
    in a local language. Now, what would you do? Let me guess, you''d ask the waiter, or
    another customer/your tour guide, to explain the items to you, or you simply scan
    the images in Google translate.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 让我通过一个例子来解释：假设你是法国人，只会说法语和英语。想象一下你去印度度假。然后你去了酒店餐厅，服务员给你提供了一份用当地语言写的菜单。现在，你会怎么做？让我猜猜，你会问服务员，或者另一个顾客/你的导游，解释这些项目给你听，或者你简单地扫描Google翻译中的图片。
- en: My point is that you need a translator. That's it. Similarly, in order for the
    scikit model to be understood by the iOS mobile application, a converter that
    will translate it to the Core ML format is required.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 我的观点是，你需要一个翻译器。就是这样。同样，为了让scikit模型被iOS移动应用程序理解，需要一个将其转换为Core ML格式的转换器。
- en: 'That''s all the work of the following code. It will convert the scikit-learn
    format to the Core ML format:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码完成了所有的工作。它将scikit-learn格式转换为Core ML格式：
- en: '[PRE15]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'For this, to work, you have to install `coremltools` using your `pip`. Then,
    write the following code on the top to import it:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使这个工作正常，你必须使用你的`pip`安装`coremltools`。然后，在顶部写下以下代码来导入它：
- en: '[PRE16]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Once you run this program, you will get a model file in your disk, named  `cancermodel.mlmodel`,
    which you'll use in your iOS project for inference.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦运行这个程序，你将在你的磁盘上得到一个名为`cancermodel.mlmodel`的模型文件，你将在iOS项目中用它来进行推理。
- en: Creating an iOS mobile application using the Core ML model
  id: totrans-142
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Core ML模型创建iOS移动应用程序
- en: In this section, we will be creating an iOS project to use Core ML, for which
    you will require Xcode (it must be version 9+).
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将创建一个iOS项目来使用Core ML，为此你需要Xcode（版本必须是9+）。
- en: 'Let''s get started by opening Xcode and creating an empty swift application
    with a storyboard. In the main storyboard design, the screen will appear as follows. Then,
    add the generated model file to your project. This should give you the following
    structure:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从打开Xcode并创建一个带有故事板的空swift应用程序开始。在主故事板设计中，屏幕将如下所示。然后，将生成的模型文件添加到你的项目中。这应该给你以下结构：
- en: '![](img/8852eb62-93c8-45a7-b04b-118ab566e3f1.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/8852eb62-93c8-45a7-b04b-118ab566e3f1.png)'
- en: 'Now, create the UI in your main storyboard file, as shown here:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在你的主故事板文件中创建UI，如下所示：
- en: '![](img/caaef230-54a1-4912-bd7e-9679cae60ff4.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/caaef230-54a1-4912-bd7e-9679cae60ff4.png)'
- en: 'Create outlets for each text field. And add event listener to each and every
    text field. Now, your view controller will look like this:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 为每个文本字段创建出口。并为每个文本字段添加事件监听器。现在，你的视图控制器将如下所示：
- en: '[PRE17]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: You can find the same code in the GitHub repository for this book.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在本书的GitHub仓库中找到相同的代码。
- en: If you encounter any issue while building. Like signing or certificate, please
    google it or write to us.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在构建过程中遇到任何问题，比如签名或证书，请谷歌搜索或给我们写信。
- en: 'Once you set up the project in Xcode, you can run it in the simulator. The
    result will look like this:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你在Xcode中设置了项目，你就可以在模拟器中运行它。结果将如下所示：
- en: '![](img/5a912732-bce4-4f4c-b19f-b715bbfa735f.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/5a912732-bce4-4f4c-b19f-b715bbfa735f.png)'
- en: Summary
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we learned about decision trees and random forests, and the
    differences between them. We also explored a decision tree through a sample dataset
    and Excel using a sample dataset and used random forest algorithm to it in order
    to establish the prediction. We used Core ML to write the iOS program, and then
    we applied the scikit-learn to create the model and converted the scikit model
    to the Core ML model using Core ML tools.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了决策树和随机森林，以及它们之间的区别。我们还通过一个样本数据集和Excel探索了一个决策树，并使用随机森林算法来建立预测。我们使用Core
    ML编写iOS程序，然后我们应用scikit-learn创建模型，并使用Core ML工具将scikit模型转换为Core ML模型。
- en: In the next chapter, we will learn more about TensorFlow and its use in Android.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习更多关于TensorFlow及其在Android中的应用。
- en: Further reading
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: We can get further insight into Core ML and the services it offers by visiting
    their official website: [https://developer.apple.com/documentation/coreml](https://developer.apple.com/documentation/coreml).
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 通过访问他们的官方网站，我们可以进一步了解Core ML及其提供的服务：[https://developer.apple.com/documentation/coreml](https://developer.apple.com/documentation/coreml)。

<html><head></head><body>
<div id="_idContainer195">
<h1 class="chapter-number" id="_idParaDest-275"><a id="_idTextAnchor1323"/><span class="koboSpan" id="kobo.1.1" xmlns:="http://www.w3.org/1999/xhtml">10</span></h1>
<h1 id="_idParaDest-276"><a id="_idTextAnchor1324"/><a id="_idTextAnchor1325"/><span class="koboSpan" id="kobo.2.1" xmlns:="http://www.w3.org/1999/xhtml">Creating Features from a Time Series with tsfresh</span></h1>
<p><span class="koboSpan" id="kobo.3.1" xmlns:="http://www.w3.org/1999/xhtml">Throughout this book, we’ve discussed feature engineering methods and tools tailored for tabular and relational datasets. </span><span class="koboSpan" id="kobo.3.2" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will shift our focus to time-series data. </span><span class="koboSpan" id="kobo.3.3" xmlns:="http://www.w3.org/1999/xhtml">A time series is a sequence of observations taken sequentially over time. </span><span class="koboSpan" id="kobo.3.4" xmlns:="http://www.w3.org/1999/xhtml">Examples include energy generation and demand, temperature, air pollutant concentration, stock prices, and sales revenue. </span><span class="koboSpan" id="kobo.3.5" xmlns:="http://www.w3.org/1999/xhtml">Each of these examples represents a variable and their values change </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1" xmlns:="http://www.w3.org/1999/xhtml">over time.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1" xmlns:="http://www.w3.org/1999/xhtml">The widespread availability of affordable sensors capable of measuring motion, movement, humidity, glucose, and other parameters has significantly increased the amount of temporally annotated data. </span><span class="koboSpan" id="kobo.5.2" xmlns:="http://www.w3.org/1999/xhtml">These time series can be utilized in various classification tasks. </span><span class="koboSpan" id="kobo.5.3" xmlns:="http://www.w3.org/1999/xhtml">For instance, by analyzing the electricity usage pattern of a household at a given time interval, we can infer whether a particular appliance was being used. </span><span class="koboSpan" id="kobo.5.4" xmlns:="http://www.w3.org/1999/xhtml">Similarly, the signal of an ultrasound sensor can help determine the probability of a (gas) pipeline failure, and the characteristics of a sound wavelength can help predict whether a listener will like a song. </span><span class="koboSpan" id="kobo.5.5" xmlns:="http://www.w3.org/1999/xhtml">Time-series data is also valuable for regression tasks. </span><span class="koboSpan" id="kobo.5.6" xmlns:="http://www.w3.org/1999/xhtml">For example, signals from machinery sensors can be used to predict the remaining useful life of </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1" xmlns:="http://www.w3.org/1999/xhtml">the device.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1" xmlns:="http://www.w3.org/1999/xhtml">To use time series with traditional supervised machine learning models, such as linear and logistic regression, or decision-tree-based algorithms, we need to map each time series into a well-defined feature vector that captures its characteristics. </span><span class="koboSpan" id="kobo.7.2" xmlns:="http://www.w3.org/1999/xhtml">Time-series patterns, including trends, seasonality, and periodicity, among other things, can be captured by a combination of simple and complex mathematical operations. </span><span class="koboSpan" id="kobo.7.3" xmlns:="http://www.w3.org/1999/xhtml">Simple calculations include, for instance, taking the mean and the standard deviation of the time series. </span><span class="koboSpan" id="kobo.7.4" xmlns:="http://www.w3.org/1999/xhtml">More complex methods include determining correlation or entropy, for example. </span><span class="koboSpan" id="kobo.7.5" xmlns:="http://www.w3.org/1999/xhtml">In addition, we can apply non-linear time-series analysis functions to decompose the time-series signal, for example, Fourier or wavelet transformations, and use the parameters of these functions as features of the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1" xmlns:="http://www.w3.org/1999/xhtml">supervised models.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1" xmlns:="http://www.w3.org/1999/xhtml">Creating features from time series can be very time-consuming; we need to apply various signal processing and time-series analysis algorithms to identify and extract meaningful features. </span><span class="koboSpan" id="kobo.9.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.10.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.11.1" xmlns:="http://www.w3.org/1999/xhtml"> Python package, which stands for </span><strong class="bold"><span class="koboSpan" id="kobo.12.1" xmlns:="http://www.w3.org/1999/xhtml">Time Series FeatuRe Extraction on the basis of Scalable Hypothesis</span></strong><span class="koboSpan" id="kobo.13.1" xmlns:="http://www.w3.org/1999/xhtml"> tests, streamlines this process. </span><span class="koboSpan" id="kobo.13.2" xmlns:="http://www.w3.org/1999/xhtml">It integrates 63 time-series characterization methods to compute more than 750 features automatically. </span><span class="koboSpan" id="kobo.13.3" xmlns:="http://www.w3.org/1999/xhtml">Additionally, </span><strong class="source-inline"><span class="koboSpan" id="kobo.14.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.15.1" xmlns:="http://www.w3.org/1999/xhtml"> includes a feature selection algorithm that identifies the most predictive features for a given time series. </span><span class="koboSpan" id="kobo.15.2" xmlns:="http://www.w3.org/1999/xhtml">By automating the application of complex time-series methods, </span><strong class="source-inline"><span class="koboSpan" id="kobo.16.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.17.1" xmlns:="http://www.w3.org/1999/xhtml"> bridges the gap between signal-processing experts and machine learning practitioners, making it easier to extract valuable features from </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1" xmlns:="http://www.w3.org/1999/xhtml">time-series data.</span></span></p>
<p><span class="koboSpan" id="kobo.19.1" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will learn how to automatically create hundreds of features from time-series data by utilizing </span><strong class="source-inline"><span class="koboSpan" id="kobo.20.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.21.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.21.2" xmlns:="http://www.w3.org/1999/xhtml">Following that, we will discuss how to fine-tune this feature creation process by selecting the most relevant features, extracting different features from different time series, and integrating the feature creation process into a scikit-learn pipeline to classify </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1" xmlns:="http://www.w3.org/1999/xhtml">time-series data.</span></span></p>
<p><span class="koboSpan" id="kobo.23.1" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will go through the </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1" xmlns:="http://www.w3.org/1999/xhtml">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.25.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting hundreds of features automatically from a </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1" xmlns:="http://www.w3.org/1999/xhtml">time series</span></span></li>
<li><span class="koboSpan" id="kobo.27.1" xmlns:="http://www.w3.org/1999/xhtml">Automatically creating and selecting predictive features from </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1" xmlns:="http://www.w3.org/1999/xhtml">time-series data</span></span></li>
<li><span class="koboSpan" id="kobo.29.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting different features from different </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1" xmlns:="http://www.w3.org/1999/xhtml">time series</span></span></li>
<li><span class="koboSpan" id="kobo.31.1" xmlns:="http://www.w3.org/1999/xhtml">Creating a subset of features identified through </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1" xmlns:="http://www.w3.org/1999/xhtml">feature selection</span></span></li>
<li><span class="koboSpan" id="kobo.33.1" xmlns:="http://www.w3.org/1999/xhtml">Embedding feature creation into a </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn pipeline</span></span></li>
</ul>
<h1 id="_idParaDest-277"><a id="_idTextAnchor1326"/><a id="_idTextAnchor1327"/><span class="koboSpan" id="kobo.35.1" xmlns:="http://www.w3.org/1999/xhtml">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.36.1" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will use the open source </span><strong class="source-inline"><span class="koboSpan" id="kobo.37.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.38.1" xmlns:="http://www.w3.org/1999/xhtml"> Python library. </span><span class="koboSpan" id="kobo.38.2" xmlns:="http://www.w3.org/1999/xhtml">You can install </span><strong class="source-inline"><span class="koboSpan" id="kobo.39.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.40.1" xmlns:="http://www.w3.org/1999/xhtml"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.41.1" xmlns:="http://www.w3.org/1999/xhtml">pip</span></strong><span class="koboSpan" id="kobo.42.1" xmlns:="http://www.w3.org/1999/xhtml"> by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1" xmlns:="http://www.w3.org/1999/xhtml">pip </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.44.1" xmlns:="http://www.w3.org/1999/xhtml">install tsfresh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.45.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.46.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.47.1" xmlns:="http://www.w3.org/1999/xhtml">If you have an old Microsoft operating system, you may need to update the Microsoft C++ build tools to proceed with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.49.1" xmlns:="http://www.w3.org/1999/xhtml"> package’s installation. </span><span class="koboSpan" id="kobo.49.2" xmlns:="http://www.w3.org/1999/xhtml">Follow the steps in this thread to do </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1" xmlns:="http://www.w3.org/1999/xhtml">so: </span></span><a href="https://stackoverflow.com/questions/64261546/how-to-solve-error-microsoft-visual-c-14-0-or-greater-is-required-when-inst"><span class="No-Break"><span class="koboSpan" id="kobo.51.1" xmlns:="http://www.w3.org/1999/xhtml">https://stackoverflow.com/questions/64261546/how-to-solve-error-microsoft-visual-c-14-0-or-greater-is-required-when-inst</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.52.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.53.1" xmlns:="http://www.w3.org/1999/xhtml">We will work</span><a id="_idIndexMarker750"/><span class="koboSpan" id="kobo.54.1" xmlns:="http://www.w3.org/1999/xhtml"> with the </span><strong class="bold"><span class="koboSpan" id="kobo.55.1" xmlns:="http://www.w3.org/1999/xhtml">Occupancy Detection</span></strong><span class="koboSpan" id="kobo.56.1" xmlns:="http://www.w3.org/1999/xhtml"> dataset from the UCI Machine Learning Repository, available at </span><a href="http://archive.ics.uci.edu/ml/datasets/Occupancy+Detection"><span class="koboSpan" id="kobo.57.1" xmlns:="http://www.w3.org/1999/xhtml">http://archive.ics.uci.edu/ml/datasets/Occupancy+Detection</span></a><span class="koboSpan" id="kobo.58.1" xmlns:="http://www.w3.org/1999/xhtml"> and licensed under a Creative Commons Attribution 4.0 International (CC BY 4.0) license: </span><a href="https://creativecommons.org/licenses/by/4.0/legalcode"><span class="koboSpan" id="kobo.59.1" xmlns:="http://www.w3.org/1999/xhtml">https://creativecommons.org/licenses/by/4.0/legalcode</span></a><span class="koboSpan" id="kobo.60.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.60.2" xmlns:="http://www.w3.org/1999/xhtml">The corresponding citation for this data is </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1" xmlns:="http://www.w3.org/1999/xhtml">as follows:</span></span></p>
<p><span class="koboSpan" id="kobo.62.1" xmlns:="http://www.w3.org/1999/xhtml">Candanedo, Luis. </span><span class="koboSpan" id="kobo.62.2" xmlns:="http://www.w3.org/1999/xhtml">(2016). </span><span class="koboSpan" id="kobo.62.3" xmlns:="http://www.w3.org/1999/xhtml">Occupancy Detection. </span><span class="koboSpan" id="kobo.62.4" xmlns:="http://www.w3.org/1999/xhtml">UCI Machine Learning </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1" xmlns:="http://www.w3.org/1999/xhtml">Repository. </span></span><a href="https://doi.org/10.24432/C5X01N"><span class="No-Break"><span class="koboSpan" id="kobo.64.1" xmlns:="http://www.w3.org/1999/xhtml">https://doi.org/10.24432/C5X01N</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.65.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.66.1" xmlns:="http://www.w3.org/1999/xhtml">I downloaded and modified the data as shown in this </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1" xmlns:="http://www.w3.org/1999/xhtml">notebook: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch10-tsfresh/prepare-occupancy-dataset.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.68.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch10-tsfresh/prepare-occupancy-dataset.ipynb</span></span></a></p>
<p><span class="koboSpan" id="kobo.69.1" xmlns:="http://www.w3.org/1999/xhtml">For a copy of the modified dataset and a target variable, check out the files called </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1" xmlns:="http://www.w3.org/1999/xhtml">occupancy.csv</span></strong><span class="koboSpan" id="kobo.71.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1" xmlns:="http://www.w3.org/1999/xhtml">occupancy_target.csv</span></strong><span class="koboSpan" id="kobo.73.1" xmlns:="http://www.w3.org/1999/xhtml">, available at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1" xmlns:="http://www.w3.org/1999/xhtml">link: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch10-tsfresh"><span class="No-Break"><span class="koboSpan" id="kobo.75.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-engineering-Cookbook-Third-Edition/blob/main/ch10-tsfresh</span></span></a></p>
<p><span class="koboSpan" id="kobo.76.1" xmlns:="http://www.w3.org/1999/xhtml">The Occupancy Detection dataset contains time-series data taken over 135 hours at one-minute intervals. </span><span class="koboSpan" id="kobo.76.2" xmlns:="http://www.w3.org/1999/xhtml">The variables measure the temperature, humidity, </span><span class="koboSpan" id="kobo.77.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;C&lt;/mml:mi&gt;&lt;mml:mi&gt;O&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;2&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/38.png" style="vertical-align:-0.333em;height:0.996em;width:1.605em"/></span><span class="koboSpan" id="kobo.78.1" xmlns:="http://www.w3.org/1999/xhtml"> level, and light consumption in an office. </span><span class="koboSpan" id="kobo.78.2" xmlns:="http://www.w3.org/1999/xhtml">Camera footage was used to determine whether someone was in the office. </span><span class="koboSpan" id="kobo.78.3" xmlns:="http://www.w3.org/1999/xhtml">The target variable shows whether the office was occupied at any one hour. </span><span class="koboSpan" id="kobo.78.4" xmlns:="http://www.w3.org/1999/xhtml">If the target takes the value </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.80.1" xmlns:="http://www.w3.org/1999/xhtml">, it means that the office was occupied during that hour; otherwise, it takes the </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1" xmlns:="http://www.w3.org/1999/xhtml">value </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.82.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.83.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.84.1" xmlns:="http://www.w3.org/1999/xhtml">The dataset with the time series and that with the target variable have different numbers of rows. </span><span class="koboSpan" id="kobo.84.2" xmlns:="http://www.w3.org/1999/xhtml">The time-series dataset contains 135 hours of records at one-minute intervals – that is, 8,100 rows. </span><span class="koboSpan" id="kobo.84.3" xmlns:="http://www.w3.org/1999/xhtml">The target has only 135 rows, with a label indicating whether the office was occupied at each of the </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1" xmlns:="http://www.w3.org/1999/xhtml">135 hours.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.86.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.87.1" xmlns:="http://www.w3.org/1999/xhtml">Check out the notebook in this book’s GitHub repository for plots of the different time series to become familiar with the </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1" xmlns:="http://www.w3.org/1999/xhtml">dataset: </span></span><a href="https://github.com/PacktPublishing/Python-Feature-Engineering-Cookbook-Third-Edition/blob/main/ch10-tsfresh/prepare-occupancy-dataset.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.89.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/PacktPublishing/Python-Feature-Engineering-Cookbook-Third-Edition/blob/main/ch10-tsfresh/prepare-occupancy-dataset.ipynb</span></span></a><a id="_idTextAnchor1328"/><a id="_idTextAnchor1329"/></p>
<h1 id="_idParaDest-278"><a id="_idTextAnchor1330"/><span class="koboSpan" id="kobo.90.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting hundreds of features automatically from a time series</span></h1>
<p><span class="koboSpan" id="kobo.91.1" xmlns:="http://www.w3.org/1999/xhtml">Time series </span><a id="_idIndexMarker751"/><span class="koboSpan" id="kobo.92.1" xmlns:="http://www.w3.org/1999/xhtml">a</span><a id="_idTextAnchor1331"/><span class="koboSpan" id="kobo.93.1" xmlns:="http://www.w3.org/1999/xhtml">re data points indexed in time </span><a id="_idIndexMarker752"/><span class="koboSpan" id="kobo.94.1" xmlns:="http://www.w3.org/1999/xhtml">order. </span><span class="koboSpan" id="kobo.94.2" xmlns:="http://www.w3.org/1999/xhtml">Analyzing time-series sequences allows us to make various predictions. </span><span class="koboSpan" id="kobo.94.3" xmlns:="http://www.w3.org/1999/xhtml">For example, sensor data can be used to predict pipeline failures, sound data can help identify music genres, health history or personal measurements such as glucose levels can indicate whether a person is sick, and, as we will show in this recipe, patterns of light usage, humidity, and </span><span class="koboSpan" id="kobo.95.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;C&lt;/mml:mi&gt;&lt;mml:mi&gt;O&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;2&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/39.png" style="vertical-align:-0.333em;height:0.996em;width:1.591em"/></span><span class="koboSpan" id="kobo.96.1" xmlns:="http://www.w3.org/1999/xhtml"> levels can determine whether an office </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1" xmlns:="http://www.w3.org/1999/xhtml">is occupied.</span></span></p>
<p><span class="koboSpan" id="kobo.98.1" xmlns:="http://www.w3.org/1999/xhtml">To tra</span><a id="_idTextAnchor1332"/><span class="koboSpan" id="kobo.99.1" xmlns:="http://www.w3.org/1999/xhtml">in regression and classification models using traditional machine learning algorithms, such as linear regression or random forests, we require a dataset of size </span><em class="italic"><span class="koboSpan" id="kobo.100.1" xmlns:="http://www.w3.org/1999/xhtml">M x N</span></em><span class="koboSpan" id="kobo.101.1" xmlns:="http://www.w3.org/1999/xhtml">, where M is the number of rows and N is the number of features or columns. </span><span class="koboSpan" id="kobo.101.2" xmlns:="http://www.w3.org/1999/xhtml">However, with time-series data, what we have is a collection of </span><em class="italic"><span class="koboSpan" id="kobo.102.1" xmlns:="http://www.w3.org/1999/xhtml">M</span></em><span class="koboSpan" id="kobo.103.1" xmlns:="http://www.w3.org/1999/xhtml"> time series, and each time series has multiple rows indexed chronologically. </span><span class="koboSpan" id="kobo.103.2" xmlns:="http://www.w3.org/1999/xhtml">To use time series in supervised learning models, each time series needs to be mapped into a well-defined feature vector, </span><em class="italic"><span class="koboSpan" id="kobo.104.1" xmlns:="http://www.w3.org/1999/xhtml">N</span></em><span class="koboSpan" id="kobo.105.1" xmlns:="http://www.w3.org/1999/xhtml">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1" xmlns:="http://www.w3.org/1999/xhtml">following diagram</span><a id="_idTextAnchor1333"/><span class="koboSpan" id="kobo.107.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer180">
<span class="koboSpan" id="kobo.108.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 10.1 – Diagram showing the process of feature creation from a time series for classification or regression" src="image/B22396_10_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.109.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10.1 – Diagram showing the process of feature creation from a time series for classification or regression</span></p>
<p><span class="koboSpan" id="kobo.110.1" xmlns:="http://www.w3.org/1999/xhtml">The</span><a id="_idTextAnchor1334"/><span class="koboSpan" id="kobo.111.1" xmlns:="http://www.w3.org/1999/xhtml">se feature vectors, which are represented as </span><span class="koboSpan" id="kobo.112.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;x&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;1&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/40.png" style="vertical-align:-0.333em;height:0.781em;width:0.836em"/></span><span class="koboSpan" id="kobo.113.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="koboSpan" id="kobo.114.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;x&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;2&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/41.png" style="vertical-align:-0.333em;height:0.781em;width:0.838em"/></span><span class="koboSpan" id="kobo.115.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><span class="koboSpan" id="kobo.116.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;x&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;3&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/42.png" style="vertical-align:-0.340em;height:0.788em;width:0.840em"/></span><span class="koboSpan" id="kobo.117.1" xmlns:="http://www.w3.org/1999/xhtml"> in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.118.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.119.1" xmlns:="http://www.w3.org/1999/xhtml">.1</span></em><span class="koboSpan" id="kobo.120.1" xmlns:="http://www.w3.org/1999/xhtml">, should capture the characteristics of the time series. </span><span class="koboSpan" id="kobo.120.2" xmlns:="http://www.w3.org/1999/xhtml">For example, </span><span class="koboSpan" id="kobo.121.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;x&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;1&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/43.png" style="vertical-align:-0.333em;height:0.781em;width:0.744em"/></span><span class="koboSpan" id="kobo.122.1" xmlns:="http://www.w3.org/1999/xhtml">could be the mean value of the time series and </span><span class="koboSpan" id="kobo.123.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;x&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;2&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/44.png" style="vertical-align:-0.333em;height:0.781em;width:0.744em"/></span><span class="koboSpan" id="kobo.124.1" xmlns:="http://www.w3.org/1999/xhtml">its variance. </span><span class="koboSpan" id="kobo.124.2" xmlns:="http://www.w3.org/1999/xhtml">We can crea</span><a id="_idTextAnchor1335"/><span class="koboSpan" id="kobo.125.1" xmlns:="http://www.w3.org/1999/xhtml">te many features to characterize the time series concerning the distribution of data points, correlation properties, stationarity, or entropy, among others. </span><span class="koboSpan" id="kobo.125.2" xmlns:="http://www.w3.org/1999/xhtml">Therefore, the feature vector, N, can be constructed by applying a series </span><a id="_idIndexMarker753"/><span class="koboSpan" id="kobo.126.1" xmlns:="http://www.w3.org/1999/xhtml">of </span><strong class="bold"><span class="koboSpan" id="kobo.127.1" xmlns:="http://www.w3.org/1999/xhtml">characterization methods</span></strong><span class="koboSpan" id="kobo.128.1" xmlns:="http://www.w3.org/1999/xhtml"> t</span><a id="_idTextAnchor1336"/><span class="koboSpan" id="kobo.129.1" xmlns:="http://www.w3.org/1999/xhtml">hat take a time series as input and return one or more scalars as output. </span><span class="koboSpan" id="kobo.129.2" xmlns:="http://www.w3.org/1999/xhtml">The mean, or the sum, takes the time-series sequence as input and returns a single scalar as output, with the mean value of the time series or the sum of its values. </span><span class="koboSpan" id="kobo.129.3" xmlns:="http://www.w3.org/1999/xhtml">We can also fit a linear trend to the time-series sequence, which will return two scalars – one with the slope and one with </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1" xmlns:="http://www.w3.org/1999/xhtml">the intercep</span><a id="_idTextAnchor1337"/><span class="koboSpan" id="kobo.131.1" xmlns:="http://www.w3.org/1999/xhtml">t.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.132.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.133.1" xmlns:="http://www.w3.org/1999/xhtml"> applies 63 characterization methods to a time series, each of which returns one or more scalars, therefore resulting in more than 750 features for any given time series. </span><span class="koboSpan" id="kobo.133.2" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will use </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.135.1" xmlns:="http://www.w3.org/1999/xhtml"> to transform time-series data into an M x N feature </span><a id="_idIndexMarker754"/><span class="koboSpan" id="kobo.136.1" xmlns:="http://www.w3.org/1999/xhtml">table, which </span><a id="_idIndexMarker755"/><span class="koboSpan" id="kobo.137.1" xmlns:="http://www.w3.org/1999/xhtml">we will then use to predict </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1" xmlns:="http://www.w3.org/1999/xhtml">office occupa</span><a id="_idTextAnchor1338"/><a id="_idTextAnchor1339"/><span class="koboSpan" id="kobo.139.1" xmlns:="http://www.w3.org/1999/xhtml">ncy.</span></span></p>
<h2 id="_idParaDest-279"><a id="_idTextAnchor1340"/><span class="koboSpan" id="kobo.140.1" xmlns:="http://www.w3.org/1999/xhtml">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.141.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we wil</span><a id="_idTextAnchor1341"/><span class="koboSpan" id="kobo.142.1" xmlns:="http://www.w3.org/1999/xhtml">l use the Occupancy Detection dataset described in the </span><em class="italic"><span class="koboSpan" id="kobo.143.1" xmlns:="http://www.w3.org/1999/xhtml">Technical requirements</span></em><span class="koboSpan" id="kobo.144.1" xmlns:="http://www.w3.org/1999/xhtml"> section. </span><span class="koboSpan" id="kobo.144.2" xmlns:="http://www.w3.org/1999/xhtml">This dataset contains measurements of temperature, humidity, </span><span class="koboSpan" id="kobo.145.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;C&lt;/mml:mi&gt;&lt;mml:mi&gt;O&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;2&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/45.png" style="vertical-align:-0.333em;height:0.996em;width:1.522em"/></span><span class="koboSpan" id="kobo.146.1" xmlns:="http://www.w3.org/1999/xhtml"> level, and light consumption in an office taken at one-minute intervals. </span><span class="koboSpan" id="kobo.146.2" xmlns:="http://www.w3.org/1999/xhtml">There are 135 hours of measurements, and each hour is flagged with a unique identifier. </span><span class="koboSpan" id="kobo.146.3" xmlns:="http://www.w3.org/1999/xhtml">There is also a dataset with a target variable that indicates in which of these 135 hours the office was occupied. </span><span class="koboSpan" id="kobo.146.4" xmlns:="http://www.w3.org/1999/xhtml">Let’s load the data and make some plot</span><a id="_idTextAnchor1342"/><span class="koboSpan" id="kobo.147.1" xmlns:="http://www.w3.org/1999/xhtml">s to understand </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1" xmlns:="http://www.w3.org/1999/xhtml">its patterns:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.149.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s load </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.151.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.152.1" xmlns:="http://www.w3.org/1999/xhtml">matplotlib</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.153.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.154.1" xmlns:="http://www.w3.org/1999/xhtml">
import matplotlib.pyplot as plt
import pandas as pd</span></pre></li> <li><span class="koboSpan" id="kobo.155.1" xmlns:="http://www.w3.org/1999/xhtml">Load the dataset and display the first </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1" xmlns:="http://www.w3.org/1999/xhtml">five rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.157.1" xmlns:="http://www.w3.org/1999/xhtml">
X = pd.read_csv(
    "occupancy.csv", parse_dates=["date"])
X.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.158.1" xmlns:="http://www.w3.org/1999/xhtml">In the following figure, we can see the dataset containing a unique identifier, followed by the date and time of the measurements and values for five time series capturing temperature, humidity, lights, and </span><span class="koboSpan" id="kobo.159.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;C&lt;/mml:mi&gt;&lt;mml:mi&gt;O&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;2&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/39.png" style="vertical-align:-0.333em;height:0.996em;width:1.591em"/></span><span class="koboSpan" id="kobo.160.1" xmlns:="http://www.w3.org/1999/xhtml"> levels in </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1" xmlns:="http://www.w3.org/1999/xhtml">the offi</span><a id="_idTextAnchor1343"/><span class="koboSpan" id="kobo.162.1" xmlns:="http://www.w3.org/1999/xhtml">ce:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer188">
<span class="koboSpan" id="kobo.163.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 10.2 – DataFrame with the time-series data" src="image/B22396_10_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.164.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10.2 – DataFrame with the time-series data</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.165.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s creat</span><a id="_idTextAnchor1344"/><span class="koboSpan" id="kobo.166.1" xmlns:="http://www.w3.org/1999/xhtml">e a </span><a id="_idIndexMarker756"/><span class="koboSpan" id="kobo.167.1" xmlns:="http://www.w3.org/1999/xhtml">function to</span><a id="_idIndexMarker757"/><span class="koboSpan" id="kobo.168.1" xmlns:="http://www.w3.org/1999/xhtml"> plot the time series from </span><em class="italic"><span class="koboSpan" id="kobo.169.1" xmlns:="http://www.w3.org/1999/xhtml">step 2</span></em><span class="koboSpan" id="kobo.170.1" xmlns:="http://www.w3.org/1999/xhtml"> at a given hour (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1" xmlns:="http://www.w3.org/1999/xhtml">id</span></strong><span class="koboSpan" id="kobo.172.1" xmlns:="http://www.w3.org/1999/xhtml"> column is a unique identifier for each of the 135 hours </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1" xmlns:="http://www.w3.org/1999/xhtml">of records):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.174.1" xmlns:="http://www.w3.org/1999/xhtml">
def plot_timeseries(n_id):
    fig, axes = plt.subplots(nrows=2, ncols=3,
    figsize=(20, 10))
    X[X[«id»] == n_id]["temperature"].plot(
        ax=axes[0, 0], title="temperature")
    X[X[«id»] == n_id]["humidity"].plot(
        ax=axes[0, 1], title="humidity")
    X[X[«id»] == n_id]["light"].plot(
        ax=axes[0, 2], title="light")
    X[X[«id»] == n_id]["co2"].plot(
    ax=axes[1, 0], title="co2")
    X[X[«id»] == n_id]["humidity_ratio"].plot(
        ax=axes[1,1], title="humidity_ratio")
    plt.show()</span></pre></li> <li><span class="koboSpan" id="kobo.175.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idTextAnchor1345"/><span class="koboSpan" id="kobo.176.1" xmlns:="http://www.w3.org/1999/xhtml"> plot the time series corresponding to an hour when the office was </span><span class="No-Break"><span class="koboSpan" id="kobo.177.1" xmlns:="http://www.w3.org/1999/xhtml">not occupied:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.178.1" xmlns:="http://www.w3.org/1999/xhtml">
plot_timeseries(2)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.179.1" xmlns:="http://www.w3.org/1999/xhtml">In the following figure, we can see the time-series values during the second hour of </span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.180.1" xmlns:="http://www.w3.org/1999/xhtml">records, when the office</span><a id="_idIndexMarker759"/> <span class="No-Break"><span class="koboSpan" id="kobo.181.1" xmlns:="http://www.w3.org/1999/xhtml">was </span><a id="_idTextAnchor1346"/><span class="koboSpan" id="kobo.182.1" xmlns:="http://www.w3.org/1999/xhtml">empty:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer189">
<span class="koboSpan" id="kobo.183.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 10.3 – Time-series values during the second hour of data collection when the office was empt﻿y" src="image/B22396_10_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.184.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10.3 – Time-series values during the second hour of data collection when the office was empt</span><a id="_idTextAnchor1347"/><span class="koboSpan" id="kobo.185.1" xmlns:="http://www.w3.org/1999/xhtml">y</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.186.1" xmlns:="http://www.w3.org/1999/xhtml">Note that the lights were off, and that </span><a id="_idTextAnchor1348"/><span class="koboSpan" id="kobo.187.1" xmlns:="http://www.w3.org/1999/xhtml">is why we see the flat line at 0 in the plot of </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1" xmlns:="http://www.w3.org/1999/xhtml">light</span></strong><span class="koboSpan" id="kobo.189.1" xmlns:="http://www.w3.org/1999/xhtml"> consumption in the </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1" xmlns:="http://www.w3.org/1999/xhtml">top-right corner.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.191.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s plot the time-series data corresponding to an hour when the office </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1" xmlns:="http://www.w3.org/1999/xhtml">was occupied:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.193.1" xmlns:="http://www.w3.org/1999/xhtml">
plot_timeseries(15)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.194.1" xmlns:="http://www.w3.org/1999/xhtml">In the following figure, we can see the time-series values during the fifteenth hour of records, when the office </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1" xmlns:="http://www.w3.org/1999/xhtml">was occu</span><a id="_idTextAnchor1349"/><span class="koboSpan" id="kobo.196.1" xmlns:="http://www.w3.org/1999/xhtml">pied:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer190">
<span class="koboSpan" id="kobo.197.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 10.4 – Time-series values during the fifteenth hour of data collection, when the office was occupied" src="image/B22396_10_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.198.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10.4 – Time-series values during the fifteenth hour of data collection, when the office was occupied</span></p>
<p><span class="koboSpan" id="kobo.199.1" xmlns:="http://www.w3.org/1999/xhtml">Notice that the lights were on this time (</span><span class="No-Break"><span class="koboSpan" id="kobo.200.1" xmlns:="http://www.w3.org/1999/xhtml">top-right panel).</span></span></p>
<p><span class="koboSpan" id="kobo.201.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will extract features from each of these one-hour windows of time-series data, capturing</span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.202.1" xmlns:="http://www.w3.org/1999/xhtml"> various aspects of their </span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.203.1" xmlns:="http://www.w3.org/1999/xhtml">character</span><a id="_idTextAnchor1350"/><span class="koboSpan" id="kobo.204.1" xmlns:="http://www.w3.org/1999/xhtml">istics. </span><span class="koboSpan" id="kobo.204.2" xmlns:="http://www.w3.org/1999/xhtml">From each of these 60-minute time-series segments, we will automatically generate more than 750 features using </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.206.1" xmlns:="http://www.w3.org/1999/xhtml">, ensuring a comprehensive representation of the </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1" xmlns:="http://www.w3.org/1999/xhtml">data’s prop</span><a id="_idTextAnchor1351"/><a id="_idTextAnchor1352"/><span class="koboSpan" id="kobo.208.1" xmlns:="http://www.w3.org/1999/xhtml">erties.</span></span></p>
<h2 id="_idParaDest-280"><a id="_idTextAnchor1353"/><span class="koboSpan" id="kobo.209.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.210.1" xmlns:="http://www.w3.org/1999/xhtml">We will begin by automatically creating hundreds of features from one time series, </span><strong class="source-inline"><span class="koboSpan" id="kobo.211.1" xmlns:="http://www.w3.org/1999/xhtml">lights</span></strong><span class="koboSpan" id="kobo.212.1" xmlns:="http://www.w3.org/1999/xhtml">, and then use those features to predict whether the office was occupied at any </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1" xmlns:="http://www.w3.org/1999/xhtml">given hour:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.214.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the required Python libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1" xmlns:="http://www.w3.org/1999/xhtml">and functions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.216.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import classification_report
from sklearn.model_selection import train_test_split
from tsfresh import extract_features
from tsfresh.utilities.dataframe_functions import (
    impute
)</span></pre></li> <li><span class="koboSpan" id="kobo.217.1" xmlns:="http://www.w3.org/1999/xhtml">Load the dataset described in the </span><em class="italic"><span class="koboSpan" id="kobo.218.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.219.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.220.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.221.1" xmlns:="http://www.w3.org/1999/xhtml">
X = pd.read_csv("occupancy.csv", parse_dates=["date"])</span></pre></li> <li><span class="koboSpan" id="kobo.222.1" xmlns:="http://www.w3.org/1999/xhtml">L</span><a id="_idTextAnchor1354"/><span class="koboSpan" id="kobo.223.1" xmlns:="http://www.w3.org/1999/xhtml">oad the target variable into a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.224.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.225.1" xmlns:="http://www.w3.org/1999/xhtml"> Series:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.226.1" xmlns:="http://www.w3.org/1999/xhtml">
y = pd.read_csv("occupancy_target.csv",
    index_col="id")["occupancy"]</span></pre></li> <li><span class="koboSpan" id="kobo.227.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create hundreds of features automatically for each hour of light records using </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.229.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.229.2" xmlns:="http://www.w3.org/1999/xhtml">To create features from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.230.1" xmlns:="http://www.w3.org/1999/xhtml">light</span></strong><span class="koboSpan" id="kobo.231.1" xmlns:="http://www.w3.org/1999/xhtml"> variable, we pass the DataFrame containing this variable and the unique identifier for each time series to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.233.1" xmlns:="http://www.w3.org/1999/xhtml"> function </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1" xmlns:="http://www.w3.org/1999/xhtml">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.235.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.236.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.237.1" xmlns:="http://www.w3.org/1999/xhtml">
features = extract_features(
    X[[«id», «light»]], column_id="id")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.238.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1" xmlns:="http://www.w3.org/1999/xhtml">features.shape</span></strong><span class="koboSpan" id="kobo.240.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll obtain </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1" xmlns:="http://www.w3.org/1999/xhtml">(135, 789)</span></strong><span class="koboSpan" id="kobo.242.1" xmlns:="http://www.w3.org/1999/xhtml"> corresponding to the size </span><a id="_idIndexMarker762"/><span class="koboSpan" id="kobo.243.1" xmlns:="http://www.w3.org/1999/xhtml">of </span><a id="_idIndexMarker763"/><span class="koboSpan" id="kobo.244.1" xmlns:="http://www.w3.org/1999/xhtml">the resulting DataFrame, where each row represents an hour of records and each column one of the features created by </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.246.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.246.2" xmlns:="http://www.w3.org/1999/xhtml">There are 789 features that characterize light consumption at any given hour. </span><span class="koboSpan" id="kobo.246.3" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1" xmlns:="http://www.w3.org/1999/xhtml">features.head()</span></strong><span class="koboSpan" id="kobo.248.1" xmlns:="http://www.w3.org/1999/xhtml"> to get a view of the resulting DataFrame. </span><span class="koboSpan" id="kobo.248.2" xmlns:="http://www.w3.org/1999/xhtml">For space reasons, we can’t display the entire DataFrame in the book. </span><span class="koboSpan" id="kobo.248.3" xmlns:="http://www.w3.org/1999/xhtml">So, instead, we will explore some of </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1" xmlns:="http://www.w3.org/1999/xhtml">the features.</span></span></p></li> <li><span class="koboSpan" id="kobo.250.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s capture the names of five of the created features in </span><span class="No-Break"><span class="koboSpan" id="kobo.251.1" xmlns:="http://www.w3.org/1999/xhtml">an array:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.252.1" xmlns:="http://www.w3.org/1999/xhtml">
feats = features.columns[10:15]</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.253.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1" xmlns:="http://www.w3.org/1999/xhtml">feats</span></strong><span class="koboSpan" id="kobo.255.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the names of five features corresponding to the mean, length, standard deviation, coefficient of variation, and variance of the light consumption </span><span class="No-Break"><span class="koboSpan" id="kobo.256.1" xmlns:="http://www.w3.org/1999/xhtml">per hour:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.257.1" xmlns:="http://www.w3.org/1999/xhtml">Index(['light__mean', 'light__length', </span></strong><span class="koboSpan" id="kobo.258.1" xmlns:="http://www.w3.org/1999/xhtml">
    </span><strong class="bold"><span class="koboSpan" id="kobo.259.1" xmlns:="http://www.w3.org/1999/xhtml">'light__standard_deviation', </span></strong><span class="koboSpan" id="kobo.260.1" xmlns:="http://www.w3.org/1999/xhtml">
    </span><strong class="bold"><span class="koboSpan" id="kobo.261.1" xmlns:="http://www.w3.org/1999/xhtml">'light__variation_coefficient', </span></strong><span class="koboSpan" id="kobo.262.1" xmlns:="http://www.w3.org/1999/xhtml">
    </span><strong class="bold"><span class="koboSpan" id="kobo.263.1" xmlns:="http://www.w3.org/1999/xhtml">'light__variance'], dtype='object')</span></strong></pre></li> <li><a id="_idTextAnchor1355"/><span class="koboSpan" id="kobo.264.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s display the values of the features from </span><em class="italic"><span class="koboSpan" id="kobo.265.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em><span class="koboSpan" id="kobo.266.1" xmlns:="http://www.w3.org/1999/xhtml"> for the first </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1" xmlns:="http://www.w3.org/1999/xhtml">five hours:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.268.1" xmlns:="http://www.w3.org/1999/xhtml">
features[feats].head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.269.1" xmlns:="http://www.w3.org/1999/xhtml">In the following DataFrame, we see the features extracted from the time series for the first</span><a id="_idIndexMarker764"/><span class="koboSpan" id="kobo.270.1" xmlns:="http://www.w3.org/1999/xhtml"> five hours of </span><span class="No-Break"><span class="koboSpan" id="kobo.271.1" xmlns:="http://www.w3.org/1999/xhtml">light </span></span><span class="No-Break"><a id="_idIndexMarker765"/></span><span class="No-Break"><span class="koboSpan" id="kobo.272.1" xmlns:="http://www.w3.org/1999/xhtml">co</span><a id="_idTextAnchor1356"/><span class="koboSpan" id="kobo.273.1" xmlns:="http://www.w3.org/1999/xhtml">nsumption:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer191">
<span class="koboSpan" id="kobo.274.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 10.5 – Features created for each hour of light consumption" src="image/B22396_10_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.275.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10.5 – Features created for each hour of light consumption</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.276.1" xmlns:="http://www.w3.org/1999/xhtml">Looking at the mean value of light consumption in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.277.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.278.1" xmlns:="http://www.w3.org/1999/xhtml">.4</span></em><span class="koboSpan" id="kobo.279.1" xmlns:="http://www.w3.org/1999/xhtml">, we can see that the lights were on during the first hour, and then </span><a id="_idTextAnchor1357"/><span class="koboSpan" id="kobo.280.1" xmlns:="http://www.w3.org/1999/xhtml">off in the following four hours. </span><span class="koboSpan" id="kobo.280.2" xmlns:="http://www.w3.org/1999/xhtml">The length of the time series is 60 because we have 60 minutes of records </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1" xmlns:="http://www.w3.org/1999/xhtml">per hour.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.282.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.283.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.284.1" xmlns:="http://www.w3.org/1999/xhtml"> applies 63 feature creation methods to a time series. </span><span class="koboSpan" id="kobo.284.2" xmlns:="http://www.w3.org/1999/xhtml">Based on the characteristics of the time series, such as its length or its variability, some of the methods will return missing values or infinite values. </span><span class="koboSpan" id="kobo.284.3" xmlns:="http://www.w3.org/1999/xhtml">For example, in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.285.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.286.1" xmlns:="http://www.w3.org/1999/xhtml">.4</span></em><span class="koboSpan" id="kobo.287.1" xmlns:="http://www.w3.org/1999/xhtml">, w</span><a id="_idTextAnchor1358"/><span class="koboSpan" id="kobo.288.1" xmlns:="http://www.w3.org/1999/xhtml">e see that the variation coefficient could not be calculated for those hours where the light consumption is constant. </span><span class="koboSpan" id="kobo.288.2" xmlns:="http://www.w3.org/1999/xhtml">And the variance is also </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.290.1" xmlns:="http://www.w3.org/1999/xhtml"> in those cases. </span><span class="koboSpan" id="kobo.290.2" xmlns:="http://www.w3.org/1999/xhtml">In fact, for our dataset, many of the resulting features contain only </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1" xmlns:="http://www.w3.org/1999/xhtml">NaN</span></strong><span class="koboSpan" id="kobo.292.1" xmlns:="http://www.w3.org/1999/xhtml"> values, or are constant, like the length, and are therefore not useful for training machine </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1" xmlns:="http://www.w3.org/1999/xhtml">learning models.</span></span></p>
<ol>
<li value="7"><strong class="source-inline"><span class="koboSpan" id="kobo.294.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.295.1" xmlns:="http://www.w3.org/1999/xhtml"> includes an imputation function to impute features that contain </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1" xmlns:="http://www.w3.org/1999/xhtml">NaN</span></strong><span class="koboSpan" id="kobo.297.1" xmlns:="http://www.w3.org/1999/xhtml"> values. </span><span class="koboSpan" id="kobo.297.2" xmlns:="http://www.w3.org/1999/xhtml">Let’s go ahead and impute </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1" xmlns:="http://www.w3.org/1999/xhtml">our features:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.299.1" xmlns:="http://www.w3.org/1999/xhtml">
impute(features)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.300.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1" xmlns:="http://www.w3.org/1999/xhtml">impute</span></strong><span class="koboSpan" id="kobo.302.1" xmlns:="http://www.w3.org/1999/xhtml"> function from </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.304.1" xmlns:="http://www.w3.org/1999/xhtml"> replaces </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1" xmlns:="http://www.w3.org/1999/xhtml">NaN</span></strong><span class="koboSpan" id="kobo.306.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1" xmlns:="http://www.w3.org/1999/xhtml">-Inf</span></strong><span class="koboSpan" id="kobo.308.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1" xmlns:="http://www.w3.org/1999/xhtml">Inf</span></strong><span class="koboSpan" id="kobo.310.1" xmlns:="http://www.w3.org/1999/xhtml"> values with the variable’s median, minimum, or maximum </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1" xmlns:="http://www.w3.org/1999/xhtml">values, respectively.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.312.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s use these features to train a logistic regression model and predict whether the office </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1" xmlns:="http://www.w3.org/1999/xhtml">was occupied.</span></span></p></li> <li><span class="koboSpan" id="kobo.314.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin</span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.315.1" xmlns:="http://www.w3.org/1999/xhtml"> by separating the</span><a id="_idIndexMarker767"/><span class="koboSpan" id="kobo.316.1" xmlns:="http://www.w3.org/1999/xhtml"> dataset into training and </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.318.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    features,
    y,
    test_size=0.1,
    random_state=42,
)</span></pre></li> <li><span class="koboSpan" id="kobo.319.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s set up and train a logistic regression model, and then evaluate </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1" xmlns:="http://www.w3.org/1999/xhtml">its performance:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.321.1" xmlns:="http://www.w3.org/1999/xhtml">
cls = LogisticRegression(random_state=10, C=0.01)
cls.fit(X_train, y_train)
print(classification_report(
     y_test, cls.predict(X_test)))</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.322.1" xmlns:="http://www.w3.org/1999/xhtml">In t</span><a id="_idTextAnchor1359"/><span class="koboSpan" id="kobo.323.1" xmlns:="http://www.w3.org/1999/xhtml">he following output, we see the values of evaluation metrics that are commonly used for classification analysis, which suggests that the created features ar</span><a id="_idTextAnchor1360"/><span class="koboSpan" id="kobo.324.1" xmlns:="http://www.w3.org/1999/xhtml">e useful for predicting </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1" xmlns:="http://www.w3.org/1999/xhtml">office occupancy:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.326.1" xmlns:="http://www.w3.org/1999/xhtml">                  precision     recall</span></strong><strong class="bold"><span class="koboSpan" id="kobo.327.1" xmlns:="http://www.w3.org/1999/xhtml">  f1-score   support</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.328.1" xmlns:="http://www.w3.org/1999/xhtml">               0         1.00        1.00        1.00           11</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.329.1" xmlns:="http://www.w3.org/1999/xhtml">               1         1.00        </span></strong><strong class="bold"><span class="koboSpan" id="kobo.330.1" xmlns:="http://www.w3.org/1999/xhtml">1.00        1.00            3</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.331.1" xmlns:="http://www.w3.org/1999/xhtml">     accuracy                                       1.00           14</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.332.1" xmlns:="http://www.w3.org/1999/xhtml">   macro avg         1.00        1.00        1.00</span></strong><strong class="bold"><span class="koboSpan" id="kobo.333.1" xmlns:="http://www.w3.org/1999/xhtml">           14</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.334.1" xmlns:="http://www.w3.org/1999/xhtml">weighted avg         1.00        1.00        1.00           14</span></strong></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.335.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.336.1" xmlns:="http://www.w3.org/1999/xhtml">To keep the recipe simple, I have not optimized the model hyperparameters or tuned the probability threshold – things that we normally do to ensure our models </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1" xmlns:="http://www.w3.org/1999/xhtml">are accurate.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.338.1" xmlns:="http://www.w3.org/1999/xhtml">To finish </span><a id="_idIndexMarker768"/><span class="koboSpan" id="kobo.339.1" xmlns:="http://www.w3.org/1999/xhtml">off, let’s </span><a id="_idIndexMarker769"/><span class="koboSpan" id="kobo.340.1" xmlns:="http://www.w3.org/1999/xhtml">extract features from every time series, that is, </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1" xmlns:="http://www.w3.org/1999/xhtml">light</span></strong><span class="koboSpan" id="kobo.342.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1" xmlns:="http://www.w3.org/1999/xhtml">temperature</span></strong><span class="koboSpan" id="kobo.344.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1" xmlns:="http://www.w3.org/1999/xhtml">humidity</span></strong><span class="koboSpan" id="kobo.346.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1" xmlns:="http://www.w3.org/1999/xhtml">co2</span></strong><span class="koboSpan" id="kobo.348.1" xmlns:="http://www.w3.org/1999/xhtml">, and this time, we will impute the features right after </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1" xmlns:="http://www.w3.org/1999/xhtml">the extraction:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.350.1" xmlns:="http://www.w3.org/1999/xhtml">
features = extract_features(
    X,
    column_id="id",
    impute_function=impute,
    column_sort="date",
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.351.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.352.1" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.353.1" xmlns:="http://www.w3.org/1999/xhtml">step 10</span></em><span class="koboSpan" id="kobo.354.1" xmlns:="http://www.w3.org/1999/xhtml">, we indicated that we want to sort our time series based on the timestamp containing the time and date of the measurement, by passing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.355.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong><span class="koboSpan" id="kobo.356.1" xmlns:="http://www.w3.org/1999/xhtml"> variable to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1" xmlns:="http://www.w3.org/1999/xhtml">column_sort</span></strong><span class="koboSpan" id="kobo.358.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter. </span><span class="koboSpan" id="kobo.358.2" xmlns:="http://www.w3.org/1999/xhtml">This is useful when our time series are not equidistant or not ordered chronologically. </span><span class="koboSpan" id="kobo.358.3" xmlns:="http://www.w3.org/1999/xhtml">If we leave this parameter set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.360.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.362.1" xmlns:="http://www.w3.org/1999/xhtml"> assumes that the time series are ordered </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1" xmlns:="http://www.w3.org/1999/xhtml">and eq</span><a id="_idTextAnchor1361"/><span class="koboSpan" id="kobo.364.1" xmlns:="http://www.w3.org/1999/xhtml">uidistant.</span></span></p>
<p><span class="koboSpan" id="kobo.365.1" xmlns:="http://www.w3.org/1999/xhtml">The output of </span><em class="italic"><span class="koboSpan" id="kobo.366.1" xmlns:="http://www.w3.org/1999/xhtml">step 10</span></em><span class="koboSpan" id="kobo.367.1" xmlns:="http://www.w3.org/1999/xhtml"> consists of a DataFrame with 135 rows, containing 3,945 features (execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1" xmlns:="http://www.w3.org/1999/xhtml">features.shape</span></strong><span class="koboSpan" id="kobo.369.1" xmlns:="http://www.w3.org/1999/xhtml"> to check that out) that characterize the five original time series – temperature, light, humidity and its ratio, and </span><span class="koboSpan" id="kobo.370.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="&lt;mml:math xmlns:mml=&quot;http://www.w3.org/1998/Math/MathML&quot; xmlns:m=&quot;http://schemas.openxmlformats.org/officeDocument/2006/math&quot;&gt;&lt;mml:msub&gt;&lt;mml:mrow&gt;&lt;mml:mi&gt;C&lt;/mml:mi&gt;&lt;mml:mi&gt;O&lt;/mml:mi&gt;&lt;/mml:mrow&gt;&lt;mml:mrow&gt;&lt;mml:mn&gt;2&lt;/mml:mn&gt;&lt;/mml:mrow&gt;&lt;/mml:msub&gt;&lt;/mml:math&gt;" src="image/47.png" style="vertical-align:-0.333em;height:0.996em;width:1.583em"/></span><span class="koboSpan" id="kobo.371.1" xmlns:="http://www.w3.org/1999/xhtml"> in the office. </span><span class="koboSpan" id="kobo.371.2" xmlns:="http://www.w3.org/1999/xhtml">These</span><a id="_idTextAnchor1362"/><span class="koboSpan" id="kobo.372.1" xmlns:="http://www.w3.org/1999/xhtml"> features were imputed in </span><em class="italic"><span class="koboSpan" id="kobo.373.1" xmlns:="http://www.w3.org/1999/xhtml">step 10</span></em><span class="koboSpan" id="kobo.374.1" xmlns:="http://www.w3.org/1999/xhtml">, so you can go ahead and use this DataFrame to train another logistic </span><a id="_idIndexMarker770"/><span class="koboSpan" id="kobo.375.1" xmlns:="http://www.w3.org/1999/xhtml">regression</span><a id="_idIndexMarker771"/><span class="koboSpan" id="kobo.376.1" xmlns:="http://www.w3.org/1999/xhtml"> model to predict </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1" xmlns:="http://www.w3.org/1999/xhtml">o</span><a id="_idTextAnchor1363"/><a id="_idTextAnchor1364"/><span class="koboSpan" id="kobo.378.1" xmlns:="http://www.w3.org/1999/xhtml">ffice occupancy.</span></span></p>
<h2 id="_idParaDest-281"><a id="_idTextAnchor1365"/><span class="koboSpan" id="kobo.379.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.380.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.382.1" xmlns:="http://www.w3.org/1999/xhtml"> to automatically create hundreds of features from five time series, and then used those features to train a logistic regression model to predict whether the office </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1" xmlns:="http://www.w3.org/1999/xhtml">was occupied.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.384.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.385.1" xmlns:="http://www.w3.org/1999/xhtml">To create features with </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.387.1" xmlns:="http://www.w3.org/1999/xhtml">, the time-series interval from which we want to extract features must be marked </span><a id="_idIndexMarker772"/><span class="koboSpan" id="kobo.388.1" xmlns:="http://www.w3.org/1999/xhtml">with a </span><strong class="bold"><span class="koboSpan" id="kobo.389.1" xmlns:="http://www.w3.org/1999/xhtml">unique identifier</span></strong><span class="koboSpan" id="kobo.390.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.390.2" xmlns:="http://www.w3.org/1999/xhtml">In our dataset, that was the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.391.1" xmlns:="http://www.w3.org/1999/xhtml">id</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.392.1" xmlns:="http://www.w3.org/1999/xhtml"> variable.</span></span></p>
<p><span class="koboSpan" id="kobo.393.1" xmlns:="http://www.w3.org/1999/xhtml">To create features from time series, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.395.1" xmlns:="http://www.w3.org/1999/xhtml"> function from </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.397.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.397.2" xmlns:="http://www.w3.org/1999/xhtml">This function takes the DataFrame containing the time series and the unique identifier as input and returns a DataFrame containing the extracted features </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1" xmlns:="http://www.w3.org/1999/xhtml">as output.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.399.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.400.1" xmlns:="http://www.w3.org/1999/xhtml"> has three key parameters: </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1" xmlns:="http://www.w3.org/1999/xhtml">column_id</span></strong><span class="koboSpan" id="kobo.402.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1" xmlns:="http://www.w3.org/1999/xhtml">column_sort</span></strong><span class="koboSpan" id="kobo.404.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1" xmlns:="http://www.w3.org/1999/xhtml">impute_function</span></strong><span class="koboSpan" id="kobo.406.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.407.1" xmlns:="http://www.w3.org/1999/xhtml">column_id</span></strong><span class="koboSpan" id="kobo.408.1" xmlns:="http://www.w3.org/1999/xhtml"> receives the name of the column with the unique identifier for each sequence that’ll be used to extract features. </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1" xmlns:="http://www.w3.org/1999/xhtml">column_sort</span></strong><span class="koboSpan" id="kobo.410.1" xmlns:="http://www.w3.org/1999/xhtml"> is used to reorder the time series before extracting features. </span><span class="koboSpan" id="kobo.410.2" xmlns:="http://www.w3.org/1999/xhtml">When </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1" xmlns:="http://www.w3.org/1999/xhtml">column_sort</span></strong><span class="koboSpan" id="kobo.412.1" xmlns:="http://www.w3.org/1999/xhtml"> is left to </span><strong class="source-inline"><span class="koboSpan" id="kobo.413.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.414.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.416.1" xmlns:="http://www.w3.org/1999/xhtml"> assumes that the data is ordered chronologically and that the timestamps are equidistant. </span><span class="koboSpan" id="kobo.416.2" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.417.1" xmlns:="http://www.w3.org/1999/xhtml">step 10</span></em><span class="koboSpan" id="kobo.418.1" xmlns:="http://www.w3.org/1999/xhtml">, we passed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.419.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong><span class="koboSpan" id="kobo.420.1" xmlns:="http://www.w3.org/1999/xhtml"> variable as the sorting variable, which informs </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.422.1" xmlns:="http://www.w3.org/1999/xhtml"> how to sort the data before extracting </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1" xmlns:="http://www.w3.org/1999/xhtml">the features.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.424.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.425.1" xmlns:="http://www.w3.org/1999/xhtml">In our dataset, leaving </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1" xmlns:="http://www.w3.org/1999/xhtml">column_sort</span></strong><span class="koboSpan" id="kobo.427.1" xmlns:="http://www.w3.org/1999/xhtml"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.429.1" xmlns:="http://www.w3.org/1999/xhtml"> or passing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong><span class="koboSpan" id="kobo.431.1" xmlns:="http://www.w3.org/1999/xhtml"> variable made no difference, because our time series were already ordered chronologically and the timestamps were equidistant. </span><span class="koboSpan" id="kobo.431.2" xmlns:="http://www.w3.org/1999/xhtml">If this is not the case in your time series, use this parameter to create </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1" xmlns:="http://www.w3.org/1999/xhtml">features correctly.</span></span></p>
<p><span class="koboSpan" id="kobo.433.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, </span><strong class="source-inline"><span class="koboSpan" id="kobo.434.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.435.1" xmlns:="http://www.w3.org/1999/xhtml"> also accepts the </span><strong class="source-inline"><span class="koboSpan" id="kobo.436.1" xmlns:="http://www.w3.org/1999/xhtml">impute</span></strong><span class="koboSpan" id="kobo.437.1" xmlns:="http://www.w3.org/1999/xhtml"> function through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1" xmlns:="http://www.w3.org/1999/xhtml">impute_function</span></strong><span class="koboSpan" id="kobo.439.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter, to</span><a id="_idIndexMarker773"/><span class="koboSpan" id="kobo.440.1" xmlns:="http://www.w3.org/1999/xhtml"> automatically </span><a id="_idIndexMarker774"/><span class="koboSpan" id="kobo.441.1" xmlns:="http://www.w3.org/1999/xhtml">remove infinite and </span><strong class="source-inline"><span class="koboSpan" id="kobo.442.1" xmlns:="http://www.w3.org/1999/xhtml">NaN</span></strong><span class="koboSpan" id="kobo.443.1" xmlns:="http://www.w3.org/1999/xhtml"> values from the created features. </span><span class="koboSpan" id="kobo.443.2" xmlns:="http://www.w3.org/1999/xhtml">Will discuss additional parameters of </span><strong class="source-inline"><span class="koboSpan" id="kobo.444.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.445.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1" xmlns:="http://www.w3.org/1999/xhtml">coming recipes.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.447.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.448.1" xmlns:="http://www.w3.org/1999/xhtml">For more details </span><a id="_idIndexMarker775"/><span class="koboSpan" id="kobo.449.1" xmlns:="http://www.w3.org/1999/xhtml">about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.451.1" xmlns:="http://www.w3.org/1999/xhtml"> function, </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1" xmlns:="http://www.w3.org/1999/xhtml">visit </span></span><a href="https://tsfresh.readthedocs.io/en/latest/api/tsfresh.feature_extraction.html#module-tsfresh.feature_extraction.extraction"><span class="No-Break"><span class="koboSpan" id="kobo.453.1" xmlns:="http://www.w3.org/1999/xhtml">https://tsfresh.readthedocs.io/en/latest/api/tsfresh.feature_extraction.html#module-tsfresh.feature_extraction.extraction</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.454.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.455.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1" xmlns:="http://www.w3.org/1999/xhtml">im</span><a id="_idTextAnchor1366"/><span class="koboSpan" id="kobo.457.1" xmlns:="http://www.w3.org/1999/xhtml">pute</span></strong><span class="koboSpan" id="kobo.458.1" xmlns:="http://www.w3.org/1999/xhtml"> function, which can be used independently, as we did in </span><em class="italic"><span class="koboSpan" id="kobo.459.1" xmlns:="http://www.w3.org/1999/xhtml">step 7</span></em><span class="koboSpan" id="kobo.460.1" xmlns:="http://www.w3.org/1999/xhtml">, or within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.461.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.462.1" xmlns:="http://www.w3.org/1999/xhtml"> function, as we did in </span><em class="italic"><span class="koboSpan" id="kobo.463.1" xmlns:="http://www.w3.org/1999/xhtml">step 10</span></em><span class="koboSpan" id="kobo.464.1" xmlns:="http://www.w3.org/1999/xhtml">, replaced </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1" xmlns:="http://www.w3.org/1999/xhtml">NAN</span></strong><span class="koboSpan" id="kobo.466.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.467.1" xmlns:="http://www.w3.org/1999/xhtml">-Inf</span></strong><span class="koboSpan" id="kobo.468.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.469.1" xmlns:="http://www.w3.org/1999/xhtml">Inf</span></strong><span class="koboSpan" id="kobo.470.1" xmlns:="http://www.w3.org/1999/xhtml"> values</span><a id="_idTextAnchor1367"/><span class="koboSpan" id="kobo.471.1" xmlns:="http://www.w3.org/1999/xhtml"> with the variable’s median, minimum, or maximum values, respectively. </span><span class="koboSpan" id="kobo.471.2" xmlns:="http://www.w3.org/1999/xhtml">If the feature contains only </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1" xmlns:="http://www.w3.org/1999/xhtml">NaN</span></strong><span class="koboSpan" id="kobo.473.1" xmlns:="http://www.w3.org/1999/xhtml"> values, they are replaced by zeroes. </span><span class="koboSpan" id="kobo.473.2" xmlns:="http://www.w3.org/1999/xhtml">The imputation occurs in place – that is, in the same DataFrame that is </span><span class="No-Break"><span class="koboSpan" id="kobo.474.1" xmlns:="http://www.w3.org/1999/xhtml">being imputed.</span></span></p>
<p><span class="koboSpan" id="kobo.475.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.476.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.477.1" xmlns:="http://www.w3.org/1999/xhtml"> function returns a DataFrame containing as many rows as unique identifiers in the data. </span><span class="koboSpan" id="kobo.477.2" xmlns:="http://www.w3.org/1999/xhtml">In our case, it returned a DataFrame with 135 rows. </span><span class="koboSpan" id="kobo.477.3" xmlns:="http://www.w3.org/1999/xhtml">The columns of the resulting DataFrame correspond to the 789 values that were returned by 63 characterization methods applied to each of the 135 60-minute </span><span class="No-Break"><span class="koboSpan" id="kobo.478.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<p><span class="koboSpan" id="kobo.479.1" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.480.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em><span class="koboSpan" id="kobo.481.1" xmlns:="http://www.w3.org/1999/xhtml">, we explored some of the resulting features, which captured the time series mean, variance, and coefficient of variation, as well as their length. </span><span class="koboSpan" id="kobo.481.2" xmlns:="http://www.w3.org/1999/xhtml">Let’s explore a few more of the </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1" xmlns:="http://www.w3.org/1999/xhtml">resulting features.</span></span></p>
<p><span class="koboSpan" id="kobo.483.1" xmlns:="http://www.w3.org/1999/xhtml">Some of the created variables are self-explanatory. </span><span class="koboSpan" id="kobo.483.2" xmlns:="http://www.w3.org/1999/xhtml">For example, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1" xmlns:="http://www.w3.org/1999/xhtml">'light__skewness'</span></strong><span class="koboSpan" id="kobo.485.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1" xmlns:="http://www.w3.org/1999/xhtml">'light__kurtosis'</span></strong><span class="koboSpan" id="kobo.487.1" xmlns:="http://www.w3.org/1999/xhtml"> variables contain the skewness and kurtosis coefficients, which characterize the data distribution. </span><span class="koboSpan" id="kobo.487.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1" xmlns:="http://www.w3.org/1999/xhtml">'light__has_duplicate_max'</span></strong><span class="koboSpan" id="kobo.489.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1" xmlns:="http://www.w3.org/1999/xhtml">'light__has_duplicate_min'</span></strong><span class="koboSpan" id="kobo.491.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1" xmlns:="http://www.w3.org/1999/xhtml">'light__has_duplicate'</span></strong><span class="koboSpan" id="kobo.493.1" xmlns:="http://www.w3.org/1999/xhtml"> variables indicate whether the time series has duplicated values or duplicated minimum or maximum values within the time interval. </span><span class="koboSpan" id="kobo.493.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.494.1" xmlns:="http://www.w3.org/1999/xhtml">'light__quantile__q_0.1'</span></strong><span class="koboSpan" id="kobo.495.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1" xmlns:="http://www.w3.org/1999/xhtml">'light__quantile__q_0.2'</span></strong><span class="koboSpan" id="kobo.497.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1" xmlns:="http://www.w3.org/1999/xhtml">'light__quantile__q_0.3'</span></strong><span class="koboSpan" id="kobo.499.1" xmlns:="http://www.w3.org/1999/xhtml"> variables display the different quantile values of the time series. </span><span class="koboSpan" id="kobo.499.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1" xmlns:="http://www.w3.org/1999/xhtml">'light__autocorrelation__lag_0'</span></strong><span class="koboSpan" id="kobo.501.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1" xmlns:="http://www.w3.org/1999/xhtml">'light__autocorrelation__lag_1'</span></strong><span class="koboSpan" id="kobo.503.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.504.1" xmlns:="http://www.w3.org/1999/xhtml">'light__autocorrelation__lag_2'</span></strong><span class="koboSpan" id="kobo.505.1" xmlns:="http://www.w3.org/1999/xhtml"> variables show the autocorrelation of the time series with its past values, lagged by 0, 1, or 2 steps – information that is generally useful </span><span class="No-Break"><span class="koboSpan" id="kobo.506.1" xmlns:="http://www.w3.org/1999/xhtml">i</span><a id="_idTextAnchor1368"/><span class="koboSpan" id="kobo.507.1" xmlns:="http://www.w3.org/1999/xhtml">n forecasting.</span></span></p>
<p><span class="koboSpan" id="kobo.508.1" xmlns:="http://www.w3.org/1999/xhtml">Other characterization methods return fe</span><a id="_idTextAnchor1369"/><span class="koboSpan" id="kobo.509.1" xmlns:="http://www.w3.org/1999/xhtml">atures obtained from signal processing</span><a id="_idTextAnchor1370"/><span class="koboSpan" id="kobo.510.1" xmlns:="http://www.w3.org/1999/xhtml"> algorithms, such </span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.511.1" xmlns:="http://www.w3.org/1999/xhtml">as </span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.512.1" xmlns:="http://www.w3.org/1999/xhtml">the continuous wavelet transform for the Ricker wavelet, which returns the </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1" xmlns:="http://www.w3.org/1999/xhtml">'light__cwt_coefficients__coeff_0__w_2__widths_(2, 5, 10, 20)'</span></strong><span class="koboSpan" id="kobo.514.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1" xmlns:="http://www.w3.org/1999/xhtml">'light__cwt_coefficients__coeff_0__w_5__widths_(2, 5, 10, 20)'</span></strong><span class="koboSpan" id="kobo.516.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.517.1" xmlns:="http://www.w3.org/1999/xhtml">'light__cwt_coefficients__coeff_0__w_10__widths_(2, 5, 10, 20)'</span></strong><span class="koboSpan" id="kobo.518.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1" xmlns:="http://www.w3.org/1999/xhtml">'light__cwt_coefficients__coeff_0__w_20__widths_(2, 5, 10, 20)'</span></strong><span class="koboSpan" id="kobo.520.1" xmlns:="http://www.w3.org/1999/xhtml"> features, </span><span class="No-Break"><span class="koboSpan" id="kobo.521.1" xmlns:="http://www.w3.org/1999/xhtml">among others.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.522.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.523.1" xmlns:="http://www.w3.org/1999/xhtml">We can’t discuss each of these feature characterization methods or their outputs in detail in this book because there are too many. </span><span class="koboSpan" id="kobo.523.2" xmlns:="http://www.w3.org/1999/xhtml">You can find more details about the transformations </span><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.524.1" xmlns:="http://www.w3.org/1999/xhtml">supported by </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.526.1" xmlns:="http://www.w3.org/1999/xhtml"> and their formulation </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1" xmlns:="http://www.w3.org/1999/xhtml">at </span></span><a href="https://tsfresh.readthedocs.io/en/latest/api/tsfresh.feature_extraction.html"><span class="No-Break"><span class="koboSpan" id="kobo.528.1" xmlns:="http://www.w3.org/1999/xhtml">https://tsfresh.readthedocs.io/en/latest/api/tsfresh.feature_extraction.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.529.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.530.1" xmlns:="http://www.w3.org/1999/xhtml">Some of the features that are automatically created by </span><strong class="source-inline"><span class="koboSpan" id="kobo.531.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.532.1" xmlns:="http://www.w3.org/1999/xhtml"> may not make sense or even be possible to calculate for some time series because they require a certain length or data variability, or the time series must meet certain distribution assumptions. </span><span class="koboSpan" id="kobo.532.2" xmlns:="http://www.w3.org/1999/xhtml">Therefore, the suitability of the features will depend on the nature of the </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.534.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.535.1" xmlns:="http://www.w3.org/1999/xhtml">You can decide which features to extract from your time series based on domain knowledge, or by creating all possible features and then applying feature selection algorithms or following up with data analysis. </span><span class="koboSpan" id="kobo.535.2" xmlns:="http://www.w3.org/1999/xhtml">In fact, from our dataset, many of the resulting features were either constant or contained only missing data. </span><span class="koboSpan" id="kobo.535.3" xmlns:="http://www.w3.org/1999/xhtml">Hence, we can reduce the feature space to informative features by taking those fe</span><a id="_idTextAnchor1371"/><a id="_idTextAnchor1372"/><span class="koboSpan" id="kobo.536.1" xmlns:="http://www.w3.org/1999/xhtml">atures out of </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1" xmlns:="http://www.w3.org/1999/xhtml">the data.</span></span></p>
<h2 id="_idParaDest-282"><a id="_idTextAnchor1373"/><span class="koboSpan" id="kobo.538.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.539.1" xmlns:="http://www.w3.org/1999/xhtml">For more</span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.540.1" xmlns:="http://www.w3.org/1999/xhtml"> details about </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.542.1" xmlns:="http://www.w3.org/1999/xhtml">, check </span><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.543.1" xmlns:="http://www.w3.org/1999/xhtml">out the article Christ M., Braun N., , Neuffer J., and Kempa-Liehr A., (2018). </span><em class="italic"><span class="koboSpan" id="kobo.544.1" xmlns:="http://www.w3.org/1999/xhtml">Time Series FeatuRe Extraction on basis of Scalable Hypothesis tests (tsfresh – A Python package). </span><span class="koboSpan" id="kobo.544.2" xmlns:="http://www.w3.org/1999/xhtml">Neurocomputing 307 (2018). </span><span class="koboSpan" id="kobo.544.3" xmlns:="http://www.w3.org/1999/xhtml">Pages </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.545.1" xmlns:="http://www.w3.org/1999/xhtml">72-77.</span></em></span><span class="No-Break"> </span><a href="https://dl.acm.org/doi/10.1016/j.neucom.2018.03.067"><span class="No-Break"><span class="koboSpan" id="kobo.546.1" xmlns:="http://www.w3.org/1999/xhtml">https://dl.acm.org/doi/10.1</span><span id="_idTextAnchor1374"/><span id="_idTextAnchor1375"/><span class="koboSpan" id="kobo.547.1" xmlns:="http://www.w3.org/1999/xhtml">016/j.neucom.2018.03.067</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.548.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-283"><a id="_idTextAnchor1376"/><span class="koboSpan" id="kobo.549.1" xmlns:="http://www.w3.org/1999/xhtml">Automatically creating and selecting predictive features fr</span><a id="_idTextAnchor1377"/><span class="koboSpan" id="kobo.550.1" xmlns:="http://www.w3.org/1999/xhtml">om time-series data</span></h1>
<p><span class="koboSpan" id="kobo.551.1" xmlns:="http://www.w3.org/1999/xhtml">In the previous </span><a id="_idIndexMarker781"/><span class="koboSpan" id="kobo.552.1" xmlns:="http://www.w3.org/1999/xhtml">recipe, we </span><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.553.1" xmlns:="http://www.w3.org/1999/xhtml">automatically extracted several hundred features from time-series variables using </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.555.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.555.2" xmlns:="http://www.w3.org/1999/xhtml">If we have more than one time-series variable, we can easily end up with a dataset containing thousands of features. </span><span class="koboSpan" id="kobo.555.3" xmlns:="http://www.w3.org/1999/xhtml">In addition, many of the resulting features had only missing data or were constant and were therefore not useful for training mach</span><a id="_idTextAnchor1378"/><span class="koboSpan" id="kobo.556.1" xmlns:="http://www.w3.org/1999/xhtml">ine </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1" xmlns:="http://www.w3.org/1999/xhtml">learning models.</span></span></p>
<p><span class="koboSpan" id="kobo.558.1" xmlns:="http://www.w3.org/1999/xhtml">When we create classiﬁcation and regression models to solve real-life problems, we often want our models to take a small number of relevant features as input to produce interpretable machine learning outputs. </span><span class="koboSpan" id="kobo.558.2" xmlns:="http://www.w3.org/1999/xhtml">Simpler models have many advantages. </span><span class="koboSpan" id="kobo.558.3" xmlns:="http://www.w3.org/1999/xhtml">First, their output is easier to interpret. </span><span class="koboSpan" id="kobo.558.4" xmlns:="http://www.w3.org/1999/xhtml">Second, simpler models are cheaper to store and faster to train. </span><span class="koboSpan" id="kobo.558.5" xmlns:="http://www.w3.org/1999/xhtml">They also return th</span><a id="_idTextAnchor1379"/><span class="koboSpan" id="kobo.559.1" xmlns:="http://www.w3.org/1999/xhtml">eir </span><span class="No-Break"><span class="koboSpan" id="kobo.560.1" xmlns:="http://www.w3.org/1999/xhtml">outputs faster.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.561.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.562.1" xmlns:="http://www.w3.org/1999/xhtml"> includes a highly parallelizable feature selection algorithm based on non-parametric statistical hypothesis tests, which can be executed at the back of the feature creation procedure to quickly remove irrelevant features. </span><span class="koboSpan" id="kobo.562.2" xmlns:="http://www.w3.org/1999/xhtml">The feature selection procedure utilizes different tests for</span><a id="_idTextAnchor1380"/> <span class="No-Break"><span class="koboSpan" id="kobo.563.1" xmlns:="http://www.w3.org/1999/xhtml">different features.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.564.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.565.1" xmlns:="http://www.w3.org/1999/xhtml"> uses the following tests to </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1" xmlns:="http://www.w3.org/1999/xhtml">select features:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.567.1" xmlns:="http://www.w3.org/1999/xhtml">Fisher’s exact test of independence, if both the feature and the target </span><span class="No-Break"><span class="koboSpan" id="kobo.568.1" xmlns:="http://www.w3.org/1999/xhtml">are binary</span></span></li>
<li><span class="koboSpan" id="kobo.569.1" xmlns:="http://www.w3.org/1999/xhtml">Kolmogorov-Smirnov test, if either the feature or the target </span><span class="No-Break"><span class="koboSpan" id="kobo.570.1" xmlns:="http://www.w3.org/1999/xhtml">is binary</span></span></li>
<li><span class="koboSpan" id="kobo.571.1" xmlns:="http://www.w3.org/1999/xhtml">Kendall rank test, if neither the feature nor the target </span><span class="No-Break"><span class="koboSpan" id="kobo.572.1" xmlns:="http://www.w3.org/1999/xhtml">is binary</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.573.1" xmlns:="http://www.w3.org/1999/xhtml">The advantage of these tests is that they are non-parametric, and thus make no assumptions on the underlying distribution of the variables </span><a id="_idTextAnchor1381"/><span class="No-Break"><span class="koboSpan" id="kobo.574.1" xmlns:="http://www.w3.org/1999/xhtml">being tested.</span></span></p>
<p><span class="koboSpan" id="kobo.575.1" xmlns:="http://www.w3.org/1999/xhtml">The result of these tests is a vector of p-values that measures the significance of the association between each feature and the target. </span><span class="koboSpan" id="kobo.575.2" xmlns:="http://www.w3.org/1999/xhtml">These p-values are then evaluated based on</span><a id="_idIndexMarker783"/><span class="koboSpan" id="kobo.576.1" xmlns:="http://www.w3.org/1999/xhtml"> the </span><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.577.1" xmlns:="http://www.w3.org/1999/xhtml">Benjamini-Yekutieli procedure to decide which features </span><span class="No-Break"><span class="koboSpan" id="kobo.578.1" xmlns:="http://www.w3.org/1999/xhtml">to keep.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.579.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.580.1" xmlns:="http://www.w3.org/1999/xhtml">For more details abo</span><a id="_idTextAnchor1382"/><span class="koboSpan" id="kobo.581.1" xmlns:="http://www.w3.org/1999/xhtml">ut </span><strong class="source-inline"><span class="koboSpan" id="kobo.582.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.583.1" xmlns:="http://www.w3.org/1999/xhtml">’s featu</span><a id="_idTextAnchor1383"/><span class="koboSpan" id="kobo.584.1" xmlns:="http://www.w3.org/1999/xhtml">re selection procedure, check out the article Christ, Kempa-Liehr, and Feindt, </span><em class="italic"><span class="koboSpan" id="kobo.585.1" xmlns:="http://www.w3.org/1999/xhtml">Distributed and parallel time series feature extraction for industrial big data applications</span></em><span class="koboSpan" id="kobo.586.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.586.2" xmlns:="http://www.w3.org/1999/xhtml">Asian Machine Learning Conference (ACML) 2016, Workshop on Learning on Big Data (WLBD), Hamilton (New Zealand), </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1" xmlns:="http://www.w3.org/1999/xhtml">arXiv, </span></span><a href="https://arxiv.org/abs/1610.07717v1"><span class="No-Break"><span class="koboSpan" id="kobo.588.1" xmlns:="http://www.w3.org/1999/xhtml">https://arxiv.org/abs/1610.07717v1</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.589.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.590.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will automatically create hundreds of features from various time series, and then select the most relevant f</span><a id="_idTextAnchor1384"/><a id="_idTextAnchor1385"/><span class="koboSpan" id="kobo.591.1" xmlns:="http://www.w3.org/1999/xhtml">eatures by </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1" xmlns:="http://www.w3.org/1999/xhtml">utilizing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.593.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.594.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-284"><span class="koboSpan" id="kobo.595.1" xmlns:="http://www.w3.org/1999/xhtml">How</span><a id="_idTextAnchor1386"/><span class="koboSpan" id="kobo.596.1" xmlns:="http://www.w3.org/1999/xhtml"> to do it...</span></h2>
<p><span class="koboSpan" id="kobo.597.1" xmlns:="http://www.w3.org/1999/xhtml">We will begin by automatically creating and selecting features from one time series, </span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1" xmlns:="http://www.w3.org/1999/xhtml">lights</span></strong><span class="koboSpan" id="kobo.599.1" xmlns:="http://www.w3.org/1999/xhtml">, and then we will automate the procedure for multiple </span><span class="No-Break"><span class="koboSpan" id="kobo.600.1" xmlns:="http://www.w3.org/1999/xhtml">time series:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.601.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the required Python libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.602.1" xmlns:="http://www.w3.org/1999/xhtml">and functions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.603.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import classification_report
from sklearn.model_selection import train_test_split
from tsfresh import (
    extract_features,
    extract_relevant_features,
    select_features,
)
from tsfresh.utilities.dataframe_functions import impute</span></pre></li> <li><span class="koboSpan" id="kobo.604.1" xmlns:="http://www.w3.org/1999/xhtml">Load the</span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.605.1" xmlns:="http://www.w3.org/1999/xhtml"> dataset </span><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.606.1" xmlns:="http://www.w3.org/1999/xhtml">and the target variable described in the </span><em class="italic"><span class="koboSpan" id="kobo.607.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.608.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.609.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.610.1" xmlns:="http://www.w3.org/1999/xhtml">
X = pd.read_csv("occupancy.csv", parse_dates=["date"])
y = pd.read_csv("occupancy_target.csv",
    index_col</span><a id="_idTextAnchor1387"/><span class="koboSpan" id="kobo.611.1" xmlns:="http://www.w3.org/1999/xhtml">="id")["occupancy"]</span></pre></li> <li><span class="koboSpan" id="kobo.612.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create hundreds of features automatically for each hour of </span><strong class="source-inline"><span class="koboSpan" id="kobo.613.1" xmlns:="http://www.w3.org/1999/xhtml">light</span></strong><span class="koboSpan" id="kobo.614.1" xmlns:="http://www.w3.org/1999/xhtml"> use records and impute the </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1" xmlns:="http://www.w3.org/1999/xhtml">resulting features:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.616.1" xmlns:="http://www.w3.org/1999/xhtml">
features = extract_features(
    X[[«id», «light»]],
    column_id="id",
    impute_function=impute,
)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.617.1" xmlns:="http://www.w3.org/1999/xhtml">The output of the previous step is a DataFrame with 135 rows and 789 columns, corresponding to the features created from each hour of </span><span class="No-Break"><span class="koboSpan" id="kobo.618.1" xmlns:="http://www.w3.org/1999/xhtml">light consumption.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.619.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.620.1" xmlns:="http://www.w3.org/1999/xhtml">For more details about </span><em class="italic"><span class="koboSpan" id="kobo.621.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.622.1" xmlns:="http://www.w3.org/1999/xhtml">, or the Occupancy Detection dataset, check out the </span><em class="italic"><span class="koboSpan" id="kobo.623.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting hundreds of features automatically from a time </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.624.1" xmlns:="http://www.w3.org/1999/xhtml">seri</span><a id="_idTextAnchor1388"/><span class="koboSpan" id="kobo.625.1" xmlns:="http://www.w3.org/1999/xhtml">es</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.626.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.627.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s select the features based on the non-parametric tests that we mentioned in the introduction of </span><span class="No-Break"><span class="koboSpan" id="kobo.628.1" xmlns:="http://www.w3.org/1999/xhtml">this recipe:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.629.1" xmlns:="http://www.w3.org/1999/xhtml">
features = select_features(features, y)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.630.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1" xmlns:="http://www.w3.org/1999/xhtml">len(features)</span></strong><span class="koboSpan" id="kobo.632.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the value </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1" xmlns:="http://www.w3.org/1999/xhtml">135</span></strong><span class="koboSpan" id="kobo.634.1" xmlns:="http://www.w3.org/1999/xhtml">, which means that from the 789 features created in </span><em class="italic"><span class="koboSpan" id="kobo.635.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.636.1" xmlns:="http://www.w3.org/1999/xhtml">, only 135 are statistically significant. </span><span class="koboSpan" id="kobo.636.2" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.637.1" xmlns:="http://www.w3.org/1999/xhtml">features.head()</span></strong><span class="koboSpan" id="kobo.638.1" xmlns:="http://www.w3.org/1999/xhtml"> to display the first five rows of the </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame.</span></span></p></li> <li><span class="koboSpan" id="kobo.640.1" xmlns:="http://www.w3.org/1999/xhtml">For space reasons, we will only display the first </span><span class="No-Break"><span class="koboSpan" id="kobo.641.1" xmlns:="http://www.w3.org/1999/xhtml">five features:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.642.1" xmlns:="http://www.w3.org/1999/xhtml">
feats = features.columns[0:5]
features[feats].head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.643.1" xmlns:="http://www.w3.org/1999/xhtml">In</span><a id="_idTextAnchor1389"/> <a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.644.1" xmlns:="http://www.w3.org/1999/xhtml">the</span><a id="_idIndexMarker788"/><span class="koboSpan" id="kobo.645.1" xmlns:="http://www.w3.org/1999/xhtml"> following DataFrame, we see the values of the first five features for the first </span><a id="_idTextAnchor1390"/><span class="koboSpan" id="kobo.646.1" xmlns:="http://www.w3.org/1999/xhtml">five hours of </span><span class="No-Break"><span class="koboSpan" id="kobo.647.1" xmlns:="http://www.w3.org/1999/xhtml">light consumption:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer193">
<span class="koboSpan" id="kobo.648.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 10.6 – DataFrame with five of the selected features created from each hour of light consumption" src="image/B22396_10_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.649.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10.6 – DataFrame with five of the selected features created from each hour of light consumption</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.650.1" xmlns:="http://www.w3.org/1999/xhtml">Check the discussion in the </span><em class="italic"><span class="koboSpan" id="kobo.651.1" xmlns:="http://www.w3.org/1999/xhtml">How it works…</span></em><span class="koboSpan" id="kobo.652.1" xmlns:="http://www.w3.org/1999/xhtml"> section for a more detailed analysis of the DataFrame resulting from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.653.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.654.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.655.1" xmlns:="http://www.w3.org/1999/xhtml">Now, we will use the features from </span><em class="italic"><span class="koboSpan" id="kobo.656.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em><span class="koboSpan" id="kobo.657.1" xmlns:="http://www.w3.org/1999/xhtml"> to train a logistic regression model and predict whether the office was occupied. </span><span class="koboSpan" id="kobo.657.2" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by separating the dataset into training and </span><span class="No-Break"><span class="koboSpan" id="kobo.658.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.659.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    features,
    y,
    test_size=0.1,
    random_state=42,
)</span></pre></li> <li><span class="koboSpan" id="kobo.660.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set </span><a id="_idIndexMarker789"/><span class="koboSpan" id="kobo.661.1" xmlns:="http://www.w3.org/1999/xhtml">up</span><a id="_idIndexMarker790"/><span class="koboSpan" id="kobo.662.1" xmlns:="http://www.w3.org/1999/xhtml"> and train a logistic regression model and then evaluate </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1" xmlns:="http://www.w3.org/1999/xhtml">its performance:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.664.1" xmlns:="http://www.w3.org/1999/xhtml">
cls = LogisticRegression(
    random_state=10, C=0.1, max_iter=1000)
cls.fit(X_train, y_train)
print(classification_report(
    y</span><a id="_idTextAnchor1391"/><span class="koboSpan" id="kobo.665.1" xmlns:="http://www.w3.org/1999/xhtml">_test, cls.predict(X_test)))</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.666.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we see the values of commonly used evaluation metrics for classification analysis. </span><span class="koboSpan" id="kobo.666.2" xmlns:="http://www.w3.org/1999/xhtml">These suggest that the selected features are useful for predicting </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1" xmlns:="http://www.w3.org/1999/xhtml">office occupancy:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.668.1" xmlns:="http://www.w3.org/1999/xhtml">                  precision     recall  f1-score   support</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.669.1" xmlns:="http://www.w3.org/1999/xhtml">               0</span></strong><strong class="bold"><span class="koboSpan" id="kobo.670.1" xmlns:="http://www.w3.org/1999/xhtml">         1.00        0.91        0.95           11</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.671.1" xmlns:="http://www.w3.org/1999/xhtml">               1         0.75        1.00        0.86            3</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.672.1" xmlns:="http://www.w3.org/1999/xhtml">     </span></strong><strong class="bold"><span class="koboSpan" id="kobo.673.1" xmlns:="http://www.w3.org/1999/xhtml">accuracy                                       0.93           14</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.674.1" xmlns:="http://www.w3.org/1999/xhtml">   macro avg         0.88        0.95        0.90           14</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.675.1" xmlns:="http://www.w3.org/1999/xhtml">weighted avg         0.95        0.93        </span></strong><strong class="bold"><span class="koboSpan" id="kobo.676.1" xmlns:="http://www.w3.org/1999/xhtml">0.93           14</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.677.1" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and compare these results with those of </span><em class="italic"><span class="koboSpan" id="kobo.678.1" xmlns:="http://www.w3.org/1999/xhtml">step 9</span></em><span class="koboSpan" id="kobo.679.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><em class="italic"><span class="koboSpan" id="kobo.680.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting hundreds of features automatically from a time series</span></em><span class="koboSpan" id="kobo.681.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe of this chapter. </span><span class="koboSpan" id="kobo.681.2" xmlns:="http://www.w3.org/1999/xhtml">You will see </span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.682.1" xmlns:="http://www.w3.org/1999/xhtml">that</span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.683.1" xmlns:="http://www.w3.org/1999/xhtml"> we obtained similar performance, with on</span><a id="_idTextAnchor1392"/><span class="koboSpan" id="kobo.684.1" xmlns:="http://www.w3.org/1999/xhtml">ly a fraction of </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1" xmlns:="http://www.w3.org/1999/xhtml">the features.</span></span></p></li> <li><span class="koboSpan" id="kobo.686.1" xmlns:="http://www.w3.org/1999/xhtml">We can trigger the feature creation </span><em class="italic"><span class="koboSpan" id="kobo.687.1" xmlns:="http://www.w3.org/1999/xhtml">and</span></em><span class="koboSpan" id="kobo.688.1" xmlns:="http://www.w3.org/1999/xhtml"> feature selection procedures by using a single function, </span><strong class="source-inline"><span class="koboSpan" id="kobo.689.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.690.1" xmlns:="http://www.w3.org/1999/xhtml">, and, like this, combine </span><em class="italic"><span class="koboSpan" id="kobo.691.1" xmlns:="http://www.w3.org/1999/xhtml">steps 3</span></em><span class="koboSpan" id="kobo.692.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><em class="italic"><span class="koboSpan" id="kobo.693.1" xmlns:="http://www.w3.org/1999/xhtml">4</span></em><span class="koboSpan" id="kobo.694.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.694.2" xmlns:="http://www.w3.org/1999/xhtml">We’ll do that to create and select features automatically for the five time series in </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1" xmlns:="http://www.w3.org/1999/xhtml">our dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.696.1" xmlns:="http://www.w3.org/1999/xhtml">
features = extract_relevant_features(
    X,
    y,
    column_id="id",
    column_sort="date",
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.697.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.698.1" xmlns:="http://www.w3.org/1999/xhtml">The parameters of </span><strong class="source-inline"><span class="koboSpan" id="kobo.699.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.700.1" xmlns:="http://www.w3.org/1999/xhtml"> are very similar to those of </span><strong class="source-inline"><span class="koboSpan" id="kobo.701.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.702.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.702.2" xmlns:="http://www.w3.org/1999/xhtml">Note, however, that the former will automatically perform imputation to be able to proceed with the feature selection. </span><span class="koboSpan" id="kobo.702.3" xmlns:="http://www.w3.org/1999/xhtml">We discussed the parameters of </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.704.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><em class="italic"><span class="koboSpan" id="kobo.705.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting hundreds of features automatically from time </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.706.1" xmlns:="http://www.w3.org/1999/xhtml">series</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.707.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<p><span class="koboSpan" id="kobo.708.1" xmlns:="http://www.w3.org/1999/xhtml">The output of </span><em class="italic"><span class="koboSpan" id="kobo.709.1" xmlns:="http://www.w3.org/1999/xhtml">step 8</span></em><span class="koboSpan" id="kobo.710.1" xmlns:="http://www.w3.org/1999/xhtml"> consists of a DataFrame with 135 rows and 968 features, from the original 3,945 that are returned by default by </span><strong class="source-inline"><span class="koboSpan" id="kobo.711.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.712.1" xmlns:="http://www.w3.org/1999/xhtml"> (you can check that out by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.713.1" xmlns:="http://www.w3.org/1999/xhtml">features.shape</span></strong><span class="koboSpan" id="kobo.714.1" xmlns:="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.714.2" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and use this DataFrame to train another logistic regressio</span><a id="_idTextAnchor1393"/><a id="_idTextAnchor1394"/><span class="koboSpan" id="kobo.715.1" xmlns:="http://www.w3.org/1999/xhtml">n model to predict </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1" xmlns:="http://www.w3.org/1999/xhtml">office occupancy</span><a id="_idTextAnchor1395"/><span class="koboSpan" id="kobo.717.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-285"><a id="_idTextAnchor1396"/><span class="koboSpan" id="kobo.718.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.719.1" xmlns:="http://www.w3.org/1999/xhtml">In this</span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.720.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe, we </span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.721.1" xmlns:="http://www.w3.org/1999/xhtml">created hundreds of features from a time series and then selected the most relevant features based on non-parametric statistical tests. </span><span class="koboSpan" id="kobo.721.2" xmlns:="http://www.w3.org/1999/xhtml">The feature creation and selection procedures were carried out automatically </span><span class="No-Break"><span class="koboSpan" id="kobo.722.1" xmlns:="http://www.w3.org/1999/xhtml">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.723.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.724.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.725.1" xmlns:="http://www.w3.org/1999/xhtml">To create the features, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.726.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.727.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.728.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.729.1" xmlns:="http://www.w3.org/1999/xhtml"> function, which we described in detail in the </span><em class="italic"><span class="koboSpan" id="kobo.730.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting hundreds of features automatical</span><a id="_idTextAnchor1397"/><span class="koboSpan" id="kobo.731.1" xmlns:="http://www.w3.org/1999/xhtml">ly from a time </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.732.1" xmlns:="http://www.w3.org/1999/xhtml">series</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.733.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<p><span class="koboSpan" id="kobo.734.1" xmlns:="http://www.w3.org/1999/xhtml">To select features, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1" xmlns:="http://www.w3.org/1999/xhtml">select_features</span></strong><span class="koboSpan" id="kobo.736.1" xmlns:="http://www.w3.org/1999/xhtml"> function, also from </span><strong class="source-inline"><span class="koboSpan" id="kobo.737.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.738.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.738.2" xmlns:="http://www.w3.org/1999/xhtml">This function applies different statistical tests, depending on the nature of the feature and the target. </span><span class="koboSpan" id="kobo.738.3" xmlns:="http://www.w3.org/1999/xhtml">Briefly, if the feature and target are binary, it tests their relationship with Fisher’s exact test. </span><span class="koboSpan" id="kobo.738.4" xmlns:="http://www.w3.org/1999/xhtml">If either the feature or the target is binary, and the other variable is continuous, it tests their relationship by using the Kolmogorov-Smirnov test. </span><span class="koboSpan" id="kobo.738.5" xmlns:="http://www.w3.org/1999/xhtml">If neither the features nor the target is binary, it uses the Kendall </span><span class="No-Break"><span class="koboSpan" id="kobo.739.1" xmlns:="http://www.w3.org/1999/xhtml">rank test.</span></span></p>
<p><span class="koboSpan" id="kobo.740.1" xmlns:="http://www.w3.org/1999/xhtml">The result of these tests is a vector with one p-value per feature. </span><span class="koboSpan" id="kobo.740.2" xmlns:="http://www.w3.org/1999/xhtml">Next, </span><strong class="source-inline"><span class="koboSpan" id="kobo.741.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.742.1" xmlns:="http://www.w3.org/1999/xhtml"> applies the Benjamini-Yekutieli procedure, which aims to reduce the false discovery rate, to select which features to keep based on the p-values. </span><span class="koboSpan" id="kobo.742.2" xmlns:="http://www.w3.org/1999/xhtml">This feature selection procedure has some advantages, the main one being that statistical tests are fast to compute, and therefore the selection algorithm is scalable and can be parallelized. </span><span class="koboSpan" id="kobo.742.3" xmlns:="http://www.w3.org/1999/xhtml">Another advantage is that the tests are non-parametric and hence suitable for linear and </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1" xmlns:="http://www.w3.org/1999/xhtml">non-linear models.</span></span></p>
<p><span class="koboSpan" id="kobo.744.1" xmlns:="http://www.w3.org/1999/xhtml">However, feature selection methods that evaluate each feature individually are unable to remove redundant features. </span><span class="koboSpan" id="kobo.744.2" xmlns:="http://www.w3.org/1999/xhtml">In fact, many of the features automatically created by </span><strong class="source-inline"><span class="koboSpan" id="kobo.745.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.746.1" xmlns:="http://www.w3.org/1999/xhtml"> will be highly correlated, like those capturing the different quantiles of light consumption. </span><span class="koboSpan" id="kobo.746.2" xmlns:="http://www.w3.org/1999/xhtml">Hence, they will show similar p-values and be retained. </span><span class="koboSpan" id="kobo.746.3" xmlns:="http://www.w3.org/1999/xhtml">But in practice, we only need one or a few of them to capture the information of the time series. </span><span class="koboSpan" id="kobo.746.4" xmlns:="http://www.w3.org/1999/xhtml">I’d recommend following up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.747.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.748.1" xmlns:="http://www.w3.org/1999/xhtml"> selection procedure with alternative feature selection methods that are able to pick up </span><span class="No-Break"><span class="koboSpan" id="kobo.749.1" xmlns:="http://www.w3.org/1999/xhtml">feature interactions.</span></span></p>
<p><span class="koboSpan" id="kobo.750.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, in </span><em class="italic"><span class="koboSpan" id="kobo.751.1" xmlns:="http://www.w3.org/1999/xhtml">step 8</span></em><span class="koboSpan" id="kobo.752.1" xmlns:="http://www.w3.org/1999/xhtml">, we combined the feature creation step (</span><em class="italic"><span class="koboSpan" id="kobo.753.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.754.1" xmlns:="http://www.w3.org/1999/xhtml">) with the feature selection step (</span><em class="italic"><span class="koboSpan" id="kobo.755.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em><span class="koboSpan" id="kobo.756.1" xmlns:="http://www.w3.org/1999/xhtml">) by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.758.1" xmlns:="http://www.w3.org/1999/xhtml"> function. </span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.760.1" xmlns:="http://www.w3.org/1999/xhtml"> applies the </span><strong class="source-inline"><span class="koboSpan" id="kobo.761.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.762.1" xmlns:="http://www.w3.org/1999/xhtml"> function to create the features from each time series and imputes them. </span><span class="koboSpan" id="kobo.762.2" xmlns:="http://www.w3.org/1999/xhtml">Next, it applies the </span><strong class="source-inline"><span class="koboSpan" id="kobo.763.1" xmlns:="http://www.w3.org/1999/xhtml">select_features</span></strong><span class="koboSpan" id="kobo.764.1" xmlns:="http://www.w3.org/1999/xhtml"> function to return a DataFrame containing one row per unique identifier, and the features that were selected for each time series. </span><span class="koboSpan" id="kobo.764.2" xmlns:="http://www.w3.org/1999/xhtml">Note that different features can</span><a id="_idIndexMarker795"/><a id="_idTextAnchor1398"/><a id="_idTextAnchor1399"/><span class="koboSpan" id="kobo.765.1" xmlns:="http://www.w3.org/1999/xhtml"> be </span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.766.1" xmlns:="http://www.w3.org/1999/xhtml">selected for different </span><span class="No-Break"><span class="koboSpan" id="kobo.767.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<h2 id="_idParaDest-286"><a id="_idTextAnchor1400"/><span class="koboSpan" id="kobo.768.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.769.1" xmlns:="http://www.w3.org/1999/xhtml">The selection algorithm from </span><strong class="source-inline"><span class="koboSpan" id="kobo.770.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.771.1" xmlns:="http://www.w3.org/1999/xhtml"> offers a quick method to remove irrelevant features. </span><span class="koboSpan" id="kobo.771.2" xmlns:="http://www.w3.org/1999/xhtml">However, it does not find the best feature subset for the classification or regression task. </span><span class="koboSpan" id="kobo.771.3" xmlns:="http://www.w3.org/1999/xhtml">Other feature selection methods can be applied at the back of </span><strong class="source-inline"><span class="koboSpan" id="kobo.772.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.773.1" xmlns:="http://www.w3.org/1999/xhtml">’s algorithm to reduce the feature </span><span class="No-Break"><span class="koboSpan" id="kobo.774.1" xmlns:="http://www.w3.org/1999/xhtml">space further.</span></span></p>
<p><span class="koboSpan" id="kobo.775.1" xmlns:="http://www.w3.org/1999/xhtml">For more details on feature selection algorithms, check out the book </span><em class="italic"><span class="koboSpan" id="kobo.776.1" xmlns:="http://www.w3.org/1999/xhtml">Feature Selection in Machine Learning with Python</span></em><span class="koboSpan" id="kobo.777.1" xmlns:="http://www.w3.org/1999/xhtml"> by Soledad Galli on </span><span class="No-Break"><span class="koboSpan" id="kobo.778.1" xmlns:="http://www.w3.org/1999/xhtml">Leanpub: </span></span><a href="https://leanpub.com/feature-selection-in-machine-learning/"><span class="No-Break"><span class="koboSpan" id="kobo.779.1" xmlns:="http://www.w3.org/1999/xhtml">https://leanpub.com</span><span id="_idTextAnchor1401"/><span id="_idTextAnchor1402"/><span class="koboSpan" id="kobo.780.1" xmlns:="http://www.w3.org/1999/xhtml">/feature-selection-in-machine-learning/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.781.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-287"><span class="koboSpan" id="kobo.782.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting diffe</span><a id="_idTextAnchor1403"/><span class="koboSpan" id="kobo.783.1" xmlns:="http://www.w3.org/1999/xhtml">rent features from different time series</span></h1>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.784.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.785.1" xmlns:="http://www.w3.org/1999/xhtml"> extracts </span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.786.1" xmlns:="http://www.w3.org/1999/xhtml">many features based on the time-series characteristics and distribution, such as their correlation properties, stationarity, and entropy. </span><span class="koboSpan" id="kobo.786.2" xmlns:="http://www.w3.org/1999/xhtml">It also applies non-linear time-series analysis functions, which decompose the time-series signal through, for example, Fourier or wavelet transformations. </span><span class="koboSpan" id="kobo.786.3" xmlns:="http://www.w3.org/1999/xhtml">Depending on the nature of the time series, some of these transformations make more sense than others. </span><span class="koboSpan" id="kobo.786.4" xmlns:="http://www.w3.org/1999/xhtml">For example, wavelength decomposition methods can make sense for time series resulting from signals or sensors but are not always useful for time series representing sales or </span><span class="No-Break"><span class="koboSpan" id="kobo.787.1" xmlns:="http://www.w3.org/1999/xhtml">stock prices.</span></span></p>
<p><span class="koboSpan" id="kobo.788.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will discuss how to optimize the feature extracti</span><a id="_idTextAnchor1404"/><span class="koboSpan" id="kobo.789.1" xmlns:="http://www.w3.org/1999/xhtml">on procedure to extract specific features from each time series, and then use th</span><a id="_idTextAnchor1405"/><a id="_idTextAnchor1406"/><span class="koboSpan" id="kobo.790.1" xmlns:="http://www.w3.org/1999/xhtml">ese features to predict </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1" xmlns:="http://www.w3.org/1999/xhtml">office occupancy.</span></span></p>
<h2 id="_idParaDest-288"><a id="_idTextAnchor1407"/><span class="koboSpan" id="kobo.792.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.793.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.794.1" xmlns:="http://www.w3.org/1999/xhtml"> accesses the methods that will be used to create features through a dictionary that contains the method names as keys and, if they need a parameter, it has the parameter as a value. </span><strong class="source-inline"><span class="koboSpan" id="kobo.795.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.796.1" xmlns:="http://www.w3.org/1999/xhtml"> includes some predefined dictionaries as well. </span><span class="koboSpan" id="kobo.796.2" xmlns:="http://www.w3.org/1999/xhtml">We’ll explore these predefined dictionaries first, which can be accessed through the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.797.1" xmlns:="http://www.w3.org/1999/xhtml">settings</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.798.1" xmlns:="http://www.w3.org/1999/xhtml"> module:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.799.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the required Python libraries and functions and the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.800.1" xmlns:="http://www.w3.org/1999/xhtml">settings</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.801.1" xmlns:="http://www.w3.org/1999/xhtml"> module:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.802.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import classification_report
from sklearn.model_selection import train_test_split
from tsfresh.feature_extraction import (
    extract_features
)
from tsfre</span><a id="_idTextAnchor1408"/><span class="koboSpan" id="kobo.803.1" xmlns:="http://www.w3.org/1999/xhtml">sh.feature_extraction import settings</span></pre></li> <li><span class="koboSpan" id="kobo.804.1" xmlns:="http://www.w3.org/1999/xhtml">Load the dataset and the target variable described in the </span><em class="italic"><span class="koboSpan" id="kobo.805.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.806.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.807.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.808.1" xmlns:="http://www.w3.org/1999/xhtml">
X = pd.read_csv("occupancy.csv", parse_dates=["date"])
y = pd.read_csv("occupancy_target.csv",
    index_col="id")["occupancy"]</span></pre><p class="list-inset"><strong class="source-inline"><span class="koboSpan" id="kobo.809.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.810.1" xmlns:="http://www.w3.org/1999/xhtml"> includes </span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.811.1" xmlns:="http://www.w3.org/1999/xhtml">three main dictionaries that control the feature creation output: </span><strong class="source-inline"><span class="koboSpan" id="kobo.812.1" xmlns:="http://www.w3.org/1999/xhtml">settings.ComprehensiveFCParameters</span></strong><span class="koboSpan" id="kobo.813.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.814.1" xmlns:="http://www.w3.org/1999/xhtml">settings.EfficientFCParameters</span></strong><span class="koboSpan" id="kobo.815.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1" xmlns:="http://www.w3.org/1999/xhtml">settings.MinimalFCParameters</span></strong><span class="koboSpan" id="kobo.817.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.817.2" xmlns:="http://www.w3.org/1999/xhtml">Here, we’ll explore the dictionary that returns the fewest features. </span><span class="koboSpan" id="kobo.817.3" xmlns:="http://www.w3.org/1999/xhtml">You can repeat the steps to explore the </span><span class="No-Break"><span class="koboSpan" id="kobo.818.1" xmlns:="http://www.w3.org/1999/xhtml">additional dictionaries.</span></span></p></li> <li><span class="koboSpan" id="kobo.819.1" xmlns:="http://www.w3.org/1999/xhtml">Display the feature creation methods that will be applied when using the dictionary that returns the </span><span class="No-Break"><span class="koboSpan" id="kobo.820.1" xmlns:="http://www.w3.org/1999/xhtml">fewest features:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.821.1" xmlns:="http://www.w3.org/1999/xhtml">
minimal_feat = settings.MinimalFCParameters()
minimal_feat.items()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.822.1" xmlns:="http://www.w3.org/1999/xhtml">In the output of </span><em class="italic"><span class="koboSpan" id="kobo.823.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.824.1" xmlns:="http://www.w3.org/1999/xhtml">, we see a dictionary with the feature extraction method names as keys, and the parameters used by those methods, if any, </span><span class="No-Break"><span class="koboSpan" id="kobo.825.1" xmlns:="http://www.w3.org/1999/xhtml">as values:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.826.1" xmlns:="http://www.w3.org/1999/xhtml">ItemsView({'sum_values': None, 'median': None, 'mean': None, 'length': None, 'standard_deviation': None, 'variance': None, 'root_mean_square': None, 'maximum': None, 'absolute_maximum': None, 'minimum': None})</span></strong></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.827.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.828.1" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and explore the other two predefined dictionaries, </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1" xmlns:="http://www.w3.org/1999/xhtml">settings.ComprehensiveFCParameters</span></strong><span class="koboSpan" id="kobo.830.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1" xmlns:="http://www.w3.org/1999/xhtml">settings.EfficientFCParameters</span></strong><span class="koboSpan" id="kobo.832.1" xmlns:="http://www.w3.org/1999/xhtml">, by ad</span><a id="_idTextAnchor1409"/><span class="koboSpan" id="kobo.833.1" xmlns:="http://www.w3.org/1999/xhtml">apting the code from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.834.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.835.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.836.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s use the dictionary from </span><em class="italic"><span class="koboSpan" id="kobo.837.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.838.1" xmlns:="http://www.w3.org/1999/xhtml"> to extract only those features from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.839.1" xmlns:="http://www.w3.org/1999/xhtml">light</span></strong><span class="koboSpan" id="kobo.840.1" xmlns:="http://www.w3.org/1999/xhtml"> time</span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.841.1" xmlns:="http://www.w3.org/1999/xhtml"> series and then display the shape of the </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.843.1" xmlns:="http://www.w3.org/1999/xhtml">
features = extract_features(
    X[[«id», «light»]],
    column_id="id",
    </span><strong class="bold"><span class="koboSpan" id="kobo.844.1" xmlns:="http://www.w3.org/1999/xhtml">default_fc_parameters=minimal_feat,</span></strong><span class="koboSpan" id="kobo.845.1" xmlns:="http://www.w3.org/1999/xhtml">
)
features.shape</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.846.1" xmlns:="http://www.w3.org/1999/xhtml">The output of </span><em class="italic"><span class="koboSpan" id="kobo.847.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em><span class="koboSpan" id="kobo.848.1" xmlns:="http://www.w3.org/1999/xhtml"> is </span><strong class="source-inline"><span class="koboSpan" id="kobo.849.1" xmlns:="http://www.w3.org/1999/xhtml">(135, 10)</span></strong><span class="koboSpan" id="kobo.850.1" xmlns:="http://www.w3.org/1999/xhtml">, which means that only 10 features were created for each of th</span><a id="_idTextAnchor1410"/><span class="koboSpan" id="kobo.851.1" xmlns:="http://www.w3.org/1999/xhtml">e 135 hours of light </span><span class="No-Break"><span class="koboSpan" id="kobo.852.1" xmlns:="http://www.w3.org/1999/xhtml">consumption data.</span></span></p></li> <li><span class="koboSpan" id="kobo.853.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s display the </span><span class="No-Break"><span class="koboSpan" id="kobo.854.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.855.1" xmlns:="http://www.w3.org/1999/xhtml">
features.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.856.1" xmlns:="http://www.w3.org/1999/xhtml">We see the values of the resulting features for the first five hours of lig</span><a id="_idTextAnchor1411"/><span class="koboSpan" id="kobo.857.1" xmlns:="http://www.w3.org/1999/xhtml">ht consumption in the </span><span class="No-Break"><span class="koboSpan" id="kobo.858.1" xmlns:="http://www.w3.org/1999/xhtml">following DataFrame:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer194">
<span class="koboSpan" id="kobo.859.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 10.7 – DataFrame with the features created ﻿for each hour of light consumption" src="image/B22396_10_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.860.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 10.7 – DataFrame with the features created </span><a id="_idTextAnchor1412"/><span class="koboSpan" id="kobo.861.1" xmlns:="http://www.w3.org/1999/xhtml">for each hour of light consumption</span></p>
<p class="list-inset"><a id="_idTextAnchor1413"/><span class="koboSpan" id="kobo.862.1" xmlns:="http://www.w3.org/1999/xhtml">Now, we will use these features to train a logistic regression model to predict whether </span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.863.1" xmlns:="http://www.w3.org/1999/xhtml">the office </span><span class="No-Break"><span class="koboSpan" id="kobo.864.1" xmlns:="http://www.w3.org/1999/xhtml">was occupied.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.865.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by separating the dataset into training and </span><span class="No-Break"><span class="koboSpan" id="kobo.866.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.867.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    features,
    y,
    test_size=0.1,
    random_state=42,
)</span></pre></li> <li><span class="koboSpan" id="kobo.868.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s set up and train a logistic regression model, and then evaluate </span><span class="No-Break"><span class="koboSpan" id="kobo.869.1" xmlns:="http://www.w3.org/1999/xhtml">its performance:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.870.1" xmlns:="http://www.w3.org/1999/xhtml">
cls = LogisticRegression(random_state=10, C=0.01)
cls.fit(X_train, y_train)
print(classification_repor</span><a id="_idTextAnchor1414"/><span class="koboSpan" id="kobo.871.1" xmlns:="http://www.w3.org/1999/xhtml">t(
    y_test, cls.p</span><a id="_idTextAnchor1415"/><span class="koboSpan" id="kobo.872.1" xmlns:="http://www.w3.org/1999/xhtml">redict(X_test)))</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.873.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we see the evaluation metrics that are commonly used for classification analysis. </span><span class="koboSpan" id="kobo.873.2" xmlns:="http://www.w3.org/1999/xhtml">These suggest that the selected features are useful for predicting </span><span class="No-Break"><span class="koboSpan" id="kobo.874.1" xmlns:="http://www.w3.org/1999/xhtml">office occupancy:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.875.1" xmlns:="http://www.w3.org/1999/xhtml">                    precision     recall  f1-score   support</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.876.1" xmlns:="http://www.w3.org/1999/xhtml">               </span></strong><strong class="bold"><span class="koboSpan" id="kobo.877.1" xmlns:="http://www.w3.org/1999/xhtml">0         1.00        0.91        0.95           11</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.878.1" xmlns:="http://www.w3.org/1999/xhtml">               1         0.75        1.00        0.86            3</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.879.1" xmlns:="http://www.w3.org/1999/xhtml">     accuracy                                       0.93           14</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.880.1" xmlns:="http://www.w3.org/1999/xhtml">   macro avg         0.88        0.95        0.90           14</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.881.1" xmlns:="http://www.w3.org/1999/xhtml">weighted avg         0.95        0.93</span></strong><strong class="bold"><span class="koboSpan" id="kobo.882.1" xmlns:="http://www.w3.org/1999/xhtml">        0.93           14</span></strong></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.883.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.884.1" xmlns:="http://www.w3.org/1999/xhtml">Because light consumption is a very good indicator of office occupancy, with very simple features, we can obtain a predictive logistic </span><span class="No-Break"><span class="koboSpan" id="kobo.885.1" xmlns:="http://www.w3.org/1999/xhtml">regression model.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.886.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s </span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.887.1" xmlns:="http://www.w3.org/1999/xhtml">learn how to specify the creation of different features for different </span><span class="No-Break"><span class="koboSpan" id="kobo.888.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.889.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a dictionary with the names of the methods that we want to use to create features from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.890.1" xmlns:="http://www.w3.org/1999/xhtml">light</span></strong><span class="koboSpan" id="kobo.891.1" xmlns:="http://www.w3.org/1999/xhtml"> time series. </span><span class="koboSpan" id="kobo.891.2" xmlns:="http://www.w3.org/1999/xhtml">We enter the method’s names as keys, and if the methods take a parameter, we pass it as an additional dictionary to the corresponding key; otherwise, we pass </span><strong class="source-inline"><span class="koboSpan" id="kobo.892.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.893.1" xmlns:="http://www.w3.org/1999/xhtml"> as </span><span class="No-Break"><span class="koboSpan" id="kobo.894.1" xmlns:="http://www.w3.org/1999/xhtml">the values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.895.1" xmlns:="http://www.w3.org/1999/xhtml">
light_feat = {
    «sum_values": None,
    "median": None,
    «standard_deviation": None,
    "quan</span><a id="_idTextAnchor1416"/><span class="koboSpan" id="kobo.896.1" xmlns:="http://www.w3.org/1999/xhtml">tile": [{"q": 0.2}, {"q":</span><a id="_idTextAnchor1417"/><span class="koboSpan" id="kobo.897.1" xmlns:="http://www.w3.org/1999/xhtml"> 0.7}],
}</span></pre></li> <li><span class="koboSpan" id="kobo.898.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s create a dictionary with the features that we want to create from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.899.1" xmlns:="http://www.w3.org/1999/xhtml">co2</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.900.1" xmlns:="http://www.w3.org/1999/xhtml">time series:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.901.1" xmlns:="http://www.w3.org/1999/xhtml">
co2_feat = {
    «root_mean_square": None,
    «number_peaks": [{"n": 1}, {"n": 2}],
}</span></pre></li> <li><span class="koboSpan" id="kobo.902.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s</span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.903.1" xmlns:="http://www.w3.org/1999/xhtml"> combine these dictionaries into a </span><span class="No-Break"><span class="koboSpan" id="kobo.904.1" xmlns:="http://www.w3.org/1999/xhtml">new dictionary:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.905.1" xmlns:="http://www.w3.org/1999/xhtml">
kind_to_fc_parameters = {
    «light»: light_feat,
    "co2": co2_feat,
}</span></pre></li> <li><span class="koboSpan" id="kobo.906.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s use the dictionary from </span><em class="italic"><span class="koboSpan" id="kobo.907.1" xmlns:="http://www.w3.org/1999/xhtml">step 10</span></em><span class="koboSpan" id="kobo.908.1" xmlns:="http://www.w3.org/1999/xhtml"> to create the features from both </span><span class="No-Break"><span class="koboSpan" id="kobo.909.1" xmlns:="http://www.w3.org/1999/xhtml">time series:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.910.1" xmlns:="http://www.w3.org/1999/xhtml">
features = extract_features(
    X[[«id», «light», «co2»]],
    column_id="id",
    kind_to_fc_parameters=kind_to_fc_parameters,
)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.911.1" xmlns:="http://www.w3.org/1999/xhtml">The output of </span><em class="italic"><span class="koboSpan" id="kobo.912.1" xmlns:="http://www.w3.org/1999/xhtml">step 11</span></em><span class="koboSpan" id="kobo.913.1" xmlns:="http://www.w3.org/1999/xhtml"> consists of a DataFrame with 135 rows and 8 features. </span><span class="koboSpan" id="kobo.913.2" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.914.1" xmlns:="http://www.w3.org/1999/xhtml">features.columns</span></strong><span class="koboSpan" id="kobo.915.1" xmlns:="http://www.w3.org/1999/xhtml">, we will see the names of the </span><span class="No-Break"><span class="koboSpan" id="kobo.916.1" xmlns:="http://www.w3.org/1999/xhtml">created features:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.917.1" xmlns:="http://www.w3.org/1999/xhtml">Index(['light__sum_values', 'light__median',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.918.1" xmlns:="http://www.w3.org/1999/xhtml">    'light__standard_deviation',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.919.1" xmlns:="http://www.w3.org/1999/xhtml">    'light__quantile__q_0.2',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.920.1" xmlns:="http://www.w3.org/1999/xhtml">    'light__quantile__q_0.7',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.921.1" xmlns:="http://www.w3.org/1999/xhtml">    'co2__root_mean_square',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.922.1" xmlns:="http://www.w3.org/1999/xhtml">    'co2__number_peaks__n_1',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.923.1" xmlns:="http://www.w3.org/1999/xhtml">    'co2__numb</span><a id="_idTextAnchor1418"/><span class="koboSpan" id="kobo.924.1" xmlns:="http://www.w3.org/1999/xhtml">er_peaks__n_2'],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.925.1" xmlns:="http://www.w3.org/1999/xhtml">    dtype='object')</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.926.1" xmlns:="http://www.w3.org/1999/xhtml">N</span><a id="_idTextAnchor1419"/><span class="koboSpan" id="kobo.927.1" xmlns:="http://www.w3.org/1999/xhtml">ote that in the output from </span><em class="italic"><span class="koboSpan" id="kobo.928.1" xmlns:="http://www.w3.org/1999/xhtml">step 11</span></em><span class="koboSpan" id="kobo.929.1" xmlns:="http://www.w3.org/1999/xhtml">, different variables have been create</span><a id="_idTextAnchor1420"/><a id="_idTextAnchor1421"/><span class="koboSpan" id="kobo.930.1" xmlns:="http://www.w3.org/1999/xhtml">d from each of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.931.1" xmlns:="http://www.w3.org/1999/xhtml">light</span></strong><span class="koboSpan" id="kobo.932.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.933.1" xmlns:="http://www.w3.org/1999/xhtml">co2</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.934.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<h2 id="_idParaDest-289"><a id="_idTextAnchor1422"/><span class="koboSpan" id="kobo.935.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.936.1" xmlns:="http://www.w3.org/1999/xhtml">In this </span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.937.1" xmlns:="http://www.w3.org/1999/xhtml">recipe, we extracted specific features from our time-series data. </span><span class="koboSpan" id="kobo.937.2" xmlns:="http://www.w3.org/1999/xhtml">First, we created features based on a predefined dictionary that comes with </span><strong class="source-inline"><span class="koboSpan" id="kobo.938.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.939.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.939.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we created our own dictionary, specifying the creation of different features for different </span><span class="No-Break"><span class="koboSpan" id="kobo.940.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<p><span class="koboSpan" id="kobo.941.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.942.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.943.1" xmlns:="http://www.w3.org/1999/xhtml"> package comes with some predefined dictionaries that can be accessed through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.944.1" xmlns:="http://www.w3.org/1999/xhtml">settings</span></strong><span class="koboSpan" id="kobo.945.1" xmlns:="http://www.w3.org/1999/xhtml"> module. </span><span class="koboSpan" id="kobo.945.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.946.1" xmlns:="http://www.w3.org/1999/xhtml">MinimalFCParameters</span></strong><span class="koboSpan" id="kobo.947.1" xmlns:="http://www.w3.org/1999/xhtml"> dictionary is used to create 10 simple features based on basic statistical parameters of the time-series distribution, such as the mean, median, standard deviation, variance, sum of its values, count (or length), and minimum and maximum values. </span><span class="koboSpan" id="kobo.947.2" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.948.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.949.1" xmlns:="http://www.w3.org/1999/xhtml">, we displayed the dictionary, with the method names as keys, and, as these methods do not require additional parameters, each key had </span><strong class="source-inline"><span class="koboSpan" id="kobo.950.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.951.1" xmlns:="http://www.w3.org/1999/xhtml"> as </span><span class="No-Break"><span class="koboSpan" id="kobo.952.1" xmlns:="http://www.w3.org/1999/xhtml">the value.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.953.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.954.1" xmlns:="http://www.w3.org/1999/xhtml"> has two additional predefined dictionaries. </span><strong class="source-inline"><span class="koboSpan" id="kobo.955.1" xmlns:="http://www.w3.org/1999/xhtml">EfficientFCParameters</span></strong><span class="koboSpan" id="kobo.956.1" xmlns:="http://www.w3.org/1999/xhtml"> is used to apply methods that are fast to compute, whereas </span><strong class="source-inline"><span class="koboSpan" id="kobo.957.1" xmlns:="http://www.w3.org/1999/xhtml">ComprehensiveFCParameters</span></strong><span class="koboSpan" id="kobo.958.1" xmlns:="http://www.w3.org/1999/xhtml"> returns all possible features and is the one used by default by the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.959.1" xmlns:="http://www.w3.org/1999/xhtml">extract_</span><a id="_idTextAnchor1423"/><span class="koboSpan" id="kobo.960.1" xmlns:="http://www.w3.org/1999/xhtml">features</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.961.1" xmlns:="http://www.w3.org/1999/xhtml"> function.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.962.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.963.1" xmlns:="http://www.w3.org/1999/xhtml">For more details about the predefined dictionaries, check out </span><strong class="source-inline"><span class="koboSpan" id="kobo.964.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.965.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><span class="No-Break"><span class="koboSpan" id="kobo.966.1" xmlns:="http://www.w3.org/1999/xhtml">documentation: </span></span><a href="https://tsfresh.readthedocs.io/en/latest/text/feature_extraction_settings.html"><span class="No-Break"><span class="koboSpan" id="kobo.967.1" xmlns:="http://www.w3.org/1999/xhtml">https://tsfresh.readthedocs.io/en/latest</span><span id="_idTextAnchor1424"/><span class="koboSpan" id="kobo.968.1" xmlns:="http://www.w3.org/1999/xhtml">/text/feature_extraction_setti</span><span id="_idTextAnchor1425"/><span class="koboSpan" id="kobo.969.1" xmlns:="http://www.w3.org/1999/xhtml">ngs.html</span></span></a></p>
<p><span class="koboSpan" id="kobo.970.1" xmlns:="http://www.w3.org/1999/xhtml">By using these predefined dictionaries in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1" xmlns:="http://www.w3.org/1999/xhtml">default_fc_parameters</span></strong><span class="koboSpan" id="kobo.972.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter of </span><strong class="source-inline"><span class="koboSpan" id="kobo.973.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.974.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.975.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.976.1" xmlns:="http://www.w3.org/1999/xhtml"> function, we can create specific features from one or more time series, as we did in </span><em class="italic"><span class="koboSpan" id="kobo.977.1" xmlns:="http://www.w3.org/1999/xhtml">step 4</span></em><span class="koboSpan" id="kobo.978.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.978.2" xmlns:="http://www.w3.org/1999/xhtml">Note that </span><strong class="source-inline"><span class="koboSpan" id="kobo.979.1" xmlns:="http://www.w3.org/1999/xhtml">default_fc_parameters</span></strong><span class="koboSpan" id="kobo.980.1" xmlns:="http://www.w3.org/1999/xhtml"> instructs </span><strong class="source-inline"><span class="koboSpan" id="kobo.981.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.982.1" xmlns:="http://www.w3.org/1999/xhtml"> to create the same features from </span><em class="italic"><span class="koboSpan" id="kobo.983.1" xmlns:="http://www.w3.org/1999/xhtml">all</span></em><span class="koboSpan" id="kobo.984.1" xmlns:="http://www.w3.org/1999/xhtml"> the time series. </span><span class="koboSpan" id="kobo.984.2" xmlns:="http://www.w3.org/1999/xhtml">What if we want to extract different features from different </span><span class="No-Break"><span class="koboSpan" id="kobo.985.1" xmlns:="http://www.w3.org/1999/xhtml">time series?</span></span></p>
<p><span class="koboSpan" id="kobo.986.1" xmlns:="http://www.w3.org/1999/xhtml">To create different features for different time series, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.987.1" xmlns:="http://www.w3.org/1999/xhtml">kind_to_fc_parameters</span></strong><span class="koboSpan" id="kobo.988.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter of </span><strong class="source-inline"><span class="koboSpan" id="kobo.989.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.990.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.991.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.992.1" xmlns:="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.992.2" xmlns:="http://www.w3.org/1999/xhtml">This parameter takes a dictionary of dictionaries, specifying the methods to apply to each </span><span class="No-Break"><span class="koboSpan" id="kobo.993.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<p><span class="koboSpan" id="kobo.994.1" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.995.1" xmlns:="http://www.w3.org/1999/xhtml">step 8</span></em><span class="koboSpan" id="kobo.996.1" xmlns:="http://www.w3.org/1999/xhtml">, we created a dictionary to specify the creation of specific features from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.997.1" xmlns:="http://www.w3.org/1999/xhtml">light</span></strong><span class="koboSpan" id="kobo.998.1" xmlns:="http://www.w3.org/1999/xhtml"> time series. </span><span class="koboSpan" id="kobo.998.2" xmlns:="http://www.w3.org/1999/xhtml">Note that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.999.1" xmlns:="http://www.w3.org/1999/xhtml">"sum_values"</span></strong><span class="koboSpan" id="kobo.1000.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1001.1" xmlns:="http://www.w3.org/1999/xhtml">"mean"</span></strong><span class="koboSpan" id="kobo.1002.1" xmlns:="http://www.w3.org/1999/xhtml"> methods take </span><strong class="source-inline"><span class="koboSpan" id="kobo.1003.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1004.1" xmlns:="http://www.w3.org/1999/xhtml"> as values, but the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1005.1" xmlns:="http://www.w3.org/1999/xhtml">quantile</span></strong><span class="koboSpan" id="kobo.1006.1" xmlns:="http://www.w3.org/1999/xhtml"> method needs additional parameters corresponding to the quantiles that should be returned from the time series. </span><span class="koboSpan" id="kobo.1006.2" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.1007.1" xmlns:="http://www.w3.org/1999/xhtml">step 9</span></em><span class="koboSpan" id="kobo.1008.1" xmlns:="http://www.w3.org/1999/xhtml">, we created a dictionary to specify the creation of features from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1009.1" xmlns:="http://www.w3.org/1999/xhtml">co2</span></strong><span class="koboSpan" id="kobo.1010.1" xmlns:="http://www.w3.org/1999/xhtml"> time series. </span><span class="koboSpan" id="kobo.1010.2" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.1011.1" xmlns:="http://www.w3.org/1999/xhtml">step 10</span></em><span class="koboSpan" id="kobo.1012.1" xmlns:="http://www.w3.org/1999/xhtml">, we combined both dictionaries into one that takes the name of the time series as the key and the feature creation dictionaries as values. </span><span class="koboSpan" id="kobo.1012.2" xmlns:="http://www.w3.org/1999/xhtml">Then, we passed this dictionary to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1013.1" xmlns:="http://www.w3.org/1999/xhtml">kind_to_fc_parameters</span></strong><span class="koboSpan" id="kobo.1014.1" xmlns:="http://www.w3.org/1999/xhtml">  parameter of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1015.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1016.1" xmlns:="http://www.w3.org/1999/xhtml">’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.1018.1" xmlns:="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.1018.2" xmlns:="http://www.w3.org/1999/xhtml">This way of specifying features is suitable if we use domain knowledge to create the features, or if we only create a small number </span><span class="No-Break"><span class="koboSpan" id="kobo.1019.1" xmlns:="http://www.w3.org/1999/xhtml">of features.</span></span></p>
<p><span class="koboSpan" id="kobo.1020.1" xmlns:="http://www.w3.org/1999/xhtml">Do we need to type each method by hand into a dictionary if we want to create multiple features for various</span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.1021.1" xmlns:="http://www.w3.org/1999/xhtml"> time series? </span><span class="koboSpan" id="kobo.1021.2" xmlns:="http://www.w3.org/1999/xhtml">Not really. </span><span class="koboSpan" id="kobo.1021.3" xmlns:="http://www.w3.org/1999/xhtml">In the following recipe, we will learn how to specify which features</span><a id="_idTextAnchor1426"/><a id="_idTextAnchor1427"/><span class="koboSpan" id="kobo.1022.1" xmlns:="http://www.w3.org/1999/xhtml"> to create based on features selected </span><span class="No-Break"><span class="koboSpan" id="kobo.1023.1" xmlns:="http://www.w3.org/1999/xhtml">by Lasso.</span></span></p>
<h1 id="_idParaDest-290"><a id="_idTextAnchor1428"/><span class="koboSpan" id="kobo.1024.1" xmlns:="http://www.w3.org/1999/xhtml">Creating a subset of features identified through feature selection</span></h1>
<p><span class="koboSpan" id="kobo.1025.1" xmlns:="http://www.w3.org/1999/xhtml">In the </span><em class="italic"><span class="koboSpan" id="kobo.1026.1" xmlns:="http://www.w3.org/1999/xhtml">Automatically creating and selecting predictive features from time-series data</span></em><span class="koboSpan" id="kobo.1027.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe, we</span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.1028.1" xmlns:="http://www.w3.org/1999/xhtml"> learned </span><a id="_idIndexMarker806"/><span class="koboSpan" id="kobo.1029.1" xmlns:="http://www.w3.org/1999/xhtml">how to select relevant features using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1030.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1031.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1031.2" xmlns:="http://www.w3.org/1999/xhtml">We also discussed the limitations of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1032.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1033.1" xmlns:="http://www.w3.org/1999/xhtml">’s selection procedures and suggested following up with alternative feature selection methods to identify predictive featu</span><a id="_idTextAnchor1429"/><span class="koboSpan" id="kobo.1034.1" xmlns:="http://www.w3.org/1999/xhtml">res while </span><span class="No-Break"><span class="koboSpan" id="kobo.1035.1" xmlns:="http://www.w3.org/1999/xhtml">avoiding redundancy.</span></span></p>
<p><span class="koboSpan" id="kobo.1036.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will create and select features using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1038.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1038.2" xmlns:="http://www.w3.org/1999/xhtml">Following that, we will reduce the feature space further by utilizing Lasso regularization. </span><span class="koboSpan" id="kobo.1038.3" xmlns:="http://www.w3.org/1999/xhtml">Then, we will learn how to create a dictionary from the selected feature names to trigger the creatio</span><a id="_idTextAnchor1430"/><a id="_idTextAnchor1431"/><span class="koboSpan" id="kobo.1039.1" xmlns:="http://www.w3.org/1999/xhtml">n of those features </span><em class="italic"><span class="koboSpan" id="kobo.1040.1" xmlns:="http://www.w3.org/1999/xhtml">only</span></em><span class="koboSpan" id="kobo.1041.1" xmlns:="http://www.w3.org/1999/xhtml"> from future </span><span class="No-Break"><span class="koboSpan" id="kobo.1042.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<h2 id="_idParaDest-291"><a id="_idTextAnchor1432"/><span class="koboSpan" id="kobo.1043.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1044.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing the necessary libraries and getting the </span><span class="No-Break"><span class="koboSpan" id="kobo.1045.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1046.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.1047.1" xmlns:="http://www.w3.org/1999/xhtml">the</span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.1048.1" xmlns:="http://www.w3.org/1999/xhtml"> required libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.1049.1" xmlns:="http://www.w3.org/1999/xhtml">and functions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1050.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.feature_selection import SelectFromModel
from sklearn.linear_model import LogisticRegression
from tsfresh import (
    extract_features,
    extract_relevant_features,
)
from tsfresh.feature_extraction import settings</span></pre></li> <li><span class="koboSpan" id="kobo.1051.1" xmlns:="http://www.w3.org/1999/xhtml">Load the Occupancy Detection dataset described in the </span><em class="italic"><span class="koboSpan" id="kobo.1052.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1053.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1054.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1055.1" xmlns:="http://www.w3.org/1999/xhtml">
X = pd.read_csv("occupancy.csv", parse_dates=["date"])
y = pd.read_csv(
    "occupancy_target.csv",
    index_col="id")["occupancy"]</span></pre></li> <li><span class="koboSpan" id="kobo.1056.1" xmlns:="http://www.w3.org/1999/xhtml">Create and select features from our five time series and then display the shape of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1057.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1058.1" xmlns:="http://www.w3.org/1999/xhtml">
features = extract_relevant_features(
    X,
    y,
    column_id="id",
    column_sort="date",
)
features.shape</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1059.1" xmlns:="http://www.w3.org/1999/xhtml">The output of </span><em class="italic"><span class="koboSpan" id="kobo.1060.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.1061.1" xmlns:="http://www.w3.org/1999/xhtml"> is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1062.1" xmlns:="http://www.w3.org/1999/xhtml">(135, 968)</span></strong><span class="koboSpan" id="kobo.1063.1" xmlns:="http://www.w3.org/1999/xhtml">, indicating that 968 features were returned from the five original time series, for each hour </span><span class="No-Break"><span class="koboSpan" id="kobo.1064.1" xmlns:="http://www.w3.org/1999/xhtml">of records.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1065.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1066.1" xmlns:="http://www.w3.org/1999/xhtml">We discussed the function from </span><em class="italic"><span class="koboSpan" id="kobo.1067.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.1068.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><em class="italic"><span class="koboSpan" id="kobo.1069.1" xmlns:="http://www.w3.org/1999/xhtml">Automatically creating and selecting pred</span><a id="_idTextAnchor1433"/><span class="koboSpan" id="kobo.1070.1" xmlns:="http://www.w3.org/1999/xhtml">ictive features from time-series </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1071.1" xmlns:="http://www.w3.org/1999/xhtml">data</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1072.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1073.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s reduce </span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.1074.1" xmlns:="http://www.w3.org/1999/xhtml">the </span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.1075.1" xmlns:="http://www.w3.org/1999/xhtml">feature space further by selecting features with </span><span class="No-Break"><span class="koboSpan" id="kobo.1076.1" xmlns:="http://www.w3.org/1999/xhtml">Lasso regularization.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1077.1" xmlns:="http://www.w3.org/1999/xhtml">Set up logistic regression with Lasso regularization, which is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1" xmlns:="http://www.w3.org/1999/xhtml">"l1"</span></strong><span class="koboSpan" id="kobo.1079.1" xmlns:="http://www.w3.org/1999/xhtml"> penalty. </span><span class="koboSpan" id="kobo.1079.2" xmlns:="http://www.w3.org/1999/xhtml">I also set some additional </span><span class="No-Break"><span class="koboSpan" id="kobo.1080.1" xmlns:="http://www.w3.org/1999/xhtml">parameters arbitrarily:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1081.1" xmlns:="http://www.w3.org/1999/xhtml">
cls = LogisticRegression(
    penalty="l1",
    solver=»liblinear",
    random_state=10,
    C=0.05,
    max_iter=1000,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1082.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up a transformer to retain those features whose logistic regression coefficients are different </span><span class="No-Break"><span class="koboSpan" id="kobo.1083.1" xmlns:="http://www.w3.org/1999/xhtml">from 0:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1084.1" xmlns:="http://www.w3.org/1999/xhtml">
selector = SelectFromModel(cls)</span></pre></li> <li><span class="koboSpan" id="kobo.1085.1" xmlns:="http://www.w3.org/1999/xhtml">Train the logistic regression model and select </span><span class="No-Break"><span class="koboSpan" id="kobo.1086.1" xmlns:="http://www.w3.org/1999/xhtml">the features:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1087.1" xmlns:="http://www.w3.org/1999/xhtml">
selector.fit(features, y)</span></pre></li> <li><span class="koboSpan" id="kobo.1088.1" xmlns:="http://www.w3.org/1999/xhtml">Now, capture the selected features in </span><span class="No-Break"><span class="koboSpan" id="kobo.1089.1" xmlns:="http://www.w3.org/1999/xhtml">a variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1090.1" xmlns:="http://www.w3.org/1999/xhtml">
features = selector.get_feature_names_out()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1091.1" xmlns:="http://www.w3.org/1999/xhtml">If we</span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.1092.1" xmlns:="http://www.w3.org/1999/xhtml"> execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1093.1" xmlns:="http://www.w3.org/1999/xhtml">features</span></strong><span class="koboSpan" id="kobo.1094.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll </span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.1095.1" xmlns:="http://www.w3.org/1999/xhtml">see the names of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1096.1" xmlns:="http://www.w3.org/1999/xhtml">selected features:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.1097.1" xmlns:="http://www.w3.org/1999/xhtml">array([
'light__sum_of_reoccurring_data_points',
'co2__fft_coefficient__attr_"abs"__coeff_0',
'co2__spkt_welch_density__coeff_2', 'co2__variance',
'temperature__c3__lag_1', 'temperature__abs_energy',
'temperature__c3__lag_2', 'temperature__c3__lag_3',
'co2__sum_of_reoccurring_data_points',
'light__spkt_welch_density__coeff_8',
'light__agg_linear_trend__attr_"intercept"__chunk_len_50__f_agg_"var"',
         'light__agg_linear_trend__attr_"slope"__chunk_len_50__f_agg_"var"',  'light__agg_linear_trend__attr_"intercept"__chunk_len_10__f_agg_"var"'],
dtype=object)</span></pre></li> <li><span class="koboSpan" id="kobo.1098.1" xmlns:="http://www.w3.org/1999/xhtml">To extract just the features from </span><em class="italic"><span class="koboSpan" id="kobo.1099.1" xmlns:="http://www.w3.org/1999/xhtml">step 6</span></em><span class="koboSpan" id="kobo.1100.1" xmlns:="http://www.w3.org/1999/xhtml"> from the time series, we need to capture the feature creation method name and corresponding parameters in a dictionary. </span><span class="koboSpan" id="kobo.1100.2" xmlns:="http://www.w3.org/1999/xhtml">We can do this automatically from the feature names </span><span class="No-Break"><span class="koboSpan" id="kobo.1101.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1102.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1103.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1104.1" xmlns:="http://www.w3.org/1999/xhtml">
kind_to_fc_parameters = settings.from_columns(
    selector.get_feature_names_out(),
)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1105.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1106.1" xmlns:="http://www.w3.org/1999/xhtml">kind_to_fc_parameters</span></strong><span class="koboSpan" id="kobo.1107.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the dictionary that was created from the </span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.1108.1" xmlns:="http://www.w3.org/1999/xhtml">names of the features from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1109.1" xmlns:="http://www.w3.org/1999/xhtml">step 6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1110.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.1111.1" xmlns:="http://www.w3.org/1999/xhtml">{'light':
    {‹sum_of_reoccurring_data_points': None,
    ‹spkt_welch_density': [{'coeff': 8}],
    'variance': None,
    ‹agg_linear_trend': [
        {‹attr': 'slope','chunk_len': 50,
            'f_agg': 'var'},
        {‹attr': 'intercept',
            'chunk_len': 10,'f_agg':'var'}
        ]
    },
'co2':
    {‹spkt_welch_density': [{'coeff': 2}],
    'variance': None,
    ‹sum_of_reoccurring_data_points': None
    },
    'temperature': {
        'c3': [{'lag': 1}, {'la</span><a id="_idTextAnchor1434"/><span class="koboSpan" id="kobo.1112.1" xmlns:="http://www.w3.org/1999/xhtml">g': 2}, {'lag':3}],
        'abs_energy': None}
}</span></pre></li> <li><span class="koboSpan" id="kobo.1113.1" xmlns:="http://www.w3.org/1999/xhtml">Now, we can use</span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.1114.1" xmlns:="http://www.w3.org/1999/xhtml"> the dictionary from </span><em class="italic"><span class="koboSpan" id="kobo.1115.1" xmlns:="http://www.w3.org/1999/xhtml">step 8</span></em><span class="koboSpan" id="kobo.1116.1" xmlns:="http://www.w3.org/1999/xhtml"> together with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1117.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.1118.1" xmlns:="http://www.w3.org/1999/xhtml"> function to create only those features from </span><span class="No-Break"><span class="koboSpan" id="kobo.1119.1" xmlns:="http://www.w3.org/1999/xhtml">our dataset:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1120.1" xmlns:="http://www.w3.org/1999/xhtml">
features = extract_features(
    X,
    column_id="id",
    column_sort="date",
    kind_to_fc_parameters=kind_to_fc_parameters,
)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1121.1" xmlns:="http://www.w3.org/1999/xhtml">The new DataFrame, which can be displayed by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1122.1" xmlns:="http://www.w3.org/1999/xhtml">features.head()</span></strong><span class="koboSpan" id="kobo.1123.1" xmlns:="http://www.w3.org/1999/xhtml">, only contains the 12 features that were selected by Las</span><a id="_idTextAnchor1435"/><a id="_idTextAnchor1436"/><span class="koboSpan" id="kobo.1124.1" xmlns:="http://www.w3.org/1999/xhtml">so. </span><span class="koboSpan" id="kobo.1124.2" xmlns:="http://www.w3.org/1999/xhtml">Go ahead and corroborate the re</span><a id="_idTextAnchor1437"/><span class="koboSpan" id="kobo.1125.1" xmlns:="http://www.w3.org/1999/xhtml">sult on </span><span class="No-Break"><span class="koboSpan" id="kobo.1126.1" xmlns:="http://www.w3.org/1999/xhtml">your computer.</span></span></p>
<h2 id="_idParaDest-292"><a id="_idTextAnchor1438"/><span class="koboSpan" id="kobo.1127.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1128.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we </span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.1129.1" xmlns:="http://www.w3.org/1999/xhtml">created 968 features </span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.1130.1" xmlns:="http://www.w3.org/1999/xhtml">from 5 time series. </span><span class="koboSpan" id="kobo.1130.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we reduced the feature space to 12 features by using Lasso regularization. </span><span class="koboSpan" id="kobo.1130.3" xmlns:="http://www.w3.org/1999/xhtml">Finally, we captured the specifications of the selected features in a dictionary so that, looking forward, we only created those features from our </span><span class="No-Break"><span class="koboSpan" id="kobo.1131.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<p><span class="koboSpan" id="kobo.1132.1" xmlns:="http://www.w3.org/1999/xhtml">To automatically create and select features with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1133.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1134.1" xmlns:="http://www.w3.org/1999/xhtml">, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1135.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.1136.1" xmlns:="http://www.w3.org/1999/xhtml"> function, which we described in detail in the </span><em class="italic"><span class="koboSpan" id="kobo.1137.1" xmlns:="http://www.w3.org/1999/xhtml">Automatically creating and selecting predictive features from time-series </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1138.1" xmlns:="http://www.w3.org/1999/xhtml">data</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1139.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p>
<p><span class="koboSpan" id="kobo.1140.1" xmlns:="http://www.w3.org/1999/xhtml">Lasso regularization has the intrinsic ability to reduce some of the coefficients of the logistic regression model to 0. </span><span class="koboSpan" id="kobo.1140.2" xmlns:="http://www.w3.org/1999/xhtml">The contribution of the features whose coefficient is 0 to the prediction of office occupancy is null and can therefore be removed. </span><span class="koboSpan" id="kobo.1140.3" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1141.1" xmlns:="http://www.w3.org/1999/xhtml">SelectFromModel()</span></strong><span class="koboSpan" id="kobo.1142.1" xmlns:="http://www.w3.org/1999/xhtml"> class can identify and remove those features. </span><span class="koboSpan" id="kobo.1142.2" xmlns:="http://www.w3.org/1999/xhtml">We set up an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1143.1" xmlns:="http://www.w3.org/1999/xhtml">SelectFromModel()</span></strong><span class="koboSpan" id="kobo.1144.1" xmlns:="http://www.w3.org/1999/xhtml"> with a logistic regression model that used Lasso regularization to find the model coefficients. </span><span class="koboSpan" id="kobo.1144.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1145.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1146.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1" xmlns:="http://www.w3.org/1999/xhtml">SelectFromModel()</span></strong><span class="koboSpan" id="kobo.1148.1" xmlns:="http://www.w3.org/1999/xhtml"> trained the logistic regression model using the 968 features created from our time series and identified those whose coefficients were different from 0. </span><span class="koboSpan" id="kobo.1148.2" xmlns:="http://www.w3.org/1999/xhtml">Then, with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1149.1" xmlns:="http://www.w3.org/1999/xhtml">get_feature_names_out()</span></strong><span class="koboSpan" id="kobo.1150.1" xmlns:="http://www.w3.org/1999/xhtml"> method, we captured the names of the selected features in a </span><span class="No-Break"><span class="koboSpan" id="kobo.1151.1" xmlns:="http://www.w3.org/1999/xhtml">new variable.</span></span></p>
<p><span class="koboSpan" id="kobo.1152.1" xmlns:="http://www.w3.org/1999/xhtml">To create only the 12 features selected by Lasso regularization, we created a dictionary from the variable names by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1153.1" xmlns:="http://www.w3.org/1999/xhtml">from_columns()</span></strong><span class="koboSpan" id="kobo.1154.1" xmlns:="http://www.w3.org/1999/xhtml"> function from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1155.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1156.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1156.2" xmlns:="http://www.w3.org/1999/xhtml">This function returned a dictionary with the variables from which features were selected as keys. </span><span class="koboSpan" id="kobo.1156.3" xmlns:="http://www.w3.org/1999/xhtml">The values were additional dictionaries, containing the methods used to create features as keys, and the parameters used, if any, as values. </span><span class="koboSpan" id="kobo.1156.4" xmlns:="http://www.w3.org/1999/xhtml">To create the new features, we used this </span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.1157.1" xmlns:="http://www.w3.org/1999/xhtml">dictionary </span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.1158.1" xmlns:="http://www.w3.org/1999/xhtml">together with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1159.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1160.1" xmlns:="http://www.w3.org/1999/xhtml"> function.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1161.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1162.1" xmlns:="http://www.w3.org/1999/xhtml">In </span><em class="italic"><span class="koboSpan" id="kobo.1163.1" xmlns:="http://www.w3.org/1999/xhtml">step 9</span></em><span class="koboSpan" id="kobo.1164.1" xmlns:="http://www.w3.org/1999/xhtml">, we passed the entire dataset </span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.1165.1" xmlns:="http://www.w3.org/1999/xhtml">to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1166.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.1167.1" xmlns:="http://www.w3.org/1999/xhtml"> function. </span><span class="koboSpan" id="kobo.1167.2" xmlns:="http://www.w3.org/1999/xhtml">The resulting features only contained features extracted from three of the </span><a id="_idTextAnchor1439"/><a id="_idTextAnchor1440"/><span class="koboSpan" id="kobo.1168.1" xmlns:="http://www.w3.org/1999/xhtml">five time series. </span><span class="koboSpan" id="kobo.1168.2" xmlns:="http://www.w3.org/1999/xhtml">The additional two time series </span><span class="No-Break"><span class="koboSpan" id="kobo.1169.1" xmlns:="http://www.w3.org/1999/xhtml">were ignored.</span></span></p>
<h1 id="_idParaDest-293"><span class="koboSpan" id="kobo.1170.1" xmlns:="http://www.w3.org/1999/xhtml">Embe</span><a id="_idTextAnchor1441"/><span class="koboSpan" id="kobo.1171.1" xmlns:="http://www.w3.org/1999/xhtml">dding feature creation into a scikit-learn pipeline</span></h1>
<p><span class="koboSpan" id="kobo.1172.1" xmlns:="http://www.w3.org/1999/xhtml">Throughout this</span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.1173.1" xmlns:="http://www.w3.org/1999/xhtml"> chapter, we’ve discussed how to automatical</span><a id="_idTextAnchor1442"/><span class="koboSpan" id="kobo.1174.1" xmlns:="http://www.w3.org/1999/xhtml">ly create and select features from time-series data by utilizing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1175.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1176.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1176.2" xmlns:="http://www.w3.org/1999/xhtml">Then, we used these features to train a classification model to predict whether an office was occupied at any </span><span class="No-Break"><span class="koboSpan" id="kobo.1177.1" xmlns:="http://www.w3.org/1999/xhtml">given hour.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1178.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1179.1" xmlns:="http://www.w3.org/1999/xhtml"> includes </span><em class="italic"><span class="koboSpan" id="kobo.1180.1" xmlns:="http://www.w3.org/1999/xhtml">wrapper</span></em><span class="koboSpan" id="kobo.1181.1" xmlns:="http://www.w3.org/1999/xhtml"> classes around its main functions, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1182.1" xmlns:="http://www.w3.org/1999/xhtml">extract_features</span></strong><span class="koboSpan" id="kobo.1183.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1184.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.1185.1" xmlns:="http://www.w3.org/1999/xhtml">, to make the creation and selection of features compatible with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1186.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.1187.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will set up a scikit-learn pipeline that extracts features from time series using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1188.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1189.1" xmlns:="http://www.w3.org/1999/xhtml"> and then trains a logistic re</span><a id="_idTextAnchor1443"/><a id="_idTextAnchor1444"/><span class="koboSpan" id="kobo.1190.1" xmlns:="http://www.w3.org/1999/xhtml">gression model with those features to predict </span><span class="No-Break"><span class="koboSpan" id="kobo.1191.1" xmlns:="http://www.w3.org/1999/xhtml">office occupancy.</span></span></p>
<h2 id="_idParaDest-294"><a id="_idTextAnchor1445"/><span class="koboSpan" id="kobo.1192.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1193.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing the necessary libraries and getting the </span><span class="No-Break"><span class="koboSpan" id="kobo.1194.1" xmlns:="http://www.w3.org/1999/xhtml">dataset ready:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1195.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import the required libraries </span><span class="No-Break"><span class="koboSpan" id="kobo.1196.1" xmlns:="http://www.w3.org/1999/xhtml">and functions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1197.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LogisticRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report
from tsfresh.transformers import (
    RelevantFeatureAugmenter)</span></pre></li> <li><span class="koboSpan" id="kobo.1198.1" xmlns:="http://www.w3.org/1999/xhtml">Load the Occupancy Detection dataset described in the </span><em class="italic"><span class="koboSpan" id="kobo.1199.1" xmlns:="http://www.w3.org/1999/xhtml">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1200.1" xmlns:="http://www.w3.org/1999/xhtml">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1202.1" xmlns:="http://www.w3.org/1999/xhtml">
X = pd.read_csv("occupancy.csv", parse_dates=["date"])
y = pd.read_csv(
    "occupancy_target.csv",
    index_col="id")["occupancy"]</span></pre></li> <li><span class="koboSpan" id="kobo.1203.1" xmlns:="http://www.w3.org/1999/xhtml">Create an empty DataFrame that contains the index of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1204.1" xmlns:="http://www.w3.org/1999/xhtml">target variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1205.1" xmlns:="http://www.w3.org/1999/xhtml">
tmp = pd.DataFrame(index=y.index)</span></pre></li> <li><span class="koboSpan" id="kobo.1206.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s split</span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.1207.1" xmlns:="http://www.w3.org/1999/xhtml"> the DataFrame from </span><em class="italic"><span class="koboSpan" id="kobo.1208.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.1209.1" xmlns:="http://www.w3.org/1999/xhtml"> and the target from </span><em class="italic"><span class="koboSpan" id="kobo.1210.1" xmlns:="http://www.w3.org/1999/xhtml">step 2</span></em><span class="koboSpan" id="kobo.1211.1" xmlns:="http://www.w3.org/1999/xhtml"> into training and </span><span class="No-Break"><span class="koboSpan" id="kobo.1212.1" xmlns:="http://www.w3.org/1999/xhtml">test sets:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1213.1" xmlns:="http://www.w3.org/1999/xhtml">
X_train, X_test, y_train, y_test = train_test_split(
    tmp, y, random_state=0)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1214.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1215.1" xmlns:="http://www.w3.org/1999/xhtml">X_train</span></strong><span class="koboSpan" id="kobo.1216.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1217.1" xmlns:="http://www.w3.org/1999/xhtml">X_test</span></strong><span class="koboSpan" id="kobo.1218.1" xmlns:="http://www.w3.org/1999/xhtml"> will be used as containers to store the features created by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1219.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1220.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1220.2" xmlns:="http://www.w3.org/1999/xhtml">They are needed for the functionality of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1221.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFe</span><a id="_idTextAnchor1446"/><span class="koboSpan" id="kobo.1222.1" xmlns:="http://www.w3.org/1999/xhtml">atureAugmenter()</span></strong><span class="koboSpan" id="kobo.1223.1" xmlns:="http://www.w3.org/1999/xhtml"> that we will discuss in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1224.1" xmlns:="http://www.w3.org/1999/xhtml">coming steps.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1225.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a dictionary specifying the features to extract from each time series (I defined the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1226.1" xmlns:="http://www.w3.org/1999/xhtml">features arbitrarily):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1227.1" xmlns:="http://www.w3.org/1999/xhtml">
kind_to_fc_parameters = {
    "light": {
        "c3": [{"lag": 3}, {"lag": 2}, {"lag": 1}],
        «abs_energy": None,
        «sum_values": None,
        «fft_coefficient": [
            {«attr": "real", "coeff": 0},
            {«attr": "abs", "coeff": 0}],
        «spkt_welch_density": [
            {«coeff": 2}, {"coeff":5}, {"coeff": 8}
        ],
        «agg_linear_trend": [
            {«attr": "intercept",
            „chunk_len": 50, „f_agg": „var"},
            {"attr": "slope",
            «chunk_len": 50, "f_agg":"var"},
        ],
        «change_quantiles": [
            {«f_agg": "var", "isabs": False,
            «qh": 1.0,"ql": 0.8},
            {«f_agg": "var", "isabs": True,
            «qh": 1.0,"ql": 0.8},
        ],
    },
"co2": {
    «fft_coefficient": [
        {«attr": "real", "coeff": 0},
        {«attr": "abs", "coeff": 0}],
    "c3": [{"lag": 3}, {"lag": 2}, {"lag": 1}],
    «sum_values": None,
    «abs_energy": None,
    «sum_of_reoccurring_data_points": None,
    «sum_of_reoccurring_values": None,
    },
"temperature": {"c3": [{"lag": 1},
    {«lag»: 2},{«lag»: 3}], «abs_energy": None},
}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1228.1" xmlns:="http://www.w3.org/1999/xhtml">We discussed the parameters of this dictionary in the </span><em class="italic"><span class="koboSpan" id="kobo.1229.1" xmlns:="http://www.w3.org/1999/xhtml">Extrac</span><a id="_idTextAnchor1447"/><span class="koboSpan" id="kobo.1230.1" xmlns:="http://www.w3.org/1999/xhtml">ting different features from different ti</span><a id="_idTextAnchor1448"/><span class="koboSpan" id="kobo.1231.1" xmlns:="http://www.w3.org/1999/xhtml">me </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1232.1" xmlns:="http://www.w3.org/1999/xhtml">series</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1233.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe.</span></span></p></li> <li><span class="koboSpan" id="kobo.1234.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set </span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.1235.1" xmlns:="http://www.w3.org/1999/xhtml">up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1236.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1237.1" xmlns:="http://www.w3.org/1999/xhtml">, which is a wrapper around the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1238.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.1239.1" xmlns:="http://www.w3.org/1999/xhtml"> function, to create the features specified in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1240.1" xmlns:="http://www.w3.org/1999/xhtml">step 5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1241.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1242.1" xmlns:="http://www.w3.org/1999/xhtml">
augmenter = RelevantFeatureAugmenter(
    column_id="id",
    column_sort="date",
    kind_to_fc_parameters=kind_to_fc_parameters,
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1243.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1244.1" xmlns:="http://www.w3.org/1999/xhtml">To create all possible features, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1245.1" xmlns:="http://www.w3.org/1999/xhtml">FeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1246.1" xmlns:="http://www.w3.org/1999/xhtml"> class instead in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1247.1" xmlns:="http://www.w3.org/1999/xhtml">step 6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1248.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1249.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s combine the feature creation instance from </span><em class="italic"><span class="koboSpan" id="kobo.1250.1" xmlns:="http://www.w3.org/1999/xhtml">step 6</span></em><span class="koboSpan" id="kobo.1251.1" xmlns:="http://www.w3.org/1999/xhtml"> with a logistic regression model in a </span><span class="No-Break"><span class="koboSpan" id="kobo.1252.1" xmlns:="http://www.w3.org/1999/xhtml">scikit-learn pipeline:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1253.1" xmlns:="http://www.w3.org/1999/xhtml">
pipe = Pipeline(
    [
        ("augmenter", augmenter),
        («classifier», LogisticRegression(
    random_state=10, C=0.01)),
    ]
)</span></pre></li> <li><span class="koboSpan" id="kobo.1254.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s</span><a id="_idTextAnchor1449"/><span class="koboSpan" id="kobo.1255.1" xmlns:="http://www.w3.org/1999/xhtml"> tell </span><strong class="source-inline"><span class="koboSpan" id="kobo.1256.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1257.1" xmlns:="http://www.w3.org/1999/xhtml"> which dataset it needs to use to create </span><span class="No-Break"><span class="koboSpan" id="kobo.1258.1" xmlns:="http://www.w3.org/1999/xhtml">the feat</span><a id="_idTextAnchor1450"/><span class="koboSpan" id="kobo.1259.1" xmlns:="http://www.w3.org/1999/xhtml">ures:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1260.1" xmlns:="http://www.w3.org/1999/xhtml">
pipe.set_params(augmenter__timeseries_container=X)</span></pre></li> <li><span class="koboSpan" id="kobo.1261.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s fit the pipeline, which will trigger the feature creation process, followed by the training of the logistic </span><span class="No-Break"><span class="koboSpan" id="kobo.1262.1" xmlns:="http://www.w3.org/1999/xhtml">regression model:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1263.1" xmlns:="http://www.w3.org/1999/xhtml">
pipe.fit(X_train, y_train)</span></pre></li> <li><span class="koboSpan" id="kobo.1264.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s obtain predictions using the time series in the test set and evaluate the model’s performance through a </span><span class="No-Break"><span class="koboSpan" id="kobo.1265.1" xmlns:="http://www.w3.org/1999/xhtml">classification report:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1266.1" xmlns:="http://www.w3.org/1999/xhtml">
print(classification_report(
    y_test, pipe.predict(X_test)))</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1267.1" xmlns:="http://www.w3.org/1999/xhtml">We can see the </span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.1268.1" xmlns:="http://www.w3.org/1999/xhtml">output of </span><em class="italic"><span class="koboSpan" id="kobo.1269.1" xmlns:="http://www.w3.org/1999/xhtml">step </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1270.1" xmlns:="http://www.w3.org/1999/xhtml">10</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1271.1" xmlns:="http://www.w3.org/1999/xhtml"> here:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.1272.1" xmlns:="http://www.w3.org/1999/xhtml">                  precision     recall  f1-score   support</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1273.1" xmlns:="http://www.w3.org/1999/xhtml">               0         1.00        0.96        0.98</span></strong><strong class="bold"><span class="koboSpan" id="kobo.1274.1" xmlns:="http://www.w3.org/1999/xhtml">           28</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1275.1" xmlns:="http://www.w3.org/1999/xhtml">               1         0.86        1.00        0.92            6</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1276.1" xmlns:="http://www.w3.org/1999/xhtml">     accuracy                                       0.97           34</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1277.1" xmlns:="http://www.w3.org/1999/xhtml">   </span></strong><strong class="bold"><span class="koboSpan" id="kobo.1278.1" xmlns:="http://www.w3.org/1999/xhtml">macro avg         0.93        0.98        0.95           34</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1279.1" xmlns:="http://www.w3.org/1999/xhtml">weighted avg         0.97        0.97        0.97           34</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.1280.1" xmlns:="http://www.w3.org/1999/xhtml">The values of the classification report suggest that the extracted features are suitabl</span><a id="_idTextAnchor1451"/><a id="_idTextAnchor1452"/><span class="koboSpan" id="kobo.1281.1" xmlns:="http://www.w3.org/1999/xhtml">e for predicting whether the office is occupied at any </span><span class="No-Break"><span class="koboSpan" id="kobo.1282.1" xmlns:="http://www.w3.org/1999/xhtml">given hour.</span></span></p>
<h2 id="_idParaDest-295"><a id="_idTextAnchor1453"/><span class="koboSpan" id="kobo.1283.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1284.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we combined creating features from a time series with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1285.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1286.1" xmlns:="http://www.w3.org/1999/xhtml"> with training a machine learning algorith</span><a id="_idTextAnchor1454"/><span class="koboSpan" id="kobo.1287.1" xmlns:="http://www.w3.org/1999/xhtml">m from the scikit-learn library in </span><span class="No-Break"><span class="koboSpan" id="kobo.1288.1" xmlns:="http://www.w3.org/1999/xhtml">a pip</span><a id="_idTextAnchor1455"/><span class="koboSpan" id="kobo.1289.1" xmlns:="http://www.w3.org/1999/xhtml">eline.</span></span></p>
<p><span class="koboSpan" id="kobo.1290.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1291.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1292.1" xmlns:="http://www.w3.org/1999/xhtml"> library includes two wrapper classes around its main functions to make the feature creation process compatible with the scikit-learn pipeline. </span><span class="koboSpan" id="kobo.1292.2" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1293.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1294.1" xmlns:="http://www.w3.org/1999/xhtml"> class, which wraps the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1295.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.1296.1" xmlns:="http://www.w3.org/1999/xhtml"> function to create and then select features from a </span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1298.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1299.1" xmlns:="http://www.w3.org/1999/xhtml"> works as follows; with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1300.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1301.1" xmlns:="http://www.w3.org/1999/xhtml">, it creates and selects features by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1302.1" xmlns:="http://www.w3.org/1999/xhtml">extract_relevant_features</span></strong><span class="koboSpan" id="kobo.1303.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1303.2" xmlns:="http://www.w3.org/1999/xhtml">The names of the selected features are then stored internally in the transformer. </span><span class="koboSpan" id="kobo.1303.3" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1304.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1305.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1306.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1307.1" xmlns:="http://www.w3.org/1999/xhtml"> creates the selected features from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1308.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<p><span class="koboSpan" id="kobo.1309.1" xmlns:="http://www.w3.org/1999/xhtml">We overrode the default </span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.1310.1" xmlns:="http://www.w3.org/1999/xhtml">functionality of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1311.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1312.1" xmlns:="http://www.w3.org/1999/xhtml"> by passing a dictionary with the features we wanted to create to its </span><strong class="source-inline"><span class="koboSpan" id="kobo.1313.1" xmlns:="http://www.w3.org/1999/xhtml">kind_to_fc_parameters</span></strong><span class="koboSpan" id="kobo.1314.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter. </span><span class="koboSpan" id="kobo.1314.2" xmlns:="http://www.w3.org/1999/xhtml">Therefore, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1315.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1316.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1317.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1318.1" xmlns:="http://www.w3.org/1999/xhtml"> created the indicated features from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1319.1" xmlns:="http://www.w3.org/1999/xhtml">time series.</span></span></p>
<p><span class="koboSpan" id="kobo.1320.1" xmlns:="http://www.w3.org/1999/xhtml">To create all features from the time series, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1321.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong><span class="koboSpan" id="kobo.1322.1" xmlns:="http://www.w3.org/1999/xhtml"> includes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1323.1" xmlns:="http://www.w3.org/1999/xhtml">FeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1324.1" xmlns:="http://www.w3.org/1999/xhtml"> class, which has the same functionality as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1325.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1326.1" xmlns:="http://www.w3.org/1999/xhtml">, but without the feature </span><span class="No-Break"><span class="koboSpan" id="kobo.1327.1" xmlns:="http://www.w3.org/1999/xhtml">selection step.</span></span></p>
<p><span class="koboSpan" id="kobo.1328.1" xmlns:="http://www.w3.org/1999/xhtml">Both </span><strong class="source-inline"><span class="koboSpan" id="kobo.1329.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1330.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1331.1" xmlns:="http://www.w3.org/1999/xhtml">FeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1332.1" xmlns:="http://www.w3.org/1999/xhtml"> need two DataFrames to work. </span><span class="koboSpan" id="kobo.1332.2" xmlns:="http://www.w3.org/1999/xhtml">The first DataFrame contains the time-series data and the unique identifiers (we loaded this DataFrame in </span><em class="italic"><span class="koboSpan" id="kobo.1333.1" xmlns:="http://www.w3.org/1999/xhtml">step 2</span></em><span class="koboSpan" id="kobo.1334.1" xmlns:="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.1334.2" xmlns:="http://www.w3.org/1999/xhtml">The second DataFrame should be empty and contain the unique identifiers </span><em class="italic"><span class="koboSpan" id="kobo.1335.1" xmlns:="http://www.w3.org/1999/xhtml">in its index</span></em><span class="koboSpan" id="kobo.1336.1" xmlns:="http://www.w3.org/1999/xhtml"> (we created this DataFrame in </span><em class="italic"><span class="koboSpan" id="kobo.1337.1" xmlns:="http://www.w3.org/1999/xhtml">step 3</span></em><span class="koboSpan" id="kobo.1338.1" xmlns:="http://www.w3.org/1999/xhtml">). </span><span class="koboSpan" id="kobo.1338.2" xmlns:="http://www.w3.org/1999/xhtml">The features are extracted from the first DataFrame with the time series (when applying </span><strong class="source-inline"><span class="koboSpan" id="kobo.1339.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1340.1" xmlns:="http://www.w3.org/1999/xhtml">) and subsequently added to the second DataFrame, which is then used to train the logistic regression or obtain </span><span class="No-Break"><span class="koboSpan" id="kobo.1341.1" xmlns:="http://www.w3.org/1999/xhtml">its predictions.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1342.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1343.1" xmlns:="http://www.w3.org/1999/xhtml">The index of the empty DataFrame is used by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1344.1" xmlns:="http://www.w3.org/1999/xhtml">RelevantFeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1345.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1346.1" xmlns:="http://www.w3.org/1999/xhtml">FeatureAugmenter()</span></strong><span class="koboSpan" id="kobo.1347.1" xmlns:="http://www.w3.org/1999/xhtml"> to identify the time series from which to extract the features. </span><span class="koboSpan" id="kobo.1347.2" xmlns:="http://www.w3.org/1999/xhtml">Hence, when applying </span><strong class="source-inline"><span class="koboSpan" id="kobo.1348.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1349.1" xmlns:="http://www.w3.org/1999/xhtml"> while passing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1350.1" xmlns:="http://www.w3.org/1999/xhtml">X_train</span></strong><span class="koboSpan" id="kobo.1351.1" xmlns:="http://www.w3.org/1999/xhtml">, features were extracted from time series whose </span><strong class="source-inline"><span class="koboSpan" id="kobo.1352.1" xmlns:="http://www.w3.org/1999/xhtml">id</span></strong><span class="koboSpan" id="kobo.1353.1" xmlns:="http://www.w3.org/1999/xhtml"> value was in the training set. </span><span class="koboSpan" id="kobo.1353.2" xmlns:="http://www.w3.org/1999/xhtml">After that, the model was evaluated by observing predictions made using the test set, which triggered the creation of features from time series whose </span><strong class="source-inline"><span class="koboSpan" id="kobo.1354.1" xmlns:="http://www.w3.org/1999/xhtml">id</span></strong><span class="koboSpan" id="kobo.1355.1" xmlns:="http://www.w3.org/1999/xhtml"> value was </span><span class="No-Break"><span class="koboSpan" id="kobo.1356.1" xmlns:="http://www.w3.org/1999/xhtml">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1357.1" xmlns:="http://www.w3.org/1999/xhtml">X_test</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1358.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.1359.1" xmlns:="http://www.w3.org/1999/xhtml">When we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1360.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1361.1" xmlns:="http://www.w3.org/1999/xhtml"> on the pipeline, we created features from our raw time series and trained a logistic regression model with the resulting features. </span><span class="koboSpan" id="kobo.1361.2" xmlns:="http://www.w3.org/1999/xhtml">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1362.1" xmlns:="http://www.w3.org/1999/xhtml">predict()</span></strong><span class="koboSpan" id="kobo.1363.1" xmlns:="http://www.w3.org/1999/xhtml"> method, we created features from the test set and obtained </span><a id="_idTextAnchor1456"/><a id="_idTextAnchor1457"/><span class="koboSpan" id="kobo.1364.1" xmlns:="http://www.w3.org/1999/xhtml">the predictions of the</span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.1365.1" xmlns:="http://www.w3.org/1999/xhtml"> logistic regression based on </span><span class="No-Break"><span class="koboSpan" id="kobo.1366.1" xmlns:="http://www.w3.org/1999/xhtml">those features.</span></span></p>
<h2 id="_idParaDest-296"><a id="_idTextAnchor1458"/><span class="koboSpan" id="kobo.1367.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.1368.1" xmlns:="http://www.w3.org/1999/xhtml">For more details about the classes </span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.1369.1" xmlns:="http://www.w3.org/1999/xhtml">and procedures used in this recipe, visit the </span><span class="No-Break"><span class="koboSpan" id="kobo.1370.1" xmlns:="http://www.w3.org/1999/xhtml">following links:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1371.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1372.1" xmlns:="http://www.w3.org/1999/xhtml">tsfresh</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1373.1" xmlns:="http://www.w3.org/1999/xhtml">documentation: </span></span><a href="https://tsfresh.readthedocs.io/en/latest/api/tsfresh.transformers.html#tsfresh.transformers.relevant_feature_augmenter.RelevantFeatureAugmenter"><span class="No-Break"><span class="koboSpan" id="kobo.1374.1" xmlns:="http://www.w3.org/1999/xhtml">https://tsfresh.readthedocs.io/en/latest/api/tsfresh.transformers.html#tsfresh.transformers.relevant_feature_augmenter.RelevantFeatureAugmenter</span></span></a></li>
<li><span class="koboSpan" id="kobo.1375.1" xmlns:="http://www.w3.org/1999/xhtml">A Jupyter notebook with a </span><span class="No-Break"><span class="koboSpan" id="kobo.1376.1" xmlns:="http://www.w3.org/1999/xhtml">demo: </span></span><a href="https://github.com/blue-yonder/tsfresh/blob/main/notebooks/02%20sklearn%20Pipeline.ipynb"><span class="No-Break"><span class="koboSpan" id="kobo.1377.1" xmlns:="http://www.w3.org/1999/xhtml">https://github.com/blue-yonder/tsfresh/blob/main/notebooks/02%20sklearn%20Pipeline.ipynb</span></span></a></li>
</ul>
</div>
</body></html>
- en: Chapter 1. Getting the Most out of Your Camera System
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第一章. 充分利用您的相机系统
- en: 'Claude Monet, one of the founders of French Impressionist painting, taught
    his students to paint only what they *saw*, not what they *knew*. He even went
    as far as to say:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 克劳德·莫奈，法国印象派绘画的创始人之一，教导他的学生只画他们**看到**的，而不是他们**知道**的。他甚至走得更远，说：
- en: '*"I wish I had been born blind and then suddenly gained my sight so that I
    could begin to paint without knowing what the objects were that I could see before
    me."*'
  id: totrans-2
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “我希望我生来就是盲人，然后突然恢复视力，这样我就可以在不知道面前看到的是什么物体的情况下开始绘画。”
- en: 'Monet rejected traditional artistic subjects, which tended to be mystical,
    heroic, militaristic, or revolutionary. Instead, he relied on his own observations
    of middle-class life: of social excursions; of sunny gardens, lily ponds, rivers,
    and the seaside; of foggy boulevards and train stations; and of private loss.
    With deep sadness, he told his friend, Georges Clemenceau (the future President
    of France):'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 莫奈拒绝传统的艺术主题，这些主题往往具有神秘、英雄、军事或革命性质。相反，他依靠自己对中产阶级生活的观察：社会远足；阳光明媚的花园、池塘、河流和海滨；雾蒙蒙的林荫大道和火车站；以及私人损失。他带着深深的悲伤告诉他的朋友，乔治·克雷孟梭（未来的法国总统）：
- en: '*"I one day found myself looking at my beloved wife''s dead face and just systematically
    noting the colors according to an automatic reflex!"*'
  id: totrans-4
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “有一天，我发现自己在看着我最爱的妻子的死人脸，然后系统地根据自动反射来记录颜色！”
- en: Monet painted everything according to his personal impressions. Late in life,
    he even painted the symptoms of his own deteriorating eyesight. He adopted a reddish
    palette while he suffered from cataracts and a brilliant bluish palette after
    cataract surgery left his eyes more sensitive, possibly to the near ultraviolet
    range.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 莫奈根据他个人的印象画了一切。晚年，他甚至画出了自己视力衰退的症状。当他患有白内障时，他采用了红色调色板，而在白内障手术后，由于他的眼睛对光更敏感，可能接近紫外范围，他采用了明亮的蓝色调色板。
- en: Like Monet's students, we as scholars of computer vision must confront a distinction
    between *seeing* and *knowing* and likewise between input and processing. Light,
    a lens, a camera, and a digital imaging pipeline can grant a computer a sense
    of *sight*. From the resulting image data, **machine-learning (ML)** algorithms
    can extract *knowledge* or at least a set of meta-senses such as detection, recognition,
    and reconstruction (scanning). Without proper senses or data, a system's learning
    potential is limited, perhaps even nil. Thus, when designing any computer vision
    system, we must consider the foundational requirements in terms of lighting conditions,
    lenses, cameras, and imaging pipelines.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 就像莫奈的学生一样，我们作为计算机视觉学者必须面对**看到**和**知道**之间的区别，以及输入和处理之间的区别。光、镜头、相机和数字成像管道可以赋予计算机一种**视觉**感。从产生的图像数据中，**机器学习（ML）**算法可以提取**知识**或者至少是一套元感知，如检测、识别和重建（扫描）。如果没有适当的感觉或数据，系统的学习潜力将受到限制，甚至可能是零。因此，在设计任何计算机视觉系统时，我们必须考虑照明条件、镜头、相机和成像管道的基础要求。
- en: 'What do we require in order to clearly see a given subject? This is the central
    question of our first chapter. Along the way, we will address five subquestions:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 为了清晰地看到某个特定对象，我们需要什么？这是我们第一章的核心问题。在这个过程中，我们将解决五个子问题：
- en: What do we require to see fast motion or fast changes in light?
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要什么才能看到快速运动或光的变化？
- en: What do we require to see distant objects?
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要什么才能看到远处的物体？
- en: What do we require to see with depth perception?
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要什么才能拥有深度感知？
- en: What do we require to see in the dark?
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们在黑暗中需要看到什么？
- en: How do we obtain good value-for-money when purchasing lenses and cameras?
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在购买镜头和相机时，我们如何获得物有所值？
- en: Tip
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: For many practical applications of computer vision, the environment is not a
    well-lit, white room, and the subject is not a human face at a distance of 0.6m
    (2')!
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 对于许多计算机视觉的实际应用，环境并不是一个光线充足、白色的房间，而且主题也不是距离0.6米（2英尺）的人脸！
- en: 'The choice of hardware is crucial to these problems. Different cameras and
    lenses are optimized for different imaging scenarios. However, software can also
    make or break a solution. On the software side, we will focus on the efficient
    use of OpenCV. Fortunately, OpenCV''s **videoio** module supports many classes
    of camera systems, including the following:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 硬件的选择对这些问题至关重要。不同的相机和镜头针对不同的成像场景进行了优化。然而，软件也可以决定解决方案的成功或失败。在软件方面，我们将关注OpenCV的高效使用。幸运的是，OpenCV的**videoio**模块支持许多类型的相机系统，包括以下几种：
- en: 'Webcams in Windows, Mac, and Linux via the following frameworks, which come
    standard with most versions of the operating system:'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Windows，Mac和Linux中通过以下框架使用网络摄像头，这些框架是大多数操作系统版本的标准部分：
- en: '**Windows**: Microsoft Media Foundation (MSMF), DirectShow, or Video for Windows
    (VfW)'
  id: totrans-17
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Windows**: Microsoft Media Foundation (MSMF), DirectShow或Video for Windows
    (VfW)'
- en: '**Mac**: QuickTime'
  id: totrans-18
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Mac**: QuickTime'
- en: '**Linux**: Video4Linux (V4L), Video4Linux2 (V4L2), or libv4l'
  id: totrans-19
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Linux**: Video4Linux (V4L), Video4Linux2 (V4L2), 或 libv4l'
- en: Built-in cameras in iOS and Android devices
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: iOS和Android设备中的内置摄像头
- en: OpenNI-compliant depth cameras via OpenNI or OpenNI2, which are open-source
    under the Apache license
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过OpenNI或OpenNI2兼容的深度相机，OpenNI和OpenNI2是在Apache许可证下开源的
- en: Other depth cameras via the proprietary Intel Perceptual Computing SDK
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过专有的Intel Perceptual Computing SDK使用其他深度相机
- en: Photo cameras via libgphoto2, which is open source under the GPL license. For
    a list of libgphoto2's supported cameras, see [http://gphoto.org/proj/libgphoto2/support.php](http://gphoto.org/proj/libgphoto2/support.php).
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过libgphoto2使用照相机，libgphoto2是在GPL许可证下开源的。有关libgphoto2支持的照相机列表，请参阅[http://gphoto.org/proj/libgphoto2/support.php](http://gphoto.org/proj/libgphoto2/support.php)。
- en: Note
  id: totrans-24
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that the GPL license is not appropriate for use in closed source software.
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意，GPL许可证不适用于闭源软件的使用。
- en: IIDC/DCAM-compliant industrial cameras via libdc1394, which is open-source under
    the LGPLv2 license
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过libdc1394兼容的IIDC/DCAM工业相机，libdc1394是在LGPLv2许可证下开源的
- en: For Linux, unicap can be used as an alternative interface for IIDC/DCAM-compliant
    cameras, but unicap is GPL-licensed and thus not appropriate for use in closed-source
    software.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于Linux，unicap可以用作IIDC/DCAM兼容相机的替代接口，但unicap是GPL许可证，因此不适用于闭源软件。
- en: 'Other industrial cameras via the following proprietary frameworks:'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 其他工业相机通过以下专有框架：
- en: Allied Vision Technologies (AVT) PvAPI for GigE Vision cameras
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Allied Vision Technologies (AVT) PvAPI用于GigE Vision相机
- en: Smartek Vision Giganetix SDK for GigE Vision cameras
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Smartek Vision Giganetix SDK用于GigE Vision相机
- en: XIMEA API
  id: totrans-31
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: XIMEA API
- en: Note
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The videoio module is new in OpenCV 3\. Previously, in OpenCV 2, video capture
    and recording were part of the highgui module, but in OpenCV 3, the highgui module
    is only responsible for GUI functionality. For a complete index of OpenCV's modules,
    see the official documentation at [http://docs.opencv.org/3.0.0/](http://docs.opencv.org/3.0.0/).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: OpenCV 3中的videoio模块是新的。在OpenCV 2中，视频捕获和录制是highgui模块的一部分，但在OpenCV 3中，highgui模块仅负责GUI功能。有关OpenCV模块的完整索引，请参阅官方文档[http://docs.opencv.org/3.0.0/](http://docs.opencv.org/3.0.0/)。
- en: However, we are not limited to the features of the videoio module; we can use
    other APIs to configure cameras and capture images. If an API can capture an array
    of image data, OpenCV can readily use the data, often without any copy operation
    or conversion. As an example, we will capture and use images from depth cameras
    via OpenNI2 (without the videoio module) and from industrial cameras via the FlyCapture
    SDK by Point Grey Research (PGR).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，我们不仅限于videoio模块的功能；我们可以使用其他API来配置相机和捕获图像。如果一个API可以捕获图像数据数组，OpenCV可以轻松地使用这些数据，通常无需任何复制操作或转换。例如，我们将通过OpenNI2（无需videoio模块）捕获和使用深度相机的图像，以及通过Point
    Grey Research (PGR)的FlyCapture SDK捕获工业相机的图像。
- en: Note
  id: totrans-35
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: An industrial camera or **machine vision camera** typically has interchangeable
    lenses, a high-speed hardware interface (such as FireWire, Gigabit Ethernet, USB
    3.0, or Camera Link), and a complete programming interface for all camera settings.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 工业相机或**机器视觉相机**通常具有可互换的镜头，高速硬件接口（例如FireWire，千兆以太网，USB 3.0或Camera Link），以及所有相机设置的完整编程接口。
- en: Most industrial cameras have SDKs for Windows and Linux. PGR's FlyCapture SDK
    supports single-camera and multi-camera setups on Windows as well as single-camera
    setups on Linux. Some of PGR's competitors, such as Allied Vision Technologies
    (AVT), offer better support for multi-camera setups on Linux.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数工业相机都为Windows和Linux提供SDK。PGR的FlyCapture SDK支持Windows上的单相机和多相机设置，以及Linux上的单相机设置。PGR的一些竞争对手，如Allied
    Vision Technologies (AVT)，在Linux上提供更好的多相机设置支持。
- en: We will learn about the differences among categories of cameras, and we will
    test the capabilities of several specific lenses, cameras, and configurations.
    By the end of the chapter, you will be better qualified to design either consumer-grade
    or industrial-grade vision systems for yourself, your lab, your company, or your
    clients. I hope to surprise you with the results that are possible at each price
    point!
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将学习不同类别相机之间的差异，并将测试几种特定镜头、相机和配置的能力。到本章结束时，你将更有资格为自己、实验室、公司或客户设计消费级或工业级视觉系统。我希望通过每个价格点的可能结果来让你感到惊讶！
- en: Coloring the light
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调色光
- en: 'The human eye is sensitive to certain wavelengths of electromagnetic radiation.
    We call these wavelengths "visible light", "colors", or sometimes just "light".
    However, our definition of "visible light" is anthropocentric as different animals
    see different wavelengths. For example, bees are blind to red light, but can see
    ultraviolet light (which is invisible to humans). Moreover, machines can assemble
    human-viewable images based on almost any stimulus, such as light, radiation,
    sound, or magnetism. To broaden our horizons, let''s consider eight kinds of electromagnetic
    radiation and their common sources. Here is the list, in order of decreasing wavelength:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 人类眼睛对某些电磁辐射的波长很敏感。我们把这些波长称为“可见光”、“颜色”，有时也只称为“光”。然而，我们对“可见光”的定义是以人为中心的，因为不同的动物看到不同的波长。例如，蜜蜂对红光视而不见，但可以看到紫外线（这对人类来说是不可见的）。此外，机器可以根据几乎任何刺激（如光、辐射、声音或磁性）组装出人类可见的图像。为了拓宽我们的视野，让我们考虑八种电磁辐射及其常见来源。以下是按波长递减顺序的列表：
- en: '**Radio waves** radiate from certain astronomical objects and from lightning.
    They are also generated by wireless electronics (radio, Wi-Fi, Bluetooth, and
    so on).'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**无线电波** 来自某些天体和闪电。它们也由无线电子设备（无线电、Wi-Fi、蓝牙等）产生。'
- en: '**Microwaves** radiated from the Big Bang and are present throughout the Universe
    as background radiation. They are also generated by microwave ovens.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**微波** 从大爆炸辐射出来，作为宇宙中的背景辐射存在。微波炉也能产生微波。'
- en: '**Far infrared (FIR) light** is an invisible glow from warm or hot things such
    as warm-blooded animals and hot-water pipes.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远红外线 (FIR) 光** 是来自温暖或热物体（如热血动物和热水管）的无形光芒。'
- en: '**Near infrared (NIR) light** radiates brightly from our sun, from flames,
    and from metal that is red-hot or nearly red-hot. However, it is a relatively
    weak component in commonplace electric lighting. Leaves and other vegetation brightly
    reflect NIR light. Skin and certain fabrics are slightly transparent to NIR.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**近红外线 (NIR) 光** 从我们的太阳、火焰和红热或几乎红热的金属中明亮地辐射出来。然而，它在常见的电照明中是一个相对较弱的组成部分。叶子和其他植被会明亮地反射NIR光。皮肤和某些织物对NIR稍微透明。'
- en: '**Visible light** radiates brightly from our sun and from commonplace electric
    light sources. Visible light includes the colors red, orange, yellow, green, blue,
    and violet (in order of decreasing wavelength).'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可见光** 从我们的太阳和常见的电光源中明亮地辐射出来。可见光包括红、橙、黄、绿、蓝和紫（按波长递减的顺序）。'
- en: '**Ultraviolet (UV) light**, too, is abundant in sunlight. On a sunny day, UV
    light can burn our skin and can become slightly visible to us as a blue-gray haze
    in the distance. Commonplace, silicate glass is nearly opaque to UV light, so
    we do not suffer sunburn when we are behind windows (indoors or in a car). For
    the same reason, UV camera systems rely on lenses made of non-silicate materials
    such as quartz. Many flowers have UV markings that are visible to insects. Certain
    bodily fluids such as blood and urine are more opaque to UV than to visible light.'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**紫外线 (UV) 光** 在阳光下也很丰富。在晴朗的日子里，紫外线可以烧伤我们的皮肤，并且可以以远处的蓝灰色雾霾的形式对我们稍微可见。常见的硅酸盐玻璃对紫外线几乎是透明的，所以我们站在窗户后面（室内或车内）时不会晒伤。同样地，紫外线相机系统依赖于由非硅酸盐材料（如石英）制成的镜头。许多花朵上有紫外线标记，这些标记对昆虫来说是可见的。某些体液（如血液和尿液）对紫外线的透明度比对可见光的透明度更高。'
- en: '**X-rays** radiate from certain astronomical objects such as black holes. On
    Earth, radon gas, and certain other radioactive elements are natural X-ray sources.'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**X射线** 来自某些天体，如黑洞。在地球上，氡气和某些其他放射性元素是自然的X射线来源。'
- en: '**Gamma rays** radiate from nuclear explosions, including supernovae. To lesser
    extents the sources of gamma rays also include radioactive decay and lightning
    strikes.'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**伽马射线** 来自核爆炸，包括超新星爆炸。伽马射线的一些来源还包括放射性衰变和闪电。'
- en: 'NASA provides the following visualization of the wavelength and temperature
    associated with each kind of light or radiation:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 美国国家航空航天局提供了以下与每种光线或辐射相关的波长和温度的视觉表示：
- en: '![Coloring the light](img/00002.jpeg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![Coloring the light](img/00002.jpeg)'
- en: '**Passive** imaging systems rely on **ambient** (commonplace) light or radiation
    sources as described in the preceding list. **Active** imaging systems include
    sources of their own so that the light or radiation is **structured** in more
    predictable ways. For example, an active night vision scope might use a NIR camera
    plus a NIR light.'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**被动**成像系统依赖于前面所述的**环境**（常见）光线或辐射源。**主动**成像系统包括自己的光源，这样光线或辐射可以以更可预测的方式**结构化**。例如，一个主动夜视仪可能使用一个近红外线相机和一个近红外线光源。'
- en: For astronomy, passive imaging is feasible across the entire electromagnetic
    spectrum; the vast expanse of the Universe is flooded with all kinds of light
    and radiation from sources old and new. However, for terrestrial (Earth-bound)
    purposes, passive imaging is mostly limited to the FIR, NIR, visible, and UV ranges.
    Active imaging is feasible across the entire spectrum, but the practicalities
    of power consumption, safety, and interference (between our use case and others)
    limit the extent to which we can flood an environment with excess light and radiation.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 对于天文学，被动成像在整个电磁谱上都是可行的；浩瀚的宇宙充满了来自新旧来源的各种光线和辐射。然而，对于地球（地面）用途，被动成像主要限于远红外线、近红外线、可见光和紫外线范围。主动成像在整个谱上都是可行的，但功耗、安全性和干扰（在我们的用例与其他用例之间）的实用性限制了我们可以将过多的光线和辐射倾注到环境中的程度。
- en: Whether active or passive, an imaging system typically uses a lens to bring
    light or radiation into focus on the surface of the camera's sensor. The lens
    and its coatings transmit some wavelengths while blocking others. Additional filters
    may be placed in front of the lens or sensor to block more wavelengths. Finally,
    the sensor itself exhibits a varying **spectral response**, meaning that for some
    wavelengths, the sensor registers a strong (bright) signal, but for other wavelengths,
    it registers a weak (dim) signal or no signal. Typically, a mass-produced digital
    sensor responds most strongly to green, followed by red, blue, and NIR. Depending
    on the use case, such a sensor might be deployed with a filter to block a range
    of light (whether NIR or visible) and/or a filter to superimpose a pattern of
    varying colors. The latter filter allows for the capture of multichannel images,
    such as RGB images, whereas the unfiltered sensor would capture **monochrome**
    (gray) images.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 不论是主动还是被动，成像系统通常使用镜头将光线或辐射聚焦到相机传感器的表面。镜头及其涂层会传输某些波长的光线，同时阻挡其他波长的光线。可以在镜头或传感器前面放置额外的滤光片以阻挡更多波长的光线。最后，传感器本身表现出变化的**光谱响应**，这意味着对于某些波长的光线，传感器会记录一个强烈的（明亮）信号，而对于其他波长的光线，则记录一个微弱的（暗淡）信号或没有信号。通常，大规模生产的数字传感器对绿色的响应最强，其次是红色、蓝色和近红外线。根据使用情况，这样的传感器可能会配备一个滤光片来阻挡一定范围内的光线（无论是近红外线还是可见光）以及/或一个滤光片来叠加不同颜色的图案。后者允许捕获多通道图像，如RGB图像，而未过滤的传感器将捕获**单色**（灰色）图像。
- en: The sensor's surface consists of many sensitive points or **photosites**. These
    are analogous to pixels in the captured digital image. However, photosites and
    pixels do not necessarily correspond one-to-one. Depending on the camera system's
    design and configuration, the signals from several photosites might be blended
    together to create a neighborhood of multichannel pixels, a brighter pixel, or
    a less noisy pixel.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 传感器的表面由许多敏感点或**像素**组成。这些与捕获的数字图像中的像素类似。然而，像素和像素不一定是一对一对应的。根据相机系统的设计和配置，几个像素的信号可能会混合在一起，以创建一个多通道像素的邻域、一个更亮的像素或一个更少噪声的像素。
- en: 'Consider the following pair of images. They show a sensor with a Bayer filter,
    which is a common type of color filter with two green photosites per red or blue
    photosite. To compute a single RGB pixel, multiple photosite values are blended.
    The left-hand image is a photo of the filtered sensor under a microscope, while
    the right-hand image is a cut-away diagram showing the filter and underlying photosites:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下成对的图像。它们展示了一个带有拜耳滤光片的传感器，这是一种常见的颜色滤光片，每个红色或蓝色像素旁边有两个绿色像素。为了计算单个RGB像素，需要混合多个像素值。左侧图像是显微镜下过滤传感器的照片，而右侧图像是展示滤光片和下方像素的剖视图：
- en: '![Coloring the light](img/00003.jpeg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![Coloring the light](img/00003.jpeg)'
- en: Note
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The preceding images come from Wikimedia. They are contributed by the users
    Natural Philo, under the Creative Commons Attribution-Share Alike 3.0 Unported
    license (left), and Cburnett, under the GNU Free Documentation License (right).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的图像来自维基媒体。它们是由用户Natural Philo贡献的，遵循Creative Commons Attribution-Share Alike
    3.0 Unported许可协议（左侧），以及Cburnett贡献的，遵循GNU自由文档许可协议（右侧）。
- en: 'As we see in this example, a simplistic model (an RGB pixel) might hide important
    details about the way data are captured and stored. To build efficient image pipelines,
    we need to think about not just pixels, but also channels and **macropixels**—neighborhoods
    of pixels that share some channels of data and are captured, stored, and processed
    in one block. Let''s consider three categories of image formats:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如此例所示，一个简单的模型（RGB像素）可能会隐藏关于数据捕获和存储方式的重要细节。为了构建高效的图像处理管道，我们需要考虑的不仅仅是像素，还包括通道和**宏像素**——共享某些数据通道的像素邻域，它们作为一个块被捕获、存储和处理。让我们考虑三种图像格式类别：
- en: A **raw image** is a literal representation of the photosites' signals, scaled
    to some range such as 8, 12, or 16 bits. For photosites in a given row of the
    sensor, the data are contiguous but for photosites in a given column, they are
    not.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**原始图像**是光电传感器的光电信号的实际表示，缩放到某些范围，如8、12或16位。对于传感器给定行中的光电传感器，数据是连续的，但对于给定列中的光电传感器，数据不是连续的。'
- en: A **packed image** stores each pixel or macropixel contiguously in memory. That
    is to say, data are ordered according to their neighborhood. This is an efficient
    format if most of our processing pertains to multiple color components at a time.
    For a typical color camera, a raw image is *not* packed because each neighborhood's
    data are split across multiple rows. Packed color images usually use RGB channels,
    but alternatively, they may use **YUV channels**, where Y is brightness (grayscale),
    U is blueness (versus greenness), and V is redness (also versus greenness).
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**打包图像**将每个像素或宏像素连续存储在内存中。也就是说，数据是按照它们的邻域进行排序的。如果我们的大部分处理都涉及多个颜色组件，这是一个高效的格式。对于典型的彩色相机，原始图像*不是*打包的，因为每个邻域的数据分布在多行中。打包彩色图像通常使用RGB通道，但也可以使用**YUV通道**，其中Y是亮度（灰度），U是蓝色（与绿色相对），V是红色（也与绿色相对）。'
- en: A **planar image** stores each channel contiguously in memory. That is to say,
    data are ordered according to the color component they represent. This is an efficient
    format if most of our processing pertains to a single color component at a time.
    Packed color images usually use YUV channels. Having a Y channel in a planar format
    is efficient for computer vision because many algorithms are designed to work
    on grayscale data alone.
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平面图像**将每个通道连续存储在内存中。也就是说，数据是按照它们所代表的颜色组件进行排序的。如果我们的大部分处理都涉及单个颜色组件，这是一个高效的格式。打包彩色图像通常使用YUV通道。在平面格式中有一个Y通道对于计算机视觉来说效率很高，因为许多算法都是设计用来处理灰度数据的。'
- en: An image from a monochrome camera can be efficiently stored and processed in
    its raw format or (if it must integrate seamlessly into a color imaging pipeline)
    as the Y plane in a planar YUV format. Later in this chapter, in the sections
    *Supercharging the PlayStation Eye* and *Supercharging the GS3-U3-23S6M-C and
    other Point Grey Research cameras*, we will discuss code samples that demonstrate
    efficient handling of various image formats.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 一张来自单色相机的图像可以有效地以原始格式存储和处理，或者（如果它必须无缝集成到彩色成像管道中）作为平面YUV格式中的Y平面。在本章的后续部分，在*Supercharging
    the PlayStation Eye*和*Supercharging the GS3-U3-23S6M-C and other Point Grey Research
    cameras*等节中，我们将讨论示例代码，展示如何高效处理各种图像格式。
- en: 'Until now, we have covered a brief taxonomy of light, radiation, and color—their
    sources, their interaction with optics and sensors, and their representation as
    channels and neighborhoods. Now, let''s explore some more dimensions of image
    capture: time and space.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经简要介绍了光、辐射和颜色的分类——它们的来源、与光学和传感器的相互作用，以及它们作为通道和邻域的表示。现在，让我们探索图像捕获的一些更多维度：时间和空间。
- en: Capturing the subject in the moment
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在瞬间捕捉主题
- en: 'Robert Capa, a photojournalist who covered five wars and shot images of the
    first wave of D-Day landings at Omaha Beach, gave this advice:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 罗伯特·卡帕，一位报道过五场战争并在奥马哈海滩拍摄了D-Day登陆第一波次的摄影记者，给出了以下建议：
- en: '*"If your pictures aren''t good enough, you''re not close enough."*'
  id: totrans-67
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “如果你的照片不够好，那是因为你离得不够近。”
- en: Like a computer vision program, a photographer is the intelligence behind the
    lens. (Some would say the photographer is the soul behind the lens.) A good photographer
    continuously performs detection and tracking tasks—scanning the environment, choosing
    the subject, predicting actions and expressions that will create the right moment
    for the photo, and choosing the lens, settings, and viewpoint that will most effectively
    frame the subject.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 就像计算机视觉程序一样，摄影师是镜头背后的智慧。（有些人会说摄影师是镜头背后的灵魂。）一位优秀的摄影师会持续执行检测和跟踪任务——扫描环境，选择主题，预测将创造正确拍照时刻的动作和表情，并选择最有效地框定主题的镜头、设置和视角。
- en: By getting "close enough" to the subject and the action, the photographer can
    observe details quickly with the naked eye and can move to other viewpoints quickly
    because the distances are short and because the equipment is typically light (compared
    to a long lens on a tripod for a distant shot). Moreover, a close-up, wide-angle
    shot pulls the photographer, and viewer, into a first-person perspective of events,
    as if we become the subject or the subject's comrade for a single moment.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 通过“足够接近”主题和动作，摄影师可以用肉眼快速观察细节，并且因为距离短且设备通常较轻（与三脚架上的长焦镜头相比），可以快速移动到其他视角。此外，近距离、广角拍摄将摄影师和观众拉入事件的第一人称视角，就像我们成为主题或主题的同伴，在那一刻一样。
- en: 'Photographic aesthetics concern us further in [Chapter 2](part0023_split_000.html#LTSU2-940925703e144daa867f510896bffb69
    "Chapter 2. Photographing Nature and Wildlife with an Automated Camera"), *Photographing
    Nature and Wildlife with an Automated Camera*. For now, let''s just establish
    two cardinal rules: don''t miss the subject and don''t miss the moment! Poor visibility
    and unfortunate timing are the worst excuses a photographer or a practitioner
    of computer vision can give. To hold ourselves to account, let us define some
    measurements that are relevant to these cardinal rules.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 照片美学在[第二章](part0023_split_000.html#LTSU2-940925703e144daa867f510896bffb69 "第二章.
    使用自动相机拍摄自然和野生动物")中进一步探讨，即*使用自动相机拍摄自然和野生动物*。现在，我们只需确立两条基本规则：不要错过主体，不要错过时机！能见度差和时机不佳是摄影师或计算机视觉实践者能给出的最糟糕的借口。为了自我监督，让我们定义一些与这些基本规则相关的测量标准。
- en: '**Resolution** is the finest level of detail that the lens and camera can see.
    For many computer vision applications, recognizable details are the subject of
    the work, and if the system''s resolution is poor, we might miss this subject
    completely. Resolution is often expressed in terms of the sensor''s photosite
    counts or the captured image''s pixel counts, but at best these measurements only
    tell us about one limiting factor. A better, empirical measurement, which reflects
    all characteristics of the lens, sensor, and setup, is called **line pairs per
    millimeter** (lp/mm). This means the maximum density of black-on-white lines that
    the lens and camera can resolve, in a given setup. At any higher density than
    this, the lines in the captured image blur together. Note that lp/mm varies with
    the subject''s distance and the lens''s settings, including the focal length (optical
    zoom) of a zoom lens. When you approach the subject, zoom in, or swap out a short
    lens for a long lens, the system should of course capture more detail! However,
    lp/mm does not vary when you crop (digitally zoom) a captured image.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**分辨率**是镜头和相机能看到的细节的最精细程度。对于许多计算机视觉应用来说，可识别的细节是工作的主题，如果系统的分辨率差，我们可能会完全错过这个主题。分辨率通常用传感器的像素计数或捕获图像的像素计数来表示，但最好的这些测量只能告诉我们一个限制因素。一个更好的、经验性的测量，它反映了镜头、传感器和设置的各个方面，被称为**每毫米线对数**（lp/mm）。这意味着在给定设置中，镜头和相机可以分辨的最大黑白线条密度。在高于这个密度的任何情况下，捕获图像中的线条会模糊在一起。请注意，lp/mm会随着主题的距离和镜头的设置（包括变焦镜头的焦距（光学变焦））而变化。当你接近主题，放大或用长焦镜头替换短焦镜头时，系统当然应该捕捉到更多的细节！然而，当你裁剪（数字变焦）捕获的图像时，lp/mm不会变化。'
- en: Lighting conditions and the camera's **ISO speed** setting also have an effect
    on lp/mm. High ISO speeds are used in low light and they boost both the signal
    (which is weak in low light) and the noise (which is as strong as ever). Thus,
    at high ISO speeds, some details are blotted out by the boosted noise.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 照明条件和相机的**ISO速度**设置也会影响lp/mm。高ISO速度在低光下使用，它们增强了信号（在低光中较弱）和噪声（始终很强）。因此，在高ISO速度下，一些细节被增强的噪声所掩盖。
- en: 'To achieve anything near its potential resolution, the lens must be properly
    focused. Dante Stella, a contemporary photographer, describes a problem with modern
    camera technology:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 要接近其潜在分辨率，镜头必须正确对焦。当代摄影师丹特·斯特拉描述了现代相机技术的一个问题：
- en: '*"For starters, it lacks … thought-controlled predictive autofocus."*'
  id: totrans-74
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*"首先，它缺乏……思维控制的预测自动对焦。"*'
- en: That is to say, autofocus can fail miserably when its algorithm is mismatched
    to a particular, intelligent use or a particular pattern of evolving conditions
    in the scene. Long lenses are especially unforgiving with respect to improper
    focus. The **depth of field** (the distance between the nearest and farthest points
    in focus) is shallower in longer lenses. For some computer vision setups—for example,
    a camera hanging over an assembly line—the distance to the subject is highly predictable
    and in such cases manual focus is an acceptable solution.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着，当其算法与特定、智能的使用或场景中条件变化的特定模式不匹配时，自动对焦可能会完全失败。长焦镜头在不当对焦方面尤其不容忍。景深（焦点最近点和最远点之间的距离）在长焦镜头中较浅。对于某些计算机视觉设置——例如，悬挂在装配线上的相机——主题的距离是高度可预测的，在这种情况下，手动对焦是一个可接受的解决方案。
- en: '**Field of view (FOV)** is the extent of the lens''s vision. Typically, FOV
    is measured as an angle, but it can be measured as the distance between two peripherally
    observable points at a given depth from the lens. For example, a FOV of 90 degrees
    may also be expressed as a FOV of 2m at a depth of 1m or a FOV of 4m at a depth
    of 2m. Where not otherwise specified, FOV usually means diagonal FOV (the diagonal
    of the lens''s vision), as opposed to horizontal FOV or vertical FOV. A longer
    lens has a narrower FOV. Typically, a longer lens also has higher resolution and
    less distortion. If our subject falls outside the FOV, we miss the subject completely!
    Toward the edges of the FOV, resolution tends to decrease and distortion tends
    to increase, so preferably the FOV should be wide enough to leave a margin around
    the subject.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '**视野（FOV）**是镜头视野的范围。通常，视野是以角度来测量的，但也可以测量为从镜头特定深度处两个可观察到的边缘点的距离。例如，90度的视野也可以表示为在1米深度处的2米视野或在2米深度处的4米视野。除非另有说明，否则视野通常指的是对角线视野（镜头视野的对角线），而不是水平视野或垂直视野。长焦镜头的视野较窄。通常，长焦镜头也有更高的分辨率和更少的畸变。如果我们的主题超出了视野范围，我们就会完全错过主题！在视野的边缘，分辨率往往会降低，畸变往往会增加，因此，视野最好足够宽，以便在主题周围留出一定的空间。'
- en: 'The camera''s **throughput** is the rate at which it captures image data. For
    many computer vision applications, a visual event might start and end in a fleeting
    moment and if the throughput is low, we might miss the moment completely or our
    image of it might suffer from motion blur. Typically, throughput is measured in
    frames per second (FPS), though measuring it as a bitrate can be useful, too.
    Throughput is limited by the following factors:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 相机的**吞吐量**是它捕获图像数据的速率。对于许多计算机视觉应用，视觉事件可能在一瞬间开始和结束，如果吞吐量低，我们可能会完全错过这一刻，或者我们的图像可能会受到运动模糊的影响。通常，吞吐量以每秒帧数（FPS）来衡量，但将其作为比特率来衡量也可能很有用。吞吐量受以下因素的影响：
- en: '**Shutter speed** (exposure time): For a well-exposed image, the shutter speed
    is limited by lighting conditions, the lens''s **aperture setting**, and the camera''s
    ISO speed setting. (Conversely, a slower shutter speed allows for a narrower aperture
    setting or slower ISO speed.) We will discuss aperture settings after this list.'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**快门速度**（曝光时间）：对于曝光良好的图像，快门速度受光照条件、镜头的**光圈设置**和相机的ISO速度设置限制。（相反，较慢的快门速度允许更窄的光圈设置或更慢的ISO速度。）在讨论完这个列表后，我们将讨论光圈设置。'
- en: '**The type of shutter**: A **global shutter** synchronizes the capture across
    all photosites. A **rolling shutter** does not; rather, the capture is sequential
    such that photosites at the bottom of the sensor register their signals later
    than photosites at the top. A rolling shutter is inferior because it can make
    an object appear skewed when the object or the camera moves rapidly. (This is
    sometimes called the "Jell-O effect" because of the video''s resemblance to a
    wobbling mound of gelatin.) Also, under rapidly flickering lighting, a rolling
    shutter creates light and dark bands in the image. If the start of the capture
    is synchronized but the end is not, the shutter is referred to as a **rolling
    shutter with global reset**.'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**快门类型**：全局快门会在所有光电传感器上同步捕获。滚动快门则不会；相反，捕获是顺序进行的，传感器底部的光电传感器比顶部的光电传感器晚记录信号。滚动快门较差，因为它会在物体或相机快速移动时使物体看起来倾斜。（这有时被称为“果冻效应”，因为视频与摇摆的果冻山相似。）此外，在快速闪烁的照明下，滚动快门会在图像中创建明暗条纹。如果捕获的开始是同步的，但结束不是，则该快门被称为**全局重置的滚动快门**。'
- en: '**The camera''s onboard image processing routines**, such as conversion of
    raw photosite signals to a given number of pixels in a given format. As the number
    of pixels and bytes per pixel increase, the throughput decreases.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**相机内置图像处理程序**，例如将原始光电传感器信号转换为给定格式中给定数量的像素。随着像素数和每像素字节数的增加，吞吐量会降低。'
- en: '**The interface between the camera and host computer**: Common camera interfaces,
    in order of decreasing bit rates, include CoaXPress full, Camera Link full, USB
    3.0, CoaXPress base, Camera Link base, Gigabit Ethernet, IEEE 1394b (FireWire
    full), USB 2.0, and IEEE 1394 (FireWire base).'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**相机与主机计算机之间的接口**：按位速率递减的顺序，常见的相机接口包括CoaXPress全、Camera Link全、USB 3.0、CoaXPress基础、Camera
    Link基础、千兆以太网、IEEE 1394b（FireWire全）、USB 2.0和IEEE 1394（FireWire基础）。'
- en: A wide aperture setting lets in more light to allow for a faster exposure, a
    lower ISO speed, or a brighter image. However, a narrower aperture has the advantage
    of offering a greater depth of field. A lens supports a limited range of aperture
    settings. Depending on the lens, some aperture settings exhibit higher resolution
    than others. Long lenses tend to exhibit more stable resolution across aperture
    settings.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 宽光圈设置可以让更多的光线进入，以便允许更快的曝光、更低的ISO速度或更明亮的图像。然而，窄光圈具有提供更大景深的优点。镜头支持有限的光圈设置范围。根据镜头的不同，某些光圈设置比其他设置具有更高的分辨率。长焦镜头往往在光圈设置上表现出更稳定的分辨率。
- en: 'A lens''s aperture size is expressed as an **f-number** or **f-stop**, which
    is the ratio of the lens''s focal length to the diameter of its aperture. Roughly
    speaking, **focal length** is related to the length of the lens. More precisely,
    it is the distance between the camera''s sensor and the lens system''s optical
    center when the lens is focused at an infinitely distant target. The focal length
    should not be confused with the **focus distance**—the distance to objects that
    are in focus. The following diagram illustrates the meanings of focal length and
    focal distance as well as FOV:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 镜头的光圈大小以**f值**或**f挡**表示，这是镜头焦距与其光圈直径的比率。粗略地说，**焦距**与镜头的长度有关。更精确地说，当镜头聚焦于无限远的目标时，它是相机传感器与镜头系统光学中心之间的距离。焦距不应与**焦距**混淆——即对焦物体的距离。以下图表说明了焦距和焦距以及视场（FOV）的含义：
- en: '![Capturing the subject in the moment](img/00004.jpeg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![捕捉瞬间的主题](img/00004.jpeg)'
- en: With a higher f-number (a proportionally narrower aperture), a lens transmits
    a smaller proportion of incoming light. Specifically, the intensity of the transmitted
    light is inversely proportional to the square of the f-number. For example, when
    comparing the maximum apertures of two lenses, a photographer might write, "The
    f/2 lens is twice as fast as the f/2.8 lens." This means that the former lens
    can transmit twice the intensity of light, allowing an equivalent exposure to
    be taken in half the time.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 使用更高的f值（即比例更窄的光圈），镜头会传输更少的光。具体来说，传输光的强度与f值的平方成反比。例如，当比较两个镜头的最大光圈时，摄影师可能会写，“f/2镜头比f/2.8镜头快一倍。”这意味着前一个镜头可以传输两倍的光强度，允许在半数时间内进行等效曝光。
- en: A lens's **efficiency** or **transmittance** (the proportion of light transmitted)
    depends on not only the f-number but also non-ideal factors. For example, some
    light is reflected off the lens elements instead of being transmitted. The **T-number**
    or **T-stop** is an adjustment to the f-number based on empirical findings about
    a given lens's transmittance. For example, regardless of its f-number, a T/2.4
    lens has the same transmittance as an ideal f/2.4 lens. For cinema lenses, manufacturers
    often provide T-number specifications but for other lenses, it is much more common
    to see only f-number specifications.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 镜头的**效率**或**透射率**（透射光的比例）不仅取决于光圈数，还取决于非理想因素。例如，一些光线被镜头元件反射而不是透射。**T数**或**T挡**是根据特定镜头的透射率经验发现对光圈数进行调整。例如，无论其光圈数如何，T/2.4镜头的透射率与理想f/2.4镜头相同。对于电影镜头，制造商通常提供T数规格，但对于其他镜头，更常见的是只提供光圈数规格。
- en: The sensor's **efficiency** is the proportion of the lens-transmitted light
    that reaches photosites and gets converted to a signal. If the efficiency is poor,
    the sensor misses much of the light! A more efficient sensor will tend to take
    well-exposed images for a broader range of camera settings, lens settings, and
    lighting conditions. Thus, efficiency gives the system more freedom to auto-select
    settings that are optimal for resolution and throughput. For the common type of
    sensor described in the previous section, *Coloring the light*, the choice of
    color filters has a big effect on efficiency. A camera designed to capture visible
    light in grayscale has high efficiency because it can receive all visible wavelengths
    at each photosite. A camera designed to capture visible light in multiple color
    channels typically has much lower efficiency because some wavelengths are filtered
    out at each photosite. A camera designed to capture NIR alone, by filtering out
    all visible light, typically has even lower efficiency.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 传感器的**效率**是指镜头传输的光线中到达光电元件并转换为信号的比例。如果效率低下，传感器会错过大部分光线！效率更高的传感器倾向于在更广泛的相机设置、镜头设置和光照条件下拍摄曝光良好的图像。因此，效率为系统提供了更多自由度来自动选择对分辨率和吞吐量最优的设置。对于前一小节中描述的常见传感器类型，*彩色光线*，颜色滤光片的选取对效率有很大影响。设计用于以灰度形式捕捉可见光的相机具有高效率，因为它可以在每个光电元件上接收所有可见波长。设计用于在多个颜色通道中捕捉可见光的相机通常效率较低，因为每个光电元件会过滤掉一些波长。仅设计用于捕捉近红外光（NIR）的相机，通过过滤掉所有可见光，通常具有更低的效率。
- en: Efficiency is a good indication of the system's ability to form *some kind of
    image* under diverse lighting (or radiation) conditions. However, depending on
    the subject and the real lighting, a relatively inefficient system could have
    higher contrast and better resolution. The advantages of selectively filtering
    wavelengths are not necessarily reflected in lp/mm, which measures black-on-white
    resolution.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 效率是系统在多种光照（或辐射）条件下形成某种图像能力的好指标。然而，根据主题和实际光照，一个相对低效的系统可能具有更高的对比度和更好的分辨率。选择性过滤波长的优势并不一定反映在lp/mm上，这是衡量黑白分辨率的指标。
- en: By now, we have seen many quantifiable tradeoffs that complicate our efforts
    to capture a subject in a moment. As Robert Capa's advice implies, getting close
    with a short lens is a relatively robust recipe. It allows for good resolution
    with minimal risk of completely missing the framing or the focus. On the other
    hand, such a setup suffers from high distortion and, by definition, a short working
    distance. Moving beyond the capabilities of cameras in Capa's day, we have also
    considered the features and configurations that allow for high-throughput and
    high-efficiency video capture.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 到现在为止，我们已经看到了许多可量化的权衡，这些权衡使得我们捕捉瞬间的主题变得复杂。正如罗伯特·卡帕的建议所暗示的，使用短焦距镜头靠近主题是一个相对稳健的方案。它允许以最小的风险获得良好的分辨率，并且不太可能完全错过构图或焦点。另一方面，这种设置存在高畸变和定义上的短工作距离。超越卡帕时代的相机功能，我们还考虑了允许高吞吐量和高效视频捕获的功能和配置。
- en: Having primed ourselves on wavelengths, image formats, cameras, lenses, capture
    settings, and photographers' common sense, let us now select several systems to
    study.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在了解了波长、图像格式、相机、镜头、捕获设置和摄影师的常识之后，我们现在可以挑选几个系统来研究。
- en: Rounding up the unusual suspects
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 收集不同寻常的嫌疑人
- en: This chapter's demo applications are tested with three cameras, which are described
    in the following table. The demos are also compatible with many additional cameras;
    we will discuss compatibility later as part of each demo's detailed description.
    The three chosen cameras differ greatly in terms of price and features but each
    one can do things that an ordinary webcam cannot!
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的演示应用程序使用三台摄像头进行测试，这些摄像头在以下表格中描述。演示程序也与许多其他摄像头兼容；我们将在每个演示的详细描述中讨论兼容性。这三台选定的摄像头在价格和功能方面差异很大，但每台都能做普通网络摄像头做不到的事情！
- en: '| Name | Price | Purposes | Modes | Optics |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | 价格 | 用途 | 模式 | 光学 |'
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- |'
- en: '| Sony PlayStation Eye | $10 | Passive, color imaging in visible light | 640x480
    @ 60 FPS320x240 @ 187 FPS | FOV: 75 degrees or 56 degrees (two zoom settings)
    |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| 索尼 PlayStation Eye | $10 | 在可见光中进行被动、彩色成像 | 640x480 @ 60 FPS320x240 @ 187
    FPS | 视场角：75 度或 56 度（两种缩放设置）|'
- en: '| ASUS Xtion PRO Live | $230 | Passive, color imaging in visible lightActive,
    monochrome imaging in NIR lightDepth estimation | Color or NIR: 1280x1024 @ 60
    FPSDepth: 640x480 @ 30 FPS | FOV: 70 degrees |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| 华硕 Xtion PRO Live | $230 | 在可见光中进行被动、彩色成像，在近红外光中进行主动、单色成像，深度估计 | 彩色或近红外：1280x1024
    @ 60 FPS深度：640x480 @ 30 FPS | 视场角：70 度 |'
- en: '| PGR Grasshopper 3 GS3-U3-23S6M-C | $1000 | Passive, monochrome imaging in
    visible light | 1920x1200 @ 162 FPS | C-mount lens (not included) |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| PGR Grasshopper 3 GS3-U3-23S6M-C | $1000 | 在可见光中进行被动、单色成像 | 1920x1200 @ 162
    FPS | C-mount 镜头（不包括）|'
- en: Note
  id: totrans-98
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: For examples of lenses that we can use with the GS3-U3-23S6M-C camera, refer
    to the *Shopping for glass* section, later in this chapter.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 关于我们可以在 GS3-U3-23S6M-C 摄像头中使用的镜头示例，请参阅本章后面的“选购玻璃”部分。
- en: We will try to push these cameras to the limits of their capabilities. Using
    multiple libraries, we will write applications to access unusual capture modes
    and to process frames so rapidly that the input remains the bottleneck. To borrow
    a term from the automobile designers who made 1950s muscle cars, we might say
    that we want to "supercharge" our systems; we want to supply them with specialized
    or excess input to see what they can do!
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将尝试将这些摄像头的性能推到极限。使用多个库，我们将编写应用程序来访问不寻常的捕获模式，并快速处理帧，以便输入成为瓶颈。借用 1950 年代肌肉车设计师的术语，我们可以说我们想要“超级充电”我们的系统；我们希望向它们提供专业或过剩的输入，看看它们能做什么！
- en: Supercharging the PlayStation Eye
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Supercharging the PlayStation Eye
- en: 'Sony developed the Eye camera in 2007 as an input device for PlayStation 3
    games. Originally, no other system supported the Eye. Since then, third parties
    have created drivers and SDKs for Linux, Windows, and Mac. The following list
    describes the current state of some of these third-party projects:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 索尼于 2007 年开发了 Eye 摄像头，作为 PlayStation 3 游戏的输入设备。最初，没有其他系统支持 Eye。从那时起，第三方为 Linux、Windows
    和 Mac 开发了驱动程序和 SDK。以下列表描述了这些第三方项目的一些当前状态：
- en: For Linux, the gspca_ov534 driver supports the PlayStation Eye and works out
    of the box with OpenCV's videoio module. This driver comes standard with most
    recent Linux distributions. Current releases of the driver support modes as fast
    as 320x240 @ 125 FPS and 640x480 @ 60 FPS. An upcoming release will add support
    for 320x240 @187 FPS. If you want to upgrade to this future version today, you
    will need to familiarize yourself with the basics of Linux kernel development,
    and build the driver yourself.
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于 Linux 系统，gspca_ov534 驱动程序支持 PlayStation Eye，并且与 OpenCV 的 videoio 模块配合使用时无需额外设置。此驱动程序是大多数最新
    Linux 发行版的标准配置。当前版本的驱动程序支持高达 320x240 @ 125 FPS 和 640x480 @ 60 FPS 的模式。即将发布的版本将增加对
    320x240 @ 187 FPS 的支持。如果您想今天升级到这个未来版本，您需要熟悉 Linux 内核开发的基础知识，并自行构建驱动程序。
- en: Note
  id: totrans-104
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: See the driver's latest source code at [https://github.com/torvalds/linux/blob/master/drivers/media/usb/gspca/ov534.c](https://github.com/torvalds/linux/blob/master/drivers/media/usb/gspca/ov534.c).
    Briefly, you would need to obtain the source code of your Linux distribution's
    kernel, merge the new `ov534.c` file, build the driver as part of the kernel,
    and finally, load the newly built gspca_ov534 driver.
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在 [https://github.com/torvalds/linux/blob/master/drivers/media/usb/gspca/ov534.c](https://github.com/torvalds/linux/blob/master/drivers/media/usb/gspca/ov534.c)
    查看驱动程序的最新源代码。简要来说，您需要获取您 Linux 发行版内核的源代码，合并新的 `ov534.c` 文件，将驱动程序作为内核的一部分构建，最后加载新构建的
    gspca_ov534 驱动程序。
- en: For Mac and Windows, developers can add PlayStation Eye support to their applications
    using an SDK called PS3EYEDriver, available from [https://github.com/inspirit/PS3EYEDriver](https://github.com/inspirit/PS3EYEDriver).
    Despite the name, this project is not a driver; it supports the camera at the
    application level, but not the OS level. The supported modes include 320x240 @
    187 FPS and 640x480 @ 60 FPS. The project comes with sample application code.
    Much of the code in PS3EYEDriver is derived from the GPL-licensed gspca_ov534
    driver, and thus, the use of PS3EYEDriver is probably only appropriate to projects
    that are also GPL-licensed.
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于Mac和Windows，开发人员可以使用名为PS3EYEDriver的SDK将PlayStation Eye支持添加到他们的应用程序中，该SDK可在[https://github.com/inspirit/PS3EYEDriver](https://github.com/inspirit/PS3EYEDriver)找到。尽管名称如此，此项目不是一个驱动程序；它在应用程序级别支持摄像头，但在操作系统级别不支持。支持的模式包括320x240
    @ 187 FPS和640x480 @ 60 FPS。该项目附带示例应用程序代码。PS3EYEDriver中的大部分代码源自GPL许可的gspca_ov534驱动程序，因此，PS3EYEDriver的使用可能仅适用于也是GPL许可的项目。
- en: For Windows, a commercial driver and SDK are available from Code Laboratories
    (CL) at [https://codelaboratories.com/products/eye/driver/](https://codelaboratories.com/products/eye/driver/).
    At the time of writing, the CL-Eye Driver costs $3\. However, the driver does
    not work with OpenCV 3's videoio module. The CL-Eye Platform SDK, which depends
    on the driver, costs an additional $5\. The fastest supported modes are 320x240
    @ 187 FPS and 640x480 @ 75 FPS.
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于Windows，可以从Code Laboratories (CL) 购买商业驱动程序和SDK，网址为[https://codelaboratories.com/products/eye/driver/](https://codelaboratories.com/products/eye/driver/)。在撰写本文时，CL-Eye
    Driver的价格为3美元。然而，该驱动程序与OpenCV 3的videoio模块不兼容。依赖于驱动程序的CL-Eye Platform SDK，额外费用为5美元。支持的最快模式是320x240
    @ 187 FPS和640x480 @ 75 FPS。
- en: For recent versions of Mac, no driver is available. A driver called macam is
    available at [http://webcam-osx.sourceforge.net/](http://webcam-osx.sourceforge.net/),
    but it was last updated in 2009 and does not work on Mac OS X Mountain Lion and
    newer versions.
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于较新的Mac版本，没有可用的驱动程序。一个名为macam的驱动程序可在[http://webcam-osx.sourceforge.net/](http://webcam-osx.sourceforge.net/)找到，但它最后一次更新是在2009年，并且不适用于Mac
    OS X Mountain Lion和更新的版本。
- en: Thus, OpenCV in Linux can capture data directly from an Eye camera, but OpenCV
    in Windows or Mac requires another SDK as an intermediary.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，Linux中的OpenCV可以直接从Eye摄像头捕获数据，但Windows或Mac中的OpenCV需要另一个SDK作为中介。
- en: First, for Linux, let us consider a minimal example of a C++ application that
    uses OpenCV to record a slow-motion video based on high-speed input from an Eye.
    Also, the program should log its frame rate. Let's call this application Unblinking
    Eye.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，对于Linux，让我们考虑一个使用OpenCV根据Eye的高速输入录制慢动作视频的C++应用程序的最小示例。此外，程序应记录其帧率。让我们称这个应用程序为“不眨眼”Eye。
- en: Note
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Unblinking Eye's source code and build files are in this book's GitHub repository
    at [https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/UnblinkingEye](https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/UnblinkingEye).
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: “不眨眼”Eye的源代码和构建文件位于本书GitHub仓库的[https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/UnblinkingEye](https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/UnblinkingEye)。
- en: Note that this sample code should also work with other OpenCV-compatible cameras,
    albeit at a slower frame rate compared to the Eye.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，此示例代码也应适用于其他与OpenCV兼容的摄像头，尽管与Eye相比，帧率较慢。
- en: 'Unblinking Eye can be implemented in a single file, `UnblinkingEye.cpp`, containing
    these few lines of code:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: “不眨眼”Eye可以实现在一个名为`UnblinkingEye.cpp`的单个文件中，包含这些几行代码：
- en: '[PRE0]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Note that the camera''s specified mode is 320x240 @ 187 FPS. If our version
    of the gspca_ov534 driver does not support this mode, we can expect it to fall
    back to 320x240 @ 125 FPS. Meanwhile, the video file''s specified mode is 320x240
    @ 60 FPS, meaning that the video will play back at slower-than-real speed as a
    special effect. Unblinking Eye can be built using a Terminal command such as the
    following:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，摄像头指定的模式是320x240 @ 187 FPS。如果我们的gspca_ov534驱动程序版本不支持此模式，我们预计它将回退到320x240
    @ 125 FPS。同时，视频文件指定的模式是320x240 @ 60 FPS，这意味着视频将以慢于实际速度的速度播放，作为特殊效果。可以使用以下终端命令构建“不眨眼”Eye：
- en: '[PRE1]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Build Unblinking Eye, run it, record a moving subject, observe the frame rate,
    and play back the recorded video, `SlowMo.avi`. How does your subject look in
    slow motion?
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 构建“不眨眼”Eye，运行它，记录一个移动的物体，观察帧率，并播放录制的视频“SlowMo.avi”。你的物体在慢动作中看起来如何？
- en: On a machine with a slow CPU or slow storage, Unblinking Eye might drop some
    of the captured frames due to a bottleneck in video encoding or file output. Do
    not be fooled by the low resolution! The rate of data transfer for a camera in
    320x240 @ 187 FPS mode is greater than for a camera in 1280x720 @ 15 FPS mode
    (an HD resolution at a slightly choppy frame rate). Multiply the pixels by the
    frame rate to see how many pixels per second are transferred in each mode.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在CPU或存储速度较慢的机器上，Unblinking Eye可能会因为视频编码或文件输出的瓶颈而丢弃一些捕获的帧。不要被低分辨率所迷惑！在320x240
    @ 187 FPS模式下，摄像头的数据传输速率大于在1280x720 @ 15 FPS模式下（一个稍微卡顿的HD分辨率）。通过将像素乘以帧率，可以看到每种模式下每秒传输了多少像素。
- en: 'Suppose we want to reduce the amount of data per frame by capturing and recording
    monochrome video. Such an option is available when OpenCV 3 is built for Linux
    with libv4l support. (The relevant CMake definition is `WITH_LIBV4L`, which is
    turned on by default.) By changing the following line in the code of Unblinking
    Eye and then rebuilding it, we can switch to grayscale capture:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们想要通过捕获和记录单色视频来减少每帧的数据量。当OpenCV 3在Linux上构建时，如果启用了libv4l支持，则此选项可用。（相关的CMake定义是`WITH_LIBV4L`，默认开启。）通过更改Unblinking
    Eye中的以下代码行并重新构建，我们可以切换到灰度捕获：
- en: '[PRE2]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Note that the change to this Boolean affects the highlighted portions of the
    following code:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，对这个布尔值的更改会影响以下代码中突出显示的部分：
- en: '[PRE3]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Behind the scenes, the `VideoCapture` and `VideoWriter` objects are now using
    a planar YUV format. The captured Y data are copied to a single-channel OpenCV
    `Mat` and are ultimately stored in the video file's Y channel. Meanwhile, the
    video file's U and V color channels are just filled with the mid-range value,
    128, for gray. U and V use a lower resolution than Y, so at the time of capture,
    the YUV format has only 12 bits per pixel (bpp), compared to 24 bpp for OpenCV's
    default BGR format.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在幕后，`VideoCapture`和`VideoWriter`对象现在使用平面YUV格式。捕获的Y数据被复制到一个单通道的OpenCV `Mat`中，并最终存储在视频文件的Y通道中。同时，视频文件的U和V颜色通道只是填充了中间值，128，用于灰度。U和V的分辨率低于Y，因此在捕获时，YUV格式只有每像素12位（bpp），而OpenCV的默认BGR格式为24
    bpp。
- en: Note
  id: totrans-125
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'The libv4l interface in OpenCV''s videoio module currently supports the following
    values for `cv::CAP_PROP_MODE`:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: OpenCV视频io模块中的libv4l接口目前支持以下`cv::CAP_PROP_MODE`的值：
- en: '`cv::CAP_MODE_BGR` (the default) captures 24 bpp color in BGR format (8 bpp
    per channel).'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cv::CAP_MODE_BGR`（默认）以BGR格式捕获24 bpp颜色（每个通道8 bpp）。'
- en: '`cv::CAP_MODE_RGB` captures 24 bpp color in RGB format (8 bpp per channel).'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cv::CAP_MODE_RGB`以RGB格式捕获24 bpp颜色（每个通道8 bpp）。'
- en: '`cv::CAP_MODE_GRAY` extracts 8 bpp grayscale from a 12 bpp planar YUV format.'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cv::CAP_MODE_GRAY`从12 bpp平面YUV格式中提取8 bpp灰度。'
- en: '`cv::CAP_MODE_YUYV` captures 16 bpp color in a packed YUV format (8 bpp for
    Y and 4 bpp each for U and V).'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cv::CAP_MODE_YUYV`以打包的YUV格式（Y为8 bpp，U和V各为4 bpp）捕获16 bpp颜色。'
- en: 'For Windows or Mac, we should instead capture data using PS3EYEDriver, CL-Eye
    Platform SDK, or another library, and then create an OpenCV `Mat` that references
    the data. This approach is illustrated in the following partial code sample:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Windows或Mac，我们应该使用PS3EYEDriver、CL-Eye Platform SDK或其他库来捕获数据，然后创建一个引用数据的OpenCV
    `Mat`。以下部分代码示例展示了这种方法：
- en: '[PRE4]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Indeed, the same approach applies to integrating almost any source of data
    into OpenCV. Conversely, to use OpenCV as a source of data for another library,
    we can get a pointer to the data stored in a matrix:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，几乎任何数据源集成到OpenCV的方法都是相同的。相反，为了将OpenCV作为其他库的数据源使用，我们可以获取存储在矩阵中的数据的指针：
- en: '[PRE5]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Later in this chapter, in *Supercharging the GS3-U3-23S6M-C and other Point
    Grey Research cameras*, we cover a nuanced example of integrating OpenCV with
    other libraries, specifically FlyCapture2 for capture and SDL2 for display. PS3EYEDriver
    comes with a comparable sample, in which the pointer to captured data is passed
    to SDL2 for display. As an exercise, you might want to adapt these two examples
    to build a demo that integrates OpenCV with PS3EYEDriver for capture and SDL2
    for display.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的后面部分，在*Supercharging the GS3-U3-23S6M-C and other Point Grey Research cameras*中，我们介绍了一个将OpenCV与其他库集成的微妙示例，特别是FlyCapture2用于捕获和SDL2用于显示。PS3EYEDriver附带了一个类似的示例，其中捕获数据的指针被传递到SDL2进行显示。作为一个练习，你可能想要调整这两个示例来构建一个集成OpenCV与PS3EYEDriver进行捕获和SDL2进行显示的演示。
- en: Hopefully, after some experimentation, you will conclude that the PlayStation
    Eye is a more capable camera than its $10 price tag suggests. For fast-moving
    subjects, its high frame rate is a good tradeoff for its low resolution. Banish
    motion blur!
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 希望经过一些实验后，你会得出结论，PlayStation Eye 相机比其 $10 的价格标签所暗示的更具有能力。对于快速移动的物体，它的高帧率是低分辨率的良好折衷。消除运动模糊！
- en: If we are willing to invest in hardware modifications, the Eye has even more
    tricks hidden up its sleeve (or in its socket). The lens and IR blocking filter
    are relatively easy to replace. An aftermarket lens and filter can allow for NIR
    capture. Furthermore, an aftermarket lens can yield higher resolution, a different
    FOV, less distortion, and greater efficiency. Peau Productions sells premodified
    Eye cameras as well as do-it-yourself (DIY) kits, at [http://peauproductions.com/store/index.php?cPath=136_1](http://peauproductions.com/store/index.php?cPath=136_1).
    The company's modifications support interchangeable lenses with an m12 mount or
    CS mount (two different standards of screw mounts). The website offers detailed
    recommendations based on lens characteristics such as distortion and IR transmission.
    Peau's price for a premodified NIR Eye camera plus a lens starts from approximately
    $85\. More expensive options, including distortion-corrected lenses, range up
    to $585\. However, at these prices, it is advisable to compare lens prices across
    multiple vendors, as described later in this chapter's *Shopping for glass* section.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们愿意投资硬件修改，Eye 相机还有更多隐藏的技巧（或在其插座中）。镜头和红外阻挡滤光片相对容易更换。副厂镜头和滤光片可以允许进行近红外捕捉。此外，副厂镜头可以提供更高的分辨率、不同的视场角、更少的畸变和更高的效率。Peau
    Productions 不仅销售预修改的 Eye 相机，还提供 DIY 套件，详情请见 [http://peauproductions.com/store/index.php?cPath=136_1](http://peauproductions.com/store/index.php?cPath=136_1)。公司的修改支持带有
    m12 或 CS 螺纹接口的互换镜头（两种不同的螺纹接口标准）。网站根据镜头特性（如畸变和红外传输）提供详细的推荐。Peau 的预修改近红外 Eye 相机加镜头的价格起价约为
    $85。更昂贵的选项，包括畸变校正镜头，最高可达 $585。然而，在这些价格下，建议在多个供应商之间比较镜头价格，正如本章后面的 *购物指南* 部分所述。
- en: Next, we will examine a camera that lacks high-speed modes, but is designed
    to separately capture visible and NIR light, with active NIR illumination.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将考察一款缺乏高速模式的相机，但设计用于分别捕捉可见光和近红外光，并带有主动近红外照明。
- en: Supercharging the ASUS Xtion PRO Live and other OpenNI-compliant depth cameras
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为 ASUS Xtion PRO Live 和其他 OpenNI 兼容的深度相机提供加速
- en: 'ASUS introduced the Xtion PRO Live in 2012 as an input device for motion-controlled
    games, natural user interfaces (NUIs), and computer vision research. It is one
    of six similar cameras based on sensors designed by PrimeSense, an Israeli company
    that Apple acquired and shut down in 2013\. For a brief comparison between the
    Xtion PRO Live and the other devices that use PrimeSense sensors, see the following
    table:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: ASUS 于 2012 年推出了 Xtion PRO Live，作为动作控制游戏、自然用户界面（NUI）和计算机视觉研究的输入设备。它是基于 PrimeSense
    设计的传感器的六款类似相机之一，PrimeSense 是一家以色列公司，苹果公司在 2013 年收购并关闭了该公司。有关 Xtion PRO Live 与使用
    PrimeSense 传感器的其他设备的简要比较，请参阅以下表格：
- en: '| Name | Price and Availability | Highest Res NIR Mode | Highest Res Color
    Mode | Highest Res Depth Mode | Depth Range |'
  id: totrans-141
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | 价格和可用性 | 最高分辨率近红外模式 | 最高分辨率彩色模式 | 最高分辨率深度模式 | 深度范围 |'
- en: '| --- | --- | --- | --- | --- | --- |'
  id: totrans-142
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- |'
- en: '| Microsoft Kinect for Xbox 360 | $135Available | 640x480 @ 30 FPS? | 640x480
    @ 30 FPS | 640x480 @ 30 FPS | 0.8m to 3.5m? |'
  id: totrans-143
  prefs: []
  type: TYPE_TB
  zh: '| 微软Xbox 360 Kinect | $135 可用 | 640x480 @ 30 FPS | 640x480 @ 30 FPS | 640x480
    @ 30 FPS | 0.8m 至 3.5m |'
- en: '| ASUS Xtion PRO | $200Discontinued | 1280x1024 @ 60 FPS? | None | 640x480
    @ 30 FPS | 0.8m to 3.5m |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '| ASUS Xtion PRO | $200 已停售 | 1280x1024 @ 60 FPS | 无 | 640x480 @ 30 FPS | 0.8m
    至 3.5m |'
- en: '| ASUS Xtion PRO Live | $230Available | 1280x1024 @ 60 FPS | 1280x1024 @ 60
    FPS | 640x480 @ 30 FPS | 0.8m to 3.5m |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '| ASUS Xtion PRO Live | $230 可用 | 1280x1024 @ 60 FPS | 1280x1024 @ 60 FPS |
    640x480 @ 30 FPS | 0.8m 至 3.5m |'
- en: '| PrimeSense Carmine 1.08 | $300Discontinued | 1280x960 @ 60 FPS? | 1280x960
    @ 60 FPS | 640x480 @ 30 FPS | 0.8m to 3.5m |'
  id: totrans-146
  prefs: []
  type: TYPE_TB
  zh: '| PrimeSense Carmine 1.08 | $300 已停售 | 1280x960 @ 60 FPS | 1280x960 @ 60 FPS
    | 640x480 @ 30 FPS | 0.8m 至 3.5m |'
- en: '| PrimeSense Carmine 1.09 | $325Discontinued | 1280x960 @ 60 FPS? | 1280x960
    @ 60 FPS | 640x480 @ 30 FPS | 0.35m to 1.4m |'
  id: totrans-147
  prefs: []
  type: TYPE_TB
  zh: '| PrimeSense Carmine 1.09 | $325 已停售 | 1280x960 @ 60 FPS | 1280x960 @ 60 FPS
    | 640x480 @ 30 FPS | 0.35m 至 1.4m |'
- en: '| Structure Sensor | $380Available | 640x480 @ 30 FPS? | None | 640x480 @ 30
    FPS | 0.4m to 3.5m |'
  id: totrans-148
  prefs: []
  type: TYPE_TB
  zh: '| 结构传感器 | $380 可用 | 640x480 @ 30 FPS | 无 | 640x480 @ 30 FPS | 0.4m 至 3.5m |'
- en: 'All of these devices include a NIR camera and a source of NIR illumination.
    The light source projects a pattern of NIR dots, which might be detectable at
    a distance of 0.8m to 3.5m, depending on the model. Most of the devices also include
    an RGB color camera. Based on the appearance of the active NIR image (of the dots)
    and the passive RGB image, the device can estimate distances and produce a so-called
    **depth map**, containing distance estimates for 640x480 points. Thus, the device
    has up to three modes: NIR (a camera image), color (a camera image), and depth
    (a processed image).'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些设备都包含一个近红外 (NIR) 摄像头和近红外照明源。光源投射出近红外点图案，可能在 0.8m 到 3.5m 的距离内被检测到，具体取决于型号。大多数设备还包含一个
    RGB 彩色摄像头。基于主动 NIR 图像（点图案）和被动 RGB 图像，设备可以估计距离并生成所谓的 **深度图**，包含 640x480 点的距离估计。因此，该设备最多有三种模式：NIR（摄像头图像）、彩色（摄像头图像）和深度（处理后的图像）。
- en: Note
  id: totrans-150
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'For more information on the types of active illumination or structured light
    that are useful in depth imaging, see the following paper:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 关于在深度成像中有用的主动照明或结构光类型的信息，请参阅以下论文：
- en: David Fofi, Tadeusz Sliwa, Yvon Voisin, "A comparative survey on invisible structured
    light", *SPIE Electronic Imaging - Machine Vision Applications in Industrial Inspection
    XII*, San José, USA, pp. 90-97, January, 2004.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: David Fofi, Tadeusz Sliwa, Yvon Voisin, "A comparative survey on invisible structured
    light", *SPIE Electronic Imaging - Machine Vision Applications in Industrial Inspection
    XII*, San José, USA, pp. 90-97, January, 2004.
- en: The paper is available online at [http://www.le2i.cnrs.fr/IMG/publications/fofi04a.pdf](http://www.le2i.cnrs.fr/IMG/publications/fofi04a.pdf).
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 论文可在以下网址在线获取：[http://www.le2i.cnrs.fr/IMG/publications/fofi04a.pdf](http://www.le2i.cnrs.fr/IMG/publications/fofi04a.pdf)。
- en: 'The Xtion, Carmine, and Structure Sensor devices as well as certain versions
    of the Kinect are compatible with open source SDKs called OpenNI and OpenNI2\.
    Both OpenNI and OpenNI2 are available under the Apache license. On Windows, OpenNI2
    comes with support for many cameras. However, on Linux and Mac, support for the
    Xtion, Carmine, and Structure Sensor devices is provided through an extra module
    called PrimeSense Sensor, which is also open source under the Apache license.
    The Sensor module and OpenNI2 have separate installation procedures and the Sensor
    module must be installed first. Obtain the Sensor module from one of the following
    URLs, depending on your operating system:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: Xtion、Carmine 和 Structure Sensor 设备以及某些版本的 Kinect 与名为 OpenNI 和 OpenNI2 的开源 SDK
    兼容。OpenNI 和 OpenNI2 都可在 Apache 许可证下使用。在 Windows 上，OpenNI2 随带对许多相机的支持。然而，在 Linux
    和 Mac 上，Xtion、Carmine 和 Structure Sensor 设备的支持是通过一个名为 PrimeSense Sensor 的额外模块提供的，该模块也是开源的，并遵循
    Apache 许可证。Sensor 模块和 OpenNI2 有独立的安装程序，Sensor 模块必须首先安装。根据您的操作系统，从以下 URL 获取 Sensor
    模块：
- en: 'Linux x64: [http://nummist.com/opencv/Sensor-Bin-Linux-x64-v5.1.6.6.tar.bz2](http://nummist.com/opencv/Sensor-Bin-Linux-x64-v5.1.6.6.tar.bz2)'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Linux x64: [http://nummist.com/opencv/Sensor-Bin-Linux-x64-v5.1.6.6.tar.bz2](http://nummist.com/opencv/Sensor-Bin-Linux-x64-v5.1.6.6.tar.bz2)'
- en: 'Linux x86: [http://nummist.com/opencv/Sensor-Bin-Linux-x86-v5.1.6.6.tar.bz2](http://nummist.com/opencv/Sensor-Bin-Linux-x86-v5.1.6.6.tar.bz2)'
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Linux x86: [http://nummist.com/opencv/Sensor-Bin-Linux-x86-v5.1.6.6.tar.bz2](http://nummist.com/opencv/Sensor-Bin-Linux-x86-v5.1.6.6.tar.bz2)'
- en: 'Linux ARM: [http://nummist.com/opencv/Sensor-Bin-Linux-Arm-v5.1.6.6.tar.bz2](http://nummist.com/opencv/Sensor-Bin-Linux-Arm-v5.1.6.6.tar.bz2)'
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Linux ARM: [http://nummist.com/opencv/Sensor-Bin-Linux-Arm-v5.1.6.6.tar.bz2](http://nummist.com/opencv/Sensor-Bin-Linux-Arm-v5.1.6.6.tar.bz2)'
- en: 'Mac: [http://nummist.com/opencv/Sensor-Bin-MacOSX-v5.1.6.6.tar.bz2](http://nummist.com/opencv/Sensor-Bin-MacOSX-v5.1.6.6.tar.bz2)'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Mac: [http://nummist.com/opencv/Sensor-Bin-MacOSX-v5.1.6.6.tar.bz2](http://nummist.com/opencv/Sensor-Bin-MacOSX-v5.1.6.6.tar.bz2)'
- en: After downloading this archive, decompress it and run `install.sh` (inside the
    decompressed folder).
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 下载此存档后，解压缩它并运行解压缩文件夹内的 `install.sh`。
- en: Note
  id: totrans-160
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: For Kinect compatibility, instead try the SensorKinect fork of the Sensor module.
    Downloads for SensorKinect are available at [https://github.com/avin2/SensorKinect/downloads](https://github.com/avin2/SensorKinect/downloads).
    SensorKinect only supports Kinect for Xbox 360 and it does not support model 1473\.
    (The model number is printed on the bottom of the device.) Moreover, SensorKinect
    is only compatible with an old development build of OpenNI (and not OpenNI2).
    For download links to the old build of OpenNI, refer to [http://nummist.com/opencv/](http://nummist.com/opencv/).
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Kinect兼容性，尝试传感器模块的SensorKinect分支。SensorKinect的下载可在[https://github.com/avin2/SensorKinect/downloads](https://github.com/avin2/SensorKinect/downloads)找到。SensorKinect仅支持Xbox
    360的Kinect，不支持型号1473。（型号编号打印在设备底部。）此外，SensorKinect仅与OpenNI（而不是OpenNI2）的老版本开发构建兼容。有关旧版OpenNI的下载链接，请参阅[http://nummist.com/opencv/](http://nummist.com/opencv/)。
- en: 'Now, on any operating system, we need to build the latest development version
    of OpenNI2 from source. (Older, stable versions do not work with the Xtion PRO
    Live, at least on some systems.) The source code can be downloaded as a ZIP archive
    from [https://github.com/occipital/OpenNI2/archive/develop.zip](https://github.com/occipital/OpenNI2/archive/develop.zip)
    or it can be cloned as a Git repository using the following command:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在任意操作系统上，我们需要从源代码构建OpenNI2的最新开发版本。（较旧、稳定的版本在Xtion PRO Live上不工作，至少在某些系统上。）源代码可以作为一个ZIP存档从[https://github.com/occipital/OpenNI2/archive/develop.zip](https://github.com/occipital/OpenNI2/archive/develop.zip)下载，或者可以使用以下命令将其作为Git仓库克隆：
- en: '[PRE6]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Let''s refer to the unzipped directory or local repository directory as `<openni2_path>`.
    This path should contain a Visual Studio project for Windows and a Makefile for
    Linux or Mac. Build the project (using Visual Studio or the `make` command). Library
    files are generated in directories such as `<openni2_path>/Bin/x64-Release` and
    `<openni2_path>/Bin/x64-Release/OpenNI2/Drivers` (or similar names for another
    architecture besides x64). On Windows, add these two folders to the system''s
    `Path` so that applications can find the `dll` files. On Linux or Mac, edit your
    `~/.profile` file and add lines such as the following to create environment variables
    related to OpenNI2:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将解压后的目录或本地仓库目录称为`<openni2_path>`。此路径应包含Windows的Visual Studio项目和一个Linux或Mac的Makefile。构建项目（使用Visual
    Studio或`make`命令）。库文件生成在如`<openni2_path>/Bin/x64-Release`和`<openni2_path>/Bin/x64-Release/OpenNI2/Drivers`（或其他架构的类似名称）的目录中。在Windows上，将这些两个文件夹添加到系统的`Path`中，以便应用程序可以找到`dll`文件。在Linux或Mac上，编辑您的`~/.profile`文件，并添加以下类似的行以创建与OpenNI2相关的环境变量：
- en: '[PRE7]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: At this point, we have set up OpenNI2 with support for the Sensor module, so
    we can create applications for the Xtion PRO Live or other cameras that are based
    on the PrimeSense hardware. Source code, Visual Studio projects, and Makefiles
    for several samples can be found in `<openni2_path>/Samples`.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经设置了支持传感器模块的OpenNI2，因此我们可以为Xtion PRO Live或其他基于PrimeSense硬件的相机创建应用程序。源代码、Visual
    Studio项目和几个示例的Makefiles可以在`<openni2_path>/Samples`中找到。
- en: Note
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Optionally, OpenCV's videoio module can be compiled with support for capturing
    images via OpenNI or OpenNI2\. However, we will capture images directly from OpenNI2
    and then convert them for use with OpenCV. By using OpenNI2 directly, we gain
    more control over the selection of camera modes, such as raw NIR capture.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 可选地，可以将OpenCV的videoio模块编译为支持通过OpenNI或OpenNI2捕获图像。然而，我们将直接从OpenNI2捕获图像，然后将其转换为与OpenCV一起使用。通过直接使用OpenNI2，我们可以获得更多控制相机模式选择的能力，例如原始近红外捕获。
- en: 'The Xtion devices are designed for USB 2.0 and their standard firmware does
    not work with USB 3.0 ports. For USB 3.0 compatibility, we need an unofficial
    firmware update. The firmware updater only runs in Windows, but after the update
    is applied, the device is USB 3.0-compatible in Linux and Mac, too. To obtain
    and apply the update, take the following steps:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Xtion设备是为USB 2.0设计的，它们的标准固件不与USB 3.0端口兼容。为了实现USB 3.0兼容性，我们需要一个非官方的固件更新。固件更新程序只能在Windows上运行，但更新应用后，设备在Linux和Mac上也能实现USB
    3.0兼容。要获取并应用更新，请按照以下步骤操作：
- en: Download the update from [https://github.com/nh2/asus-xtion-fix/blob/master/FW579-RD1081-112v2.zip?raw=true](https://github.com/nh2/asus-xtion-fix/blob/master/FW579-RD1081-112v2.zip?raw=true)
    and unzip it to any destination, which we will refer to as `<xtion_firmware_unzip_path>`.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从[https://github.com/nh2/asus-xtion-fix/blob/master/FW579-RD1081-112v2.zip?raw=true](https://github.com/nh2/asus-xtion-fix/blob/master/FW579-RD1081-112v2.zip?raw=true)下载更新，并将其解压到任何目标位置，我们将此位置称为`<xtion_firmware_unzip_path>`。
- en: Ensure that the Xtion device is plugged in.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保Xtion设备已连接。
- en: 'Open Command Prompt and run the following commands:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开命令提示符并运行以下命令：
- en: '[PRE8]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: If the firmware updater prints errors, these are not necessarily fatal. Proceed
    to test the camera using our demo application shown here.
  id: totrans-174
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果固件更新器打印出错误，这些错误并不一定是致命的。请继续使用我们在此展示的演示应用程序测试相机。
- en: To understand the Xtion PRO Live's capabilities as either an active or passive
    NIR camera, we will build a simple application that captures and displays images
    from the device. Let's call this application Infravision.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解Xtion PRO Live作为主动或被动NIR相机的功能，我们将构建一个简单的应用程序来捕获和显示设备中的图像。让我们称这个应用程序为Infravision。
- en: Note
  id: totrans-176
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Infravision's source code and build files are in this book's GitHub repository
    at [https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/Infravision](https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/Infravision).
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: Infravision的源代码和构建文件位于本书GitHub仓库的[https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/Infravision](https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/Infravision)。
- en: 'This project needs just one source file, `Infravision.cpp`. From the C standard
    library, we will use functionality for formatting and printing strings. Thus,
    our implementation begins with the following import statements:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 此项目只需要一个源文件，即`Infravision.cpp`。从C标准库中，我们将使用格式化和打印字符串的功能。因此，我们的实现从以下导入语句开始：
- en: '[PRE9]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Infravision will use OpenNI2 and OpenCV. From OpenCV, we will use the core
    and imgproc modules for basic image manipulation as well as the highgui module
    for event handling and display. Here are the relevant import statements:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: Infravision将使用OpenNI2和OpenCV。从OpenCV中，我们将使用核心和imgproc模块进行基本的图像处理，以及highgui模块进行事件处理和显示。以下是相关的导入语句：
- en: '[PRE10]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Note
  id: totrans-182
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The documentation for OpenNI2 as well as OpenNI can be found online at [http://structure.io/openni](http://structure.io/openni).
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: OpenNI2以及OpenNI的文档可以在网上找到，地址为[http://structure.io/openni](http://structure.io/openni)。
- en: 'The only function in Infravision is a `main` function. It begins with definitions
    of two constants, which we might want to configure. The first of these specifies
    the kind of sensor data to be captured via OpenNI. This can be `SENSOR_IR` (monochrome
    output from the IR camera), `SENSOR_COLOR` (RGB output from the color camera),
    or `SENSOR_DEPTH` (processed, hybrid data reflecting the estimated distance to
    each point). The second constant is the title of the application window. Here
    are the relevant definitions:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: Infravision中只有一个函数，即`main`函数。它从定义两个常量开始，我们可能需要配置这些常量。第一个常量指定通过OpenNI捕获的传感器数据类型。这可以是`SENSOR_IR`（红外相机的单色输出）、`SENSOR_COLOR`（彩色相机的RGB输出）或`SENSOR_DEPTH`（处理过的、反映每个点估计距离的混合数据）。第二个常量是应用程序窗口的标题。以下是相关的定义：
- en: '[PRE11]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Based on the capture mode, we will define the format of the corresponding OpenCV
    matrix. The IR and depth modes are monochrome with 16 bpp. The color mode has
    three channels with 8 bpp per channel, as seen in the following code:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 根据捕获模式，我们将定义相应的OpenCV矩阵的格式。红外和深度模式是单色的，位深为16位。彩色模式有三个通道，每个通道位深为8位，如下面的代码所示：
- en: '[PRE12]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Let''s proceed by taking several steps to initialize OpenNI2, connect to the
    camera, configure it, and start capturing images. Here is the code for the first
    step, initializing the library:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过几个步骤来初始化OpenNI2、连接到相机、配置它并开始捕获图像。以下是第一步的代码，初始化库：
- en: '[PRE13]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Next, we will connect to any available OpenNI-compliant camera:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将连接到任何可用的OpenNI兼容相机：
- en: '[PRE14]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'We will ensure that the device has the appropriate type of sensor by attempting
    to fetch information about that sensor:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过尝试获取有关该传感器的信息来确保设备具有适当的传感器类型：
- en: '[PRE15]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We will also create a stream but not start it yet:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将创建一个流，但尚未启动：
- en: '[PRE16]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'We will query the supported video modes and iterate through them to find the
    one with the highest resolution. Then, we will select this mode:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将查询支持的视频模式，并遍历它们以找到具有最高分辨率的模式。然后，我们将选择此模式：
- en: '[PRE17]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We will start streaming images from the camera:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将开始从相机流式传输图像：
- en: '[PRE18]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'To prepare for capturing and displaying images, we will create an OpenNI frame,
    an OpenCV matrix, and a window:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 为了准备捕获和显示图像，我们将创建一个OpenNI帧、一个OpenCV矩阵和一个窗口：
- en: '[PRE19]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Next, we will implement the application''s main loop. On each iteration, we
    will capture a frame via OpenNI, convert it to a typical OpenCV format (either
    grayscale with 8 bpp or BGR with 8 bpp per channel), and display it via the highgui
    module. The loop ends when the user presses any key. Here is the implementation:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将实现应用程序的主循环。在每次迭代中，我们将通过 OpenNI 捕获一帧，将其转换为典型的 OpenCV 格式（要么是 8 bpp 的灰度，要么是每个通道
    8 bpp 的 BGR），并通过 highgui 模块显示它。循环在用户按下任何键时结束。以下是实现代码：
- en: '[PRE20]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Note
  id: totrans-204
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: OpenCV's highgui module has many shortcomings. It does not allow for handling
    of a standard quit event, such as the clicking of a window's **X** button. Thus,
    we quit based on a keystroke instead. Also, highgui imposes a delay of at least
    1ms (but possibly more, depending on the operating system's minimum time to switch
    between threads) when polling events such as keystrokes. This delay should not
    matter for the purpose of demonstrating a camera with a low frame rate, such as
    the Xtion PRO Live with its 30 FPS limit. However, in the next section, *Supercharging
    the GS3-U3-23S6M-C and other Point Gray Research cameras*, we will explore SDL2
    as a more efficient alternative to highgui.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: OpenCV 的高级 GUI 模块存在许多不足。它不允许处理标准退出事件，例如点击窗口的 **X** 按钮。因此，我们基于按键来退出。此外，highgui
    在轮询事件（如按键）时至少会引入 1ms 的延迟（但可能更多，取决于操作系统在线程之间切换的最小时间）。对于演示低帧率相机（如具有 30 FPS 限制的 Xtion
    PRO Live）的目的，这种延迟不应产生影响。然而，在下一节“超级提升 GS3-U3-23S6M-C 和其他 Point Gray 研究相机”中，我们将探讨
    SDL2 作为比 highgui 更高效的替代方案。
- en: 'After the loop ends (due to the user pressing a key), we will clean up the
    window and all of OpenNI''s resources, as shown in the following code:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 在循环结束（由于用户按下键）后，我们将清理窗口和所有 OpenNI 资源，如下面的代码所示：
- en: '[PRE21]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: This is the end of the source code. On Windows, Infravision can be built as
    a Visual C++ Win32 Console Project in Visual Studio. Remember to right-click on
    the project and edit its **Project Properties** so that **C++** | **General**
    | **Additional Include Directories** lists the path to OpenCV's and OpenNI's `include`
    directories. Also, edit **Linker** | **Input** | **Additional Dependencies** so
    that it lists the paths to `opencv_core300.lib` and `opencv_imgproc300.lib` (or
    similarly named `lib` files for other OpenCV versions besides 3.0.0) as well as
    `OpenNI2.lib`. Finally, ensure that OpenCV's and OpenNI's `dll` files are in the
    system's `Path`.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 这标志着源代码的结束。在 Windows 上，Infravision 可以在 Visual Studio 中构建为 Visual C++ Win32 控制台项目。请记住右键单击项目并编辑其**项目属性**，以便**C++**
    | **通用** | **附加包含目录**列出 OpenCV 和 OpenNI 的 `include` 目录的路径。此外，编辑**链接器** | **输入**
    | **附加依赖项**，以便它列出 `opencv_core300.lib` 和 `opencv_imgproc300.lib`（或类似命名的 `lib`
    文件，用于除 3.0.0 之外的其他 OpenCV 版本）以及 `OpenNI2.lib` 的路径。最后，确保 OpenCV 和 OpenNI 的 `dll`
    文件位于系统的 `Path` 中。
- en: 'On Linux or Mac, Infravision can be compiled using a Terminal command such
    as the following (assuming that the `OPENNI2_INCLUDE` and `OPENNI2_REDIST` environment
    variables are defined as described earlier in this section):'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Linux 或 Mac 上，可以使用以下终端命令（假设 `OPENNI2_INCLUDE` 和 `OPENNI2_REDIST` 环境变量已按本节前面所述定义）编译
    Infravision：
- en: '[PRE22]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Note
  id: totrans-211
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The `-Wl,-R` flags specify an additional path where the executable should search
    for library files at runtime.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '`-Wl,-R` 标志指定了可执行文件在运行时搜索库文件的附加路径。'
- en: 'After building Infravision, run it and observe the pattern of NIR dots that
    the Xtion PRO Live projects onto nearby objects. When reflected from distant objects,
    the dots are sparsely spaced, but when reflected from nearby objects, they are
    densely spaced or even indistinguishable. Thus, the density of dots is a predictor
    of distance. Here is a screenshot showing the effect in a sunlit room where NIR
    light is coming from both the Xtion and the windows:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 在构建 Infravision 后，运行它并观察 Xtion PRO Live 投射到附近物体上的 NIR 点的模式。当从远处的物体反射时，点稀疏分布，但当从附近的物体反射时，点密集分布或甚至难以区分。因此，点的密度是距离的预测指标。以下是显示在阳光照射的房间中效果的截图，其中
    NIR 光来自 Xtion 和窗户：
- en: '![Supercharging the ASUS Xtion PRO Live and other OpenNI-compliant depth cameras](img/00005.jpeg)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![超级提升 ASUS Xtion PRO Live 和其他 OpenNI 兼容深度相机](img/00005.jpeg)'
- en: 'Alternatively, if you want to use the Xtion as a passive NIR camera, simply
    cover up the camera''s NIR emitter. Your fingers will not block all of the emitter''s
    light, but a piece of electrical tape will. Now, point the camera at a scene that
    has moderately bright NIR illumination. For example, the Xtion should be able
    to take a good passive NIR image in a sunlit room or beside a campfire at night.
    However, the camera will not cope well with a sunlit outdoor scene because this
    is vastly brighter than the conditions for which the device was designed. Here
    is a screenshot showing the same sunlit room as in the previous example but this
    time, the Xtion''s NIR emitter is covered up:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，如果你想将Xtion用作一个被动近红外相机，只需覆盖住相机的近红外发射器。你的手指不会完全阻挡发射器的光线，但一块电工胶带可以。现在，将相机对准一个中等亮度近红外照明的场景。例如，Xtion应该能够在阳光照射的房间里或夜晚篝火旁拍摄到良好的被动近红外图像。然而，相机在阳光明媚的户外场景中表现不佳，因为这与设备设计的条件相比要亮得多。以下是截图，显示了与上一个示例相同的阳光照射的房间，但这次Xtion的近红外发射器被覆盖了：
- en: '![Supercharging the ASUS Xtion PRO Live and other OpenNI-compliant depth cameras](img/00006.jpeg)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![增强ASUS Xtion PRO Live和其他OpenNI兼容深度相机](img/00006.jpeg)'
- en: Note that all the dots have disappeared and the new image looks like a relatively
    normal black-and-white photo. However, do any objects appear to have a strange
    glow?
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，所有的点都消失了，新的图像看起来像一张相对正常的黑白照片。然而，是否有任何物体看起来有奇怪的发光？
- en: 'Feel free to modify the code to use `SENSOR_DEPTH` or `SENSOR_COLOR` instead
    of `SENSOR_IR`. Recompile, rerun the application, and observe the effects. The
    depth sensor provides a depth map, which appears bright in nearby regions and
    dark in faraway regions or regions of unknown distance. The color sensor provides
    a normal-looking image based on the visible spectrum, as seen in the following
    screenshot of the same sunlit room:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 随意修改代码，使用`SENSOR_DEPTH`或`SENSOR_COLOR`而不是`SENSOR_IR`。重新编译，重新运行应用程序，并观察效果。深度传感器提供深度图，在附近的区域看起来较亮，而在远处的区域或未知距离的区域看起来较暗。颜色传感器提供基于可见光谱的正常外观图像，如下面的同一阳光照射的房间截图所示：
- en: '![Supercharging the ASUS Xtion PRO Live and other OpenNI-compliant depth cameras](img/00007.jpeg)'
  id: totrans-219
  prefs: []
  type: TYPE_IMG
  zh: '![增强ASUS Xtion PRO Live和其他OpenNI兼容深度相机](img/00007.jpeg)'
- en: Compare the previous two screenshots. Note that the leaves of the roses are
    much brighter in the NIR image. Moreover, the printed pattern on the footstool
    (beneath the roses) is invisible in the NIR image. (When designers choose pigments,
    they usually do not think about how the object will look in NIR!)
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 比较前两个截图。注意，玫瑰的叶子在近红外图像中要亮得多。此外，在玫瑰下面的脚凳上的印刷图案在近红外图像中是不可见的。（当设计师选择颜料时，他们通常不会考虑物体在近红外光下的外观！）
- en: Perhaps you want to use the Xtion as an active NIR imaging device—capable of
    night vision at short range—but you do not want the pattern of NIR dots. Just
    cover the illuminator with something to diffuse the NIR light, such as your fingers
    or a piece of fabric.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 可能你想将Xtion用作一个主动近红外成像设备——能够在短距离内进行夜视，但你不想看到近红外点的图案。只需用一些东西覆盖照明器以扩散近红外光，比如你的手指或一块布料。
- en: 'As an example of this diffused lighting, look at the following screenshot,
    showing a woman''s wrists in NIR:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 作为这种扩散照明的例子，看看以下截图，显示了女性手腕的近红外图像：
- en: '![Supercharging the ASUS Xtion PRO Live and other OpenNI-compliant depth cameras](img/00008.jpeg)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![增强ASUS Xtion PRO Live和其他OpenNI兼容深度相机](img/00008.jpeg)'
- en: Note that the veins are more distinguishable than they would be in visible light.
    Similarly, active NIR cameras have a superior ability to capture identifiable
    details in the iris of a person's eye, as demonstrated in [Chapter 6](part0052_split_000.html#1HIT82-940925703e144daa867f510896bffb69
    "Chapter 6. Efficient Person Identification Using Biometric Properties"), *Efficient
    Person Identification Using Biometric Properties*. Can you find other examples
    of things that look much different in the NIR and visible wavelengths?
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，静脉在可见光中比在近红外光中更容易辨认。同样，主动近红外相机在捕捉人眼虹膜中可识别的细节方面具有优越的能力，如[第6章](part0052_split_000.html#1HIT82-940925703e144daa867f510896bffb69
    "第6章。利用生物特征进行高效人员识别")中所示，*利用生物特征进行高效人员识别*。你能找到其他在近红外和可见光波长下看起来大不相同的事物的例子吗？
- en: By now, we have seen that OpenNI-compatible cameras can be configured (programmatically
    and physically) to take several kinds of images. However, these cameras are designed
    for a specific task—depth estimation in indoor scenes—and they do not necessarily
    cope well with alternative uses such as outdoor NIR imaging. Next, we will look
    at a more diverse, more configurable, and more expensive family of cameras.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经看到OpenNI兼容的相机可以通过编程和物理方式配置来捕捉多种类型的图像。然而，这些相机是为特定任务——室内场景中的深度估计——设计的，它们可能不适合其他用途，如户外近红外成像。接下来，我们将探讨一个更多样化、更可配置且更昂贵的相机系列。
- en: Supercharging the GS3-U3-23S6M-C and other Point Grey Research cameras
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为GS3-U3-23S6M-C和其他Point Grey Research相机提供超级加速
- en: 'Point Grey Research (PGR), a Canadian company, manufactures industrial cameras
    with a wide variety of features. A few examples are listed in the following table:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: Point Grey Research（PGR），一家加拿大公司，制造具有各种功能的工业相机。以下表格列出了一些例子：
- en: '| Family and Model | Price | Color Sensitivity | Highest Res Mode | Sensor
    Format and Lens Mount | Interface | Shutter |'
  id: totrans-228
  prefs: []
  type: TYPE_TB
  zh: '| Family and Model | Price | Color Sensitivity | Highest Res Mode | Sensor
    Format and Lens Mount | Interface | Shutter |'
- en: '| --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-229
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | ---'
- en: '| Firefly MVFMVU-03MTC-CS | $275 | Color | 752x480 @ 60 FPS | 1/3"CS mount
    | USB 2.0 | Global |'
  id: totrans-230
  prefs: []
  type: TYPE_TB
  zh: '| Firefly MVFMVU-03MTC-CS | $275 | 彩色 | 752x480 @ 60 FPS | 1/3"CS mount | USB
    2.0 | 全局'
- en: '| Firefly MVFMVU-03MTM-CS | $275 | Gray from visible light | 752x480 @ 60 FPS
    | 1/3"CS mount | USB 2.0 | Global |'
  id: totrans-231
  prefs: []
  type: TYPE_TB
  zh: '| Firefly MVFMVU-03MTM-CS | $275 | 由可见光产生的灰色 | 752x480 @ 60 FPS | 1/3"CS mount
    | USB 2.0 | 全局'
- en: '| Flea 3FL3-U3-88S2C-C | $900 | Color | 4096x2160 @ 21 FPS | 1/2.5"C mount
    | USB 3.0 | Rolling with global reset |'
  id: totrans-232
  prefs: []
  type: TYPE_TB
  zh: '| Flea 3FL3-U3-88S2C-C | $900 | 彩色 | 4096x2160 @ 21 FPS | 1/2.5"C mount | USB
    3.0 | 具有全局复位功能'
- en: '| Grasshopper 3GS3-U3-23S6C-C | $1,000 | Color | 1920x1200 @ 162 FPS | 1/1.2"C
    mount | USB 3.0 | Global |'
  id: totrans-233
  prefs: []
  type: TYPE_TB
  zh: '| Grasshopper 3GS3-U3-23S6C-C | $1,000 | 彩色 | 1920x1200 @ 162 FPS | 1/1.2"C
    mount | USB 3.0 | 全局'
- en: '| Grasshopper 3GS3-U3-23S6M-C | $1,000 | Gray from visible light | 1920x1200
    @ 162 FPS | 1/1.2"C mount | USB 3.0 | Global |'
  id: totrans-234
  prefs: []
  type: TYPE_TB
  zh: '| Grasshopper 3GS3-U3-23S6M-C | $1,000 | 由可见光产生的灰色 | 1920x1200 @ 162 FPS |
    1/1.2"C mount | USB 3.0 | 全局'
- en: '| Grasshopper 3GS3-U3-41C6C-C | $1,300 | Color | 2048x2048 @ 90 FPS | 1"C mount
    | USB 3.0 | Global |'
  id: totrans-235
  prefs: []
  type: TYPE_TB
  zh: '| Grasshopper 3GS3-U3-41C6C-C | $1,300 | 彩色 | 2048x2048 @ 90 FPS | 1"C mount
    | USB 3.0 | 全局'
- en: '| Grasshopper 3GS3-U3-41C6M-C | $1,300 | Gray from visible light | 2048x2048
    @ 90 FPS | 1"C mount | USB 3.0 | Global |'
  id: totrans-236
  prefs: []
  type: TYPE_TB
  zh: '| Grasshopper 3GS3-U3-41C6M-C | $1,300 | 由可见光产生的灰色 | 2048x2048 @ 90 FPS | 1"C
    mount | USB 3.0 | 全局'
- en: '| Grasshopper 3GS3-U3-41C6NIR-C | $1,300 | Gray from NIR light | 2048x2048
    @ 90 FPS | 1"C mount | USB 3.0 | Global |'
  id: totrans-237
  prefs: []
  type: TYPE_TB
  zh: '| Grasshopper 3GS3-U3-41C6NIR-C | $1,300 | 由近红外光产生的灰色 | 2048x2048 @ 90 FPS
    | 1"C mount | USB 3.0 | 全局'
- en: '| GazelleGZL-CL-22C5M-C | $1,500 | Gray from visible light | 2048x1088 @ 280
    FPS | 2/3"C mount | Camera Link | Global |'
  id: totrans-238
  prefs: []
  type: TYPE_TB
  zh: '| GazelleGZL-CL-22C5M-C | $1,500 | 由可见光产生的灰色 | 2048x1088 @ 280 FPS | 2/3"C
    mount | Camera Link | 全局'
- en: '| GazelleGZL-CL-41C6M-C | $2,200 | Gray from visible light | 2048x2048 @ 150
    FPS | 1"C mount | Camera Link | Global |'
  id: totrans-239
  prefs: []
  type: TYPE_TB
  zh: '| GazelleGZL-CL-41C6M-C | $2,200 | 由可见光产生的灰色 | 2048x2048 @ 150 FPS | 1"C mount
    | Camera Link | 全局'
- en: Note
  id: totrans-240
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: To browse the features of many more PGR cameras, see the company's Camera Selector
    tool at [http://www.ptgrey.com/Camera-selector](http://www.ptgrey.com/Camera-selector).
    For performance statistics about the sensors in PGR cameras, see the company's
    series of Camera Sensor Review publications such as the ones posted at [http://www.ptgrey.com/press-release/10545](http://www.ptgrey.com/press-release/10545).
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 要浏览更多PGR相机的功能，请查看公司提供的相机选择工具：[http://www.ptgrey.com/Camera-selector](http://www.ptgrey.com/Camera-selector)。有关PGR相机中传感器的性能统计信息，请参阅公司发布的相机传感器评论系列出版物，例如在[http://www.ptgrey.com/press-release/10545](http://www.ptgrey.com/press-release/10545)上发布的那些。
- en: For more information on sensor formats and lens mounts, see the *Shopping for
    glass* section, later in this chapter.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 关于传感器格式和镜头安装的更多信息，请参阅本章后面的“选购镜头”部分。
- en: Some of PGR's recent cameras use the Sony Pregius brand of sensors. This sensor
    technology is notable for its combination of high resolution, high frame rate,
    and efficiency, as described in PGR's white paper at [http://ptgrey.com/white-paper/id/10795](http://ptgrey.com/white-paper/id/10795).
    For example, the GS3-U3-23S6M-C (a monochrome camera) and GS3-U3-23S6C-C (a color
    camera) use a Pregius sensor called the Sony IMX174 CMOS. Thanks to the sensor
    and a fast USB 3.0 interface, these cameras are capable of capturing 1920x1200
    @ 162 FPS.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: PGR的一些最新相机使用索尼Pregius品牌的传感器。这种传感器技术以其高分辨率、高帧率和效率的组合而著称，如PGR在其白皮书[http://ptgrey.com/white-paper/id/10795](http://ptgrey.com/white-paper/id/10795)中所述。例如，GS3-U3-23S6M-C（单色相机）和GS3-U3-23S6C-C（彩色相机）使用名为索尼IMX174
    CMOS的Pregius传感器。得益于传感器和快速的USB 3.0接口，这些相机能够以1920x1200 @ 162 FPS的帧率捕捉图像。
- en: The code in this section is tested with the GS3-U3-23S6M-C camera. However,
    it should work with other PGR cameras, too. Being a monochrome camera, the GS3-U3-23S6M-C
    allows us to see the full potential of the sensor's resolution and efficiency,
    without any color filter.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中的代码已在GS3-U3-23S6M-C相机上进行了测试。然而，它也应该适用于其他PGR相机。作为一个单色相机，GS3-U3-23S6M-C使我们能够看到传感器的分辨率和效率的完整潜力，而不需要任何颜色滤镜。
- en: The GS3-U3-23S6M-C, like most PGR cameras, does not come with a lens; rather,
    it uses a standard C mount for interchangeable lenses. Examples of low-cost lenses
    for this mount are discussed later in this chapter, in the section *Shopping for
    glass*.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: GS3-U3-23S6M-C与大多数PGR相机一样，不附带镜头；而是使用标准C型接口来安装可互换镜头。本章后面的*购物指南*部分将讨论这种接口的低成本镜头示例。
- en: The GS3-U3-23S6M-C requires a USB 3.0 interface. For a desktop computer, a USB
    3.0 interface can be added via a PCIe expansion card, which might cost between
    $15 and $60\. PGR sells PCIe expansion cards that are guaranteed to work with
    its cameras; however, I have had success with other brands, too.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: GS3-U3-23S6M-C需要USB 3.0接口。对于台式电脑，可以通过PCIe扩展卡添加USB 3.0接口，这可能需要花费15到60美元。PGR销售保证与其相机兼容的PCIe扩展卡；然而，我也使用过其他品牌并取得了成功。
- en: 'Once we are armed with the necessary hardware, we need to obtain an application
    called FlyCapture2 for configuring and testing our PGR camera. Along with this
    application, we will obtain FlyCapture2 SDK, which is a complete programming interface
    for all the functionality of our PGR camera. Go to [http://www.ptgrey.com/support/downloads](http://www.ptgrey.com/support/downloads)
    and download the relevant installer. (You will be prompted to register a user
    account if you have not already done so.) At the time of writing, the relevant
    download links have the following names:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们配备了必要的硬件，我们需要获取一个名为FlyCapture2的应用程序来配置和测试我们的PGR相机。与此应用程序一起，我们将获得FlyCapture2
    SDK，这是我们PGR相机所有功能的完整编程接口。请访问[http://www.ptgrey.com/support/downloads](http://www.ptgrey.com/support/downloads)并下载相关的安装程序。（如果您尚未注册用户账户，您将被提示注册。）在撰写本文时，相关的下载链接具有以下名称：
- en: FlyCapture 2.8.3.1 SDK - Windows (64-bit)
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FlyCapture 2.8.3.1 SDK - Windows (64-bit)
- en: FlyCapture 2.8.3.1 SDK- Windows (32-bit)
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FlyCapture 2.8.3.1 SDK - Windows (32-bit)
- en: FlyCapture 2.8.3.1 SDK- Linux Ubuntu (64-bit)
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FlyCapture 2.8.3.1 SDK - Linux Ubuntu (64-bit)
- en: FlyCapture 2.8.3.1 SDK- Linux Ubuntu (32-bit)
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FlyCapture 2.8.3.1 SDK - Linux Ubuntu (32-bit)
- en: FlyCapture 2.8.3.1 SDK- ARM Hard Float
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FlyCapture 2.8.3.1 SDK - ARM Hard Float
- en: Note
  id: totrans-253
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: PGR does not offer an application or SDK for Mac. However, in principle, third-party
    applications or SDKs might be able use PGR cameras on Mac, as most PGR cameras
    are compliant with standards such as IIDC/DCAM.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: PGR不提供适用于Mac的应用程序或SDK。然而，原则上，第三方应用程序或SDK可能能够使用PGR相机在Mac上运行，因为大多数PGR相机都符合IIDC/DCAM等标准。
- en: For Windows, run the installer that you downloaded. If in doubt, choose a **Complete**
    installation when prompted. A shortcut, **Point Grey FlyCap2**, should appear
    in your **Start** menu.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Windows，运行您下载的安装程序。如果不确定，当提示时选择**完整**安装。一个快捷方式，**Point Grey FlyCap2**，应该出现在您的**开始**菜单中。
- en: For Linux, decompress the downloaded archive. Follow the installation instructions
    in the README file (inside the decompressed folder). A launcher, **FlyCap2**,
    should appear in your applications menu.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Linux，解压缩下载的存档。按照解压缩文件夹中的README文件中的安装说明进行操作。一个启动器，**FlyCap2**，应该出现在您的应用程序菜单中。
- en: 'After installation, plug in your PGR camera and open the application. You should
    see a window entitled **FlyCapture2 Camera Selection**, as in the following screenshot:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，请插入您的PGR相机并打开应用程序。您应该会看到一个标题为**FlyCapture2相机选择**的窗口，如下面的截图所示：
- en: '![Supercharging the GS3-U3-23S6M-C and other Point Grey Research cameras](img/00009.jpeg)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![为GS3-U3-23S6M-C和其他Point Grey Research相机加速](img/00009.jpeg)'
- en: 'Ensure that your camera is selected and then click the **Configure Selected**
    button. Another window should appear. Its title includes the camera name, such
    as **Point Grey Research Grasshopper3 GS3-U3-23S6M**. All the camera''s settings
    can be configured in this window. I find that the **Camera Video Modes** tab is
    particularly useful. Select it. You should see options relating to the capture
    mode, pixel format, cropped region (called **region of interest** or **ROI**),
    and data transfer, as shown in the following screenshot:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 确保您的相机已选中，然后点击**配置所选**按钮。应该会出现另一个窗口。其标题包括相机名称，例如**Point Grey Research Grasshopper3
    GS3-U3-23S6M**。所有相机设置都可以在这个窗口中配置。我发现**相机视频模式**标签页特别有用。选择它。您应该会看到有关捕获模式、像素格式、裁剪区域（称为**感兴趣区域**或**ROI**）和数据传输的选项，如下面的截图所示：
- en: '![Supercharging the GS3-U3-23S6M-C and other Point Grey Research cameras](img/00010.jpeg)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![为GS3-U3-23S6M-C和其他Point Grey Research相机加速](img/00010.jpeg)'
- en: 'For more information about the available modes and other settings, refer to
    the camera''s Technical Reference Manual, which can be downloaded from [http://www.ptgrey.com/support/downloads](http://www.ptgrey.com/support/downloads).
    Do not worry that you might permanently mess up any settings; they are reset every
    time you unplug the camera. When you are satisfied with the settings, click **Apply**
    and close the window. Now, in the **Camera Selection** window, click the **OK**
    button. On Linux, the FlyCapture2 application exits now. On Windows, we should
    see a new window, which also has the camera''s name in its title bar. This window
    displays a live video feed and statistics. To ensure that the whole video is visible,
    select the menu option **View** | **Stretched To Fit**. Now, you should see the
    video letterboxed inside the window, as in the following screenshot:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 关于可用模式和其它设置的更多信息，请参阅相机的技术参考手册，可以从[http://www.ptgrey.com/support/downloads](http://www.ptgrey.com/support/downloads)下载。请不要担心您可能会永久损坏任何设置；每次您拔掉相机时，它们都会重置。当您对设置满意时，点击**应用**并关闭窗口。现在，在**相机选择**窗口中，点击**确定**按钮。在Linux上，FlyCapture2应用程序现在退出。在Windows上，我们应该看到一个新窗口，其标题栏中也包含相机的名称。此窗口显示实时视频流和统计数据。为了确保整个视频可见，选择菜单选项**视图**|**拉伸以适应**。现在，您应该会看到视频在窗口内以信封式显示，如下面的截图所示：
- en: '![Supercharging the GS3-U3-23S6M-C and other Point Grey Research cameras](img/00011.jpeg)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![为GS3-U3-23S6M-C和其他Point Grey Research相机加速](img/00011.jpeg)'
- en: 'If the video looks corrupted (for example, if you see pieces of multiple frames
    at one time), the most likely reason is that the host computer is failing to handle
    the data transfer at a sufficiently high speed. There are two possible approaches
    to solving this problem:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 如果视频看起来损坏（例如，如果您一次看到多个帧的片段），最可能的原因是主机计算机无法以足够高的速度处理数据传输。有两种可能的方法可以解决这个问题：
- en: We can transfer less data. For example, go back to the **Camera Video Modes**
    tab of the configuration window and select either a smaller region of interest
    or a mode with a lower resolution.
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以传输更少的数据。例如，回到配置窗口的**相机视频模式**标签页，选择一个较小的感兴趣区域或分辨率较低的模式。
- en: 'We can configure the operating system and BIOS to give high priority to the
    task of processing incoming data. For details, see the following Technical Application
    Note (TAN) by PGR: [http://www.ptgrey.com/tan/10367](http://www.ptgrey.com/tan/10367).'
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以配置操作系统和BIOS，将处理传入数据任务的高优先级。有关详细信息，请参阅PGR的以下技术应用笔记（TAN）：[http://www.ptgrey.com/tan/10367](http://www.ptgrey.com/tan/10367)。
- en: Feel free to experiment with other features of the FlyCapture2 application,
    such as video recording. When you are done, close the application.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 随意尝试FlyCapture2应用程序的其他功能，例如视频录制。完成后，关闭应用程序。
- en: Now that we have seen a PGR camera in action, let us write our own application
    to capture and display frames at high speed. It will support both Windows and
    Linux. We will call this application LookSpry. ("Spry" means quick, nimble, or
    lively, and a person who possesses these qualities is said to "look spry". If
    our high-speed camera application were a person, we might describe it this way.)
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经看到了PGR相机的实际应用，让我们编写自己的应用程序来以高速捕获和显示帧。它将支持Windows和Linux。我们将把这个应用程序命名为LookSpry。（“Spry”意味着敏捷、灵活或活泼，拥有这些特质的人被称为“看起来敏捷”。如果我们的高速相机应用程序是一个人，我们可能会这样描述它。）
- en: Note
  id: totrans-268
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: LookSpry's source code and build files are in this book's GitHub repository
    at [https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/LookSpry](https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/LookSpry).
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: LookSpry 的源代码和构建文件可以在本书的 GitHub 仓库中找到，网址为 [https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/LookSpry](https://github.com/OpenCVBlueprints/OpenCVBlueprints/tree/master/chapter_1/LookSpry)。
- en: 'Like our other demos in this chapter, LookSpry can be implemented in a single
    source file, `LookSpry.cpp`. To begin the implementation, we need to import some
    of the C standard library''s functionality, including string formatting and timing:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 与本章中我们的其他演示一样，LookSpry 可以在一个源文件 `LookSpry.cpp` 中实现。要开始实现，我们需要导入 C 标准库的一些功能，包括字符串格式化和计时：
- en: '[PRE23]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'LookSpry will use three additional libraries: **FlyCapture2 SDK** (**FC2)**,
    OpenCV, and **Simple DirectMedia Layer 2** (**SDL2)**. (SDL2 is a cross-platform
    hardware abstraction layer for writing multimedia applications.) From OpenCV,
    we will use the core and imgproc modules for basic image manipulation, as well
    as the objdetect module for face detection. The role of face detection in this
    demo is simply to show that we can perform a real computer vision task with high-resolution
    input and a high frame rate. Here are the relevant import statements:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: LookSpry 将使用三个额外的库：**FlyCapture2 SDK**（**FC2**）、OpenCV 和 **Simple DirectMedia
    Layer 2**（**SDL2**）。（SDL2 是用于编写多媒体应用的跨平台硬件抽象层。）从 OpenCV 中，我们将使用核心和 imgproc 模块进行基本的图像处理，以及
    objdetect 模块进行人脸检测。在这个演示中，人脸检测的作用仅仅是展示我们可以使用高分辨率输入和高帧率执行真正的计算机视觉任务。以下是相关的导入语句：
- en: '[PRE24]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Note
  id: totrans-274
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: FC2 is closed-source but owners of PGR cameras receive a license to use it.
    The library's documentation can be found in the installation directory.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: FC2 是闭源软件，但 PGR 相机所有者可以获得使用它的许可证。库的文档可以在安装目录中找到。
- en: SDL2 is open-source under the zlib license. The library's documentation can
    be found online at [https://wiki.libsdl.org](https://wiki.libsdl.org).
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: SDL2 在 zlib 许可下是开源的。库的文档可以在网上找到，网址为 [https://wiki.libsdl.org](https://wiki.libsdl.org)。
- en: 'Throughout LookSpry, we use a string formatting function—either `sprintf_s`
    in the Microsoft Visual C libraries or `snprintf` in standard C libraries. For
    our purposes, the two functions are equivalent. We will use the following macro
    definition so that `snprintf` is mapped to `sprintf_s` on Windows:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 在 LookSpry 的整个过程中，我们使用一个字符串格式化函数——要么是 Microsoft Visual C 库中的 `sprintf_s`，要么是标准
    C 库中的 `snprintf`。对于我们的目的，这两个函数是等效的。我们将使用以下宏定义，以便在 Windows 上将 `snprintf` 映射到 `sprintf_s`：
- en: '[PRE25]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'At several points, the application can potentially encounter an error while
    calling functions in FlyCapture2 or SDL2\. Such an error should be shown in a
    dialog box. The two following helper functions get and show the relevant error
    message from FC2 or SDL2:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 在几个点上，应用程序在调用 FlyCapture2 或 SDL2 中的函数时可能会遇到错误。这种错误应该在对话框中显示。以下两个辅助函数从 FC2 或
    SDL2 获取并显示相关的错误消息：
- en: '[PRE26]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The rest of LookSpry is simply implemented in a `main` function. At the start
    of the function, we will define several constants that we might want to configure,
    including the parameters of image capture, face detection, frame rate measurement,
    and display:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: LookSpry 的其余部分简单地实现在 `main` 函数中。在函数的开始，我们将定义几个可能需要配置的常量，包括图像捕获、人脸检测、帧率测量和显示的参数：
- en: '[PRE27]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'We will declare an image format, which will help OpenCV interpret captured
    image data. (A value will be assigned to this variable later, when we start capturing
    images.) We will also declare an OpenCV matrix that will store an equalized, grayscale
    version of the captured image. The declarations are as follows:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将声明一个图像格式，这将帮助 OpenCV 解释捕获的图像数据。（当开始捕获图像时，将为此变量分配一个值。）我们还将声明一个 OpenCV 矩阵，它将存储捕获图像的均衡、灰度版本。声明如下：
- en: '[PRE28]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Note
  id: totrans-285
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Equalization is a kind of contrast adjustment that makes all levels of brightness
    equally common in the output image. This adjustment makes a subject's appearance
    more stable with respect to variations in lighting. Thus, it is common practice
    to equalize an image before attempting to detect or recognize subjects (such as
    faces) in it.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 均衡是一种对比度调整，它使输出图像中所有亮度级别都同样常见。这种调整使主题的外观在光照变化方面更加稳定。因此，在尝试检测或识别图像中的主题（如人脸）之前，通常会对图像进行均衡。
- en: 'For face detection, we will create a `CascadeClassifier` object (from OpenCV''s
    objdetect module). The classifier loads a cascade file, for which we must specify
    an absolute path on Windows or a relative path on Unix. The following code constructs
    the path, the classifier, and a vector in which face detection results will be
    stored:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 对于人脸检测，我们将创建一个`CascadeClassifier`对象（来自OpenCV的objdetect模块）。分类器加载一个级联文件，对于Windows系统，我们必须指定一个绝对路径；对于Unix系统，则指定一个相对路径。以下代码构建了路径、分类器和用于存储人脸检测结果的向量：
- en: '[PRE29]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Now, we must set up several things related to FlyCapture2\. First, the following
    code creates an image header that will receive captured data and metadata:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们必须设置与FlyCapture2相关的一些事情。首先，以下代码创建了一个图像头，它将接收捕获的数据和元数据：
- en: '[PRE30]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'The following code creates an FC2 context, which is responsible for querying,
    connecting to, and capturing from available cameras:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码创建了一个FC2上下文，它负责查询、连接和从可用的摄像头捕获：
- en: '[PRE31]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'The following lines use the context to fetch the identifier of the camera with
    the specified index:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 以下行使用上下文获取指定索引的摄像头的标识符：
- en: '[PRE32]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'We connect to the camera:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 我们连接到摄像头：
- en: '[PRE33]'
  id: totrans-296
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'We finish our initialization of FC2 variables by starting the capture session:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过启动捕获会话来完成FC2变量的初始化：
- en: '[PRE34]'
  id: totrans-298
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Our use of SDL2 also requires several initialization steps. First, we must
    load the library''s main module and video module, as seen in the following code:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用SDL2也需要几个初始化步骤。首先，我们必须加载库的主模块和视频模块，如下所示：
- en: '[PRE35]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Next, in the following code, we create a window with a specified title and
    size:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在以下代码中，我们创建了一个具有指定标题和大小的窗口：
- en: '[PRE36]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'We will create a renderer that is capable of drawing textures (image data)
    to the window''s surface. The parameters in the following code permit SDL2 to
    select any rendering device and any optimizations:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将创建一个渲染器，能够将纹理（图像数据）绘制到窗口表面。以下代码中的参数允许SDL2选择任何渲染设备和任何优化：
- en: '[PRE37]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Next, we will query the renderer to see which rendering backend was selected
    by SDL2\. The possibilities include Direct3D, OpenGL, and software rendering.
    Depending on the back-end, we might request a high-quality scaling mode so that
    the video does not appear pixelated when we scale it. Here is the code for querying
    and configuring the renderer:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将查询渲染器以查看SDL2选择了哪个渲染后端。可能包括Direct3D、OpenGL和软件渲染。根据后端，我们可能需要请求高质量的缩放模式，以便在缩放视频时不会出现像素化。以下是查询和配置渲染器的代码：
- en: '[PRE38]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'To provide feedback to the user, we will display the name of the rendering
    backend in the window''s title bar:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 为了向用户提供反馈，我们将在窗口标题栏中显示渲染后端的名称：
- en: '[PRE39]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'We will declare variables relating to the image data rendered each frame. SDL2
    uses a texture as an interface to these data:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将声明与每一帧渲染的图像数据相关的变量。SDL2使用纹理作为这些数据的接口：
- en: '[PRE40]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'We will also declare variables relating to frame rate measurements:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将声明与帧率测量相关的变量：
- en: '[PRE41]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Three more variables will track the application''s state—whether it should
    continue running, whether it should be detecting faces, and whether it should
    be mirroring the image (flipping it horizontally) for display. Here are the relevant
    declarations:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 另外三个变量将跟踪应用程序的状态——是否应该继续运行，是否应该检测人脸，以及是否应该镜像图像（水平翻转）以进行显示。以下是相关声明：
- en: '[PRE42]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Now, we are ready to enter the application''s main loop. On each iteration,
    we poll the SDL2 event queue for any and all events. A quit event (which arises,
    for example, when the window''s close button is clicked) causes the `running`
    flag to be cleared and the `main` loop to exit at the iteration''s end. When the
    user presses *D* or *M*, respectively, the `detecting` or `mirroring` flag is
    negated. The following code implements the event handling logic:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们准备进入应用程序的主循环。在每次迭代中，我们轮询SDL2事件队列以获取任何事件。退出事件（例如，当点击窗口的关闭按钮时）会导致`running`标志被清除，并在迭代结束时退出`main`循环。当用户按下*D*或*M*时，`detecting`或`mirroring`标志将被反转。以下代码实现了事件处理逻辑：
- en: '[PRE43]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Still in the main loop, we attempt to retrieve the next image from the camera.
    The following code does this synchronously:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 仍然在主循环中，我们尝试从摄像头获取下一张图像。以下代码以同步方式执行此操作：
- en: '[PRE44]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Tip
  id: totrans-319
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Given the high throughput of the GS3-U3-23S6M-C and many other Point Grey cameras,
    synchronous capture is justifiable here. Images are coming in so quickly that
    we can expect zero or negligible wait time until a buffered frame is available.
    Thus, the user will not experience any perceptible lag in the processing of events.
    However, FC2 also offers asynchronous capture, with a callback, via the `fc2SetCallbck`
    function. The asynchronous option might be better for low-throughput cameras and,
    in this case, capture and rendering would not occur in the same loop as event
    polling.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到GS3-U3-23S6M-C和其他许多Point Grey相机的较高吞吐量，同步捕获在这里是合理的。图像来得如此之快，以至于我们可以预期在缓冲帧可用之前几乎没有或可以忽略不计的等待时间。因此，用户在事件处理过程中不会体验到任何可感知的延迟。然而，FC2也提供了通过`fc2SetCallbck`函数的回调异步捕获。对于低吞吐量相机，这种异步选项可能更好，在这种情况下，捕获和渲染不会在事件轮询的同一循环中发生。
- en: 'If we have just captured the first frame in this run of the application, we
    still need to initialize several variables; for example, the texture is `NULL`.
    Based on the captured image''s dimensions, we can set the size of the equalized
    matrix and of the renderer''s (pre-scaling) buffer, as seen in the following code:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们刚刚捕获了应用程序这次运行的第一帧，我们仍然需要初始化几个变量；例如，纹理是`NULL`。根据捕获图像的尺寸，我们可以设置均衡矩阵和渲染器（预缩放）缓冲区的大小，如下面的代码所示：
- en: '[PRE45]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Based on the captured image''s pixel format, we can select closely matching
    formats for OpenCV matrices and for the SDL2 texture. For monochrome capture—and
    raw capture, which we assume to be monochrome—we will use single-channel matrices
    and a YUV texture (specifically, the Y channel). The following code handles the
    relevant cases:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 根据捕获图像的像素格式，我们可以选择与OpenCV矩阵和SDL2纹理紧密匹配的格式。对于单色捕获——以及我们假设为单色的原始捕获——我们将使用单通道矩阵和YUV纹理（具体来说，是Y通道）。以下代码处理相关情况：
- en: '[PRE46]'
  id: totrans-324
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'For color capture in YUV, RGB, or BGR format, we select a matching texture
    format and a number of matrix channels based on the format''s bytes per pixel:'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 对于YUV、RGB或BGR格式的彩色捕获，我们将根据格式每像素的字节数选择匹配的纹理格式和矩阵通道数：
- en: '[PRE47]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Some capture formats, including those with 16 bpp per channel, are not currently
    supported in LookSpry and are considered failure cases, as seen in the following
    code:'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 一些捕获格式，包括每通道16 bpp的格式，目前在LookSpry中不受支持，被视为失败案例，如下面的代码所示：
- en: '[PRE48]'
  id: totrans-328
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'We will create a texture with the given format and the same size as the captured
    image:'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将创建一个具有给定格式和与捕获图像相同大小的纹理：
- en: '[PRE49]'
  id: totrans-330
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Using the following code, let''s update the window''s title bar to show the
    pixel dimensions of the captured image and the rendered image, in pixels:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下代码，让我们更新窗口标题栏以显示捕获图像和渲染图像的像素尺寸，以像素为单位：
- en: '[PRE50]'
  id: totrans-332
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Next, if the application is in its face detection mode, we will convert the
    image to an equalized, grayscale version, as seen in the following code:'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，如果应用程序处于人脸检测模式，我们将图像转换为均衡的灰度版本，如下面的代码所示：
- en: '[PRE51]'
  id: totrans-334
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'We will perform face detection on the equalized image. Then, in the original
    image, we will draw rectangles around any detected faces:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在均衡图像上执行人脸检测。然后，在原始图像中，我们将围绕任何检测到的人脸绘制矩形：
- en: '[PRE52]'
  id: totrans-336
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'At this stage, we have finished our computer vision task for this frame and
    we need to consider our output task. The image data are destined to be copied
    to the texture and then rendered. First, we will lock the texture, meaning that
    we will obtain write access to its memory. This is accomplished in the following
    SDL2 function call:'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，我们已经完成了这一帧的计算机视觉任务，需要考虑我们的输出任务。图像数据将被复制到纹理中，然后进行渲染。首先，我们将锁定纹理，这意味着我们将获得对其内存的写入访问权。这通过以下SDL2函数调用完成：
- en: '[PRE53]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Remember, if the camera is in a monochrome capture mode (or a raw mode, which
    we assume to be monochrome), we are using a YUV texture. We need to fill the U
    and V channels with the mid-range value, 128, to ensure that the texture is gray.
    The following code accomplishes this efficiently by using the `memset` function
    from the C standard library:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，如果相机处于单色捕获模式（或我们假设为单色的原始模式），我们正在使用YUV纹理。我们需要用中间值128填充U和V通道，以确保纹理是灰度的。以下代码通过使用C标准库中的`memset`函数有效地完成此操作：
- en: '[PRE54]'
  id: totrans-340
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Now, we are ready to copy the image data to the texture. If the `mirroring`
    flag is set, we will copy and mirror the data at the same time. To accomplish
    this efficiently, we will wrap the destination array in an OpenCV `Mat` and then
    use OpenCV''s `flip` function to flip and copy the data simultaneously. Alternatively,
    if the `mirroring` flag is not set, we will simply copy the data using the standard
    C `memcpy` function. The following code implements these two alternatives:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们已经准备好将图像数据复制到纹理中。如果设置了`mirroring`标志，我们将同时复制和镜像数据。为了高效地完成这项任务，我们将目标数组包装在OpenCV的`Mat`中，然后使用OpenCV的`flip`函数同时翻转和复制数据。如果未设置`mirroring`标志，我们将简单地使用标准的C
    `memcpy`函数复制数据。以下代码实现了这两种替代方案：
- en: '[PRE55]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: Tip
  id: totrans-343
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'Typically, the `memcpy` function (from the C standard library) compiles to
    block transfer instructions, meaning that it provides the best possible hardware
    acceleration for copying large arrays. However, it does not support any modification
    or reordering of data while copying. An article by David Nadeau benchmarks `memcpy`
    against four other copying techniques, using four compilers for each technique
    , and can be found at: [http://nadeausoftware.com/articles/2012/05/c_c_tip_how_copy_memory_quickly](http://nadeausoftware.com/articles/2012/05/c_c_tip_how_copy_memory_quickly).'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，`memcpy`函数（来自C标准库）编译为块传输指令，这意味着它为复制大型数组提供了最佳可能的硬件加速。然而，它不支持在复制过程中对数据进行修改或重新排序。David
    Nadeau的一篇文章对`memcpy`与四种其他复制技术进行了基准测试，每种技术使用四个编译器，可以在以下位置找到：[http://nadeausoftware.com/articles/2012/05/c_c_tip_how_copy_memory_quickly](http://nadeausoftware.com/articles/2012/05/c_c_tip_how_copy_memory_quickly)。
- en: 'Now that we have written the frame''s data to the texture, we will unlock the
    texture (potentially causing data to be uploaded to the GPU) and we will tell
    the renderer to render it:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经将帧的数据写入纹理，我们将解锁纹理（可能会将数据上传到GPU），并告诉渲染器渲染它：
- en: '[PRE56]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'After a specified number of frames, we will update our FPS measurement and
    display it in the window''s title bar, as seen in the following code:'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 在指定数量的帧之后，我们将更新我们的FPS测量值，并在窗口标题栏中显示它，如下面的代码所示：
- en: '[PRE57]'
  id: totrans-348
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'There is nothing more in the application''s main loop. Once the loop ends (as
    a result of the user closing the window), we will clean up FC2 and SDL2 resources
    and exit:'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序的主循环中没有其他内容。一旦循环结束（由于用户关闭窗口），我们将清理FC2和SDL2资源并退出：
- en: '[PRE58]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: On Windows, LookSpry can be built as a Visual C++ Win32 Console Project in Visual
    Studio. Remember to right-click on the project and edit its **Project Properties**
    so that **C++** | **General** | **Additional Include Directories** lists the paths
    to OpenCV's, FlyCapture 2's, and SDL 2's `include` directories. Similarly, edit
    **Linker** | **Input** | **Additional Dependencies** so that it lists the paths
    to `opencv_core300.lib`, `opencv_imgproc300.lib`, and `opencv_objdetect300.lib`
    (or similarly named `lib` files for other OpenCV versions besides 3.0.0) as well
    as `FlyCapture2_C.lib`, `SDL2.lib`, and `SDL2main.lib`. Finally, ensure that OpenCV's
    `dll` files are in the system's `Path`.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows上，可以在Visual Studio中将LookSpry构建为Visual C++ Win32控制台项目。请记住，右键单击项目并编辑其**项目属性**，以便**C++**
    | **通用** | **附加包含目录**列出OpenCV的、FlyCapture 2的以及SDL 2的`include`目录的路径。同样，编辑**链接器**
    | **输入** | **附加依赖项**，以便它列出`opencv_core300.lib`、`opencv_imgproc300.lib`和`opencv_objdetect300.lib`（或3.0.0以外的其他OpenCV版本的类似命名的`lib`文件）以及`FlyCapture2_C.lib`、`SDL2.lib`和`SDL2main.lib`的路径。最后，确保OpenCV的`dll`文件在系统的`Path`中。
- en: 'On Linux, a Terminal command such as the following should succeed in building
    LookSpry:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux上，以下终端命令应该可以成功构建LookSpry：
- en: '[PRE59]'
  id: totrans-353
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Ensure that the GS3-U3-23S6M-C camera (or another PGR camera) is plugged in
    and that it is properly configured using the FlyCap2 GUI application. Remember
    that the configuration is reset whenever the camera is unplugged.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 确保GS3-U3-23S6M-C相机（或另一个PGR相机）已连接，并且已使用FlyCap2 GUI应用程序正确配置。请记住，每次拔掉相机时都会重置配置。
- en: Note
  id: totrans-355
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: All the camera settings in the FlyCap2 GUI application can also be set programmatically
    via the FlyCapture2 SDK. Refer to the official documentation and samples that
    come with the SDK.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: FlyCap2 GUI应用程序中的所有相机设置也可以通过FlyCapture2 SDK进行编程设置。请参阅SDK的官方文档和示例。
- en: When you are satisfied with the camera's configuration, close the FlyCap2 GUI
    application and run LookSpry. Try different image processing modes by pressing
    *M* to un-mirror or mirror the video and *D* to stop or restart detection. How
    many frames per second are processed in each mode? How is the frame rate in detection
    mode affected by the number of faces?
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 当你对相机的配置满意时，关闭FlyCap2 GUI应用程序并运行LookSpry。通过按*M*键取消镜像或镜像视频，按*D*键停止或重新启动检测来尝试不同的图像处理模式。每种模式下每秒处理多少帧？检测模式中的帧率如何受人脸数量的影响？
- en: '![Supercharging the GS3-U3-23S6M-C and other Point Grey Research cameras](img/00012.jpeg)'
  id: totrans-358
  prefs: []
  type: TYPE_IMG
  zh: '![为GS3-U3-23S6M-C和其他Point Grey Research相机加速](img/00012.jpeg)'
- en: Hopefully, you have observed that in some or all modes, LookSpry processes frames
    at a much faster rate than a typical monitor's 60Hz refresh rate. The real-time
    video would look even smoother if we viewed it on a high-quality 144Hz gaming
    monitor. However, even if the refresh rate is a bottleneck, we can still appreciate
    the low latency or responsiveness of this real-time video.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 希望你已经观察到，在某些或所有模式下，LookSpry处理帧的速度比典型显示器的60Hz刷新率快得多。如果我们在一个高质量的144Hz游戏显示器上观看实时视频，它看起来会更加平滑。然而，即使刷新率是瓶颈，我们仍然可以欣赏到这种实时视频的低延迟或响应速度。
- en: Since the GS3-U3-23S6M-C and other PGR cameras take interchangeable, C-mount
    lenses, we should now educate ourselves about the big responsibility of buying
    a lens!
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 由于GS3-U3-23S6M-C和其他PGR相机使用可互换的C口镜头，我们现在应该学习如何承担购买镜头的重大责任！
- en: Shopping for glass
  id: totrans-361
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 玻璃的采购
- en: There is nothing quite like a well-crafted piece of glass that has survived
    many years and continued to sparkle because someone cared for it. On the mantle
    at home, my parents have a few keepsakes like this. One of them—a little, colorful
    glass flower—comes from a Parisian shopping mall where my brother and I ate many
    cheap but good meals during our first trip away from home and family. Other pieces
    go back earlier than I remember.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 没有什么能比得上一件经过多年岁月考验且因有人呵护而继续闪耀的精心制作的玻璃制品。在我家的壁炉架上，我父母有一些这样的纪念品。其中之一是一朵小小的彩色玻璃花，它来自巴黎的一个购物中心，我和哥哥在我们第一次离家和家人的旅行中在那里吃了许多便宜但美味的饭菜。其他物品比我记得还要早。
- en: Some of the secondhand lenses that I use are 30 or 40 years old; their country
    of manufacture no longer exists; yet their glass and coatings are in perfect condition.
    I like to think that these lenses earned such good care by taking many fine pictures
    for previous owners and that they might still be taking fine pictures for somebody
    else 40 years from now.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 我使用的一些二手镜头已有30或40年的历史；它们的制造国家已不复存在；然而，它们的玻璃和涂层仍然处于完美状态。我喜欢想这些镜头通过为前任主人拍摄许多精美的照片而赢得了如此好的照顾，也许它们在40年后仍然能为其他人拍摄精美的照片。
- en: Glass lasts. So do lens designs. For example, the Zeiss Planar T* lenses, one
    of the most respected names in the trade, are based on optical designs from the
    1890s and coating processes from the 1930s. Lenses have gained electronic and
    motorized components to support autoexposure, autofocus, and image stabilization.
    However, the evolution of optics and coatings has been relatively slow. Mechanically,
    many old lenses are excellent.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 玻璃持久耐用。镜头设计也是如此。例如，蔡司Planar T*镜头，这个行业中最受尊敬的品牌之一，其光学设计始于19世纪90年代，涂层工艺始于20世纪30年代。镜头增加了电子和电动组件以支持自动曝光、自动对焦和图像稳定。然而，光学和涂层的进化相对缓慢。从机械角度来看，许多老镜头都非常出色。
- en: Tip
  id: totrans-365
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**Chromatic and spherical aberrations**'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: '**色差和球差**'
- en: An ideal lens causes all incoming rays of light to converge at one focal point.
    However, real lenses suffer from aberrations, such that the rays do not converge
    at precisely the same point. If different colors or wavelengths converge at different
    points, the lens suffers from **chromatic aberrations**, which are visible in
    the image as colorful haloes around high-contrast edges. If rays from the center
    and edge of the lens converge at different points, the lens suffers from **spherical
    aberrations**, which appear in the image as bright haloes around high-contrast
    edges in out-of-focus regions.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 理想镜头会使所有入射光线汇聚到一个焦点。然而，实际镜头存在像差，光线不会精确地汇聚到同一个点。如果不同颜色或波长的光线汇聚到不同的点，镜头就会产生**色差**，这在图像中表现为高对比度边缘周围的彩色光环。如果来自镜头中心和边缘的光线汇聚到不同的点，镜头就会产生**球差**，这在图像中表现为在失焦区域高对比度边缘周围的明亮光环。
- en: Starting in the 1970s, new manufacturing techniques have allowed for better
    correction of chromatic and spherical aberrations in high-end lenses. Apochromatic
    or "APO" lenses use highly refractive materials (often, rare earth elements) to
    correct chromatic aberrations. Aspherical or "ASPH" lenses use complex curves
    to correct spherical aberrations. These corrected lenses tend to be more expensive,
    but you should keep an eye out for them as they may sometimes appear at bargain
    prices.
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 从20世纪70年代开始，新的制造技术使得高端镜头在色差和球差方面的校正更好。阿波罗色差或“APO”镜头使用高折射率材料（通常是稀土元素）来校正色差。非球面或“ASPH”镜头使用复杂的曲线来校正球差。这些校正镜头通常更贵，但你应该留意它们，因为它们有时可能以优惠价格出现。
- en: Due to shallow depth of field, wide apertures produce the most visible aberrations.
    Even with non-APO and non-ASPH lenses, aberrations may be insignificant at most
    aperture settings, and in most scenes.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 由于景深较浅，大光圈会产生最明显的像差。即使是非APO和非ASPH镜头，在大多数光圈设置和大多数场景下，像差可能微不足道。
- en: 'With a few bargain-hunting skills, we can find half a dozen good lenses from
    the 1960s to 1980s for the price of one good, new lens. Moreover, even recent
    lens models might sell at a 50 percent discount on the secondhand market. Before
    discussing specific examples of bargains, let''s consider five steps we might
    follow when shopping for any secondhand lens:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 通过一些讨价还价的技巧，我们可以用一只新镜头的价格找到六只20世纪60年代到80年代的好镜头。此外，即使是最近推出的镜头型号，在二手市场上也可能以50%的折扣出售。在讨论具体优惠的例子之前，让我们考虑在购买任何二手镜头时可能遵循的五个步骤：
- en: Understand the requirements. As we discussed earlier in the *Capturing the subject
    in the moment* section, many parameters of the lens and camera interact to determine
    whether we can take a clear and timely picture. At minimum, we should consider
    the appropriate focal length, f-number or T-number, and nearest focusing distance
    for a given application and given camera. We should also attempt to gauge the
    importance of high resolution and low distortion to the given application. Wavelengths
    of light matter, too. For example, if a lens is optimized for visible light (as
    most are), it is not necessarily efficient at transmitting NIR.
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 理解需求。正如我们在“捕捉瞬间的主题”部分之前讨论的那样，镜头和相机的许多参数相互作用，以确定我们是否能够拍摄到清晰及时的照片。至少，我们应该考虑适当的焦距、光圈数或T数，以及针对特定应用和相机的最近对焦距离。我们还应该尝试评估高分辨率和低畸变对特定应用的重要性。光的波长也很重要。例如，如果镜头针对可见光进行了优化（如大多数镜头那样），它可能并不一定高效地传输近红外光。
- en: Study the supply. If you live in a large city, perhaps local merchants have
    a good stock of used lenses at low prices. Otherwise, the lowest prices can typically
    be found on auction sites such as eBay. Search based on the requirements that
    we defined in step 1, such as "100 2.8 lens" if we are looking for a focal length
    of 100mm and an f-number or T-number of 2.8\. Some of the lenses you find will
    not have the same type of mount as your camera. Check whether adapters are available.
    Adapting a lens is often an economical option, especially in the case of long
    lenses, which tend not to be mass-produced for cameras with a small sensor. Create
    a shortlist of the available lens models that seem to meet the requirements at
    an attractive price.
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 研究供应。如果你住在大城市，也许当地商家有大量价格低廉的二手镜头。否则，通常可以在eBay等拍卖网站上找到最低价格。根据我们在第一步中定义的需求进行搜索，例如，如果我们正在寻找100mm焦距和2.8的光圈数或T数，就搜索“100
    2.8镜头”。你找到的一些镜头可能没有与你的相机相同的类型。检查是否可以提供适配器。适配镜头通常是一个经济的选择，尤其是在长焦镜头的情况下，它们往往不会为小感光器的相机大量生产。创建一个似乎以有吸引力的价格满足要求的可用镜头型号的简短列表。
- en: Study the lens models. Online, have users published detailed specifications,
    sample images, test data, comparisons, and opinions? MFlenses ([http://www.mflenses.com/](http://www.mflenses.com/))
    is an excellent source of information on old, manual focus lenses. It offers numerous
    reviews and an active forum. Image and video hosting sites such as Flickr ([https://www.flickr.com/](https://www.flickr.com/))
    are also good places to search for reviews and sample output of old and unusual
    lenses, including cine (video) lenses, nightvision scopes, and more! Find out
    about variations in each lens model over the years of its manufacture. For example,
    early versions of a given lens might be single-coated, while newer versions would
    be multicoated for better transmittance, contrast, and durability.
  id: totrans-373
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 学习镜头模型。在线上，用户们发布了详细的规格、样本图像、测试数据、比较和意见吗？MFlenses ([http://www.mflenses.com/](http://www.mflenses.com/))
    是关于旧式手动对焦镜头的极好信息来源。它提供了许多评论和一个活跃的论坛。像Flickr ([https://www.flickr.com/](https://www.flickr.com/))
    这样的图片和视频托管网站也是寻找旧式和特殊镜头（包括电影镜头、夜视仪等）评论和样本输出的好地方！了解每种镜头模型在其制造年份中的变化。例如，某个镜头的早期版本可能是单层涂层的，而较新的版本则可能是多层涂层，以提高透射率、对比度和耐用性。
- en: Pick an item in good condition. The lens should have no fungus or haze. Preferably,
    it should have no scratches or cleaning marks (smudges in the coatings), though
    the effect on image quality might be small if the damage is to the front lens
    element (the element farthest from the camera).
  id: totrans-374
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择状况良好的物品。镜头应无霉斑或雾气。最好是没有划痕或清洁痕迹（涂层上的污点），尽管如果损坏在前镜片元素（离相机最远的元素）上，对图像质量的影响可能很小。
- en: A little dust inside the lens should not affect image quality. The aperture
    and focusing mechanism should move smoothly and, preferably, there should be no
    oil on the aperture blades.
  id: totrans-375
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 镜头内部有一点灰尘不应影响图像质量。光圈和聚焦机制应平滑移动，最好是没有油光圈叶片。
- en: Bid, make an offer, or buy at the seller's price. If you think the bidding or
    negotiation is reaching too high a price, save your money for another deal. Remember,
    despite what sellers might tell you, most bargain items are not rare and most
    bargain prices will occur again. Keep looking!
  id: totrans-376
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 参与竞标，出价，或者以卖家的价格购买。如果你认为竞标或谈判的价格过高，就为另一笔交易保存你的钱。记住，尽管卖家可能会告诉你，大多数廉价物品并不罕见，大多数廉价价格将会再次出现。继续寻找！
- en: Some brands enjoy an enduring reputation for excellence. Between the 1860s and
    1930s, German manufacturers such as Carl Zeiss, Leica, and Schneider Kreuznach
    solidified their fame as creators of premium optics. (Schneider Kreuznach is best
    known for cine lenses.) Other, venerable European brands include Alpa (of Switzerland)
    and Angéniuex (of France), which are both best known for cine lenses. By the 1950s,
    Nikon began to gain recognition as the first Japanese manufacturer to rival the
    quality of German lenses. Subsequently, Fuji and Canon became regarded as makers
    of high-end lenses for both cine and photo cameras.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 一些品牌因卓越的品质而享有持久的声誉。在1860年至1930年之间，卡尔·蔡司、莱卡和施耐德·克鲁斯纳赫等德国制造商巩固了他们作为优质光学产品创造者的名声。（施耐德·克鲁斯纳赫以电影镜头最为知名。）其他值得尊敬的欧洲品牌包括瑞士的Alpa和法国的Angéniuex，它们都以其电影镜头最为知名。到1950年代，尼康开始获得认可，成为第一个能够与德国镜头质量相媲美的日本制造商。随后，富士和佳能成为电影和摄影相机高端镜头制造商。
- en: Although Willy Loman (from Arthur Miller's play *Death of a Salesman*) might
    advise us to buy "a well-advertised machine", this is not necessarily the best
    bargain. Assuming we are buying lenses for their practical value and not their
    collectible value, we would be delighted if we found excellent quality in a mass-produced,
    no-name lens. Some lenses come reasonably close to this ideal.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管Willy Loman（来自亚瑟·米勒的戏剧《推销员的死亡》）可能会建议我们购买“一个广受欢迎的机器”，但这并不一定是最好的交易。假设我们购买镜头是为了其实用价值而不是收藏价值，如果我们发现量产的无品牌镜头质量优秀，我们会很高兴。一些镜头相当接近这个理想。
- en: East Germany and the Soviet Union mass-produced good lenses for photo cameras,
    cine cameras, projectors, microscopes, night vision scopes, and other devices.
    Optics were also important in major projects ranging from submarines to spacecraft!
    East German manufacturers included Carl Zeiss Jena, Meyer, and Pentacon. Soviet
    (later Russian, Ukrainian, and Belarusian) manufacturers included KMZ, BelOMO,
    KOMZ, Vologda, LOMO, Arsenal, and many others. Often, lens designs and manufacturing
    processes were copied and modified by multiple manufacturers in the Eastern Bloc,
    giving a recognizable character to lenses of this region and era.
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 东德和苏联大量生产了用于照相机、电影摄像机、投影仪、显微镜、夜视仪和其他设备的优质镜头。光学在从潜艇到宇宙飞船等重大项目中也同样重要！东德制造商包括卡尔·蔡司耶拿、迈耶和潘塔孔。苏联（后来是俄罗斯、乌克兰和白俄罗斯）制造商包括KMZ、BelOMO、KOMZ、沃洛格达、LOMO、阿森纳等许多其他公司。通常，镜头设计和制造工艺在东欧集团的多家制造商中被复制和修改，赋予了这个地区和这个时代的镜头一个可识别的特征。
- en: Note
  id: totrans-380
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: Many lenses from the Eastern Bloc were no-name goods insofar as they did not
    bear a manufacturer's name. Some models, for export, were simply labeled "MADE
    IN USSR" or "aus JENA" (from Jena, East Germany). However, most Soviet lenses
    bear a symbol and serial number that encode the location and date of manufacture.
    For a catalogue of these markings and a description of their historical significance,
    see Nathan Dayton's article, "An Attempt to Clear the FOG", at [http://www.commiecameras.com/sov/](http://www.commiecameras.com/sov/).
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 东欧集团的一些镜头没有制造商的名称，因此它们是无名商品。一些型号，为了出口，只是标有“制造于苏联”或“aus JENA”（来自东德耶拿）。然而，大多数苏联镜头都带有符号和序列号，这些符号和序列号编码了制造地点和日期。有关这些标记的目录及其历史意义的描述，请参阅Nathan
    Dayton的文章“尝试消除迷雾”，见[http://www.commiecameras.com/sov/](http://www.commiecameras.com/sov/)。
- en: Some of the lesser-known Japanese brands tend to be bargains, too. For example,
    Pentax makes good lenses but it has never commanded quite the same premium as
    its competitors do. The company's older photo lenses come in an M42 mount, and
    these are especially plentiful at low prices. Also, search for the company's C-mount
    cine lenses, which were formerly branded Cosmicar.
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 一些不太知名的日本品牌也倾向于是廉价的选择。例如，宾得制造出好的镜头，但它从未像其竞争对手那样享有同样的高端地位。公司的老款摄影镜头采用M42接口，这些镜头在低价位上特别丰富。此外，寻找公司的C接口电影镜头，这些镜头以前被品牌为Cosmicar。
- en: 'Let''s see how we can couple some bargain lenses with the GS3-U3-23S6M-C to
    produce fine images. Remember that the GS3-U3-23S6M-C has a C mount and a sensor
    whose format is 1/1.2". For C-mount and CS-mount cameras, the name of the sensor
    format does not refer to any actual dimension of the sensor! Rather, for historical
    reasons, the measurement such as 1/1.2" refers to the diameter that a vacuum tube
    would have if video cameras still used vacuum tubes! The following table lists
    the conversions between common sensors formats and the actual dimensions of the
    sensor:'
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何将一些廉价镜头与GS3-U3-23S6M-C配合使用，以产生优质图像。记住，GS3-U3-23S6M-C具有C接口和1/1.2英寸格式的传感器。对于C接口和CS接口的相机，传感器格式的名称并不指代传感器实际的任何尺寸！相反，由于历史原因，如1/1.2英寸这样的测量值指的是如果视频相机仍然使用真空管，那么真空管的直径！以下表格列出了常见传感器格式与传感器实际尺寸之间的转换：
- en: '| Format Name | Typical Lens Mounts | Typical Uses | Diagonal (mm) | Width
    (mm) | Height (mm) | Aspect Ratio |'
  id: totrans-384
  prefs: []
  type: TYPE_TB
  zh: '| 格式名称 | 典型镜头接口 | 典型用途 | 对角线（毫米） | 宽度（毫米） | 高度（毫米） | 宽高比 |'
- en: '| --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-385
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | --- |'
- en: '| 1/4" | CS | Machine vision | 4.0 | 3.2 | 2.4 | 4:3 |'
  id: totrans-386
  prefs: []
  type: TYPE_TB
  zh: '| 1/4英寸 | CS | 机械视觉 | 4.0 | 3.2 | 2.4 | 4:3 |'
- en: '| 1/3" | CS | Machine vision | 6.0 | 4.8 | 3.6 | 4:3 |'
  id: totrans-387
  prefs: []
  type: TYPE_TB
  zh: '| 1/3英寸 | CS | 机械视觉 | 6.0 | 4.8 | 3.6 | 4:3 |'
- en: '| 1/2.5" | C | Machine vision | 6.4 | 5.1 | 3.8 | 4:3 |'
  id: totrans-388
  prefs: []
  type: TYPE_TB
  zh: '| 1/2.5英寸 | C | 机械视觉 | 6.4 | 5.1 | 3.8 | 4:3 |'
- en: '| 1/2" | C | Machine vision | 8.0 | 6.4 | 4.8 | 4:3 |'
  id: totrans-389
  prefs: []
  type: TYPE_TB
  zh: '| 1/2英寸 | C | 机械视觉 | 8.0 | 6.4 | 4.8 | 4:3 |'
- en: '| 1/1.8" | C | Machine vision | 9.0 | 7.2 | 5.4 | 4:3 |'
  id: totrans-390
  prefs: []
  type: TYPE_TB
  zh: '| 1/1.8英寸 | C | 机械视觉 | 9.0 | 7.2 | 5.4 | 4:3 |'
- en: '| 2/3" | C | Machine vision | 11.0 | 8.8 | 6.6 | 4:3 |'
  id: totrans-391
  prefs: []
  type: TYPE_TB
  zh: '| 2/3英寸 | C | 机械视觉 | 11.0 | 8.8 | 6.6 | 4:3 |'
- en: '| 16mm | C | Cine | 12.7 | 10.3 | 7.5 | 4:3 |'
  id: totrans-392
  prefs: []
  type: TYPE_TB
  zh: '| 16毫米 | C | 电影 | 12.7 | 10.3 | 7.5 | 4:3 |'
- en: '| 1/1.2" | C | Machine vision | 13.3 | 10.7 | 8.0 | 4:3 |'
  id: totrans-393
  prefs: []
  type: TYPE_TB
  zh: '| 1/1.2英寸 | C | 机械视觉 | 13.3 | 10.7 | 8.0 | 4:3 |'
- en: '| Super 16 | C | Cine | 14.6 | 12.5 | 7.4 | 5:3 |'
  id: totrans-394
  prefs: []
  type: TYPE_TB
  zh: '| 超级16毫米 | C | 电影 | 14.6 | 12.5 | 7.4 | 5:3 |'
- en: '| 1" | C | Machine vision | 16.0 | 12.8 | 9.6 | 4:3 |'
  id: totrans-395
  prefs: []
  type: TYPE_TB
  zh: '| 1英寸 | C | 机械视觉 | 16.0 | 12.8 | 9.6 | 4:3 |'
- en: '| Four Thirds | Four ThirdsMicro Four Thirds | PhotographyCine | 21.6 | 17.3
    | 13.0 | 4:3 |'
  id: totrans-396
  prefs: []
  type: TYPE_TB
  zh: '| 四第三 | 四第三微四第三 | 摄影 | 电影 | 21.6 | 17.3 | 13.0 | 4:3 |'
- en: '| APS-C | Various proprietary such as Nikon F | Photography | 27.3 | 22.7 |
    15.1 | 3:2 |'
  id: totrans-397
  prefs: []
  type: TYPE_TB
  zh: '| APS-C | 诸如尼康F等各种专有 | 摄影 | 27.3 | 22.7 | 15.1 | 3:2 |'
- en: '| 35mm("Full Frame") | M42Various proprietary such as Nikon F | PhotographyMachine
    vision | 43.3 | 36.0 | 24.0 | 3:2 |'
  id: totrans-398
  prefs: []
  type: TYPE_TB
  zh: '| 35mm("全画幅") | M42各种专有型号，如尼康F | 摄影 | 43.3 | 36.0 | 24.0 | 3:2 |'
- en: Note
  id: totrans-399
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'For more information about typical sensor sizes in machine vision cameras,
    see the following article from Vision-Doctor.co.uk: [http://www.vision-doctor.co.uk/camera-technology-basics/sensor-and-pixel-sizes.html](http://www.vision-doctor.co.uk/camera-technology-basics/sensor-and-pixel-sizes.html).'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 有关机器视觉相机中典型传感器尺寸的更多信息，请参阅Vision-Doctor.co.uk的以下文章：[http://www.vision-doctor.co.uk/camera-technology-basics/sensor-and-pixel-sizes.html](http://www.vision-doctor.co.uk/camera-technology-basics/sensor-and-pixel-sizes.html)。
- en: 'A lens casts a circular image, which needs to have a large enough diameter
    to cover the diagonal of the sensor. Otherwise, the captured image will suffer
    from **vignetting**, meaning that the corners will be blurry and dark. For example,
    vignetting is obvious in the following image of a painting, *Snow Monkeys*, by
    Janet Howse. The image was captured using a 1/1.2" sensor, but the lens was designed
    for a 1/2" sensor, and therefore the image is blurry and dark, except for a circular
    region in the center:'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 镜头投射出圆形图像，需要足够大的直径以覆盖传感器的对角线。否则，捕获的图像将出现**暗角**，意味着角落会模糊且暗。例如，在Janet Howse的画作《雪猴》的以下图像中，暗角很明显。该图像使用1/1.2"传感器捕获，但镜头是为1/2"传感器设计的，因此图像模糊且暗，除了中心的一个圆形区域：
- en: '![Shopping for glass](img/00013.jpeg)'
  id: totrans-402
  prefs: []
  type: TYPE_IMG
  zh: '![购物玻璃](img/00013.jpeg)'
- en: 'A lens designed for one format can cover any format that is approximately the
    same size or smaller, without vignetting; however, we might need an adapter to
    mount the lens. The system''s diagonal field of view, in degrees, depends on the
    sensor''s diagonal size and the lens''s focal length, according to the following
    formula:'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 为一个格式设计的镜头可以覆盖任何大小相似或更小的格式，而不会出现暗角；然而，我们可能需要一个适配器来安装镜头。系统的对角线视场角（以度为单位），取决于传感器的对角线大小和镜头的焦距，根据以下公式：
- en: '[PRE60]'
  id: totrans-404
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: For example, if a lens has the same focal length as the sensor's diagonal, the
    diagonal FOV is 53.1 degrees. Such a lens is called a **normal lens** (with respect
    to the given sensor format) and a FOV of 53.1 degrees is considered neither wide
    nor narrow.
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果一个镜头的焦距与传感器的对角线相同，其对角线视场角为53.1度。这样的镜头被称为**标准镜头**（相对于给定的传感器格式），53.1度的视场角既不算宽也不算窄。
- en: Consulting the table above, we see that the 1/1.2" format is similar to the
    16mm and Super 16 formats. Thus, the GS3-U3-23S6M-C (and similar cameras) should
    be able to use most C-mount cine lenses without vignetting, without an adapter,
    and with approximately the same FOV as the lens designers intended.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 咨询上表，我们看到1/1.2"格式与16mm和Super 16格式相似。因此，GS3-U3-23S6M-C（以及类似相机）应该能够使用大多数C口电影镜头而不会出现暗角，无需适配器，并且具有与镜头设计师意图相近的视场角。
- en: Suppose we want a narrow FOV to capture a subject at a distance. We might need
    a long focal length that is not commonly available in C-mount. Comparing diagonal
    sizes, note that the 35mm format is larger than the 1/1.2" format by a factor
    of 3.25\. A normal lens for 35mm format becomes a long lens with a 17.5 degree
    FOV when mounted for 1/1.2" format! An M42 to C mount adapter might cost $30 and
    lets us use a huge selection of lenses!
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们想要一个窄视场角来拍摄远处的物体。我们可能需要一个长焦距，这在C口并不常见。比较对角线大小，注意35mm格式比1/1.2"格式大3.25倍。当安装到1/1.2"格式时，35mm格式的标准镜头变成了具有17.5度视场角的长焦镜头！一个M42到C口的适配器可能需要30美元，并让我们可以使用大量的镜头！
- en: 'Suppose we want to take close-up pictures of a subject but none of our lenses
    can focus close enough. This problem has a low-tech solution—an **extension tube**,
    which increases the distance between the lens and camera. For C-mount, a set of
    several extension tubes, of various lengths, might cost $30\. When the lens''s
    total extension (from tubes plus its built-in focusing mechanism) is equal to
    the focal length, the subject is projected onto the sensor at 1:1 magnification.
    For example, a 13.3mm subject would fill the 13.3mm diagonal of a 1/1.2" sensor.
    The following formula holds true:'
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们想要拍摄近距离的物体，但我们的镜头都无法足够接近地聚焦。这个问题有一个低技术含量的解决方案——**延长管**，它可以增加镜头和相机之间的距离。对于C口，一套不同长度的几个延长管可能需要30美元。当镜头的总延伸（从管子加上其内置对焦机构）等于焦距时，物体以1:1的放大率投影到传感器上。例如，一个13.3mm的物体将填满1/1.2"传感器13.3mm的对角线。以下公式成立：
- en: '[PRE61]'
  id: totrans-409
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: However, for a high magnification ratio, the subject must be very close to the
    front lens element in order to come into focus. Sometimes, the use of extension
    tubes creates an impractical optical system that cannot even focus as far as its
    front lens element! Other times, parts of the subject and lens housing (such as
    a built-in lens shade) might bump into each other. Some experimentation might
    be required in order to determine the practical limits of extending the lens.
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，为了获得高放大倍数，主题必须非常靠近前镜片元件才能对焦。有时，使用延伸筒会创建一个不切实际的光学系统，甚至无法对焦到其前镜片元件那么远！其他时候，主题的一部分和镜头外壳（如内置镜头遮光罩）可能会相互碰撞。可能需要进行一些实验，以确定镜头延伸的实际极限。
- en: 'The following table lists some of the lenses and lens accessories that I have
    recently purchased for use with the GS3-U3-23S6M-C:'
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格列出了我为GS3-U3-23S6M-C最近购买的某些镜头和镜头配件：
- en: '| Name | Price | Origin | Mount and Intended Format | Focal Length (mm) | FOV
    for 1/1.2" Sensor (degrees) | Max f-number or T-number |'
  id: totrans-412
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | 价格 | 产地 | 座位和预期格式 | 焦距（mm） | 1/1.2"传感器视野（度） | 最大f数或T数 |'
- en: '| --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-413
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | --- |'
- en: '| Cosmicar TV Lens 12.5mm 1:1.8 | $41 | Japan1980s? | CSuper 16 | 12.5 | 56.1
    | T/1.8 |'
  id: totrans-414
  prefs: []
  type: TYPE_TB
  zh: '| Cosmicar TV镜头 12.5mm 1:1.8 | $41 | 日本1980年代？ | CSuper 16 | 12.5 | 56.1 |
    T/1.8 |'
- en: '| Vega-73 | $35 | LZOS factoryLytkarino, USSR1984 | CSuper 16 | 20.0 | 36.9
    | T/2.0 |'
  id: totrans-415
  prefs: []
  type: TYPE_TB
  zh: '| Vega-73 | $35 | LZOS工厂利特卡里诺，苏联1984 | CSuper 16 | 20.0 | 36.9 | T/2.0 |'
- en: '| Jupiter-11A | $50 | KOMZ factoryKazan, USSR1975 | M4235mm | 135.0 | 5.7 |
    f/4.0 |'
  id: totrans-416
  prefs: []
  type: TYPE_TB
  zh: '| Jupiter-11A | $50 | KOMZ工厂喀山，苏联1975 | M4235mm | 135.0 | 5.7 | f/4.0 |'
- en: '| C-mount extension tubes: 10mm, 20mm, and 40mm | $30 | JapanNew | C | - |
    - | - |'
  id: totrans-417
  prefs: []
  type: TYPE_TB
  zh: '| C座延伸筒：10mm、20mm和40mm | $30 | 日本新品 | C | - | - | - |'
- en: '| Fotodiox M42 to C adapter | $30 | USANew | M42 to C | - | - | - |'
  id: totrans-418
  prefs: []
  type: TYPE_TB
  zh: '| Fotodiox M42 to C适配器 | $30 | 美国新品 | M42 to C | - | - | - |'
- en: 'For comparison, consider the following table, which gives examples of new lenses
    that are specifically intended for the machine vision:'
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 为了比较，请考虑以下表格，其中给出了专门为机器视觉设计的镜头的示例：
- en: '| Name | Price | Origin | Mount and Intended Format | Focal Length (mm) | FOV
    for 1/1.2" Sensor (degrees) | Max f-number or T-number |'
  id: totrans-420
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | 价格 | 产地 | 座位和预期格式 | 焦距（mm） | 1/1.2"传感器视野（度） | 最大f数或T数 |'
- en: '| --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-421
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | --- |'
- en: '| Fujinon CF12.5HA-1 | $268 | JapanNew | C1" | 12.5 | 56.1 | T/1.4 |'
  id: totrans-422
  prefs: []
  type: TYPE_TB
  zh: '| Fujinon CF12.5HA-1 | $268 | 日本新品 | C1" | 12.5 | 56.1 | T/1.4 |'
- en: '| Fujinon CF25HA-1 | $270 | JapanNew | C1" | 25.0 | 29.9 | T/1.4 |'
  id: totrans-423
  prefs: []
  type: TYPE_TB
  zh: '| Fujinon CF25HA-1 | $270 | 日本新品 | C1" | 25.0 | 29.9 | T/1.4 |'
- en: '| Fujinon CF50HA-1 | $325 | JapanNew | C1" | 50.0 | 15.2 | T/1.8 |'
  id: totrans-424
  prefs: []
  type: TYPE_TB
  zh: '| Fujinon CF50HA-1 | $325 | 日本新品 | C1" | 50.0 | 15.2 | T/1.8 |'
- en: '| Fujinon CF75HA-1 | $320 | JapanNew | C1" | 75.0 | 10.2 | T/1.4 |'
  id: totrans-425
  prefs: []
  type: TYPE_TB
  zh: '| Fujinon CF75HA-1 | $320 | 日本新品 | C1" | 75.0 | 10.2 | T/1.4 |'
- en: Note
  id: totrans-426
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: Prices in the preceding table are from B&H ([http://www.bhphotovideo.com](http://www.bhphotovideo.com)),
    a major photo and video supplier in the United States. It offers a good selection
    of machine vision lenses, often at lower prices than listed by industrial suppliers.
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 上述表格中的价格来自B&H（[http://www.bhphotovideo.com](http://www.bhphotovideo.com)），它是美国的主要摄影和视频供应商。它提供了一系列机器视觉镜头，通常比工业供应商列出的价格低。
- en: These new, machine vision lenses are probably excellent. I have not tested them.
    However, let's look at a few sample shots from our selection of old, used, photo
    and cine lenses that are cheaper by a factor of six or more. All the images are
    captured at a resolution of 1920x1200 using FlyCapture2, but they are resized
    for inclusion in this book.
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 这些新的机器视觉镜头可能非常出色。我还没有测试它们。然而，让我们看看我们选择的旧、二手、摄影和电影镜头的一些样本照片，它们的成本比这低六倍或更多。所有图像都是使用FlyCapture2以1920x1200的分辨率捕获的，但它们被调整大小以包含在这本书中。
- en: 'First, let''s try the Cosmicar 12.5mm lens. For a wide-angle lens such as this,
    a scene with many straight lines can help us judge the amount of distortion. The
    following sample shot shows a reading room with many bookshelves:'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们尝试Cosmicar 12.5mm镜头。对于这种广角镜头，一个有许多直线的场景可以帮助我们判断畸变程度。以下样本照片显示了一个有许多书架的阅览室：
- en: '![Shopping for glass](img/00014.jpeg)'
  id: totrans-430
  prefs: []
  type: TYPE_IMG
  zh: '![购物玻璃镜头](img/00014.jpeg)'
- en: 'To better see the detail, such as the text on books'' spines, look at the following
    crop of 480x480 pixels (25 percent of the original width) from the center of the
    image:'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地看到细节，例如书籍背面的文本，请查看以下从图像中心裁剪的480x480像素（原始宽度的25%）的图像：
- en: '![Shopping for glass](img/00015.jpeg)'
  id: totrans-432
  prefs: []
  type: TYPE_IMG
  zh: '![购物玻璃镜头](img/00015.jpeg)'
- en: 'The following image is a close-up of blood vessels in my eye, captured with
    the Vega-73 lens and a 10mm extension tube:'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图像是我眼睛血管的特写，使用Vega-73镜头和10mm延伸筒捕获：
- en: '![Shopping for glass](img/00016.jpeg)'
  id: totrans-434
  prefs: []
  type: TYPE_IMG
  zh: '![购物玻璃](img/00016.jpeg)'
- en: 'Again, the detail can be better appreciated in a 480x480 crop from the center,
    as shown here:'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，细节可以在中心480x480的裁剪中更好地欣赏，如下所示：
- en: '![Shopping for glass](img/00017.jpeg)'
  id: totrans-436
  prefs: []
  type: TYPE_IMG
  zh: '![购物玻璃](img/00017.jpeg)'
- en: 'Finally, let''s capture a distant subject with the Jupiter-11A. Here is the
    Moon on a clear night:'
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们用Jupiter-11A捕捉一个远处的物体。这是在晴朗的夜晚的月亮：
- en: '![Shopping for glass](img/00018.jpeg)'
  id: totrans-438
  prefs: []
  type: TYPE_IMG
  zh: '![购物玻璃](img/00018.jpeg)'
- en: 'Once more, let''s examine a 480x480 crop from the image''s center in order
    to see the level of detail captured by the lens:'
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，让我们检查图像中心的480x480裁剪，以了解镜头捕捉到的细节水平：
- en: '![Shopping for glass](img/00019.jpeg)'
  id: totrans-440
  prefs: []
  type: TYPE_IMG
  zh: '![购物玻璃](img/00019.jpeg)'
- en: By now, our discussion of bargain lenses has spanned many decades and the distance
    from here to the Moon! I encourage you to explore even further on your own. What
    are the most interesting and capable optical systems that you can assemble within
    a given budget?
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: '到目前为止，我们关于廉价镜头的讨论已经跨越了许多年代，从这里到月亮的距离！我鼓励你进一步探索。在给定的预算内，你能组装出哪些最有趣和功能强大的光学系统？ '
- en: Summary
  id: totrans-442
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: 'This chapter has been an opportunity to consider the inputs of a computer vision
    system at the hardware and software levels. Also, we have addressed the need to
    efficiently marshal image data from the input stage to the processing and output
    stages. Our specific accomplishments have included the following:'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 本章为我们提供了一个机会来考虑计算机视觉系统在硬件和软件层面的输入。此外，我们还解决了从输入阶段到处理和输出阶段高效调度图像数据的需求。我们的具体成就包括以下内容：
- en: Understanding differences among various wavelengths of light and radiation
  id: totrans-444
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解不同波长的光和辐射之间的差异
- en: Understanding various properties of sensors, lenses, and images
  id: totrans-445
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解传感器、镜头和图像的各种特性
- en: Capturing and recording slow-motion video with the PlayStation Eye camera and
    OpenCV's videoio module
  id: totrans-446
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用PlayStation Eye相机和OpenCV的视频io模块捕捉和记录慢动作视频
- en: Comparing subjects' appearance in visible and NIR light using the ASUS Xtion
    PRO Live camera with OpenNI2 and OpenCV's highgui module
  id: totrans-447
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用ASUS Xtion PRO Live相机和OpenNI2以及OpenCV的高gui模块比较可见光和近红外光下物体的外观
- en: Capturing and rendering HD video at high speed while detecting faces, using
    FlyCapture2, OpenCV, SDL2, and the GS3-U3-23S6M-C camera
  id: totrans-448
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用FlyCapture2、OpenCV、SDL2和GS3-U3-23S6M-C相机在高速捕捉人脸的同时捕捉和渲染高清视频
- en: Shopping for cheap, old, used lenses that are surprisingly good!
  id: totrans-449
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 购买便宜、旧、二手的镜头，它们出奇地好！
- en: Next, in [Chapter 2](part0023_split_000.html#LTSU2-940925703e144daa867f510896bffb69
    "Chapter 2. Photographing Nature and Wildlife with an Automated Camera"), *Photographing
    Nature and Wildlife with an Automated Camera*, we will deepen our appreciation
    of high-quality images as we build a smart camera that captures and edits documentary
    footage of a natural environment!
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在[第二章](part0023_split_000.html#LTSU2-940925703e144daa867f510896bffb69 "第二章.
    使用自动相机拍摄自然和野生动物")《使用自动相机拍摄自然和野生动物》中，我们将随着构建一个捕捉和编辑自然环境纪录片片段的智能相机，加深我们对高质量图像的欣赏！

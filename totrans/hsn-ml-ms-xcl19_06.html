<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Data Cleansing and Preliminary Data Analysis</h1>
                </header>
            
            <article>
                
<p><span>After acquiring the right data, the most difficult and time-consuming task is getting it ready for analysis. Understanding what can and cannot be done with a given dataset is the first step before any model can be used. This chapter demonstrates how to use Excel functions to search and replace patterns, and how to find wrong data types and missing data. It also contains some useful diagrams so that we can get insights from the data and understand the different variables.</span></p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Cleansing data</li>
<li>Visualizing data for preliminary analysis</li>
<li>Understanding unbalanced datasets</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>You will need to download the <kbd>titanic.xls</kbd> file from the GitHub repository at <a href="https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter04">https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter04</a>.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Cleansing data</h1>
                </header>
            
            <article>
                
<p>Data is never clean – it always contains missing values, errors, incorrect formats, and other problems that make it impossible to feed to a machine learning model without preprocessing. This is what data cleansing is all about – correcting all these problems before starting the real analysis.</p>
<p>As an example of how to clean a dataset, we will use the Titanic passengers dataset. We will repeat the procedure described in the <em>Importing data from another Excel workbook</em> section of the previous chapter, to import data from an Excel workbook. We will use real data from the Titanic passengers and demonstrate how you can prepare it for analysis.</p>
<p>To clean a dataset, perform the necessary steps, as follows:</p>
<ol>
<li>Navigate to <span class="packt_screen">Data</span> | <span class="packt_screen">From File</span> | <span class="packt_screen">From Workbook</span>, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/44011b03-34b4-4aaa-9bc8-ef221b664b59.png"/></p>
<ol start="2">
<li>After selecting the <kbd>titanic.xlsx</kbd> file and the <kbd>Passenger data</kbd> worksheet, we get a preview of the file's contents, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/561f7e44-7d61-4c23-b997-0e749b8e6281.png" style="width:53.67em;height:42.58em;"/></p>
<ol start="3">
<li>Click on <span class="packt_screen">Edit</span> and start the data cleansing process. The first thing we notice is that we don't need the column containing the passenger names; it gives no useful information to our analysis. In fact, in most cases, we will be required to remove personal information from our data, due to privacy policies.</li>
<li>Select the <kbd>name</kbd> column.</li>
<li>Click on <span class="packt_screen">Remove Columns</span><em>;</em> the resulting table will look as follows:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/98090ad2-7a35-405c-b00a-6eb91851614d.png" style="width:64.58em;height:35.08em;"/></p>
<ol start="6">
<li>Replace all <kbd>nulls</kbd> in the <kbd>cabin</kbd> column with <kbd>unknown</kbd>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d851c474-8819-4bd8-8f62-3195c2e1dc10.png"/></p>
<p style="padding-left: 60px">There are two other columns that contain missing values: <kbd>boat</kbd> and <kbd>body</kbd>. According to the data dictionary, they tell us which lifeboat the passenger was located in (if they survived), and which ID was assigned to their body in the case of their death. There are missing values, but there are also some cases where we cannot have a value; clearly, a dead passenger did not use a boat and a surviving passenger body was not identified. We will use some functions to account for these options.</p>
<ol start="7">
<li>In <span class="packt_screen">Query Editor</span>, select the <span class="packt_screen">Add Column</span> tab.</li>
<li>Select <span class="packt_screen">Custom Column</span>.</li>
<li>The dialog shows us an option to name the new column and define its contents. Type <kbd>boat_corrected</kbd> into the textbox.</li>
</ol>
<ol start="10">
<li>Define a function to calculate the column's contents, as follows:</li>
</ol>
<p style="padding-left: 90px" class="CDPAlignLeft CDPAlign"><em>if [survived]=1 and [boat] = null then "unknown" else [boat]</em></p>
<p style="padding-left: 60px">This means that if the passenger survived and the boat name is missing, we set the value to <kbd>unknown</kbd>. Otherwise, we just copy the value into the original column, as demonstrated in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/167f4f10-59b8-4ac3-adea-d581269e580d.png"/></p>
<ol start="11">
<li>Add another new column in order to correct the values in <kbd>body</kbd> and define a different value for the column:</li>
</ol>
<p style="padding-left: 90px" class="CDPAlignLeft CDPAlign"><em>if [survived]=0 and [body] = null then "not recovered" else [body]</em></p>
<p style="padding-left: 60px">In this case, we want to say that if the passenger did not survive the shipwreck and there is no body ID, then it was probably not recovered from the water.</p>
<p style="padding-left: 60px"><span>The result, after reordering the columns, is as follows:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1637fc80-aa94-41ce-a8ca-184338163e9e.png"/></p>
<p style="padding-left: 60px">There are still <kbd>null</kbd> values in the new columns; they correspond to the preceding cases (that is, the dead passenger with no boat, or the survivor with no body ID). Replace these values with <kbd>N/A</kbd>; the resulting table is shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/266a83c3-bffb-4ff6-a8e7-526de7031b0d.png" style="width:55.50em;height:31.08em;"/></p>
<p style="padding-left: 60px">The last column to be modified is <kbd>age</kbd>. We are going to simplify this by grouping the passengers into age range and replace the missing values.</p>
<ol start="12">
<li>Replace all the missing values (<kbd>null</kbd>) with <kbd>-1</kbd>. We can do this easily by selecting the column and clicking on <span class="packt_screen">Replace Values</span>.</li>
<li>Navigate to the <span class="packt_screen">Add Column</span> tab.</li>
</ol>
<ol start="14">
<li>Click on <span class="packt_screen">Conditional Column</span> and define several groups, depending on the age range, as demonstrated in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/62e9901e-5a60-40f5-b3b3-fb61bac13468.png" style="width:51.75em;height:31.50em;"/></p>
<p style="padding-left: 60px">The result is a new column (<kbd>Age group</kbd>) that contains the different age groups instead of the age value and replaces the <kbd>null</kbd> values with <kbd>unknown</kbd>. The resulting table is as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e68cd6d2-bd76-456b-8f5c-6e1a978c7dee.png" style="width:57.00em;height:32.00em;"/></p>
<p>Our dataset is now clean and ready for some preliminary analysis, which we will show in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Visualizing data for preliminary analysis</h1>
                </header>
            
            <article>
                
<p>After cleaning the dataset, it is always recommended to visualize it. This helps us gain an understanding of the different variables, how their values are distributed, and the correlations that exist between them (we will explore correlations in more detail in the next chapter). We can determine which variables are important to our analyses, which ones give us more information, and which ones can be discarded for being redundant.</p>
<p class="mce-root">We will start by looking a several bar plots, where we will either count the number of occurrences of each value (using a histogram), or we will show the percentage of each value with respect to the total (using a bar plot). To achieve this, perform the following steps:</p>
<ol>
<li class="mce-root">Right-click on any cell within the table to access the <span class="packt_screen">Quick Analysis</span> option:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2734cb57-0024-4c90-a871-5c108cf017ae.png" style="width:55.50em;height:31.17em;"/></p>
<ol start="2">
<li>In the pop-up window, we can choose the chart type. Select <span class="packt_screen">Clustered Column</span>, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a7420df0-40ff-4eea-bb36-15732c1c7e96.png" style="width:26.50em;height:12.42em;"/></p>
<p style="padding-left: 60px"><span>By default, Excel creates a</span> pivot table <span>showing</span> <span>some variables; we need to change the variables and the grouping operation to reflect what we need.</span></p>
<ol start="3">
<li><span>In the lower-right corner, we will see a window labeled</span> <span><span class="packt_screen">Σ</span>.</span> <span><span>Inside it, we can click on the variable and display the menu, as shown in the following screenshot:</span></span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/a9b2eae9-63ad-4c83-92a8-db4b401c6416.png" style="width:55.42em;height:31.00em;"/></p>
<ol start="4">
<li>Click on <span class="packt_screen">Value Field Settings</span>; you will see a pop-up window, similar to the one in the following screenshot, where you can change from <span class="packt_screen">Sum</span> to <span class="packt_screen">Count</span>, since we want to <span class="packt_screen">Count</span> the values, and then calculate the <span class="packt_screen">Sum</span> of them:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b523e8a3-3b04-455c-8413-c771a9db2856.png" style="width:29.00em;height:26.17em;"/></p>
<p style="padding-left: 60px">We converted the <kbd>Age</kbd> variable into <kbd>Age group</kbd>, so that is the variable that we now want to use. That is, we want to count how many passengers there are in a given age group.</p>
<ol start="5">
<li class="mce-root">Change the selection in <span class="packt_screen">PivotChart Fiel</span><span class="packt_screen">ds</span> to <kbd>Age group</kbd>.</li>
<li class="mce-root">Now, change the chart title and move it so that it looks similar to the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1a6d080d-636b-4e98-8c36-fa6d790bb6ed.png" style="width:55.42em;height:31.00em;"/></p>
<p style="padding-left: 60px"><span>We can see that most of the listed passengers are adults. We have missing information for many of the passengers in the list, and the rest of the groups share a small number of passengers</span><span>. The table that is used in the chart can be seen in the top-left corner.</span></p>
<p style="padding-left: 60px"><span>An interesting question to ask is, <em>Is there any difference in the survival probability for different age groups?</em> To answer this, we need to add the</span> <kbd>survived</kbd> <span>variable to the</span> <span class="packt_screen">A</span><span class="packt_screen"><span>xis (Categories)</span></span> <span>window, which is available at the bottom right-hand corner of the sheet. We do this by dragging the variable from the</span> <span class="packt_screen"><span>PivotCharts</span> Fields</span> <span>window and dropping it into</span> <span class="packt_screen">A<span>xis</span></span><span>.</span> <span>The resulting</span> <span>chart is as follows:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c3fbc1b6-58d2-41ac-98a4-626b6f85f3c3.png" style="width:55.50em;height:31.08em;"/></p>
<p style="padding-left: 60px"><span>T</span><span>here's a notable problem with this chart – we cannot easily compare the age groups since their members are very different in number. The solution is to refer everything to the total number of passenger</span><span>s</span> <span>in each age group and show percentages instead.</span> <span>Looking at the previous chart, we can see that the data is grouped first by</span> <kbd>Age group</kbd><span>,</span> <span>and then by</span> <kbd>survived</kbd>. <span>The first one is the parent variable. Repeat the steps we described previously to navigate to the</span> <span><span class="packt_screen">Value Field Settings</span></span> menu; you will <span>see a pop-up window like the one that's shown in the following screenshot:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c4279dc3-3ac7-46b8-ba07-f304b0e10808.png" style="width:28.75em;height:25.67em;"/></p>
<ol start="7">
<li><span>C</span><span>lick on</span> <span>the</span> <span><span class="packt_screen">Show Values As</span></span> tab, as shown in the preceding screenshot.</li>
<li><span>Choose the</span> <span><span class="packt_screen">% of Parent Total</span></span> option <span>and the</span> <kbd><span>Age group</span></kbd> field <span>as the parent;</span> t<span>he result is shown in the following screenshot:</span></li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/29b28933-9525-44da-a880-9b405763e61a.png" style="width:54.83em;height:30.75em;"/></p>
<p><span>T</span><span>he percentage is relative to the total number of passengers within each age group, and it is now easier to compare. A large percentage of the elderly group did not survive the shipwreck, most adults suffered the same fate, and the numbers for children and teenagers seem even. It is also clear that most infants survived, probably because they were given priority to board the</span> <span>life</span><span>boats.</span></p>
<p><span>Repeating the same steps, we can assume that it was more probable for passengers travelling in first class to survive compared to other passengers;</span> <span>consider the following chart:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/092b7049-dbdc-4d2e-8d70-eb83f36d5f0c.png" style="width:56.75em;height:31.75em;"/></p>
<p><span>Yes, it was easier to survive if you traveled first class than if you were in third. This is a known fact about the Titanic tragedy, and we can see it reflected in the data. Travel conditions were very different in different classes, as well as safety measures.</span></p>
<p><span>Now, what about gender? Does it matter if the passenger was a man or a woman? Let's build a histogram of the number of men and women that survived and use it to answer our question. The resulting chart is shown in the following screenshot:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fed2c9b4-1511-406e-82bd-35a0d9d98559.png" style="width:56.42em;height:31.75em;"/></p>
<p><span>As you can see, gender</span> <span>clearly matters. The women survivors have a higher probability than men, at least in general terms. The reason for this might be because women were given priority to board the lifeboats, while the men, especially the young ones, were delayed in order to help other passengers, and so they couldn't make it to the lifeboats in time.</span></p>
<p><span>We have used a combination of the previous knowledge of our dataset and information from the data to better understand what we can and cannot do with it. You are encouraged to create diagrams for other variables and combinations, and try to understand the results. It is extremely important to understand the basic details of a dataset in order to understand whether the result we obtain from the machine learning models make sense.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding unbalanced datasets</h1>
                </header>
            
            <article>
                
<p>To be able to compare the results of different variables, we need to take into account the different number of samples of each class. Let's suppose that we want to train a machine learning model to predict whether a given passenger would survive, based on age group, gender, and class. If we plot the distribution of values in the <kbd>survived</kbd> variable, we will see the following:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2cc73f59-c193-47c3-a681-124cb8a95598.png"/></p>
<p>It is clear from the preceding diagram and table that there are nearly twice as many non-survivors than survivors. If we use this dataset as is, we are introducing a bias to our dataset that will affect the results. Predicting <kbd>0</kbd> for the survival variable will be approximately two times more probable than predicting <kbd>1</kbd>. An exception to this statement are decision trees and their related predictive models (such as random forests and XGBoost), which can correctly deal with unbalanced datasets. Other models, especially neural networks, are very sensitive to uneven datasets. Race, gender, and other biases in algorithms raise concerns about the wide use of <span><strong>Artificial Intelligence</strong> (<strong>AI</strong>)</span> to make decisions at all levels. This is a serious problem when applying AI to real life, and possible solutions to prevent it are still under study.</p>
<p>Given enough data entries, an easy way to balance the dataset is to randomly choose a number of entries from the majority class that is equal to that of the minority class. In this case, we might choose 500 rows from the rows that show <kbd>survivor</kbd> as <kbd>0</kbd>. Let's do that using the following steps:</p>
<ol>
<li>Filter the entries, as shown in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1eba5675-8e45-4da5-b57e-2aff05112f8f.png" style="width:56.58em;height:31.75em;"/></p>
<ol start="2">
<li>Copy the entries and paste them into a new worksheet.</li>
<li>Insert a new column at the beginning, named <kbd>ID</kbd>.</li>
<li>Turn the data into a table (<span class="packt_screen">Insert</span> | <span class="packt_screen">Table</span>, keeping the first row as headers).</li>
<li>Enter the following formula in the first cell and copy it into the rest of the column:</li>
</ol>
<p style="padding-left: 90px" class="CDPAlignLeft CDPAlign"><em><span>=RAND()</span></em></p>
<ol start="6">
<li>Make sure that the automatic calculation is switched off. To do this, navigate to <span class="packt_screen">Formulas</span> | <span class="packt_screen">Calculation Options</span> and check <span class="packt_screen">Manual</span>. This will prevent the random numbers from changing automatically:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/65a3b784-6970-467f-8acd-a323c3b0b6c4.png" style="width:55.50em;height:31.17em;"/></p>
<ol start="7">
<li>Order the data by ID (you can choose ascending or descending order, it does not make any difference).</li>
<li>Select the first 500 rows to be your random sample.</li>
<li>Copy these rows to a new sheet.</li>
<li>Add the 500 rows with <kbd>survived</kbd> as <kbd>1</kbd>.</li>
</ol>
<p>You have now a perfectly balanced dataset containing 1,000 entries, which you can now use to train your machine learning model.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we explored different methods of dealing with missing data and learned how to group or summarize it. We have shown you how important it is to visualize the data after cleaning, in order to be able to understand and interpret the results, from basic to more advanced model predictions. This is the beginning of any feature engineering, since we transform and/or discard features based on their values. Too many missing values will imply that we cannot use that variable (or feature), or a high correlation will imply that we can discard one of the correlated variables. We will dive deeper into correlations in the next chapter, showing you how to measure them quantitatively, using different methods.</p>
<p>Preliminary data visualization is extremely important to gain an understanding of data properties and to interpret the results we obtain, even after applying a machine learning model.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li class="mce-root">Reviewing what was explained in the previous chapter, build a decision tree using <kbd>class</kbd>, <kbd>gender</kbd>, and <kbd>Age group</kbd> as features, and <kbd>survived</kbd> as the target variable. You should be able to define some conditions for a passenger to survive.</li>
<li>What variables in the dataset do you think are highly correlated?</li>
<li>Suppose that the dataset contains a numerical variable with only a few missing values. Is it possible to replace these missing values with numerical values? What value would you use?</li>
<li>Explain what bias means and why it is important to avoid it.</li>
<li>What other types of diagrams could be use for preliminary data analysis? Try some of them in the given dataset.</li>
</ol>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<ul>
<li><em>Best Practices in Data Cleaning: A Complete Guide to Everything You Need to Do Before and After Collecting Your Data</em>, <em>1st Edition</em>, by Jason W. Osborn</li>
<li><em>Introduction to Data Visualization Techniques Using Microsoft Excel 2013 &amp; Web-based Tools</em>, by <span>Tufts Data Lab</span></li>
<li><em>Analysing the Classification of Imbalanced Data-sets with Multiple Classes: Binarization Techniques and Ad-Hoc Approaches for Preprocessing and Cost Sensitive Learning</em>, by A. Fernández, V. López, M. Galar, M.J. del Jesus and F. Herrera</li>
</ul>


            </article>

            
        </section>
    </body></html>
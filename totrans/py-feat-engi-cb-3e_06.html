<html><head></head><body>
<div id="_idContainer117">
<h1 class="chapter-number" id="_idParaDest-168"><a id="_idTextAnchor748"/><span class="koboSpan" id="kobo.1.1" xmlns:="http://www.w3.org/1999/xhtml">6</span></h1>
<h1 id="_idParaDest-169"><a id="_idTextAnchor749"/><a id="_idTextAnchor750"/><span class="koboSpan" id="kobo.2.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting Features from Date and Time Variables</span></h1>
<p><span class="koboSpan" id="kobo.3.1" xmlns:="http://www.w3.org/1999/xhtml">Date and time variables contain information about dates, times, or both, and in programming, we refer to them collectively as </span><strong class="source-inline"><span class="koboSpan" id="kobo.4.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.5.1" xmlns:="http://www.w3.org/1999/xhtml"> features. </span><span class="koboSpan" id="kobo.5.2" xmlns:="http://www.w3.org/1999/xhtml">Date of birth, the time of an event, and the date and time of the last payment are examples of </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.6.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.7.1" xmlns:="http://www.w3.org/1999/xhtml"> variables.</span></span></p>
<p><span class="koboSpan" id="kobo.8.1" xmlns:="http://www.w3.org/1999/xhtml">Because of their nature, </span><strong class="source-inline"><span class="koboSpan" id="kobo.9.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.10.1" xmlns:="http://www.w3.org/1999/xhtml"> features typically exhibit high cardinality. </span><span class="koboSpan" id="kobo.10.2" xmlns:="http://www.w3.org/1999/xhtml">This means that they contain a huge number of unique values, each corresponding to a specific date and/or time combination. </span><span class="koboSpan" id="kobo.10.3" xmlns:="http://www.w3.org/1999/xhtml">We don’t normally use </span><strong class="source-inline"><span class="koboSpan" id="kobo.11.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.12.1" xmlns:="http://www.w3.org/1999/xhtml"> variables for machine learning models in their raw format. </span><span class="koboSpan" id="kobo.12.2" xmlns:="http://www.w3.org/1999/xhtml">Instead, we enrich the dataset by extracting multiple features from these variables. </span><span class="koboSpan" id="kobo.12.3" xmlns:="http://www.w3.org/1999/xhtml">These new features will typically have reduced cardinality, and allow us to capture meaningful information, such as trends, seasonality, and important events </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1" xmlns:="http://www.w3.org/1999/xhtml">and tendencies.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will explore how to extract features from dates and time by utilizing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.15.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.16.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.17.1" xmlns:="http://www.w3.org/1999/xhtml"> module, and then automate this procedure </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.19.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.20.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.21.1" xmlns:="http://www.w3.org/1999/xhtml">This chapter will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1" xmlns:="http://www.w3.org/1999/xhtml">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.23.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting features from dates </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.25.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span></li>
<li><span class="koboSpan" id="kobo.26.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting features from time </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.28.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span></li>
<li><span class="koboSpan" id="kobo.29.1" xmlns:="http://www.w3.org/1999/xhtml">Capturing elapsed time between </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.30.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.31.1" xmlns:="http://www.w3.org/1999/xhtml"> variables</span></span></li>
<li><span class="koboSpan" id="kobo.32.1" xmlns:="http://www.w3.org/1999/xhtml">Working with time in different </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1" xmlns:="http://www.w3.org/1999/xhtml">time zones</span></span></li>
<li><span class="koboSpan" id="kobo.34.1" xmlns:="http://www.w3.org/1999/xhtml">Automating </span><strong class="source-inline"><span class="koboSpan" id="kobo.35.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.36.1" xmlns:="http://www.w3.org/1999/xhtml"> feature extraction </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.38.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span></li>
</ul>
<h1 id="_idParaDest-170"><a id="_idTextAnchor751"/><a id="_idTextAnchor752"/><span class="koboSpan" id="kobo.39.1" xmlns:="http://www.w3.org/1999/xhtml">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.40.1" xmlns:="http://www.w3.org/1999/xhtml">In this chapter, we will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.41.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.42.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong><span class="koboSpan" id="kobo.44.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.46.1" xmlns:="http://www.w3.org/1999/xhtml">Python libraries.</span></span></p>
<h1 id="_idParaDest-171"><a id="_idTextAnchor753"/><a id="_idTextAnchor754"/><span class="koboSpan" id="kobo.47.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting features from dates with pandas</span></h1>
<p><span class="koboSpan" id="kobo.48.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><a id="_idIndexMarker423"/><span class="koboSpan" id="kobo.49.1" xmlns:="http://www.w3.org/1999/xhtml">values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.50.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.51.1" xmlns:="http://www.w3.org/1999/xhtml"> variables can be dates, time, or </span><a id="_idIndexMarker424"/><span class="koboSpan" id="kobo.52.1" xmlns:="http://www.w3.org/1999/xhtml">both. </span><span class="koboSpan" id="kobo.52.2" xmlns:="http://www.w3.org/1999/xhtml">We’ll begin by focusing on those variables that</span><a id="_idIndexMarker425"/><span class="koboSpan" id="kobo.53.1" xmlns:="http://www.w3.org/1999/xhtml"> contain dates. </span><span class="koboSpan" id="kobo.53.2" xmlns:="http://www.w3.org/1999/xhtml">We rarely use raw dat</span><a id="_idTextAnchor755"/><span class="koboSpan" id="kobo.54.1" xmlns:="http://www.w3.org/1999/xhtml">es with machine learning algorithms. </span><span class="koboSpan" id="kobo.54.2" xmlns:="http://www.w3.org/1999/xhtml">Instead, we extract simpler features, such as the year, month, or day of the week, that allow us to capture insights such as seasonality, periodicity, </span><span class="No-Break"><span class="koboSpan" id="kobo.55.1" xmlns:="http://www.w3.org/1999/xhtml">and trends.</span></span></p>
<p><span class="koboSpan" id="kobo.56.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.57.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.58.1" xmlns:="http://www.w3.org/1999/xhtml"> Python library is great for working with date and time. </span><span class="koboSpan" id="kobo.58.2" xmlns:="http://www.w3.org/1999/xhtml">Utilizing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.59.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.60.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.61.1" xmlns:="http://www.w3.org/1999/xhtml"> module, we can access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.62.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.63.1" xmlns:="http://www.w3.org/1999/xhtml"> properties of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.65.1" xmlns:="http://www.w3.org/1999/xhtml"> Series to extract many features. </span><span class="koboSpan" id="kobo.65.2" xmlns:="http://www.w3.org/1999/xhtml">However, to leverage this functionality, the variables need to be cast into a data type that supports these operations, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.67.1" xmlns:="http://www.w3.org/1999/xhtml">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.68.1" xmlns:="http://www.w3.org/1999/xhtml">timedelta</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.69.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.70.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.71.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.73.1" xmlns:="http://www.w3.org/1999/xhtml"> variables can be cast as objects, particularly when we load the data from a CSV file. </span><span class="koboSpan" id="kobo.73.2" xmlns:="http://www.w3.org/1999/xhtml">To extract the date and time features that we will discuss throughout this chapter, it is necessary to recast the variables </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1" xmlns:="http://www.w3.org/1999/xhtml">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.75.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.76.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.77.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will learn how to extract features from dates by </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1" xmlns:="http://www.w3.org/1999/xhtml">utilizing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.79.1" xmlns:="http://www.w3.org/1999/xhtml">panda</span><a id="_idTextAnchor756"/><a id="_idTextAnchor757"/><span class="koboSpan" id="kobo.80.1" xmlns:="http://www.w3.org/1999/xhtml">s</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.81.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-172"><a id="_idTextAnchor758"/><span class="koboSpan" id="kobo.82.1" xmlns:="http://www.w3.org/1999/xhtml">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.83.1" xmlns:="http://www.w3.org/1999/xhtml">The following are some of the features that we can extract from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.84.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong><span class="koboSpan" id="kobo.85.1" xmlns:="http://www.w3.org/1999/xhtml"> part of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.86.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.87.1" xmlns:="http://www.w3.org/1999/xhtml"> variable off the shelf </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.89.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.90.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.91.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.year</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.92.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.quarter</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.93.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.month</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.94.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.isocalendar().week</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.95.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.day</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.96.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.day_of_week</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.97.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.weekday</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.98.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.dayofyear</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.99.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.day_of_year</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.100.1" xmlns:="http://www.w3.org/1999/xhtml">We can </span><a id="_idIndexMarker426"/><span class="koboSpan" id="kobo.101.1" xmlns:="http://www.w3.org/1999/xhtml">use the features we’ve obtained with </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.103.1" xmlns:="http://www.w3.org/1999/xhtml"> to</span><a id="_idIndexMarker427"/><span class="koboSpan" id="kobo.104.1" xmlns:="http://www.w3.org/1999/xhtml"> create even more features, such as the semester or </span><a id="_idIndexMarker428"/><span class="koboSpan" id="kobo.105.1" xmlns:="http://www.w3.org/1999/xhtml">whether it is a weekend. </span><span class="koboSpan" id="kobo.105.2" xmlns:="http://www.w3.org/1999/xhtml">We will learn how to do this in the </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1" xmlns:="http://www.w3.org/1999/xhtml">next sec</span><a id="_idTextAnchor759"/><a id="_idTextAnchor760"/><span class="koboSpan" id="kobo.107.1" xmlns:="http://www.w3.org/1999/xhtml">tion.</span></span></p>
<h2 id="_idParaDest-173"><a id="_idTextAnchor761"/><span class="koboSpan" id="kobo.108.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.109.1" xmlns:="http://www.w3.org/1999/xhtml">To pr</span><a id="_idTextAnchor762"/><span class="koboSpan" id="kobo.110.1" xmlns:="http://www.w3.org/1999/xhtml">oceed with the recipe, let’s i</span><a id="_idTextAnchor763"/><span class="koboSpan" id="kobo.111.1" xmlns:="http://www.w3.org/1999/xhtml">mport </span><strong class="source-inline"><span class="koboSpan" id="kobo.112.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.113.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong><span class="koboSpan" id="kobo.115.1" xmlns:="http://www.w3.org/1999/xhtml">, and create a </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1" xmlns:="http://www.w3.org/1999/xhtml">sample DataFrame:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.117.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1" xmlns:="http://www.w3.org/1999/xhtml">the libraries:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.119.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np
import pandas as pd</span></pre></li> <li><span class="koboSpan" id="kobo.120.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll start by creating 20 </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.122.1" xmlns:="http://www.w3.org/1999/xhtml"> values beginning from </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1" xmlns:="http://www.w3.org/1999/xhtml">2024-05-17</span></strong><span class="koboSpan" id="kobo.124.1" xmlns:="http://www.w3.org/1999/xhtml"> at midnight and followed by increments of 1 day. </span><span class="koboSpan" id="kobo.124.2" xmlns:="http://www.w3.org/1999/xhtml">Then, we’ll capture those values in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1" xmlns:="http://www.w3.org/1999/xhtml">DataFrame</span></strong><span class="koboSpan" id="kobo.126.1" xmlns:="http://www.w3.org/1999/xhtml"> instance and display the top </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1" xmlns:="http://www.w3.org/1999/xhtml">five rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.128.1" xmlns:="http://www.w3.org/1999/xhtml">
rng_ = pd.date_range(
    "2024-05-17", periods=20, freq="D")
data = pd.DataFrame({"date": rng_})
data.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.129.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we see the variable containing dates that we created in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.130.1" xmlns:="http://www.w3.org/1999/xhtml">Ste</span><a id="_idTextAnchor764"/><span class="koboSpan" id="kobo.131.1" xmlns:="http://www.w3.org/1999/xhtml">p 2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.132.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer094">
<span class="koboSpan" id="kobo.133.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.1 – Top rows of a DataFrame with a datetime variable containing only dates" src="image/B22396_06_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.134.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.1 – Top rows of a DataFrame with a datetime variable containing only dates</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.135.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.136.1" xmlns:="http://www.w3.org/1999/xhtml">We can check the data format of the variable by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1" xmlns:="http://www.w3.org/1999/xhtml">data["date"].dtypes</span></strong><span class="koboSpan" id="kobo.138.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.138.2" xmlns:="http://www.w3.org/1999/xhtml">If the variable is cast as an object, we can convert it into </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.140.1" xmlns:="http://www.w3.org/1999/xhtml"> format by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1" xmlns:="http://www.w3.org/1999/xhtml">data["date_dt"] = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.142.1" xmlns:="http://www.w3.org/1999/xhtml">pd.to_datetime(data["date"])</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.143.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.144.1" xmlns:="http://www.w3.org/1999/xhtml">L</span><a id="_idTextAnchor765"/><span class="koboSpan" id="kobo.145.1" xmlns:="http://www.w3.org/1999/xhtml">et’s</span><a id="_idIndexMarker429"/><span class="koboSpan" id="kobo.146.1" xmlns:="http://www.w3.org/1999/xhtml"> extract the year pa</span><a id="_idTextAnchor766"/><span class="koboSpan" id="kobo.147.1" xmlns:="http://www.w3.org/1999/xhtml">rt of the date in a </span><a id="_idIndexMarker430"/><span class="koboSpan" id="kobo.148.1" xmlns:="http://www.w3.org/1999/xhtml">new column and display the top five rows of</span><a id="_idIndexMarker431"/><span class="koboSpan" id="kobo.149.1" xmlns:="http://www.w3.org/1999/xhtml"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.151.1" xmlns:="http://www.w3.org/1999/xhtml">
data["year"] = data["date"].dt.year
data.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.152.1" xmlns:="http://www.w3.org/1999/xhtml">We see the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1" xmlns:="http://www.w3.org/1999/xhtml">year</span></strong><span class="koboSpan" id="kobo.154.1" xmlns:="http://www.w3.org/1999/xhtml"> variable in the </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1" xmlns:="http://www.w3.org/1999/xhtml">following o</span><a id="_idTextAnchor767"/><span class="koboSpan" id="kobo.156.1" xmlns:="http://www.w3.org/1999/xhtml">utput:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer095">
<span class="koboSpan" id="kobo.157.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.2 – First five rows of the DataFrame with the year variable extracted from the date" src="image/B22396_06_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.158.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.2 – First five rows of the DataFrame with the year variable extracted from the date</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.159.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s extract the quarter of the year out of the date into a new column and display the top </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1" xmlns:="http://www.w3.org/1999/xhtml">five rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.161.1" xmlns:="http://www.w3.org/1999/xhtml">
data["quarter"] = data["date"].dt.quarter
data[["date", "quarter"]].head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.162.1" xmlns:="http://www.w3.org/1999/xhtml">We see the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1" xmlns:="http://www.w3.org/1999/xhtml">quarter</span></strong><span class="koboSpan" id="kobo.164.1" xmlns:="http://www.w3.org/1999/xhtml"> variable in the </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1" xmlns:="http://www.w3.org/1999/xhtml">following ou</span><a id="_idTextAnchor768"/><span class="koboSpan" id="kobo.166.1" xmlns:="http://www.w3.org/1999/xhtml">tput:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer096">
<span class="koboSpan" id="kobo.167.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.3 – The first five rows of a DataFrame with the quarter variable extracted from the date" src="image/B22396_06_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.168.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.3 – The first five rows of a DataFrame with the quarter variable extracted from the date</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.169.1" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1" xmlns:="http://www.w3.org/1999/xhtml">quarte</span><a id="_idTextAnchor769"/><span class="koboSpan" id="kobo.171.1" xmlns:="http://www.w3.org/1999/xhtml">r</span></strong><span class="koboSpan" id="kobo.172.1" xmlns:="http://www.w3.org/1999/xhtml">, we </span><a id="_idIndexMarker432"/><span class="koboSpan" id="kobo.173.1" xmlns:="http://www.w3.org/1999/xhtml">c</span><a id="_idTextAnchor770"/><span class="koboSpan" id="kobo.174.1" xmlns:="http://www.w3.org/1999/xhtml">an</span><a id="_idIndexMarker433"/><span class="koboSpan" id="kobo.175.1" xmlns:="http://www.w3.org/1999/xhtml"> now </span><a id="_idIndexMarker434"/><span class="koboSpan" id="kobo.176.1" xmlns:="http://www.w3.org/1999/xhtml">create the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.177.1" xmlns:="http://www.w3.org/1999/xhtml">semester</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.178.1" xmlns:="http://www.w3.org/1999/xhtml"> feature:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.179.1" xmlns:="http://www.w3.org/1999/xhtml">
data["semester"] = np.where(data["quarter"] &lt; 3, 1, 2)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.180.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.181.1" xmlns:="http://www.w3.org/1999/xhtml">You can explore the distinct values of the new variables utilizing </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.183.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1" xmlns:="http://www.w3.org/1999/xhtml">unique()</span></strong><span class="koboSpan" id="kobo.185.1" xmlns:="http://www.w3.org/1999/xhtml">, for example, by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1" xmlns:="http://www.w3.org/1999/xhtml">df["quarter"].unique()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.187.1" xmlns:="http://www.w3.org/1999/xhtml">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.188.1" xmlns:="http://www.w3.org/1999/xhtml">df["semester"].unique()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.189.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.190.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s extract the </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1" xmlns:="http://www.w3.org/1999/xhtml">month</span></strong><span class="koboSpan" id="kobo.192.1" xmlns:="http://www.w3.org/1999/xhtml"> part of the date in a new column and display the top five rows of </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1" xmlns:="http://www.w3.org/1999/xhtml">the DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.194.1" xmlns:="http://www.w3.org/1999/xhtml">
data["month"] = data["date"].dt.month
data[["date", "month"]].head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.195.1" xmlns:="http://www.w3.org/1999/xhtml">We </span><a id="_idIndexMarker435"/><span class="koboSpan" id="kobo.196.1" xmlns:="http://www.w3.org/1999/xhtml">see the</span><a id="_idIndexMarker436"/><span class="koboSpan" id="kobo.197.1" xmlns:="http://www.w3.org/1999/xhtml"> new </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1" xmlns:="http://www.w3.org/1999/xhtml">month</span></strong><span class="koboSpan" id="kobo.199.1" xmlns:="http://www.w3.org/1999/xhtml"> variable</span><a id="_idIndexMarker437"/><span class="koboSpan" id="kobo.200.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1" xmlns:="http://www.w3.org/1999/xhtml">followi</span><a id="_idTextAnchor771"/><span class="koboSpan" id="kobo.202.1" xmlns:="http://www.w3.org/1999/xhtml">ng output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer097">
<span class="koboSpan" id="kobo.203.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.4 – The first five rows of a DataFrame with the new month vari﻿able" src="image/B22396_06_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.204.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.4 – The first five rows of a DataFrame with the new month vari</span><a id="_idTextAnchor772"/><span class="koboSpan" id="kobo.205.1" xmlns:="http://www.w3.org/1999/xhtml">able</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.206.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s extract the week number (a year has 52 weeks) from </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1" xmlns:="http://www.w3.org/1999/xhtml">the date:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.208.1" xmlns:="http://www.w3.org/1999/xhtml">
data["week"] = data["date"].dt.isocalendar().week
data[["date", "week"]]</span><a id="_idTextAnchor773"/><span class="koboSpan" id="kobo.209.1" xmlns:="http://www.w3.org/1999/xhtml">.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.210.1" xmlns:="http://www.w3.org/1999/xhtml">We see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.211.1" xmlns:="http://www.w3.org/1999/xhtml">week</span></strong><span class="koboSpan" id="kobo.212.1" xmlns:="http://www.w3.org/1999/xhtml"> variable in the </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1" xmlns:="http://www.w3.org/1999/xhtml">followin</span><a id="_idTextAnchor774"/><span class="koboSpan" id="kobo.214.1" xmlns:="http://www.w3.org/1999/xhtml">g output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer098">
<span class="koboSpan" id="kobo.215.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.5 – The first five rows of a DataFrame with the new week variable" src="image/B22396_06_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.216.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.5 – The first five rows of a DataFrame with the new week variable</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.217.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s extract the day of the month, which can take values between </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.219.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1" xmlns:="http://www.w3.org/1999/xhtml">31</span></strong><span class="koboSpan" id="kobo.221.1" xmlns:="http://www.w3.org/1999/xhtml">, into a </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1" xmlns:="http://www.w3.org/1999/xhtml">new column:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.223.1" xmlns:="http://www.w3.org/1999/xhtml">
data["day_mo"] = data["date"].dt.day
data[["date", "day_mo"]].head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.224.1" xmlns:="http://www.w3.org/1999/xhtml">We </span><a id="_idIndexMarker438"/><span class="koboSpan" id="kobo.225.1" xmlns:="http://www.w3.org/1999/xhtml">see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.226.1" xmlns:="http://www.w3.org/1999/xhtml">day_mo</span></strong><span class="koboSpan" id="kobo.227.1" xmlns:="http://www.w3.org/1999/xhtml"> variable</span><a id="_idIndexMarker439"/><span class="koboSpan" id="kobo.228.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><a id="_idIndexMarker440"/><span class="No-Break"><span class="koboSpan" id="kobo.229.1" xmlns:="http://www.w3.org/1999/xhtml">follow</span><a id="_idTextAnchor775"/><span class="koboSpan" id="kobo.230.1" xmlns:="http://www.w3.org/1999/xhtml">ing output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer099">
<span class="koboSpan" id="kobo.231.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.6 – The top rows of a DataFrame with the new variable capturing the day of the ﻿month" src="image/B22396_06_6.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.232.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.6 – The top rows of a DataFrame with the new variable capturing the day of the </span><a id="_idTextAnchor776"/><span class="koboSpan" id="kobo.233.1" xmlns:="http://www.w3.org/1999/xhtml">month</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.234.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s extract the day of the</span><a id="_idTextAnchor777"/><span class="koboSpan" id="kobo.235.1" xmlns:="http://www.w3.org/1999/xhtml"> week, with values between </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.237.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1" xmlns:="http://www.w3.org/1999/xhtml">6</span></strong><span class="koboSpan" id="kobo.239.1" xmlns:="http://www.w3.org/1999/xhtml"> (from Monday to Sunday), in a new column, then display the </span><span class="No-Break"><span class="koboSpan" id="kobo.240.1" xmlns:="http://www.w3.org/1999/xhtml">top rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.241.1" xmlns:="http://www.w3.org/1999/xhtml">
data["day_week"] = data["date"].dt.dayofweek
data[["date", "day_mo", "day_week"]].head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.242.1" xmlns:="http://www.w3.org/1999/xhtml">We see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1" xmlns:="http://www.w3.org/1999/xhtml">day_week</span></strong><span class="koboSpan" id="kobo.244.1" xmlns:="http://www.w3.org/1999/xhtml"> variable in the </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1" xmlns:="http://www.w3.org/1999/xhtml">followi</span><a id="_idTextAnchor778"/><span class="koboSpan" id="kobo.246.1" xmlns:="http://www.w3.org/1999/xhtml">ng output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer100">
<span class="koboSpan" id="kobo.247.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.7 – The top rows of a DataFrame with a new variable representing days of a week" src="image/B22396_06_7.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.248.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.7 – The top rows of a DataFrame with a new variable representing days of a week</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.249.1" xmlns:="http://www.w3.org/1999/xhtml">With the variable from </span><em class="italic"><span class="koboSpan" id="kobo.250.1" xmlns:="http://www.w3.org/1999/xhtml">Step 9</span></em><span class="koboSpan" id="kobo.251.1" xmlns:="http://www.w3.org/1999/xhtml">, we can create a binary variable that indicates whether it was </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1" xmlns:="http://www.w3.org/1999/xhtml">a weekend:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.253.1" xmlns:="http://www.w3.org/1999/xhtml">
data["is_weekend"] = (
    data[«date»].dt.dayofweek &gt; 4).astype(int)
data[["date", "day_week", "is_weekend"]].head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.254.1" xmlns:="http://www.w3.org/1999/xhtml">We </span><a id="_idIndexMarker441"/><span class="koboSpan" id="kobo.255.1" xmlns:="http://www.w3.org/1999/xhtml">see</span><a id="_idIndexMarker442"/><span class="koboSpan" id="kobo.256.1" xmlns:="http://www.w3.org/1999/xhtml"> the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.257.1" xmlns:="http://www.w3.org/1999/xhtml">is_weekend</span></strong><span class="koboSpan" id="kobo.258.1" xmlns:="http://www.w3.org/1999/xhtml"> variable </span><a id="_idIndexMarker443"/><span class="koboSpan" id="kobo.259.1" xmlns:="http://www.w3.org/1999/xhtml">in the </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1" xmlns:="http://www.w3.org/1999/xhtml">follo</span><a id="_idTextAnchor779"/><span class="koboSpan" id="kobo.261.1" xmlns:="http://www.w3.org/1999/xhtml">wing output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer101">
<span class="koboSpan" id="kobo.262.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.8 – The first five rows of a DataFrame with the new is_weekend variable" src="image/B22396_06_8.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.263.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.8 – The first five rows of a DataFrame with the new is_weekend variable</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.264.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.265.1" xmlns:="http://www.w3.org/1999/xhtml">We can automate the extraction of all these features by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.267.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.267.2" xmlns:="http://www.w3.org/1999/xhtml">Check out the </span><em class="italic"><span class="koboSpan" id="kobo.268.1" xmlns:="http://www.w3.org/1999/xhtml">Automating datetime feature extraction with feature-engine</span></em><span class="koboSpan" id="kobo.269.1" xmlns:="http://www.w3.org/1999/xhtml"> recipe in this chapter for </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1" xmlns:="http://www.w3.org/1999/xhtml">more details.</span></span></p>
<p><span class="koboSpan" id="kobo.271.1" xmlns:="http://www.w3.org/1999/xhtml">With t</span><a id="_idTextAnchor780"/><span class="koboSpan" id="kobo.272.1" xmlns:="http://www.w3.org/1999/xhtml">hat, we have extracted many </span><a id="_idTextAnchor781"/><span class="koboSpan" id="kobo.273.1" xmlns:="http://www.w3.org/1999/xhtml">new features from the date part of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.274.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.275.1" xmlns:="http://www.w3.org/1999/xhtml"> variable using </span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.277.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.277.2" xmlns:="http://www.w3.org/1999/xhtml">These features are useful for data analysis, visualization, and </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1" xmlns:="http://www.w3.org/1999/xhtml">predictiv</span><a id="_idTextAnchor782"/><a id="_idTextAnchor783"/><span class="koboSpan" id="kobo.279.1" xmlns:="http://www.w3.org/1999/xhtml">e modelling.</span></span></p>
<h2 id="_idParaDest-174"><a id="_idTextAnchor784"/><span class="koboSpan" id="kobo.280.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.281.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we</span><a id="_idIndexMarker444"/><span class="koboSpan" id="kobo.282.1" xmlns:="http://www.w3.org/1999/xhtml"> extracted many date-related features from a </span><strong class="source-inline"><span class="koboSpan" id="kobo.283.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.284.1" xmlns:="http://www.w3.org/1999/xhtml"> variable</span><a id="_idIndexMarker445"/><span class="koboSpan" id="kobo.285.1" xmlns:="http://www.w3.org/1999/xhtml"> by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.287.1" xmlns:="http://www.w3.org/1999/xhtml"> module from </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.289.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.289.2" xmlns:="http://www.w3.org/1999/xhtml">First, we </span><a id="_idIndexMarker446"/><span class="koboSpan" id="kobo.290.1" xmlns:="http://www.w3.org/1999/xhtml">created a sample DataFrame with a variable that contained dates. </span><span class="koboSpan" id="kobo.290.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.292.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1" xmlns:="http://www.w3.org/1999/xhtml">date_range()</span></strong><span class="koboSpan" id="kobo.294.1" xmlns:="http://www.w3.org/1999/xhtml"> to create a range of values starting from an arbitrary date and increasing the time by intervals of </span><strong class="source-inline"><span class="koboSpan" id="kobo.295.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.296.1" xmlns:="http://www.w3.org/1999/xhtml"> day. </span><span class="koboSpan" id="kobo.296.2" xmlns:="http://www.w3.org/1999/xhtml">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1" xmlns:="http://www.w3.org/1999/xhtml">periods</span></strong><span class="koboSpan" id="kobo.298.1" xmlns:="http://www.w3.org/1999/xhtml"> argument, we indicated the number of values to create in the range – that is, the number of dates. </span><span class="koboSpan" id="kobo.298.2" xmlns:="http://www.w3.org/1999/xhtml">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1" xmlns:="http://www.w3.org/1999/xhtml">freq</span></strong><span class="koboSpan" id="kobo.300.1" xmlns:="http://www.w3.org/1999/xhtml"> argument, we indicated the size of the steps between the dates. </span><span class="koboSpan" id="kobo.300.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1" xmlns:="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.302.1" xmlns:="http://www.w3.org/1999/xhtml"> for days in our example. </span><span class="koboSpan" id="kobo.302.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, we transformed the date range into a DataFrame with </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.303.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"> </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.304.1" xmlns:="http://www.w3.org/1999/xhtml">DataFrame()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.305.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.306.1" xmlns:="http://www.w3.org/1999/xhtml">To extract the different parts of a date, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.308.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.310.1" xmlns:="http://www.w3.org/1999/xhtml"> to access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.312.1" xmlns:="http://www.w3.org/1999/xhtml"> properties of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.314.1" xmlns:="http://www.w3.org/1999/xhtml"> Series and then utilized the different properties. </span><span class="koboSpan" id="kobo.314.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1" xmlns:="http://www.w3.org/1999/xhtml">year</span></strong><span class="koboSpan" id="kobo.316.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1" xmlns:="http://www.w3.org/1999/xhtml">month</span></strong><span class="koboSpan" id="kobo.318.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1" xmlns:="http://www.w3.org/1999/xhtml">quarter</span></strong><span class="koboSpan" id="kobo.320.1" xmlns:="http://www.w3.org/1999/xhtml"> to capture the year, month, and quarter into new columns of the DataFrame. </span><span class="koboSpan" id="kobo.320.2" xmlns:="http://www.w3.org/1999/xhtml">To find the semester, we created a Boolean using NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1" xmlns:="http://www.w3.org/1999/xhtml">where()</span></strong><span class="koboSpan" id="kobo.322.1" xmlns:="http://www.w3.org/1999/xhtml"> in combination with the newly created </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1" xmlns:="http://www.w3.org/1999/xhtml">quarter</span></strong><span class="koboSpan" id="kobo.324.1" xmlns:="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.324.2" xmlns:="http://www.w3.org/1999/xhtml">NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.325.1" xmlns:="http://www.w3.org/1999/xhtml">where()</span></strong><span class="koboSpan" id="kobo.326.1" xmlns:="http://www.w3.org/1999/xhtml"> scanned the values of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1" xmlns:="http://www.w3.org/1999/xhtml">quarter</span></strong><span class="koboSpan" id="kobo.328.1" xmlns:="http://www.w3.org/1999/xhtml"> variable; if they were smaller than </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1" xmlns:="http://www.w3.org/1999/xhtml">3</span></strong><span class="koboSpan" id="kobo.330.1" xmlns:="http://www.w3.org/1999/xhtml">, it returned the value of  </span><strong class="source-inline"><span class="koboSpan" id="kobo.331.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.332.1" xmlns:="http://www.w3.org/1999/xhtml"> for the first semester; otherwise, it returned the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.333.1" xmlns:="http://www.w3.org/1999/xhtml">2</span></strong><span class="koboSpan" id="kobo.334.1" xmlns:="http://www.w3.org/1999/xhtml">, corresponding to the </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1" xmlns:="http://www.w3.org/1999/xhtml">second semes</span><a id="_idTextAnchor785"/><span class="koboSpan" id="kobo.336.1" xmlns:="http://www.w3.org/1999/xhtml">ter.</span></span></p>
<p><span class="koboSpan" id="kobo.337.1" xmlns:="http://www.w3.org/1999/xhtml">To extract</span><a id="_idIndexMarker447"/><span class="koboSpan" id="kobo.338.1" xmlns:="http://www.w3.org/1999/xhtml"> the different</span><a id="_idTextAnchor786"/><span class="koboSpan" id="kobo.339.1" xmlns:="http://www.w3.org/1999/xhtml"> representations of days and weeks, we</span><a id="_idIndexMarker448"/><span class="koboSpan" id="kobo.340.1" xmlns:="http://www.w3.org/1999/xhtml"> used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1" xmlns:="http://www.w3.org/1999/xhtml">isocalender().week</span></strong><span class="koboSpan" id="kobo.342.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1" xmlns:="http://www.w3.org/1999/xhtml">day</span></strong><span class="koboSpan" id="kobo.344.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1" xmlns:="http://www.w3.org/1999/xhtml">dayofweek</span></strong><span class="koboSpan" id="kobo.346.1" xmlns:="http://www.w3.org/1999/xhtml"> properties. </span><span class="koboSpan" id="kobo.346.2" xmlns:="http://www.w3.org/1999/xhtml">With the day of the week, we went ahead </span><a id="_idIndexMarker449"/><span class="koboSpan" id="kobo.347.1" xmlns:="http://www.w3.org/1999/xhtml">and created a binary variable to indicate whether it was a weekend. </span><span class="koboSpan" id="kobo.347.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.348.1" xmlns:="http://www.w3.org/1999/xhtml">where()</span></strong><span class="koboSpan" id="kobo.349.1" xmlns:="http://www.w3.org/1999/xhtml"> to scan the day of the week, and if the value was greater than </span><strong class="source-inline"><span class="koboSpan" id="kobo.350.1" xmlns:="http://www.w3.org/1999/xhtml">4</span></strong><span class="koboSpan" id="kobo.351.1" xmlns:="http://www.w3.org/1999/xhtml">, which corresponds to Saturday and Sunday, the function returned </span><strong class="source-inline"><span class="koboSpan" id="kobo.352.1" xmlns:="http://www.w3.org/1999/xhtml">True</span></strong><span class="koboSpan" id="kobo.353.1" xmlns:="http://www.w3.org/1999/xhtml"> and otherwise </span><strong class="source-inline"><span class="koboSpan" id="kobo.354.1" xmlns:="http://www.w3.org/1999/xhtml">False</span></strong><span class="koboSpan" id="kobo.355.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.355.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, we cast this Boolean vector as an integer to have a binary variable with 1s and 0s. </span><span class="koboSpan" id="kobo.355.3" xmlns:="http://www.w3.org/1999/xhtml">With that, we created multiple features from dates that we can use for data analysis and </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1" xmlns:="http://www.w3.org/1999/xhtml">pre</span><a id="_idTextAnchor787"/><a id="_idTextAnchor788"/><span class="koboSpan" id="kobo.357.1" xmlns:="http://www.w3.org/1999/xhtml">dictive modelling.</span></span></p>
<h2 id="_idParaDest-175"><a id="_idTextAnchor789"/><span class="koboSpan" id="kobo.358.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.359.1" xmlns:="http://www.w3.org/1999/xhtml">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.361.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.362.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.363.1" xmlns:="http://www.w3.org/1999/xhtml"> module, we can</span><a id="_idIndexMarker450"/><span class="koboSpan" id="kobo.364.1" xmlns:="http://www.w3.org/1999/xhtml"> extract many more features from dates out of the</span><a id="_idIndexMarker451"/><span class="koboSpan" id="kobo.365.1" xmlns:="http://www.w3.org/1999/xhtml"> box. </span><span class="koboSpan" id="kobo.365.2" xmlns:="http://www.w3.org/1999/xhtml">For example, we can extract the beginning and end of a month, quarter, or year, whether it is a leap year, and the number of days in a month. </span><span class="koboSpan" id="kobo.365.3" xmlns:="http://www.w3.org/1999/xhtml">These are the functions that allow you to </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1" xmlns:="http://www.w3.org/1999/xhtml">do so:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.367.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.is_month_start</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.368.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.is_month_end</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.369.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.is_quarter_start</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.370.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.is_quarter_end</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.371.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.is_year_start</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.372.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.is_year_end</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.373.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.is_leap_year</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.374.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.days_in_month</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.375.1" xmlns:="http://www.w3.org/1999/xhtml">We can also return the number of days in a specific month with </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1" xmlns:="http://www.w3.org/1999/xhtml">pd.dt.days_in_month</span></strong><span class="koboSpan" id="kobo.377.1" xmlns:="http://www.w3.org/1999/xhtml"> and the day in a year (from </span><strong class="source-inline"><span class="koboSpan" id="kobo.378.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.379.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1" xmlns:="http://www.w3.org/1999/xhtml">365</span></strong><span class="koboSpan" id="kobo.381.1" xmlns:="http://www.w3.org/1999/xhtml">) </span><span class="No-Break"><span class="koboSpan" id="kobo.382.1" xmlns:="http://www.w3.org/1999/xhtml">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.383.1" xmlns:="http://www.w3.org/1999/xhtml">pd.dt</span><a id="_idTextAnchor790"/><span class="koboSpan" id="kobo.384.1" xmlns:="http://www.w3.org/1999/xhtml">.dayofyear</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.385.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1" xmlns:="http://www.w3.org/1999/xhtml">For </span><a id="_idIndexMarker452"/><span class="koboSpan" id="kobo.387.1" xmlns:="http://www.w3.org/1999/xhtml">more details, visit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.389.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.390.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.391.1" xmlns:="http://www.w3.org/1999/xhtml">documentation: </span></span><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-date-components"><span class="No-Break"><span class="koboSpan" id="kobo.392.1" xmlns:="http://www.w3.org/1999/xhtml">https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-date-components</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.393.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-176"><a id="_idTextAnchor791"/><span class="koboSpan" id="kobo.394.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.395.1" xmlns:="http://www.w3.org/1999/xhtml">To learn how to create</span><a id="_idIndexMarker453"/><span class="koboSpan" id="kobo.396.1" xmlns:="http://www.w3.org/1999/xhtml"> different </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.398.1" xmlns:="http://www.w3.org/1999/xhtml"> ranges with </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.400.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1" xmlns:="http://www.w3.org/1999/xhtml">date_ranges()</span></strong><span class="koboSpan" id="kobo.402.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1" xmlns:="http://www.w3.org/1999/xhtml">visit </span></span><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases"><span class="No-Break"><span class="koboSpan" id="kobo.404.1" xmlns:="http://www.w3.org/1999/xhtml">https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.405.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.406.1" xmlns:="http://www.w3.org/1999/xhtml">To learn more</span><a id="_idIndexMarker454"/><span class="koboSpan" id="kobo.407.1" xmlns:="http://www.w3.org/1999/xhtml"> about </span><strong class="source-inline"><span class="koboSpan" id="kobo.408.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.409.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.411.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1" xmlns:="http://www.w3.org/1999/xhtml">visit </span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/series.html#datetime-properties"><span class="No-Break"><span class="koboSpan" id="kobo.413.1" xmlns:="http://www.w3.org/1999/xhtml">https://pandas.pydata.org/pandas-docs/stable/reference/series.html#datetime-properties</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.414.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-177"><span class="koboSpan" id="kobo.415.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting features from time </span><a id="_idTextAnchor792"/><span class="koboSpan" id="kobo.416.1" xmlns:="http://www.w3.org/1999/xhtml">with pandas</span></h1>
<p><span class="koboSpan" id="kobo.417.1" xmlns:="http://www.w3.org/1999/xhtml">Some </span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.418.1" xmlns:="http://www.w3.org/1999/xhtml">events occ</span><a id="_idTextAnchor793"/><span class="koboSpan" id="kobo.419.1" xmlns:="http://www.w3.org/1999/xhtml">ur more often at certain times of the day – for</span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.420.1" xmlns:="http://www.w3.org/1999/xhtml"> example, fraudulent activity is more likely to occur</span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.421.1" xmlns:="http://www.w3.org/1999/xhtml"> during the night or early morning. </span><span class="koboSpan" id="kobo.421.2" xmlns:="http://www.w3.org/1999/xhtml">Air pollutant concentration also changes with the time of the day, with peaks at rush hour when there are more vehicles on the streets. </span><span class="koboSpan" id="kobo.421.3" xmlns:="http://www.w3.org/1999/xhtml">Therefore, deriving time features is extremely useful for data analysis and predictive modelling. </span><span class="koboSpan" id="kobo.421.4" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will extract different time parts of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.423.1" xmlns:="http://www.w3.org/1999/xhtml"> variable by u</span><a id="_idTextAnchor794"/><a id="_idTextAnchor795"/><span class="koboSpan" id="kobo.424.1" xmlns:="http://www.w3.org/1999/xhtml">tilizing </span><strong class="source-inline"><span class="koboSpan" id="kobo.425.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.426.1" xmlns:="http://www.w3.org/1999/xhtml">and NumPy.</span></span></p>
<h2 id="_idParaDest-178"><a id="_idTextAnchor796"/><span class="koboSpan" id="kobo.427.1" xmlns:="http://www.w3.org/1999/xhtml">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.428.1" xmlns:="http://www.w3.org/1999/xhtml">We can extract hours, minutes, and seconds using the following </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.430.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.431.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.432.1" xmlns:="http://www.w3.org/1999/xhtml"> properties:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.433.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.hour</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.434.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.minu</span><a id="_idTextAnchor797"/><a id="_idTextAnchor798"/><span class="koboSpan" id="kobo.435.1" xmlns:="http://www.w3.org/1999/xhtml">te</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.436.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.second</span></strong></span></li>
</ul>
<h2 id="_idParaDest-179"><a id="_idTextAnchor799"/><span class="koboSpan" id="kobo.437.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.438.1" xmlns:="http://www.w3.org/1999/xhtml">In this </span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.439.1" xmlns:="http://www.w3.org/1999/xhtml">recipe, we’ll </span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.440.1" xmlns:="http://www.w3.org/1999/xhtml">extract the </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1" xmlns:="http://www.w3.org/1999/xhtml">hour</span></strong><span class="koboSpan" id="kobo.442.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.443.1" xmlns:="http://www.w3.org/1999/xhtml">minute</span></strong><span class="koboSpan" id="kobo.444.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.445.1" xmlns:="http://www.w3.org/1999/xhtml">second</span></strong><span class="koboSpan" id="kobo.446.1" xmlns:="http://www.w3.org/1999/xhtml"> part of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.447.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong><span class="koboSpan" id="kobo.448.1" xmlns:="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.448.2" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing the</span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.449.1" xmlns:="http://www.w3.org/1999/xhtml"> libraries and creating a </span><span class="No-Break"><span class="koboSpan" id="kobo.450.1" xmlns:="http://www.w3.org/1999/xhtml">sample dataset:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.451.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.453.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.454.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.455.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.456.1" xmlns:="http://www.w3.org/1999/xhtml">
import numpy as np
import pandas as pd</span></pre></li> <li><span class="koboSpan" id="kobo.457.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by creating 20 </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.459.1" xmlns:="http://www.w3.org/1999/xhtml"> observations, start</span><a id="_idTextAnchor800"/><span class="koboSpan" id="kobo.460.1" xmlns:="http://www.w3.org/1999/xhtml">ing on </span><strong class="source-inline"><span class="koboSpan" id="kobo.461.1" xmlns:="http://www.w3.org/1999/xhtml">2024-05-17</span></strong><span class="koboSpan" id="kobo.462.1" xmlns:="http://www.w3.org/1999/xhtml"> at midnight and followed by increments of 1 hour, 15 minutes, and 10 seconds. </span><span class="koboSpan" id="kobo.462.2" xmlns:="http://www.w3.org/1999/xhtml">Next,</span><a id="_idTextAnchor801"/><span class="koboSpan" id="kobo.463.1" xmlns:="http://www.w3.org/1999/xhtml"> we’ll capture the time range in a DataFrame and display the top </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1" xmlns:="http://www.w3.org/1999/xhtml">five rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.465.1" xmlns:="http://www.w3.org/1999/xhtml">
rng_ = pd.date_range(
    "2024-05-17", periods=20, freq="1h15min10s")
df = pd.DataFrame({"date": rng_})
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.466.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we see the variable from </span><em class="italic"><span class="koboSpan" id="kobo.467.1" xmlns:="http://www.w3.org/1999/xhtml">Step 2</span></em><span class="koboSpan" id="kobo.468.1" xmlns:="http://www.w3.org/1999/xhtml">, with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.469.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong><span class="koboSpan" id="kobo.470.1" xmlns:="http://www.w3.org/1999/xhtml"> part and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.471.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong><span class="koboSpan" id="kobo.472.1" xmlns:="http://www.w3.org/1999/xhtml"> part, and the values increasing by intervals of 1 hour,</span><a id="_idTextAnchor802"/><span class="koboSpan" id="kobo.473.1" xmlns:="http://www.w3.org/1999/xhtml"> 15 minutes, and </span><span class="No-Break"><span class="koboSpan" id="kobo.474.1" xmlns:="http://www.w3.org/1999/xhtml">10 seconds:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer102">
<span class="koboSpan" id="kobo.475.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.9 – The first five rows of a sample DataFrame with a datetime variable" src="image/B22396_06_9.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.476.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.9 – The first five rows of a sample DataFrame with a datetime variable</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.477.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.478.1" xmlns:="http://www.w3.org/1999/xhtml">extract the </span><strong class="source-inline"><span class="koboSpan" id="kobo.479.1" xmlns:="http://www.w3.org/1999/xhtml">hour</span></strong><span class="koboSpan" id="kobo.480.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.481.1" xmlns:="http://www.w3.org/1999/xhtml">minute</span></strong><span class="koboSpan" id="kobo.482.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.483.1" xmlns:="http://www.w3.org/1999/xhtml">second</span></strong><span class="koboSpan" id="kobo.484.1" xmlns:="http://www.w3.org/1999/xhtml"> part</span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.485.1" xmlns:="http://www.w3.org/1999/xhtml"> and capture them into three new columns, then </span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.486.1" xmlns:="http://www.w3.org/1999/xhtml">display the DataFrame’s top </span><span class="No-Break"><span class="koboSpan" id="kobo.487.1" xmlns:="http://www.w3.org/1999/xhtml">five rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.488.1" xmlns:="http://www.w3.org/1999/xhtml">
df["hour"] = df["date"].dt.hour
df["min"] = df["date"].dt.minute
df["sec"] = df["date"].dt.second
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.489.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we see the three </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong><span class="koboSpan" id="kobo.491.1" xmlns:="http://www.w3.org/1999/xhtml"> feature</span><a id="_idTextAnchor803"/><span class="koboSpan" id="kobo.492.1" xmlns:="http://www.w3.org/1999/xhtml">s that we extracted in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.493.1" xmlns:="http://www.w3.org/1999/xhtml">Step 3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.494.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer103">
<span class="koboSpan" id="kobo.495.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.10 – The first five rows of a DataFrame with three variables derived from time" src="image/B22396_06_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.496.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.10 – The first five rows of a DataFrame with three variables derived from time</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.497.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.498.1" xmlns:="http://www.w3.org/1999/xhtml">Remember that </span><strong class="source-inline"><span class="koboSpan" id="kobo.499.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.500.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.502.1" xmlns:="http://www.w3.org/1999/xhtml"> needs a </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.504.1" xmlns:="http://www.w3.org/1999/xhtml"> object to work. </span><span class="koboSpan" id="kobo.504.2" xmlns:="http://www.w3.org/1999/xhtml">You can change the data type of an object variable into </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.506.1" xmlns:="http://www.w3.org/1999/xhtml"> by using </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.507.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"> </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.508.1" xmlns:="http://www.w3.org/1999/xhtml">to_datetime()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.509.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.510.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s perform the same operations that we did in </span><em class="italic"><span class="koboSpan" id="kobo.511.1" xmlns:="http://www.w3.org/1999/xhtml">Step 3</span></em><span class="koboSpan" id="kobo.512.1" xmlns:="http://www.w3.org/1999/xhtml"> but now in one line </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1" xmlns:="http://www.w3.org/1999/xhtml">of code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.514.1" xmlns:="http://www.w3.org/1999/xhtml">
df[["h", "m", "s"]] = pd.DataFrame(
    [(x.hour, x.minute, x.second) for x in df["date"]]
)
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.515.1" xmlns:="http://www.w3.org/1999/xhtml">We see the newly created varia</span><a id="_idTextAnchor804"/><span class="koboSpan" id="kobo.516.1" xmlns:="http://www.w3.org/1999/xhtml">bles in the </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer104">
<span class="koboSpan" id="kobo.518.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.11 – The first five rows of a DataFrame with the variables derived from time" src="image/B22396_06_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.519.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.11 – The first five rows of a DataFrame with the variables derived from time</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.520.1" xmlns:="http://www.w3.org/1999/xhtml">No</span><a id="_idTextAnchor805"/><span class="koboSpan" id="kobo.521.1" xmlns:="http://www.w3.org/1999/xhtml">te</span></p>
<p class="callout"><span class="koboSpan" id="kobo.522.1" xmlns:="http://www.w3.org/1999/xhtml">You can inspect the unique values of the new variables with </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.524.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1" xmlns:="http://www.w3.org/1999/xhtml">unique()</span></strong><span class="koboSpan" id="kobo.526.1" xmlns:="http://www.w3.org/1999/xhtml">, for example, by </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1" xmlns:="http://www.w3.org/1999/xhtml">executing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.528.1" xmlns:="http://www.w3.org/1999/xhtml">df['hour'].unique()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.529.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.530.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s</span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.531.1" xmlns:="http://www.w3.org/1999/xhtml"> create a binary variable that </span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.532.1" xmlns:="http://www.w3.org/1999/xhtml">flags events that occurred in the morning, between</span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.533.1" xmlns:="http://www.w3.org/1999/xhtml"> 6 A.M. </span><span class="koboSpan" id="kobo.533.2" xmlns:="http://www.w3.org/1999/xhtml">and </span><span class="No-Break"><span class="koboSpan" id="kobo.534.1" xmlns:="http://www.w3.org/1999/xhtml">12 P.M.:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.535.1" xmlns:="http://www.w3.org/1999/xhtml">
df["is_morning"] = np.where(
    (df[«hour»] &lt; 12) &amp; (df[«hour»] &gt; 6), 1, 0 )
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.536.1" xmlns:="http://www.w3.org/1999/xhtml">We see the </span><strong class="source-inline"><span class="koboSpan" id="kobo.537.1" xmlns:="http://www.w3.org/1999/xhtml">is_morning</span></strong><span class="koboSpan" id="kobo.538.1" xmlns:="http://www.w3.org/1999/xhtml"> va</span><a id="_idTextAnchor806"/><span class="koboSpan" id="kobo.539.1" xmlns:="http://www.w3.org/1999/xhtml">riable in the </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer105">
<span class="koboSpan" id="kobo.541.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.12 – The top rows of a DataFrame with the new variables derived from time" src="image/B22396_06_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.542.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.12 – The top rows of a DataFrame with the new variables derived from time</span></p>
<p><span class="koboSpan" id="kobo.543.1" xmlns:="http://www.w3.org/1999/xhtml">With that, we extracted multiple features from the time part of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.545.1" xmlns:="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.545.2" xmlns:="http://www.w3.org/1999/xhtml">These features can be used for data ana</span><a id="_idTextAnchor807"/><a id="_idTextAnchor808"/><span class="koboSpan" id="kobo.546.1" xmlns:="http://www.w3.org/1999/xhtml">lysis and </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1" xmlns:="http://www.w3.org/1999/xhtml">predictive modelling.</span></span></p>
<h2 id="_idParaDest-180"><a id="_idTextAnchor809"/><span class="koboSpan" id="kobo.548.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.549.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we created features that capture representations of time. </span><span class="koboSpan" id="kobo.549.2" xmlns:="http://www.w3.org/1999/xhtml">First, we created a sample DataFrame with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.551.1" xmlns:="http://www.w3.org/1999/xhtml"> variable. </span><span class="koboSpan" id="kobo.551.2" xmlns:="http://www.w3.org/1999/xhtml">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.552.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.553.1" xmlns:="http://www.w3.org/1999/xhtml">date_range()</span></strong><span class="koboSpan" id="kobo.554.1" xmlns:="http://www.w3.org/1999/xhtml">to create a range of 20 values </span><a id="_idTextAnchor810"/><span class="koboSpan" id="kobo.555.1" xmlns:="http://www.w3.org/1999/xhtml">starting from an a</span><a id="_idTextAnchor811"/><span class="koboSpan" id="kobo.556.1" xmlns:="http://www.w3.org/1999/xhtml">rbitrary date and increasing by intervals of 1 hour, 15 minutes, and 10 seconds. </span><span class="koboSpan" id="kobo.556.2" xmlns:="http://www.w3.org/1999/xhtml">We used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1" xmlns:="http://www.w3.org/1999/xhtml">1h15min10s</span></strong><span class="koboSpan" id="kobo.558.1" xmlns:="http://www.w3.org/1999/xhtml"> string as the frequency term for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1" xmlns:="http://www.w3.org/1999/xhtml">freq</span></strong><span class="koboSpan" id="kobo.560.1" xmlns:="http://www.w3.org/1999/xhtml"> argument to indicate the desired increments. </span><span class="koboSpan" id="kobo.560.2" xmlns:="http://www.w3.org/1999/xhtml">Next, we transformed the date range into a DataFrame with </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.561.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.562.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.563.1" xmlns:="http://www.w3.org/1999/xhtml">DataFrame()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.564.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.565.1" xmlns:="http://www.w3.org/1999/xhtml">To extract the </span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.566.1" xmlns:="http://www.w3.org/1999/xhtml">different time parts, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.567.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.568.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.569.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.570.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.571.1" xmlns:="http://www.w3.org/1999/xhtml">access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.572.1" xmlns:="http://www.w3.org/1999/xhtml">hour</span></strong><span class="koboSpan" id="kobo.573.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.574.1" xmlns:="http://www.w3.org/1999/xhtml">minute</span></strong><span class="koboSpan" id="kobo.575.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.576.1" xmlns:="http://www.w3.org/1999/xhtml">second</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.577.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong><span class="koboSpan" id="kobo.578.1" xmlns:="http://www.w3.org/1999/xhtml"> properties. </span><span class="koboSpan" id="kobo.578.2" xmlns:="http://www.w3.org/1999/xhtml">After </span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.579.1" xmlns:="http://www.w3.org/1999/xhtml">extracting </span><strong class="source-inline"><span class="koboSpan" id="kobo.580.1" xmlns:="http://www.w3.org/1999/xhtml">hour</span></strong><span class="koboSpan" id="kobo.581.1" xmlns:="http://www.w3.org/1999/xhtml"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.582.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong><span class="koboSpan" id="kobo.583.1" xmlns:="http://www.w3.org/1999/xhtml">, we used it to create a new feature that indicated whether it was morning by using NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1" xmlns:="http://www.w3.org/1999/xhtml">where()</span></strong><span class="koboSpan" id="kobo.585.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.585.2" xmlns:="http://www.w3.org/1999/xhtml">NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.586.1" xmlns:="http://www.w3.org/1999/xhtml">where()</span></strong><span class="koboSpan" id="kobo.587.1" xmlns:="http://www.w3.org/1999/xhtml"> scanned the </span><strong class="source-inline"><span class="koboSpan" id="kobo.588.1" xmlns:="http://www.w3.org/1999/xhtml">hour</span></strong><span class="koboSpan" id="kobo.589.1" xmlns:="http://www.w3.org/1999/xhtml"> variable; if its values were smaller than 12 and greater than 6, it assigned a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.590.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.591.1" xmlns:="http://www.w3.org/1999/xhtml">; otherwise, it assigned a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.592.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.593.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.593.2" xmlns:="http://www.w3.org/1999/xhtml">With these operations, we added several features to the DataFrame that can be used for data analysis and</span><a id="_idTextAnchor812"/><a id="_idTextAnchor813"/><span class="koboSpan" id="kobo.594.1" xmlns:="http://www.w3.org/1999/xhtml"> to train machine </span><span class="No-Break"><span class="koboSpan" id="kobo.595.1" xmlns:="http://www.w3.org/1999/xhtml">learning models.</span></span></p>
<h2 id="_idParaDest-181"><a id="_idTextAnchor814"/><span class="koboSpan" id="kobo.596.1" xmlns:="http://www.w3.org/1999/xhtml">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.597.1" xmlns:="http://www.w3.org/1999/xhtml">We can also extract microseconds and nanoseconds with the following </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.598.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.599.1" xmlns:="http://www.w3.org/1999/xhtml"> properties:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.600.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.microsecond</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.601.1" xmlns:="http://www.w3.org/1999/xhtml">pandas.Series.dt.nanosecond</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.602.1" xmlns:="http://www.w3.org/1999/xhtml">For more </span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.603.1" xmlns:="http://www.w3.org/1999/xhtml">details, </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1" xmlns:="http://www.w3.org/1999/xhtml">visit </span></span><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-date-components"><span class="No-Break"><span class="koboSpan" id="kobo.605.1" xmlns:="http://www.w3.org/1999/xhtml">https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#time-date-components</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.606.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-182"><a id="_idTextAnchor815"/><span class="koboSpan" id="kobo.607.1" xmlns:="http://www.w3.org/1999/xhtml">Capturing the elapsed time between datetime variables</span></h1>
<p><span class="koboSpan" id="kobo.608.1" xmlns:="http://www.w3.org/1999/xhtml">We can extract </span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.609.1" xmlns:="http://www.w3.org/1999/xhtml">powerful features from </span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.610.1" xmlns:="http://www.w3.org/1999/xhtml">each </span><strong class="source-inline"><span class="koboSpan" id="kobo.611.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.612.1" xmlns:="http://www.w3.org/1999/xhtml"> variable individually, as we did in the previous two recipes. </span><span class="koboSpan" id="kobo.612.2" xmlns:="http://www.w3.org/1999/xhtml">We can create additional features by combining multiple </span><strong class="source-inline"><span class="koboSpan" id="kobo.613.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.614.1" xmlns:="http://www.w3.org/1999/xhtml"> variables. </span><span class="koboSpan" id="kobo.614.2" xmlns:="http://www.w3.org/1999/xhtml">A common example consists of extracting the </span><strong class="bold"><span class="koboSpan" id="kobo.615.1" xmlns:="http://www.w3.org/1999/xhtml">age</span></strong><span class="koboSpan" id="kobo.616.1" xmlns:="http://www.w3.org/1999/xhtml"> at the time of an event by comparing the </span><strong class="bold"><span class="koboSpan" id="kobo.617.1" xmlns:="http://www.w3.org/1999/xhtml">date of birth</span></strong><span class="koboSpan" id="kobo.618.1" xmlns:="http://www.w3.org/1999/xhtml"> with the </span><strong class="bold"><span class="koboSpan" id="kobo.619.1" xmlns:="http://www.w3.org/1999/xhtml">date of </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.620.1" xmlns:="http://www.w3.org/1999/xhtml">the event</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.621.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.622.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will learn how to capture the time between two </span><strong class="source-inline"><span class="koboSpan" id="kobo.623.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.624.1" xmlns:="http://www.w3.org/1999/xhtml"> variables by</span><a id="_idTextAnchor816"/><a id="_idTextAnchor817"/><span class="koboSpan" id="kobo.625.1" xmlns:="http://www.w3.org/1999/xhtml"> utilizing </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.627.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.628.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.629.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-183"><a id="_idTextAnchor818"/><span class="koboSpan" id="kobo.630.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.631.1" xmlns:="http://www.w3.org/1999/xhtml">To proceed with this recipe, we’ll create a DataFrame containing two </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.632.1" xmlns:="http://www.w3.org/1999/xhtml">datatime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.633.1" xmlns:="http://www.w3.org/1999/xhtml"> variables:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.634.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing </span><strong class="source-inline"><span class="koboSpan" id="kobo.635.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.636.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.637.1" xmlns:="http://www.w3.org/1999/xhtml">numpy</span></strong><span class="koboSpan" id="kobo.638.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.640.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.641.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.642.1" xmlns:="http://www.w3.org/1999/xhtml">
import datetime
import numpy as np
import pandas as pd</span></pre></li> <li><span class="koboSpan" id="kobo.643.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll start by creating two </span><strong class="source-inline"><span class="koboSpan" id="kobo.644.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.645.1" xmlns:="http://www.w3.org/1999/xhtml"> variables with 20 values each; the values start from </span><strong class="source-inline"><span class="koboSpan" id="kobo.646.1" xmlns:="http://www.w3.org/1999/xhtml">2024-05-17</span></strong><span class="koboSpan" id="kobo.647.1" xmlns:="http://www.w3.org/1999/xhtml"> and increase in intervals of </span><strong class="source-inline"><span class="koboSpan" id="kobo.648.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.649.1" xmlns:="http://www.w3.org/1999/xhtml"> hour for the first variable, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.650.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.651.1" xmlns:="http://www.w3.org/1999/xhtml"> month for the second. </span><span class="koboSpan" id="kobo.651.2" xmlns:="http://www.w3.org/1999/xhtml">Then, we‘ll capture the variables in a DataFrame, add column names, and display the </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1" xmlns:="http://www.w3.org/1999/xhtml">top rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.653.1" xmlns:="http://www.w3.org/1999/xhtml">
date = "2024-05-17"
rng_hr = pd.date_range(date, periods=20, freq="h")
rng_month = pd.date_range(date, periods=20, freq="ME")
df = pd.DataFrame(
    {"date1": rng_hr, "date2": rng_month})
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.654.1" xmlns:="http://www.w3.org/1999/xhtml">We see the</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.655.1" xmlns:="http://www.w3.org/1999/xhtml"> first five rows of the </span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.656.1" xmlns:="http://www.w3.org/1999/xhtml">DataFram</span><a id="_idTextAnchor819"/><span class="koboSpan" id="kobo.657.1" xmlns:="http://www.w3.org/1999/xhtml">e from </span><em class="italic"><span class="koboSpan" id="kobo.658.1" xmlns:="http://www.w3.org/1999/xhtml">Step 2</span></em><span class="koboSpan" id="kobo.659.1" xmlns:="http://www.w3.org/1999/xhtml"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.660.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer106">
<span class="koboSpan" id="kobo.661.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.13 – The first five rows of a DataFrame wit﻿h two datetime variables" src="image/B22396_06_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.662.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.13 – The first five rows of a DataFrame wit</span><a id="_idTextAnchor820"/><span class="koboSpan" id="kobo.663.1" xmlns:="http://www.w3.org/1999/xhtml">h two datetime variables</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.664.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s capture the difference in days between the two variables in a new feature, and then display the DataFrame’s </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1" xmlns:="http://www.w3.org/1999/xhtml">top rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.666.1" xmlns:="http://www.w3.org/1999/xhtml">
df["elapsed_days"] = (
    df["date2"] - df["date1"]).dt.days
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.667.1" xmlns:="http://www.w3.org/1999/xhtml">We see the differ</span><a id="_idTextAnchor821"/><span class="koboSpan" id="kobo.668.1" xmlns:="http://www.w3.org/1999/xhtml">ence in days in the </span><span class="No-Break"><span class="koboSpan" id="kobo.669.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer107">
<span class="koboSpan" id="kobo.670.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.14 – Top rows of a DataFrame with a new variable capturing the time difference between the two datetime features" src="image/B22396_06_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.671.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.14 – Top rows of a DataFrame with a new variable capturing the time difference between the two datetime features</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.672.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s capture</span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.673.1" xmlns:="http://www.w3.org/1999/xhtml"> the difference in </span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.674.1" xmlns:="http://www.w3.org/1999/xhtml">weeks between the two </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.676.1" xmlns:="http://www.w3.org/1999/xhtml"> variables and then display the DataFrame’s </span><span class="No-Break"><span class="koboSpan" id="kobo.677.1" xmlns:="http://www.w3.org/1999/xhtml">top rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.678.1" xmlns:="http://www.w3.org/1999/xhtml">
df["weeks_passed"] = (
    (df[«date2»] - df[«date1»]) / np.timedelta64(1, "W"))
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.679.1" xmlns:="http://www.w3.org/1999/xhtml">We see the difference in weeks between the </span><a id="_idTextAnchor822"/><span class="koboSpan" id="kobo.680.1" xmlns:="http://www.w3.org/1999/xhtml">variables in the </span><span class="No-Break"><span class="koboSpan" id="kobo.681.1" xmlns:="http://www.w3.org/1999/xhtml">following screenshot:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer108">
<span class="koboSpan" id="kobo.682.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.15 – A DataFrame with the time difference between the datetime variables expressed in number ﻿of days and number of weeks" src="image/B22396_06_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.683.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.15 – A DataFrame with the time difference between the datetime variables expressed in number </span><a id="_idTextAnchor823"/><span class="koboSpan" id="kobo.684.1" xmlns:="http://www.w3.org/1999/xhtml">of days and number of weeks</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.685.1" xmlns:="http://www.w3.org/1999/xhtml">Now, let’s calculate the time in between the variables in minutes and seconds and then display the DataFrame’s </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1" xmlns:="http://www.w3.org/1999/xhtml">top rows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.687.1" xmlns:="http://www.w3.org/1999/xhtml">
df["diff_seconds"] = (
    df[«date2»] - df[«date1»])/np.timedelta64(1, «s»)
df["diff_minutes"] = (
    df[«date2»] - df[«date1»])/ np.timedelta64(1,»m»)
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.688.1" xmlns:="http://www.w3.org/1999/xhtml">We see the </span><a id="_idIndexMarker477"/><a id="_idTextAnchor824"/><span class="koboSpan" id="kobo.689.1" xmlns:="http://www.w3.org/1999/xhtml">new variables in the </span><a id="_idIndexMarker478"/><span class="No-Break"><span class="koboSpan" id="kobo.690.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer109">
<span class="koboSpan" id="kobo.691.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.16 – A DataFrame with the time difference between the two datetime variables expressed in different time units" src="image/B22396_06_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.692.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.16 – A DataFrame with the time difference between the two datetime variables expressed in different time units</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.693.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s calculate the difference between one variable and the current day, expressed in number of days, and then display the first five rows of </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1" xmlns:="http://www.w3.org/1999/xhtml">the DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.695.1" xmlns:="http://www.w3.org/1999/xhtml">
df["to_today"] = (
    datetime.datetime.today() - df["date1"])
df.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.696.1" xmlns:="http://www.w3.org/1999/xhtml">We can find the new variable in the final column of </span><a id="_idTextAnchor825"/><span class="koboSpan" id="kobo.697.1" xmlns:="http://www.w3.org/1999/xhtml">the DataFrame in the </span><span class="No-Break"><span class="koboSpan" id="kobo.698.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer110">
<span class="koboSpan" id="kobo.699.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.17 – A DataFrame with the new variable containing the difference between date1 and the day this code was executed" src="image/B22396_06_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.700.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.17 – A DataFrame with the new variable containing the difference between date1 and the day this code was executed</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.701.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.702.1" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1" xmlns:="http://www.w3.org/1999/xhtml">to_today</span></strong><span class="koboSpan" id="kobo.704.1" xmlns:="http://www.w3.org/1999/xhtml"> variable on your computer will be different from the one in this book, due to the difference between the current date (at the time of writing) and when </span><a id="_idTextAnchor826"/><span class="koboSpan" id="kobo.705.1" xmlns:="http://www.w3.org/1999/xhtml">you execute </span><span class="No-Break"><span class="koboSpan" id="kobo.706.1" xmlns:="http://www.w3.org/1999/xhtml">the code.</span></span></p>
<p><span class="koboSpan" id="kobo.707.1" xmlns:="http://www.w3.org/1999/xhtml">That’s it! </span><span class="koboSpan" id="kobo.707.2" xmlns:="http://www.w3.org/1999/xhtml">We’ve now enriched our dataset with new features that were create</span><a id="_idTextAnchor827"/><a id="_idTextAnchor828"/><span class="koboSpan" id="kobo.708.1" xmlns:="http://www.w3.org/1999/xhtml">d by comparing two </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.709.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.710.1" xmlns:="http://www.w3.org/1999/xhtml"> variables.</span></span></p>
<h2 id="_idParaDest-184"><a id="_idTextAnchor829"/><span class="koboSpan" id="kobo.711.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.712.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we </span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.713.1" xmlns:="http://www.w3.org/1999/xhtml">captured different representations</span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.714.1" xmlns:="http://www.w3.org/1999/xhtml"> of the time between two </span><strong class="source-inline"><span class="koboSpan" id="kobo.715.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.716.1" xmlns:="http://www.w3.org/1999/xhtml"> variables. </span><span class="koboSpan" id="kobo.716.2" xmlns:="http://www.w3.org/1999/xhtml">To proceed with this recipe, we created a sample DataFrame with two variables, each with 20 dates starting at an arbitrary date. </span><span class="koboSpan" id="kobo.716.3" xmlns:="http://www.w3.org/1999/xhtml">The first variable increased in intervals of </span><strong class="source-inline"><span class="koboSpan" id="kobo.717.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.718.1" xmlns:="http://www.w3.org/1999/xhtml"> hour, while the second variable increased in intervals of </span><strong class="source-inline"><span class="koboSpan" id="kobo.719.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.720.1" xmlns:="http://www.w3.org/1999/xhtml"> month. </span><span class="koboSpan" id="kobo.720.2" xmlns:="http://www.w3.org/1999/xhtml">We created the variables with </span><strong class="source-inline"><span class="koboSpan" id="kobo.721.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.722.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.723.1" xmlns:="http://www.w3.org/1999/xhtml">date_range()</span></strong><span class="koboSpan" id="kobo.724.1" xmlns:="http://www.w3.org/1999/xhtml">, which we discussed in the previous two recipes in </span><span class="No-Break"><span class="koboSpan" id="kobo.725.1" xmlns:="http://www.w3.org/1999/xhtml">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.726.1" xmlns:="http://www.w3.org/1999/xhtml">To determine the difference between the variables – that is, to determine the time between them – we directly subtracted one </span><strong class="source-inline"><span class="koboSpan" id="kobo.727.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.728.1" xmlns:="http://www.w3.org/1999/xhtml"> variable from the other – that is, one </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.730.1" xmlns:="http://www.w3.org/1999/xhtml"> Series from the other. </span><span class="koboSpan" id="kobo.730.2" xmlns:="http://www.w3.org/1999/xhtml">The difference between the two </span><strong class="source-inline"><span class="koboSpan" id="kobo.731.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.732.1" xmlns:="http://www.w3.org/1999/xhtml"> Series returned a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.733.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.734.1" xmlns:="http://www.w3.org/1999/xhtml"> Series. </span><span class="koboSpan" id="kobo.734.2" xmlns:="http://www.w3.org/1999/xhtml">To capture the difference in days, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.736.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.737.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.738.1" xmlns:="http://www.w3.org/1999/xhtml">, followed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.739.1" xmlns:="http://www.w3.org/1999/xhtml">days</span></strong><span class="koboSpan" id="kobo.740.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.740.2" xmlns:="http://www.w3.org/1999/xhtml">To convert the time difference into months, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.741.1" xmlns:="http://www.w3.org/1999/xhtml">timedelta()</span></strong><span class="koboSpan" id="kobo.742.1" xmlns:="http://www.w3.org/1999/xhtml"> from NumPy, indicating that we wanted the difference in weeks by passing </span><strong class="source-inline"><span class="koboSpan" id="kobo.743.1" xmlns:="http://www.w3.org/1999/xhtml">W</span></strong><span class="koboSpan" id="kobo.744.1" xmlns:="http://www.w3.org/1999/xhtml"> in the second argument of the method. </span><span class="koboSpan" id="kobo.744.2" xmlns:="http://www.w3.org/1999/xhtml">To capture the difference in seconds and minutes, we passed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.745.1" xmlns:="http://www.w3.org/1999/xhtml">s</span></strong><span class="koboSpan" id="kobo.746.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.747.1" xmlns:="http://www.w3.org/1999/xhtml">m</span></strong><span class="koboSpan" id="kobo.748.1" xmlns:="http://www.w3.org/1999/xhtml"> strings to </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.749.1" xmlns:="http://www.w3.org/1999/xhtml">timedelta()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.750.1" xmlns:="http://www.w3.org/1999/xhtml">, respectively.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.751.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.752.1" xmlns:="http://www.w3.org/1999/xhtml">The arguments for NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.753.1" xmlns:="http://www.w3.org/1999/xhtml">timedelta</span></strong><span class="koboSpan" id="kobo.754.1" xmlns:="http://www.w3.org/1999/xhtml"> are a number, </span><strong class="source-inline"><span class="koboSpan" id="kobo.755.1" xmlns:="http://www.w3.org/1999/xhtml">– 1</span></strong><span class="koboSpan" id="kobo.756.1" xmlns:="http://www.w3.org/1999/xhtml">, in our example, to represent the number of units, and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.758.1" xmlns:="http://www.w3.org/1999/xhtml"> unit, such as day (</span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1" xmlns:="http://www.w3.org/1999/xhtml">D</span></strong><span class="koboSpan" id="kobo.760.1" xmlns:="http://www.w3.org/1999/xhtml">), week (</span><strong class="source-inline"><span class="koboSpan" id="kobo.761.1" xmlns:="http://www.w3.org/1999/xhtml">W</span></strong><span class="koboSpan" id="kobo.762.1" xmlns:="http://www.w3.org/1999/xhtml">), hours (</span><strong class="source-inline"><span class="koboSpan" id="kobo.763.1" xmlns:="http://www.w3.org/1999/xhtml">h</span></strong><span class="koboSpan" id="kobo.764.1" xmlns:="http://www.w3.org/1999/xhtml">), minutes (</span><strong class="source-inline"><span class="koboSpan" id="kobo.765.1" xmlns:="http://www.w3.org/1999/xhtml">m</span></strong><span class="koboSpan" id="kobo.766.1" xmlns:="http://www.w3.org/1999/xhtml">), or </span><span class="No-Break"><span class="koboSpan" id="kobo.767.1" xmlns:="http://www.w3.org/1999/xhtml">seconds (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.768.1" xmlns:="http://www.w3.org/1999/xhtml">s</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.769.1" xmlns:="http://www.w3.org/1999/xhtml">).</span></span></p>
<p><span class="koboSpan" id="kobo.770.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, we </span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.771.1" xmlns:="http://www.w3.org/1999/xhtml">captured the difference from</span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.772.1" xmlns:="http://www.w3.org/1999/xhtml"> one </span><strong class="source-inline"><span class="koboSpan" id="kobo.773.1" xmlns:="http://www.w3.org/1999/xhtml">date</span><a id="_idTextAnchor830"/><span class="koboSpan" id="kobo.774.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong><span class="koboSpan" id="kobo.775.1" xmlns:="http://www.w3.org/1999/xhtml"> variable to today’s date. </span><span class="koboSpan" id="kobo.775.2" xmlns:="http://www.w3.org/1999/xhtml">We obtained the date and time of today (at the time of writing) by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.776.1" xmlns:="http://www.w3.org/1999/xhtml">today()</span></strong><span class="koboSpan" id="kobo.777.1" xmlns:="http://www.w3.org/1999/xhtml"> from the built-in </span><strong class="source-inline"><span class="koboSpan" id="kobo.778.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.779.1" xmlns:="http://www.w3.org/1999/xhtml">Python library.</span></span></p>
<h2 id="_idParaDest-185"><a id="_idTextAnchor831"/><span class="koboSpan" id="kobo.780.1" xmlns:="http://www.w3.org/1999/xhtml">There's more...</span></h2>
<p><span class="koboSpan" id="kobo.781.1" xmlns:="http://www.w3.org/1999/xhtml">We can automate the creation of </span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.782.1" xmlns:="http://www.w3.org/1999/xhtml">features that capture the time between variables by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.783.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.784.1" xmlns:="http://www.w3.org/1999/xhtml">‘s </span><span class="No-Break"><span class="koboSpan" id="kobo.785.1" xmlns:="http://www.w3.org/1999/xhtml">transformer </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.786.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeSubstraction()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.787.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.788.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s import </span><strong class="source-inline"><span class="koboSpan" id="kobo.789.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.790.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.791.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.792.1" xmlns:="http://www.w3.org/1999/xhtml">’s transformer:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.793.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from feature_engine.datetime import (
    DatetimeSubtraction
)</span></pre></li> <li><span class="koboSpan" id="kobo.794.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s re-create the sample dataset that we described in </span><em class="italic"><span class="koboSpan" id="kobo.795.1" xmlns:="http://www.w3.org/1999/xhtml">Step 2</span></em><span class="koboSpan" id="kobo.796.1" xmlns:="http://www.w3.org/1999/xhtml"> of the </span><em class="italic"><span class="koboSpan" id="kobo.797.1" xmlns:="http://www.w3.org/1999/xhtml">How to do </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.798.1" xmlns:="http://www.w3.org/1999/xhtml">it…</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.799.1" xmlns:="http://www.w3.org/1999/xhtml"> section:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.800.1" xmlns:="http://www.w3.org/1999/xhtml">
date = "2024-05-17"
rng_hr = pd.date_range(date, periods=20, freq="h")
rng_month = pd.date_range(date, periods=20, freq="ME")
df = pd.DataFrame(
    {"date1": rng_hr, "date2": rng_month})</span></pre></li> <li><span class="koboSpan" id="kobo.801.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.802.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeSubstraction()</span></strong><span class="koboSpan" id="kobo.803.1" xmlns:="http://www.w3.org/1999/xhtml">to return the time difference between the second date and the first date expressed </span><span class="No-Break"><span class="koboSpan" id="kobo.804.1" xmlns:="http://www.w3.org/1999/xhtml">in days:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.805.1" xmlns:="http://www.w3.org/1999/xhtml">
ds = DatetimeSubtraction(
    variables="date2",
    reference="date1",
    output_unit="D",
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.806.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.807.1" xmlns:="http://www.w3.org/1999/xhtml">We can obtain the difference between more than two variables by passing variable lists in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.809.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.810.1" xmlns:="http://www.w3.org/1999/xhtml">reference</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.811.1" xmlns:="http://www.w3.org/1999/xhtml"> parameters.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.812.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create</span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.813.1" xmlns:="http://www.w3.org/1999/xhtml"> and then display the </span><span class="No-Break"><span class="koboSpan" id="kobo.814.1" xmlns:="http://www.w3.org/1999/xhtml">new feature:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.815.1" xmlns:="http://www.w3.org/1999/xhtml">
dft = ds.fit_transform(df)
dft.head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.816.1" xmlns:="http://www.w3.org/1999/xhtml">In the following output, we see the variable that captures the time difference between the two </span><strong class="source-inline"><span class="koboSpan" id="kobo.817.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.818.1" xmlns:="http://www.w3.org/1999/xhtml"> variables </span><span class="No-Break"><span class="koboSpan" id="kobo.819.1" xmlns:="http://www.w3.org/1999/xhtml">in days:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer111">
<span class="koboSpan" id="kobo.820.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.18 – A DataFrame with the new variable containing the difference between the two datetime variables" src="image/B22396_06_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.821.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.18 – A DataFrame with the new variable containing the difference between the two datetime variables</span></p>
<p><span class="koboSpan" id="kobo.822.1" xmlns:="http://www.w3.org/1999/xhtml">For more details, check </span><span class="No-Break"><span class="koboSpan" id="kobo.823.1" xmlns:="http://www.w3.org/1999/xhtml">out </span></span><a href="https://feature-engine.trainindata.com/en/latest/api_doc/datetime/DatetimeSubtraction.html"><span class="No-Break"><span class="koboSpan" id="kobo.824.1" xmlns:="http://www.w3.org/1999/xhtml">https://feature-engine.trainindata.com/en/latest/api_doc/datetime/DatetimeSubtraction.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.825.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-186"><a id="_idTextAnchor832"/><span class="koboSpan" id="kobo.826.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.827.1" xmlns:="http://www.w3.org/1999/xhtml">To learn more </span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.828.1" xmlns:="http://www.w3.org/1999/xhtml">about NumPy’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1" xmlns:="http://www.w3.org/1999/xhtml">timedelta</span></strong><span class="koboSpan" id="kobo.830.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.831.1" xmlns:="http://www.w3.org/1999/xhtml">visit </span></span><a href="https://numpy.org/devdocs/reference/arrays.datetime.html#datetime-and-timedelta-arithmetic"><span class="No-Break"><span class="koboSpan" id="kobo.832.1" xmlns:="http://www.w3.org/1999/xhtml">https://numpy.org/devdocs/reference/arrays.datetime.html#datetime-and-timedelta-arithmetic</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.833.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-187"><a id="_idTextAnchor833"/><span class="koboSpan" id="kobo.834.1" xmlns:="http://www.w3.org/1999/xhtml">Working with time in different time zones</span></h1>
<p><span class="koboSpan" id="kobo.835.1" xmlns:="http://www.w3.org/1999/xhtml">Some</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.836.1" xmlns:="http://www.w3.org/1999/xhtml"> organizations operate internationally; therefo</span><a id="_idTextAnchor834"/><span class="koboSpan" id="kobo.837.1" xmlns:="http://www.w3.org/1999/xhtml">re, the information they collect about events may be recorded alongside the time zone of the area where the event took place. </span><span class="koboSpan" id="kobo.837.2" xmlns:="http://www.w3.org/1999/xhtml">To be able to compare events that occurred across different time zones, we typically have to set all of the variables within the same zone. </span><span class="koboSpan" id="kobo.837.3" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will learn how to unify the time zones of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.839.1" xmlns:="http://www.w3.org/1999/xhtml"> variable and how to reassign a va</span><a id="_idTextAnchor835"/><a id="_idTextAnchor836"/><span class="koboSpan" id="kobo.840.1" xmlns:="http://www.w3.org/1999/xhtml">riable to a different time </span><a id="_idTextAnchor837"/><span class="koboSpan" id="kobo.841.1" xmlns:="http://www.w3.org/1999/xhtml">zone </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1" xmlns:="http://www.w3.org/1999/xhtml">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.843.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.844.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-188"><a id="_idTextAnchor838"/><span class="koboSpan" id="kobo.845.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.846.1" xmlns:="http://www.w3.org/1999/xhtml">To proceed with this recipe, we’ll create a sample DataFrame containing two variables in different </span><span class="No-Break"><span class="koboSpan" id="kobo.847.1" xmlns:="http://www.w3.org/1999/xhtml">time zones:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.848.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.849.1" xmlns:="http://www.w3.org/1999/xhtml">import </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.850.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.851.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.852.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd</span></pre></li> <li><span class="koboSpan" id="kobo.853.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a DataFrame containing one variable with values in different </span><span class="No-Break"><span class="koboSpan" id="kobo.854.1" xmlns:="http://www.w3.org/1999/xhtml">time zones:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.855.1" xmlns:="http://www.w3.org/1999/xhtml">
df = pd.DataFrame()
df['time1'] = pd.concat([
    pd.Series(
        pd.date_range(
            start='2024-06-10 09:00',
            freq='h',
            periods=3,
            tz='Europe/Berlin')),
    pd.Series(
        pd.date_range(
            start='2024-09-10 09:00',
            freq='h',
            periods=3,
            tz='US/Central'))
    ], axis=0)</span></pre></li> <li><span class="koboSpan" id="kobo.856.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s add </span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.857.1" xmlns:="http://www.w3.org/1999/xhtml">another </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.859.1" xmlns:="http://www.w3.org/1999/xhtml"> variable to the DataFrame, which also contains values in different </span><span class="No-Break"><span class="koboSpan" id="kobo.860.1" xmlns:="http://www.w3.org/1999/xhtml">time zones:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.861.1" xmlns:="http://www.w3.org/1999/xhtml">
df['time2'] = pd.concat([
    pd.Series(
        pd.date_range(
            start='2024-07-01 09:00',
            freq='h',
            periods=3,
            tz='Europe/Berlin')),
    pd.Series(
        pd.date_range(
            start='2024-08-01 09:00',
            freq='h',
            periods=3,
            tz='US/Central</span><a id="_idTextAnchor839"/><span class="koboSpan" id="kobo.862.1" xmlns:="http://www.w3.org/1999/xhtml">'))
    ], axis=0)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.863.1" xmlns:="http://www.w3.org/1999/xhtml">If we now execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.864.1" xmlns:="http://www.w3.org/1999/xhtml">df</span></strong><span class="koboSpan" id="kobo.865.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the DataFrame with the variables in the diffe</span><a id="_idTextAnchor840"/><span class="koboSpan" id="kobo.866.1" xmlns:="http://www.w3.org/1999/xhtml">rent time zones like in the </span><span class="No-Break"><span class="koboSpan" id="kobo.867.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer112">
<span class="koboSpan" id="kobo.868.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.19 – A DataFrame with two datetime variables in different time zones" src="image/B22396_06_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.869.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.19 – A DataFrame with two datetime variables in different time zones</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.870.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.871.1" xmlns:="http://www.w3.org/1999/xhtml">The time zone is indicated with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.872.1" xmlns:="http://www.w3.org/1999/xhtml">+02</span></strong><span class="koboSpan" id="kobo.873.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.874.1" xmlns:="http://www.w3.org/1999/xhtml">-05</span></strong><span class="koboSpan" id="kobo.875.1" xmlns:="http://www.w3.org/1999/xhtml"> values, respectively, which indicates the time difference to</span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.876.1" xmlns:="http://www.w3.org/1999/xhtml"> the </span><strong class="bold"><span class="koboSpan" id="kobo.877.1" xmlns:="http://www.w3.org/1999/xhtml">Coordinated Universal </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.878.1" xmlns:="http://www.w3.org/1999/xhtml">Time</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.879.1" xmlns:="http://www.w3.org/1999/xhtml"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.880.1" xmlns:="http://www.w3.org/1999/xhtml">UTC</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.881.1" xmlns:="http://www.w3.org/1999/xhtml">).</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.882.1" xmlns:="http://www.w3.org/1999/xhtml">To work </span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.883.1" xmlns:="http://www.w3.org/1999/xhtml">with different time zones, we typically set the variables in the same time zone, in this case, we chose </span><span class="No-Break"><span class="koboSpan" id="kobo.884.1" xmlns:="http://www.w3.org/1999/xhtml">the UTC:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.885.1" xmlns:="http://www.w3.org/1999/xhtml">
df['time1_utc'] = pd.to_datetime(
    df['time1'], utc=True)
df['time2_utc'] = pd.to_datetime(
    df['time2'], utc=True)</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.886.1" xmlns:="http://www.w3.org/1999/xhtml">If we now execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.887.1" xmlns:="http://www.w3.org/1999/xhtml">df</span></strong><span class="koboSpan" id="kobo.888.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the new variables, which have</span><a id="_idTextAnchor841"/><span class="koboSpan" id="kobo.889.1" xmlns:="http://www.w3.org/1999/xhtml"> a difference of </span><strong class="source-inline"><span class="koboSpan" id="kobo.890.1" xmlns:="http://www.w3.org/1999/xhtml">00</span></strong><span class="koboSpan" id="kobo.891.1" xmlns:="http://www.w3.org/1999/xhtml"> hours with respect </span><span class="No-Break"><span class="koboSpan" id="kobo.892.1" xmlns:="http://www.w3.org/1999/xhtml">to UTC:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer113">
<span class="koboSpan" id="kobo.893.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.20 – A DataFrame﻿ containing the new variables in the UTC" src="image/B22396_06_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.894.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.20 – A DataFrame</span><a id="_idTextAnchor842"/><span class="koboSpan" id="kobo.895.1" xmlns:="http://www.w3.org/1999/xhtml"> containing the new variables in the UTC</span></p>
<ol>
<li><span class="koboSpan" id="kobo.896.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s calculate the </span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.897.1" xmlns:="http://www.w3.org/1999/xhtml">difference in days between the variables and then display the first five rows of </span><span class="No-Break"><span class="koboSpan" id="kobo.898.1" xmlns:="http://www.w3.org/1999/xhtml">the DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.899.1" xmlns:="http://www.w3.org/1999/xhtml">
df['elapsed_days'] = (
    df[‹time2_utc›] - df[‹time1_utc›]). </span><span class="koboSpan" id="kobo.899.2" xmlns:="http://www.w3.org/1999/xhtml">dt.days
df['elapsed_days'].head()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.900.1" xmlns:="http://www.w3.org/1999/xhtml">We see the time difference between the variables in the </span><span class="No-Break"><span class="koboSpan" id="kobo.901.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.902.1" xmlns:="http://www.w3.org/1999/xhtml">0    21</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.903.1" xmlns:="http://www.w3.org/1999/xhtml">1    21</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.904.1" xmlns:="http://www.w3.org/1999/xhtml">2    21</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.905.1" xmlns:="http://www.w3.org/1999/xhtml">0   -40</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.906.1" xmlns:="http://www.w3.org/1999/xhtml">1   -40</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.907.1" xmlns:="http://www.w3.org/1999/xhtml">Name: elapsed_days, dtype: int64</span></strong></pre></li> <li><span class="koboSpan" id="kobo.908.1" xmlns:="http://www.w3.org/1999/xhtml">Finally, let’s change the time zone of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.909.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.910.1" xmlns:="http://www.w3.org/1999/xhtml"> variables to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.911.1" xmlns:="http://www.w3.org/1999/xhtml">London</span></strong><span class="koboSpan" id="kobo.912.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1" xmlns:="http://www.w3.org/1999/xhtml">Berlin</span></strong><span class="koboSpan" id="kobo.914.1" xmlns:="http://www.w3.org/1999/xhtml"> time zones, and then display the </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1" xmlns:="http://www.w3.org/1999/xhtml">resulting variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.916.1" xmlns:="http://www.w3.org/1999/xhtml">
df['time1_london'] = df[
    ‹time1_utc›].dt.tz_convert('Europe/London')
df['time2_berlin'] = df[
    ‹time1_utc›].dt.tz_convert('Europe/Berlin')
df[['time1_london', 'time2_berlin']]</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.917.1" xmlns:="http://www.w3.org/1999/xhtml">We see the variables in their </span><a id="_idTextAnchor843"/><span class="koboSpan" id="kobo.918.1" xmlns:="http://www.w3.org/1999/xhtml">respective time zones in the </span><span class="No-Break"><span class="koboSpan" id="kobo.919.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer114">
<span class="koboSpan" id="kobo.920.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.21 – Variables reformatted into different time zones" src="image/B22396_06_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.921.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.21 – Variables reformatted into different time zones</span></p>
<p><span class="koboSpan" id="kobo.922.1" xmlns:="http://www.w3.org/1999/xhtml">When changing</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.923.1" xmlns:="http://www.w3.org/1999/xhtml"> time zones, not only do the values of the zone change – that is, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1" xmlns:="http://www.w3.org/1999/xhtml">+01</span></strong><span class="koboSpan" id="kobo.925.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.926.1" xmlns:="http://www.w3.org/1999/xhtml">+02</span></strong><span class="koboSpan" id="kobo.927.1" xmlns:="http://www.w3.org/1999/xhtml"> values in the previous ima</span><a id="_idTextAnchor844"/><a id="_idTextAnchor845"/><span class="koboSpan" id="kobo.928.1" xmlns:="http://www.w3.org/1999/xhtml">ge – but the value of the hour changes </span><span class="No-Break"><span class="koboSpan" id="kobo.929.1" xmlns:="http://www.w3.org/1999/xhtml">as well.</span></span></p>
<h2 id="_idParaDest-189"><a id="_idTextAnchor846"/><span class="koboSpan" id="kobo.930.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.931.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we changed time z</span><a id="_idTextAnchor847"/><span class="koboSpan" id="kobo.932.1" xmlns:="http://www.w3.org/1999/xhtml">ones and performed operations between variables in different time zones. </span><span class="koboSpan" id="kobo.932.2" xmlns:="http://www.w3.org/1999/xhtml">To begin, we created a DataFrame with two variables, the values of which started at an arbitrary date and increased hourly; these were set in different time zones. </span><span class="koboSpan" id="kobo.932.3" xmlns:="http://www.w3.org/1999/xhtml">To combine the different time zone variables in one DataFrame column, we concatenated the series returned by </span><strong class="source-inline"><span class="koboSpan" id="kobo.933.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.934.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.935.1" xmlns:="http://www.w3.org/1999/xhtml">date_range()</span></strong><span class="koboSpan" id="kobo.936.1" xmlns:="http://www.w3.org/1999/xhtml"> by utilizing </span><strong class="source-inline"><span class="koboSpan" id="kobo.937.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.938.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.939.1" xmlns:="http://www.w3.org/1999/xhtml">concat()</span></strong><span class="koboSpan" id="kobo.940.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.940.2" xmlns:="http://www.w3.org/1999/xhtml">We set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1" xmlns:="http://www.w3.org/1999/xhtml">axis</span></strong><span class="koboSpan" id="kobo.942.1" xmlns:="http://www.w3.org/1999/xhtml"> argument to </span><strong class="source-inline"><span class="koboSpan" id="kobo.943.1" xmlns:="http://www.w3.org/1999/xhtml">0</span></strong><span class="koboSpan" id="kobo.944.1" xmlns:="http://www.w3.org/1999/xhtml"> to indicate we wanted to concatenate the series vertically in one column. </span><span class="koboSpan" id="kobo.944.2" xmlns:="http://www.w3.org/1999/xhtml">We covered the arguments of </span><strong class="source-inline"><span class="koboSpan" id="kobo.945.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.946.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.947.1" xmlns:="http://www.w3.org/1999/xhtml">date_range()</span></strong><span class="koboSpan" id="kobo.948.1" xmlns:="http://www.w3.org/1999/xhtml"> extensively in former recipes in this chapter; see the </span><em class="italic"><span class="koboSpan" id="kobo.949.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting features from dates with pandas</span></em><span class="koboSpan" id="kobo.950.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><em class="italic"><span class="koboSpan" id="kobo.951.1" xmlns:="http://www.w3.org/1999/xhtml">Extracting features from time with pandas</span></em><span class="koboSpan" id="kobo.952.1" xmlns:="http://www.w3.org/1999/xhtml"> recipes for </span><span class="No-Break"><span class="koboSpan" id="kobo.953.1" xmlns:="http://www.w3.org/1999/xhtml">more details.</span></span></p>
<p><span class="koboSpan" id="kobo.954.1" xmlns:="http://www.w3.org/1999/xhtml">To reset the time zone of the variables to the central zone, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.955.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.956.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.957.1" xmlns:="http://www.w3.org/1999/xhtml">to_datetime()</span></strong><span class="koboSpan" id="kobo.958.1" xmlns:="http://www.w3.org/1999/xhtml">, passing </span><strong class="source-inline"><span class="koboSpan" id="kobo.959.1" xmlns:="http://www.w3.org/1999/xhtml">utc=True</span></strong><span class="koboSpan" id="kobo.960.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.960.2" xmlns:="http://www.w3.org/1999/xhtml">Finally, we determined the time difference between the </span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.961.1" xmlns:="http://www.w3.org/1999/xhtml">variables by subtracting one series from the other and capturing the difference in days. </span><span class="koboSpan" id="kobo.961.2" xmlns:="http://www.w3.org/1999/xhtml">To reassign a different time zone, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.962.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.963.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.964.1" xmlns:="http://www.w3.org/1999/xhtml">tz_convert</span><a id="_idTextAnchor848"/><a id="_idTextAnchor849"/><span class="koboSpan" id="kobo.965.1" xmlns:="http://www.w3.org/1999/xhtml">()</span></strong><span class="koboSpan" id="kobo.966.1" xmlns:="http://www.w3.org/1999/xhtml">, indicating the</span><a id="_idTextAnchor850"/><span class="koboSpan" id="kobo.967.1" xmlns:="http://www.w3.org/1999/xhtml"> new time zone as </span><span class="No-Break"><span class="koboSpan" id="kobo.968.1" xmlns:="http://www.w3.org/1999/xhtml">an argument.</span></span></p>
<h2 id="_idParaDest-190"><a id="_idTextAnchor851"/><span class="koboSpan" id="kobo.969.1" xmlns:="http://www.w3.org/1999/xhtml">See also</span></h2>
<p><span class="koboSpan" id="kobo.970.1" xmlns:="http://www.w3.org/1999/xhtml">To</span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.971.1" xmlns:="http://www.w3.org/1999/xhtml"> learn more about </span><strong class="source-inline"><span class="koboSpan" id="kobo.972.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.973.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.974.1" xmlns:="http://www.w3.org/1999/xhtml">to_datetime()</span></strong><span class="koboSpan" id="kobo.975.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.976.1" xmlns:="http://www.w3.org/1999/xhtml">visit </span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html"><span class="No-Break"><span class="koboSpan" id="kobo.977.1" xmlns:="http://www.w3.org/1999/xhtml">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.978.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><span class="koboSpan" id="kobo.979.1" xmlns:="http://www.w3.org/1999/xhtml">To learn </span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.980.1" xmlns:="http://www.w3.org/1999/xhtml">more about </span><strong class="source-inline"><span class="koboSpan" id="kobo.981.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.982.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.983.1" xmlns:="http://www.w3.org/1999/xhtml">tz_convert()</span></strong><span class="koboSpan" id="kobo.984.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><span class="No-Break"><span class="koboSpan" id="kobo.985.1" xmlns:="http://www.w3.org/1999/xhtml">visit </span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.tz_convert.html"><span class="No-Break"><span class="koboSpan" id="kobo.986.1" xmlns:="http://www.w3.org/1999/xhtml">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.tz_convert.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.987.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h1 id="_idParaDest-191"><span class="koboSpan" id="kobo.988.1" xmlns:="http://www.w3.org/1999/xhtml">Automating the datetime fea</span><a id="_idTextAnchor852"/><span class="koboSpan" id="kobo.989.1" xmlns:="http://www.w3.org/1999/xhtml">ture extraction with</span><a id="_idTextAnchor853"/><span class="koboSpan" id="kobo.990.1" xmlns:="http://www.w3.org/1999/xhtml"> Feature-engine</span></h1>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.991.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.992.1" xmlns:="http://www.w3.org/1999/xhtml"> is a </span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.993.1" xmlns:="http://www.w3.org/1999/xhtml">Python library for feature engineering and selection that is well suited to working with </span><strong class="source-inline"><span class="koboSpan" id="kobo.994.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.995.1" xmlns:="http://www.w3.org/1999/xhtml"> DataFrames. </span><span class="koboSpan" id="kobo.995.2" xmlns:="http://www.w3.org/1999/xhtml">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.997.1" xmlns:="http://www.w3.org/1999/xhtml"> class can extract features from date and time automatically by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.998.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.999.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.1001.1" xmlns:="http://www.w3.org/1999/xhtml"> under the hood. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1003.1" xmlns:="http://www.w3.org/1999/xhtml"> allows you to </span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.1004.1" xmlns:="http://www.w3.org/1999/xhtml">extract the </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1" xmlns:="http://www.w3.org/1999/xhtml">following</span></span><span class="No-Break"><a id="_idIndexMarker497"/></span><span class="No-Break"><span class="koboSpan" id="kobo.1006.1" xmlns:="http://www.w3.org/1999/xhtml"> features:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1007.1" xmlns:="http://www.w3.org/1999/xhtml">Month</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1008.1" xmlns:="http://www.w3.org/1999/xhtml">Quarter</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1009.1" xmlns:="http://www.w3.org/1999/xhtml">Semester</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1010.1" xmlns:="http://www.w3.org/1999/xhtml">Year</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1011.1" xmlns:="http://www.w3.org/1999/xhtml">Week</span></span></li>
<li><span class="koboSpan" id="kobo.1012.1" xmlns:="http://www.w3.org/1999/xhtml">Day of </span><span class="No-Break"><span class="koboSpan" id="kobo.1013.1" xmlns:="http://www.w3.org/1999/xhtml">the week</span></span></li>
<li><span class="koboSpan" id="kobo.1014.1" xmlns:="http://www.w3.org/1999/xhtml">Day of </span><span class="No-Break"><span class="koboSpan" id="kobo.1015.1" xmlns:="http://www.w3.org/1999/xhtml">the month</span></span></li>
<li><span class="koboSpan" id="kobo.1016.1" xmlns:="http://www.w3.org/1999/xhtml">Day of </span><span class="No-Break"><span class="koboSpan" id="kobo.1017.1" xmlns:="http://www.w3.org/1999/xhtml">the year</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1018.1" xmlns:="http://www.w3.org/1999/xhtml">Weekend</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1019.1" xmlns:="http://www.w3.org/1999/xhtml">Month start</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1020.1" xmlns:="http://www.w3.org/1999/xhtml">Month end</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1021.1" xmlns:="http://www.w3.org/1999/xhtml">Quarter start</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1022.1" xmlns:="http://www.w3.org/1999/xhtml">Quarter end</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1023.1" xmlns:="http://www.w3.org/1999/xhtml">Year start</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1024.1" xmlns:="http://www.w3.org/1999/xhtml">Year end</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1025.1" xmlns:="http://www.w3.org/1999/xhtml">Leap year</span></span></li>
<li><span class="koboSpan" id="kobo.1026.1" xmlns:="http://www.w3.org/1999/xhtml">Days in </span><span class="No-Break"><span class="koboSpan" id="kobo.1027.1" xmlns:="http://www.w3.org/1999/xhtml">a month</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1028.1" xmlns:="http://www.w3.org/1999/xhtml">Hour</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1029.1" xmlns:="http://www.w3.org/1999/xhtml">Minute</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.1030.1" xmlns:="http://www.w3.org/1999/xhtml">Second</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1031.1" xmlns:="http://www.w3.org/1999/xhtml">In this recipe, we will automatically create fea</span><a id="_idTextAnchor854"/><a id="_idTextAnchor855"/><span class="koboSpan" id="kobo.1032.1" xmlns:="http://www.w3.org/1999/xhtml">tures from date and time by </span><span class="No-Break"><span class="koboSpan" id="kobo.1033.1" xmlns:="http://www.w3.org/1999/xhtml">utilizing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1035.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<h2 id="_idParaDest-192"><a id="_idTextAnchor856"/><span class="koboSpan" id="kobo.1036.1" xmlns:="http://www.w3.org/1999/xhtml">How to do it...</span></h2>
<p><span class="koboSpan" id="kobo.1037.1" xmlns:="http://www.w3.org/1999/xhtml">To </span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.1038.1" xmlns:="http://www.w3.org/1999/xhtml">showcase </span><strong class="source-inline"><span class="koboSpan" id="kobo.1039.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1040.1" xmlns:="http://www.w3.org/1999/xhtml">’s functionality, we’ll </span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.1041.1" xmlns:="http://www.w3.org/1999/xhtml">create a sample DataFrame with a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1042.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1043.1" xmlns:="http://www.w3.org/1999/xhtml"> variable:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1044.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s begin by importing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1046.1" xmlns:="http://www.w3.org/1999/xhtml">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1047.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1048.1" xmlns:="http://www.w3.org/1999/xhtml">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1049.1" xmlns:="http://www.w3.org/1999/xhtml">
import pandas as pd
from feature_engine.datetime import DatetimeFeatures</span></pre></li> <li><span class="koboSpan" id="kobo.1050.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1051.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1052.1" xmlns:="http://www.w3.org/1999/xhtml"> variable with 20 values, beginning from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1053.1" xmlns:="http://www.w3.org/1999/xhtml">2024-05-17</span></strong><span class="koboSpan" id="kobo.1054.1" xmlns:="http://www.w3.org/1999/xhtml"> at midnight and followed by increments of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1055.1" xmlns:="http://www.w3.org/1999/xhtml">1</span></strong><span class="koboSpan" id="kobo.1056.1" xmlns:="http://www.w3.org/1999/xhtml"> day. </span><span class="koboSpan" id="kobo.1056.2" xmlns:="http://www.w3.org/1999/xhtml">Then, we store this variable in </span><span class="No-Break"><span class="koboSpan" id="kobo.1057.1" xmlns:="http://www.w3.org/1999/xhtml">a DataFrame:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1058.1" xmlns:="http://www.w3.org/1999/xhtml">
rng_ = pd.date_range(
    '2024-05-17', periods=20, freq='D')
data = pd.DataFrame({'date': rng_})</span></pre></li> <li><span class="koboSpan" id="kobo.1059.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll</span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.1060.1" xmlns:="http://www.w3.org/1999/xhtml"> start by setting </span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.1061.1" xmlns:="http://www.w3.org/1999/xhtml">up the transformer to extract all supported </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1062.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1063.1" xmlns:="http://www.w3.org/1999/xhtml"> features:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1064.1" xmlns:="http://www.w3.org/1999/xhtml">
dtfs = DatetimeFeatures(
    variables=None,
    features_to_extract= "all",
)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1065.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1067.1" xmlns:="http://www.w3.org/1999/xhtml"> automatically finds the variables of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1068.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1069.1" xmlns:="http://www.w3.org/1999/xhtml"> type, or that could be parsed as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1070.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1071.1" xmlns:="http://www.w3.org/1999/xhtml"> when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1072.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1073.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1" xmlns:="http://www.w3.org/1999/xhtml">None</span></strong><span class="koboSpan" id="kobo.1075.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1075.2" xmlns:="http://www.w3.org/1999/xhtml">Alternatively, you can pass a list with the names of the variables from which you want to extract </span><strong class="source-inline"><span class="koboSpan" id="kobo.1076.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong><span class="koboSpan" id="kobo.1077.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1079.1" xmlns:="http://www.w3.org/1999/xhtml"> features.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1080.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong><span class="koboSpan" id="kobo.1082.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1083.1" xmlns:="http://www.w3.org/1999/xhtml">time</span></strong><span class="koboSpan" id="kobo.1084.1" xmlns:="http://www.w3.org/1999/xhtml"> features to </span><span class="No-Break"><span class="koboSpan" id="kobo.1085.1" xmlns:="http://www.w3.org/1999/xhtml">the data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1086.1" xmlns:="http://www.w3.org/1999/xhtml">
dft = dtfs.fit_transform(data)</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1087.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1088.1" xmlns:="http://www.w3.org/1999/xhtml">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1090.1" xmlns:="http://www.w3.org/1999/xhtml"> extracts the following features from each </span><strong class="source-inline"><span class="koboSpan" id="kobo.1091.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1092.1" xmlns:="http://www.w3.org/1999/xhtml"> variable: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1093.1" xmlns:="http://www.w3.org/1999/xhtml">month</span></strong><span class="koboSpan" id="kobo.1094.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1095.1" xmlns:="http://www.w3.org/1999/xhtml">year</span></strong><span class="koboSpan" id="kobo.1096.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1097.1" xmlns:="http://www.w3.org/1999/xhtml">day_of_week</span></strong><span class="koboSpan" id="kobo.1098.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1" xmlns:="http://www.w3.org/1999/xhtml">day_of_month</span></strong><span class="koboSpan" id="kobo.1100.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1101.1" xmlns:="http://www.w3.org/1999/xhtml">hour</span></strong><span class="koboSpan" id="kobo.1102.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1103.1" xmlns:="http://www.w3.org/1999/xhtml">minute</span></strong><span class="koboSpan" id="kobo.1104.1" xmlns:="http://www.w3.org/1999/xhtml">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1105.1" xmlns:="http://www.w3.org/1999/xhtml">second</span></strong><span class="koboSpan" id="kobo.1106.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1106.2" xmlns:="http://www.w3.org/1999/xhtml">We can modify this behavior through the</span><a id="_idTextAnchor857"/> <strong class="source-inline"><span class="koboSpan" id="kobo.1107.1" xmlns:="http://www.w3.org/1999/xhtml">features_to_extra</span><a id="_idTextAnchor858"/><span class="koboSpan" id="kobo.1108.1" xmlns:="http://www.w3.org/1999/xhtml">ct</span></strong><span class="koboSpan" id="kobo.1109.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter as we did in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1110.1" xmlns:="http://www.w3.org/1999/xhtml">Step 3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1111.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1112.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s </span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.1113.1" xmlns:="http://www.w3.org/1999/xhtml">capture the names</span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.1114.1" xmlns:="http://www.w3.org/1999/xhtml"> of the new variables in </span><span class="No-Break"><span class="koboSpan" id="kobo.1115.1" xmlns:="http://www.w3.org/1999/xhtml">a list:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1116.1" xmlns:="http://www.w3.org/1999/xhtml">
vars_ = [v for v in dft.columns if "date" in v]</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.1117.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1118.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1119.1" xmlns:="http://www.w3.org/1999/xhtml"> names the new variables with the original variable name (in this case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1120.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong><span class="koboSpan" id="kobo.1121.1" xmlns:="http://www.w3.org/1999/xhtml">) followed by an underscore and then the type of feature created, for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1122.1" xmlns:="http://www.w3.org/1999/xhtml">date_day_of_week</span></strong><span class="koboSpan" id="kobo.1123.1" xmlns:="http://www.w3.org/1999/xhtml"> contains the day of the week extracted from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1124.1" xmlns:="http://www.w3.org/1999/xhtml">date</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1125.1" xmlns:="http://www.w3.org/1999/xhtml"> variable.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.1126.1" xmlns:="http://www.w3.org/1999/xhtml">If we execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1127.1" xmlns:="http://www.w3.org/1999/xhtml">vars_</span></strong><span class="koboSpan" id="kobo.1128.1" xmlns:="http://www.w3.org/1999/xhtml">, we’ll see the names of the features that </span><span class="No-Break"><span class="koboSpan" id="kobo.1129.1" xmlns:="http://www.w3.org/1999/xhtml">were created:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1130.1" xmlns:="http://www.w3.org/1999/xhtml">['date_month',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1131.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_quarter',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1132.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_semester',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1133.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_year',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1134.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_week',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1135.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_day_of_week',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1136.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_day_of_month',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1137.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_day_of_year',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1138.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_weekend',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1139.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_month_start',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1140.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_month_end',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1141.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_quarter_start',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1142.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_quarter_end',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1143.1" xmlns:="http://www.w3.org/1999/xhtml">'date_year_start',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1144.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_year_end',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1145.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_leap_year',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1146.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_days_in_month',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1147.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_hour',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1148.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_minute',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1149.1" xmlns:="http://www.w3.org/1999/xhtml"> 'date_second']</span></strong></pre> <p class="list-inset"><span class="koboSpan" id="kobo.1150.1" xmlns:="http://www.w3.org/1999/xhtml">To </span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.1151.1" xmlns:="http://www.w3.org/1999/xhtml">visualize the resulting </span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.1152.1" xmlns:="http://www.w3.org/1999/xhtml">DataFrame, go ahead and execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1153.1" xmlns:="http://www.w3.org/1999/xhtml">dft[vars_].head()</span></strong><span class="koboSpan" id="kobo.1154.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1154.2" xmlns:="http://www.w3.org/1999/xhtml">We can’t show the resulting DataFrame in the book because it is </span><span class="No-Break"><span class="koboSpan" id="kobo.1155.1" xmlns:="http://www.w3.org/1999/xhtml">too big.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1156.1" xmlns:="http://www.w3.org/1999/xhtml">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1157.1" xmlns:="http://www.w3.org/1999/xhtml">We can create specific features by passing their names to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1158.1" xmlns:="http://www.w3.org/1999/xhtml">features_to_extract</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1159.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.1160.1" xmlns:="http://www.w3.org/1999/xhtml">For example, to extract </span><strong class="source-inline"><span class="koboSpan" id="kobo.1161.1" xmlns:="http://www.w3.org/1999/xhtml">week</span></strong><span class="koboSpan" id="kobo.1162.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1163.1" xmlns:="http://www.w3.org/1999/xhtml">year</span></strong><span class="koboSpan" id="kobo.1164.1" xmlns:="http://www.w3.org/1999/xhtml">, we set the transformer like this: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1165.1" xmlns:="http://www.w3.org/1999/xhtml">dtfs = DatetimeFeatures(features_to_extract=["week", "year"])</span></strong><span class="koboSpan" id="kobo.1166.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1166.2" xmlns:="http://www.w3.org/1999/xhtml">We can also extract all supported features by setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1167.1" xmlns:="http://www.w3.org/1999/xhtml">features_to_extract</span></strong><span class="koboSpan" id="kobo.1168.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter </span><span class="No-Break"><span class="koboSpan" id="kobo.1169.1" xmlns:="http://www.w3.org/1999/xhtml">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1170.1" xmlns:="http://www.w3.org/1999/xhtml">"all"</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1171.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p class="list-inset"><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFe</span><a id="_idTextAnchor859"/><span class="koboSpan" id="kobo.1173.1" xmlns:="http://www.w3.org/1999/xhtml">atures()</span></strong><span class="koboSpan" id="kobo.1174.1" xmlns:="http://www.w3.org/1999/xhtml"> can also </span><a id="_idTextAnchor860"/><span class="koboSpan" id="kobo.1175.1" xmlns:="http://www.w3.org/1999/xhtml">create features from variables in different time zones. </span><span class="koboSpan" id="kobo.1175.2" xmlns:="http://www.w3.org/1999/xhtml">Let’s learn how to correctly set up the transformer in </span><span class="No-Break"><span class="koboSpan" id="kobo.1176.1" xmlns:="http://www.w3.org/1999/xhtml">this situation.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1177.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create a sample DataFrame with a variable’s values in different </span><span class="No-Break"><span class="koboSpan" id="kobo.1178.1" xmlns:="http://www.w3.org/1999/xhtml">time zones:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1179.1" xmlns:="http://www.w3.org/1999/xhtml">
df = pd.DataFrame()
df["time"] = pd.concat(
    [
        pd.Series(
            pd.date_range(
            start="2024-08-01 09:00",
            freq="h",
            periods=3,
            tz="Europe/Berlin"
            )
        ),
        pd.Series(
            pd.date_range(
                start="2024-08-01 09:00",
               freq="h",
               periods=3, tz="US</span><a id="_idTextAnchor861"/><span class="koboSpan" id="kobo.1180.1" xmlns:="http://www.w3.org/1999/xhtml">/Central"
          </span><a id="_idTextAnchor862"/><span class="koboSpan" id="kobo.1181.1" xmlns:="http://www.w3.org/1999/xhtml">  )
        ),
    ],
    axis=0,
)</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.1182.1" xmlns:="http://www.w3.org/1999/xhtml">If we</span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.1183.1" xmlns:="http://www.w3.org/1999/xhtml"> execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.1184.1" xmlns:="http://www.w3.org/1999/xhtml">df</span></strong><span class="koboSpan" id="kobo.1185.1" xmlns:="http://www.w3.org/1999/xhtml">, we </span><a id="_idIndexMarker507"/><span class="koboSpan" id="kobo.1186.1" xmlns:="http://www.w3.org/1999/xhtml">will se</span><a id="_idTextAnchor863"/><span class="koboSpan" id="kobo.1187.1" xmlns:="http://www.w3.org/1999/xhtml">e the DataFrame from </span><em class="italic"><span class="koboSpan" id="kobo.1188.1" xmlns:="http://www.w3.org/1999/xhtml">Step 6</span></em><span class="koboSpan" id="kobo.1189.1" xmlns:="http://www.w3.org/1999/xhtml">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1190.1" xmlns:="http://www.w3.org/1999/xhtml">following output:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer115">
<span class="koboSpan" id="kobo.1191.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Figure 6.22 – A DataFrame with a variable’s values in different time zones" src="image/B22396_06_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1192.1" xmlns:="http://www.w3.org/1999/xhtml">Figure 6.22 – A DataFrame with a variable’s values in different time zones</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1193.1" xmlns:="http://www.w3.org/1999/xhtml">We’ll </span><a id="_idIndexMarker508"/><span class="koboSpan" id="kobo.1194.1" xmlns:="http://www.w3.org/1999/xhtml">set the transformer to </span><a id="_idIndexMarker509"/><span class="koboSpan" id="kobo.1195.1" xmlns:="http://www.w3.org/1999/xhtml">extract three specific features from this variable after setting it to </span><span class="No-Break"><span class="koboSpan" id="kobo.1196.1" xmlns:="http://www.w3.org/1999/xhtml">the UTC:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1197.1" xmlns:="http://www.w3.org/1999/xhtml">
dfts = DatetimeFeatures(
    features_to_extract=
        ["day_of_week", "hour","minute"],
    drop_original=False,
    utc=True,
)</span></pre></li> <li><span class="koboSpan" id="kobo.1198.1" xmlns:="http://www.w3.org/1999/xhtml">Let’s create the </span><span class="No-Break"><span class="koboSpan" id="kobo.1199.1" xmlns:="http://www.w3.org/1999/xhtml">new features:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1200.1" xmlns:="http://www.w3.org/1999/xhtml">
dft = dfts.fit_transform(df)</span></pre><p class="list-inset"><strong class="source-inline"><span class="koboSpan" id="kobo.1201.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1202.1" xmlns:="http://www.w3.org/1999/xhtml"> will set all variables into UTC before deriving the</span><a id="_idTextAnchor864"/><span class="koboSpan" id="kobo.1203.1" xmlns:="http://www.w3.org/1999/xhtml"> features. </span><span class="koboSpan" id="kobo.1203.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1204.1" xmlns:="http://www.w3.org/1999/xhtml">dft.head()</span></strong><span class="koboSpan" id="kobo.1205.1" xmlns:="http://www.w3.org/1999/xhtml">, we can see the </span><span class="No-Break"><span class="koboSpan" id="kobo.1206.1" xmlns:="http://www.w3.org/1999/xhtml">resulting DataFrame:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer116">
<span class="koboSpan" id="kobo.1207.1" xmlns:="http://www.w3.org/1999/xhtml"><img alt="Fig﻿ure 6.23 – A DataFrame with t﻿he original and new variables" src="image/B22396_06_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1208.1" xmlns:="http://www.w3.org/1999/xhtml">Fig</span><a id="_idTextAnchor865"/><span class="koboSpan" id="kobo.1209.1" xmlns:="http://www.w3.org/1999/xhtml">ure 6.23 – A DataFrame with t</span><a id="_idTextAnchor866"/><span class="koboSpan" id="kobo.1210.1" xmlns:="http://www.w3.org/1999/xhtml">he original and new variables</span></p>
<p><span class="koboSpan" id="kobo.1211.1" xmlns:="http://www.w3.org/1999/xhtml">With that, we’ve </span><a id="_idIndexMarker510"/><span class="koboSpan" id="kobo.1212.1" xmlns:="http://www.w3.org/1999/xhtml">created multiple date </span><a id="_idIndexMarker511"/><span class="koboSpan" id="kobo.1213.1" xmlns:="http://www.w3.org/1999/xhtml">and time-related features in a few lines of code. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1214.1" xmlns:="http://www.w3.org/1999/xhtml">feature-engine</span></strong><span class="koboSpan" id="kobo.1215.1" xmlns:="http://www.w3.org/1999/xhtml"> offers a great alternative to manually creating features per feature with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1216.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1217.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1217.2" xmlns:="http://www.w3.org/1999/xhtml">In addition, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1218.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1219.1" xmlns:="http://www.w3.org/1999/xhtml"> can be integrated in</span><a id="_idTextAnchor867"/><a id="_idTextAnchor868"/><span class="koboSpan" id="kobo.1220.1" xmlns:="http://www.w3.org/1999/xhtml">to scikit-learn’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.1221.1" xmlns:="http://www.w3.org/1999/xhtml">Pipeline</span></strong><span class="koboSpan" id="kobo.1222.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1223.1" xmlns:="http://www.w3.org/1999/xhtml">GridSearchCV</span></strong><span class="koboSpan" id="kobo.1224.1" xmlns:="http://www.w3.org/1999/xhtml">, among </span><span class="No-Break"><span class="koboSpan" id="kobo.1225.1" xmlns:="http://www.w3.org/1999/xhtml">other classes.</span></span></p>
<h2 id="_idParaDest-193"><a id="_idTextAnchor869"/><span class="koboSpan" id="kobo.1226.1" xmlns:="http://www.w3.org/1999/xhtml">How it works...</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1227.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1228.1" xmlns:="http://www.w3.org/1999/xhtml"> extracts several date and time features from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1229.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1230.1" xmlns:="http://www.w3.org/1999/xhtml"> variables automatically by utilizing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1231.1" xmlns:="http://www.w3.org/1999/xhtml">pandas</span></strong><span class="koboSpan" id="kobo.1232.1" xmlns:="http://www.w3.org/1999/xhtml">’ </span><strong class="source-inline"><span class="koboSpan" id="kobo.1233.1" xmlns:="http://www.w3.org/1999/xhtml">dt</span></strong><span class="koboSpan" id="kobo.1234.1" xmlns:="http://www.w3.org/1999/xhtml"> under the hood. </span><span class="koboSpan" id="kobo.1234.2" xmlns:="http://www.w3.org/1999/xhtml">It works with variables whose original data types are </span><strong class="source-inline"><span class="koboSpan" id="kobo.1235.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1236.1" xmlns:="http://www.w3.org/1999/xhtml">, as well as with object-like and categorical variables, provided that they can be parsed into a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1237.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1238.1" xmlns:="http://www.w3.org/1999/xhtml"> format.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1239.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1240.1" xmlns:="http://www.w3.org/1999/xhtml"> extracts the following features by default: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1241.1" xmlns:="http://www.w3.org/1999/xhtml">month</span></strong><span class="koboSpan" id="kobo.1242.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1243.1" xmlns:="http://www.w3.org/1999/xhtml">year</span></strong><span class="koboSpan" id="kobo.1244.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1245.1" xmlns:="http://www.w3.org/1999/xhtml">day_of_week</span></strong><span class="koboSpan" id="kobo.1246.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1247.1" xmlns:="http://www.w3.org/1999/xhtml">day_of_month</span></strong><span class="koboSpan" id="kobo.1248.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1249.1" xmlns:="http://www.w3.org/1999/xhtml">hour</span></strong><span class="koboSpan" id="kobo.1250.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1251.1" xmlns:="http://www.w3.org/1999/xhtml">minute</span></strong><span class="koboSpan" id="kobo.1252.1" xmlns:="http://www.w3.org/1999/xhtml"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1253.1" xmlns:="http://www.w3.org/1999/xhtml">second</span></strong><span class="koboSpan" id="kobo.1254.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1254.2" xmlns:="http://www.w3.org/1999/xhtml">We can make the transformer return all the features it supports by setting the parameter </span><strong class="source-inline"><span class="koboSpan" id="kobo.1255.1" xmlns:="http://www.w3.org/1999/xhtml">features_to_extract</span></strong><span class="koboSpan" id="kobo.1256.1" xmlns:="http://www.w3.org/1999/xhtml"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1257.1" xmlns:="http://www.w3.org/1999/xhtml">all</span></strong><span class="koboSpan" id="kobo.1258.1" xmlns:="http://www.w3.org/1999/xhtml">. </span><span class="koboSpan" id="kobo.1258.2" xmlns:="http://www.w3.org/1999/xhtml">In addition, we can extract a specific subset of features by passing the feature names in a list, as we did in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1259.1" xmlns:="http://www.w3.org/1999/xhtml">Step 7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1260.1" xmlns:="http://www.w3.org/1999/xhtml">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1261.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1262.1" xmlns:="http://www.w3.org/1999/xhtml"> automatically finds </span><strong class="source-inline"><span class="koboSpan" id="kobo.1263.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1264.1" xmlns:="http://www.w3.org/1999/xhtml"> variables or variables that can be parsed as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1265.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1266.1" xmlns:="http://www.w3.org/1999/xhtml"> in the DataFrame passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1267.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1268.1" xmlns:="http://www.w3.org/1999/xhtml"> method. </span><span class="koboSpan" id="kobo.1268.2" xmlns:="http://www.w3.org/1999/xhtml">To extract features from a selected variable or group of variables, we can pass their name in a list to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1269.1" xmlns:="http://www.w3.org/1999/xhtml">variables</span></strong><span class="koboSpan" id="kobo.1270.1" xmlns:="http://www.w3.org/1999/xhtml"> parameter when we set up </span><span class="No-Break"><span class="koboSpan" id="kobo.1271.1" xmlns:="http://www.w3.org/1999/xhtml">the transformer.</span></span></p>
<p><span class="koboSpan" id="kobo.1272.1" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1273.1" xmlns:="http://www.w3.org/1999/xhtml">fit()</span></strong><span class="koboSpan" id="kobo.1274.1" xmlns:="http://www.w3.org/1999/xhtml">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1275.1" xmlns:="http://www.w3.org/1999/xhtml">Dat</span><a id="_idTextAnchor870"/><span class="koboSpan" id="kobo.1276.1" xmlns:="http://www.w3.org/1999/xhtml">etimeFeatures()</span></strong><span class="koboSpan" id="kobo.1277.1" xmlns:="http://www.w3.org/1999/xhtml"> doe</span><a id="_idTextAnchor871"/><span class="koboSpan" id="kobo.1278.1" xmlns:="http://www.w3.org/1999/xhtml">s not learn any parameters; instead, it checks that the variables entered by the user are, or can be, parsed into a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1279.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1280.1" xmlns:="http://www.w3.org/1999/xhtml"> format. </span><span class="koboSpan" id="kobo.1280.2" xmlns:="http://www.w3.org/1999/xhtml">If the user does not indicate variable names, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1281.1" xmlns:="http://www.w3.org/1999/xhtml">DatetimeFeatures()</span></strong><span class="koboSpan" id="kobo.1282.1" xmlns:="http://www.w3.org/1999/xhtml"> finds the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1283.1" xmlns:="http://www.w3.org/1999/xhtml">datetime</span></strong><span class="koboSpan" id="kobo.1284.1" xmlns:="http://www.w3.org/1999/xhtml"> variables </span><a id="_idIndexMarker512"/><span class="koboSpan" id="kobo.1285.1" xmlns:="http://www.w3.org/1999/xhtml">automatically. </span><span class="koboSpan" id="kobo.1285.2" xmlns:="http://www.w3.org/1999/xhtml">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1286.1" xmlns:="http://www.w3.org/1999/xhtml">transform()</span></strong><span class="koboSpan" id="kobo.1287.1" xmlns:="http://www.w3.org/1999/xhtml">, the </span><a id="_idIndexMarker513"/><span class="koboSpan" id="kobo.1288.1" xmlns:="http://www.w3.org/1999/xhtml">tr</span><a id="_idTextAnchor872"/><span class="koboSpan" id="kobo.1289.1" xmlns:="http://www.w3.org/1999/xhtml">ansformer adds the date and time-derived variables to </span><span class="No-Break"><span class="koboSpan" id="kobo.1290.1" xmlns:="http://www.w3.org/1999/xhtml">the DataFrame.</span></span></p>
</div>
</body></html>
<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer245">
<h1 class="chapter-number" id="_idParaDest-208"><a id="_idTextAnchor217"/>14</h1>
<h1 id="_idParaDest-209"><a id="_idTextAnchor218"/>Survival Models</h1>
<p>In <span class="No-Break"><em class="italic">Chapter 13</em></span><em class="italic">, Time-to-Event Variables</em>, we introduced the topics of survival analysis, censoring, and <strong class="bold">time-to-event</strong> (<strong class="bold">TTE</strong>) variables. In this chapter, we will provide an in-depth overview and walkthrough of the implementation of these techniques with respect to three primary <span class="No-Break">model frameworks:</span></p>
<ul>
<li><span class="No-Break">Kaplan-Meier model</span></li>
<li><span class="No-Break">Exponential model</span></li>
<li>Cox Proportional <span class="No-Break">Hazards model</span></li>
</ul>
<p>We will discuss how each approach provides probabilistic insight into the survival and hazard risk of study subjects using univariate Kaplan-Meier and exponential approaches as well as the multivariate Cox Proportional Hazards regression model. We’ll walk through examples using real data and discuss the results so that the reader understands how to assess performance and translate test output into useful information. Finally, we will show how to use the trained models to provide forecast probabilities for <span class="No-Break">unseen data.</span></p>
<h1 id="_idParaDest-210"><a id="_idTextAnchor219"/>Technical requirements</h1>
<p>In this chapter, we use an additional Python library for survival analysis: <strong class="source-inline">lifelines</strong>. Please install the following versions of these libraries to run the provided code. Instructions for installing libraries can be found in <a href="B18945_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic">Chapter 1</em></span></a><em class="italic">, Sampling </em><span class="No-Break"><em class="italic">and Generalization</em></span><span class="No-Break">:</span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline">lifelines== 0.27.4</strong></span></li>
</ul>
<p>More information about <strong class="source-inline">lifelines</strong> can be found at <span class="No-Break">this link:</span></p>
<p><a href="https://lifelines.readthedocs.io/en/latest/index.xhtml"><span class="No-Break">https://lifelines.readthedocs.io/en/latest/index.xhtml</span></a></p>
<h1 id="_idParaDest-211"><a id="_idTextAnchor220"/>Kaplan-Meier model</h1>
<p>The <a id="_idIndexMarker1015"/>first model for survival analysis we will discuss is the <strong class="bold">Kaplan-Meier model</strong> (also called the <strong class="bold">Kaplan-Meier estimator</strong>). We will start this section with a discussion model definition and learn how it is built. Then, we will close this section with an example of how to use this model in Python using the <strong class="source-inline">lifelines</strong> library. Let’s <span class="No-Break">get started.</span></p>
<h2 id="_idParaDest-212"><a id="_idTextAnchor221"/>Model definition</h2>
<p>The <a id="_idIndexMarker1016"/>Kaplan-Meier estimator is defined by the <span class="No-Break">following formula:</span></p>
<p><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">ˆ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">∏</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Operator">:</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Operator">≤</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Base"> </span></p>
<p>Here, <span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span> is the number of subjects at risk just before time <span class="_-----MathTools-_Math_Variable">t</span>, <span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span> is the number of death events at time <span class="_-----MathTools-_Math_Variable">t</span>, and <span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">ˆ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span> (the survival function) is the probability that life is longer than <span class="_-----MathTools-_Math_Variable">t</span>. The <span class="_-----MathTools-_Math_Variable">Π</span> symbol used in the formula is like the symbol <span class="_-----MathTools-_Math_Variable">Σ</span>; however, <span class="_-----MathTools-_Math_Variable">Π</span> indicates multiplication. This means that the preceding formula will result in a multiplication of fractions for each time step <span class="_-----MathTools-_Math_Variable">t</span>. This means that the Kaplan-Meier estimator is a series of declining horizontal steps. To make this clear, let’s take a look at its application with some <span class="No-Break">example data.</span></p>
<p>Let’s say that we have the following data, where the <strong class="source-inline">duration</strong> column represents how long a subject survived and the <strong class="source-inline">death</strong> column indicates whether a death was observed in the study. Let’s walk through the calculations for the Kaplan-Meier estimator for <span class="No-Break">this data:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-9">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">duration</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">death</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">5</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline">1</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">7</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline">1</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline">3.5</strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline">1</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">8</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline">0</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">2</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline">1</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline">5</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline">1</strong></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.1 – Death and duration example data</p>
<p>Initially (at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span>), all subjects are at risk, but no subjects have died. That means the current survival rate is 1. We calculate the value of the survival function at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span> <span class="No-Break">as follows:</span></p>
<p><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">ˆ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Number">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span></p>
<p>The <a id="_idIndexMarker1017"/>first event occurs at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span>. At this point, all subjects (six subjects) are at risk just before the event, and one subject dies at this time. We calculate the current survival rate at this point, then multiply this value by all the previous values. The survival rate at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span> is <span class="No-Break">given here:</span></p>
<p><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">≈</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Number">0.83</span></span></p>
<p>Then, we calculate the survival function at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Number">2</span></span><span class="No-Break">:</span></p>
<p><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">ˆ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Number">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base">  </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base">_____________</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Number">  </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base">__________</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">≈</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Number">0.83</span></span></p>
<p>The next event occurs at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">3.5</span>. We repeat the process as outlined previously. However, there are only five subjects at risk at this point since one has already died. Thus, the current survival rate at time <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">3.5</span> <span class="No-Break">is this:</span></p>
<p><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">3</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">3</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">3</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">5</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">5</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Number">0.8</span></span></p>
<p>Then, we calculate the survival function at <span class="No-Break">this point:</span></p>
<p><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">ˆ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Number">3.5</span><span class="_-----MathTools-_Math_Number">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base">  </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base">  </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">3.5</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">3.5</span><span class="_-----MathTools-_Math_Base">   </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base">____________</span><span class="_-----MathTools-_Math_Base">  </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">3.5</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Number">  </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">6</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">5</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Number">  </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base">__________</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">5</span><span class="_-----MathTools-_Math_Number"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">≈</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Number">0.67</span></span></p>
<p>The next event occurs at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">5</span>, where two subjects die. At <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">5</span>, there are four remaining subjects at risk, and two subjects die. Thus, we have a survival rate of 0.5 at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">5</span>. The new value of the survival function is calculated <span class="No-Break">as follows:</span></p>
<p><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">ˆ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Number">5</span><span class="_-----MathTools-_Math_Number">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0.83</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0.67</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0.5</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">≈</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Number">0.33</span></span></p>
<p>The final event occurs at <span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">7</span>. At this point, the survival rate is 0.5 and the value of the survival function at this point is <span class="No-Break">approximately 0.167:</span></p>
<p><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">ˆ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Number">7</span><span class="_-----MathTools-_Math_Number">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0.83</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0.67</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0.5</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Symbol">*</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0.5</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">≈</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Number">0.167</span></span></p>
<p>Since our study ends here, this is the final value of the survival function, and the function value remains constant through the end of <span class="No-Break">the study.</span></p>
<p>As you can see, this <a id="_idIndexMarker1018"/>survival model is simple to calculate. Notice also that we did not mention assumptions or underlying statistical distributions. The Kaplan-Meier estimator is a nonparametric survival model. As we discussed in <a href="B18945_05.xhtml#_idTextAnchor087"><span class="No-Break"><em class="italic">Chapter 5</em></span></a><em class="italic">, Non-Parametric Tests</em>, this means it can be used as an alternative to parametric models when the data under analysis does not meet the assumptions of parametric models. The Kaplan-Meier estimator is a useful model to have in your tool belt for <span class="No-Break">that reason.</span></p>
<p>Now that we have had a walkthrough of how this model works, let’s look at how to calculate the Kaplan-Meier estimator survival function with the <strong class="source-inline">lifelines</strong> package <span class="No-Break">in Python.</span></p>
<h2 id="_idParaDest-213"><a id="_idTextAnchor222"/>Model example</h2>
<p>For this<a id="_idIndexMarker1019"/> example, we will use the <strong class="source-inline">larynx</strong> dataset from <strong class="source-inline">lifelines</strong>. This dataset consists of six variables: <strong class="source-inline">time</strong>, <strong class="source-inline">age</strong>, <strong class="source-inline">death</strong>, <strong class="source-inline">Stage_II</strong>, <strong class="source-inline">Stage_III</strong>, and <strong class="source-inline">Stage_IV</strong>. The information for this dataset is limited, so we will make the following assumptions about the variables for the purposes of <span class="No-Break">this example:</span></p>
<ul>
<li><strong class="source-inline">time</strong> is the amount of time a patient lived after diagnosis of <span class="No-Break">larynx cancer</span></li>
<li><strong class="source-inline">age</strong> is the age of the patient at the time <span class="No-Break">of diagnosis</span></li>
<li><strong class="source-inline">death</strong> indicates whether the death was observed during <span class="No-Break">the study</span></li>
<li><strong class="source-inline">Stage_II</strong> indicates that the cancer was at stage two at the time <span class="No-Break">of diagnosis</span></li>
<li><strong class="source-inline">Stage_III</strong> indicates that the cancer was at stage three at the time <span class="No-Break">of diagnosis</span></li>
<li><strong class="source-inline">Stage_IV</strong> indicates that the cancer was at stage four at the time <span class="No-Break">of diagnosis</span></li>
<li>When a patient is not indicated in stage two or above, they were in stage one at the time <span class="No-Break">of diagnosis</span></li>
</ul>
<p>Let’s start by calculating the survival function of all the patients in the study. We will use <strong class="source-inline">KaplanMeierFitter</strong> from <strong class="source-inline">lifelines</strong>. This is an object that will be the Kaplan-Meier model we just discussed. To fit this model, we will use the <strong class="source-inline">fit()</strong> method, which takes two arguments: <strong class="source-inline">duration</strong> and <strong class="source-inline">event_observed</strong>. <strong class="source-inline">duration</strong> is how long the patient lived in the study. <strong class="source-inline">event_observed</strong> is whether the death was observed: <strong class="source-inline">True</strong> for <a id="_idIndexMarker1020"/>observed and <strong class="source-inline">False</strong> for not observed. The data is already set up to work with these two arguments. We can fit the model <span class="No-Break">as follows:</span></p>
<pre class="source-code">
import matplotlib.pyplot as plt
from lifelines import datasets
from lifelines.fitters.kaplan_meier_fitter import KaplanMeierFitter
data = datasets.load_larynx()
kmf = KaplanMeierFitter()
kmf.fit(data.time, data.death)
# this prints the first 5 elements of the survival function
kmf.survival_function_.head()</pre>
<p>The output of the preceding code is shown in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.2</em>, which is the first five elements of the <span class="No-Break">survival function:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer231">
<img alt="Figure 14.2 – First five elements of the larynx survival function" height="210" src="image/B18945_14_002.jpg" width="169"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.2 – First five elements of the larynx survival function</p>
<p>The elements of the survival function shown in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.2</em> are slowly decreasing, which is indicative of patients dying over time. However, it’s difficult to get the full story from a series of numbers. Let’s plot this series. We can also get the confidence intervals from <a id="_idIndexMarker1021"/>the <strong class="source-inline">KaplanMeierFitter</strong> object, as shown in the next <span class="No-Break">code block:</span></p>
<pre class="source-code">
fig, ax = plt.subplots(1)
kmf.survival_function_.plot(ax=ax)
ci = kmf.confidence_interval_survival_function_
index = ci.index
ci_low, ci_high = ci.values[:, 0], ci.values[:, 1]
ax.fill_between(index, ci_low, ci_high, color='gray', alpha=0.3)</pre>
<p>This code results in the plot shown in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.3</em>, which is the survival function <span class="No-Break">over time:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer232">
<img alt="Figure 14.3 – Larynx survival function using Kaplan-Meier estimation" height="757" src="image/B18945_14_003.jpg" width="1070"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.3 – Larynx survival function using Kaplan-Meier estimation</p>
<p>The Kaplan-Meier estimator survival function for the larynx data is shown in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.3</em>. This function decreases over time until the last observed death at time step 8 where the function remains constant until the end of <span class="No-Break">the study.</span></p>
<p>Now, consider <a id="_idIndexMarker1022"/>we have a few features in this dataset that we may want to compare. For example, we have the stages of cancer at the initial diagnosis, and we have the ages of the individuals. Let us start by comparing the survival functions of two age groups. Then, let us compare the survival functions of groups based on the <span class="No-Break">cancer stage.</span></p>
<p>The ages of individuals in the study range from about 40 to 85, with the bulk of the individuals in the range of 60 to 80 years old. Let’s split the individuals into groups at the age of 65. Anyone younger than 65 will be in the younger group, and anyone 65 or older will be in the older group. The survival functions for the two groups are shown in <span class="No-Break"><em class="italic">Figure 14</em></span><span class="No-Break"><em class="italic">.4</em></span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer233">
<img alt="Figure 14.4 – Larynx survival functions for older and younger groups" height="723" src="image/B18945_14_004.jpg" width="1081"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.4 – Larynx survival functions for older and younger groups</p>
<p>The survival functions for the older and younger group shown in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.4</em> appear to exhibit little difference until around time step 7. However, the confidence intervals never appear to diverge. It appears that age does not appear to be a strong factor for survival based on <span class="No-Break">this data.</span></p>
<p>Now, let’s do a <a id="_idIndexMarker1023"/>similar survival analysis with the various stages. As mentioned previously, we will assume that any individual that is not indicated in stage two or above was diagnosed as stage one. The survival functions for these groups are shown in <span class="No-Break"><em class="italic">Figure 14</em></span><span class="No-Break"><em class="italic">.5</em></span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer234">
<img alt="Figure 14.5 – Larynx survival functions based on stage" height="731" src="image/B18945_14_005.jpg" width="1055"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.5 – Larynx survival functions based on stage</p>
<p>The survival functions for the groups based on stage are shown in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.5</em>. This plot omits the confidence intervals for plot clarity. Based on the plot, there does not appear to be a significant difference between stage one and stage two. We start to see a difference at stage three. The difference between stage four and the other stages is <span class="No-Break">distinctly noticeable.</span></p>
<p>In this section, we discussed the Kaplan-Meier model for survival, which is a nonparametric model for survival data. We also discussed how to compare the survival functions of multiple <a id="_idIndexMarker1024"/>groups within a set. In the next section, we will discuss the exponential model, which is a parametric model for <span class="No-Break">survival data.</span></p>
<h1 id="_idParaDest-214"><a id="_idTextAnchor223"/>Exponential model</h1>
<p>In the<a id="_idIndexMarker1025"/> last section, we studied the non-parametric <strong class="bold">Kaplan-Meier survival model</strong>. We will now bridge parametric modeling with the <strong class="bold">exponential model</strong> and then will discuss a semi-parametric model, the <strong class="bold">Cox Proportional Hazards model</strong>, in the next section. Before considering the exponential model, we will review what the exponential distribution is and why we mention it in this section. This distribution is based on the Poisson process. Here, events occur independently over time and the event rate, <span class="_-----MathTools-_Math_Variable">λ</span>, is calculated by the number of occurrences per unit of time, <span class="No-Break">as follows:</span></p>
<p> <span class="_-----MathTools-_Math_Variable">λ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">Y</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable"> </span> </p>
<p>The <a id="_idIndexMarker1026"/>Poisson distribution<a id="_idIndexMarker1027"/> is a <strong class="bold">statistical discrete distribution</strong> concerning the number of events occurring in a specified time period. It is defined as follows. Let <em class="italic">Y</em> be the number of occurrences in time <em class="italic">t</em>. <span class="_-----MathTools-_Math_Variable">Y</span> follows the Poisson distribution with parameter <span class="_-----MathTools-_Math_Variable">λ</span> if a probability mass function is given by the <span class="No-Break">following formula:</span></p>
<p><span class="_-----MathTools-_Math_Variable">f</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">Y</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Variable">r</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">y</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">Y</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Variable">λ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">λ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">Y</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">Y</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">!</span><span class="_-----MathTools-_Math_Operator"> </span></p>
<p>The mean and the variance of the discrete variable <span class="_-----MathTools-_Math_Variable">y</span> are equal to the event rate. Instead of focusing on how many events occur in a specific time period, we can think about how long the event occurs; that’s why the exponential distribution is considered in this section. Let <span class="_-----MathTools-_Math_Variable">T</span> be the time until the event occurs <span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">Y</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Number">)</span>. The probability density function is calculated by the <span class="No-Break">following formula:</span></p>
<p><span class="_-----MathTools-_Math_Variable">f</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">T</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">λ</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">e</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base"> </span></span><span class="No-Break"><span class="_-----MathTools-_Math_Operator">−</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">λ</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">t</span></span></p>
<p>And the cumulative distribution function is calculated <span class="No-Break">as follows:</span></p>
<p><span class="_-----MathTools-_Math_Variable">F</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">T</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">≤</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">e</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base"> </span></span><span class="No-Break"><span class="_-----MathTools-_Math_Operator">−</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">λ</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">t</span></span></p>
<p>The function <span class="_-----MathTools-_Math_Variable">F</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span> represents the probability of not surviving past time <span class="_-----MathTools-_Math_Variable">t</span> or the probability that survival time is less than <span class="_-----MathTools-_Math_Variable">t</span>. We can see in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.6</em> the following <span class="No-Break">probability form:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer235">
<img alt="Figure 14.6 – Curve of the probability of not surviving past time t" height="486" src="image/B18945_14_006.jpg" width="580"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.6 – Curve of the probability of not surviving past time t</p>
<p>In contrast, the<a id="_idIndexMarker1028"/> survival function is related to the probability of surviving past a certain <span class="No-Break">time </span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">t</span></span><span class="No-Break">:</span></p>
<p><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">T</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">&gt;</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">T</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">≤</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">e</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base"> </span></span><span class="No-Break"><span class="_-----MathTools-_Math_Operator">−</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">λ</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">t</span></span></p>
<p>By visualization, the survival function will have the form seen in <span class="No-Break"><em class="italic">Figure 14</em></span><span class="No-Break"><em class="italic">.7</em></span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer236">
<img alt="Figure 14.7 – Curve of the survival function" height="496" src="image/B18945_14_007.jpg" width="650"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.7 – Curve of the survival function</p>
<p>The <strong class="bold">accumulated hazard function</strong> is <span class="_-----MathTools-_Math_Variable">H</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">λ</span><span class="_-----MathTools-_Math_Variable">t</span>. We can then we can rewrite the survival <a id="_idIndexMarker1029"/>function in terms of the hazard function <span class="No-Break">as follows:</span></p>
<p><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Variable">H</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span> </p>
<p>Given <span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span> and <span class="_-----MathTools-_Math_Variable">f</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span>, we can <a id="_idIndexMarker1030"/>use the idea of the log-likelihood equation approach and estimate the value for <span class="_-----MathTools-_Math_Variable">λ</span> via maximum <span class="No-Break">likelihood estimation.</span></p>
<h2 id="_idParaDest-215"><a id="_idTextAnchor224"/>Model example</h2>
<p>We <a id="_idIndexMarker1031"/>will use the same <strong class="source-inline">larynx</strong> dataset from <strong class="source-inline">lifeline</strong> as in the last section. In this example, we will use <strong class="source-inline">ExponentialFitter</strong> from <strong class="source-inline">lifelines</strong>. Similarly, the <strong class="source-inline">fit()</strong> method takes two arguments: <strong class="source-inline">duration</strong> and <strong class="source-inline">event_observed</strong>. We can fit the model <span class="No-Break">as follows:</span></p>
<pre class="source-code">
from lifelines import ExponentialFitter
from lifelines import datasets
data = datasets.load_larynx()
exf = ExponentialFitter()
exf.fit(data.time, data.death)
# this print the first 5 elements of the survival function
exf.survival_function_.head()</pre>
<p>In the Kaplan-Meier model, the curve looks like stair steps, but using the exponential approach, the curve is gradually decreasing continuously, as we can <span class="No-Break">see here:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer237">
<img alt="Figure 14.8 – Larynx survival function using exponential distribution" height="248" src="image/B18945_14_008.jpg" width="372"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.8 – Larynx survival function using exponential distribution</p>
<p>At time step 8, the<a id="_idIndexMarker1032"/> function remains constant until the end of the study in the Kaplan-Meier model, but in the exponential model, the curve continues to decrease until the end of the study. We also perform similar studies between the younger group (less than 65 years old) and the older group (from 65 years old) (see <span class="No-Break"><em class="italic">Figure 14</em></span><span class="No-Break"><em class="italic">.9</em></span><span class="No-Break">):</span></p>
<div>
<div class="IMG---Figure" id="_idContainer238">
<img alt="Figure 14.9 – Larynx survival functions for older and younger groups" height="248" src="image/B18945_14_009.jpg" width="372"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.9 – Larynx survival functions for older and younger groups</p>
<p>We also do this on survival analysis with the various stages in the Larynx case (see <span class="No-Break"><em class="italic">Figure 14</em></span><span class="No-Break"><em class="italic">.10</em></span><span class="No-Break">):</span></p>
<div>
<div class="IMG---Figure" id="_idContainer239">
<img alt="Figure 14.10 – Larynx survival functions based on stage" height="248" src="image/B18945_14_010.jpg" width="372"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.10 – Larynx survival functions based on stage</p>
<p>Both the<a id="_idIndexMarker1033"/> exponential and Kaplan-Meier models give us similar information. There are advantages and disadvantages between the two models. In the Kaplan-Meier model, results interpretation is simpler; we can estimate the survival function value for both models, but one <a id="_idIndexMarker1034"/>advantage of the exponential model is to be able <a id="_idIndexMarker1035"/>to <strong class="bold">estimate the hazard ratio</strong>. Two disadvantages of <a id="_idIndexMarker1036"/>exponential models are that results are not always realistic and that we must assume a constant hazard ratio, which is not always practical. In the next section, we will discuss another survival model, the Cox Proportional Hazards regression model, which <span class="No-Break">is semi-parametric.</span></p>
<h1 id="_idParaDest-216"><a id="_idTextAnchor225"/>Cox Proportional Hazards regression model</h1>
<p>Survival analysis, also<a id="_idIndexMarker1037"/> called TTE analysis, as we discussed in <span class="No-Break"><em class="italic">Chapter 13</em></span><em class="italic">, Time-to-Event Variables</em>, is an analytical approach that uses probability to estimate the time remaining before an event occurs based on previous observations. We have seen how this can be helpful when including appropriate covariates in applications such as estimating life expectancy, mechanical failure, and customer churn, which can help with prioritizing needs and to more efficiently allocate resources. As we discussed in depth in <a href="B18945_13.xhtml#_idTextAnchor206"><span class="No-Break"><em class="italic">Chapter 13</em></span></a>, censoring is an aspect making survival analysis unique from other statistical questions that can be solved using techniques such as regression. Consequently—and because dropping an observation due to censoring will almost certainly mislead our model and provide results we cannot trust—we insert what is known<a id="_idIndexMarker1038"/> as an <strong class="bold">event status indicator</strong> to help account for whether an event will occur or fail to occur prior to estimating the time before an event’s occurrence. Recall that the event status indicator, <span class="_-----MathTools-_Math_Variable">δ</span>, for object <span class="_-----MathTools-_Math_Variable">i</span> is described <span class="No-Break">as follows:</span></p>
<p><span class="_-----MathTools-_Math_Variable">δ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">{</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Text"> </span><span class="_-----MathTools-_Math_Text">i</span><span class="_-----MathTools-_Math_Text">f</span><span class="_-----MathTools-_Math_Text"> </span><span class="_-----MathTools-_Math_Text">t</span><span class="_-----MathTools-_Math_Text">h</span><span class="_-----MathTools-_Math_Text">e</span><span class="_-----MathTools-_Math_Text"> </span><span class="_-----MathTools-_Math_Text">e</span><span class="_-----MathTools-_Math_Text">v</span><span class="_-----MathTools-_Math_Text">e</span><span class="_-----MathTools-_Math_Text">n</span><span class="_-----MathTools-_Math_Text">t</span><span class="_-----MathTools-_Math_Text"> </span><span class="_-----MathTools-_Math_Text">w</span><span class="_-----MathTools-_Math_Text">a</span><span class="_-----MathTools-_Math_Text">s</span><span class="_-----MathTools-_Math_Text"> </span><span class="_-----MathTools-_Math_Text">o</span><span class="_-----MathTools-_Math_Text">b</span><span class="_-----MathTools-_Math_Text">s</span><span class="_-----MathTools-_Math_Text">e</span><span class="_-----MathTools-_Math_Text">r</span><span class="_-----MathTools-_Math_Text">v</span><span class="_-----MathTools-_Math_Text">e</span><span class="_-----MathTools-_Math_Text">d</span><span class="_-----MathTools-_Math_Text">,</span><span class="_-----MathTools-_Math_Base">   </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Text">i</span><span class="_-----MathTools-_Math_Text">f</span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Text">c</span><span class="_-----MathTools-_Math_Text">e</span><span class="_-----MathTools-_Math_Text">n</span><span class="_-----MathTools-_Math_Text">s</span><span class="_-----MathTools-_Math_Text">o</span><span class="_-----MathTools-_Math_Text">r</span><span class="_-----MathTools-_Math_Text">i</span><span class="_-----MathTools-_Math_Text">n</span><span class="_-----MathTools-_Math_Text">g</span><span class="_-----MathTools-_Math_Text"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Text">w</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">a</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">s</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text"> </span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">o</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">b</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">s</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">e</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">r</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">v</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">e</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">d</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Text">.</span></span></p>
<p>We <a id="_idIndexMarker1039"/>noted that <span class="_-----MathTools-_Math_Variable">δ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span> when the true event <span class="_-----MathTools-_Math_Variable">T</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span> occurs <em class="italic">before</em> censoring time <span class="_-----MathTools-_Math_Variable">C</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span> and <span class="_-----MathTools-_Math_Variable">δ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span> when the true event <span class="_-----MathTools-_Math_Variable">T</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span> occurs<em class="italic"> after</em> censoring time <span class="_-----MathTools-_Math_Variable">C</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span>  and that thus, the outcome <span class="_-----MathTools-_Math_Variable">Y</span> for object <span class="_-----MathTools-_Math_Variable">i</span> <span class="No-Break">is this:</span></p>
<p><span class="_-----MathTools-_Math_Variable">Y</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">m</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">T</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Operator">,</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">C</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base"> </span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">i</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base">)</span></span></p>
<p>Censored survival data for object <span class="_-----MathTools-_Math_Variable">i</span>can be captured as <span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">Y</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Operator">,</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">δ</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Base">)</span><span class="_-----MathTools-_Math_Operator">.</span> In this chapter, we have discussed<a id="_idIndexMarker1040"/> the <strong class="bold">non-parametric</strong> <strong class="bold">Kaplan-Meier survival model</strong>, which uses a raw conditional probability of survival counts respective to the sample volume at each point in time without consideration of covariates. We then walked through the<a id="_idIndexMarker1041"/> parametric <strong class="bold">exponential survival model</strong>, which, unlike the Kaplan-Meier model assumes the data fits specific distributions and additionally includes a hazard ratio to compare groups. We will now discuss the<a id="_idIndexMarker1042"/> semi-parametric <strong class="bold">Cox Proportional Hazards survival model</strong>, also referred to as the <strong class="bold">Cox Proportional Hazards </strong><span class="No-Break"><strong class="bold">regression model</strong></span><span class="No-Break">.</span></p>
<p>The primary purpose and distinction of the Cox Proportional Hazards model is to use multiple covariates risk factors to model survival time. These covariates can be categorical or continuous. The Cox Proportional Hazards model is able to account for differences in survival between groups by leveraging <a id="_idIndexMarker1043"/>the <strong class="bold">hazard ratio</strong>. As we have discussed, the hazard ratio is the ratio of the event rate, at any point in time, for one group with respect to another group provided that survival up to that point in time has been maintained among the <span class="No-Break">two groups.</span></p>
<p>The hazard ratio can be calculated <span class="No-Break">as follows:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer240">
<img alt="" height="100" role="presentation" src="image/B18945_14_1_formula.jpg" width="820"/>
</div>
</div>
<p>The issue with the hazard ratio is that when we fail to obtain a balance of values across covariates shared among the groups, we lose control of confounding variables. When we cannot control for confounding variables, we cannot reliably obtain inference. To account for any imbalance that may exist among covariate values in survival analysis, we can use the <strong class="bold">Cox Proportional Hazards model</strong> to introduce coefficients that help explain different levels of exogenous influence. The model follows <span class="No-Break">this form:</span></p>
<p><span class="_-----MathTools-_Math_Variable">h</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">h</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">β</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Variable">X</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Operator">+</span><span class="_-----MathTools-_Math_Variable">β</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Variable">X</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">2</span><span class="_-----MathTools-_Math_Operator">+</span><span class="_-----MathTools-_Math_Operator">…</span><span class="_-----MathTools-_Math_Operator">+</span><span class="_-----MathTools-_Math_Variable">β</span><span class="_-----MathTools-_Math_Base"> </span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">n</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">X</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base"> </span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">n</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base">)</span></span></p>
<p>Here, <span class="_-----MathTools-_Math_Variable">h</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span> is the<a id="_idIndexMarker1044"/> expected hazard value at the base time, <em class="italic">t</em>, <span class="_-----MathTools-_Math_Variable">h</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">0</span><span class="_-----MathTools-_Math_Base">(</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">)</span> is the baseline hazard value at <em class="italic">t</em> when all covariates in the variable matrix <em class="italic">X</em> are equal to zero, and <em class="italic">n</em> is the count of variables included in the model. The coefficients <span class="_-----MathTools-_Math_Variable">β</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span> provide quantification into the impact (effect) of each columnar variable in <em class="italic">X</em>. Therefore, we are able to predict survival using the specific values of the input variables multiplied against their corresponding <span class="No-Break">estimated coefficients.</span></p>
<p>Cox Proportional Hazards <a id="_idIndexMarker1045"/>has three <span class="No-Break">pertinent assumptions:</span></p>
<ul>
<li>It is assumed the hazard ratio <em class="italic">remains constant</em> through follow-up. If the nature of input for one group is subject to change, this may negatively influence the results of the model; for example, we compare the performance of two machines, but one is likely to improve when the weather is warmer and the other is not, so our model may not be able to properly model <span class="No-Break">mechanical survival.</span></li>
<li>Complete <em class="italic">survival independence</em>. This means the survival of one study participant or object has no dependence on the other. Consider two separate machines. If one’s vibrations are likely to result in an early failure that would not otherwise occur, and that vibration is additionally felt by the other machine, also at that other machine’s detriment, there may not be survival independence between the two machines. However, if the vibration of the first machine is not felt by the other, there is likely to be survival independence if all other confounders are <span class="No-Break">controlled for.</span></li>
<li>The model <a id="_idIndexMarker1046"/>assumes <em class="italic">any censoring that takes place is non-informative</em>. As such, any censoring that takes place does not introduce confounding into the model. Losing a study subject due to censoring prior to follow-up must not be correlated to changes in survival risk. For example, when testing the mechanical survival of two types of machines in a specific area of a facility, if one machine is relocated to another area of the facility to minimize its own self-destructive vibrations, this is informative censoring. However, if the machine was moved to a different area simply to make space and the move does not impact the machine’s survival risk or outcome, the censoring is non-informative. Therefore, it does not introduce model confounding. The Cox Proportional Hazards model is for <span class="No-Break"><strong class="bold">right-censored</strong></span><span class="No-Break"> data.</span></li>
</ul>
<p>The steps to be taken when performing Cox Proportional Hazards regression modeling are outlined next. The sequence is important as the test should only be performed when practical. These steps follow<a id="_idIndexMarker1047"/> the outline provided by the <strong class="bold">National Institutes of Health</strong> (<span class="No-Break"><strong class="bold">NIH</strong></span><span class="No-Break">) (</span><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7876211/"><span class="No-Break">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7876211/</span></a><span class="No-Break">).</span></p>
<h2 id="_idParaDest-217"><a id="_idTextAnchor226"/>Step 1</h2>
<p>Set up the <a id="_idIndexMarker1048"/>null hypothesis to be tested (hypotheses in the multivariate case, which we will look at). We will use the <em class="italic">Stanford heart transplant</em> dataset, which lists the survival of the patients waiting for transplants in the Stanford heart transplant program. We will use <strong class="source-inline">age</strong> and <strong class="source-inline">year</strong> with respect to the start date of the program, <strong class="source-inline">transplant</strong> status, and the existence of previous bypass <strong class="source-inline">surgery</strong> as predictors for survival, which ends in either death or transplant. Survival duration is the <strong class="source-inline">stop</strong> variable, which is the exit time of the study. <strong class="source-inline">event</strong> is the variable confirming right-censoring and corresponds to either death or transplant. The null hypothesis for each variable is that there is no statistically significant difference in survival between the groups. For example, age has no impact on survival, while awaiting transplant would be the null hypothesis. The code is shown in the <span class="No-Break">following snippet:</span></p>
<pre class="source-code">
import statsmodels.api as sm
data = sm.datasets.get_rdataset('heart', package='survival').data
train_data = data.iloc[0:171]
test_data = data.iloc[171:]
exog=train_data[['age','year', 'transplant','surgery']]#df_test[['age','year','surgery','transplant']]
endog=train_data['stop']
data.head(2)</pre>
<p>Two <a id="_idIndexMarker1049"/>additional aspects of our data to be aware of are (1) that age has negative values; the starting <strong class="source-inline">age</strong> value is 48 years old, so an age of -1 corresponds to a 47-year-old patient and (2) <strong class="source-inline">year</strong> starts November 1, 1967. <strong class="source-inline">id</strong> is unique to each patient’s identification. We will not model this variable but can use it for reference. In <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.11</em> we can see, for reference, the first two rows of the data, including all variables we will use to <span class="No-Break">model survival:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002-6">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">start</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">stop</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Event</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Age</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">year</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">surgery</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">transplant</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">id</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">50</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">17.1554</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.123203</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>6</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">3.835729</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.25462</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.11 – First two rows of the Stanford Heart Transplant data set</p>
<h2 id="_idParaDest-218"><a id="_idTextAnchor227"/>Step 2</h2>
<p>We estimate the survival function using a <strong class="bold">Kaplan-Meier estimate</strong>, which accounts for right-censoring in the data. In our example, right-censoring occurs when the event variable is equal to one. We can see 171 enter at point 0. On the first day (<strong class="source-inline">stop=1</strong>), corresponding to index column <strong class="source-inline">event_at</strong> equal to 1, we have right-censoring for three patients. We observed the event take place for one patient (<strong class="source-inline">observed=1</strong>) and the other two patients were censored. Here, we show the corresponding data. The patient with <strong class="source-inline">id=45</strong> stops but restarts the same day, then survives until day 45. We see the same for patient <strong class="source-inline">id=3</strong>, who survives until day 16 when they receive a transplant. The patient with <strong class="source-inline">id=15</strong> does not re-enter for follow-up; we assume since they did not receive a transplant, they did <span class="No-Break">not survive.</span></p>
<p>In the following code sample, the <strong class="source-inline">durations</strong> variable corresponds to survival time and <strong class="source-inline">event_observed</strong> corresponds to the event (transplant or death) that results <span class="No-Break">in right-censoring:</span></p>
<pre class="source-code">
from lifelines import KaplanMeierFitter
import matplotlib.pyplot as plt
KaplanMeierFitter = KaplanMeierFitter()
KaplanMeierFitter.fit(durations=train_data['stop'], event_observed=train_data['event'])
KaplanMeierFitter.event_table.reset_index()</pre>
<p>Note<a id="_idIndexMarker1050"/> from the Kaplan-Meier results that <strong class="source-inline">event=1</strong> with <strong class="source-inline">stop=1</strong> results in <strong class="source-inline">observed=1</strong>, whereas <strong class="source-inline">event=0</strong> with <strong class="source-inline">stop=1</strong> results in <strong class="source-inline">censored=1</strong> and <strong class="source-inline">stop=1</strong> results in <strong class="source-inline">removed=1</strong>. All three conditions result in those corresponding samples being removed from the calculation for that day’s calculation, but unlike the patient who experienced the event, those who were censored are considered to survive at least as long as the study continues. We can see this by considering the Kaplan-Meier survival estimation probability function, <span class="No-Break"><span class="_-----MathTools-_Math_Variable">S</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base"> </span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">t</span></span><span class="No-Break">:</span></p>
<p><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">r</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">w</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">h</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">E</span><span class="_-----MathTools-_Math_Variable">v</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Number">1</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">m</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">     </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base">________________________________</span><span class="_-----MathTools-_Math_Base">_____</span><span class="_-----MathTools-_Math_Base">   </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">r</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable"> </span></p>
<p>Here, survival probability at any time, <em class="italic">t</em>, is denoted as <span class="No-Break"><span class="_-----MathTools-_Math_Variable">S</span></span><span class="No-Break"><span class="_-----MathTools-_Math_Base"> </span></span><span class="No-Break"><span class="_-----MathTools-_Math_Variable">t</span></span><span class="No-Break">.</span></p>
<p>In looking at our event table from the <strong class="source-inline">KaplanMeierFitter</strong> function, we have <span class="No-Break">the following:</span></p>
<p><span class="_-----MathTools-_Math_Variable">S</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">=</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">r</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Variable">k</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Operator">−</span><span class="_-----MathTools-_Math_Base"> </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">o</span><span class="_-----MathTools-_Math_Variable">b</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">r</span><span class="_-----MathTools-_Math_Variable">v</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">d</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">m</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">   </span><span class="_-----MathTools-_Math_Variable"> </span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base">_______________________________</span><span class="_-----MathTools-_Math_Base">_</span><span class="_-----MathTools-_Math_Base">   </span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">P</span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">e</span><span class="_-----MathTools-_Math_Variable">n</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">a</span><span class="_-----MathTools-_Math_Variable">t</span><span class="_-----MathTools-_Math_Space"> </span><span class="_-----MathTools-_Math_Variable">r</span><span class="_-----MathTools-_Math_Variable">i</span><span class="_-----MathTools-_Math_Variable">s</span><span class="_-----MathTools-_Math_Variable">k</span><span class="_-----MathTools-_Math_Variable"> </span></p>
<p>We can understand that a <strong class="source-inline">removed</strong> patient has limited impact on survival estimations unless they were also noted as <strong class="source-inline">observed=1</strong>, which we can ascribe <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">event=1</strong></span><span class="No-Break">.</span></p>
<p>Let’s consider patients 3, 15, and 45 to understand this relationship better. We can see based on counts in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.12</em> and <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.13</em> that these patients were removed from the denominator on day 1 (<strong class="source-inline">event_at=1</strong>). However, by looking at <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.14</em>, we can see patients 15 and 45 have later stops corresponding to events that get factored into the survival function. Let’s look at <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.12</em> first so we can see the three removed patients on <span class="No-Break">day 1:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table003-4">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">event_at</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">removed</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">observed</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">censored</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">entrance</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">at_risk</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">171</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">171</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">171</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p>6</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">168</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p>6</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">162</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>4</p>
</td>
<td class="No-Table-Style">
<p>4</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">156</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>…</p>
</td>
<td class="No-Table-Style">
<p>…</p>
</td>
<td class="No-Table-Style">
<p>…</p>
</td>
<td class="No-Table-Style">
<p>…</p>
</td>
<td class="No-Table-Style">
<p>…</p>
</td>
<td class="No-Table-Style">
<p>…</p>
</td>
<td class="No-Table-Style">
<p>…</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">107</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1401</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>5</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">108</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1408</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>4</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">109</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1572</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">110</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1587</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>2</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">111</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1800</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.12 – Summary of the events table for the Stanford Heart Transplant data set</p>
<p>Now, we can <a id="_idIndexMarker1051"/>see in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.13</em> all patients that had stops on <span class="No-Break">day 1.</span></p>
<pre class="source-code">
train_data.loc[train_data['stop']==1]</pre>
<p>The patients with stops on day 1 are patients with <strong class="source-inline">id</strong> 3, 15, <span class="No-Break">and 45:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table004-2">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">start</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Stop</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">event</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Age</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Year</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">surgery</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">transplant</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">id</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">6.297057</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.265572</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">5.815195</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.991102</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">15</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">11.8166</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">3.263518</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">45</span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.13 – Training data values for patients who exited the study on day 1</p>
<p>To get a better understanding of how this analysis works, we can look specifically at all records for the patients having <strong class="source-inline">id</strong> 3, 15, <span class="No-Break">and 45:</span></p>
<pre class="source-code">
 train_data.loc[train_data['id'].isin([3, 15,45])]</pre>
<p>These patients registered a stop on day 1, but patients 3 and 45 also registered stops on days 16 and <span class="No-Break">45, respectively:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table005-2">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">start</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">stop</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">event</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Age</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">year</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">surgery</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">transplant</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">id</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">6.297057</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.265572</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">16</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">6.297057</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.265572</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>3</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">5.815195</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.991102</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">15</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">11.8166</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">3.263518</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">45</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">45</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">11.8166</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">3.263518</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">45</span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.14 – Training data values for patients 3, 15, and 45</p>
<p>We can <a id="_idIndexMarker1052"/>also see patient 45 is the only patient with a <strong class="source-inline">stop</strong> value (corresponding to <strong class="source-inline">event_at</strong>) on day 45. Therefore, we know a transplant results in an observation and a removal. To identify the values at day 45, run the <span class="No-Break">following code:</span></p>
<pre class="source-code">
KaplanMeierFitter.event_table.loc[KaplanMeierFitter.event_table.index==45.0]</pre>
<p>The code outputs the table in <span class="No-Break"><em class="italic">Figure 14</em></span><span class="No-Break"><em class="italic">.15</em></span><span class="No-Break">:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table006-2">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">event_at</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">removed</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">observed</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">censored</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">entrance</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">at_risk</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">45</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">87</span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.15 – Events on day 45</p>
<p>Now we can look at the events table filtered to events with a stop at day 45 by running the <span class="No-Break">following code:</span></p>
<pre class="source-code">
train_data.loc[train_data['stop']==45]</pre>
<p>This gives us the tabular output seen in <span class="No-Break"><em class="italic">Figure 14</em></span><span class="No-Break"><em class="italic">.16</em></span><span class="No-Break">:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table007-1">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">start</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">stop</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">event</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">Age</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">year</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">surgery</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">transplant</strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">id</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">45</span></p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">11.8166</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">3.263518</span></p>
</td>
<td class="No-Table-Style">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">45</span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.16 – Events having a stop on day 45</p>
<p>We can repeat this step to see if there is a difference in survival until the end of the study for those who receive a transplant and those who do not by splitting the two groups out in the <span class="No-Break">following code:</span></p>
<pre class="source-code">
from lifelines import KaplanMeierFitter
import matplotlib.pyplot as plt
KaplanMeierFitter_n = KaplanMeierFitter()
KaplanMeierFitter_y = KaplanMeierFitter()
KaplanMeierFitter_n.fit(durations=data.loc[data['transplant']==0]['stop'], event_observed=data.loc[data['transplant']==0]['event'], label='no transplant')
KaplanMeierFitter_y.fit(durations=data.loc[data['transplant']==1]['stop'], event_observed=data.loc[data['transplant']==1]['event'], label='transplant');</pre>
<p>We<a id="_idIndexMarker1053"/> observe in the <strong class="bold">Kaplan-Meier survival function</strong> in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.17</em> a steady decrease in survival probability for both groups, but <a id="_idIndexMarker1054"/>a steeper decrease for the group that does not receive a transplant. We can also see the group, overall, with no transplant does not survive if the group that does receive the transplant. By the time the program closed, there were no non-transplants surviving. The shading corresponds to the 95% confidence interval bands for each <span class="No-Break">probability interval:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer241">
<img alt="Figure 14.17 – Kaplan-Meier survival estimation probability function" height="846" src="image/B18945_14_017.jpg" width="1178"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.17 – Kaplan-Meier survival estimation probability function</p>
<p>To generate the exact probability of survival on any day (corresponding to the <strong class="source-inline">stop</strong> time), we<a id="_idIndexMarker1055"/> can run the <span class="No-Break">following code:</span></p>
<pre class="source-code">
print('Non-Transplant Survival Probability at day 300: ', KaplanMeierFitter_n.predict(300))
print('Transplant Survival Probability at day 300: ', KaplanMeierFitter_y.predict(300))</pre>
<p>Here we can see the probabilities of survival at day 300 for the transplant and <span class="No-Break">non-transplant groups:</span></p>
<pre class="source-code">
Non-Transplant Survival Probability at day 300:  0.3545098269168237
Transplant Survival Probability at day 300:  0.4911598783770023</pre>
<h2 id="_idParaDest-219"><a id="_idTextAnchor228"/>Step 3</h2>
<p>Now, we will <a id="_idIndexMarker1056"/>use a <strong class="bold">log-rank test</strong> to determine if survivor curves are statistically different. At this step, we investigate if there is any statistical significance in survival between transplant and non-transplant groups. If there is no statistical significance, it would not be useful to understand the relationships between the covariates and their impacts on survival. We<a id="_idIndexMarker1057"/> looked at <strong class="bold">contingency table analysis</strong> using the <strong class="bold">Chi-Square test of independence</strong> earlier in the book. This is essentially the<a id="_idIndexMarker1058"/> log-rank test here, where we compare the survival distributions of the two groups (transplant versus non-transplant). We use this approach because the data is right-censored, and thus right-skewed; as such, we are working with non-parametric distributions. The null hypothesis is that the hazard ratio between the two groups is equal to 1, which would mean they are equal in terms of survival or <span class="No-Break">hazard risk.</span></p>
<p>In the following code sample, we use the two different patient distributions (those with and those without transplants) as groups A and B in the <span class="No-Break"><strong class="source-inline">logrank_test</strong></span><span class="No-Break"> function:</span></p>
<pre class="source-code">
from lifelines.statistics import logrank_test
lr_results = logrank_test(durations_A=data.loc[data['transplant']==0]['stop'],
                          durations_B=data.loc[data['transplant']==1]['stop'],
                          event_observed_A=data.loc[data['transplant']==0]['event'],
                          event_observed_B=data.loc[data['transplant']==1]['event'])</pre>
<p>We can<a id="_idIndexMarker1059"/> see the Chi-Square distribution <span class="No-Break">is used:</span></p>
<pre class="source-code">
print(lr_results.null_distribution)</pre>
<p>This shows the default distribution is the <span class="No-Break">chi-square distribution:</span></p>
<pre class="source-code">
chi squared</pre>
<p>We can run the following code to see the results of <span class="No-Break">the test:</span></p>
<pre class="source-code">
lr_results.summary</pre>
<p>We can also see a statistically significant difference at a 5% level of significance between the two groups. Therefore, we can assume there is a purpose in proceeding to use the Cox Proportional Hazards model to understand the relationships between the covariates we outlined earlier and the hazard risk <span class="No-Break">for survival:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table008">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold">test_statistic</strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">P</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">-</strong><span class="No-Break"><strong class="bold">log2(p)</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">4.02651</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.044791</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">4.480663</span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.18 – Log-rank test results</p>
<h2 id="_idParaDest-220"><a id="_idTextAnchor229"/>Step 4</h2>
<p>Here, we run the Cox Proportional Hazards test and analyze the p-values and confidence intervals for the terms included to identify whether they have statistical significance with respect to influence on survival rate. We look at the hazard ratio to determine any effects they <span class="No-Break">have provided:</span></p>
<pre class="source-code">
from lifelines import CoxPHFitter
CoxPHFitter = CoxPHFitter()
CoxPHFitter.fit(df=train_data[['age','year','surgery','transplant','stop','event']], duration_col='stop', event_col='event')
CoxPHFitter.print_summary()</pre>
<p>We can <a id="_idIndexMarker1060"/>see three of our four terms are significant at the 5% level of significance for predicting survival; our <strong class="source-inline">surgery</strong> variable does not appear to be based on the p-value. The 95% confidence interval for surgery does not contain 0, however, which suggests statistical significance. The difference is because the p-value is calculated based on the test statistic with respect to the critical value, which is estimated using the <em class="italic">log of the hazard ratio</em>, and the confidence interval is based on the <em class="italic">hazard ratio</em> itself. This discrepancy could mean the <strong class="source-inline">surgery</strong> variable is significant, but also that it may not be. Since we are not statistically certain, we should err on the side of caution and not consider it useful when predicting <span class="No-Break">future survival.</span></p>
<p>Note that <strong class="source-inline">exp(coef)</strong> corresponds to the hazard ratio and <strong class="source-inline">coef</strong> is the log of the hazard ratio. This follows the equation we provided earlier for the expected hazard value at the base <span class="No-Break">time, </span><span class="No-Break"><em class="italic">t</em></span><span class="No-Break">.</span></p>
<p>We can say, based on the hazard ratio <strong class="source-inline">(exp(coef))</strong> of 1.03, that a single unit increase in age over age 48 results in an increase of the hazard by a factor of 1.03, or 3%. With respect to our <strong class="source-inline">transplant</strong> variable, we can say with a 95% level of confidence that having the heart transplant decreased the hazard by a factor of 0.54, which is equivalent <span class="No-Break">to 46%.</span></p>
<p>Here in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.19</em>, we can see the results of the Cox Proportional Hazards <span class="No-Break">regression model:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table009">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="5">
<p><span class="No-Break"><strong class="bold">Model</strong></span></p>
</td>
<td class="No-Table-Style" colspan="7">
<p><span class="No-Break"><strong class="source-inline">lifelines.CoxPHFitter</strong></span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="5">
<p><span class="No-Break">Duration column</span></p>
</td>
<td class="No-Table-Style" colspan="7">
<p><span class="No-Break"><strong class="source-inline">stop</strong></span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="5">
<p><span class="No-Break">Event column</span></p>
</td>
<td class="No-Table-Style" colspan="7">
<p><span class="No-Break"><strong class="source-inline">event</strong></span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="5">
<p><span class="No-Break">Baseline estimation</span></p>
</td>
<td class="No-Table-Style" colspan="7">
<p><span class="No-Break"><strong class="source-inline">breslow</strong></span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="5">
<p>Number <span class="No-Break">of observations</span></p>
</td>
<td class="No-Table-Style" colspan="7">
<p><span class="No-Break">171</span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="5">
<p>Number of <span class="No-Break">events observed</span></p>
</td>
<td class="No-Table-Style" colspan="7">
<p><span class="No-Break">74</span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="5">
<p>Partial <span class="No-Break">log likelihood</span></p>
</td>
<td class="No-Table-Style" colspan="7">
<p>-<span class="No-Break">298.47</span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="5">
<p>Time fit <span class="No-Break">was run</span></p>
</td>
<td class="No-Table-Style" colspan="7">
<p>2023-03-18 <span class="No-Break">16:23:26 UTC</span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="No-Break">coef</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">exp (coef)</span></p>
</td>
<td class="No-Table-Style" colspan="3">
<p><span class="No-Break">se (coef)</span></p>
</td>
<td class="No-Table-Style">
<p>coef lower <span class="No-Break">95%</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p>coef upper <span class="No-Break">95%</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">exp</span> (coef) lower <span class="No-Break">95%</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">exp</span> (coef) upper <span class="No-Break">95%</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p>cmp <span class="No-Break">to</span></p>
</td>
<td class="No-Table-Style">
<p>z</p>
</td>
<td class="No-Table-Style">
<p>p</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">log2 (p)</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">Age</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.03</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1.03</span></p>
</td>
<td class="No-Table-Style" colspan="3">
<p><span class="No-Break">0.01</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.01</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break">0.06</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1.01</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1.06</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p>0</p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">2.35</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.02</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">5.74</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">Year</span></p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">0.16</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.85</span></p>
</td>
<td class="No-Table-Style" colspan="3">
<p><span class="No-Break">0.07</span></p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">0.3</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p>-<span class="No-Break">0.02</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.74</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.98</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">2.25</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.02</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">5.35</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">Surgery</span></p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">0.64</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.53</span></p>
</td>
<td class="No-Table-Style" colspan="3">
<p><span class="No-Break">0.37</span></p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">1.36</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break">0.08</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.26</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">1.08</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">1.74</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.08</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">3.62</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">Transplant</span></p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">0.62</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.54</span></p>
</td>
<td class="No-Table-Style" colspan="3">
<p><span class="No-Break">0.27</span></p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">1.15</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p>-<span class="No-Break">0.08</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.32</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.92</span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p>0</p>
</td>
<td class="No-Table-Style">
<p>-<span class="No-Break">2.26</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">0.02</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break">5.41</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="4">
<p><span class="No-Break">Concordance</span></p>
</td>
<td class="No-Table-Style" colspan="4">
<p><span class="No-Break">0.67</span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="4">
<p><span class="No-Break">Partial AIC</span></p>
</td>
<td class="No-Table-Style" colspan="4">
<p><span class="No-Break">604.95</span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="4">
<p>Log-likelihood <span class="No-Break">ratio test</span></p>
</td>
<td class="No-Table-Style" colspan="4">
<p>21.22 on <span class="No-Break">4 df</span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="4">
<p>-log2(p) of <span class="No-Break">ll-ratio test</span></p>
</td>
<td class="No-Table-Style" colspan="4">
<p><span class="No-Break">11.77</span></p>
</td>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
<td class="No-Table-Style"/>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.19 – Cox Proportional Hazard model output</p>
<p>In <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.20</em>, we <a id="_idIndexMarker1061"/>can see <strong class="source-inline">age</strong>, which applies only a 3% increase in hazard, does not explain much of the variance in the results. The age range spans roughly 9 years through 64 years of age. Without other covariates, we cannot say exactly why this might be, but including more covariates could prove helpful in understanding this variable more. Of the significant variables, <strong class="source-inline">transplant</strong> has notably the largest impact on <span class="No-Break">survival outcomes:</span></p>
<pre class="source-code">
plt.title('Coefficients within Confidence Intervals')
CoxPHFitter.plot()</pre>
<div>
<div class="IMG---Figure" id="_idContainer242">
<img alt="Figure 14.20 – Confidence intervals for hazard-ratio terms" height="846" src="image/B18945_14_020.jpg" width="1244"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.20 – Confidence intervals for hazard-ratio terms</p>
<p>We can<a id="_idIndexMarker1062"/> see the assumption of a constant hazard ratio between all patients in the survival function plot in <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.21</em>. This is why it is important to prevent informative censoring. Let us assume this assumption <span class="No-Break">is met.</span></p>
<p>Note that when predicting, we do not have start and stop times. Therefore, we can input only the quantifiable covariates for a given patient, <span class="No-Break">as follows:</span></p>
<pre class="source-code">
CoxPHFitter.predict_survival_function(train_data[['age','year','surgery','transplant']]).plot()
plt.xlabel('Survival Time')
plt.ylabel('Survival Probability')
plt.title('Survival Function for All Patients')
plt.legend().set_visible(False)</pre>
<div>
<div class="IMG---Figure" id="_idContainer243">
<img alt="Figure 14.21 – Survival function for all patients" height="846" src="image/B18945_14_021.jpg" width="1178"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.21 – Survival function for all patients</p>
<h2 id="_idParaDest-221"><a id="_idTextAnchor230"/>Step 5</h2>
<p>In <span class="No-Break"><em class="italic">Figure 14</em></span><em class="italic">.22</em>, we can use <a id="_idIndexMarker1063"/>the Cox Proportional Hazards model to predict the survival function for our held-out <span class="No-Break">test patient:</span></p>
<pre class="source-code">
CoxPHFitter.predict_survival_function(test_data[['age','year','surgery','transplant']]).plot()
plt.xlabel('Survival Time')
plt.ylabel('Survival Probability')
plt.title('Survival Function for Holdout')</pre>
<div>
<div class="IMG---Figure" id="_idContainer244">
<img alt="Figure 14.22 – Survival function for test patient, id=171" height="846" src="image/B18945_14_022.jpg" width="1178"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.22 – Survival function for test patient, id=171</p>
<p>To generate<a id="_idIndexMarker1064"/> the probability for this patient’s survival, using their covariates, at each potential stop point, we can run the <span class="No-Break">following code:</span></p>
<pre class="source-code">
CoxPHFitter.predict_survival_function(test_data[['age','year','surgery','transplant','stop','event']])</pre>
<h1 id="_idParaDest-222"><a id="_idTextAnchor231"/>Summary</h1>
<p>In this chapter, we discussed three survival analysis models in depth; the Kaplan-Meier, the exponential, and the Cox Proportional Hazards regression models. Using these frameworks, we modeled survival functions and estimated survival probabilities and hazard ratios for various TTE, right-censored studies. For the multivariate case, we used Cox Proportional Hazards regression to model hazard ratios for covariate analysis on dependent variables. For all models, we demonstrated using the confidence intervals for assessing significance, as well as the corresponding p-values. At this point, the reader should be able to confidently identify the scenarios in which each model would outperform the others and appropriately fit and implement that model to obtain the necessary results for <span class="No-Break">strategic success.</span></p>
</div>
</div></body></html>
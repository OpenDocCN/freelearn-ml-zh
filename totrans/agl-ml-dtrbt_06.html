<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer076">
			<h1 id="_idParaDest-86"><em class="italic"><a id="_idTextAnchor087"/>Chapter 4</em>: Preparing Data for DataRobot</h1>
			<p>This chapter covers tasks relating to preparing data for modeling. While the tasks themselves are relatively straightforward, they can take up a lot of time and can sometimes cause frustration. Just know that if you feel this way, you are not alone. This is pretty normal. This is also where you will begin to notice that things are a bit different from your experience in an academic setting. Data will almost never arrive in a form that's suitable for modeling, and it is a mistake to assume that the data you have received is in good condition and of good quality.</p>
			<p>Most real-world problems do not come with a ready-made dataset that you can start processing and use to build models. Most likely you will need to stitch data together from multiple disparate sources. Depending on the data, <strong class="bold">DataRobot</strong> might perform data preparation and cleansing tasks automatically, or you might have to do some of these on your own. This chapter covers concepts and examples to show how to cleanse and prepare your data and the features that DataRobot provides to help with these tasks.</p>
			<p>By the end of this chapter, you will know how to set up data to hand it off to DataRobot and begin modeling. In the chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>Connecting to data sources</li>
				<li>Aggregating data for modeling</li>
				<li>Cleansing the dataset</li>
				<li>Working with different types of data</li>
				<li>Engineering features for modeling</li>
			</ul>
			<h1 id="_idParaDest-87"><a id="_idTextAnchor088"/>Technical requirements</h1>
			<p>Some parts of this chapter require access to the DataRobot software, and some tools for data manipulation. Most of the examples deal with small datasets and therefore can be handled via Excel. The datasets that we will be using in the rest of this book are described in the following sections.</p>
			<h2 id="_idParaDest-88"><a id="_idTextAnchor089"/>Automobile Dataset</h2>
			<p>The<a id="_idIndexMarker216"/> Automobile Dataset (source: Dua, D. and Graff, C. (2019). UCI Machine Learning Repository [<a href="http://archive.ics.uci.edu/ml">http://archive.ics.uci.edu/ml</a>]. Irvine, CA: University of California, School of Information and Computer Science) can be accessed at the UCI Machine Learning Repository (<a href="https://archive.ics.uci.edu/ml/datasets/Automobile">https://archive.ics.uci.edu/ml/datasets/Automobile</a>). Each row in this dataset represents a specific automobile. The features (columns) describe its characteristics, risk rating, and associated normalized losses. Even though it is a small dataset, it has many features that are numerical as well as categorical. Features are described on the web page, and the data is provided in <strong class="source-inline">.csv</strong> format.</p>
			<h2 id="_idParaDest-89"><a id="_idTextAnchor090"/>Appliances Energy Prediction Dataset</h2>
			<p>This<a id="_idIndexMarker217"/> dataset (source: Luis M. Candanedo, Veronique Feldheim, Dominique Deramaix, <em class="italic">Data driven prediction models of energy use of appliances in a low-energy house</em>, Energy and Buildings, Volume 140, 1 April 2017, Pages 81-97, ISSN 0378-7788) can be accessed at the UCI Machine Learning Repository (<a href="https://archive.ics.uci.edu/ml/datasets/Appliances+energy+prediction#">https://archive.ics.uci.edu/ml/datasets/Appliances+energy+prediction#</a>). This dataset captures temperature and humidity data in various rooms in a house and in the outside environment, along with energy consumption by various devices over time. The data is captured every 10 minutes. This is a typical example of a time series dataset. Data is provided in <strong class="source-inline">.csv</strong> format, and the site also provides descriptions of the various features. All features in this dataset are numeric features. The dataset also includes two random variables to make the problem interesting.</p>
			<p class="callout-heading">SQL</p>
			<p class="callout">For some parts of this chapter, it will be helpful to know SQL, although you do not need to know SQL to go through the example problems.</p>
			<h1 id="_idParaDest-90"><a id="_idTextAnchor091"/>Connecting to data sources</h1>
			<p>By this point, you should have a list of data sources and an idea of what data is stored there. Depending on <a id="_idIndexMarker218"/>your use case, these sources could be real-time data streaming sources you need to tap into. Here are some typical sources of data:</p>
			<ul>
				<li>Filesystems</li>
				<li>Excel files</li>
				<li>SQL databases</li>
				<li>Amazon S3 buckets</li>
				<li><strong class="bold">Hadoop Distributed File System</strong> (<strong class="bold">HDFS</strong>)</li>
				<li>NoSQL databases</li>
				<li>Data warehouses</li>
				<li>Data lakes</li>
				<li>Graph databases</li>
				<li>Data streams</li>
			</ul>
			<p>Depending on the type of data source, you will use different mechanisms to access this data. These could be on-premises or in the cloud. Depending on the condition of the data, you can bring it directly into DataRobot, or you might have to do some preparation before you bring it into DataRobot. DataRobot has recently added capabilities in the form of <strong class="bold">Paxata</strong> to help with this process, but you might not have access to that add-on. Most of the processing work is done via <strong class="bold">SQL</strong>, <strong class="bold">Python</strong>,<strong class="bold"> pandas</strong>, and <strong class="bold">Excel</strong>. For the purpose of this book, we will only focus on Excel.</p>
			<p>If you are not already familiar with SQL and pandas, then it will be helpful for you to start learning about them as soon as you get an opportunity:</p>
			<ol>
				<li>You can connect to a data source by going to the <strong class="bold">Create New Project</strong> menu, as shown in the following figure:<div id="_idContainer064" class="IMG---Figure"><img src="Images/Figure_4.1_B17159.jpg" alt="Figure 4.1 – Connecting to a data source&#13;&#10;" width="1121" height="459"/></div><p class="figure-caption">Figure 4.1 – Connecting to a data source</p></li>
				<li>You can search for an existing data source that has been defined, or you can add a new data <a id="_idIndexMarker219"/>connection. If you select the <strong class="bold">add new data connection</strong> option (shown in the preceding figure), you will see the following connection choices:<div id="_idContainer065" class="IMG---Figure"><img src="Images/Figure_4.2_B17159.jpg" alt="Figure 4.2 – Types of data connection&#13;&#10;" width="731" height="643"/></div><p class="figure-caption">Figure 4.2 – Types of data connection</p></li>
				<li>You will see the connection choices available for your organization. What you see here <a id="_idIndexMarker220"/>could be different from the preceding figure. Most databases with JDBC drivers are supported, but you might have to check with your administrator. As an example, let's select the <strong class="bold">MySQL</strong> option, as shown in the following figure:</li>
			</ol>
			<div>
				<div id="_idContainer066" class="IMG---Figure">
					<img src="Images/Figure_4.3_B17159.jpg" alt="Figure 4.3 – Configuring a data connection&#13;&#10;" width="681" height="653"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.3 – Configuring a data connection</p>
			<p>In the preceding figure, you will see the configuration parameters for configuring a MySQL data source. Other <a id="_idIndexMarker221"/>data sources are similar in nature. Here, you will enter the configuration settings that can be obtained from your database administrator. You will need to create a similar connection if you are connecting to a database to get data into Python or Excel.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You will need to have some working knowledge of SQL or work with someone who knows SQL to make use of these options.</p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor092"/>Aggregating data for modeling</h1>
			<p>From the previous chapters, you might remember that machine learning algorithms expect the <a id="_idIndexMarker222"/>dataset to be in a specific form and it needs to be in one table. The data <a id="_idIndexMarker223"/>needed for this table, however, could reside in multiple sources. Hence, one of the first things you need to do is to aggregate data from multiple sources. This is often done using SQL or Python. Recently, DataRobot <a id="_idIndexMarker224"/>has added the capability to add multiple datasets into a project and then aggregate this data within DataRobot. Please note that there <a id="_idIndexMarker225"/>are still some data cleansing operations that you might have to do outside of DataRobot, so if you want to use the <a id="_idIndexMarker226"/>aggregation capabilities of DataRobot, you need to do cleansing operations prior to bringing this data into DataRobot. We cover data cleansing in the following section. If you choose to do data aggregation inside DataRobot, you have to make sure to do this at the very start of the project (<em class="italic">Figure 4.4</em>):</p>
			<div>
				<div id="_idContainer067" class="IMG---Figure">
					<img src="Images/Figure_4.4_B17159.jpg" alt="Figure 4.4 – Add secondary datasets&#13;&#10;" width="1178" height="751"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4 – Add secondary datasets</p>
			<p>In the preceding figure, just below the <strong class="bold">Start</strong> button, you can click on <strong class="bold">Add datasets</strong>. Once you click on it, you will see a window that lets you specify the additional dataset, as shown in <em class="italic">Figure 4.5</em>:</p>
			<div>
				<div id="_idContainer068" class="IMG---Figure">
					<img src="Images/Figure_4.5_B17159.jpg" alt="Figure 4.5 – Secondary datasets&#13;&#10;" width="1032" height="553"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.5 – Secondary datasets</p>
			<p>Here, you can add a new dataset and define the relationships between your main dataset and the <a id="_idIndexMarker227"/>secondary datasets. For time series problems, you can <a id="_idIndexMarker228"/>also use this capability to aggregate your data to the right timescale and join it with the main dataset.</p>
			<p>Please note that this does require some understanding of how relational tables work and some SQL concepts. If you are not familiar with these ideas and you are not sure what indexes to use, work with someone who understands databases to help you set this up.</p>
			<h1 id="_idParaDest-92"><a id="_idTextAnchor093"/>Cleansing the dataset</h1>
			<p>This step can come before or after the data aggregation we talked about in the previous section. We introduced <a id="_idIndexMarker229"/>some concepts around data cleansing in <a href="B17159_02_Final_NM_ePub.xhtml#_idTextAnchor039"><em class="italic">Chapter 2</em></a>, <em class="italic">Machine Learning Basics</em>, so let's look at how to actually do it on a dataset. For this, let's start with the Automobile Dataset. Please refer to the <em class="italic">Technical requirements</em> section to <a id="_idIndexMarker230"/>access the UCI repository for this dataset:</p>
			<ol>
				<li value="1">Let's download two files: <strong class="source-inline">imports-85.data</strong> and <strong class="source-inline">imports-85.names</strong>. The data file is in <strong class="source-inline">.csv</strong> format, so let's rename the file with the <strong class="source-inline">.csv </strong>extension and open it using Excel (you can use any text editor). You will now see the data (<em class="italic">Figure 4.6</em>):<div id="_idContainer069" class="IMG---Figure"><img src="Images/Figure_4.6_B17159.jpg" alt="Figure 4.6 – Automobile data&#13;&#10;" width="956" height="188"/></div><p class="figure-caption">Figure 4.6 – Automobile data</p></li>
				<li>You will notice in the preceding screenshot that it is missing the header information. To retrieve the header information, open the <strong class="source-inline">.names</strong> file in any text editor. You will see the names of attributes as well as their definitions. Create an empty row at the top of your <strong class="source-inline">.csv</strong> file and you will have to manually type the names of these attributes as the first row of your file. Now let's save this file as <strong class="source-inline">autodata.csv</strong>. It should now look as shown in <em class="italic">Figure 4.7</em>:</li>
			</ol>
			<div>
				<div id="_idContainer070" class="IMG---Figure">
					<img src="Images/Figure_4.7_B17159.jpg" alt="Figure 4.7 – Automobile data with headers&#13;&#10;" width="1006" height="163"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.7 – Automobile data with headers</p>
			<p>Please review all the cells in this data file. You will have already noticed that many cells in the preceding figure have a <strong class="bold">?</strong> instead of a value. While there are several features where the values are missing, for most of them it is negligible, except for <strong class="source-inline">normalized-losses</strong> where 20% of the total values are missing. Given that our dataset is very small, we do not <a id="_idIndexMarker231"/>want to drop the rows with missing data. Also, DataRobot has mechanisms to account for missing values, so we are going to leave most of them as is. The only one that we want to consider is <strong class="source-inline">normalized-losses</strong>. If <strong class="source-inline">normalized-losses</strong> is our target variable, then we have no choice but to drop those rows. If not, we can first try to go as is and let DataRobot build a model. We can then try an alternative strategy of using the average value of <strong class="source-inline">normalized-losses</strong> per <strong class="bold">Symboling</strong> value to see if that makes any difference. I will use Excel's pivot table functionality to compute these averages (<em class="italic">Figure 4.8</em>):</p>
			<div>
				<div id="_idContainer071" class="IMG---Figure">
					<img src="Images/Figure_4.8_B17159.jpg" alt="Figure 4.8 – Pivot table&#13;&#10;" width="290" height="161"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.8 – Pivot table</p>
			<p>The reason for using <strong class="bold">Symboling</strong> is that it is an indicator of risk. Depending on the problem and what <a id="_idIndexMarker232"/>you are trying to accomplish, you can choose some other feature for this purpose. For now, we will use <strong class="bold">Symboling</strong> to illustrate how to do it. There are more sophisticated imputation methods available, such as a K-Nearest Neighbor-based imputation method, that you can explore if desired (<a href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.KNNImputer.html">https://scikit-learn.org/stable/modules/generated/sklearn.impute.KNNImputer.html</a>).</p>
			<p>In reviewing the Appliances Energy Prediction Dataset, we see that the data looks very clean and no further cleansing is required. In real-world projects, you will almost never find a dataset that is free of problems. Typical problems in time series datasets to watch out for are as follows:</p>
			<ul>
				<li><strong class="bold">Very little data</strong>: You need at least 35 or so datapoints for regression and 100 datapoints for classification problems to allow DataRobot to do something useful with your data.</li>
				<li><strong class="bold">Data gaps</strong>: Sometimes data might be missing for certain timesteps. In these cases, you can use values <a id="_idIndexMarker233"/>from the timesteps before or after to assign values for the missing time step. You can also let DataRobot do this for you.</li>
				<li><strong class="bold">Interrelated series</strong>: Often you will have multiple timeseries that you are trying to forecast. If the series are similar and are interrelated, then you can combine them into a single model. This can often improve the forecast accuracy. In these cases, you have to create a feature that tells DataRobot that these series are part of the same cluster.</li>
			</ul>
			<p>We will revisit the data quality based on what DataRobot finds. Now that the dataset looks reasonably clean (which is very unusual by the way), let's investigate this data further.</p>
			<h1 id="_idParaDest-93"><a id="_idTextAnchor094"/>Working with different types of data</h1>
			<p>You will have noticed that some of the features have numeric values while others have categorical values. For example, the <strong class="bold">aspiration</strong> feature can have two values: <strong class="bold">std</strong> or <strong class="bold">turbo</strong>. Such categorical features require some preprocessing to convert them into numeric values. Luckily DataRobot takes care of that processing for us. You might want to check for misspellings, though, to make sure that the possible values match the expectations. For <a id="_idIndexMarker234"/>example, you might find <strong class="source-inline">standard</strong> as well as <strong class="source-inline">std</strong> in your datasets. In this case, DataRobot will treat them as different values, even though they are the same.</p>
			<p>There are some features that can be treated as categorical or as numerical. For example, <strong class="bold">Symboling</strong> can be treated as <a id="_idIndexMarker235"/>numerical or as categorical. In general, if the numerical value has meaning, it is better to treat it as numerical. Another example is <strong class="source-inline">num-of-cylinders</strong>; here, the values are expressed as text. Given that there is a numerical order here, it might be beneficial to turn this into a numeric variable, as shown in <em class="italic">Figure 4.9</em>:</p>
			<div>
				<div id="_idContainer072" class="IMG---Figure">
					<img src="Images/Figure_4.9_B17159.jpg" alt="Figure 4.9 – Categorical to numerical feature conversion&#13;&#10;" width="1163" height="228"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.9 – Categorical to numerical feature conversion</p>
			<p>Here, we have created (in <strong class="bold">Excel</strong>) a new feature, <strong class="source-inline">cylinder-count</strong>, that carries the numerical values for the number of cylinders. In this example, we are using Excel for the data manipulation, but <a id="_idIndexMarker236"/>this can be achieved via many methods, such as SQL, Python, and Paxata. You can do similar data manipulation and create a new column for <strong class="source-inline">num-of-doors</strong> as well.</p>
			<p>Let's take a look at the <strong class="source-inline">make</strong> feature in the following figure. This seems to have 22 possible values, but we have very limited data available. If we count the number of rows for each make, we can see how much data is available for each make:</p>
			<div>
				<div id="_idContainer073" class="IMG---Figure">
					<img src="Images/Figure_4.10_B17159.jpg" alt="Figure 4.10 – Data for each make&#13;&#10;" width="181" height="349"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.10 – Data for each make</p>
			<p>We notice that some car types have very little data available, so it might be useful to combine some of them. For example, we can combine (using Excel) the highlighted rows into a make called <strong class="source-inline">other</strong>. Where you draw the line depends upon your understanding of the business problem or discussions with domain experts. Even with that knowledge, you might have to try out a <a id="_idIndexMarker237"/>few different options to see what works best. This is what makes machine learning an iterative and exploratory process. Also keep in mind that you have limited time available, so don't over-explore either. There is certainly a point of diminishing returns where additional tinkering will not produce many benefits.</p>
			<p>DataRobot also allows special processing for images and geo-spatial data. We will cover them in <a href="B17159_11_Final_NM_ePub.xhtml#_idTextAnchor161"><em class="italic">Chapter 11</em></a>, <em class="italic">Working with GeoSpatial Data, NLP, and Image Processing</em>. Now let's look at other transformations that can be done on data.</p>
			<h1 id="_idParaDest-94"><a id="_idTextAnchor095"/>Engineering features for modeling</h1>
			<p>As part of the<a id="_idIndexMarker238"/> system's understanding you would have gained some<a id="_idIndexMarker239"/> insights into your problem and dataset that can be used to create new features in your dataset by combining the existing features in various ways. For example, we can create a new feature called <strong class="source-inline">volume</strong> by multiplying length, width, and height. Similarly, we can create a feature called <strong class="source-inline">mpg-ratio</strong> by dividing <strong class="source-inline">highway-mpg</strong> by <strong class="source-inline">city-mpg</strong>. Let's also create a feature called <strong class="source-inline">cylinder-size</strong> by dividing <strong class="source-inline">engine-size</strong> by <strong class="source-inline">cylinder-count</strong>. The equations for these features are as follows:</p>
			<ul>
				<li><strong class="source-inline">volume = length * width * height</strong></li>
				<li><strong class="source-inline">mpg-ratio = highway-mpg / city-mpg</strong></li>
				<li><strong class="source-inline">cylinder-size = engine-size / cylinder-count</strong></li>
			</ul>
			<p><em class="italic">Figure 4.11</em> shows an example of what these feature values look like:</p>
			<div>
				<div id="_idContainer074" class="IMG---Figure">
					<img src="Images/Figure_4.11_B17159.jpg" alt="Figure 4.11 – Engineered features for the Automobile Dataset&#13;&#10;" width="1196" height="240"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.11 – Engineered features for the Automobile Dataset</p>
			<p>As you can now see, many possibilities exist to create new features that could prove helpful in solving your problem. Many of these new features may not be useful, and it is OK to drop them later. Sometimes, such features will have meaning for the customers or stakeholders, and you might want to keep them instead of some other features that are redundant.</p>
			<p>Let's take a look at the Appliances Energy Prediction Dataset file. With this dataset, we can create the following features:</p>
			<ul>
				<li><strong class="source-inline">total-energy = Appliances + lights</strong></li>
				<li><strong class="source-inline">avg-temp-inside = (T1 + T2 + T3 + T4 + T5 + T7 + T8 + T9 ) / 8</strong></li>
				<li><strong class="source-inline">avg-rh-inside = (RH_1 + RH_2 + RH_3 + RH_4 + RH_5 + RH_7 + RH_8 + RH_9 ) / 8</strong></li>
				<li><strong class="source-inline">temp-inout-diff = T6  –  avg-temp-inside</strong></li>
				<li><strong class="source-inline">rh-inout-diff = RH_6  –  avg-rh-inside</strong></li>
				<li><strong class="source-inline">windchill-factor</strong> (I am creating an approximate windchill factor based on <a href="https://www.weather.gov/media/epz/wxcalc/windChill.pdf">https://www.weather.gov/media/epz/wxcalc/windChill.pdf</a>) <strong class="source-inline">= T_out * (Windspeed0.16 )</strong></li>
			</ul>
			<p>The new <a id="_idIndexMarker240"/>data features will <a id="_idIndexMarker241"/>appear as shown in <em class="italic">Figure 4.12</em>:</p>
			<div>
				<div id="_idContainer075" class="IMG---Figure">
					<img src="Images/Figure_4.12_B17159.jpg" alt="Figure 4.12 – Engineered features for the Appliances Energy Prediction Dataset&#13;&#10;" width="1223" height="307"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.12 – Engineered features for the Appliances Energy Prediction Dataset</p>
			<p>As you can see, these features use our knowledge about the domain that we can find by talking to domain experts or doing some research on the internet. You might be able to find even more such features by doing some research about dew points, pressure, and visibility. It will be hard for the automation to catch all of these on its own, but on the other hand, the automation might be able to find some additional interesting features based on them. Recently, DataRobot has also been adding capabilities to automatically do some feature engineering, but these capabilities are somewhat limited. One area where these capabilities are very useful is time series problems. In this particular area, these capabilities are extremely helpful in trying out a wide range of features that will be hard to match on your own. Having said that, it is still your responsibility to inject your domain knowledge into the model via engineered features.</p>
			<h1 id="_idParaDest-95"><a id="_idTextAnchor096"/>Summary</h1>
			<p>In this chapter, we covered methods to help you prepare the dataset for building the models. Many of these methods have to be applied outside of DataRobot, although DataRobot is beginning to provide support for many of the data preparation tasks. As we discussed, many of these tasks cannot be automated at this point in time, and they require domain understanding to make appropriate decisions.</p>
			<p>Specifically, in this chapter we have learned how to connect to various data sources and how to aggregate data from these sources. We looked at examples to address missing data issues and other data manipulation that should be done prior to modeling. We also covered several methods for creating new features that can be very important for improving the model's performance.</p>
			<p>We are now at a stage where we will be working almost completely inside the DataRobot environment to analyze the data and build models. In the next chapter, we will use DataRobot to analyze the datasets.</p>
		</div>
	</div></body></html>
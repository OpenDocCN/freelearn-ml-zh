<html><head></head><body>
<div id="_idContainer393">
<h1 class="chapter-number" id="_idParaDest-107"><a id="_idTextAnchor119"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-108"><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.2.1">Productionizing Your Workload with MLOps</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.3.1">MLOps</span></strong><span class="koboSpan" id="kobo.4.1"> is a </span><a id="_idIndexMarker573"/><span class="koboSpan" id="kobo.5.1">concept that enables </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">machine learning</span></strong><span class="koboSpan" id="kobo.7.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.8.1">ML</span></strong><span class="koboSpan" id="kobo.9.1">) workloads to scale through the automation of model training, model evaluation, and model deployment. </span><span class="koboSpan" id="kobo.9.2">MLOps enables traceability with code, data, and models. </span><span class="koboSpan" id="kobo.9.3">MLOps allows data scientists and ML professionals to make predictions available to business users at scale with the </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">Azure Machine Learning</span></strong><span class="koboSpan" id="kobo.11.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.12.1">AML</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">) services.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1">MLOps is built on the concepts of </span><strong class="bold"><span class="koboSpan" id="kobo.15.1">CI/CD</span></strong><span class="koboSpan" id="kobo.16.1">. </span><span class="koboSpan" id="kobo.16.2">CI/CD is a term that stands for </span><strong class="bold"><span class="koboSpan" id="kobo.17.1">continuous integration/ continuous delivery</span></strong><span class="koboSpan" id="kobo.18.1"> and has</span><a id="_idIndexMarker574"/><span class="koboSpan" id="kobo.19.1"> been used for software development for decades. </span><span class="koboSpan" id="kobo.19.2">CI/CD enables companies to scale their applications and by leveraging those same concepts, we can scale our ML projects, which will rely on CI/CD practices for our </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">MLOps implementation.</span></span></p>
<p><span class="koboSpan" id="kobo.21.1">One of the challenges of this domain is its complexity. </span><span class="koboSpan" id="kobo.21.2">In this chapter, we will go through the scenario of retrieving data, transforming data, building a model, evaluating the model, deploying a model, then pending approval, registering it to a higher environment, and publishing the model as a managed online endpoint, routing traffic to the latest version of the model. </span><span class="koboSpan" id="kobo.21.3">This process will leverage Azure DevOps, AML SDK v2, and v2 of </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">the CLI.</span></span></p>
<p><span class="koboSpan" id="kobo.23.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.25.1">Understanding the </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">MLOps implementation</span></span></li>
<li><span class="koboSpan" id="kobo.27.1">Preparing your </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">MLOps environment</span></span></li>
<li><span class="koboSpan" id="kobo.29.1">Running an Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">DevOps pipeline</span></span></li>
</ul>
<h1 id="_idParaDest-109"><span class="koboSpan" id="kobo.31.1">Technical requirement</span><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.32.1">s</span></h1>
<p><span class="koboSpan" id="kobo.33.1">To proceed with this chapter, the following are </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">the requirements:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.35.1">Two </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">AML workspaces</span></span></li>
<li><span class="koboSpan" id="kobo.37.1">An Azure DevOps organization, or the ability to </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">create one</span></span></li>
<li><span class="koboSpan" id="kobo.39.1">An Azure DevOps project within an Azure DevOps organization, or the ability to </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">create one</span></span></li>
<li><span class="koboSpan" id="kobo.41.1">The ability to assign permissions in the AML-deployed </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">key vaults</span></span></li>
<li><span class="koboSpan" id="kobo.43.1">The ability to create Azure DevOps </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">variable groups</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Permission to link an Azure DevOps variable group to Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">key vault</span></span></li>
<li><span class="koboSpan" id="kobo.47.1">Two service principals, or permissions to create </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">service principals</span></span></li>
<li><span class="koboSpan" id="kobo.49.1">Two service connections, one for each environment, or permissions to create </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">service connections</span></span></li>
<li><span class="koboSpan" id="kobo.51.1">The ability to create an Azure DevOps pipeline within an Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">DevOps project</span></span></li>
<li><span class="koboSpan" id="kobo.53.1">The ability to create an environment within an Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">DevOps project</span></span></li>
</ul>
<h1 id="_idParaDest-110"><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.55.1">Understanding the MLOps implementation</span></h1>
<p><span class="koboSpan" id="kobo.56.1">As mentioned, MLOps is a concept, not</span><a id="_idIndexMarker575"/><span class="koboSpan" id="kobo.57.1"> an implementation. </span><span class="koboSpan" id="kobo.57.2">We will provide an implementation of MLOps as the foundation for this chapter. </span><span class="koboSpan" id="kobo.57.3">We will establish an Azure DevOps pipeline to orchestrate an AML pipeline for transforming data in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">dev</span></strong><span class="koboSpan" id="kobo.59.1"> environment, create a model leveraging MLflow, and evaluate whether the model is performing better or equal to the existing mo</span><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.60.1">del. </span><span class="koboSpan" id="kobo.60.2">Following this pipeline, if a new model is registered, we will deploy this new model in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">dev</span></strong><span class="koboSpan" id="kobo.62.1"> environment leveraging </span><strong class="bold"><span class="koboSpan" id="kobo.63.1">blue/green deployments</span></strong><span class="koboSpan" id="kobo.64.1">. </span><span class="koboSpan" id="kobo.64.2">Blue/green deployments enable high availability. </span><span class="koboSpan" id="kobo.64.3">As a new model is</span><a id="_idIndexMarker576"/><span class="koboSpan" id="kobo.65.1"> deployed, the existing endpoint deployment is available during the new model deployment. </span><span class="koboSpan" id="kobo.65.2">After the new model is deployed to the managed online endpoint, we swap traffic over to the new model. </span><span class="koboSpan" id="kobo.65.3">After the model is deployed in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">dev</span></strong><span class="koboSpan" id="kobo.67.1"> environment, we will trigger an approval process to then register and deploy the new model into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">qa</span></strong><span class="koboSpan" id="kobo.69.1"> environment, which will leverage blue/green deployments </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.71.1">Some organizations would choose not to register a model if</span><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.72.1"> it was performing just as well as the existing model, especially if the training data had not changed, but this will allow us to see how powerfully AML can handle updating a managed online endpoint. </span><span class="koboSpan" id="kobo.72.2">Af</span><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.73.1">ter a solid foundation has been applied, you can update the code to only register a model when it performs better than the existing model, but improving a model is an exercise left </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">to you.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">In this chapter, we will leverage an AML pipeline with AML SDK v2, v2 of the CLI, Azure DevOps organizations, and Azure DevOps projects, and take advantage of Azure Key Vault, which has been automatically deployed for you when deploying your environment. </span><span class="koboSpan" id="kobo.75.2">You will leverage two AML workspaces. </span><span class="koboSpan" id="kobo.75.3">For this chapter, we will refer to them as </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">dev</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.77.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.80.1">In order to break down the</span><a id="_idIndexMarker577"/><span class="koboSpan" id="kobo.81.1"> MLOps implementation, the following diagram represents the flow that we will create for your </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">MLOps implementation:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer316">
<span class="koboSpan" id="kobo.83.1"><img alt="Figure 9.1 – MLOps implementation" src="image/B18003_09_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.84.1">Figure 9.1 – MLOps implementation</span></p>
<p><span class="koboSpan" id="kobo.85.1">In the preceding figure, Azure DevOps is the orchestrator. </span><span class="koboSpan" id="kobo.85.2">When code is checked into the </span><strong class="bold"><span class="koboSpan" id="kobo.86.1">main</span></strong><span class="koboSpan" id="kobo.87.1"> branch, Azure DevOps will trigger off the Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">DevOps pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.89.1">We will create an Azure DevOps pipeline that consists of two st</span><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.90.1">ages. </span><span class="koboSpan" id="kobo.90.2">One stage is </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">dev stage</span></strong><span class="koboSpan" id="kobo.92.1">, and one will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">qa stage</span></strong><span class="koboSpan" id="kobo.94.1">. </span><span class="koboSpan" id="kobo.94.2">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">dev stage</span></strong><span class="koboSpan" id="kobo.96.1">, we will leverage the AML CLI to first get the initial model version and place it into a variable in the DevOps pipe</span><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.97.1">line. </span><span class="koboSpan" id="kobo.97.2">After retrieving the model version, we will run the AML pipeline that handles the model creation and registra</span><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.98.1">tion. </span><span class="koboSpan" id="kobo.98.2">After running the AML pipeline, we will retrieve the model version again in the Azure DevOps pipe</span><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.99.1">line. </span><span class="koboSpan" id="kobo.99.2">If the model version has not changed, we know that no new model has been regist</span><a id="_idTextAnchor130"/><span class="koboSpan" id="kobo.100.1">ered. </span><span class="koboSpan" id="kobo.100.2">If the model version has increased, then we know we want to deploy this model in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">dev</span></strong><span class="koboSpan" id="kobo.102.1"> environment through Azure DevOps and proceed</span><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.103.1"> to deploy this model to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">qa</span></strong><span class="koboSpan" id="kobo.105.1"> environ</span><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.106.1">ment. </span><span class="koboSpan" id="kobo.106.2">Given the </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">qa</span></strong><span class="koboSpan" id="kobo.108.1"> environment is a higher environment, we will include an approval pro</span><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.109.1">cess. </span><span class="koboSpan" id="kobo.109.2">The registration and deployment into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">qa</span></strong><span class="koboSpan" id="kobo.111.1"> environment must first be appr</span><a id="_idTextAnchor134"/><span class="koboSpan" id="kobo.112.1">oved. </span><span class="koboSpan" id="kobo.112.2">Once it is approved, the registration and deployment into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">qa</span></strong><span class="koboSpan" id="kobo.114.1"> environment </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">will proceed.</span></span></p>
<p><span class="koboSpan" id="kobo.116.1">As part of the managed online endpoint, we can deploy a new model to an existing managed online endpoint through blue/green deploym</span><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.117.1">ents. </span><span class="koboSpan" id="kobo.117.2">When a model is first deployed to a managed online endpoint, we set the traffic to </span><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.118.1">100%. </span><span class="koboSpan" id="kobo.118.2">In the case</span><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.119.1"> of a new version of a model being deployed, we initially set the traffic to 0 for the new model, wait for it to be successfully deployed, and for the given managed online endpoint, we will then swap the traffic to </span><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.120.1">the latest version of the model to 100% and delete the old model deployment. </span><span class="koboSpan" id="kobo.120.2">This ensures the uptime for a given managed online endp</span><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.121.1">oint. </span><span class="koboSpan" id="kobo.121.2">Users of the rest endpoint will not be interrupted during the model deployment process once a managed online endpoint </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">is depl</span><a id="_idTextAnchor140"/><span class="koboSpan" id="kobo.123.1">oye</span><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.124.1">d.</span></span></p>
<p><span class="koboSpan" id="kobo.125.1">To set up our</span><a id="_idIndexMarker578"/><span class="koboSpan" id="kobo.126.1"> MLOps pipeline we will leverage several key reso</span><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.127.1">urces. </span><span class="koboSpan" id="kobo.127.2">During the MLOps automation pipeline, we will leverage a </span><strong class="bold"><span class="koboSpan" id="kobo.128.1">service connection</span></strong><span class="koboSpan" id="kobo.129.1"> to gain</span><a id="_idIndexMarker579"/><span class="koboSpan" id="kobo.130.1"> access to the appropriate work</span><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.131.1">spaces. </span><span class="koboSpan" id="kobo.131.2">A service connection will leverage an Azure service principal to connect to our AML workspace. </span><span class="koboSpan" id="kobo.131.3">We will create a service connection for connecting to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">dev</span></strong><span class="koboSpan" id="kobo.133.1"> AML workspace, and one for connecting to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">qa</span></strong><span class="koboSpan" id="kobo.135.1"> AML wor</span><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.136.1">kspace. </span><span class="koboSpan" id="kobo.136.2">In addition to the service connections, we will leverage the </span><strong class="bold"><span class="koboSpan" id="kobo.137.1">key vaults</span></strong><span class="koboSpan" id="kobo.138.1"> for each </span><a id="_idIndexMarker580"/><span class="koboSpan" id="kobo.139.1">of the environments storing sensitive info</span><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.140.1">rmation. </span><span class="koboSpan" id="kobo.140.2">We will link these key vaults using </span><strong class="bold"><span class="koboSpan" id="kobo.141.1">variable groups</span></strong><span class="koboSpan" id="kobo.142.1"> in Azure </span><a id="_idIndexMarker581"/><span class="koboSpan" id="kobo.143.1">DevOps. </span><span class="koboSpan" id="kobo.143.2">This will keep our Azure DevOps pipelines clean and easy to understand. </span><span class="koboSpan" id="kobo.143.3">Refer to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.144.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.145.1">.1</span></em><span class="koboSpan" id="kobo.146.1"> for a visual overview of the resources we are going </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">to leverage.</span></span></p>
<p><span class="koboSpan" id="kobo.148.1">This chapter is an opportunity to leverage your understanding of the functionality implemented so far in this book and put it all into practice. </span><span class="koboSpan" id="kobo.148.2">Let us get started looking at the technical requirements for a successful MLOps pipeline implementation leveraging the AML CLI v2 and SDK v2 with </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">Azure DevOps.</span></span></p>
<h1 id="_idParaDest-111"><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.150.1">Preparing your MLOps environment</span></h1>
<p><span class="koboSpan" id="kobo.151.1">In this section, we will go</span><a id="_idIndexMarker582"/><span class="koboSpan" id="kobo.152.1"> through ensuring that the technical requirements are fulfilled, given you have permission to do so. </span><span class="koboSpan" id="kobo.152.2">To prepare your environment, we will be doing </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">the following:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.154.1">Creating a second </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">AML workspace</span></span></li>
<li><span class="koboSpan" id="kobo.156.1">Creating an Azure DevOps Organization </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">and Project</span></span></li>
<li><span class="koboSpan" id="kobo.158.1">Confirming the code in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">dev</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.160.1">AML workspace</span></span></li>
<li><span class="koboSpan" id="kobo.161.1">Moving the code to your Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">DevOps Repo</span></span></li>
<li><span class="koboSpan" id="kobo.163.1">Setting up variables in Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">Key Vault</span></span></li>
<li><span class="koboSpan" id="kobo.165.1">Setting up Azure DevOps environment </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">variable groups</span></span></li>
<li><span class="koboSpan" id="kobo.167.1">Creating an Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">DevOps environment</span></span></li>
<li><span class="koboSpan" id="kobo.169.1">Setting your Azure DevOps </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">service connections</span></span></li>
<li><span class="koboSpan" id="kobo.171.1">Creating an Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">DevOps pipeline</span></span></li>
<li><span class="koboSpan" id="kobo.173.1">Running an Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">DevOps pipeline</span></span></li>
</ol>
<h2 id="_idParaDest-112"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.175.1">Creating a second AML workspace</span></h2>
<p><span class="koboSpan" id="kobo.176.1">Up to this </span><a id="_idIndexMarker583"/><span class="koboSpan" id="kobo.177.1">point, you have been working in a single AML workspace. </span><span class="koboSpan" id="kobo.177.2">With our MLOps pipeline implementation, we will be using two workspaces. </span><span class="koboSpan" id="kobo.177.3">For information on deploying a second AML workspace, see </span><a href="B18003_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.178.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.179.1">, </span><em class="italic"><span class="koboSpan" id="kobo.180.1">Introducing the Azure Machine Learning Service</span></em><span class="koboSpan" id="kobo.181.1">. </span><span class="koboSpan" id="kobo.181.2">After you have created a second AML workspace, continue to the next step: </span><em class="italic"><span class="koboSpan" id="kobo.182.1">Creating an Azure DevOps organization </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.183.1">and project</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">.</span></span></p>
<h2 id="_idParaDest-113"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.185.1">Creating an Azure DevOps organization and project</span></h2>
<p><span class="koboSpan" id="kobo.186.1">An Azure </span><a id="_idIndexMarker584"/><span class="koboSpan" id="kobo.187.1">DevOps pipeline is held within an </span><strong class="bold"><span class="koboSpan" id="kobo.188.1">Azure DevOps project</span></strong><span class="koboSpan" id="kobo.189.1">. </span><span class="koboSpan" id="kobo.189.2">An Azure </span><a id="_idIndexMarker585"/><span class="koboSpan" id="kobo.190.1">DevOps project is held within an </span><strong class="bold"><span class="koboSpan" id="kobo.191.1">Azure DevOps organization</span></strong><span class="koboSpan" id="kobo.192.1">. </span><span class="koboSpan" id="kobo.192.2">You will be required to have an Azure DevOps project to host your code repository that you can write code to and create Azure DevOps pipelines, create service connections, create variable groups, and link to you</span><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.193.1">r key vaults. </span><span class="koboSpan" id="kobo.193.2">You may already have an Azure DevOps organiz</span><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.194.1">ation set up. </span><span class="koboSpan" id="kobo.194.2">Your administrator will have chosen either to have a single project in an Azure DevOps organization that supports many repositories and many A</span><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.195.1">zure DevOps pipelines or to have many projects with one or many repositories in an Azure DevOps organization. </span><span class="koboSpan" id="kobo.195.2">If your administrator has already created an Azure DevOps organization, you can either request a new Azure DevOps project within the Azure DevOps organization, or access to an existing Azure DevOps project with a repository to hold your code, and the ability to create Azure DevOps pipelines. </span><span class="koboSpan" id="kobo.195.3">If you already have an Azure DevOps organization and project, continue to the next</span><a id="_idIndexMarker586"/><span class="koboSpan" id="kobo.196.1"> subsection, </span><em class="italic"><span class="koboSpan" id="kobo.197.1">Confirming code in the dev </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.198.1">AML workspace</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.200.1">We will continue with setting up an Azure DevOps organization through t</span><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.201.1">he web portal. </span><span class="koboSpan" id="kobo.201.2">An Azure DevOps organization will host your project, and a project will hold your source code in a repository, as well as Azure DevOps pipelines for automating your </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">MLOps pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.203.1">If you do not have an</span><a id="_idIndexMarker587"/><span class="koboSpan" id="kobo.204.1"> Azure DevOps organization, please follow the following steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">create one:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.206.1">Sign in to Azure DevOps </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">at </span></span><a href="https://dev.azure.com/"><span class="No-Break"><span class="koboSpan" id="kobo.208.1">https://dev.azure.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.209.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.210.1">In the left-hand menu, select </span><strong class="bold"><span class="koboSpan" id="kobo.211.1">New organization</span></strong><span class="koboSpan" id="kobo.212.1"> as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer317">
<span class="koboSpan" id="kobo.214.1"><img alt="Figure 9.2 – New organization" src="image/B18003_09_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.215.1">Figure 9.2 – New organization</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.216.1">This will bring</span><a id="_idIndexMarker588"/><span class="koboSpan" id="kobo.217.1"> up a new window for getting started with the process of creating an Azure DevOps organization. </span><span class="koboSpan" id="kobo.217.2">Then, click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.218.1">Continue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.219.1"> button.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer318">
<span class="koboSpan" id="kobo.220.1"><img alt="Figure 9.3 – Get started with Azure DevOps" src="image/B18003_09_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.221.1">Figure 9.3 – Get started with Azure DevOps</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.222.1">This brings</span><a id="_idIndexMarker589"/><span class="koboSpan" id="kobo.223.1"> you to the next screen for creating your Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">DevOps organization:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer319">
<span class="koboSpan" id="kobo.225.1"><img alt="Figure 9.4 – Creating your Azure DevOps organization" src="image/B18003_09_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.226.1">Figure 9.4 – Creating your Azure DevOps organization</span></p>
<p><span class="koboSpan" id="kobo.227.1">Azure DevOps organizations</span><a id="_idIndexMarker590"/><span class="koboSpan" id="kobo.228.1"> are required to be unique, so you need to create yours with a name that has not already been taken. </span><span class="koboSpan" id="kobo.228.2">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.229.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.230.1">.4</span></em><span class="koboSpan" id="kobo.231.1">, populate the </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">following information:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.233.1">Name your organization. </span><span class="koboSpan" id="kobo.233.2">A unique organization is required. </span><span class="koboSpan" id="kobo.233.3">In the preceding example, we have opted </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">mmxdevops</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.237.1">The location at which to host your projects – we have selected </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.238.1">Central US</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.240.1">Enter the characters you see on the screen – we have typed </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">Dp5Ls</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.242.1">for validation.</span></span></li>
<li><span class="koboSpan" id="kobo.243.1">Click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.244.1">Continue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.245.1"> button.</span></span></li>
</ol>
<ol>
<li value="5"><span class="koboSpan" id="kobo.246.1">The next screen will ask you to fill in the </span><strong class="bold"><span class="koboSpan" id="kobo.247.1">Project name</span></strong><span class="koboSpan" id="kobo.248.1"> field for where your code and MLOps pipelines will be held. </span><span class="koboSpan" id="kobo.248.2">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.249.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.250.1">.5</span></em><span class="koboSpan" id="kobo.251.1">, we have selected a </span><strong class="bold"><span class="koboSpan" id="kobo.252.1">Private</span></strong><span class="koboSpan" id="kobo.253.1"> project. </span><span class="koboSpan" id="kobo.253.2">If you are working in an organization, you may see an option for an </span><strong class="bold"><span class="koboSpan" id="kobo.254.1">Enterprise</span></strong><span class="koboSpan" id="kobo.255.1"> project. </span><span class="koboSpan" id="kobo.255.2">If this option is not available to you, create a </span><strong class="bold"><span class="koboSpan" id="kobo.256.1">Private</span></strong><span class="koboSpan" id="kobo.257.1"> project. </span><span class="koboSpan" id="kobo.257.2">Creating a </span><strong class="bold"><span class="koboSpan" id="kobo.258.1">Public</span></strong><span class="koboSpan" id="kobo.259.1"> project will allow public access to your project. </span><span class="koboSpan" id="kobo.259.2">A private project will give you the ability to add users that you choose to your project if you would like to share it. </span><span class="koboSpan" id="kobo.259.3">Finally, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.260.1">+ Create </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.261.1">project</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.262.1"> button.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer320">
<span class="koboSpan" id="kobo.263.1"><img alt="Figure 9.5 – Creating an Azure DevOps organization" src="image/B18003_09_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.264.1">Figure 9.5 – Creating an Azure DevOps organization</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.265.1">Now that your </span><a id="_idIndexMarker591"/><span class="koboSpan" id="kobo.266.1">project has been created, you will have a place to hold key resources required </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">for MLOps.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.268.1">The Azure DevOps project includes the following two </span><span class="No-Break"><span class="koboSpan" id="kobo.269.1">key components:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.270.1">Repos</span></strong><span class="koboSpan" id="kobo.271.1">: A place to store </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">your code</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.273.1">Pipelines</span></strong><span class="koboSpan" id="kobo.274.1">: A place to create your MLOps </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">pipeline automation</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.276.1">We will leverage these as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.277.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.278.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer321">
<span class="koboSpan" id="kobo.280.1"><img alt="Figure 9.6 – Creating an Azure DevOps organization" src="image/B18003_09_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.281.1">Figure 9.6 – Creating an Azure DevOps organization</span></p>
<p><span class="koboSpan" id="kobo.282.1">We will explor</span><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.283.1">e leveraging both </span><strong class="bold"><span class="koboSpan" id="kobo.284.1">Repos</span></strong><span class="koboSpan" id="kobo.285.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.286.1">Pipelines</span></strong><span class="koboSpan" id="kobo.287.1"> later in </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">the chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.289.1">Congratulations – you have set up an </span><a id="_idIndexMarker592"/><span class="koboSpan" id="kobo.290.1">Azure DevOps organization and project. </span><span class="koboSpan" id="kobo.290.2">Now it is time to dig into creating the repository for holding </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">your code.</span></span></p>
<p><span class="koboSpan" id="kobo.292.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.293.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.294.1">.6</span></em><span class="koboSpan" id="kobo.295.1">, you can see that </span><strong class="bold"><span class="koboSpan" id="kobo.296.1">Repos</span></strong><span class="koboSpan" id="kobo.297.1"> is one of the menu options. </span><span class="koboSpan" id="kobo.297.2">Select this to enter the repository section of your Azure DevOps project as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.298.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.299.1">.7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.300.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer322">
<span class="koboSpan" id="kobo.301.1"><img alt="Figure 9.7 – Empty repository" src="image/B18003_09_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.302.1">Figure 9.7 – Empty repository</span></p>
<p><span class="koboSpan" id="kobo.303.1">There are three important items that we will copy and save for future use. </span><span class="koboSpan" id="kobo.303.2">Selecting the copy button, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.304.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.305.1">.7</span></em><span class="koboSpan" id="kobo.306.1"> marked as </span><strong class="bold"><span class="koboSpan" id="kobo.307.1">a</span></strong><span class="koboSpan" id="kobo.308.1">, will copy the URL to your Git repository. </span><span class="koboSpan" id="kobo.308.2">Selecting the </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">Generate Git Credentials</span></strong><span class="koboSpan" id="kobo.310.1"> button, marked as </span><strong class="bold"><span class="koboSpan" id="kobo.311.1">b</span></strong><span class="koboSpan" id="kobo.312.1"> in the figure, will give you a user and password. </span><span class="koboSpan" id="kobo.312.2">We will provide the information to link the code in your AML workspace to your Azure DevOps repository in the </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">AML terminal.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.314.1">Tip</span></p>
<p class="callout"><span class="koboSpan" id="kobo.315.1">At any time, to head to your DevOps Project, you can enter the following </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">URL: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">https://dev.azure.com/&lt;organization_name&gt;/&lt;project_name&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.319.1">Now that we have copied the URL, the user, and the password for connecting to your Azure DevOps project, we are ready to review the next requirement for your </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">AML workspace.</span></span></p>
<h2 id="_idParaDest-114"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.321.1">Connecting to your AML workspace</span></h2>
<p><span class="koboSpan" id="kobo.322.1">In addition to your </span><a id="_idIndexMarker593"/><span class="koboSpan" id="kobo.323.1">Azure DevOps organization and project, we will need to connect to your AML workspace to leverage SDK v2 and the AML CLI v2 to implement an MLOps pipeline, as done in </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">previous chapters.</span></span></p>
<p><span class="koboSpan" id="kobo.325.1">In the previous chapter, we cloned the Git repository. </span><span class="koboSpan" id="kobo.325.2">If you have not already done so, continue to follow the steps provided ahead. </span><span class="koboSpan" id="kobo.325.3">If you have already cloned the repository, skip ahead to the </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">next section:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.327.1">Open the terminal on your </span><strong class="bold"><span class="koboSpan" id="kobo.328.1">Compute</span></strong><span class="koboSpan" id="kobo.329.1"> instance. </span><span class="koboSpan" id="kobo.329.2">Note that the path will include your user in the directory. </span><span class="koboSpan" id="kobo.329.3">Type the following into the terminal to clone the sample notebooks into your </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">working directory:</span></span><pre class="console"><span class="koboSpan" id="kobo.331.1">
 git clone </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">https://github.com/PacktPublishing/Azure-Machine-Learning-Engineering.git</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.333.1">Clicking on the refresh icon will update and refresh the notebooks displayed on </span><span class="No-Break"><span class="koboSpan" id="kobo.334.1">your screen.</span></span></li>
<li><span class="koboSpan" id="kobo.335.1">Review the notebooks in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">Azure-Machine-Learning-Engineering</span></strong><span class="koboSpan" id="kobo.337.1"> directory. </span><span class="koboSpan" id="kobo.337.2">This will display the files cloned into your working directory as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.338.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.339.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer323">
<span class="koboSpan" id="kobo.341.1"><img alt="Figure 9.8 – Azure-Machine-Learning-Engineering directory" src="image/B18003_09_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.342.1">Figure 9.8 – Azure-Machine-Learning-Engineering directory</span></p>
<p><span class="koboSpan" id="kobo.343.1">Now that your </span><a id="_idIndexMarker594"/><span class="koboSpan" id="kobo.344.1">code is in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">dev</span></strong><span class="koboSpan" id="kobo.346.1"> AML environment, you are ready to move your code to your Azure DevOps repo. </span><span class="koboSpan" id="kobo.346.2">At this point, the code required to build your MLOps pipeline is in your AMLS workspace. </span><span class="koboSpan" id="kobo.346.3">In the next subsection, we will move your code from the AML workspace into the DevOps repo in your Azure DevOps project. </span><span class="koboSpan" id="kobo.346.4">This connection will simulate the work a data scientist or MLOps engineer would do. </span><span class="koboSpan" id="kobo.346.5">Write code in your AML workspace, and commit that code to your Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">DevOps repo.</span></span></p>
<h2 id="_idParaDest-115"><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.348.1">Moving code to the Azure DevOps repo</span></h2>
<p><span class="koboSpan" id="kobo.349.1">We already have your </span><a id="_idIndexMarker595"/><span class="koboSpan" id="kobo.350.1">code in our first AML workspace, which is referred to as our </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">dev</span></strong><span class="koboSpan" id="kobo.352.1"> AML workspace. </span><span class="koboSpan" id="kobo.352.2">Now, we will move your code over to our Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">DevOps repo.</span></span></p>
<p><span class="koboSpan" id="kobo.354.1">Navigate to a terminal session in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.355.1">dev</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.356.1">AML workspace:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.357.1">In your terminal, navigate to your </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">Azure-Machine-Learning-Engineering</span></strong><span class="koboSpan" id="kobo.359.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">as follows:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.361.1">cd Azure-Machine-Learning-Engineering</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.362.1">First, we will need to specify that the directory is safe by typing the </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">following command:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.364.1">git config --global --add safe.directory '*'</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.365.1">We will want to update your origin, which specifies the remote location your code resides in, into a repository in your Azure DevOps project. </span><span class="koboSpan" id="kobo.365.2">In the following command, we will replace the URL with that of your Azure DevOps repo. </span><span class="koboSpan" id="kobo.365.3">This will be the URL you copied from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.366.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.367.1">.7</span></em><span class="koboSpan" id="kobo.368.1">. </span><span class="koboSpan" id="kobo.368.2">The command to do this, in general, is </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">the following:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.370.1">git remote set-url origin https://&lt;organization_name&gt;@dev.azure.com/ &lt;organization_name&gt; /&lt;project_name&gt;/_git/mlops</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.371.1">To review that your origin has been set correctly, you can type the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.372.1">your terminal:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.373.1">git remote -v</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.374.1">To enable your Git user information to be saved, you can set </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">the following:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.376.1">git config --global credential.helper store</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.377.1">Next, we will set the Git user information </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">as follows:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.379.1">git config --global user.email &lt;username_from_azuredevOps&gt;</span></strong></pre><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.380.1">git config --global user.name "Firstname Lastname"</span></strong></pre><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.381.1">git config --global push.default simple</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.382.1">To push to the origin, which is the repo in your Azure DevOps project, you can type the </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">following </span></span><span class="No-Break"><a id="_idIndexMarker596"/></span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">command:</span></span><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.385.1">git status</span></strong></pre><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.386.1">git add –A</span></strong></pre><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.387.1">git commit –m "updated"</span></strong></pre><pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.388.1">git push origin main</span></strong></pre></li>
<li><span class="koboSpan" id="kobo.389.1">This will prompt a password, which was provided when you clicked on the credentials for your Azure DevOps project, referred to in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.390.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.391.1">.9</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.393.1">After using the preceding command, the code will now be copied from your AML workspace, over to the repo in your Azure DevOps project as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer324">
<span class="koboSpan" id="kobo.395.1"><img alt="Figure 9.9 – Azure DevOps MLOps project" src="image/B18003_09_009.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.396.1">Figure 9.9 – Azure DevOps MLOps project</span></p>
<p><span class="koboSpan" id="kobo.397.1">At this stage, you have </span><a id="_idIndexMarker597"/><span class="koboSpan" id="kobo.398.1">successfully moved your code over to your Azure DevOps repository. </span><span class="koboSpan" id="kobo.398.2">Changes made to the code on an AML compute resource that are committed to your repository will be reflected and updated in your Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">DevOps repository.</span></span></p>
<p><span class="koboSpan" id="kobo.400.1">In the next subsection, we will be setting up variables in Azure Key Vault for each of the AML </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">workspace environments.</span></span></p>
<h2 id="_idParaDest-116"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.402.1">Setting up variables in Azure Key Vault</span></h2>
<p><span class="koboSpan" id="kobo.403.1">When your </span><a id="_idIndexMarker598"/><span class="koboSpan" id="kobo.404.1">AML workspace was deployed, Azure Key</span><a id="_idIndexMarker599"/><span class="koboSpan" id="kobo.405.1"> Vault was also deployed for each of your workspaces. </span><span class="koboSpan" id="kobo.405.2">We will leverage each key vault to store sensitive information related to each workspace so Azure DevOps can connect and run the AML pipeline and AML CLI v2 commands on an Azure DevOps build agent. </span><span class="koboSpan" id="kobo.405.3">We could have chosen not to leverage the default key vaults deployed with the AML workspace and spun up two separate key vaults for this task, but given the resources are already available, we will choose to continue with leveraging the default deployed key vaults. </span><span class="koboSpan" id="kobo.405.4">To set up variables in Azure Key Vault, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">these steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.407.1">Head over to the Azure portal by going to </span><a href="https://portal.azure.com/"><span class="koboSpan" id="kobo.408.1">https://portal.azure.com/</span></a><span class="koboSpan" id="kobo.409.1"> and locate your AML workspace. </span><span class="koboSpan" id="kobo.409.2">Click on the resource, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">following figure:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer325">
<span class="koboSpan" id="kobo.411.1"><img alt="Figure 9.10 – AML workspace icon in the Azure portal" src="image/B18003_09_010.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.412.1">Figure 9.10 – AML workspace icon in the Azure portal</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.413.1">Clicking on </span><a id="_idIndexMarker600"/><span class="koboSpan" id="kobo.414.1">the resource, we can see the overview </span><a id="_idIndexMarker601"/><span class="koboSpan" id="kobo.415.1">of the AML workspace includes </span><strong class="bold"><span class="koboSpan" id="kobo.416.1">Key </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.417.1">Vault</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.418.1"> information:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer326">
<span class="koboSpan" id="kobo.419.1"><img alt="Figure 9.11 – AML workspace overview" src="image/B18003_09_011.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.420.1">Figure 9.11 – AML workspace overview</span></p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span xml:lang="en-GB"><span class="koboSpan" id="kobo.421.1">Clicking on the </span></span><strong class="bold" xml:lang="en-GB"><span class="koboSpan" id="kobo.422.1">Key Vault</span></strong><span xml:lang="en-GB"><span class="koboSpan" id="kobo.423.1"> name will bring us directly to the Azure key vault, as shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer327">
<span class="koboSpan" id="kobo.424.1"><img alt="Figure 9.12 – Azure Key Vault overview" src="image/B18003_09_012.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.425.1">Figure 9.12 – Azure Key Vault overview</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.426.1">Currently, you</span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.427.1"> are not authorized to view </span><strong class="bold"><span class="koboSpan" id="kobo.428.1">Secrets</span></strong><span class="koboSpan" id="kobo.429.1">, so </span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.430.1">click on the </span><strong class="bold"><span class="koboSpan" id="kobo.431.1">Access polices</span></strong><span class="koboSpan" id="kobo.432.1"> menu on the left as shown in the preceding figure. </span><span class="koboSpan" id="kobo.432.2">This will bring up the </span><strong class="bold"><span class="koboSpan" id="kobo.433.1">Access policies</span></strong><span class="koboSpan" id="kobo.434.1"> options as </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer328">
<span class="koboSpan" id="kobo.436.1"><img alt="Figure 9.13 – Azure Key Vault access policies" src="image/B18003_09_013.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.437.1">Figure 9.13 – Azure Key Vault access policies</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.438.1">Clicking on </span><strong class="bold"><span class="koboSpan" id="kobo.439.1">+ Create</span></strong><span class="koboSpan" id="kobo.440.1"> as</span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.441.1"> shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.442.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.443.1">.14</span></em><span class="koboSpan" id="kobo.444.1"> will present</span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.445.1"> you with options for assigning permissions. </span><span class="koboSpan" id="kobo.445.2">Under </span><strong class="bold"><span class="koboSpan" id="kobo.446.1">Secret permissions</span></strong><span class="koboSpan" id="kobo.447.1">, check </span><strong class="bold"><span class="koboSpan" id="kobo.448.1">Get</span></strong><span class="koboSpan" id="kobo.449.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.450.1">List</span></strong><span class="koboSpan" id="kobo.451.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">Set</span></strong><span class="koboSpan" id="kobo.453.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.454.1">Delete</span></strong><span class="koboSpan" id="kobo.455.1">, and click </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">on </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.457.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer329">
<span class="koboSpan" id="kobo.459.1"><img alt="Figure 9.14 – Setting secret permission options" src="image/B18003_09_014.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.460.1">Figure 9.14 – Setting secret permission options</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.461.1">You will then</span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.462.1"> search for yourself either by name or</span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.463.1"> email address to assign yourself the permissions, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">following figure:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer330">
<span class="koboSpan" id="kobo.465.1"><img alt="Figure 9.15 – Searching by email to assign Azure Key Vault selected permissions" src="image/B18003_09_015.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.466.1">Figure 9.15 – Searching by email to assign Azure Key Vault selected permissions</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.467.1">In the text box shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.468.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.469.1">.16</span></em><span class="koboSpan" id="kobo.470.1">, type your email address and find yourself to </span><span class="No-Break"><span class="koboSpan" id="kobo.471.1">assign access:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer331">
<span class="koboSpan" id="kobo.472.1"><img alt="Figure 9.16 – Locating your email address" src="image/B18003_09_016.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.473.1">Figure 9.16 – Locating your email address</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.474.1">After you have found yourself, select your name, and click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.475.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.476.1"> button.</span></span></li>
<li><span class="koboSpan" id="kobo.477.1">You will then be given the option to select an application – do not select anything in the </span><strong class="bold"><span class="koboSpan" id="kobo.478.1">Application (optional)</span></strong><span class="koboSpan" id="kobo.479.1"> section and </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.481.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer332">
<span class="koboSpan" id="kobo.483.1"><img alt="Figure 9.17 – Skipping Application (optional)" src="image/B18003_09_017.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.484.1">Figure 9.17 – Skipping Application (optional)</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.485.1">Finally, click</span><a id="_idIndexMarker608"/><span class="koboSpan" id="kobo.486.1"> on </span><a id="_idIndexMarker609"/><span class="koboSpan" id="kobo.487.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.488.1">Create</span></strong><span class="koboSpan" id="kobo.489.1"> button under the </span><strong class="bold"><span class="koboSpan" id="kobo.490.1">Review + </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.491.1">create</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.492.1"> section.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer333">
<span class="koboSpan" id="kobo.493.1"><img alt="Figure 9.18 – Creating Azure Key Vault permissions" src="image/B18003_09_018.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.494.1">Figure 9.18 – Creating Azure Key Vault permissions</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.495.1">Now that you have permission to view and create secrets, head to the </span><strong class="bold"><span class="koboSpan" id="kobo.496.1">Secrets</span></strong><span class="koboSpan" id="kobo.497.1"> option in the </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">left-hand menu:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer334">
<span class="koboSpan" id="kobo.499.1"><img alt="Figure 9.19 – Secrets option in the left-hand menu" src="image/B18003_09_019.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.500.1">Figure 9.19 – Secrets option in the left-hand menu</span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.501.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.502.1">+ Generate/Import</span></strong><span class="koboSpan" id="kobo.503.1"> button, as </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer335">
<span class="koboSpan" id="kobo.505.1"><img alt="Figure 9.20 – Generating a new secret" src="image/B18003_09_020.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.506.1">Figure 9.20 – Generating a new secret</span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.507.1">This brings up the </span><a id="_idIndexMarker610"/><span class="koboSpan" id="kobo.508.1">screen for </span><strong class="bold"><span class="koboSpan" id="kobo.509.1">Create a secret</span></strong><span class="koboSpan" id="kobo.510.1">, as </span><a id="_idIndexMarker611"/><span class="koboSpan" id="kobo.511.1">shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.512.1">following figure:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer336">
<span class="koboSpan" id="kobo.513.1"><img alt="Figure 9.21 – Create a secret" src="image/B18003_09_021.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.514.1">Figure 9.21 – Create a secret</span></p>
<p><span class="koboSpan" id="kobo.515.1">Populate a secret</span><a id="_idIndexMarker612"/><span class="koboSpan" id="kobo.516.1"> and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.517.1">Create</span></strong><span class="koboSpan" id="kobo.518.1"> button for each of the </span><a id="_idIndexMarker613"/><span class="koboSpan" id="kobo.519.1">values listed in the following table, as they will be leveraged by your Azure DevOps pipeline. </span><span class="koboSpan" id="kobo.519.2">The table provided here gives you sample information in the </span><strong class="bold"><span class="koboSpan" id="kobo.520.1">Value</span></strong><span class="koboSpan" id="kobo.521.1"> column. </span><span class="koboSpan" id="kobo.521.2">This sample information should be taken from the overview of your AML workspace as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.522.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.523.1">.11</span></em><span class="koboSpan" id="kobo.524.1">, except for the location. </span><span class="koboSpan" id="kobo.524.2">Based on where your AML workspace is deployed, the location value can be found here – </span><a href="https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations"><span class="No-Break"><span class="koboSpan" id="kobo.525.1">https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.526.1">:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-3">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.527.1">Key </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.528.1">Vault variable</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.529.1">Value</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">resourceGroup</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">aml-dev-rg</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">wsName</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">aml-dev</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">eastus</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.536.1">Figure 9.22 – Azure key vault variables for the dev Azure key vault</span></p>
<p><span class="koboSpan" id="kobo.537.1">Now that you have set up the Azure key vault for your first AML workspace, we will follow the same </span><em class="italic"><span class="koboSpan" id="kobo.538.1">steps 1 to 13</span></em><span class="koboSpan" id="kobo.539.1"> to set up the Azure key vault and values for your second AML workspace. </span><span class="koboSpan" id="kobo.539.2">This information should be taken from the overview of your second </span><strong class="source-inline"><span class="koboSpan" id="kobo.540.1">qa</span></strong><span class="koboSpan" id="kobo.541.1"> AML workspace, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.542.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.543.1">.11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.545.1">Key </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.546.1">Vault variable</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.547.1">Value</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">resourceGroup</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">aml-qa-rg</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">wsName</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">aml-qa</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.553.1">eastus</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.554.1">Figure 9.23 – Azure key vault variables for the qa Azure key vault</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.555.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.556.1">In a real scenario, we would typically see either a non-prod and prod environment, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">dev</span></strong><span class="koboSpan" id="kobo.558.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">qa</span></strong><span class="koboSpan" id="kobo.560.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">prod</span></strong><span class="koboSpan" id="kobo.562.1">. </span><span class="koboSpan" id="kobo.562.2">This code can be extended to support </span><em class="italic"><span class="koboSpan" id="kobo.563.1">n</span></em><span class="koboSpan" id="kobo.564.1"> number </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">of environments.</span></span></p>
<p><span class="koboSpan" id="kobo.566.1">Once you have </span><a id="_idIndexMarker614"/><span class="koboSpan" id="kobo.567.1">completed this for both environments, you </span><a id="_idIndexMarker615"/><span class="koboSpan" id="kobo.568.1">are ready to move on to the next step – setting up your environment </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">variable groups.</span></span></p>
<h2 id="_idParaDest-117"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.570.1">Setting up environment variable groups</span></h2>
<p><span class="koboSpan" id="kobo.571.1">Now that your variables are </span><a id="_idIndexMarker616"/><span class="koboSpan" id="kobo.572.1">securely in Azure Key Vault, we will set up variable group to hold your settings to be leveraged inside your Azure DevOps pipeline. </span><span class="koboSpan" id="kobo.572.2">An variable group is a collection of variables that are leveraged together in an Azure DevOps pipeline task. </span><span class="koboSpan" id="kobo.572.3">This means that each task can use variables that specify whether we are going to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">dev</span></strong><span class="koboSpan" id="kobo.574.1"> environment with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">dev</span></strong><span class="koboSpan" id="kobo.576.1"> service connection or connecting in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">qa</span></strong><span class="koboSpan" id="kobo.578.1"> environment, leveraging the </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">qa</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.580.1">service connection.</span></span></p>
<p><span class="koboSpan" id="kobo.581.1">We will be creating two variable groups, </span><strong class="source-inline"><span class="koboSpan" id="kobo.582.1">devops-variable-group-dev</span></strong><span class="koboSpan" id="kobo.583.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">devops-variable-group-qa</span></strong><span class="koboSpan" id="kobo.585.1">, to simulate moving from one environment </span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">to another:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.587.1">From the left-hand menu, select the </span><strong class="bold"><span class="koboSpan" id="kobo.588.1">Pipelines</span></strong><span class="koboSpan" id="kobo.589.1"> blue rocket icon, and select the </span><strong class="bold"><span class="koboSpan" id="kobo.590.1">Library</span></strong><span class="koboSpan" id="kobo.591.1"> option </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">as shown:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer337">
<span class="koboSpan" id="kobo.593.1"><img alt="Figure 9.24 – Library option" src="image/B18003_09_024.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.594.1">Figure 9.24 – Library option</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.595.1">Selecting the </span><strong class="bold"><span class="koboSpan" id="kobo.596.1">Library</span></strong><span class="koboSpan" id="kobo.597.1"> option, you</span><a id="_idIndexMarker617"/><span class="koboSpan" id="kobo.598.1"> will be prompted to create a new variable group as </span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer338">
<span class="koboSpan" id="kobo.600.1"><img alt="Figure 9.25 – New variable group" src="image/B18003_09_025.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.601.1">Figure 9.25 – New variable group</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.602.1">Clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.603.1">+ Variable group</span></strong><span class="koboSpan" id="kobo.604.1"> button will allow you to create a variable group. </span><span class="koboSpan" id="kobo.604.2">The name of the variable group will be leveraged by the Azure DevOps pipeline, so you will want to name it  </span><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">devops-variable-group-dev</span></strong><span class="koboSpan" id="kobo.606.1">, and enable the </span><strong class="bold"><span class="koboSpan" id="kobo.607.1">Link secrets from an Azure key vault as variables</span></strong><span class="koboSpan" id="kobo.608.1"> option, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer339">
<span class="koboSpan" id="kobo.610.1"><img alt="Figure 9.26 – Variable group creation" src="image/B18003_09_026.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.611.1">Figure 9.26 – Variable group creation</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.612.1">You will need </span><a id="_idIndexMarker618"/><span class="koboSpan" id="kobo.613.1">to click on the </span><strong class="bold"><span class="koboSpan" id="kobo.614.1">Authorize</span></strong><span class="koboSpan" id="kobo.615.1"> button for your </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">Azure subscription.</span></span></li>
<li><span class="koboSpan" id="kobo.617.1">When selecting the Azure key vault to link with your variable group, make sure that you link the </span><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">dev</span></strong><span class="koboSpan" id="kobo.619.1"> key vault with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">devops-variable-group-dev</span></strong><span class="koboSpan" id="kobo.621.1"> variable group, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">qa</span></strong><span class="koboSpan" id="kobo.623.1"> key vault with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">devops-variable-group-qa</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.625.1">variable group.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer340">
<span class="koboSpan" id="kobo.626.1"><img alt="Figure 9.27 – Variable group link to Azure Key Vault" src="image/B18003_09_027.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.627.1">Figure 9.27 – Variable group link to Azure Key Vault</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.628.1">After the </span><a id="_idIndexMarker619"/><span class="koboSpan" id="kobo.629.1">authorization for the key vault has been completed, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.630.1">+ Add</span></strong><span class="koboSpan" id="kobo.631.1"> icon to add the secrets from your key vault into your Azure DevOps variable group shown </span><span class="No-Break"><span class="koboSpan" id="kobo.632.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer341">
<span class="koboSpan" id="kobo.633.1"><img alt="Figure 9.28 – Adding variables to the Azure DevOps variable group" src="image/B18003_09_028.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.634.1">Figure 9.28 – Adding variables to the Azure DevOps variable group</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.635.1">Clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.636.1">+ Add</span></strong><span class="koboSpan" id="kobo.637.1"> icon, you will be prompted to select secrets from the Azure key vault you have linked to the variable group, as </span><span class="No-Break"><span class="koboSpan" id="kobo.638.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer342">
<span class="koboSpan" id="kobo.639.1"><img alt="Figure 9.29 – Selecting Azure key vault variables" src="image/B18003_09_029.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.640.1">Figure 9.29 – Selecting Azure key vault variables</span></p>
<p><span class="koboSpan" id="kobo.641.1">Select the three </span><a id="_idIndexMarker620"/><span class="koboSpan" id="kobo.642.1">variables you populated from </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.643.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.644.1">.22</span></em><span class="koboSpan" id="kobo.645.1"> and </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.646.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.647.1">.23</span></em><span class="koboSpan" id="kobo.648.1">, and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.649.1">Ok</span></strong><span class="koboSpan" id="kobo.650.1"> button. </span><span class="koboSpan" id="kobo.650.2">Remember, </span><strong class="source-inline"><span class="koboSpan" id="kobo.651.1">devops-variable-group-dev</span></strong><span class="koboSpan" id="kobo.652.1"> should be linked to your </span><strong class="source-inline"><span class="koboSpan" id="kobo.653.1">dev</span></strong><span class="koboSpan" id="kobo.654.1"> Azure key vault, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">devops-variable-group-qa</span></strong><span class="koboSpan" id="kobo.656.1"> should be linked to your </span><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">qa</span></strong><span class="koboSpan" id="kobo.658.1"> Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.659.1">key vault.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.660.1">Do remember to click on the </span><strong class="bold"><span class="koboSpan" id="kobo.661.1">Save</span></strong><span class="koboSpan" id="kobo.662.1"> icon for each of your </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1">variable groups:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer343">
<span class="koboSpan" id="kobo.664.1"><img alt="Figure 9.30 – Saving an Azure DevOps variable group" src="image/B18003_09_030.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.665.1">Figure 9.30 – Saving an Azure DevOps variable group</span></p>
<p><span class="koboSpan" id="kobo.666.1">At this point, you should ensure you have linked two variable groups, and each variable group should be linked to the key vault specific to </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">that environment.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.668.1">Clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.669.1">Library</span></strong><span class="koboSpan" id="kobo.670.1"> icon in the left-hand menu within Azure DevOps will bring up </span><strong class="bold"><span class="koboSpan" id="kobo.671.1">Variable groups</span></strong><span class="koboSpan" id="kobo.672.1"> that you have populated as </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer344">
<span class="koboSpan" id="kobo.674.1"><img alt="Figure 9.31 – Azure DevOps variable groups" src="image/B18003_09_031.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.675.1">Figure 9.31 – Azure DevOps variable groups</span></p>
<p><span class="koboSpan" id="kobo.676.1">Congratulations – you</span><a id="_idIndexMarker621"/><span class="koboSpan" id="kobo.677.1"> have set up two variable groups pointing to two different key vaults, each holding information regarding the specific workspace. </span><span class="koboSpan" id="kobo.677.2">Note that this is very extensible. </span><span class="koboSpan" id="kobo.677.3">Any variable that holds sensitive information that you would like to pass to your pipeline can leverage a secret in Key Vault stored in a variable group. </span><span class="koboSpan" id="kobo.677.4">Azure Key Vault provides you with the flexibility to have unique secure information per AML workspace in your </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">MLOps pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.679.1">The next Azure DevOps component we will set up is the environment for providing approval for the model registration and model deployment in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">qa</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.681.1">AML workspace.</span></span></p>
<h2 id="_idParaDest-118"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.682.1">Creating an Azure DevOps environment</span></h2>
<p><span class="koboSpan" id="kobo.683.1">In this subsection, we will </span><a id="_idIndexMarker622"/><span class="koboSpan" id="kobo.684.1">create an Azure DevOps environment called </span><strong class="source-inline"><span class="koboSpan" id="kobo.685.1">qa</span></strong><span class="koboSpan" id="kobo.686.1"> so we can apply governance to the model deployment in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.687.1">qa</span></strong><span class="koboSpan" id="kobo.688.1"> environment. </span><span class="koboSpan" id="kobo.688.2">An Azure DevOps environment requires approvers. </span><span class="koboSpan" id="kobo.688.3">We will be able to reference this environment in our Azure DevOps pipeline as we progress to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.689.1">qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.690.1"> environment:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.691.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.692.1">Pipeline</span></strong><span class="koboSpan" id="kobo.693.1">s section in the left-hand pane in your Azure DevOps project, select the </span><strong class="bold"><span class="koboSpan" id="kobo.694.1">Environments</span></strong><span class="koboSpan" id="kobo.695.1"> icon, and select </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.696.1">New environment</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.698.1">This will pull up a new popup, as shown in </span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">this screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer345">
<span class="koboSpan" id="kobo.700.1"><img alt="Figure 9.32 – Azure DevOps environment" src="image/B18003_09_032.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.701.1">Figure 9.32 – Azure DevOps environment</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.702.1">For the name, type </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">qa</span></strong><span class="koboSpan" id="kobo.704.1">, leave Resource set to </span><strong class="bold"><span class="koboSpan" id="kobo.705.1">None</span></strong><span class="koboSpan" id="kobo.706.1">, and select the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.707.1">Create </span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">button.</span></span></li>
<li><span class="koboSpan" id="kobo.709.1">On the top-right side of the environment, you will see an </span><strong class="bold"><span class="koboSpan" id="kobo.710.1">Add resource</span></strong><span class="koboSpan" id="kobo.711.1"> button with three dots</span><a id="_idIndexMarker623"/><span class="koboSpan" id="kobo.712.1"> next to it, shown in the following figure. </span><span class="koboSpan" id="kobo.712.2">Click on the </span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">three dots:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer346">
<span class="koboSpan" id="kobo.714.1"><img alt="Figure 9.33 – Add resource" src="image/B18003_09_033.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.715.1">Figure 9.33 – Add resource</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.716.1">Clicking on the three dots, go to </span><strong class="bold"><span class="koboSpan" id="kobo.717.1">Approvals and checks</span></strong><span class="koboSpan" id="kobo.718.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer347">
<span class="koboSpan" id="kobo.720.1"><img alt="Figure 9.34 – Approvals and checks" src="image/B18003_09_034.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.721.1">Figure 9.34 – Approvals and checks</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.722.1">After clicking</span><a id="_idIndexMarker624"/><span class="koboSpan" id="kobo.723.1"> on the </span><strong class="bold"><span class="koboSpan" id="kobo.724.1">Approvals and checks</span></strong><span class="koboSpan" id="kobo.725.1"> option, a new screen will be displayed that will allow you to enter </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">your approvers.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.727.1">A screen will be displayed, </span><strong class="bold"><span class="koboSpan" id="kobo.728.1">Add your first check</span></strong><span class="koboSpan" id="kobo.729.1">, as </span><span class="No-Break"><span class="koboSpan" id="kobo.730.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer348">
<span class="koboSpan" id="kobo.731.1"><img alt="Figure 9.35 – Approvals and checks" src="image/B18003_09_035.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.732.1">Figure 9.35 – Approvals and checks</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.733.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.734.1">Approvals</span></strong><span class="koboSpan" id="kobo.735.1">, which will bring up the </span><strong class="bold"><span class="koboSpan" id="kobo.736.1">Approvals</span></strong><span class="koboSpan" id="kobo.737.1"> configuration </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer349">
<span class="koboSpan" id="kobo.739.1"><img alt="Figure 9.36 – Setting approvers" src="image/B18003_09_036.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.740.1">Figure 9.36 – Setting approvers</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.741.1">Add yourself </span><a id="_idIndexMarker625"/><span class="koboSpan" id="kobo.742.1">to </span><strong class="bold"><span class="koboSpan" id="kobo.743.1">Approvals</span></strong><span class="koboSpan" id="kobo.744.1">, ensure under that </span><strong class="bold"><span class="koboSpan" id="kobo.745.1">Advanced</span></strong><span class="koboSpan" id="kobo.746.1">, you have checked </span><strong class="bold"><span class="koboSpan" id="kobo.747.1">Allow approvers to approve their own runs</span></strong><span class="koboSpan" id="kobo.748.1">, and </span><span class="No-Break"><span class="koboSpan" id="kobo.749.1">select </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.750.1">Create</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.751.1">.</span></span><a id="_idTextAnchor159"/></li>
</ol>
<p><span class="koboSpan" id="kobo.752.1">Now that you have created your Azure DevOps environment, we are ready to create an Azure DevOps </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">service connection.</span></span><a id="_idTextAnchor160"/></p>
<h2 id="_idParaDest-119"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.754.1">Setting your Azure DevOps service connections</span></h2>
<p><span class="koboSpan" id="kobo.755.1">An Azure DevOps </span><a id="_idIndexMarker626"/><span class="koboSpan" id="kobo.756.1">service connection uses a service principal to connect and gain access to run code on your behalf</span><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.757.1">. </span><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.758.1">The service connection will run your Azure DevOps pipeline as the service </span><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.759.1">principal specified in the service connection. </span><span class="koboSpan" id="kobo.759.2">An AML service connection allows you to connect Azure DevOps to your workspace. </span><span class="koboSpan" id="kobo.759.3">This means that we will create two service connections, one for each </span><span class="No-Break"><span class="koboSpan" id="kobo.760.1">AML workspace.</span></span></p>
<p><span class="koboSpan" id="kobo.761.1">There is a special kind of service connection that specifies that it is an ML workspace service connection. </span><span class="koboSpan" id="kobo.761.2">This extension is not required, so if there is an administrator for your Azure DevOps organization, they can provide you with a service principal and not use this extension, but it is ideal, as it indicates what the service principal will be </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">leveraged for.</span></span></p>
<p><span class="koboSpan" id="kobo.763.1">We will begin by installing an AML extension for your Azure DevOps organization. </span><span class="koboSpan" id="kobo.763.2">To install this into your Azure DevOps environment, perform the </span><span class="No-Break"><span class="koboSpan" id="kobo.764.1">following steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.765.1">Navigate to </span><a href="https://marketplace.visualstudio.com/"><span class="koboSpan" id="kobo.766.1">https://marketplace.visualstudio.com/</span></a><span class="koboSpan" id="kobo.767.1">, and select the </span><strong class="bold"><span class="koboSpan" id="kobo.768.1">Azure DevOps</span></strong><span class="koboSpan" id="kobo.769.1"> tab at</span><a id="_idIndexMarker627"/><span class="koboSpan" id="kobo.770.1"> the top. </span><span class="koboSpan" id="kobo.770.2">In the search box, type </span><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">Azure Machine Learning</span></strong><span class="koboSpan" id="kobo.772.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.773.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer350">
<span class="koboSpan" id="kobo.774.1"><img alt="Figure 9.37 – Visual Studio Marketplace" src="image/B18003_09_037.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.775.1">Figure 9.37 – Visual Studio Marketplace</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.776.1">This will bring up the AML Azure DevOps extension shown </span><span class="No-Break"><span class="koboSpan" id="kobo.777.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer351">
<span class="koboSpan" id="kobo.778.1"><img alt="Figure 9.38 – Azure DevOps ML extension" src="image/B18003_09_038.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.779.1">Figure 9.38 – Azure DevOps ML extension</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.780.1">Clicking on the icon shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.781.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.782.1">.38</span></em><span class="koboSpan" id="kobo.783.1"> will bring up detailed information about </span><span class="No-Break"><span class="koboSpan" id="kobo.784.1">the extension.</span></span></li>
<li><span class="koboSpan" id="kobo.785.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.786.1">Get it free</span></strong><span class="koboSpan" id="kobo.787.1"> button to begin the installation process. </span><span class="koboSpan" id="kobo.787.2">This will bring you to the next screen where it is verifying that you have permission to install the extension in your Azure DevOps organization, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.788.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer352">
<span class="koboSpan" id="kobo.789.1"><img alt="Figure 9.39 – Verifying installation permissions" src="image/B18003_09_039.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.790.1">Figure 9.39 – Verifying installation permissions</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.791.1">After the </span><a id="_idIndexMarker628"/><span class="koboSpan" id="kobo.792.1">permissions have been confirmed, you will be prompted to install for your Azure DevOps organization, as </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer353">
<span class="koboSpan" id="kobo.794.1"><img alt="Figure 9.40 – Install option" src="image/B18003_09_040.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.795.1">Figure 9.40 – Install option</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.796.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.797.1">Install</span></strong><span class="koboSpan" id="kobo.798.1"> button and you will be prompted to head over to your Azure DevOps organization now that the extension has been installed, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.799.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer354">
<span class="koboSpan" id="kobo.800.1"><img alt="Figure 9.41 – Installation confirmation" src="image/B18003_09_041.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.801.1">Figure 9.41 – Installation confirmation</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.802.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.803.1">Proceed to organization</span></strong><span class="koboSpan" id="kobo.804.1"> button, as shown in the preceding screenshot. </span><span class="koboSpan" id="kobo.804.2">This will bring you to your Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.805.1">DevOps organization.</span></span></li>
<li><span class="koboSpan" id="kobo.806.1">Then, click on</span><a id="_idIndexMarker629"/><span class="koboSpan" id="kobo.807.1"> your project inside your Azure DevOps organization as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.808.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer355">
<span class="koboSpan" id="kobo.809.1"><img alt="Figure 9.42 – Azure DevOps project" src="image/B18003_09_042.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.810.1">Figure 9.42 – Azure DevOps project</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.811.1">Inside your project, in the left-hand menu, you can see </span><strong class="bold"><span class="koboSpan" id="kobo.812.1">Project settings</span></strong><span class="koboSpan" id="kobo.813.1"> in the menu. </span><span class="koboSpan" id="kobo.813.2">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.814.1">Project </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.815.1">settings</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.816.1"> icon.</span></span></li>
<li><span class="koboSpan" id="kobo.817.1">Clicking on </span><strong class="bold"><span class="koboSpan" id="kobo.818.1">Project settings</span></strong><span class="koboSpan" id="kobo.819.1">, you will see </span><strong class="bold"><span class="koboSpan" id="kobo.820.1">Service Connections</span></strong><span class="koboSpan" id="kobo.821.1"> in the menu. </span><span class="koboSpan" id="kobo.821.2">Click on the icon for </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.822.1">Service Connections</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.823.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.824.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.825.1">Create service connection</span></strong><span class="koboSpan" id="kobo.826.1"> icon on the top left of your screen; this will bring up the </span><strong class="bold"><span class="koboSpan" id="kobo.827.1">New service connection</span></strong><span class="koboSpan" id="kobo.828.1"> window, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.829.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer356">
<span class="koboSpan" id="kobo.830.1"><img alt="Figure 9.43 – New service connection" src="image/B18003_09_043.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.831.1">Figure 9.43 – New service connection</span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.832.1">Click on</span><a id="_idIndexMarker630"/><span class="koboSpan" id="kobo.833.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.834.1">Azure Resource Manager</span></strong><span class="koboSpan" id="kobo.835.1"> option here, scroll to the bottom, and </span><span class="No-Break"><span class="koboSpan" id="kobo.836.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.837.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.838.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.839.1">This will bring up another screen, </span><span class="No-Break"><span class="koboSpan" id="kobo.840.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer357">
<span class="koboSpan" id="kobo.841.1"><img alt="Figure 9.44 – Automatic creation of a service principal" src="image/B18003_09_044.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.842.1">Figure 9.44 – Automatic creation of a service principal</span></p>
<p><span class="koboSpan" id="kobo.843.1">In order to </span><a id="_idIndexMarker631"/><span class="koboSpan" id="kobo.844.1">leverage the </span><strong class="bold"><span class="koboSpan" id="kobo.845.1">Service principal (automatic)</span></strong><span class="koboSpan" id="kobo.846.1"> option, you will be required to have the authorization in your Azure subscription to create </span><strong class="bold"><span class="koboSpan" id="kobo.847.1">Service Principal</span></strong><span class="koboSpan" id="kobo.848.1"> instances. </span><span class="koboSpan" id="kobo.848.2">If you are working in an environment where this option is not authorized, you will be able to request a service principal from your Azure subscription administrator, and they can provide you with the information required to create a service connection manually. </span><span class="koboSpan" id="kobo.848.3">Refer to the </span><span class="No-Break"><span class="koboSpan" id="kobo.849.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer358">
<span class="koboSpan" id="kobo.850.1"><img alt="Figure 9.45 – Service connection information" src="image/B18003_09_045.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.851.1">Figure 9.45 – Service connection information</span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.852.1">Populate the information on the screen as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.853.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.854.1">.45</span></em><span class="koboSpan" id="kobo.855.1">. </span><span class="koboSpan" id="kobo.855.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.856.1">Subscription Id</span></strong><span class="koboSpan" id="kobo.857.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.858.1">Subscription Name</span></strong><span class="koboSpan" id="kobo.859.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.860.1">Resource Group</span></strong><span class="koboSpan" id="kobo.861.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.862.1">ML Workspace Name</span></strong><span class="koboSpan" id="kobo.863.1"> information is all available on the AML resource overview screen shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.864.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.865.1">.11</span></em><span class="koboSpan" id="kobo.866.1">. </span><strong class="bold"><span class="koboSpan" id="kobo.867.1">ML Workspace Location</span></strong><span class="koboSpan" id="kobo.868.1"> is based on where the resource is deployed. </span><span class="koboSpan" id="kobo.868.2">To confirm that you use the right value, a table is available </span><span class="No-Break"><span class="koboSpan" id="kobo.869.1">here: </span></span><a href="https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations"><span class="No-Break"><span class="koboSpan" id="kobo.870.1">https://github.com/microsoft/azure-pipelines-extensions/blob/master/docs/authoring/endpoints/workspace-locations</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.871.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.872.1">Be sure to check </span><strong class="bold"><span class="koboSpan" id="kobo.873.1">Grant access permission to all pipelines</span></strong><span class="koboSpan" id="kobo.874.1"> before hitting </span><strong class="bold"><span class="koboSpan" id="kobo.875.1">save</span></strong><span class="koboSpan" id="kobo.876.1"> on your Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.877.1">service connection.</span></span></p>
<p><span class="koboSpan" id="kobo.878.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.879.1">.yml</span></strong><span class="koboSpan" id="kobo.880.1"> file that</span><a id="_idIndexMarker632"/><span class="koboSpan" id="kobo.881.1"> defines your Azure DevOps pipeline will expect certain values for the service connection. </span><span class="koboSpan" id="kobo.881.2">Create your service connection to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.882.1">dev</span></strong><span class="koboSpan" id="kobo.883.1"> environment as </span><strong class="source-inline"><span class="koboSpan" id="kobo.884.1">aml-dev</span></strong><span class="koboSpan" id="kobo.885.1">, and your service connection to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">qa</span></strong><span class="koboSpan" id="kobo.887.1"> environment </span><span class="No-Break"><span class="koboSpan" id="kobo.888.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.889.1">aml-qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.890.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.891.1">Congratulations – you have set up two service connections, one pointing to your </span><strong class="source-inline"><span class="koboSpan" id="kobo.892.1">dev</span></strong><span class="koboSpan" id="kobo.893.1"> AML workspace, and one pointing to your </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">qa</span></strong><span class="koboSpan" id="kobo.895.1"> AML workspace. </span><span class="koboSpan" id="kobo.895.2">We will continue to the next subsection on creating your Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.896.1">DevOps pipeline.</span></span></p>
<h2 id="_idParaDest-120"><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.897.1">Creating an Azure DevOps pipeline</span></h2>
<p><span class="koboSpan" id="kobo.898.1">To setup your </span><a id="_idIndexMarker633"/><span class="koboSpan" id="kobo.899.1">Azure DevOps pipeline, we are going to generate some code. </span><span class="koboSpan" id="kobo.899.2">Recall that your code is in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.900.1">dev</span></strong><span class="koboSpan" id="kobo.901.1"> AML workspace. </span><span class="koboSpan" id="kobo.901.2">In order to walk you through creating the Azure DevOps pipeline, we have created a sample notebook in </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.902.1">Chapter 09</span></strong></span><span class="koboSpan" id="kobo.903.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.904.1">Chapter 9</span></strong></span><strong class="source-inline"><span class="koboSpan" id="kobo.905.1"> MLOps.ipynb</span></strong><span class="koboSpan" id="kobo.906.1">, shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.907.1">following screenshot.</span></span></p>
<p><span class="koboSpan" id="kobo.908.1">Inside your </span><strong class="source-inline"><span class="koboSpan" id="kobo.909.1">dev</span></strong><span class="koboSpan" id="kobo.910.1"> instance of your AML workspace, you will see the notebook </span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer359">
<span class="koboSpan" id="kobo.912.1"><img alt="Figure 9.46 – Chapter 9 MLOps notebook" src="image/B18003_09_046.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.913.1">Figure 9.46 – Chapter 9 MLOps notebook</span></p>
<p><span class="koboSpan" id="kobo.914.1">Open the notebook and slowly walk yourself through the code, executing each cell and creating the required files for your </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1">MLOps pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.916.1">We start with the notebook by connecting to our AML workspace and ensuring our data is ready to be leveraged by our MLOps pipeline. </span><span class="koboSpan" id="kobo.916.2">Often, demos include the data that you are going to be leveraging as part of the pipeline, but in a real-world pipeline, your data is going to reside somewhere that is not in your MLOps folder, so we will take the data from the folder and register it if it is not </span><span class="No-Break"><span class="koboSpan" id="kobo.917.1">registered already.</span></span></p>
<p><span class="koboSpan" id="kobo.918.1">We are going to create an AML pipeline, to facilitate that, we create separate folders for each of the steps in the pipeline. </span><span class="koboSpan" id="kobo.918.2">We are going to create a step for data preparation, model training, and model evaluation. </span><span class="koboSpan" id="kobo.918.3">We will leverage our Azure DevOps pipeline to handle the deployment, but we will create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.919.1">.yml</span></strong><span class="koboSpan" id="kobo.920.1"> file definition for the AML pipeline, and we also create a folder to hold that pipeline definition, as well as a folder to hold our </span><strong class="source-inline"><span class="koboSpan" id="kobo.921.1">conda</span></strong><span class="koboSpan" id="kobo.922.1"> environment </span><strong class="source-inline"><span class="koboSpan" id="kobo.923.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.924.1">yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.925.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.926.1">We will create a compute cluster for the AML pipeline to leverage. </span><span class="koboSpan" id="kobo.926.2">We could argue that this should have been included in the MLOps pipeline, but this resource will automatically scale up and down as required by our pipelines, so we left this resource outside of the Azure DevOps pipeline – however, you certainly can take this pipeline and extend it to include </span><span class="No-Break"><span class="koboSpan" id="kobo.927.1">this functionality.</span></span></p>
<p><span class="koboSpan" id="kobo.928.1">After creating</span><a id="_idIndexMarker634"/><span class="koboSpan" id="kobo.929.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.930.1">conda</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.931.1">.yml</span></strong><span class="koboSpan" id="kobo.932.1"> file to handle the environment, and a script for each step in the AML pipeline, we stitch the code together in an AML pipeline job, which was covered in </span><a href="B18003_07.xhtml#_idTextAnchor102"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.933.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.934.1">, </span><em class="italic"><span class="koboSpan" id="kobo.935.1">Deploying ML Models for </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.936.1">Batch Scoring</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.937.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.938.1">Here’s the script for creating the environment for the pipeline </span><span class="No-Break"><span class="koboSpan" id="kobo.939.1">to leverage:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer360">
<span class="koboSpan" id="kobo.940.1"><img alt="Figure 9.47 – conda .yml file for the environment information" src="image/B18003_09_047.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.941.1">Figure 9.47 – conda .yml file for the environment information</span></p>
<p><span class="koboSpan" id="kobo.942.1">Review each step in the pipeline and the code in the notebook of this chapter, as it creates an AML job pipeline to create a model and register </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">the model.</span></span></p>
<p><span class="koboSpan" id="kobo.944.1">Note that the first step will expect the raw data parameter that will tell the code where to find the </span><strong class="source-inline"><span class="koboSpan" id="kobo.945.1">titanic.csv</span></strong><span class="koboSpan" id="kobo.946.1"> file. </span><span class="koboSpan" id="kobo.946.2">In addition to the source location, the pipeline definition indicates where the data will be stored. </span><span class="koboSpan" id="kobo.946.3">This script is quite helpful in providing a generic solution for your pipeline to leverage data. </span><span class="koboSpan" id="kobo.946.4">Each step within the AML pipeline has a set of defined input and output parameters that are captured within the pipeline definition </span><strong class="source-inline"><span class="koboSpan" id="kobo.947.1">.yml</span></strong><span class="koboSpan" id="kobo.948.1"> file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.949.1">aml_train_and_eval_pipeline.yml</span></strong><span class="koboSpan" id="kobo.950.1">, which the notebook generates in the pipeline directory under </span><strong class="source-inline"><span class="koboSpan" id="kobo.951.1">src</span></strong><span class="koboSpan" id="kobo.952.1"> in the chapter folder directory. </span><span class="koboSpan" id="kobo.952.2">Reviewing this code, you can see</span><a id="_idIndexMarker635"/><span class="koboSpan" id="kobo.953.1"> how the inputs and outputs in the script are specified in the </span><span class="No-Break"><span class="koboSpan" id="kobo.954.1">pipe definition:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer361">
<span class="koboSpan" id="kobo.955.1"><img alt="Figure 9.48 – AML pipeline definition" src="image/B18003_09_048.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.956.1">Figure 9.48 – AML pipeline definition</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.957.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.958.1">Pipeline job definitions include great flexibility. </span><span class="koboSpan" id="kobo.958.2">The schema for defining a job can be reviewed </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">here: </span></span><a href="https://azuremlschemas.azureedge.net/latest/commandJob.schema.json"><span class="No-Break"><span class="koboSpan" id="kobo.960.1">https://azuremlschemas.azureedge.net/latest/commandJob.schema.json</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.961.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.962.1">In the pipeline definition here, we have specified the type for the prep job as </span><strong class="source-inline"><span class="koboSpan" id="kobo.963.1">command</span></strong><span class="koboSpan" id="kobo.964.1"> as per the schema def</span><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.965.1">inition. </span><span class="koboSpan" id="kobo.965.2">W</span><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.966.1">e have specified where the code can be found for the step. </span><span class="koboSpan" id="kobo.966.2">F</span><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.967.1">or the command itself, we specify to run Python and provide the file and the parameters that will be passed to the Python script from our defined inputs and outputs. </span><span class="koboSpan" id="kobo.967.2">W</span><a id="_idTextAnchor169"/><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.968.1">e can see that the input was defined as </span><strong class="source-inline"><span class="koboSpan" id="kobo.969.1">ro_mount</span></strong><span class="koboSpan" id="kobo.970.1">, or a read-only mount to the specified file, and the output was defined as </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">rw_mount</span></strong><span class="koboSpan" id="kobo.972.1">, or a read-write mount with a specified file location. </span><span class="koboSpan" id="kobo.972.2">I</span><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.973.1">n add</span><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.974.1">ition, the env</span><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.975.1">ironment was specified as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">conda</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.977.1">.yml</span></strong><span class="koboSpan" id="kobo.978.1"> file generated, and an Ubuntu image is </span><span class="No-Break"><span class="koboSpan" id="kobo.979.1">also specified.</span></span></p>
<p><span class="koboSpan" id="kobo.980.1">This ini</span><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.981.1">tial </span><strong class="source-inline"><span class="koboSpan" id="kobo.982.1">prep_job</span></strong><span class="koboSpan" id="kobo.983.1"> combined with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.984.1">train_job</span></strong><span class="koboSpan" id="kobo.985.1"> and an </span><strong class="source-inline"><span class="koboSpan" id="kobo.986.1">eval_job</span></strong><span class="koboSpan" id="kobo.987.1"> make up the </span><span class="No-Break"><span class="koboSpan" id="kobo.988.1">AML pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.989.1">Now that we have reviewed the AML pipeline, we will look at the files required for the model deployment in both the </span><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">dev</span></strong><span class="koboSpan" id="kobo.991.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.992.1">qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.993.1"> environments.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.994.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.995.1">Managed online endpoint names must be unique in </span><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.996.1">each </span><span class="No-Break"><span class="koboSpan" id="kobo.997.1">Azure region.</span></span></p>
<p><span class="koboSpan" id="kobo.998.1">In addition to the</span><a id="_idIndexMarker636"/><span class="koboSpan" id="kobo.999.1"> AML pipeline definition, the notebook also generates files for handling the managed online endpoint deployment. </span><span class="koboSpan" id="kobo.999.2">When running the notebook, be sure to update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">name</span></strong><span class="koboSpan" id="kobo.1001.1"> value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">create-endpoint.yml</span></strong><span class="koboSpan" id="kobo.1003.1"> and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1004.1">name</span></strong><span class="koboSpan" id="kobo.1005.1"> value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1006.1">create-endpoint-dev.yml</span></strong><span class="koboSpan" id="kobo.1007.1">; in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1008.1">model_deployment.yml</span></strong><span class="koboSpan" id="kobo.1009.1">, provide the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1010.1">endpoint_name</span></strong><span class="koboSpan" id="kobo.1011.1"> value as the one you specified in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1012.1">create-endpoint.yml</span></strong><span class="koboSpan" id="kobo.1013.1">; and in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1014.1">model_deployment-dev.yml</span></strong><span class="koboSpan" id="kobo.1015.1">, provide the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1016.1">endpoint_name</span></strong><span class="koboSpan" id="kobo.1017.1"> value you specified in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1018.1">create-endpoint-dev.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1019.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.1020.1">Here is a screenshot of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1021.1">create-endpoint-dev.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1022.1"> file:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer362">
<span class="koboSpan" id="kobo.1023.1"><img alt="Figure 9.49 – dev AML workspace managed online endpoint .yml file" src="image/B18003_09_049.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1024.1">Figure 9.49 – dev AML workspace managed online endpoint .yml file</span></p>
<p><span class="koboSpan" id="kobo.1025.1">This file shown here provides the name and authorization mode that your managed online endpoint will leverage during deployment in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1026.1">dev</span></strong><span class="koboSpan" id="kobo.1027.1"> environment. </span><span class="koboSpan" id="kobo.1027.2">Be sure to update </span><strong class="bold"><span class="koboSpan" id="kobo.1028.1">line 3</span></strong><span class="koboSpan" id="kobo.1029.1">, as the name must be unique in the Azure region into which the AML workspace </span><span class="No-Break"><span class="koboSpan" id="kobo.1030.1">is deployed.</span></span></p>
<p><span class="koboSpan" id="kobo.1031.1">The following is a screenshot of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1032.1">model_deployment-dev.yml</span></strong><span class="koboSpan" id="kobo.1033.1"> file used for the deployment to the managed online endpoint. </span><span class="koboSpan" id="kobo.1033.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1">endpoint_name</span></strong><span class="koboSpan" id="kobo.1035.1"> value here should match the name specified for the managed </span><span class="No-Break"><span class="koboSpan" id="kobo.1036.1">online endpoint:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer363">
<span class="koboSpan" id="kobo.1037.1"><img alt="Figure 9.50 – dev AML workspace deployment to the managed online endpoint yml file" src="image/B18003_09_050.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1038.1">Figure 9.50 – dev AML workspace deployment to the managed online endpoint yml file</span></p>
<p><span class="koboSpan" id="kobo.1039.1">Just as the names should match for the managed online deployment in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1040.1">dev</span></strong><span class="koboSpan" id="kobo.1041.1"> environment, they also need to match up in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1042.1">qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1043.1"> environment.</span></span></p>
<p><span class="koboSpan" id="kobo.1044.1">Here is a screenshot of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1">create-endpoint.yml</span></strong><span class="koboSpan" id="kobo.1046.1"> file. </span><span class="koboSpan" id="kobo.1046.2">This is the file used to create the managed online endpoint deployment in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1047.1">qa</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1048.1">AML workspace:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer364">
<span class="koboSpan" id="kobo.1049.1"><img alt="Figure 9.51 – qa AML workspace Managed Online Endpoint .yml file" src="image/B18003_09_051.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1050.1">Figure 9.51 – qa AML workspace Managed Online Endpoint .yml file</span></p>
<p><span class="koboSpan" id="kobo.1051.1">As shown in the </span><a id="_idIndexMarker637"/><span class="koboSpan" id="kobo.1052.1">figure here, </span><strong class="bold"><span class="koboSpan" id="kobo.1053.1">line 3</span></strong><span class="koboSpan" id="kobo.1054.1"> includes the name of the endpoint, which must be unique in a given Azure region. </span><span class="koboSpan" id="kobo.1054.2">Be sure to select a unique name for your endpoints in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1055.1">qa</span></strong><span class="koboSpan" id="kobo.1056.1"> environment and the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1057.1">dev</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1058.1"> environment.</span></span></p>
<p><span class="koboSpan" id="kobo.1059.1">Here is a screenshot of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1060.1">model_deployment.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1061.1"> file:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer365">
<span class="koboSpan" id="kobo.1062.1"><img alt="Figure 9.52 – qa AML workspace deployment to managed online endpoint yml file" src="image/B18003_09_052.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1063.1">Figure 9.52 – qa AML workspace deployment to managed online endpoint yml file</span></p>
<p><span class="koboSpan" id="kobo.1064.1">As shown in the figure here, this file will be leveraged for online deployment in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1065.1">qa</span></strong><span class="koboSpan" id="kobo.1066.1"> environment, and it will go to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1067.1">endpoint_name</span></strong><span class="koboSpan" id="kobo.1068.1"> to create a deployment, so be sure to update </span><strong class="bold"><span class="koboSpan" id="kobo.1069.1">line 4</span></strong><span class="koboSpan" id="kobo.1070.1"> in this file to match up with </span><strong class="bold"><span class="koboSpan" id="kobo.1071.1">line 3</span></strong><span class="koboSpan" id="kobo.1072.1"> in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">create-endpoint.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1074.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.1075.1">These files are leveraged within the Azure DevOps pipeline definition, which we will </span><span class="No-Break"><span class="koboSpan" id="kobo.1076.1">discuss next.</span></span></p>
<p><span class="koboSpan" id="kobo.1077.1">The following is a snippet of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1">AzureDevOpsPipeline.yml</span></strong><span class="koboSpan" id="kobo.1079.1"> file that orchestrates the </span><span class="No-Break"><span class="koboSpan" id="kobo.1080.1">MLOps pipeline:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer366">
<span class="koboSpan" id="kobo.1081.1"><img alt="Figure 9.53 – Azure DevOpsPipeline.yml file definition" src="image/B18003_09_053.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1082.1">Figure 9.53 – Azure DevOpsPipeline.yml file definition</span></p>
<p><span class="koboSpan" id="kobo.1083.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1084.1">AzureDevOpsPipeline.yml</span></strong><span class="koboSpan" id="kobo.1085.1"> file starts by specifying the image that an Azure DevOps build agent will</span><a id="_idIndexMarker638"/><span class="koboSpan" id="kobo.1086.1"> leverage. </span><span class="koboSpan" id="kobo.1086.2">The pipeline will trigger when there is a code change to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1087.1">main</span></strong><span class="koboSpan" id="kobo.1088.1">. </span><span class="koboSpan" id="kobo.1088.2">The pipeline is leveraging both </span><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1">devops-variable-group-dev</span></strong><span class="koboSpan" id="kobo.1090.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1091.1">devops-variable-group-qa</span></strong><span class="koboSpan" id="kobo.1092.1">, which we set </span><span class="No-Break"><span class="koboSpan" id="kobo.1093.1">up earlier.</span></span></p>
<p><span class="koboSpan" id="kobo.1094.1">In this </span><strong class="source-inline"><span class="koboSpan" id="kobo.1095.1">.yml</span></strong><span class="koboSpan" id="kobo.1096.1"> file, be sure to update the value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.1097.1">ENDPT_NAME</span></strong><span class="koboSpan" id="kobo.1098.1"> to be the value you specified in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1">create-endpoint.yml</span></strong><span class="koboSpan" id="kobo.1100.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1101.1">endpoint_name</span></strong><span class="koboSpan" id="kobo.1102.1"> in your </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1103.1">model_deployment.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1104.1"> files.</span></span></p>
<p><span class="koboSpan" id="kobo.1105.1">Be sure to also update </span><strong class="source-inline"><span class="koboSpan" id="kobo.1106.1">DEV_ENDPT_NAME</span></strong><span class="koboSpan" id="kobo.1107.1"> to be the value for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1108.1">name</span></strong><span class="koboSpan" id="kobo.1109.1"> variable you specified in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1110.1">create-endpoint-dev.yml</span></strong><span class="koboSpan" id="kobo.1111.1"> file and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1112.1">endpoint_name</span></strong> <span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1113.1">model_deployment-dev.yml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1114.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.1115.1">The code here shows that in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1116.1">AzureDevOpsPipeline.yml</span></strong><span class="koboSpan" id="kobo.1117.1"> file, the values that will need to be replaced for your </span><span class="No-Break"><span class="koboSpan" id="kobo.1118.1">MLOps deployment:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer367">
<span class="koboSpan" id="kobo.1119.1"><img alt="Figure 9.54 – Azure DevOps pipeline variable replacement" src="image/B18003_09_054.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1120.1">Figure 9.54 – Azure DevOps pipeline variable replacement</span></p>
<p><span class="koboSpan" id="kobo.1121.1">The DevOps pipeline is broken into two stages – one stage for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1122.1">dev</span></strong><span class="koboSpan" id="kobo.1123.1"> environment pipeline run and model deployment in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1124.1">dev</span></strong><span class="koboSpan" id="kobo.1125.1"> environment, and the second stage for the model promotion and deployment into the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1126.1">qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1127.1"> environment.</span></span></p>
<p><span class="koboSpan" id="kobo.1128.1">Inside the Azure </span><a id="_idIndexMarker639"/><span class="koboSpan" id="kobo.1129.1">DevOps stages, we leverage a set of jobs, which are CLI tasks that leverage v2 of the AML CLI for retrieving the initial model version in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1130.1">dev</span></strong><span class="koboSpan" id="kobo.1131.1"> environment, running the AML pipeline, and then retrieving the final model version. </span><span class="koboSpan" id="kobo.1131.2">This final model version indicates whether a model should be registered in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1132.1">qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1133.1"> environment:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1134.1">
az ml model list -w $(wsName) -g $(resourceGroup) -n $(model_name) --query "[0].version" -o tsv</span></pre>
<p><span class="koboSpan" id="kobo.1135.1">The preceding code is retrieved from the first stage and the first step within your Azure DevOps pipeline. </span><span class="koboSpan" id="kobo.1135.2">Running this with Azure DevOps, we will retrieve the latest version of the model with the model name specified by the variable that is defined in your Azure DevOps pipeline as shown in the figure here. </span><span class="koboSpan" id="kobo.1135.3">As you can see in the code, not only do we leverage the variable groups but we can also leverage variables defined directly in an Azure DevOps pipeline, as is the case with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1136.1">model_name</span></strong><span class="koboSpan" id="kobo.1137.1"> variable. </span><span class="koboSpan" id="kobo.1137.2">Given this value does not change on the basis of the environment, we have added it to the pipeline definition itself, but we could have included it in the key vaults and retrieved it through our Azure DevOps variable groups </span><span class="No-Break"><span class="koboSpan" id="kobo.1138.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.1139.1">The command run in Azure DevOps is modified slightly when placed into the Azure DevOps pipeline </span><strong class="source-inline"><span class="koboSpan" id="kobo.1140.1">yml</span></strong><span class="koboSpan" id="kobo.1141.1"> file, shown </span><span class="No-Break"><span class="koboSpan" id="kobo.1142.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer368">
<span class="koboSpan" id="kobo.1143.1"><img alt="Figure 9.55 – Checking whether the model exists" src="image/B18003_09_055.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1144.1">Figure 9.55 – Checking whether the model exists</span></p>
<p><span class="koboSpan" id="kobo.1145.1">Inside our Azure CLI</span><a id="_idIndexMarker640"/><span class="koboSpan" id="kobo.1146.1"> task in the Azure DevOps pipeline, we are checking whether the result of querying for the model in the workspace comes back as an empty string, and then we set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1">modelversion</span></strong><span class="koboSpan" id="kobo.1148.1"> variable to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1149.1">0</span></strong><span class="koboSpan" id="kobo.1150.1">; otherwise, we retrieve it and set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1151.1">modeldeversion</span></strong><span class="koboSpan" id="kobo.1152.1"> variable in the Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.1153.1">DevOps pipeline.</span></span></p>
<p><span class="koboSpan" id="kobo.1154.1">This will place the model version into an Azure DevOps variable that can be evaluated later in the pipeline, by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.1155.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1156.1">
echo 'initial model version'$(setversion.modelversion)</span></pre>
<p><span class="koboSpan" id="kobo.1157.1">After setting the initial model version, we run the AML workspace pipeline from the Azure DevOps pipeline by leveraging the </span><span class="No-Break"><span class="koboSpan" id="kobo.1158.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1159.1">
az ml job create --file 'Chapter09/src/pipeline/aml_train_and_eval_pipeline.yml' --stream --set settings.force_rerun=True</span></pre>
<p><span class="koboSpan" id="kobo.1160.1">Note that we set </span><strong class="source-inline"><span class="koboSpan" id="kobo.1161.1">force_rerun</span></strong><span class="koboSpan" id="kobo.1162.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1163.1">True</span></strong><span class="koboSpan" id="kobo.1164.1"> here. </span><span class="koboSpan" id="kobo.1164.2">AML knows the data has not changed, and if the code has not changed, then it reuses steps instead of rerunning them, which is great in a production workload. </span><span class="koboSpan" id="kobo.1164.3">However, in a demo for updating a model, we would like to see the model version consistently updating, so we have set that value </span><span class="No-Break"><span class="koboSpan" id="kobo.1165.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1166.1">True</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1167.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1168.1">In the first stage, we check whether the final model version and the initial model version are equal</span><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.1169.1"> or not. </span><span class="koboSpan" id="kobo.1169.2">The code here depicts checking the model version and setting an output variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1170.1">runme</span></strong><span class="koboSpan" id="kobo.1171.1">, to either </span><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">true</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1173.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1174.1">false</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1175.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer369">
<span class="koboSpan" id="kobo.1176.1"><img alt="Figure 9.56 – Checking the model version" src="image/B18003_09_056.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1177.1">Figure 9.56 – Checking the model version</span></p>
<p><span class="koboSpan" id="kobo.1178.1">If they are different, then we would like to deploy the new model in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1179.1">dev</span></strong><span class="koboSpan" id="kobo.1180.1"> environment, and we deploy the model with the AML </span><span class="No-Break"><span class="koboSpan" id="kobo.1181.1">CLI command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1182.1">
az ml online-endpoint create --file 'Chapter09/src/deploy/create-endpoint-dev.yml' -g $(resourceGroup) -w $(wsName) -n $(DEV_ENDPT_NAME)</span></pre>
<p><span class="koboSpan" id="kobo.1183.1">In the code here, we reference the endpoint </span><strong class="source-inline"><span class="koboSpan" id="kobo.1184.1">.yml</span></strong><span class="koboSpan" id="kobo.1185.1"> file, the resource group, the workspace name, and the endpoint name. </span><span class="koboSpan" id="kobo.1185.2">Afte</span><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.1186.1">r the endpoint is created, we can cr</span><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.1187.1">eate an online deployment, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1188.1">shown here:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1189.1">
az ml online-deployment create --name $NEW_DEPLOYMENT_NAME -f 'Chapter09/src/deploy/model_deployment-dev.yml' -g $(resourceGroup) -w $(wsName)</span></pre>
<p><span class="koboSpan" id="kobo.1190.1">Finally, we can update the traffic to the endpoint to be 100% by leveraging the </span><span class="No-Break"><span class="koboSpan" id="kobo.1191.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1192.1">
az ml online-endpoint update -n $DEV_ENDPT_NAME --set tags.prod=$NEW_DEPLOYMENT_NAME  --traffic "$NEW_DEPLOYMENT_NAME=100" -g $(resourceGroup) -w $(wsName)</span></pre>
<p><span class="koboSpan" id="kobo.1193.1">Note that we are tagging the endpoint with the deployment. </span><span class="koboSpan" id="kobo.1193.2">By tagging the endpoint, we can quickly see which deployment is being used by our endpoint. </span><span class="koboSpan" id="kobo.1193.3">This</span><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.1194.1"> means the next time a new model is registered, we can create a new deployment to an existing managed online </span><a id="_idIndexMarker641"/><span class="koboSpan" id="kobo.1195.1">endpoint, ramp up its traffic, and then delete the </span><span class="No-Break"><span class="koboSpan" id="kobo.1196.1">old deployment.</span></span></p>
<p><span class="koboSpan" id="kobo.1197.1">In the Azure DevOps pipeline, before handling the deployment, we check whether an endpoint already exists with our specified name by leveraging </span><span class="No-Break"><span class="koboSpan" id="kobo.1198.1">this command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1199.1">
ENDPOINT_EXISTS=$(az ml online-endpoint list -g $(resourceGroup) -w $(wsName) -o tsv --query "[?name=='$DEV_ENDPT_NAME'][name]" |  wc -l)</span></pre>
<p><span class="koboSpan" id="kobo.1200.1">Therefore, the second time, the endpoint will exist, and we will not create an endpoint, but we wi</span><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.1201.1">ll still deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.1202.1">an endpoint.</span></span></p>
<p><span class="koboSpan" id="kobo.1203.1">The second stage in the pipeline is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1204.1">QAPromoteModel</span></strong><span class="koboSpan" id="kobo.1205.1"> pipeline. </span><span class="koboSpan" id="kobo.1205.2">It connects to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1206.1">dev</span></strong><span class="koboSpan" id="kobo.1207.1"> AML workspace and retrieves the model, downloads it, and then uses it in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1208.1">qa</span></strong><span class="koboSpan" id="kobo.1209.1"> environment. </span><span class="koboSpan" id="kobo.1209.2">Once the model is downloaded onto the Azure DevOps build agent, we can register that in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1210.1">qa</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1211.1">AML workspace:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1212.1">
az ml model create --name $(model_name) -v $(vardevModelVersion) --path ./$(model_name)/$(model_name) --type mlflow_model -g $(resourceGroup) -w $(wsName)</span></pre>
<p><span class="koboSpan" id="kobo.1213.1">Once the model is</span><a id="_idIndexMarker642"/><span class="koboSpan" id="kobo.1214.1"> registered in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1215.1">qa</span></strong><span class="koboSpan" id="kobo.1216.1"> environment, we can check whether a managed online endpoint exists in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1217.1">qa</span></strong><span class="koboSpan" id="kobo.1218.1"> environment. </span><span class="koboSpan" id="kobo.1218.2">If it has not yet been deployed, an online endpoint will be created leveraging the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1219.1">create-endpoint.yml</span></strong><span class="koboSpan" id="kobo.1220.1"> file through the use of the AML CLI v2 as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1221.1">following code:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1222.1">
az ml online-endpoint create --file '$(Pipeline.Workspace)/drop/Chapter09/src/deploy/create-endpoint.yml' -g $(resourceGroup) -w $(wsName)</span></pre>
<p><span class="koboSpan" id="kobo.1223.1">If this managed online endpoint does exist, then we will then use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1224.1">az ml online-deployment</span></strong><span class="koboSpan" id="kobo.1225.1"> to create a deployment in the managed online endpoint to leverage the model. </span><span class="koboSpan" id="kobo.1225.2">After it is deployed, we can set the traffic on the managed online endpoint deployment to 100% traffic for our </span><span class="No-Break"><span class="koboSpan" id="kobo.1226.1">new deployment.</span></span></p>
<p><span class="koboSpan" id="kobo.1227.1">If the model has already been deployed in this environment, there is no need to deploy the managed online endpoint, but we will want to swap from the previous deployment to our new deployment. </span><span class="koboSpan" id="kobo.1227.2">This means we should create a new online deployment, and update a tag on the managed online endpoint that specifies which deployment is being used. </span><span class="koboSpan" id="kobo.1227.3">This allows us to consistently create new deployments and swap from the previous online deployment to our next deployment, updating the traffic and then deleting the old deployment in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1228.1">qa</span></strong><span class="koboSpan" id="kobo.1229.1"> environment, as was done in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1230.1">dev</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1231.1"> environment.</span></span></p>
<p><span class="koboSpan" id="kobo.1232.1">Once you run your pipelines, you will be able to see the tag information for your managed online endpoint in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1233.1">dev</span></strong><span class="koboSpan" id="kobo.1234.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1235.1">qa</span></strong><span class="koboSpan" id="kobo.1236.1"> environment from its details as shown in </span><span class="No-Break"><span class="koboSpan" id="kobo.1237.1">this figure.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer370">
<span class="koboSpan" id="kobo.1238.1"><img alt="Figure 9.57 – Managed online endpoint tag" src="image/B18003_09_057.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1239.1">Figure 9.57 – Managed online endpoint tag</span></p>
<p><span class="koboSpan" id="kobo.1240.1">Each time this code runs, a new deployment name is generated, leveraging the epoch of the deployment time. </span><span class="koboSpan" id="kobo.1240.2">This ensures that we have a unique name for a given deployment. </span><span class="koboSpan" id="kobo.1240.3">Having this unique name ensures no conflicts will occur when deploying your online deployment. </span><span class="koboSpan" id="kobo.1240.4">After the online deployment succeeds, we update the traffic to the latest online deployment, and then delete the old online deployment. </span><span class="koboSpan" id="kobo.1240.5">This figure shows a deployment to a </span><a id="_idIndexMarker643"/><span class="koboSpan" id="kobo.1241.1">managed </span><span class="No-Break"><span class="koboSpan" id="kobo.1242.1">online endpoint:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer371">
<span class="koboSpan" id="kobo.1243.1"><img alt="Figure 9.58 – Deployment to a managed online endpoint" src="image/B18003_09_058.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1244.1">Figure 9.58 – Deployment to a managed online endpoint</span></p>
<p><span class="koboSpan" id="kobo.1245.1">Note that in the figure, in the name after deployment, we include the model version number before </span><strong class="bold"><span class="koboSpan" id="kobo.1246.1">v</span></strong><span class="koboSpan" id="kobo.1247.1"> to quickly identify the model version for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1248.1">given deployment.</span></span></p>
<p><span class="koboSpan" id="kobo.1249.1">Now that you have reviewed the code and executed the notebook, generating the files needed for the Azure DevOps pipeline, a check-in of your code to the remote origin now pointing to your Azure DevOps repository will ensure the proper files are in place to create your Azure DevOps pipeline, which is our next step in the process. </span><span class="koboSpan" id="kobo.1249.2">To ch</span><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.1250.1">eck this code in, you can run the </span><span class="No-Break"><span class="koboSpan" id="kobo.1251.1">following commands:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1252.1">
git status
git add –A
git commit –m "updated"
git push origin main</span></pre>
<p><span class="koboSpan" id="kobo.1253.1">Congratulations – your Azure DevOps environment is now linked with your AML workspaces. </span><span class="koboSpan" id="kobo.1253.2">You</span><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.1254.1"> have made it through the required steps for preparing your MLOps environment. </span><span class="koboSpan" id="kobo.1254.2">You</span><a id="_idTextAnchor183"/><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.1255.1"> created an Azure DevOps organization and project. </span><span class="koboSpan" id="kobo.1255.2">You</span><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.1256.1"> moved your code into Azure DevOps, set up your Azure key vault, and linked it to your Azure DevOps variable groups. </span><span class="koboSpan" id="kobo.1256.2">You</span><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.1257.1"> also created an Azure DevOps environment to handle the approval process. </span><span class="koboSpan" id="kobo.1257.2">You</span><a id="_idTextAnchor187"/> <a id="_idIndexMarker644"/><span class="koboSpan" id="kobo.1258.1">created your Azure DevOps service connections and, finally, committed the code required to create and run an Azure DevOps pipeline. </span><span class="koboSpan" id="kobo.1258.2">In</span><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.1259.1"> the next section, you will set up your Azure DevOps pipeline, which will trigger running an Azure </span><span class="No-Break"><span class="koboSpan" id="kobo.1260.1">DevOps pipeline.</span></span></p>
<h1 id="_idParaDest-121"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.1261.1">Running an Azure DevOps pipeline</span></h1>
<p><span class="koboSpan" id="kobo.1262.1">We will start this section</span><a id="_idIndexMarker645"/><span class="koboSpan" id="kobo.1263.1"> by creating an Azure DevOps pipeline. </span><span class="koboSpan" id="kobo.1263.2">Your Azure DevOps pipeline will be kicked off any time you make a change to your code and push it to the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1264.1">main</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1265.1"> branch:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.1266.1">Inside Azure DevOps on the left-hand pane, select </span><strong class="bold"><span class="koboSpan" id="kobo.1267.1">Pipelines</span></strong><span class="koboSpan" id="kobo.1268.1"> and you will see the </span><span class="No-Break"><span class="koboSpan" id="kobo.1269.1">following screen:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer372">
<span class="koboSpan" id="kobo.1270.1"><img alt="Figure 9.59 – Creating your first Azure DevOps Pipeline" src="image/B18003_09_059.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1271.1">Figure 9.59 – Creating your first Azure DevOps Pipeline</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1272.1">Click on </span><a id="_idIndexMarker646"/><span class="koboSpan" id="kobo.1273.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.1274.1">Create Pipeline</span></strong><span class="koboSpan" id="kobo.1275.1"> button to begin the process, which will bring up the </span><span class="No-Break"><span class="koboSpan" id="kobo.1276.1">following window:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer373">
<span class="koboSpan" id="kobo.1277.1"><img alt="Figure 9.60 – Selecting where your code is located" src="image/B18003_09_060.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1278.1">Figure 9.60 – Selecting where your code is located</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.1279.1">In the </span><a id="_idIndexMarker647"/><span class="koboSpan" id="kobo.1280.1">previous section, </span><em class="italic"><span class="koboSpan" id="kobo.1281.1">Preparing your MLOps environment</span></em><span class="koboSpan" id="kobo.1282.1">, you placed your code into a code repository in Azure DevOps. </span><span class="koboSpan" id="kobo.1282.2">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.1283.1">Azure Repos Git</span></strong><span class="koboSpan" id="kobo.1284.1"> option from the preceding screenshot and this will ask you to select your repository, as shown in the following screenshot. </span><span class="koboSpan" id="kobo.1284.2">Select your </span><strong class="bold"><span class="koboSpan" id="kobo.1285.1">mlops</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1286.1">repository here.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer374">
<span class="koboSpan" id="kobo.1287.1"><img alt="Figure 9.61 – Selecting your repository" src="image/B18003_09_061.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1288.1">Figure 9.61 – Selecting your repository</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.1289.1">Next, select</span><a id="_idIndexMarker648"/><span class="koboSpan" id="kobo.1290.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.1291.1">Existing Azure Pipelines YAML file</span></strong><span class="koboSpan" id="kobo.1292.1"> option to use the pipeline you created by running your notebook and checking it into your </span><span class="No-Break"><span class="koboSpan" id="kobo.1293.1">Git repository:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer375">
<span class="koboSpan" id="kobo.1294.1"><img alt="Figure 9.62 – Configure your pipeline" src="image/B18003_09_062.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1295.1">Figure 9.62 – Configure your pipeline</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1296.1">Selecting this will take you to the next screen, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer376">
<span class="koboSpan" id="kobo.1298.1"><img alt="Figure 9.63 – Selecting your YAML file" src="image/B18003_09_063.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1299.1">Figure 9.63 – Selecting your YAML file</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.1300.1">In the </span><strong class="bold"><span class="koboSpan" id="kobo.1301.1">Path</span></strong><span class="koboSpan" id="kobo.1302.1"> dropdown, navigate </span><a id="_idIndexMarker649"/><span class="koboSpan" id="kobo.1303.1">to the </span><strong class="bold"><span class="koboSpan" id="kobo.1304.1">/Chapter09/src/AzureDevOpsPipeline.yml</span></strong><span class="koboSpan" id="kobo.1305.1"> file as </span><span class="No-Break"><span class="koboSpan" id="kobo.1306.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer377">
<span class="koboSpan" id="kobo.1307.1"><img alt="Figure 9.64 – Retrieving the path of AzureDevOpsPipeline.yml file" src="image/B18003_09_064.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1308.1">Figure 9.64 – Retrieving the path of AzureDevOpsPipeline.yml file</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.1309.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1310.1">Continue</span></strong><span class="koboSpan" id="kobo.1311.1"> option after selecting the </span><strong class="bold"><span class="koboSpan" id="kobo.1312.1">AzureDevOpsPipeline.yml</span></strong><span class="koboSpan" id="kobo.1313.1"> file. </span><span class="koboSpan" id="kobo.1313.2">This will bring up the source code for the Azure DevOps pipeline, </span><span class="No-Break"><span class="koboSpan" id="kobo.1314.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer378">
<span class="koboSpan" id="kobo.1315.1"><img alt="Figure 9.65 – Retrieving your YAML" src="image/B18003_09_065.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1316.1">Figure 9.65 – Retrieving your YAML</span></p>
<p><span class="koboSpan" id="kobo.1317.1">In the preceding screenshot, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1318.1">Run</span></strong><span class="koboSpan" id="kobo.1319.1"> button. </span><span class="koboSpan" id="kobo.1319.2">When this pipeline runs, it will leverage your service connections. </span><span class="koboSpan" id="kobo.1319.3">To use</span><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.1320.1"> your service connections, you will need to provide</span><a id="_idIndexMarker650"/><span class="koboSpan" id="kobo.1321.1"> permission for them </span><span class="No-Break"><span class="koboSpan" id="kobo.1322.1">to run.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.1323.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1324.1">View</span></strong><span class="koboSpan" id="kobo.1325.1"> option to provide permission for the first stage to leverage the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1326.1">aml-dev</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1327.1">service connection:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer379">
<span class="koboSpan" id="kobo.1328.1"><img alt="Figure 9.66 – Providing Azure DevOps with permission" src="image/B18003_09_066.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1329.1">Figure 9.66 – Providing Azure DevOps with permission</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.1330.1">After clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.1331.1">View</span></strong><span class="koboSpan" id="kobo.1332.1"> option, you will provide permission for the pipeline to run. </span><span class="koboSpan" id="kobo.1332.2">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1333.1">Permit</span></strong><span class="koboSpan" id="kobo.1334.1"> button, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1335.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer380">
<span class="koboSpan" id="kobo.1336.1"><img alt="Figure 9.67 – Permitting the pipeline to use the service connection" src="image/B18003_09_067.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1337.1">Figure 9.67 – Permitting the pipeline to use the service connection</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.1338.1">Provide the appropriate permissions so the pipeline can execute by selecting </span><strong class="bold"><span class="koboSpan" id="kobo.1339.1">Permit</span></strong><span class="koboSpan" id="kobo.1340.1"> for each of the permissions needed as the </span><span class="No-Break"><span class="koboSpan" id="kobo.1341.1">pipeline progresses.</span></span></li>
<li><span class="koboSpan" id="kobo.1342.1">As the pipeline executes, you</span><a id="_idIndexMarker651"/><span class="koboSpan" id="kobo.1343.1"> can see the icons displaying that the workload is progressing, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1344.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer381">
<span class="koboSpan" id="kobo.1345.1"><img alt="Figure 9.68 – Pipeline execution" src="image/B18003_09_068.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1346.1">Figure 9.68 – Pipeline execution</span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.1347.1">Clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.1348.1">DevTrainingPipeline</span></strong><span class="koboSpan" id="kobo.1349.1"> stage will bring you to the details of the run, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1350.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer382">
<span class="koboSpan" id="kobo.1351.1"><img alt="Figure 9.69 – Pipeline details" src="image/B18003_09_069.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1352.1">Figure 9.69 – Pipeline details</span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.1353.1">As the initial</span><a id="_idIndexMarker652"/><span class="koboSpan" id="kobo.1354.1"> pipeline kicks off, the model named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1355.1">mmchapter9titanic</span></strong><span class="koboSpan" id="kobo.1356.1"> may not exist yet, depending on whether you ran the pipeline from your AML workspace. </span><span class="koboSpan" id="kobo.1356.2">In this case, inside Azure DevOps, if you click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1357.1">Get Initial Model Version</span></strong><span class="koboSpan" id="kobo.1358.1"> task, you will see the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1359.1">error message:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer383">
<span class="koboSpan" id="kobo.1360.1"><img alt="Figure 9.70 – Initial model find" src="image/B18003_09_070.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1361.1">Figure 9.70 – Initial model find</span></p>
<p><span class="koboSpan" id="kobo.1362.1">This is correct given the model does not yet exist. </span><span class="koboSpan" id="kobo.1362.2">In this case, we set the model version to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1363.1">0</span></strong><span class="koboSpan" id="kobo.1364.1"> in the pipeline to continue a successful </span><span class="No-Break"><span class="koboSpan" id="kobo.1365.1">pipeline run.</span></span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.1366.1">Note that </span><a id="_idIndexMarker653"/><span class="koboSpan" id="kobo.1367.1">as </span><strong class="bold"><span class="koboSpan" id="kobo.1368.1">TrainingPipeline</span></strong><span class="koboSpan" id="kobo.1369.1"> kicks off in Azure DevOps, we can see it running in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1370.1">dev</span></strong><span class="koboSpan" id="kobo.1371.1"> instance of your AML workspace as a pipeline as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1372.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer384">
<span class="koboSpan" id="kobo.1373.1"><img alt="Figure 9.71 – AML pipeline run" src="image/B18003_09_071.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1374.1">Figure 9.71 – AML pipeline run</span></p>
<p><span class="koboSpan" id="kobo.1375.1">As your </span><a id="_idIndexMarker654"/><span class="koboSpan" id="kobo.1376.1">Azure DevOps pipeline hits </span><strong class="source-inline"><span class="koboSpan" id="kobo.1377.1">deploydevmodel</span></strong><span class="koboSpan" id="kobo.1378.1">, if it fails, it will likely be due to the fact your endpoint name in your region is already taken. </span><span class="koboSpan" id="kobo.1378.2">If you have a failed task on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1379.1">deploydevmodel</span></strong><span class="koboSpan" id="kobo.1380.1"> task, look at the contents of the message in Azure DevOps. </span><span class="koboSpan" id="kobo.1380.2">It is likely to say, </span><strong class="bold"><span class="koboSpan" id="kobo.1381.1">There is already an endpoint with this name, Endpoint name needs to be unique within a region. </span><span class="koboSpan" id="kobo.1381.2">Try some </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1382.1">other name.</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1383.1">If that is the case, update your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1384.1">.yml</span></strong><span class="koboSpan" id="kobo.1385.1"> files to leverage a different </span><span class="No-Break"><span class="koboSpan" id="kobo.1386.1">endpoint name.</span></span></p>
<p><span class="koboSpan" id="kobo.1387.1">After the model deployment completes in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1388.1">dev</span></strong><span class="koboSpan" id="kobo.1389.1"> environment, the pipeline will request approval to promote the model to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1390.1">next environment.</span></span></p>
<p><span class="koboSpan" id="kobo.1391.1">Once the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1392.1">dev</span></strong><span class="koboSpan" id="kobo.1393.1"> stage is complete, approval will be requested, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1394.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer385">
<span class="koboSpan" id="kobo.1395.1"><img alt="Figure 9.72 – Azure DevOps pipeline request for permission" src="image/B18003_09_072.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1396.1">Figure 9.72 – Azure DevOps pipeline request for permission</span></p>
<ol>
<li value="15"><span class="koboSpan" id="kobo.1397.1">Clicking on </span><strong class="bold"><span class="koboSpan" id="kobo.1398.1">QAPromoteModel</span></strong><span class="koboSpan" id="kobo.1399.1"> as shown here will allow us to drill into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1400.1">QAPromote</span></strong><span class="koboSpan" id="kobo.1401.1"> model stage to retrieve the pending stage and approve or reject moving the model to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1402.1">qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1403.1"> environment.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer386">
<span class="koboSpan" id="kobo.1404.1"><img alt="Figure 9.73 – Pending QA promotion approval" src="image/B18003_09_073.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1405.1">Figure 9.73 – Pending QA promotion approval</span></p>
<ol>
<li value="16"><span class="koboSpan" id="kobo.1406.1">Clicking on </span><a id="_idIndexMarker655"/><span class="koboSpan" id="kobo.1407.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.1408.1">Review</span></strong><span class="koboSpan" id="kobo.1409.1"> button, you will be able to either select </span><strong class="bold"><span class="koboSpan" id="kobo.1410.1">Reject</span></strong><span class="koboSpan" id="kobo.1411.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.1412.1">Approve</span></strong><span class="koboSpan" id="kobo.1413.1"> for the model promotion, as </span><span class="No-Break"><span class="koboSpan" id="kobo.1414.1">shown here:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer387">
<span class="koboSpan" id="kobo.1415.1"><img alt="Figure 9.74 – QA promotion approval" src="image/B18003_09_074.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1416.1">Figure 9.74 – QA promotion approval</span></p>
<p><span class="koboSpan" id="kobo.1417.1">Once the QA promotion is approved, the model can be deployed to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1418.1">qa</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1419.1"> environment.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer388">
<span class="koboSpan" id="kobo.1420.1"><img alt="Figure 9.75 – qa environment deployment" src="image/B18003_09_075.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1421.1">Figure 9.75 – qa environment deployment</span></p>
<ol>
<li value="17"><span class="koboSpan" id="kobo.1422.1">As your </span><a id="_idIndexMarker656"/><span class="koboSpan" id="kobo.1423.1">pipeline runs, you can review the model registered in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1424.1">dev</span></strong><span class="koboSpan" id="kobo.1425.1"> AML workspace. </span><span class="koboSpan" id="kobo.1425.2">As the pipeline executes, head over to your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1426.1">qa</span></strong><span class="koboSpan" id="kobo.1427.1"> AML workspace and you will see a registered model, shown </span><span class="No-Break"><span class="koboSpan" id="kobo.1428.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer389">
<span class="koboSpan" id="kobo.1429.1"><img alt="Figure 9.76 – Registered model for the qa environment" src="image/B18003_09_076.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1430.1">Figure 9.76 – Registered model for the qa environment</span></p>
<ol>
<li value="18"><span class="koboSpan" id="kobo.1431.1">In addition to the registered model, you can review your managed online endpoint, </span><span class="No-Break"><span class="koboSpan" id="kobo.1432.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer390">
<span class="koboSpan" id="kobo.1433.1"><img alt="Figure 9.77 –  Deployed online endpoint for the qa environment" src="image/B18003_09_077.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1434.1">Figure 9.77 –  Deployed online endpoint for the qa environment</span></p>
<ol>
<li value="19"><span class="koboSpan" id="kobo.1435.1">The figure </span><a id="_idIndexMarker657"/><span class="koboSpan" id="kobo.1436.1">here demonstrates reviewing the managed online endpoint in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1437.1">qa</span></strong><span class="koboSpan" id="kobo.1438.1"> environment. </span><span class="koboSpan" id="kobo.1438.2">Clicking on the name on the screen provides you with detailed i</span><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.1439.1">nformation about the managed </span><span class="No-Break"><span class="koboSpan" id="kobo.1440.1">online endpoint.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.1441.1">Inside the managed online endpoint, you will see the deployed instance of your model as </span><span class="No-Break"><span class="koboSpan" id="kobo.1442.1">shown here:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer391">
<span class="koboSpan" id="kobo.1443.1"><img alt="Figure 9.78 – Managed online endpoint deployment in a qa environment" src="image/B18003_09_078.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1444.1">Figure 9.78 – Managed online endpoint deployment in a qa environment</span></p>
<ol>
<li value="20"><span class="koboSpan" id="kobo.1445.1">The deployment </span><a id="_idIndexMarker658"/><span class="koboSpan" id="kobo.1446.1">name is based on the epoch. </span><span class="koboSpan" id="kobo.1446.2">Each time a model is deployed in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1447.1">qa</span></strong><span class="koboSpan" id="kobo.1448.1"> AML workspace, it checked the </span><span class="No-Break"><span class="koboSpan" id="kobo.1449.1">tag property:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer392">
<span class="koboSpan" id="kobo.1450.1"><img alt="Figure 9.79 – Tag property of the managed online endpoint" src="image/B18003_09_079.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1451.1">Figure 9.79 – Tag property of the managed online endpoint</span></p>
<p><span class="koboSpan" id="kobo.1452.1">Provided there is a model deployed, it creates a new deployment, updates the tag, and deletes the old deployment. </span><span class="koboSpan" id="kobo.1452.2">This ensures that users will experience minimal interruption as the new endpoint </span><span class="No-Break"><span class="koboSpan" id="kobo.1453.1">is deployed.</span></span></p>
<p><span class="koboSpan" id="kobo.1454.1">In this chapter, you set up your MLOps pipeline by leveraging Azure DevOps to automate the orchestration of data preparation, model development, and model evaluation and registration; deploying the model by leveraging blue/green deployments; and promoting it from one environment to </span><span class="No-Break"><span class="koboSpan" id="kobo.1455.1">the next.</span></span></p>
<p><span class="koboSpan" id="kobo.1456.1">You are encouraged to leverage your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1457.1">dev</span></strong><span class="koboSpan" id="kobo.1458.1"> AML workspace, make code modifications and review the process of your Azure DevOps pipeline, kick off your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1459.1">dev</span></strong><span class="koboSpan" id="kobo.1460.1"> AML workspace pipeline, register the model in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1461.1">qa</span></strong><span class="koboSpan" id="kobo.1462.1"> environment, and update the managed online endpoints. </span><span class="koboSpan" id="kobo.1462.2">Now that you have deployed managed online endpoints through an MLOps</span><a id="_idIndexMarker659"/><span class="koboSpan" id="kobo.1463.1"> pipeline, take caution, as the endpoints are leveraging compute. </span><span class="koboSpan" id="kobo.1463.2">You should delete the endpoints when you are not using them to keep your costs down. </span><span class="koboSpan" id="kobo.1463.3">Congratulations – you have successfully implemented an </span><span class="No-Break"><span class="koboSpan" id="kobo.1464.1">MLOps pipeline!</span></span></p>
<h1 id="_idParaDest-122"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.1465.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1466.1">In this chapter, the focus was on deploying your model as a managed online endpoint to support real-time inferencing use cases in an </span><span class="No-Break"><span class="koboSpan" id="kobo.1467.1">automated fashion.</span></span></p>
<p><span class="koboSpan" id="kobo.1468.1">This chapter brought together the concepts that you learned about in previous chapters, as well as introducing you to Azure DevOps and the orchestration it makes possible. </span><span class="koboSpan" id="kobo.1468.2">Leveraging Azure DevOps, code and deployments are traceable. </span><span class="koboSpan" id="kobo.1468.3">Azure DevOps pipelines automate triggering the orchestration of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1469.1">dev</span></strong><span class="koboSpan" id="kobo.1470.1"> environment pipeline, moving the registered model to the higher environment. </span><span class="koboSpan" id="kobo.1470.2">Leveraging Azure Key Vault, we can securely hold information to support multiple environments, linking those to your Azure DevOps environment groups. </span><span class="koboSpan" id="kobo.1470.3">With MLflow integration, metrics are captured for the model generated in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1471.1">dev</span></strong><span class="koboSpan" id="kobo.1472.1"> environment, and that model number is registered in a higher environment and then added to the managed online endpoint. </span><span class="koboSpan" id="kobo.1472.2">We implemented an MLOps pipeline to automate data transformation, model creation, evaluation, and </span><span class="No-Break"><span class="koboSpan" id="kobo.1473.1">model deployment.</span></span></p>
<p><span class="koboSpan" id="kobo.1474.1">In the next chapter, we will explore leveraging Deep Learning in your AML workspace.  </span><span class="koboSpan" id="kobo.1474.2">This will be a guide to leveraging object detection with AutoML to solve your object </span><span class="No-Break"><span class="koboSpan" id="kobo.1475.1">detection objectives.</span></span></p>
<h1 id="_idParaDest-123"><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.1476.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.1477.1">As mention</span><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.1478.1">ed, in this chapter, we tried to provide a basis for creating your own MLOps pipeline. </span><span class="koboSpan" id="kobo.1478.2">We encourage you to check out two additional resources for building your MLOps pipelines </span><span class="No-Break"><span class="koboSpan" id="kobo.1479.1">with AML:</span></span></p>
<ul>
<li><a href="https://github.com/Azure/mlops-v2"><span class="No-Break"><span class="koboSpan" id="kobo.1480.1">https://github.com/Azure/mlops-v2</span></span></a></li>
<li><a href="https://github.com/microsoft/MLOpsPython"><span class="No-Break"><span class="koboSpan" id="kobo.1481.1">https://github.com/microsoft/MLOpsPython</span></span></a></li>
</ul>
</div>


<div class="Content" id="_idContainer394">
<h1 id="_idParaDest-124"><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.1.1">Part 3: Productionizing Your Workload with MLOps</span></h1>
<p><span class="koboSpan" id="kobo.2.1">In this section, readers will learn how to integrate AMLS jobs with Azure DevOps and Github to achieve an </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">MLOps solution.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This section has the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B18003_10.xhtml#_idTextAnchor196"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 10</span></em></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Using Deep Learning in Azure Machine Learning</span></em></li>
<li><a href="B18003_11.xhtml#_idTextAnchor204"><em class="italic"><span class="koboSpan" id="kobo.9.1">Chapter 11</span></em></a><span class="koboSpan" id="kobo.10.1">, </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Using Distributed Training in AMLS</span></em></li>
</ul>
</div>
<div>
<div id="_idContainer395">
</div>
</div>
<div>
<div id="_idContainer396">
</div>
</div>
</body></html>
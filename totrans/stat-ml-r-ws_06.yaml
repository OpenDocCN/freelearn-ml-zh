- en: '5'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '5'
- en: Exploratory Data Analysis
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索性数据分析
- en: The previous chapter covered the basic plotting principles using `ggplot2`,
    including the use of various geometries and themes layers. It turns out that cleaning
    and massaging the raw data (covered in [*Chapter 2*](B18680_02.xhtml#_idTextAnchor032)
    and [*Chapter 3*](B18680_03.xhtml#_idTextAnchor050)) and visualizing the data
    (covered in [*Chapter 4*](B18680_04.xhtml#_idTextAnchor077)) belong to the first
    stage of a typical data science project workflow – that is, **exploratory data
    analysis** (**EDA**). We will cover this using a few case studies in this chapter.
    We will learn how to apply the coding techniques we covered earlier in this book
    and focus on analyzing the data through the lens of EDA.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 上一章介绍了使用`ggplot2`的基本绘图原则，包括各种几何形状和主题层的应用。结果证明，清理和整理原始数据（在第[*第2章*](B18680_02.xhtml#_idTextAnchor032)和[*第3章*](B18680_03.xhtml#_idTextAnchor050)中介绍）以及数据可视化（在第[*第4章*](B18680_04.xhtml#_idTextAnchor077)中介绍）属于典型数据科学项目工作流程的第一阶段——即**探索性数据分析**（**EDA**）。我们将通过本章的一些案例研究来介绍这一内容。我们将学习如何应用本书前面介绍过的编码技术，并专注于通过EDA的视角分析数据。
- en: By the end of this chapter, you will know how to uncover the structures of data
    using numerical and graphical techniques, discover interesting relationships among
    variables, and spot unusual observations.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章结束时，你将了解如何使用数值和图形技术揭示数据结构，发现变量之间的有趣关系，以及识别异常观测值。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: EDA fundamentals
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: EDA基础
- en: EDA in practice
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实践中的EDA（探索性数据分析）
- en: Technical requirements
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To complete the exercises in this chapter, you will need to have the following:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成本章的练习，你需要具备以下条件：
- en: The latest version of the `yfR` package, which is 1.0.0 at the time of writing
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在撰写本文时，`yfR`包的最新版本为1.0.0
- en: The latest version of the `corrplot` package, which is 0.92 at the time of writing
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在撰写本文时，`corrplot`包的最新版本为0.92
- en: The code and data for this chapter are available at [https://github.com/PacktPublishing/The-Statistics-and-Machine-Learning-with-R-Workshop/blob/main/Chapter_5/chapter_5.R](https://github.com/PacktPublishing/The-Statistics-and-Machine-Learning-with-R-Workshop/blob/main/Chapter_5/chapter_5.R).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的代码和数据可在以下链接找到：[https://github.com/PacktPublishing/The-Statistics-and-Machine-Learning-with-R-Workshop/blob/main/Chapter_5/chapter_5.R](https://github.com/PacktPublishing/The-Statistics-and-Machine-Learning-with-R-Workshop/blob/main/Chapter_5/chapter_5.R)。
- en: EDA fundamentals
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: EDA基础
- en: When facing a new dataset in the form of a table (a DataFrame) in Excel or a
    dataset, EDA helps us gain insight into the underlying pattern and irregularities
    of variables in the dataset. This is an important first-step exercise before building
    any predictive model. As the saying goes, *garbage in, garbage out*. When the
    input variables used for model development suffer from problems, such as missing
    values or different scales, the resulting model will either perform poorly, converge
    slowly, or even hit an error in the training stage. Therefore, understanding your
    data and ensuring the raw materials are in check are critical steps in warrantying
    a good-performing model later on.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 当面对以表格（DataFrame）形式存在于Excel中的新数据集或数据集时，EDA帮助我们洞察数据集中变量的潜在模式和异常。这是在构建任何预测模型之前的一个重要步骤。俗话说，*垃圾输入，垃圾输出*。当用于模型开发输入变量存在问题时，如缺失值或不同尺度，所得到的模型可能会表现不佳、收敛缓慢，甚至在训练阶段出现错误。因此，理解你的数据并确保原材料是正确的，是保证模型后期表现良好的关键步骤。
- en: This is where EAD comes in. Instead of being a rigid statistical procedure,
    EAD is a set of exploratory analyses that enables you to develop a better understanding
    of the features and potential relationships in the data. It serves as a transitional
    analysis to guide modeling later on, involving both the data manipulation and
    visualization techniques we learned earlier. It helps summarize salient characteristics
    of the data through various forms of visual aids, facilitating the extraction
    of important features.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是EDA发挥作用的地方。EAD（探索性数据分析）不是一种僵化的统计程序，而是一套探索性分析，它使你能够更好地理解数据中的特征和潜在关系。它作为过渡性分析，指导后续建模，涉及我们之前学到的数据操作和可视化技术。它通过各种形式的视觉辅助工具帮助总结数据的显著特征，促进重要特征的提取。
- en: 'There are two broad types of EDA: descriptive statistics such as the mean,
    median, mode, and inter-quantile range, and graphical descriptions such as density
    plots, histograms, box plots, and so on.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: EDA 有两种主要类型：如均值、中位数、众数和四分位数范围等描述性统计，以及如密度图、直方图、箱线图等图形描述。
- en: A typical EAD process includes analyzing categorical and numerical variables,
    both standalone in univariate analysis and in combination via bivariate and multivariate
    analysis. Common practices include analyzing the distribution of a given set of
    variables and examining missing values and outliers. In the following sections,
    we will start by analyzing different types of data, including categorical and
    numerical variables. We will then go through a case study to apply and reinforce
    the techniques covered in previous chapters using `dplyr` and `ggplot2`.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 一个典型的 EDA 流程包括分析分类和数值变量，包括在单变量分析中独立分析以及在双变量和多变量分析中结合分析。常见做法包括分析一组给定变量的分布，并检查缺失值和异常值。在接下来的几节中，我们将首先分析不同类型的数据，包括分类和数值变量。然后，我们将通过案例研究来应用和巩固前几章中涵盖的技术，使用
    `dplyr` 和 `ggplot2`。
- en: Analyzing categorical data
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分析分类数据
- en: 'In this section, we will look at how to analyze two categorical variables via
    graphical and numerical summaries. We will use a dataset on comic characters from
    the Marvel comics universe, which should not be unfamiliar to you if you are a
    fan of Marvel superheroes. The dataset is published by `read_csv()` function from
    the `readr` package, the data loading arm of the `tidyverse` universe, as shown
    in the following code snippet:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨如何通过图形和数值总结来分析两个分类变量。我们将使用来自漫威漫画宇宙的漫画角色数据集，如果你是漫威超级英雄的粉丝，这个数据集可能对你来说并不陌生。该数据集由
    `read_csv()` 函数发布，该函数来自 `readr` 包，它是 `tidyverse` 宇宙的数据加载部分，如下代码片段所示：
- en: '[PRE0]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Printing out the DataFrame shows that this dataset contains `16,376` rows and
    `13` columns, including the character names, IDs, and so on.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 打印 DataFrame 显示，该数据集包含 `16,376` 行和 `13` 列，包括角色名称、ID 等等。
- en: In the next section, we will look at summarizing two categorical variables using
    the count statistic.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将探讨如何使用计数统计量来总结两个分类变量。
- en: Summarizing categorical variables using counts
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用计数总结分类变量
- en: In this section, we will cover different ways to analyze two categorical variables,
    including using a contingency table and a bar chart. A contingency table is a
    useful way to show the total counts of observations that fall into each unique
    combination of the two categorical variables. Let’s go through an exercise on
    how to achieve this.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍分析两个分类变量的不同方法，包括使用列联表和条形图。列联表是展示两个分类变量每个唯一组合中观测值总计数的有用方式。让我们通过一个练习来了解如何实现这一点。
- en: Exercise 5.1 – summarizing two categorical variables
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 5.1 – 总结两个分类变量
- en: 'In this exercise, we will focus on two categorical variables: `ALIGN` (indicating
    whether the character is good, neutral, or bad) and `SEX` (indicating the gender
    of the character). First, we will look at the unique values of each variable,
    followed by summarizing the respective total counts when combined:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将关注两个分类变量：`ALIGN`（表示角色是好人、中立还是坏人）和 `SEX`（表示角色的性别）。首先，我们将查看每个变量的唯一值，然后总结组合后的相应总计数：
- en: 'Inspect the unique values of `ALIGN` and `SEX`:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 `ALIGN` 和 `SEX` 的唯一值：
- en: '[PRE1]'
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The results show that both variables contain `NA` values. Let’s remove the observations
    with `NA` values in either `ALIGN` or `SEX`.
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 结果显示，这两个变量都包含 `NA` 值。让我们删除 `ALIGN` 或 `SEX` 中任一包含 `NA` 值的观测值。
- en: 'Remove observations with `NA` values in either `ALIGN` or `SEX` in `df` using
    the `filter` verb function:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `filter` 语句函数在 `df` 中删除 `ALIGN` 或 `SEX` 中包含 `NA` 值的观测值：
- en: '[PRE2]'
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'We can verify whether the rows with `NA` values have been successfully removed
    by checking the dimension of the resulting DataFrame and the count of `NA` values
    in `ALIGN` and `SEX`:'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们可以通过检查结果 DataFrame 的维度和 `ALIGN` 和 `SEX` 中 `NA` 值的计数来验证是否已成功删除包含 `NA` 值的行：
- en: '[PRE3]'
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Next, we must create a contingency table to summarize the frequency of each
    unique combination of values.
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 接下来，我们必须创建一个列联表来总结每个唯一值组合的频率。
- en: 'Create a contingency table between `ALIGN` and `SEX`:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建 `ALIGN` 和 `SEX` 之间的列联表：
- en: '[PRE4]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: We can see that most characters are male and bad. Among all male characters,
    the majority are bad, whereas good or neutral characters are dominant in female
    characters. Let’s visually present and analyze the proportions using a bar chart.
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们可以看到，大多数角色是男性且是坏的。在所有男性角色中，大多数是坏的，而女性角色中好的或中性的角色占主导地位。让我们使用条形图直观地呈现和分析比例。
- en: 'Create a bar chart between these two variables using `ggplot2`:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`ggplot2`在这两个变量之间创建一个条形图：
- en: '[PRE5]'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![Figure 5.1 – Bar chart of ALIGN and SEX](img/B18680_05_001.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![图5.1 – ALIGN和SEX的条形图](img/B18680_05_001.jpg)'
- en: Figure 5.1 – Bar chart of ALIGN and SEX
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.1 – ALIGN和SEX的条形图
- en: 'Since the total count of `Agender Characters` and `Genderfluid Characters`
    is very limited, we can remove these two combinations when plotting the bar chart:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`Agender Characters`和`Genderfluid Characters`的总计数非常有限，我们可以在绘制条形图时移除这两个组合：
- en: '[PRE6]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Running this command generates *Figure 5**.2*:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此命令生成**图5.2**：
- en: '![Figure 5.2 – Removing low-count combinations from the bar chart](img/B18680_05_002.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![图5.2 – 从条形图中移除低计数组合](img/B18680_05_002.jpg)'
- en: Figure 5.2 – Removing low-count combinations from the bar chart
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.2 – 从条形图中移除低计数组合
- en: Using counts may not be as intuitive when comparing different combinations.
    In this case, converting counts into proportions will help present the information
    on a relative scale.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 使用计数在比较不同的组合时可能并不直观。在这种情况下，将计数转换为比例将有助于在相对尺度上呈现信息。
- en: Converting counts into proportions
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将计数转换为比例
- en: In this section, we will go over an exercise that covers conditional proportions
    in a contingency table. Unlike the previous unconditional contingency table, conditioning
    along either dimension of a two-way contingency table results in a different distribution
    of proportions.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将回顾一个涵盖列联表中条件比例的练习。与之前的无条件列联表不同，在双向列联表的任一维度上进行条件处理会导致比例分布的不同。
- en: Exercise 5.2 – summarizing two categorical variables
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习5.2 – 总结两个分类变量
- en: 'In this exercise, we will learn how to express the previous contingency table
    using proportions and convert it into a conditional distribution based on a specified
    dimension:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将学习如何使用比例表达之前的列联表，并将其转换为基于指定维度的条件分布：
- en: 'Express the previous contingency table using proportions. Avoid scientific
    notation (for example, e+10) and keep three decimal places:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用比例表达之前的列联表。避免使用科学记数法（例如，e+10）并保留三位小数：
- en: '[PRE7]'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The values in the contingency table are now expressed as proportions. Since
    the proportions are derived by dividing the previous absolute counts by the total
    sum, we can verify whether the total sum of proportions is equal to one by summing
    all the values in the table:'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 列联表中的值现在表示为比例。由于比例是通过将之前的绝对计数除以总和得到的，我们可以通过求和表中的所有值来验证比例的总和是否等于一：
- en: '[PRE8]'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Obtain the contingency table as proportions after conditioning on rows (here,
    the `ALIGN` variable):'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在对行（此处为`ALIGN`变量）进行条件处理后，获取作为比例的列联表：
- en: '[PRE9]'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We can verify the conditioning by calculating the row-wise summations:'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们可以通过计算行的求和来验证条件：
- en: '[PRE10]'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: In this code, setting `margin=1` means row-level conditioning. We can also exercise
    column-level conditioning by setting `margin=2`.
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此代码中，设置`margin=1`表示行级条件。我们也可以通过设置`margin=2`进行列级条件练习。
- en: 'Obtain the contingency table as proportions after conditioning on columns (for
    instance, the `SEX` variable):'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在对列（例如，`SEX`变量）进行条件处理后，获取作为比例的列联表：
- en: '[PRE11]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Similarly, we can verify the conditioning by calculating the column-wise summations:'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 同样，我们可以通过计算列的求和来验证条件：
- en: '[PRE12]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Plot the unconditional proportions in a bar chart after applying the same filtering
    condition to `SEX`. Change the label of the *y* axis to `proportion`:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在对`SEX`应用相同的过滤条件后，在条形图中绘制无条件的比例。将*Y*轴的标签改为`比例`：
- en: '[PRE13]'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Running this command generates *Figure 5**.3*, where it is obvious that bad
    characters are predominantly male characters:'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行此命令生成**图5.3**，其中很明显，坏角色主要是男性角色：
- en: '![Figure 5.3 – Visualizing the unconditional proportions in a bar chart](img/B18680_05_003.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![图5.3 – 在条形图中可视化无条件的比例](img/B18680_05_003.jpg)'
- en: Figure 5.3 – Visualizing the unconditional proportions in a bar chart
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.3 – 在条形图中可视化无条件的比例
- en: 'We can also obtain a similar result from a different angle by switching the
    two variables in the bar chart:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以通过在条形图中切换这两个变量从不同的角度获得类似的结果：
- en: '[PRE14]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Running this command generates *Figure 5**.4*, where `ALIGN` is used as the
    *x* axis and `SEX` is used as the grouping variable:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此命令会生成 *图 5**.4*，其中 `ALIGN` 被用作 *x* 轴，而 `SEX` 被用作分组变量：
- en: '![Figure 5.4 – Switching variables in the bar chart.](img/B18680_05_004.jpg)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![图 5.4 – 条形图中切换变量](img/B18680_05_004.jpg)'
- en: Figure 5.4 – Switching variables in the bar chart.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.4 – 条形图中切换变量
- en: Next, we will look at describing one categorical variable using a marginal distribution
    and faceted bar chart.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将探讨使用边缘分布和分面条形图描述一个分类变量。
- en: Marginal distribution and faceted bar charts
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 边缘分布和分面条形图
- en: Marginal distribution refers to the distribution of one variable after integrating
    other variables. This means that we are interested in the distribution of one
    specific variable, no matter how the other variables are distributed.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 边缘分布指的是在整合其他变量后的一个变量的分布。这意味着我们感兴趣的是某个特定变量的分布，无论其他变量如何分布。
- en: 'In the case of our previous two-way contingency table stored in `count_df`,
    we can derive the marginal distribution of `SEX` in the form of a frequency count
    by summing over all possible values of `ALIGN`. That is, we can perform column-wise
    summation to get the marginal count of `SEX`, as shown in the following code snippet:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们之前存储在 `count_df` 中的双向列联表中，我们可以通过对所有可能的 `ALIGN` 值求和来推导出 `SEX` 的边缘分布，以频率计数的形式。也就是说，我们可以执行列求和以获得
    `SEX` 的边缘计数，如下面的代码片段所示：
- en: '[PRE15]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'This has the same effect as directly obtaining the count of different categories
    in `SEX`:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这与直接获取 `SEX` 中不同类别的计数具有相同的效果：
- en: '[PRE16]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Now, what if we would like to obtain the marginal distribution of one variable
    for each category of another variable? This can be achieved via `ggplot2`, as
    shown in the following code snippet:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果我们想为另一个变量的每个类别获取一个变量的边缘分布怎么办？这可以通过 `ggplot2` 实现，如下面的代码片段所示：
- en: '[PRE17]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Running this code generates *Figure 5**.5*, which contains three side-by-side
    bar charts for bad, good, and neutral characters, respectively. This is essentially
    rearranging the stacked bar chart in *Figure 5**.4*. Note that faceting can be
    added by using the `facet_wrap` function, where `~ALIGN` indicates that the faceting
    is to be performed using the `ALIGN` variable. Note that we used the `strip.text.x`
    attribute to adjust the text size of the facet grid labels:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此代码生成 *图 5**.5*，其中包含三个并排的条形图，分别表示坏、好和中性角色。这实际上是重新排列了 *图 5**.4* 中的堆叠条形图。请注意，可以通过使用
    `facet_wrap` 函数添加分面，其中 `~ALIGN` 表示分面将使用 `ALIGN` 变量执行。请注意，我们使用了 `strip.text.x`
    属性来调整分面网格标签的文本大小：
- en: '![Figure 5.5 – Faceted bar chart](img/B18680_05_005.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图 5.5 – 分面条形图](img/B18680_05_005.jpg)'
- en: Figure 5.5 – Faceted bar chart
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.5 – 分面条形图
- en: 'In addition, we can adjust the sequence of the individual bar facets by overriding
    the levels of `ALIGN` after converting it into a factor:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们还可以通过在将其转换为因子后覆盖 `ALIGN` 的级别来调整单个条形分面的顺序：
- en: '[PRE18]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Running the same faceting codes again will now generate *Figure 5**.6*, where
    the sequence of facets is determined according to the levels in `ALIGN`:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 再次运行相同的分面代码现在将生成 *图 5**.6*，其中分面的顺序是根据 `ALIGN` 中的级别确定的：
- en: '![Figure 5.6 – Arranging the sequence of facets in a faceted bar chart](img/B18680_05_006.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![图 5.6 – 在分面条形图中排列分面的顺序](img/B18680_05_006.jpg)'
- en: Figure 5.6 – Arranging the sequence of facets in a faceted bar chart
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.6 – 在分面条形图中排列分面的顺序
- en: In the next section, we will look at different ways to explore numerical variables.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将探讨探索数值变量的不同方法。
- en: Analyzing numerical data
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分析数值数据
- en: In this section, we will look at summarizing numerical data using different
    types of plots for the Marvel dataset. Since there’s an infinite amount of values
    that a numerical/continuous variable can assume, the frequency table used earlier
    no longer applies. Instead, we often group the values into pre-specified bins,
    allowing us to work with ranges instead of single values.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨使用不同类型的图表来总结 Marvel 数据集中的数值数据。由于数值/连续变量可以假设的值有无限多，因此之前使用的频率表不再适用。相反，我们通常将值分组到预先指定的区间中，这样我们就可以处理范围而不是单个值。
- en: Exercise 5.3 – exploring numerical variables
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 5.3 – 探索数值变量
- en: 'In this exercise, we will describe a numerical variable using a dot plot, histogram,
    density plot, and box plot for the `Year` variable:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将使用点图、直方图、密度图和箱线图来描述 `Year` 变量的数值变量：
- en: 'Get a summary of the `Year` variable using the `summary()` function:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`summary()`函数获取`Year`变量的摘要：
- en: '[PRE19]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Generate a dotted plot of the `Year` variable:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成`Year`变量的点状图：
- en: '[PRE20]'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Running this command generates *Figure 5**.7*, where each dot represents an
    observation at the corresponding location on the *x* axis. Similar observations
    are then stacked together on top of each top. It should be noted that using a
    dot plot is not the best option when the number of observations becomes large,
    with the *y* axis becoming meaningless due to technical limitations in `ggplot2`:'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.7*，其中每个点代表在*x*轴对应位置上的一个观测值。相似观测值随后堆叠在顶部。需要注意的是，当观测值数量变得很大时，使用点图可能不是最佳选择，因为由于`ggplot2`的技术限制，*y*轴变得没有意义：
- en: '![Figure 5.7 – Summarizing the Year variable using a dot plot](img/B18680_05_007.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![图5.7 – 使用点图总结年份变量](img/B18680_05_007.jpg)'
- en: Figure 5.7 – Summarizing the Year variable using a dot plot
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.7 – 使用点图总结年份变量
- en: 'Build a histogram of the `Year` variable:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建`Year`变量的直方图：
- en: '[PRE21]'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Running this command generates *Figure 5**.8*, where each value of `Year` is
    grouped into bins and then the number of observations in each bin is counted to
    represent the height of each bin. Note that the default number of bins is 30,
    although this can be overwritten using the `bins` argument. The histogram thus
    presents the general shape of the distribution of the underlying variable. We
    can also convert it into a density plot to smooth out the steps between bins:'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.8*，其中`Year`的每个值被分组到不同的区间，然后计算每个区间内的观测值数量以表示每个区间的宽度。请注意，默认的区间数量是30，但可以使用`bins`参数覆盖。因此，直方图展示了底层变量的分布形状。我们还可以将其转换为密度图以平滑区间之间的步骤：
- en: '![Figure 5.8 – Summarizing the Year variable using a histogram](img/B18680_05_008.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![图5.8 – 使用直方图总结年份变量](img/B18680_05_008.jpg)'
- en: Figure 5.8 – Summarizing the Year variable using a histogram
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.8 – 使用直方图总结年份变量
- en: 'Build a density plot of the `Year` variable:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建`Year`变量的密度图：
- en: '[PRE22]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Running this command generates *Figure 5**.9*, where the distribution is represented
    as a smooth line. Note that a density plot is recommended only when there are
    many observations in the dataset:'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.9*，其中分布以平滑的线条表示。请注意，当数据集中有大量观测值时，建议使用密度图：
- en: '![Figure 5.9 – Summarizing the Year variable using a density plot](img/B18680_05_009.jpg)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![图5.9 – 使用密度图总结年份变量](img/B18680_05_009.jpg)'
- en: Figure 5.9 – Summarizing the Year variable using a density plot
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.9 – 使用密度图总结年份变量
- en: 'Build a box plot of the `Year` variable:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建`Year`变量的箱线图：
- en: '[PRE23]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![Figure 5.10 – Summarizing the Year variable using a box plot](img/B18680_05_010.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![图5.10 – 使用箱线图总结年份变量](img/B18680_05_010.jpg)'
- en: Figure 5.10 – Summarizing the Year variable using a box plot
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.10 – 使用箱线图总结年份变量
- en: Running this command generates *Figure 5**.10*, where the central box represents
    the majority (25th to 75th percentile) of the observations, the middle line in
    the box denotes the median (50th percentile), and the outreaching whiskers include
    almost all “normal” observations. The outlier observation, which is none in this
    case, would be represented as dots outside the reach of the whiskers.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.10*，其中中间的箱体代表大多数观测值（第25到第75百分位数），箱体中的中线表示中位数（第50百分位数），而延伸的胡须包括几乎所有“正常”的观测值。在这个例子中，异常观测值（没有异常值）将表示为胡须范围之外的点。
- en: We can also add a faceting layer by `SEX` and observe the change in box plots
    across different genders.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以通过`SEX`添加一个分面层，并观察不同性别下箱线图的变化。
- en: 'Add a faceting layer to the previous box plot using the `SEX` variable:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在之前的箱线图中使用`SEX`变量添加一个分面层：
- en: '[PRE24]'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Running this command generates *Figure 5**.11*. As we can see, most female
    characters are introduced later than many of the male characters, and recent years
    feature more female characters than male ones:'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.11*。如图所示，大多数女性角色比许多男性角色晚出现，并且近年来女性角色比男性角色多：
- en: '![Figure 5.11 – Faceting the box plot based on SEX](img/B18680_05_011.jpg)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![图5.11 – 根据性别分面箱线图](img/B18680_05_011.jpg)'
- en: Figure 5.11 – Faceting the box plot based on SEX
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.11 – 根据性别分面箱线图
- en: In the next section, we will look at how to visualize data with higher dimensions.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将探讨如何可视化高维数据。
- en: Visualization in higher dimensions
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 高维可视化
- en: The previous example used facets to present the distribution of a numerical
    variable in each unique value of a categorical variable. When there is more than
    one categorical variable, we can apply the same technique and expand the facets
    accordingly. This allows us to visualize the same numerical variable in higher
    dimensions that contain more than one categorical variable. Let’s go through an
    exercise on visualizing the distribution of `Year` by `ALIGN` and `SEX`.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的例子使用了分面来展示数值变量在每个分类变量的唯一值中的分布。当存在多个分类变量时，我们可以应用相同的技巧并相应地扩展分面。这使我们能够在包含多个分类变量的更高维度中可视化相同的数值变量。让我们通过一个可视化`Year`按`ALIGN`和`SEX`分布的练习来了解。
- en: Exercise 5.4 – visualizing Year by ALIGN and SEX
  id: totrans-127
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习5.4 – 可视化`Year`按`ALIGN`和`SEX`
- en: 'In this exercise, we will use the `facet_grid()` function from `ggplot2` to
    visualize the distribution of `Year` in each unique combination of `ALIGN` and
    `SEX` using both a density plot and a histogram:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将使用`ggplot2`中的`facet_grid()`函数，通过密度图和直方图来可视化`Year`在每个唯一的`ALIGN`和`SEX`组合中的分布：
- en: 'Build a density plot of `Year` by `ALIGN` and `SEX` after applying the same
    filtering condition to `SEX`:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在对`SEX`应用相同的过滤条件后，构建`Year`按`ALIGN`和`SEX`的密度图：
- en: '[PRE25]'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Running this command generates *Figure 5**.12*, where we used the `facet_grid()`
    function to create six histograms, with the columns split by the first argument,
    `ALIGN`, and the rows split by the second argument, `SEX`. The result shows an
    increasing trend (more movies were produced) for all different combinations of
    `ALIGN` and `SEX`. However, since the *y* axis shows the relative density only,
    we would need to switch to a histogram to assess the absolute frequency of occurrence.
    Note that we used the `strip.text.y` attribute to adjust the text size of the
    facet grid labels along the *y* axis:'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.12*，我们在这里使用了`facet_grid()`函数创建了六个直方图，列由第一个参数`ALIGN`分割，行由第二个参数`SEX`分割。结果显示，对于所有不同的`ALIGN`和`SEX`组合，趋势都在上升（制作了更多的电影）。然而，由于*Y*轴只显示相对密度，我们需要切换到直方图来评估发生的绝对频率。注意，我们使用了`strip.text.y`属性来调整分面网格标签沿*Y*轴的文本大小：
- en: '![Figure 5.12 – Density plot of Year by ALIGN and SEX](img/B18680_05_012.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![图5.12 – `Year`按`ALIGN`和`SEX`的密度图](img/B18680_05_012.jpg)'
- en: Figure 5.12 – Density plot of Year by ALIGN and SEX
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.12 – `Year`按`ALIGN`和`SEX`的密度图
- en: 'Build the same plots using a histogram:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用直方图构建相同的图表：
- en: '[PRE26]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Running this command generates *Figure 5**.13*, where we can see that good
    female and male characters are steadily increasing in recent years:'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.13*，我们可以看到近年来优秀男女角色的数量稳步上升：
- en: '![Figure 5.13 – Histogram of Year by ALIGN and SEX](img/B18680_05_013.jpg)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![图5.13 – `Year`按`ALIGN`和`SEX`的直方图](img/B18680_05_013.jpg)'
- en: Figure 5.13 – Histogram of Year by ALIGN and SEX
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.13 – `Year`按`ALIGN`和`SEX`的直方图
- en: In the next section, we will try different ways to measure the central concentration
    of a numerical variable.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将尝试不同的方法来测量数值变量的中心集中度。
- en: Measuring the central concentration
  id: totrans-140
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测量中心集中度
- en: There are different ways to measure the central concentration, or central tendency,
    of a numerical variable. Depending on the context and purpose, the measure of
    center is often used to represent a typical observation out of a numerical variable
    of interest.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 测量数值变量的集中趋势或中心集中度有不同方法。根据上下文和目的，中心测度通常用来表示一个数值变量的典型观测值。
- en: The most popular measure of center is the mean, which is calculated as the average
    value of a list of numbers. In other words, we can obtain the mean value by summing
    all observations divided by the number of observations. This can be achieved using
    the `mean()` function in R.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 最流行的中心测度是均值，它是通过计算数字列表的平均值来得到的。换句话说，我们可以通过将所有观测值相加然后除以观测值的数量来获得均值。这可以通过在R中使用`mean()`函数实现。
- en: Another measure of center is the median, which is the middle value after sorting
    the list of numbers from the smallest to the largest. This can be achieved using
    the `median()` function in R.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个中心测度是中位数，它是将数字列表从小到大排序后的中间值。这可以通过在R中使用`median()`函数实现。
- en: The third measure of center is the mode, which represents the most common observation
    in the list of numbers. Since there is no built-in function for calculating the
    mode, we must write a customized function to obtain the most frequent observation
    based on the count of occurrences using the `table()` function.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 第三种中心度量是众数，它代表数字列表中最常见的观测值。由于没有内置的函数来计算众数，我们必须编写一个自定义函数，根据出现次数使用`table()`函数来获取最频繁的观测值。
- en: It is important to look at the shape of the distribution before deciding on
    the measure of center. For a start, note that the mean value is often drawn toward
    the long tail of a skewed distribution, a continuous distribution inferred from
    the list of numbers such as the density plot from earlier. In other words, the
    mean value is sensitive to the extreme values in the observations. On the other
    hand, the median will not suffer from such sensitivity since it is simply a measure
    that divides the ordered observations by half. Therefore, the median is a better
    and more sensible candidate measure of center when working with a skewed continuous
    distribution, unless additional treatment on the extreme values, often treated
    as outliers, is in place.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在决定中心度量之前，观察分布的形状是很重要的。首先，请注意，平均值通常会被拉向偏斜分布的长尾，这是一个从数字列表（如之前的密度图）推断出的连续分布。换句话说，平均值对观测中的极端值很敏感。另一方面，中位数不会受到这种敏感性的影响，因为它只是将有序观测值分成两半的度量。因此，当处理偏斜的连续分布时，中位数是一个更好、更合理的中心度量候选者，除非对极端值（通常被视为异常值）进行了额外的处理。
- en: Let’s look at how to obtain the three measures of center via an exercise.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过一个练习来看看如何获得三个中心度量。
- en: Exercise 5.5 – calculating the measure of center
  id: totrans-147
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习5.5 – 计算中心度量
- en: 'In this exercise, we will calculate the mean, median, and mode of `APPEARANCES`,
    which denotes the number of appearances for each character:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将计算`APPEARANCES`的平均值、中位数和众数，它表示每个角色的出现次数：
- en: 'Calculate the mean of `APPEARANCES`:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算`APPEARANCES`的平均值：
- en: '[PRE27]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'The `NA` result suggests that there are `NA` values in the observations of
    `APPEARANCES`. To verify this, we can look at the summary of this continuous variable:'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`NA`结果表明，`APPEARANCES`的观测值中存在`NA`值。为了验证这一点，我们可以查看这个连续变量的摘要：'
- en: '[PRE28]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Indeed, there are quite a few `NA` values. To calculate the mean value after
    removing these `NA` observations, we can enable the `na.rm` argument in the `mean()`
    function:'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 的确，存在相当多的`NA`值。为了在移除这些`NA`观测值后计算平均值，我们可以在`mean()`函数中启用`na.rm`参数：
- en: '[PRE29]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Calculate the mean of `APPEARANCES`:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算`APPEARANCES`的平均值：
- en: '[PRE30]'
  id: totrans-156
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: When the mean and median values deviate a lot from each other, this is an obvious
    sign that we are working with a skewed distribution. In this case, the `APPEARANCES`
    variable is quite skewed, with the median character appearing three times and
    the most popular character appearing up to 4,043 times.
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当平均值和中位数差异很大时，这是一个明显的迹象，表明我们正在处理一个偏斜分布。在这种情况下，`APPEARANCES`变量非常偏斜，中位数角色出现三次，最受欢迎的角色出现高达4,043次。
- en: 'Calculate the mode of `APPEARANCES`:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算`APPEARANCES`的众数：
- en: '[PRE31]'
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Here, we created a customized function called `mode()` to calculate the mode
    of a numerical variable, where we first extract a list of the unique values using
    the `unique()` function, then count the number of times each unique value appears
    using the `tabulate()` and `match()` functions, and lastly obtain the index of
    the maximal value using the `which.max()` function. The result shows that the
    majority of characters only appear once in the entire history of Marvel comics.
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这里，我们创建了一个名为`mode()`的自定义函数来计算数值变量的众数，其中我们首先使用`unique()`函数提取一个唯一值的列表，然后使用`tabulate()`和`match()`函数计算每个唯一值出现的次数，最后使用`which.max()`函数获取最大值的索引。结果显示，大多数角色在整个漫威漫画的历史中只出现了一次。
- en: Now, let’s look at a detailed breakdown of mean and median appearances by `ALIGN`.
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在，让我们详细分析通过`ALIGN`的平均值和众数。
- en: 'Calculate the mean and median values of `APPEARANCES` by each level of `ALIGN`:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过每个`ALIGN`级别计算`APPEARANCES`的平均值和众数：
- en: '[PRE32]'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The result shows that good characters appear more often than bad ones.
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 结果显示，好人角色比坏人角色出现得更频繁。
- en: Next, we will look at how to measure the variability of a continuous variable.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将探讨如何测量连续变量的变异性。
- en: Measuring variability
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测量变异性
- en: As with central concentration, several metrics can be used to measure the variability
    or dispersion of a continuous variable. Some are sensitive to outliers, such as
    variance and standard deviation, while others are robust to outliers, such as
    **inter-quantile range** (**IQR**). Let’s go through an exercise on how to calculate
    these metrics.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 与集中趋势一样，可以使用多个指标来衡量连续变量的变异性或分散性。其中一些对异常值敏感，如方差和标准差，而其他对异常值稳健，如**四分位数间距**（**IQR**）。让我们通过一个练习来了解如何计算这些指标。
- en: Note that robust measures such as median and IQR are used in box plots, although
    more details are hidden compared to the full density of a given variable.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，在箱线图中使用的是稳健的度量，如中位数和IQR，尽管与给定变量的完整密度相比，隐藏了更多细节。
- en: Exercise 5.6 – calculating the variability of a continuous variable
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习5.6 - 计算连续变量的变异性
- en: In this exercise, we will calculate different metrics on variability both manually
    and using built-in functions. We will start with variance, which is calculated
    as the average squared difference between each raw value and the mean value. Note
    that this is how population variance is calculated. To calculate the sample variance,
    we need to adjust the averaging operation by subtracting 1 from the total number
    of observations used in the variance calculation.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将手动和通过内置函数计算不同的变异度指标。我们将从方差开始，它是通过计算每个原始值与平均值之间的平均平方差来计算的。请注意，这就是总体方差是如何计算的。为了计算样本方差，我们需要调整平均操作，即在方差计算中使用的总观测数减去1。
- en: 'In addition, variance is a squared version of the original unit and is thus
    not easily interpretable. To measure the variability of the data at the same original
    scale, we can use standard deviation, which is calculated by taking the square
    root of the variance. Let’s look at how to achieve this in practice:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，方差是原始单位的平方版本，因此不易解释。为了在相同的原始尺度上衡量数据的变异性，我们可以使用标准差，它是通过对方差取平方根来计算的。让我们看看如何在实践中实现这一点：
- en: 'Calculate the population variance of `APPEARANCES` after removing `NA` values.
    Keep two decimal points:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算移除`NA`值后的`APPEARANCES`的总体方差。保留两位小数：
- en: '[PRE33]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Here, we first remove `NA` values from `APPEARANCES` and save the result in
    `tmp`. Next, we subtract the mean value of `tmp` from each original value, square
    the result, sum all values, and then divide by the number of observations in `tmp`.
    This essentially follows the definition of variance, which measures the average
    variability of each observation to the central tendency – in other words, the
    mean value.
  id: totrans-174
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这里，我们首先从`APPEARANCES`中移除`NA`值，并将结果保存在`tmp`中。接下来，我们从`tmp`的每个原始值中减去`tmp`的平均值，将结果平方，求和所有值，然后除以`tmp`中的观测数。这本质上遵循方差的定义，即衡量每个观测值相对于中心趋势的平均变异性——换句话说，就是平均值。
- en: We can also calculate the sample variance.
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们也可以计算样本方差。
- en: 'Calculate the sample variance of `APPEARANCES`:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算`APPEARANCES`的样本方差：
- en: '[PRE34]'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The result is now slightly different from the population variance. Note that
    to calculate the sample mean, we simply use one less observation in the denominator.
    Such adjustment is necessary, especially when we are working with limited sample
    data, although the difference becomes small as the sample size grows.
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 结果现在与总体方差略有不同。请注意，为了计算样本均值，我们在分母中简单地使用一个更少的观测值。这种调整是必要的，尤其是在我们处理有限的样本数据时，尽管随着样本量的增加，差异变得很小。
- en: We can also calculate sample variance by calling the `var()` function.
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们也可以通过调用`var()`函数来计算样本方差。
- en: 'Calculate sample variance using `var()`:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`var()`计算样本方差：
- en: '[PRE35]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: The result is aligned with our previous manual calculation of the sample variance.
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 结果与我们的先前手动计算的样本方差一致。
- en: To obtain the measure of variability at the same unit as the original observations,
    we can calculate the standard deviation. This can be achieved using the `sd()`
    function.
  id: totrans-183
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了获得与原始观测值相同的单位的变异性度量，我们可以计算标准差。这可以通过使用`sd()`函数来实现。
- en: 'Calculate the standard deviation using `sd()`:'
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`sd()`计算标准差：
- en: '[PRE36]'
  id: totrans-185
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Another measure of variability is IQR, which is the difference between the third
    and first quantiles and quantifies the range of the majority values.
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 变异性的另一个度量是四分位数间距（IQR），它是第三四分位数和第一四分位数之间的差值，并量化了大多数值的范围。
- en: 'Calculate the IQR using `IQR()`:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`IQR()`计算四分位数间距：
- en: '[PRE37]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'We can also verify the result by calling the `summary()` function, which returns
    the different quantile values:'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们也可以通过调用`summary()`函数来验证结果，该函数返回不同的四分位数值：
- en: '[PRE38]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: As discussed earlier, measures such as variance and standard deviation are sensitive
    to extreme values in the data, while IQR is a robust measure of outliers. We can
    assess the change to these measures after removing the maximal value from `tmp`.
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如前所述，方差和标准差等度量对数据中的极端值敏感，而四分位数范围（IQR）是对异常值稳健的度量。我们可以评估从`tmp`中移除最大值后这些度量的变化。
- en: 'Calculate the standard deviation and IQR after removing the maximum from `tmp`:'
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从`tmp`中移除最大值后的标准差和四分位数范围（IQR）：
- en: '[PRE39]'
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: The result shows that IQR stays the same after removing the maximum, thus being
    a more robust measure compared to standard deviation.
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 结果显示，移除最大值后IQR保持不变，因此比标准差更稳健的度量。
- en: We can also calculate these measures by different levels of another categorical
    variable.
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们还可以通过另一个分类变量的不同级别来计算这些度量。
- en: 'Calculate the standard deviation, IQR, and count of `APPEARANCES` for each
    level of `ALIGN`:'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算每个`ALIGN`级别的`APPEARANCES`的标准差、四分位数范围（IQR）和计数：
- en: '[PRE40]'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Next, we will dive deeper into the skewness in the distribution of a continuous
    variable.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将更深入地探讨连续变量分布中的偏度。
- en: Working with skewed distributions
  id: totrans-199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 处理偏斜分布
- en: 'Besides the mean and standard deviation, we can also characterize the distribution
    of a continuous variable using modality and skewness. Modality refers to the number
    of humps that exist in the continuous distribution. For example, a unimodal distribution,
    the most popular distribution we have seen so far in the form of a bell curve,
    has one peak across the whole distribution. It can grow into a bimodal distribution
    when there are two humps and multimodal distribution when there are three humps
    or more. If there is no discernable mode and the distribution appears flat across
    the whole support region (the range of the continuous variable), it is referred
    to as a uniform distribution. *Figure 5**.14* summarizes the distributions of
    different modalities:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 除了平均值和标准差之外，我们还可以使用模态和偏度来描述连续变量的分布。模态指的是连续分布中存在的峰的数量。例如，单峰分布，我们迄今为止最常见的形式是钟形曲线，整个分布中只有一个峰值。当有两个峰时，它可以变成双峰分布；当有三个或更多峰时，它变成多峰分布。如果没有可辨别的模态，并且分布在整个支持区域（连续变量的范围）上看起来平坦，则称为均匀分布。*图5.14*总结了不同模态的分布：
- en: '![Figure 5.14 – Different types of modalities in a distribution](img/B18680_05_014.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![图5.14 – 分布中不同类型的模态](img/B18680_05_014.jpg)'
- en: Figure 5.14 – Different types of modalities in a distribution
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.14 – 分布中不同类型的模态
- en: 'On the other hand, a continuous variable may be skewed toward the left or the
    right or appear symmetric around the central tendency. A right-skewed distribution
    contains more extreme values on the right tail of the distribution, while a left-skewed
    distribution has a long tail on the left-hand side. *Figure 5**.15* illustrates
    the different types of skewness in a distribution:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，连续变量可能向左或向右偏斜，或者围绕中心趋势对称。右偏斜分布在其分布的右尾包含更多的极端值，而左偏斜分布在其左侧有长尾。*图5.15*说明了分布中不同类型的偏度：
- en: '![Figure 5.15 – Different types of skewness in a distribution](img/B18680_05_015.jpg)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![图5.15 – 分布中的不同类型偏度](img/B18680_05_015.jpg)'
- en: Figure 5.15 – Different types of skewness in a distribution
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.15 – 分布中的不同类型偏度
- en: Distribution can also attribute its skewness to outliers in a continuous variable.
    When there are multiple outliers in the data, sensitive measures such as mean
    and variance will become distorted, causing a shift in distribution toward the
    outliers. Let’s go through an exercise to understand how to deal with skewness
    and outliers in a distribution.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 分布也可以将它的偏斜归因于连续变量中的异常值。当数据中有多个异常值时，敏感的度量如平均值和方差将变得扭曲，导致分布向异常值偏移。让我们通过一个练习来了解如何处理分布中的偏斜和异常值。
- en: Exercise 5.7 – working with skewness and outliers
  id: totrans-207
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习5.7 – 处理偏斜和异常值
- en: 'In this exercise, we will look at how to work with a skewed distribution that
    contains many extreme values, especially outliers in the data:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将探讨如何处理包含许多极端值，特别是数据中的异常值的偏斜分布：
- en: 'Visualize the density plot of `APPEARANCES` by `ALIGN` for observations since
    the year `2000`. Set the transparency level to `0.2`:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过`ALIGN`可视化`APPEARANCES`的密度图，对于自2000年以来的观测值。设置透明度为`0.2`：
- en: '[PRE41]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Running this command generates *Figure 5**.16*, where all three distributions
    are quite skewed toward the right, an obvious sign of many outliers in the data:'
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.16*，其中所有三个分布都相当右偏斜，这是数据中存在许多异常值的明显迹象：
- en: '![Figure 5.16 – Density plot of APPEARANCES by ALIGN](img/B18680_05_016.jpg)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![图5.16 – 由ALIGN生成的`APPEARANCES`密度图](img/B18680_05_016.jpg)'
- en: Figure 5.16 – Density plot of APPEARANCES by ALIGN
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.16 – 由ALIGN生成的`APPEARANCES`密度图
- en: 'Remove observations whose `APPEARANCES` are above the 90th percentile and generate
    the same plot:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 移除`APPEARANCES`值超过90百分位的观测值并生成相同的图表：
- en: '[PRE42]'
  id: totrans-215
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Running this command generates *Figure 5**.17*, where all three distributions
    are much less right-skewed than before. Removing outliers is one way to work around
    extreme values, although the information contained in the removed observations
    is lost. To control the effect of outliers and retain their presence at the same
    time, we can transform the continuous variable using the `log()` function, which
    brings it to the logarithmic scale. Let’s see how this works in practice:'
  id: totrans-216
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.17*，其中所有三个分布都比之前更少地右偏斜。移除异常值是处理极端值的一种方法，尽管移除的观测值中的信息已经丢失。为了控制异常值的影响并同时保留它们的存在，我们可以使用`log()`函数对连续变量进行变换，将其转换为对数尺度。让我们看看这在实践中是如何工作的：
- en: '![Figure 5.17 – Density plot of APPEARANCES by ALIGN after removing outliers](img/B18680_05_017.jpg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![图5.17 – 移除异常值后，由ALIGN生成的`APPEARANCES`密度图](img/B18680_05_017.jpg)'
- en: Figure 5.17 – Density plot of APPEARANCES by ALIGN after removing outliers
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.17 – 移除异常值后，由ALIGN生成的`APPEARANCES`密度图
- en: 'Apply log transformation to `APPEARANCES` and re-generate the same plot:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对`APPEARANCES`应用对数变换并重新生成相同的图表：
- en: '[PRE43]'
  id: totrans-220
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Running this command generates *Figure 5**.18*, where the three density plots
    appear as a bimodal distribution and not as right-skewed as before. Transforming
    the continuous variable using the logarithmic function could thus bring the original
    value to a more controlled scale:'
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成*图5.18*，其中三个密度图呈现出双峰分布，而不是之前的右偏斜。因此，使用对数函数对连续变量进行变换可以将原始值转换为更受控制的尺度：
- en: '![Figure 5.18 – Density plot of APPEARANCES by ALIGN after applying log transformation](img/B18680_05_018.jpg)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
  zh: '![图5.18 – 应用对数变换后，由ALIGN生成的`APPEARANCES`密度图](img/B18680_05_018.jpg)'
- en: Figure 5.18 – Density plot of APPEARANCES by ALIGN after applying log transformation
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.18 – 应用对数变换后，由ALIGN生成的`APPEARANCES`密度图
- en: In the next section, we will go through a case study to enhance our skills when
    conducting EDA on a new dataset.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将通过一个案例研究来提高我们在对新的数据集进行EDA时的技能。
- en: EDA in practice
  id: totrans-225
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实践中的EDA
- en: In this section, we will analyze a dataset that consists of the stock prices
    of the top five companies in 2021\. First, we will look at how to download and
    process these stock indexes, followed by performing univariate analysis and bivariate
    analysis in terms of correlation.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将分析一个由2021年五大公司股票价格组成的数据库。首先，我们将探讨如何下载和处理这些股票指数，然后进行单变量分析和基于相关性的双变量分析。
- en: Obtaining the stock price data
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 获取股票价格数据
- en: To obtain the daily stock prices of a particular ticker, we can use the `yfR`
    package to download the data from Yahoo! Finance, a vast repository of financial
    data that covers a large number of markets and assets and has been widely used
    in both academia and industry. The following exercise illustrates how to download
    the stock data using `yfR`.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取特定股票代码的每日股票价格，我们可以使用`yfR`包从Yahoo! Finance下载数据，这是一个包含大量市场和资产金融数据的庞大仓库，在学术界和工业界都得到了广泛的应用。以下练习说明了如何使用`yfR`下载股票数据。
- en: Exercise 5.8 – downloading stock prices
  id: totrans-229
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习5.8 – 下载股票价格
- en: 'In this exercise, we will look at how to specify the different parameters so
    that we can download stock prices from Yahoo! Finance, including the ticker name
    and date range:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将探讨如何指定不同的参数，以便我们可以从Yahoo! Finance下载股票价格，包括股票代码和日期范围：
- en: 'Install and load the `yfR` package:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装并加载`yfR`包：
- en: '[PRE44]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Note that we would need to wrap the package name inside a pair of double quotes
    in the `install.packages()` function.
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意，在`install.packages()`函数中，我们需要将包名用一对双引号括起来。
- en: 'Specify the starting and end date parameters, as well as the ticker names so
    that they cover Facebook (now `META`), Netflix (`NFLX`), Google (`GOOG`), Amazon
    (`AMZN`), and Microsoft (`MSFT`):'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定起始日期和结束日期参数，以及股票代码，以确保它们覆盖Facebook（现在为`META`）、Netflix（`NFLX`）、Google（`GOOG`）、Amazon（`AMZN`）和Microsoft（`MSFT`）：
- en: '[PRE45]'
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Here, the start and end dates are formatted as the `Date` type, and the ticker
    names are concatenated in a vector.
  id: totrans-236
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这里，起始日期和结束日期格式化为 `Date` 类型，股票名称连接成一个向量。
- en: 'Download the stock prices using the `yf_get()` function and store the result
    in `df`:'
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `yf_get()` 函数下载股票价格并将结果存储在 `df` 中：
- en: '[PRE46]'
  id: totrans-238
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Running this command generates the following message, which shows that the
    data for all five stocks has been downloaded successfully. Each ticker has 252
    rows in 2021 since there are 252 trading days in a year:'
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令会生成以下消息，显示已成功下载所有五只股票的数据。由于一年中有 252 个交易日，每只股票在 2021 年有 252 行数据：
- en: '[PRE47]'
  id: totrans-240
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Let’s examine the structure of the dataset:'
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 让我们检查数据集的结构：
- en: '[PRE48]'
  id: totrans-242
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: The data that’s been downloaded includes information such as the daily opening,
    closing, highest, and closet prices for each ticker.
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 下载的数据包括每日开盘价、收盘价、最高价和最低价等信息。
- en: In the following sections, we will use the adjusted price field, `price_adjusted`,
    which is adjusted for corporate events such as splits, dividends, and others.
    This is usually what we would use when analyzing stocks as it represents the actual
    financial performance of the stockholders.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下章节中，我们将使用调整后的价格字段 `price_adjusted`，该字段已调整公司事件，如拆股、股息等。通常，我们在分析股票时使用它，因为它代表了股东的实际财务表现。
- en: Univariate analysis of individual stock prices
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 单变量分析个别股票价格
- en: In this section, we will perform a graphical analysis based on the stock prices.
    Since the stock prices are time series data that are numerical, we will use plots
    such as histograms, density plots, and box plots for visualization purposes.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将基于股票价格进行图形分析。由于股票价格是数值型的时间序列数据，我们将使用直方图、密度图和箱线图等图表进行可视化。
- en: Exercise 5.9 – downloading stock prices
  id: totrans-247
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 5.9 – 下载股票价格
- en: 'In this exercise, we will start with the time series plots for the five stocks,
    followed by generating other types of plots suitable for continuous variables:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在本练习中，我们将从五只股票的时间序列图开始，然后生成适合连续变量的其他类型图表：
- en: 'Generate the time series plots for the five plots:'
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为五只股票生成时间序列图：
- en: '[PRE49]'
  id: totrans-250
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Running this command generates *Figure 5**.19*, where Netflix takes the lead
    in terms of stock value. However, it also suffers from a huge fluctuation, especially
    around November 2021:'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成 *图 5.19*，其中 Netflix 在股票价值方面领先。然而，它也遭受了巨大的波动，尤其是在 2021 年 11 月左右：
- en: '![Figure 5.19 – Time series plots of the five stocks](img/B18680_05_019.jpg)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![图 5.19 – 五只股票的时间序列图](img/B18680_05_019.jpg)'
- en: Figure 5.19 – Time series plots of the five stocks
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.19 – 五只股票的时间序列图
- en: 'Generate a histogram for each of the five stocks, with 100 bins for each histogram:'
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为五只股票中的每一只生成一个直方图，每个直方图有 100 个区间：
- en: '[PRE50]'
  id: totrans-255
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Running this command generates *Figure 5**.20*, which shows that Netflix has
    the biggest mean and variance in terms of stock value. Google and Amazon seem
    to share a similar spread, and the same goes for Facebook and Microsoft:'
  id: totrans-256
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成 *图 5.20*，显示 Netflix 在股票价值方面具有最大的平均值和方差。Google 和 Amazon 似乎具有相似的分布，Facebook
    和 Microsoft 也是如此：
- en: '![Figure 5.20 – Histograms of the five stocks](img/B18680_05_020.jpg)'
  id: totrans-257
  prefs: []
  type: TYPE_IMG
  zh: '![图 5.20 – 五只股票的直方图](img/B18680_05_020.jpg)'
- en: Figure 5.20 – Histograms of the five stocks
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.20 – 五只股票的直方图
- en: 'Generate a density plot for each of the five stocks. Set the transparency level
    to `0.2`:'
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为五只股票中的每一只生成一个密度图。将透明度设置为 `0.2`：
- en: '[PRE51]'
  id: totrans-260
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Running this command generates *Figure 5**.21*, where the plots are now visually
    clearer compared to the histograms:'
  id: totrans-261
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成 *图 5.21*，与直方图相比，这些图现在在视觉上更清晰：
- en: '![Figure 5.21 – Density plots of the five stocks](img/B18680_05_021.jpg)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![图 5.21 – 五只股票的密度图](img/B18680_05_021.jpg)'
- en: Figure 5.21 – Density plots of the five stocks
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.21 – 五只股票的密度图
- en: 'Generate a box plot for each of the five stocks:'
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为五只股票中的每一只生成一个箱线图：
- en: '[PRE52]'
  id: totrans-265
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Running this command generates *Figure 5**.22*. Box plots are good at indicating
    the central tendency and variation of each stock. For example, Netflix has the
    biggest mean and variance across all five stocks:'
  id: totrans-266
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行此命令生成 *图 5.22*。箱线图擅长显示每只股票的中心趋势和变异。例如，Netflix 在所有五只股票中具有最大的平均值和方差：
- en: '![Figure 5.22 – Box plots of the five stocks](img/B18680_05_022.jpg)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![图 5.22 – 五只股票的箱线图](img/B18680_05_022.jpg)'
- en: Figure 5.22 – Box plots of the five stocks
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.22 – 五只股票的箱线图
- en: 'Obtain the mean, standard deviation, IQR, and count of each stock:'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取每只股票的平均值、标准差、四分位数范围和计数：
- en: '[PRE53]'
  id: totrans-270
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: In the next section, we will look at the pairwise correlation between each pair
    of stocks.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将查看每对股票之间的成对相关性。
- en: Correlation analysis
  id: totrans-272
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关性分析
- en: Correlation measures the strength of covariation between two variables. There
    are several ways to calculate the specific value of correlation, with Pearson
    correlation being the most widely used. Pearson correlation is a value that ranges
    from -1 to 1, with 1 indicating two perfectly and positively correlated variables
    and -1 denoting perfect negative correlation. Perfect correlation means that the
    change in the value of one variable is always proportional to the change in the
    value of another variable. For example, when y = 2x, the correlation between variable
    x and y is 1 since y always changes positively in proportion to x.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 相关性衡量两个变量之间协变的强度。有几种方法可以计算相关性的具体值，其中皮尔逊相关是最广泛使用的。皮尔逊相关是一个介于 -1 到 1 之间的值，其中 1
    表示两个完全且正相关的变量，-1 表示完美的负相关性。完美的相关性意味着一个变量的值的变化总是与另一个变量的值的变化成比例。例如，当 y = 2x 时，变量
    x 和 y 之间的相关性为 1，因为 y 总是正比于 x 而变化。
- en: Instead of manually calculating the pairwise correlation between all variables,
    we can use the `corrplot` package to calculate and visualize pairwise correlations
    automatically. Let’s go through an exercise on how this can be achieved.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不必手动计算所有变量之间的成对相关性，可以使用 `corrplot` 包自动计算和可视化成对相关性。让我们通过一个练习来看看如何实现这一点。
- en: Exercise 5.10 – downloading stock prices
  id: totrans-275
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 5.10 – 下载股票价格
- en: 'In this exercise, we will first convert the previous DataFrame from long into
    wide format so that each stock has a separate column indicating the adjusted price
    across different days/rows. The wide-format dataset will then be used to generate
    the pairwise correlation plot:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们首先将之前的 DataFrame 从长格式转换为宽格式，以便每个股票都有一个单独的列，表示不同日期/行之间的调整价格。然后，将使用宽格式数据集生成成对相关性图：
- en: 'Convert the previous dataset into a wide format using the `spread()` function
    in the `tidyr` package. Save the result in `wide_df`:'
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `tidyr` 包中的 `spread()` 函数将之前的数据集转换为宽格式，并将结果保存在 `wide_df` 中：
- en: '[PRE54]'
  id: totrans-278
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Here, we first select three variables, with `ref_date` as the row-level date
    index, `ticker`, whose unique values serve as the columns to be spread across
    the DataFrame, and `price_adjusted`, to be used to fill in the cells of the wide
    DataFrame. With this, we can examine the first few rows of the new dataset:'
  id: totrans-279
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这里，我们首先选择三个变量，其中 `ref_date` 作为行级日期索引，`ticker` 的唯一值作为要分散在 DataFrame 中的列，`price_adjusted`
    用于填充宽 DataFrame 的单元格。有了这些，我们可以检查新数据集的前几行：
- en: '[PRE55]'
  id: totrans-280
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: Now, the DataFrame has been converted from a long format into a wide format,
    which will facilitate the creation of correlation plots later on.
  id: totrans-281
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在，DataFrame 已经从长格式转换为宽格式，这将有助于稍后创建相关性图。
- en: 'Generate a correlation plot using the `corrplot()` function from the `corrplot`
    package (to be installed if you have not done so already):'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `corrplot` 包中的 `corrplot()` 函数生成相关性图（如果尚未安装，请先安装）：
- en: '[PRE56]'
  id: totrans-283
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Running these commands generates *Figure 5**.23*. Each circle represents the
    strength of correlation between the corresponding stocks, where a bigger and darker
    circle denotes a stronger correlation:'
  id: totrans-284
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 执行这些命令会生成 *图 5**.23*。每个圆圈代表对应股票之间相关性的强度，其中更大、更暗的圆圈表示更强的相关性：
- en: '![Figure 5.23 – Correlation plot between each pair of stocks](img/B18680_05_023.jpg)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
  zh: '![图 5.23 – 每对股票之间的相关性图](img/B18680_05_023.jpg)'
- en: Figure 5.23 – Correlation plot between each pair of stocks
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.23 – 每对股票之间的相关性图
- en: 'Note that the correlation plot relies on the `cor_table` variable, which stores
    the pairwise correlation as a table, as shown here:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，相关性图依赖于 `cor_table` 变量，该变量存储成对相关性作为表格，如下所示：
- en: '[PRE57]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: A high correlation between variables may or may not be a good thing. When the
    dependent variable (also called the target outcome) to be predicted is highly
    correlated with an independent variable (also called a predictor, feature, or
    covariate), we would prefer to include this feature in the prediction model due
    to its high covariation with the target variable. On the other hand, when two
    features are highly correlated, we tend to ignore one and choose the other or
    apply some sort of regularization and feature selection approach to downsize the
    impact of correlated features.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 变量之间的高度相关性可能好也可能不好。当需要预测的因变量（也称为目标结果）与自变量（也称为预测变量、特征或协变量）高度相关时，我们更愿意将这个特征包含在预测模型中，因为它与目标变量的协变很高。另一方面，当两个特征高度相关时，我们倾向于忽略其中一个并选择另一个，或者应用某种正则化和特征选择方法来减少相关特征的影响。
- en: Summary
  id: totrans-290
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we introduced basic techniques to conduct EDA. We started by
    going over the common approaches to analyzing and summarizing categorical data,
    including frequency count and bar charts. We then introduced marginal distribution
    and faceted bar charts when working with multiple categorical variables.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了进行EDA的基本技术。我们首先回顾了分析和管理分类数据的常见方法，包括频率计数和条形图。然后，当我们处理多个分类变量时，我们介绍了边缘分布和分面条形图。
- en: Next, we switched to analyzing numerical variables and covered sensitive measures
    such as central tendency (mean) and variation (variance), as well as robust measures
    such as median and IQR. Several types of charts are available for visualizing
    a numerical variable, including histograms, density plots, and box plots, all
    of which can be combined with another categorical variable.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们转向分析数值变量，并涵盖了敏感度量，如集中趋势（均值）和变异（方差），以及稳健度量，如中位数和四分位数间距。有几种图表可用于可视化数值变量，包括直方图、密度图和箱线图，所有这些都可以与另一个分类变量结合使用。
- en: Finally, we went through a case study using the stock price data. We started
    by downloading the real data from Yahoo! Finance and applying all the EDA techniques
    to analyze the data, followed by creating a correlation plot to indicate the strength
    of covariation between each pair of variables. This allows us to develop a helpful
    understanding of the relationship between variables and jump-start the predictive
    modeling stage.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们通过使用股票价格数据进行了案例研究。我们首先从Yahoo! Finance下载了真实数据，并应用所有EDA技术来分析数据，然后创建了一个相关性图来指示每对变量之间协变的强度。这使我们能够对变量之间的关系有一个有帮助的理解，并启动预测建模阶段。
- en: In the next chapter, we will cover r markdown, a widely used package to generate
    interactive reports in R.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍r markdown，这是一个广泛使用的R包，用于生成交互式报告。

- en: Predicting Failures of Banks - Descriptive Analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测银行失败 - 描述性分析
- en: In this chapter, we will learn how to understand and prepare our dataset of
    banks for model development. We will answer questions regarding the number of
    variables we have and their quality. Descriptive analysis is crucial to understanding
    our data and for analyzing possible problems with the information quality. We
    will see how to deal with missing values, convert variables into different formats,
    and how to split our data to train and validate our predictive model.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将学习如何理解并准备我们的银行数据集以进行模型开发。我们将回答有关我们有多少变量以及它们的质量的问题。描述性分析对于理解我们的数据和分析信息质量可能存在的问题至关重要。我们将看到如何处理缺失值，将变量转换为不同的格式，以及如何分割我们的数据以训练和验证我们的预测模型。
- en: 'Specifically, we will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 具体来说，我们将涵盖以下主题：
- en: Data overview
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据概览
- en: Converting formats
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 格式转换
- en: Sampling
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 抽样
- en: Dealing with missing and outliers values
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 处理缺失值和异常值
- en: Implementing descriptive analysis
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实施描述性分析
- en: Data overview
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据概览
- en: 'First, we are going to analyze the types of variables that we have in the dataset.
    For that, we can use the `class` function, which tells us whether a variable is
    a number, a character, or a matrix. For example, the class of the identifying
    number of a bank `ID_RSSD` can be obtained as follows:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将分析数据集中变量的类型。为此，我们可以使用 `class` 函数，它告诉我们一个变量是数字、字符还是矩阵。例如，银行识别号 `ID_RSSD`
    的类别可以这样获得：
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This function indicates that this variable is a number without decimals.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 这个函数表明这个变量是一个没有小数的数字。
- en: 'We can calculate the same information for all the variables and store it using
    the following code:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用以下代码计算所有变量的相同信息并将其存储起来：
- en: '[PRE1]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'With `sapply`, calculate iteratively the `class` function on the dataset. Then,
    combine the name of variables with the class in only a data frame, and, finally,
    rename the resulting dataset:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `sapply`，迭代地对数据集上的 `class` 函数进行计算。然后，将变量的名称与仅在一个数据框中的类别结合起来，最后重命名生成的数据集：
- en: '[PRE2]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'This dataset contains four different types of variables:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 这个数据集包含四种不同类型的变量：
- en: '[PRE3]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: According to previous steps, we know that only variables with a `Date` format
    collect the date of financial statements.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 根据之前的步骤，我们知道只有具有 `Date` 格式的变量收集财务报表的日期。
- en: Getting acquainted with our variables
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 熟悉我们的变量
- en: The character type of some variables is not yet clear. Our dataset belongs to
    the financial domain and has only financial ratios as data, so we'd expect variable
    types to be integers or numerical. Let's find out whether we're right.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 一些变量的字符类型尚不明确。我们的数据集属于金融领域，并且只有金融比率作为数据，所以我们预计变量类型应该是整数或数值。让我们找出我们是否正确。
- en: 'Filter the `character` variables:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤 `character` 变量：
- en: '[PRE4]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The first variable, `UBPRE543`, measures the total losses of a bank providing
    construction loans divided by the total amount of granted construction loans.
    As we suspected, this variable should be numeric, a percentage, or a decimal number.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个变量，`UBPRE543`，衡量提供建筑贷款的银行的损失总额与授予的建筑贷款总额之比。正如我们所怀疑的，这个变量应该是数字、百分比或小数。
- en: Finding missing values for a variable
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查找变量的缺失值
- en: 'We are going to count the number of missing values of this variable, `UBPRE543`,
    over time using this code, with the intention of understanding a little more about
    this variable:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用以下代码计算这个变量，`UBPRE543`，随时间变化的缺失值数量，目的是了解这个变量的一些更多信息：
- en: '[PRE5]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: As we can see, the ratio displays some missing values from 2002 to 2006.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，这个比率在 2002 年到 2006 年之间显示了一些缺失值。
- en: 'On the other hand, we can calculate the number of observations by year in the
    dataset using the `table` function:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，我们可以使用 `table` 函数计算数据集中按年份的观测数：
- en: '[PRE6]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Comparing the two preceding tables, we can see this variable is not informed
    during the first years.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 比较前两个表格，我们可以看到这个变量在最初几年没有提供信息。
- en: When we started to upload the `.txt` files into R at the beginning of the exercise,
    as this variable was not informed during the first years, R automatically assigns
    a character format to this variable.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在练习开始时，我们将 `.txt` 文件上传到 R 中时，由于这个变量在最初几年没有提供信息，R 自动将这个变量的格式分配为字符格式。
- en: 'For later years, when the variable was informed, the variable was read as numeric,
    but the format changed when all the years were merged together into a data frame,
    just when we executed this code:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 对于后来的年份，当变量有信息时，变量被读取为数值，但在将所有年份合并到数据框中时格式发生了变化，就在我们执行此代码时：
- en: '[PRE7]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The format of variables in the first table used in the `rbind` function, belonging
    to the year 2002, fixed and conditioned the format of the resulting merged table.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在`rbind`函数中使用的第一个表格中变量的格式，属于2002年，固定并决定了合并后的结果表格的格式。
- en: Converting the format of the variables
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 转换变量的格式
- en: 'We now need to convert all these variables into a numeric format. From the
    second variable (the first is the identifier) to the rest of variables in the
    data frame, variables will be explicitly converted to a numeric. The last two
    variables will be also be excluded from this process (`Date` and the target variable).
    Let’s convert variables to a numeric format with the following code:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在需要将这些变量全部转换为数值格式。从第二个变量（第一个是标识符）到数据框中的其余变量，变量将被显式转换为数值。最后两个变量也将被排除在此过程之外（`Date`和目标变量）。让我们使用以下代码将变量转换为数值格式：
- en: '[PRE8]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Let’s see whether the changes have been applied:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看这些更改是否已经应用：
- en: '[PRE9]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Before continuing with the development, and once we have solved problems in
    the data formats, in the following section, we will specify which part of the
    sample will be used for the development and which part to validate the model.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续开发之前，一旦我们解决了数据格式的问题，在下一节中，我们将指定样本的哪一部分用于开发，哪一部分用于验证模型。
- en: Sampling
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 采样
- en: 'All the following steps and descriptive analysis will be done only considering
    the training or development sample. Therefore, our data will be divided into two
    samples:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 所有后续步骤和描述性分析都只考虑训练或开发样本。因此，我们的数据将被分为两个样本：
- en: '**Training set**: It usually represents 70% of the data and it is used to train
    the model (select the parameters that better fit the model).'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**训练集**：通常代表数据的70%，用于训练模型（选择更适合模型的参数）。'
- en: '**Validation set**: It usually represents 30% of the data and it is used to
    measure how well the model performs at making predictions.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**验证集**：通常代表数据的30%，用于衡量模型在做出预测时的表现。'
- en: Partitioning samples
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 样本分区
- en: Although there are numerous approaches to achieve data partitioning, the `caTools`
    package is one of the most useful. This package contains a function called `sample.split`,
    which generates random numbers to split a sample but keeps the proportion of *bads*
    and *goods* in the original dataset also in the separated samples.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管有众多方法可以实现数据分区，但`caTools`包是最有用的之一。此包包含一个名为`sample.split`的函数，该函数生成随机数以分割样本，但同时也保持原始数据集中*不良*和*良好*的比例在分离的样本中。
- en: 'As the `caTools` package uses random numbers, it is convenient to fix a `seed`
    to the replicability of the results:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`caTools`包使用随机数，固定一个`seed`可以方便地保证结果的复现性：
- en: '[PRE10]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Then, use the `sample.split` function:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，使用`sample.split`函数：
- en: '[PRE11]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: This function takes two arguments, the target variable and the partition size,
    in our case, the 70%.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 此函数接受两个参数，目标变量和分区大小，在我们的案例中，是70%。
- en: 'It generates an `index` with two values, `TRUE` and `FALSE`, which can be used
    to split the dataset into the two desired samples:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 它生成一个`index`，包含两个值，`TRUE`和`FALSE`，可以用来将数据集分割成两个所需的样本：
- en: '[PRE12]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Checking samples
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检查样本
- en: 'Let’s check the number of observations and the proportion of failed banks over
    the total banks in each sample:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们检查每个样本中观察值的数量以及失败银行的占比：
- en: '[PRE13]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: As can be seen, train and test samples represent 70% and 30% of the total sample
    respectively. Both samples maintain approximately the same ratio of failed banks,
    that is, 4.7%.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 如所示，训练样本和测试样本分别占总样本的70%和30%。这两个样本中失败银行的比率保持大致相同，即4.7%。
- en: Implementing descriptive analysis
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实施描述性分析
- en: Descriptive statistical analysis helps you to understand your data properly.
    Although R provides some functions by default to perform basic statistics, we
    will use two better alternatives, the `DataExplorer` and `fBasics` packages.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 描述性统计分析有助于您正确理解您的数据。尽管R默认提供了一些函数来执行基本统计，但我们将使用两个更好的替代方案，即`DataExplorer`和`fBasics`包。
- en: 'Follow these simple steps:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下简单步骤进行：
- en: 'As the number of variables in the dataset is high, we will create a list with
    the variable names to use in our descriptive functions:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于数据集中变量的数量很高，我们将创建一个包含要用于描述性函数的变量名的列表：
- en: '[PRE14]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'A list of 1,492 variables is created. Pass this list to the `basicStats` function
    included in the `fBasics` package:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建了一个包含1,492个变量的列表。将此列表传递给`fBasics`包中包含的`basicStats`函数：
- en: '[PRE15]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We can calculate the following descriptives:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以计算以下描述性统计量：
- en: Number of observations (`nobs`)
  id: totrans-66
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 观察值数量（`nobs`）
- en: Number of missing values (`NAs`)
  id: totrans-67
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缺失值的数量 (`NAs`)
- en: Minimum value (`Minimum`)
  id: totrans-68
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最小值 (`Minimum`)
- en: Maximum value (`Maximum`)
  id: totrans-69
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大值 (`Maximum`)
- en: First and third quartiles (`1\. Quartile` and `3\. Quartile`)
  id: totrans-70
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一和第三四分位数 (`1. Quartile` 和 `3. Quartile`)
- en: Median (`Median`)
  id: totrans-71
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 中位数 (`Median`)
- en: Sum of the values in the variable (`Sum`)
  id: totrans-72
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 变量中值的总和 (`Sum`)
- en: Standard error of the mean (`SE Mean`)
  id: totrans-73
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 均值的标准误差 (`SE Mean`)
- en: Lower Confidence Limit (`LCL Mean`)
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 均值下置信限 (`LCL Mean`)
- en: Upper Confidence Limit (`UCL Mean`)
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 均值上置信限 (`UCL Mean`)
- en: Variance (`Variance`)
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 方差 (`Variance`)
- en: Standard deviation (`Stdev`)
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标准差 (`Stdev`)
- en: Skewness (`Skewness`)
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 偏度 (`Skewness`)
- en: Kurtosis (`Kurtosis`)
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 峰度 (`Kurtosis`)
- en: In this step, we will detect variables with a high number of missing values,
    the range, and dispersion of variables, even if a variable has only a unique value.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这一步，我们将检测具有大量缺失值的变量，变量的范围和离散度，即使变量只有一个唯一值。
- en: When the number of variables is high, as in our case, this task is not so easy
    and we need some time to analyze variables. A graphical analysis of variables
    is also important and complementary.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 当变量的数量很高，如我们的案例，这项任务并不容易，我们需要一些时间来分析变量。变量的图形分析也很重要，并且是补充性的。
- en: 'The `plot_histogram` function is very useful for visualizing variables. This
    function is available in the `DataExplorer` package:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '`plot_histogram` 函数对于可视化变量非常有用。此函数在 `DataExplorer` 包中可用：'
- en: '[PRE16]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The following diagrams display the output of the preceding code. These diagrams
    show a histogram for some of the variables in the data. Here''s the first page
    of the output:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表显示了前面代码的输出。这些图表显示了数据中一些变量的直方图。以下是输出结果的第一页：
- en: '![](img/a7fd1cda-5444-4cdd-a4f9-6ed83a3b549a.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/a7fd1cda-5444-4cdd-a4f9-6ed83a3b549a.png)'
- en: 'Here is the second page of the output:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是输出结果的第二页：
- en: '![](img/a3c76d93-275a-4073-a805-f55e516dcd31.png)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/a3c76d93-275a-4073-a805-f55e516dcd31.png)'
- en: This analysis of distribution of variables is needed to not only understand
    the distribution of variables but also to detect potential problems.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 这种对变量分布的分析不仅需要理解变量的分布，还需要检测潜在的问题。
- en: Dealing with outliers
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理异常值
- en: An important issue is the detection of outliers in the data. **Outliers** are
    the values that look different than a certain set of observations. Consider an
    example of a normal distribution, wherein the values at the tail of the distribution
    can be known as outliers. They are not so closely related to the nearest value
    of the sample.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 一个重要的问题是检测数据中的异常值。**异常值**是看起来与一组观察值不同的值。考虑一个正态分布的例子，其中分布尾部的值可以被认为是异常值。它们与样本中最近的值关系并不紧密。
- en: There are some algorithms very sensitive to outliers, so its treatment is not
    a trivial issue. Detecting outliers is easier if the number of variables is low.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 有些算法对异常值非常敏感，因此其处理不是一个简单的问题。如果变量的数量较少，检测异常值会更容易。
- en: The winsorization process
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Winsorization过程
- en: When the number of outliers is high, we need to to use automatic procedures
    that help to automatically detect them. One of the most effective ways to avoid
    problems with outliers is the **winsorization** **process**.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 当异常值的数量很高时，我们需要使用自动程序来帮助自动检测它们。避免异常值问题的最有效方法之一是**Winsorization** **过程**。
- en: According to this approach, outliers values will be replaced with fixed values.
    If a variable takes a value smaller than a specific threshold, this value will
    be replaced for this limit. The same situation occurs for high values in the variable.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 根据这种方法，异常值将被替换为固定值。如果一个变量的值小于特定的阈值，这个值将被替换为这个极限。对于变量中的高值，情况也是相同的。
- en: Ideally, these limits or thresholds are based on percentiles. Some percentiles
    such as 1, 2.5, or 5 on the lower range, and 95, 97.5, and 99 on the upper one,
    can be selected for the winsorization technique, although other approaches can
    be chosen such as the use of the interquartile range.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 理想情况下，这些极限或阈值基于百分位数。例如，在较低范围内选择1、2.5或5的百分位数，在较高范围内选择95、97.5和99的百分位数，可以用于Winsorization技术，尽管可以选择其他方法，例如使用四分位距。
- en: Implementing winsorization
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实施Winsorization
- en: 'Let’s put the winsorization approach into practice. First, we need to know
    the position of ratios in the dataset:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将 Winsorization 方法付诸实践。首先，我们需要知道数据集中比率的位置：
- en: '[PRE17]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: So, we need to apply the technique to all the variables, excluding the first
    and the last two variables.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们需要将技术应用于所有变量，除了第一个和最后两个变量。
- en: 'All the transformations done in the training set should be applied later in
    the test dataset. Modifications in the test sample will be done using the limits
    of the training data. We will do winsorization for both datasets:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在训练集中完成的全部转换都应该在测试数据集中后续应用。测试样本中的修改将使用训练数据的限制来完成。我们将对两个数据集都进行winsorization：
- en: '[PRE18]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: For each variable, this will calculate the first and the ninety-ninth percentiles
    in the training set. Then, values of outliers exceeding the value of the ninety-ninth
    percentile, or a value smaller than the first percentile are replaced with the
    value of these corresponding percentiles. This means that it establishes a maximum
    and minimum value for each value fixed in the first and the ninety-ninth percentiles.
    This procedure is done for both train and test samples.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个变量，这将计算训练集中的第一和第九十九百分位数。然后，替换超过第九十九百分位数值的异常值，或小于第一百分位数的值，用相应的百分位数值替换。这意味着它为第一和第九十九百分位数中固定的每个值建立了最大和最小值。这个程序对训练和测试样本都进行。
- en: Distinguishing single valued variables
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 区分单值变量
- en: Now, we are going to calculate the number of unique values that a variable takes.
    Thus, if a variable only takes one single value, it can be directly removed from
    the dataset.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将计算一个变量所取的唯一值的数量。因此，如果一个变量只取一个单一值，它可以直接从数据集中删除。
- en: 'The `sapply` function allows the calculation of the `n_distinct` values of
    each variable. Create a new data frame with the name of the constant variables:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '`sapply`函数允许计算每个变量的`n_distinct`值。创建一个新的数据框，包含常量变量的名称：'
- en: '[PRE19]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Rename the name of the variable in this data frame:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个数据框中重命名变量的名称：
- en: '[PRE20]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Add a column in the data frame containing the name of the variables:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据框中添加一个包含变量名称的列：
- en: '[PRE21]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Then create a list with the name of the constant variables:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 然后创建一个包含常量变量名称的列表：
- en: '[PRE22]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Only `84` variables have a unique distinct value. These variables will be removed
    in the `train` and `test` samples:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 只有`84`个变量具有唯一的唯一值。这些变量将在`train`和`test`样本中删除：
- en: '[PRE23]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: One of the problems of winsorization is that, if a variable displays a low number
    of different values, it can replace all the values with only one value . That's
    because a variable could take the same value during several percentile levels.
    It is important to be aware of the pros and cons of each procedure and its effect
    on the development.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: winsorization的一个问题是，如果一个变量显示的不同值数量很少，它可以只用一个值来替换所有值。这是因为一个变量可能在几个百分位数级别上取相同的值。了解每个程序及其对发展的影响的优缺点非常重要。
- en: 'Remember to save your workspace:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 记得保存你的工作空间：
- en: '[PRE24]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Treating missing information
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理缺失信息
- en: Most of the algorithms fail when the data includes missing values or takes a
    predetermined action about how to deal with them in an automatic way. It is important
    to take control when this happens.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数算法在数据包含缺失值或自动处理这些值的预定动作时都会失败。在这种情况下，掌握控制权非常重要。
- en: 'Two actions are the most common to deal with missing information: to remove
    the observations with missing values or to replace them with a concrete value,
    usually the median or mean. When a value is imputed, you could be losing important
    information. For example, a missing value of the variable can be always observed
    in one of the classes of the target variable. A typical case is a model where
    we are trying to predict good and bad applicants for a bank loan.'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 处理缺失信息的两种最常见的方法是：删除具有缺失值的观测值或用具体值（通常是中位数或平均值）替换它们。当进行值插补时，你可能会丢失重要信息。例如，变量的缺失值可能总是出现在目标变量的一个类别中。一个典型的例子是我们试图预测银行贷款的合格和不合格申请人的模型。
- en: It is common to have variables related to the number of days with some payment
    problems in the past. Sometimes, and depending on the dataset, these variables
    display a missing value simply because the applicant did not have previous problems.
    This is typically the case when the imputation of a value could lead us to lose
    relevant information.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 通常会有与过去某些支付问题相关的变量。有时，根据数据集的不同，这些变量显示缺失值仅仅是因为申请人没有先前的问题。这种情况通常发生在值插补可能导致我们丢失相关信息时。
- en: Detailed analysis of missing values is most common when the number of variables
    is low. If the number of variables is high, some automatic alternative could be
    a more efficient approach.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 当变量数量较低时，对缺失值的详细分析最为常见。如果变量数量较高，一些自动替代方法可能更有效。
- en: Before taking an action on the missing values, let’s find the number of missing
    values by analyzing columns and rows. You can then remove the variables and rows
    (also known as observations) that have a high number of missing values.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在对缺失值采取行动之前，让我们通过分析列和行来找出缺失值的数量。然后您可以删除具有大量缺失值的变量和行（也称为观测值）。
- en: In any case, thresholds to remove variables or observations are subjective,
    and it depends on the specific case of their application.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何情况下，删除变量或观测值的阈值是主观的，并且取决于它们应用的特定案例。
- en: 'Using the `DataExplorer` package, it is possible to find the percentage of
    missing values in our data. Let’s try it with a small number of variables:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`DataExplorer`包，我们可以找到我们数据中缺失值的百分比。让我们用少数几个变量试一试：
- en: '[PRE25]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'The preceding line of code will print a graph similar to this:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 上一行代码将打印出类似此图的图表：
- en: '![](img/ffd51532-474e-4ae0-916f-e9067258bb4e.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ffd51532-474e-4ae0-916f-e9067258bb4e.png)'
- en: The preceding graph is only an example of the representation of missing values
    for some variables using the `DataExplorer` package. This package also provides
    recommendations about the usefulness of using a variable depending on its number
    of missing values.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 上述图表仅是使用`DataExplorer`包表示某些变量缺失值的一个示例。此包还根据缺失值的数量提供有关使用变量的有用性建议。
- en: 'We also have another way to determine variables with missing values. This is
    an alternative if you do not have access to the `DataExplorer` package, or simply
    don''t wish to use it. This is more of a manual way. Let''s write the code:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还有另一种确定具有缺失值的变量的方法。这是一个替代方案，如果您无法访问`DataExplorer`包，或者只是不想使用它。这更是一种手动方式。让我们编写代码：
- en: '[PRE26]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'For example, we can check variables where missing values represent more than
    99% of the total observations (only a few lines are shown here):'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们可以检查缺失值占总观测值超过99%的变量（这里只显示了少数几行）：
- en: '[PRE27]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'In this case, I prefer not to remove any variables considering its number of
    missing values. There are no empty variables:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我更倾向于不删除任何变量，考虑到其缺失值的数量。没有空变量：
- en: '[PRE28]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Let''s count the number of missing values by analyzing the rows:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过分析行来计算缺失值的数量：
- en: '[PRE29]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Now plot a histogram to graphically depict the distribution of the missing
    values:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 现在绘制一个直方图来图形化描述缺失值的分布：
- en: '[PRE30]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'The preceding code generates the following graph:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 上一段代码生成了以下图表：
- en: '![](img/85f13606-976a-43ae-9209-0d0c24447437.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![](img/85f13606-976a-43ae-9209-0d0c24447437.png)'
- en: 'A summary of the percentage of missing values from banks can be obtained using
    the following code:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用以下代码获取银行缺失值百分比的摘要：
- en: '[PRE31]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Although the number of missing values is high for some banks, it is recommended
    to not remove any observations for now, but to only remove the recently created
    missing variable:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然某些银行的缺失值数量很高，但建议现在不要删除任何观测值，而只删除最近创建的缺失变量：
- en: '[PRE32]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: An interesting package that we will use to visualize the number of missing values
    in the dataset is the `Amelia` package. It is a package for multiple imputations
    of missing data, which also includes a graphical interface.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一个有趣的包来可视化数据集中缺失值的数量，这个包是`Amelia`包。这是一个用于多重插补缺失数据的包，还包括一个图形界面。
- en: 'Let’s see an example for some variables:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看一些变量的例子：
- en: '[PRE33]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'The preceding code generates the following graph:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 上一段代码生成了以下图表：
- en: '![](img/a4025f79-7e3c-4cdc-8017-6a127d559e3e.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a4025f79-7e3c-4cdc-8017-6a127d559e3e.png)'
- en: Although the representation is not very pretty, this graph displays some variables
    from the *x* axis and the observations in the dataset from the *y* axis. Black
    points indicate the presence of missing variables in the dataset.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然表示方式不太美观，但这个图表显示了*x*轴上的某些变量和数据集中的*y*轴上的观测值。黑色点表示数据集中存在缺失变量。
- en: As shown, some of variables display a high number of missing values.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 如所示，一些变量显示有大量的缺失值。
- en: Analyzing the missing value
  id: totrans-153
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分析缺失值
- en: We've already mentioned that it is important to understand the origin of missing
    values and whether they can offer us some information. In the following example,
    we will analyze the missing values presented in the `UBPRE628` variable. This
    variable measures the amount of total long-term debt of a bank divided by the
    total bank equity capital. The capital of a bank is important because in the case
    of losses faced in the operations, this will be used by the bank to absorb them
    and to avoid a future insolvency. The higher the capital, the higher the buffer
    of a bank to face economic problems.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经提到，了解缺失值的来源以及它们是否可以提供一些信息是很重要的。在下面的例子中，我们将分析`UBPRE628`变量中呈现的缺失值。这个变量衡量的是一家银行的长期债务总额除以总银行股本资本。银行的资本很重要，因为在运营中面临损失的情况下，银行将使用这部分资本来吸收损失并避免未来的破产。资本越高，银行面对经济问题的缓冲能力就越强。
- en: In general, the highest proportion of debt related to the bank capital, the
    more problems the bank could experience in the future if, for example, a new crisis
    occurs. In the event of a new financial crisis, a bank couldn’t repay its debt,
    even by selling its assets.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，与银行资本相关的债务比例越高，银行在未来如果发生新危机的情况下可能遇到的问题就越多。在新的金融危机发生时，银行可能无法偿还其债务，即使通过出售其资产。
- en: 'According to our analysis, this variable displays a high percentage of missing
    values, specifically this ratio is not informed for the 23.97% of banks in our
    data:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们的分析，这个变量显示了高比例的缺失值，具体来说，这个比率对于我们数据中的23.97%的银行没有信息：
- en: '[PRE34]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Understanding the results
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解结果
- en: 'Now we will create an auxiliary data frame to count the number of failed banks
    and check whether this ratio is informed or not:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将创建一个辅助数据框来统计失败银行的数目并检查这个比率是否已告知：
- en: '[PRE35]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Now we will create a flag to check whether the variable is missing:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将创建一个标志来检查变量是否存在缺失：
- en: '[PRE36]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Finally, let''s sum up the number of existing defaults in the dataset for both
    the cases: the presence or lack of the missing values in this ratio:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们总结一下数据集中两种情况下的现有违约数量：这个比率中缺失值的存在或缺失：
- en: '[PRE37]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: According to this table, only `14` failed banks displayed a missing value in
    this ratio. Apparently, we could conclude from this that a bank could intentionally
    not report a specific ratio because the calculated ratio could alert others about
    a bad economic situation of this bank. In this case, we don't observe a high proportion
    of bad banks if a missing value is observed.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 根据这个表格，只有`14`家失败的银行在这个比率中显示了缺失值。显然，我们可以从这个结论中得出，一家银行可能会故意不报告特定的比率，因为计算出的比率可能会让其他人意识到这家银行的糟糕经济状况。在这种情况下，如果观察到缺失值，我们不会观察到高比例的坏银行。
- en: 'Missing values will be estimated by calculating the mean of the ratio of the
    non-missing observations on the training dataset. This means that, if missing
    values are present in the validation dataset, they may also be present in the
    training dataset. Let''s see an example:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 缺失值将通过计算训练数据集中非缺失观测值的比率平均值来估计。这意味着，如果验证数据集中存在缺失值，它们也可能存在于训练数据集中。让我们看一个例子：
- en: '[PRE38]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'We can check whether the process has worked using the `Amelia` package on both
    training and validation samples (it may take a few minutes). For example, you
    can check whether there are missing values in the training sample after the process
    has executed:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`Amelia`包在训练和验证样本上检查这个过程是否成功（可能需要几分钟）。例如，你可以在过程执行后检查训练样本中是否存在缺失值：
- en: '[PRE39]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Here is the output of the preceding code:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是前面代码的输出：
- en: '![](img/0c603227-368f-48a2-a948-88201fd86bb3.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0c603227-368f-48a2-a948-88201fd86bb3.png)'
- en: 'Carry out the same checks for the test sample:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 对测试样本执行相同的检查：
- en: '[PRE40]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Again, a new output is displayed:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，显示了新的输出：
- en: '![](img/41df5e03-9ca2-4ad6-acb1-6683eef9f9b4.png)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![](img/41df5e03-9ca2-4ad6-acb1-6683eef9f9b4.png)'
- en: Two maps are plotted in a gray color, indicating that there are no missing values.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 两个地图以灰色绘制，表示没有缺失值。
- en: 'Now we are going to make a new backup of our workspace and remove all the unnecessary
    tables:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将备份我们的工作空间并删除所有不必要的表格：
- en: '[PRE41]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Summary
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we have learned some initial important steps to prepare and
    understand our data. How many variables are available in our dataset? What kind
    of information do we have? Are there some missing values in the data? How can
    I treat missing values and outliers? I hope you can now answer these questions.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们了解了一些准备和了解数据的基本重要步骤。在我们的数据集中有多少个变量可用？我们有什么样的信息？数据中是否有缺失值？我该如何处理缺失值和异常值？我希望你现在可以回答这些问题。
- en: Moreover, in this chapter, we also learned how to split our data to train and
    validate our forthcoming predictive model. In the next chapter, we will advance
    one step ahead, performing a univariate analysis on this data, which means analyzing
    whether variables are useful for predicting bank failures.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，在本章中，我们还学习了如何将我们的数据分割成训练集和验证集，以训练和验证我们即将到来的预测模型。在下一章，我们将更进一步，对这份数据进行单变量分析，这意味着分析变量是否对预测银行破产有用。

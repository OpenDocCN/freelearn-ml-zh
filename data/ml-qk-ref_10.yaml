- en: Causal Inference
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 因果推断
- en: 'In this final chapter, we will learn about the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的最后，我们将学习以下主题：
- en: Granger causality in time series (econometric approach to causality)
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间序列中的格兰杰因果性（因果关系的计量经济学方法）
- en: Graphical models causality
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 图形模型因果关系
- en: Granger causality
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 格兰杰因果性
- en: In time series, we typically use univariate data. That is, we use a single series
    to predict its future values. Let's say that we are studying Google's stock price
    data, and we are asked to forecast the future values of stock prices. In this
    case, we will need historic data of Google's stock prices. Based on that, we will
    make predictions.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在时间序列中，我们通常使用单变量数据。也就是说，我们使用一个序列来预测其未来的值。比如说，我们正在研究谷歌的股价数据，并被要求预测股价的未来值。在这种情况下，我们需要谷歌股价的历史数据。基于这些数据，我们将做出预测。
- en: However, at times, we need multiple time series to make a forecast. But why
    is it that we need multiple time series? Any guesses?
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，有时我们需要多个时间序列来进行预测。但为什么我们需要多个时间序列呢？有什么猜测吗？
- en: 'The following graph shows Google''s stock price data:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的图表显示了谷歌的股价数据：
- en: '![](img/dcfb259b-6986-47e2-958a-4f8424f6c745.png)'
  id: totrans-8
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/dcfb259b-6986-47e2-958a-4f8424f6c745.png)'
- en: 'The answer is that we need to understand and explore the relationship between
    multiple time series as this can improve our forecast. For example, we have got
    correlated time series of **GDP Deflator: Services** and **WPI: All Commodities**,
    as follows:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 答案是我们需要理解和探索多个时间序列之间的关系，因为这可以提高我们的预测能力。例如，我们得到了**GDP平减指数：服务业**和**WPI：所有商品**的相关时间序列，如下所示：
- en: '![](img/5ac9b772-c549-4d12-9691-19065159518f.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/5ac9b772-c549-4d12-9691-19065159518f.png)'
- en: 'It is quite evident that these two seem to carry a relationship. When we have
    to forecast **GDP Deflator: Services**, we can use **WPI: All Commodities** time
    series data as input. This is called **Granger causality**.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 这两点似乎存在某种关系。当我们需要预测**GDP平减指数：服务业**时，我们可以使用**WPI：所有商品**的时间序列数据作为输入。这被称为**格兰杰因果性**。
- en: To put it more aptly, Granger causality is one of the ways to investigate causality between
    two variables in a time series. This method is a probabilistic account of causality.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 更恰当地说，格兰杰因果性是调查时间序列中两个变量之间因果关系的一种方法。这种方法是因果关系的概率描述。
- en: Even though we are talking about causality here, it isn't exactly the same.
    Typically, causality is associated with a situation where variable *1* is the
    cause of variable 2 or vice versa. However, with Granger causality, we do not
    test a true cause and effect relationship. The fundamental reason to know is whether **a
    particular variable comes before another** in the time series.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们在这里讨论的是因果关系，但这并不完全相同。通常，因果关系与变量1是变量2的原因或反之亦然的情况相关联。然而，在格兰杰因果性中，我们并不测试真正的因果关系。基本的原因是要知道在时间序列中是否**某个变量先于另一个变量出现**。
- en: You aren't testing a true cause and effect relationship. What you want to know
    is whether **a particular variable comes before another** in the time series.
    That is to say, if we find Granger causality in the data, then there isn't any
    causal link in the true sense of the word.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 你并不是在测试真正的因果关系。你想要了解的是否是某个变量在时间序列中是否先于另一个变量出现。也就是说，如果我们发现数据中存在格兰杰因果性，那么在真正的意义上，并不存在任何因果关系。
- en: When econometricians say cause, what they mean is Granger-cause, although a
    more appropriate word might be precedence. Granger causality was proposed by a
    Nobel laureate in Economics, Prof Clive Granger, in 2003.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 当计量经济学家说“原因”时，他们的意思是格兰杰-原因，尽管一个更合适的词可能是优先级。格兰杰因果性是由2003年诺贝尔经济学奖获得者，Clive Granger教授提出的。
- en: Let's look at one more example. Here, we have GDP per capita for OECD nations.
    We can see that the number of OECD countries have a similar growth and pattern
    in GDP. We can assume that these countries are responsible for each other's GDP
    growth due to dependencies.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们再看一个例子。这里，我们有经合组织国家的每人GDP。我们可以看到，经合组织国家的GDP数量在增长和模式上相似。我们可以假设这些国家由于相互依赖而相互负责各自的GDP增长。
- en: 'The following is a graph that shows GDP per capita for OECD countries:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的图表显示了经合组织国家的每人GDP：
- en: '![](img/64a5d92a-f8d2-4e59-af45-6993f3a8fb3d.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/64a5d92a-f8d2-4e59-af45-6993f3a8fb3d.png)'
- en: We can utilize the series of one country to forecast for another one. More often
    than not, this kind of relationship is prevalent more in financial time series.
    The stock market of India, NSE/BSE, and so on may have an impact on NYSE. Therefore,
    NYSE indices can be used to make a forecast for NSE indices.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以利用一个国家的序列来预测另一个国家。这种情况通常在金融时间序列中更为普遍。印度的股票市场，如NSE/BSE等，可能会影响NYSE。因此，NYSE指数可以用来预测NSE指数。
- en: Let's infuse a bit of mathematics into this. Let's say there are two time series,
    *X(t)* and *Y(t)*. If the past values of *X(t)* are helping to predict the future
    values of *Y(t)*, it is said that *X(t)* Granger causes *Y(t)*.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们在其中加入一点数学。假设有两个时间序列，*X(t)* 和 *Y(t)*。如果 *X(t)* 的过去值有助于预测 *Y(t)* 的未来值，那么可以说
    *X(t)* 格兰杰引起 *Y(t)*。
- en: 'So, *Y(t)* is a function of the lag of *Y(t)* and also of the lag of *X(t)*.
    It can be expressed as as follows:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，*Y(t)* 是 *Y(t)* 的滞后和 *X(t)* 的滞后的函数。它可以表示为如下：
- en: '*Y(t) = f(Yt-p, Xt-p)*'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y(t) = f(Yt-p, Xt-p)*'
- en: 'However, this only holds true in the following situations:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这仅在以下情况下成立：
- en: Cause takes place prior to effect. What this means is that *Y(t) = f(Xt-1)*,
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 原因发生在结果之前。这意味着 *Y(t) = f(Xt-1)*，
- en: 'Cause has got significant information about the future values of its effect,
    for example:'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 原因对其效果的未来值有显著信息，例如：
- en: '*Y(t) = a1 Yt-1 + b1 Xt-1 + error*'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '*Y(t) = a1 Yt-1 + b1 Xt-1 + error*'
- en: '*Xt-1* is adding an extra effect on *Y(t)*. The magnitude of effect is decided
    by *b1*.'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '*Xt-1* 在 *Y(t)* 上增加了一个额外的效果。效果的大小由 *b1* 决定。'
- en: 'Let''s say we have two equations:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们有两个方程：
- en: '*Yt= a0+ a1* Yt-1*'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '*Yt= a0+ a1* Yt-1*'
- en: '*Yt= a0 + a1*Yt-1 + a2*Xt-1*'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '*Yt= a0 + a1*Yt-1 + a2*Xt-1*'
- en: 'The null hypothesis here is as follows:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 此处的零假设如下：
- en: '*H0: a2=0*: What this means is that there is no effect of other series, where
    *Xt-1* on *Yt*'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*H0: a2=0*: 这意味着没有其他序列对 *Yt* 的 *Xt-1* 产生影响'
- en: 'The alternate hypothesis here is as follows::'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 此处的备择假设如下：
- en: '*H1: a2≠ 0*: What this means is that there is a significant effect of other
    series, where *Xt-1* on *Yt*'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*H1: a2≠ 0*: 这意味着存在其他序列对 *Xt-1* 对 *Yt* 的显著影响'
- en: We run a t-test to determine whether there is a significant effect of other
    series of *Xt-1* on *Yt*.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 我们运行t检验以确定其他序列 *Xt-1* 对 *Yt* 是否有显著影响。
- en: If the null hypothesis is rejected, we can say that it is a case of Granger
    causality.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 如果拒绝零假设，我们可以说这是一个格兰杰因果关系的情况。
- en: F-test
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: F检验
- en: 'The basic steps for running this test are as follows:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此测试的基本步骤如下：
- en: Formulate the null hypothesis and its alternative.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建零假设及其备择假设。
- en: Choose the lags. These can depend on the amount of data you have. One way to choose
    lags i and j is to run a model order test. It would be easier to pick up multiple
    values and run the Granger test to see if the results are the similar for different
    lag levels.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择滞后项。这可以取决于你拥有的数据量。选择滞后i和j的一种方法是通过运行模型阶数测试。选择多个值并运行格兰杰测试，以查看不同滞后水平的结果是否相似。
- en: Also identify the f-value. The two equations can be used to find out whether
    *βj = 0* for all lags *j*.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 还要确定f值。两个方程可以用来找出对于所有滞后 *j*，*βj = 0* 是否成立。
- en: Limitations
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 局限性
- en: 'The different limitations of this approach are as follows:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的不同局限性如下：
- en: Granger causality is not a true causality
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 格兰杰因果关系并非真正的因果关系
- en: If *X(t)* affects *Y(t)* through a third variable, *Z(t)*, then it is difficult
    to find Granger causality
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果 *X(t)* 通过第三个变量 *Z(t)* 影响 *Y(t)*，那么很难找到格兰杰因果关系
- en: Use case
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用例
- en: Here, we have a multivariate time series dataset called `AirQualityUCI`. We
    have to test whether NOx has a Granger causality of NO2.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们有一个名为`AirQualityUCI`的多元时间序列数据集。我们必须测试NOx是否对NO2有格兰杰因果关系。
- en: Since we don't have a library in Python for multivariate Granger causality,
    we will do this in R by using the `lmtest` package.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们没有Python中用于多元格兰杰因果关系的库，我们将使用R的`lmtest`包来完成这项工作。
- en: 'Load the `lmtest` library. In case the library isn''t there, you will need
    to install it, as follows:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 加载`lmtest`库。如果库不存在，你需要按照以下方式安装它：
- en: '[PRE0]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Load the data. Then, make use of the `grangertest` function to find out whether
    there is any significant relationship between NOx and NO2:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 加载数据。然后，使用`grangertest`函数找出NOx和NO2之间是否存在任何显著关系：
- en: '[PRE1]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The output for this is as follows:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '![](img/6f859784-a489-4873-a8db-ba5a66b51d3a.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6f859784-a489-4873-a8db-ba5a66b51d3a.png)'
- en: So, the f-test has become significant, which means that the coefficients of
    lagged NO2 have a significant impact on NOx.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，f检验变得显著，这意味着滞后NO2的系数对NOx有显著影响。
- en: Graphical causal models
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 图形因果模型
- en: This model was covered in detail in [Chapter 8](64be9aad-a25e-4ea4-abbb-bc8ff4cbbe1a.xhtml)*, Probabilistic
    Graphical Models*. We will also look into it briefly here, too.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 该模型在[第8章](64be9aad-a25e-4ea4-abbb-bc8ff4cbbe1a.xhtml)*，概率图模型*中进行了详细说明。我们也会在这里简要地探讨它。
- en: 'Bayesian networks are directed acyclic graphs (DAGs) where the nodes represent
    variables of interest (for example, the temperature of a device, the gender of
    a patient, a feature of an object, the occurrence of an event, and so on). Causal
    influences among the variables are represented using links. The strength of an
    influence can be potrayed by conditional probabilities that are linked to each
    cluster of the parent-child nodes in the network. In the following diagram we
    can see the causal models, that have a node and an edge:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯网络是有向无环图（DAGs），其中节点代表感兴趣的变量（例如，设备的温度，患者的性别，物体的特征，事件的发生，等等）。变量之间的因果影响通过链接表示。影响强度可以通过与网络中父节点和子节点簇相关的条件概率来描绘。在以下图表中，我们可以看到具有节点和边的因果模型：
- en: '![](img/620df37b-3981-4203-b6d5-c1e7bc97b31f.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/620df37b-3981-4203-b6d5-c1e7bc97b31f.png)'
- en: 'The node represents the variables and the edges stand for conditional relationship
    between the variables. What we are looking for is full joint probability distribution. Here,
    the conditional dependency is being spoken. Rain causes the ground to be wet.
    However, winning the lottery has nothing to do with other variables. It''s got
    conditional independence, as shown in the following diagram:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 节点代表变量，边代表变量之间的条件关系。我们正在寻找的是完整的联合概率分布。在这里，正在讨论条件依赖性。雨导致地面变湿。然而，赢得彩票与其他变量无关。它具有条件独立性，如以下图表所示：
- en: '![](img/54801f88-0c6d-4815-80ed-84770c9f370f.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/54801f88-0c6d-4815-80ed-84770c9f370f.png)'
- en: 'Here, the probability for conditional independence is as follows:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，条件独立性的概率如下：
- en: '*P(Lottery,Rain, Wet Ground)= P(Lottery) P(Rain) P(Wet Ground | Rain)*'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '*P(彩票，雨，湿地面)= P(彩票) P(雨) P(雨|湿地面)*'
- en: Therefore, we can say that a Bayesian network describes a probability distribution
    among all variables by putting conditional probability as edges.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们可以这样说，贝叶斯网络通过将条件概率作为边来描述所有变量之间的概率分布。
- en: 'Let''s look at an example in Python:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看一个Python的例子：
- en: 'First, we need to load the library, `CausalGraphicalModel`, as follows:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要加载库，`CausalGraphicalModel`，如下所示：
- en: '[PRE2]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Let''s set up the model for a condition that if somebody is doing a `Job` and
    if it''s powered by `Smartwork` and `Hardwork`, he/she reaps rewards and eventually,
    ends up having a promotion:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们为以下条件设置模型：如果某人正在做`Job`，并且它由`Smartwork`和`Hardwork`供电，那么他/她将获得奖励，并最终获得晋升：
- en: '[PRE3]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The following is the output of the preceding code:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码的输出如下：
- en: '![](img/2fd1eb17-9b5b-43c8-96a9-f18293786a63.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/2fd1eb17-9b5b-43c8-96a9-f18293786a63.png)'
- en: 'Let''s obtain the distribution:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们获取分布：
- en: '[PRE4]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Then we will get the following as a output:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将得到以下输出：
- en: '![](img/8e90a859-0356-4cb2-be40-7c1bf3a651fc.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/8e90a859-0356-4cb2-be40-7c1bf3a651fc.png)'
- en: 'Let''s extract all of the conditional independence relationships:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们提取所有的条件独立性关系：
- en: '[PRE5]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![](img/b8d32eb6-6c71-4219-a81c-416d3e40dee5.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/b8d32eb6-6c71-4219-a81c-416d3e40dee5.png)'
- en: Here, we are able to assess the conditional independence among the variables.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们能够评估变量之间的条件独立性。
- en: 'Let''s mix this in with `Reward`:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们把`Reward`混合进来：
- en: '[PRE6]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](img/941edca5-e300-421f-b430-8a7b2656af3b.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/941edca5-e300-421f-b430-8a7b2656af3b.png)'
- en: Summary
  id: totrans-83
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we studied Granger causality, which is where we use a single
    time series to predict its future values, along with the different models of graphical
    causality models. The graphical causality models cover two examples that will
    give us a basic idea about the graphical causal models.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们研究了格兰杰因果性，这是使用单一时间序列来预测其未来值，以及不同的图形因果模型。图形因果模型涵盖了两个例子，这将给我们一个关于图形因果模型的基本概念。

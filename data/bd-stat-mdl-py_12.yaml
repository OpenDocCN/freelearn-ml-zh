- en: '12'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '12'
- en: Multivariate Time Series
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多变量时间序列
- en: 'The models we discussed in the previous chapter only depended on the previous
    values of the single variable of interest. Those models are appropriate when we
    only have a single variable in our time series. However, it is common to have
    multiple variables in time-series data. Often, these other variables in the series
    can improve forecasting of the variable of interest. We will discuss models for
    time series with multiple variables in this chapter. We will first discuss the
    correlation relationship between time-series variables, then discuss how we can
    model multivariate time series. While there are many models for multivariate time-series
    data, we will discuss two models that are both powerful and widely used: **autoregressive
    integrated moving average with exogenous variables** (**ARIMAX**) and **vector
    autoregressive** (**VAR**). Understanding these two models will extend the reader’s
    model toolbox and provide building blocks for the reader to learn more about multivariate
    time-series models.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在上一章讨论的模型只依赖于感兴趣的单个变量的先前值。当我们的时间序列中只有一个变量时，这些模型是合适的。然而，在时间序列数据中通常会有多个变量。通常，这些系列中的其他变量可以改善感兴趣变量的预测。在本章中，我们将讨论具有多个变量的时间序列模型。我们将首先讨论时间序列变量之间的相关性关系，然后讨论我们如何对多变量时间序列进行建模。虽然存在许多多变量时间序列数据模型，但我们将讨论两种既强大又广泛使用的模型：**带有外生变量的自回归积分移动平均**（**ARIMAX**）和**向量自回归**（**VAR**）。理解这两个模型将扩展读者的模型工具箱，并为读者学习更多关于多变量时间序列模型提供构建块。
- en: 'In this chapter, we’re going to cover the following main topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主要主题：
- en: Multivariate time series
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多变量时间序列
- en: ARIMAX
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ARIMAX
- en: VAR modeling
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VAR 模型
- en: Multivariate time series
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多变量时间序列
- en: In the previous chapter, we discussed models for **univariate time series**
    or a time series of one variable. However, in many modeling situations, it is
    common to have multiple time-varying variables that are measured together. A time
    series consisting of multiple time-varying variables is called a **multivariate
    time series**. Each variable in the time series is called a **covariate**. For
    example, a time series of weather data might include temperature, rain amount,
    wind speed, and relative humidity. Each of these variables, in the weather dataset,
    is a univariate time series, and together, a multivariate time series and each
    pair of variables are covariates.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们讨论了**单变量时间序列**或一个变量的时间序列的模型。然而，在许多建模情况下，通常会有多个同时测量的时间变化变量。由多个时间变化变量组成的时间序列被称为**多变量时间序列**。时间序列中的每个变量被称为**协变量**。例如，天气数据的时间序列可能包括温度、降雨量、风速和相对湿度。在天气数据集中，这些变量中的每一个都是单变量时间序列，而作为一个整体，多变量时间序列和每一对变量都是协变量。
- en: 'Mathematically, we typically represent a multivariate time-series as a vector-valued
    series, as follows:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 从数学上讲，我们通常将多变量时间序列表示为一个向量值序列，如下所示：
- en: X = x 0,0 x 0,1 ⋮ , x 1,0 x 1,1 ⋮ , … , x t,0 x t,1 ⋮
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: X = x 0,0 x 0,1 ⋮ , x 1,0 x 1,1 ⋮ , … , x t,0 x t,1 ⋮
- en: 'Here, each X instance consists of multiple values at each time step, and there
    are t steps in the series. The first index in the preceding equation represents
    the time step (0 through t), and the second index represents the individual series
    (0 through N variables). For example, if X were a time series of stock prices,
    at each time step of X, there would be a value of each stock price. In that case,
    X might look like the following equation if the first two stock symbols in the
    series were AAPL and GOOGL:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，每个 X 实例在每个时间步长都有多个值，并且序列中有 t 个步骤。前面方程中的第一个索引代表时间步长（从 0 到 t），第二个索引代表单个序列（从
    0 到 N 个变量）。例如，如果 X 是股票价格的时间序列，那么在 X 的每个时间步长，都会有每个股票价格的一个值。在这种情况下，如果序列中的前两个股票代码是
    AAPL 和 GOOGL，那么 X 可能看起来像以下方程：
- en: X =  x 0, AAPL x 0, GOOGL ⋮ ,  x 1, AAPL x 1, GOOGL ⋮ , … ,  x t, APPL x t, GOOGL ⋮
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: X =  x 0, AAPL x 0, GOOGL ⋮ ,  x 1, AAPL x 1, GOOGL ⋮ , … ,  x t, APPL x t, GOOGL ⋮
- en: 'When we have a multivariate time series, a question arises: *What can we do
    with this additional* *information?* To answer that question, we need to understand
    whether these time-series variables are related. We can determine how time series
    are related by looking at their cross-correlation. Let’s discuss cross-correlation
    next.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们有一个多变量时间序列时，一个问题随之而来：*我们能用这些额外的* *信息做什么呢？* 为了回答这个问题，我们需要了解这些时间序列变量是否相关。我们可以通过观察它们的交叉相关性来确定时间序列之间的关系。接下来，让我们讨论交叉相关性。
- en: Time-series cross-correlation
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 时间序列交叉相关性
- en: 'We need to understand how time series can be related in order to determine
    whether covariate time series may be useful for forecasting a time series of interest.
    In a previous chapter, we discussed how to understand the relationship between
    two variables using plots and correlation coefficients; we will take a similar
    approach for the time-series data. Recall the following **cross-correlation function**
    (**CCF**) discussed in [*Chapter 10*](B18945_10.xhtml#_idTextAnchor160)*, Introduction
    to* *Time Series*:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要了解时间序列如何相关，以便确定协变量时间序列是否可能对预测感兴趣的时间序列有用。在前面的一章中，我们讨论了如何使用图表和相关性系数来理解两个变量之间的关系；我们将对时间序列数据采取类似的方法。回想一下在[*第10章*](B18945_10.xhtml#_idTextAnchor160)*，时间序列导论*中讨论的以下**交叉相关函数**（**CCF**）：
- en: ˆ p  k(X, Y) =  ∑ t=1 n−k (X t −  _ X )(Y t−k −  _ Y )   ______________________   √ ____________  ∑ t=1 n  (X t
    −  _ X ) 2  √ ____________  ∑ t=1 n  (Y t −  _ Y ) 2
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ˆ p  k(X, Y) =  ∑ t=1 n−k (X t −  _ X )(Y t−k −  _ Y )   ______________________   √ ____________  ∑ t=1 n  (X t
    −  _ X ) 2  √ ____________  ∑ t=1 n  (Y t −  _ Y ) 2
- en: Here, X is a univariate time series and Y is a univariate time series. This
    function tells us how X and Y are related at k lags. In this equation, Y is k
    time steps behind X. In this situation, we say that X is leading Y by k steps
    or Y is lagging X by k steps. We will use this CCF to help us determine whether
    two time series are related and at which time steps they are related. Notice that
    if X = Y, then the CCF reduces to the **autocorrelation** **function** (**ACF**).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，X是一个一元时间序列，Y也是一个一元时间序列。这个函数告诉我们X和Y在k滞后时的关系。在这个方程中，Y比X滞后k个时间步。在这种情况下，我们说X领先Y
    k步或Y滞后X k步。我们将使用这个CCF来帮助我们确定两个时间序列是否相关以及它们在哪个时间步相关。请注意，如果X = Y，那么CCF将简化为**自相关函数**（**ACF**）。
- en: Cross-correlation significance
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 交叉相关性显著性
- en: Just as with the ACF, cross-correlations have a threshold for statistical significance.
    We consider any cross-correlation value with an absolute value greater than 1.96
    / √ _ N  (where N is the sample size of the time series) to be significantly different
    from zero.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 正如ACF一样，交叉相关性有一个统计显著性的阈值。我们认为任何绝对值大于1.96 / √ _ N（其中N是时间序列的样本大小）的交叉相关性值与零显著不同。
- en: 'Let’s take a look at cross-correlations with some data. This data [1] comes
    from the *UCI Machine Learning Repository* [2]. The data is weather data that
    was collected as part of a pollution study conducted in China. This data was sampled
    hourly over several years. We will subset the data to the first 1,000 data points.
    The weather data contained in this set consists of temperature (`TEMP`), pressure
    (`PRES`), dew point temperature (`DEWP`), rain precipitation (`RAIN`), and wind
    speed (`WSPM`). We will look at cross-correlations from the perspective of trying
    to forecast wind speed, meaning we will look at the cross-correlations of wind
    speed and the other variables. This may be an important problem for someone who
    wants to forecast power generation from windmills. The wind speed data and the
    ACF of the wind speed data are plotted in *Figure 12**.1*:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过一些数据来观察交叉相关性。这些数据[1]来自*UCI机器学习仓库* [2]。这些数据是作为在中国进行的一项污染研究的一部分收集的天气数据。这些数据在多年的时间里每小时采样一次。我们将数据子集缩小到前1,000个数据点。这个数据集中的天气数据包括温度(`TEMP`)、气压(`PRES`)、露点温度(`DEWP`)、降雨量(`RAIN`)和风速(`WSPM`)。我们将从试图预测风速的角度来观察交叉相关性，这意味着我们将观察风速与其他变量的交叉相关性。这可能是一个想要预测风力涡轮机发电的人的重要问题。风速数据和风速的ACF在*图12.1*中绘制：
- en: '![Figure 12.1 – Plot of wind speed time series and its ACF](img/B18945_12_001.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![图12.1 – 风速时间序列及其ACF的绘图](img/B18945_12_001.jpg)'
- en: Figure 12.1 – Plot of wind speed time series and its ACF
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.1 – 风速时间序列及其ACF的绘图
- en: 'We can see from the plot in *Figure 12**.1* that the wind speed could potentially
    be modeled by a stationary univariate model, which we discussed in the previous
    chapter. While there does not appear to be evidence of **autoregressive integrated
    moving average** (**ARIMA**) behavior, there does appear to be evidence of seasonality
    at lag 24\. Since the data is sampled hourly, the seasonality is likely a daily
    pattern. We have plotted the time series of the other variables in *Figure 12**.2*.
    These are the other variables we may want to use to help predict the value of
    wind speed:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 从*图12.1*中的图表可以看出，风速可能可以通过我们在上一章讨论的平稳单变量模型进行建模。虽然似乎没有证据表明存在**自回归积分移动平均**（**ARIMA**）行为，但在滞后24处似乎存在季节性的证据。由于数据是按小时采样的，季节性可能是一个日周期模式。我们在*图12.2*中绘制了其他变量的时间序列。这些是我们可能想要用来帮助预测风速值的其他变量：
- en: '![Figure 12.2 – Plot of wind speed time series and three other weather variables](img/B18945_12_002.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![图12.2 – 风速时间序列和三个其他天气变量的图](img/B18945_12_002.jpg)'
- en: Figure 12.2 – Plot of wind speed time series and three other weather variables
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.2 – 风速时间序列和三个其他天气变量的图
- en: 'While we have not plotted the ACF for all the time series shown in *Figure
    12**.2*, these time series have characteristics that suggest they may be stationary.
    However, it is not clear from the time series alone whether these time series
    are related. This is where the cross-correlation of time series comes in. We can
    use a cross-correlation plot to determine whether any of the other time series
    are related to wind speed. We have plotted the cross-correlation of wind speed
    and the other variables in *Figure 12**.3*. The CCFs are plotted up to 48 lags.
    Since the data was sampled hourly, this gives us 2 days’ worth of lags to see
    the cross-correlations:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们没有绘制*图12.2*中所示的所有时间序列的ACF图，但这些时间序列具有表明它们可能是平稳的特征。然而，仅从时间序列本身来看，并不能确定这些时间序列是否相关。这就是时间序列交叉相关性的作用所在。我们可以使用交叉相关图来确定其他时间序列是否与风速相关。我们在*图12.3*中绘制了风速与其他变量的交叉相关性。CCF图绘制到48个滞后。由于数据是按小时采样的，这给我们提供了2天的滞后时间来观察交叉相关性：
- en: '![Figure 12.3 – CCF plots of wind speed and three other variables](img/B18945_12_003.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![图12.3 – 风速和三个其他变量的CCF图](img/B18945_12_003.jpg)'
- en: Figure 12.3 – CCF plots of wind speed and three other variables
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.3 – 风速和三个其他变量的CCF图
- en: The plots in *Figure 12**.3* show that there are cross-correlations between
    wind speed and the other variables. While we are not too interested in the shapes
    of the cross-correlations, the patterns may provide some depth to how the variables
    are related. For example, the cross-correlation of wind speed and temperature
    shows an oscillating pattern with a period of about 12 hours; this may correspond
    to the effect of sunlight on wind speed. The primary finding is that these other
    variables share a relationship with wind speed and may help us forecast the values
    of wind speed. Let’s take a look at how we can use the additional variables for
    modeling.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 图*12.3*中的图表显示风速与其他变量之间存在交叉相关性。虽然我们不太关注交叉相关性的形状，但这些模式可能为变量之间的关系提供一些深度。例如，风速和温度的交叉相关性显示出大约12小时的振荡模式；这可能对应于阳光对风速的影响。主要发现是这些其他变量与风速存在关联，可能帮助我们预测风速的值。让我们看看我们如何可以使用额外的变量进行建模。
- en: ARIMAX
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ARIMAX
- en: In the previous chapter, we discussed the ARIMA family of models and demonstrated
    how to model univariate time-series data. However, as we mentioned in the previous
    section, many time series are multivariate, such as stock data, weather data,
    or economic data. In this section, we will discuss how we can incorporate information
    from covariate variables when modeling time-series data.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们讨论了ARIMA模型族，并演示了如何对单变量时间序列数据进行建模。然而，正如我们在上一节中提到的，许多时间序列是多变量的，例如股票数据、天气数据或经济数据。在本节中，我们将讨论在建模时间序列数据时如何整合协变量变量的信息。
- en: 'When we model a multivariate time series, we typically have a variable we are
    interested in forecasting. This variable is commonly called the **endogenous**
    variable. The other covariates in the multivariate time series are called **exogenous**
    variables. Recall from [*Chapter 11*](B18945_11.xhtml#_idTextAnchor174)*, ARIMA
    Models,* the equation representing the ARIMA model:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们建模多变量时间序列时，我们通常有一个我们感兴趣的预测变量。这个变量通常被称为**内生**变量。多变量时间序列中的其他协变量被称为**外生**变量。回想一下[*第11章*](B18945_11.xhtml#_idTextAnchor174)*，ARIMA模型*，代表ARIMA模型的方程：
- en: y′ t = c + ϕ 1 y′ t−1 + … + ϕ p  y ′  t−p + ϵ t + θ 1 ϵ t−1 + … + ϕ q ϵ t−q
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: y′ t = c + ϕ 1 y′ t−1 + … + ϕ p  y ′  t−p + ϵ t + θ 1 ϵ t−1 + … + ϕ q ϵ t−q
- en: 'Here, y′ t is the differenced series, differenced d times until it is stationary.
    In this model, y t is the variable we are interested in forecasting; it is the
    endogenous variable. Let us rewrite this equation in a more compact form. We collect
    the terms related to y′ t into one summation and the terms related to ϵ t into
    another summation. Let us start with the y′ t terms:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，y′ t是差分序列，差分d次直到它平稳。在这个模型中，y t是我们感兴趣的预测变量；它是内生变量。让我们以更紧凑的形式重写这个方程。我们将与y′ t相关的项收集到一个求和项中，将与ϵ t相关的项收集到另一个求和项中。让我们从与y′ t相关的项开始：
- en: ϕ 1 y′ t−1 + … + ϕ p  y ′  t−p = ∑ i=1 p ϕ i y′ t−i
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ϕ 1 y′ t−1 + … + ϕ p  y ′  t−p = ∑ i=1 p ϕ i y′ t−i
- en: 'Then, we will also collect the ϵ t terms into different summations:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将ϵ t项也收集到不同的求和项中：
- en: ϵ t + θ 1 ϵ t−1 + … + ϕ q ϵ t−q = ϵ t + ∑ j=1 q ϕ j ϵ t−j
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ϵ t + θ 1 ϵ t−1 + … + ϕ q ϵ t−q = ϵ t + ∑ j=1 q ϕ j ϵ t−j
- en: 'Putting these summations together, we get the following more compact version
    of our ARIMA equation:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 将这些求和项合并，我们得到以下更紧凑的ARIMA方程版本：
- en: y′ t = c + ∑ i=1 p ϕ i y′ t−i + ϵ t + ∑ j=1 q ϕ j ϵ t−j
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: y′ t = c + ∑ i=1 p ϕ i y′ t−i + ϵ t + ∑ j=1 q ϕ j ϵ t−j
- en: 'Now, let’s add the exogenous variables to the model. We will add the exogenous
    variables by adding a summation term to the model:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们将外生变量添加到模型中。我们将通过向模型中添加一个求和项来添加外生变量：
- en: y′ t = c + ∑ i=1 p ϕ i y′ t−i + ϵ t + ∑ j=1 q ϕ j ϵ t−j + ∑ k=1 r β k X tk
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: y′ t = c + ∑ i=1 p ϕ i y′ t−i + ϵ t + ∑ j=1 q ϕ j ϵ t−j + ∑ k=1 r β k X tk
- en: 'Here, there are r exogenous variables contained in the vector-valued variable
    X. Recall from earlier in the chapter, we can represent the vector-valued variable,
    as shown next, where the first index represents the time step, and the second
    index represents an individual series within the vector-valued variable:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，向量值变量X中包含r个外生变量。回想一下本章前面的内容，我们可以用以下方式表示向量值变量，其中第一个索引表示时间步，第二个索引表示向量值变量中的单个序列：
- en: X =  x 0,0 ⋮ x 0,k,  x 1,0 ⋮ x 1,k, … ,  x t,0 ⋮ x t,k
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: X =  x 0,0 ⋮ x 0,k,  x 1,0 ⋮ x 1,k, … ,  x t,0 ⋮ x t,k
- en: This is how we will incorporate the exogenous variables into the ARIMA model.
    Now, let’s talk about how we would pick the exogenous variables. In [*Chapter
    11*](B18945_11.xhtml#_idTextAnchor174)*, ARIMA Models*, using an ACF plot, we
    saw that certain lags of a time series are more influential than others for modeling
    a univariate time series. We will make similar judgments about exogenous variables
    using CCF plots. Let’s take a look at example CCF plots and discuss how to make
    these judgments.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是我们如何将外生变量纳入ARIMA模型的方法。现在，让我们谈谈如何选择外生变量。在[*第11章*](B18945_11.xhtml#_idTextAnchor174)*，ARIMA模型*中，我们使用ACF图看到，对于建模单变量时间序列，时间序列的某些滞后比其他滞后更有影响力。我们将使用CCF图对外生变量做出类似的判断。让我们看一下示例CCF图并讨论如何做出这些判断。
- en: 'The CCF plot for wind speed and temperature is shown in *Figure 12**.4*. We
    have marked where the most significant cross-correlations occur within a lag period
    of 48 hours. Recall this data is sampled hourly; thus, each lagged time step corresponds
    to a lag of 1 hour. The plot shows that the most significant cross-correlations
    occur at approximately lag 13, lag 24, and lag 37:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 风速和温度的CCF图显示在*图12**.4*中。我们已标记出在48小时滞后期内最显著的交叉相关发生的位置。回想一下，这些数据是每小时采样的；因此，每个滞后时间步对应1小时的滞后。该图显示最显著的交叉相关发生在大约滞后13、滞后24和滞后37处：
- en: '![Figure 12.4 – CCF plot of wind speed and temperature variables](img/B18945_12_004.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![图12.4 – 风速和温度变量的CCF图](img/B18945_12_004.jpg)'
- en: Figure 12.4 – CCF plot of wind speed and temperature variables
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.4 – 风速和温度变量的CCF图
- en: Based on the observation of the cross-correlation plot in *Figure 12**.4*, we
    would expect that temperature lags at 13, 24, and 37 could provide useful information
    for the current predicting wind speed. That is, the variables x t−13,temperature,
    x t−24,temperature, and x t−37,temperature may be useful for predicting y t. We
    can perform the same CCF analysis with the other two exogenous variables to determine
    which lags to use in the model. We found that pressure (`PRES`) had significant
    cross-correlations at lags 14 and 37, and dew point (`DEWP`) had significant cross-correlations
    at lags 2 and 20\. Now that we have assessed which lags of the exogenous variables
    we want to use in the model, let us go ahead and preprocess the data and fit the
    model.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 根据对*图12**.4*中交叉相关图观察，我们预计温度在13、24和37个滞后处可以提供对当前预测风速有用的信息。也就是说，变量x t−13,temperature、x t−24,temperature和x t−37,temperature可能对预测y t有用。我们可以对其他两个外生变量执行相同的CCF分析，以确定模型中要使用哪些滞后。我们发现压力(`PRES`)在滞后14和37处有显著的交叉相关性，露点(`DEWP`)在滞后2和20处有显著的交叉相关性。现在我们已经评估了模型中想要使用的外生变量的滞后，让我们继续预处理数据和拟合模型。
- en: Preprocessing the exogenous variables
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 预处理外生变量
- en: Before we fit the model, we need to preprocess the data to make the exogenous
    variables we mentioned previously. We need to create lagged versions of the time-series
    variables we described previously. We can lag a time series using the `shift()`
    method of a `pandas` `DataFrame`. Let’s take a look at a code example.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在拟合模型之前，我们需要预处理数据，以便制作之前提到的外生变量。我们需要创建之前描述的时间序列变量的滞后版本。我们可以使用`pandas` `DataFrame`的`shift()`方法来滞后时间序列。让我们看看一个代码示例。
- en: 'The following code sample shows how to use the `shift()` method to lag the
    pressure variable by `14`. The first several lines of code import the library
    and load the data. The last line in the code sample shifts the `PRES` variable
    backward in time by 14 time steps:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码示例展示了如何使用`shift()`方法将压力变量滞后`14`个时间步。代码的前几行导入库并加载数据。代码示例中的最后一行将`PRES`变量向后移动14个时间步：
- en: '[PRE0]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The `shift()` method can be used to shift a series forward or backward in time.
    In this case, we want our exogenous variables to lag the variable we want to predict.
    So, we need to provide a negative shift value to move the series backward in time.
    We will use a similar preprocessing step for the other exogenous variables to
    create the other lagged variables. This is shown in the following code sample.
    All of these lagged variables created with the `shift()` method are collected
    into a new `DataFrame` called `X`, which we will use in the fit step:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '`shift()`方法可以用来将序列向前或向后移动时间。在这种情况下，我们希望我们的外生变量滞后我们想要预测的变量。因此，我们需要提供一个负的移动值来将序列向后移动时间。我们将对其他外生变量使用类似的预处理步骤来创建其他滞后变量。这将在以下代码示例中展示。所有这些使用`shift()`方法创建的滞后变量都被收集到一个新的`DataFrame`中，称为`X`，我们将在拟合步骤中使用它：'
- en: '[PRE1]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: In the preceding code sample, we are taking a subset of the lagged variables
    (the first `1,000` data points) to limit the computation time of the model. With
    the variables collected in the new `X` `DataFrame`, the preprocessing is complete,
    and we can move on to fitting and assessing the model.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码示例中，我们正在取滞后变量（前`1,000`个数据点）的子集，以限制模型的计算时间。在收集到新的`X` `DataFrame`中的变量后，预处理完成，我们可以继续进行模型的拟合和评估。
- en: Fitting the model
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 拟合模型
- en: 'As in the previous chapter, we will use `auto_arima` to fit our ARIMA model.
    The main difference, in this case, is that we will need to provide the `auto_arima`
    function with the exogenous variables we created. The code to fit an ARIMA model
    with exogenous variables is shown in the following code sample:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 如前一章所述，我们将使用`auto_arima`来拟合我们的ARIMA模型。在这种情况下，主要区别是我们需要向`auto_arima`函数提供我们创建的外生变量。拟合带有外生变量的ARIMA模型的代码在以下代码示例中展示：
- en: '[PRE2]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'This code should look very similar to the code shown in [*Chapter 11*](B18945_11.xhtml#_idTextAnchor174)*,
    ARIMA Models*. In fact, the only difference is the addition is the `X` variable
    in the `auto_arima` function. Running this code will produce the following output:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码应该看起来与[*第11章*](B18945_11.xhtml#_idTextAnchor174)*中展示的代码非常相似，即ARIMA模型。事实上，唯一的区别是`auto_arima`函数中添加了`X`变量。运行此代码将产生以下输出：
- en: '[PRE3]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Again, this output should look very similar to the output we saw from `auto_arima`
    in [*Chapter 11*](B18945_11.xhtml#_idTextAnchor174)*, ARIMA Models*. It indicates
    we should use an AR(2) model based on the fit using the `auto_arima` only needs
    to fit a single coefficient for each exogenous variable in the model. It does
    not need to fit an `summary()` method on the object returned from `auto_arima`
    to see the coefficients and significance tests for the exogenous variables. Running
    the `summary()` method will output the following **seasonal autoregressive integrated
    moving average with eXogenous factors** (**SARIMAX**) results:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，这个输出应该与我们之前在 [*第 11 章*](B18945_11.xhtml#_idTextAnchor174)“ARIMA 模型”中看到的
    `auto_arima` 输出非常相似。它表明我们应该使用基于 `auto_arima` 适配的 AR(2) 模型，因为仅需要为模型中的每个外生变量适配一个系数。不需要在
    `auto_arima` 返回的对象上适配 `summary()` 方法来查看外生变量的系数和显著性检验。运行 `summary()` 方法将输出以下 **带有外生因素的季节自回归积分移动平均**（**SARIMAX**）结果：
- en: '![Figure 12.5 – SARIMAX summary for AR(2) model](img/B18945_12_005.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.5 – AR(2) 模型的 SARIMAX 摘要](img/B18945_12_005.jpg)'
- en: Figure 12.5 – SARIMAX summary for AR(2) model
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.5 – AR(2) 模型的 SARIMAX 摘要
- en: The output from the `summary()` method shown in the preceding snippet shows
    a lot of information. Let’s focus on the middle section of the output. The middle
    section shows the coefficients and significance tests for each exogenous variable
    and each ARIMA coefficient. The coefficients and test p-values are labeled `coef`
    and `P>|z|`, respectively. The significance test can help us determine whether
    variables should be included in the model.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面代码片段中显示的 `summary()` 方法的输出显示了大量的信息。让我们关注输出的中间部分。中间部分显示了每个外生变量和每个 ARIMA 系数的系数和显著性检验。系数和检验的
    p 值分别标记为 `coef` 和 `P>|z|`。显著性检验可以帮助我们确定哪些变量应该包含在模型中。
- en: Recall back in [*Chapter 7*](B18945_07.xhtml#_idTextAnchor118)*, Multiple Linear
    Regression*, we discussed the idea of multicollinearity, which essentially means
    two or more predictor variables are highly correlated. We could encounter a similar
    situation here. For example, consider the `temp_lag_13`, `temp_lag_24`, and `temp_lag_37`
    variables. Since the temperature time series exhibits autocorrelation, it is possible,
    even likely, that these lagged versions of the temperature time series could be
    highly correlated. When we observe multicollinearity, it is a sign that we can
    remove variables from the model. We would recommend using one of the feature selection
    methods described in [*Chapter 7*](B18945_07.xhtml#_idTextAnchor118), such as
    recursive feature selection, performance-based selection, or selection by statistical
    significance.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 回想一下在 [*第 7 章*](B18945_07.xhtml#_idTextAnchor118)“多元线性回归”中，我们讨论了多重共线性这一概念，它本质上意味着两个或更多预测变量高度相关。我们在这里可能会遇到类似的情况。例如，考虑
    `temp_lag_13`、`temp_lag_24` 和 `temp_lag_37` 变量。由于温度时间序列表现出自相关性，这些温度时间序列的滞后版本可能是高度相关的，甚至很可能是这样。当我们观察到多重共线性时，这是一个我们可以从模型中移除变量的信号。我们建议使用在第
    7 章[*]中描述的特征选择方法之一，例如递归特征选择、基于性能的选择或基于统计显著性的选择。
- en: 'The preceding output shows only three of the exogenous variables in the current
    model, which are highlighted. This means we should consider reducing the variable
    in this model. We can do this with multiple methods; for this example, we will
    choose to eliminate features based on p-values. We will iteratively remove the
    feature with the highest p-value until all features have a p-value below 0.05\.
    The code for this selection process is shown here:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的输出只显示了当前模型中的三个外生变量，这些变量被突出显示。这意味着我们应该考虑减少模型中的变量。我们可以通过多种方法做到这一点；在这个例子中，我们将选择基于
    p 值消除特征。我们将迭代地移除具有最高 p 值的特征，直到所有特征的 p 值都低于 0.05。这个选择过程的代码如下所示：
- en: '[PRE4]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Performing this selection process will result in a model only containing the
    `temp_lag_24`, `temp_lag_37`, `pres_lag_24`, and `dewp_lag_2` exogenous variables.
    The ARIMA portion of the model is still an AR(2) model. With a model selection
    taken, let’s assess the model’s performance.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 执行这个选择过程将导致一个只包含 `temp_lag_24`、`temp_lag_37`、`pres_lag_24` 和 `dewp_lag_2` 外生变量的模型。模型的
    ARIMA 部分仍然是 AR(2) 模型。在模型选择完成后，让我们评估模型的表现。
- en: Assessing model performance
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 评估模型性能
- en: 'We will assess the performance of the model by plotting the forecast versus
    the actual data points and calculating an error estimate. Let us start by looking
    at the forecasts from the ARIMAX model for the next `200` observations. The forecasts
    and test data points are plotted in *Figure 12**.6*:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过绘制预测与实际数据点的对比图，并计算误差估计来评估模型的性能。让我们首先查看ARIMAX模型对下一个`200`个观测值的预测。预测和测试数据点在*图12.6*中绘制：
- en: '![Figure 12.6 – Forecast of wind speed using an ARIMAX model](img/B18945_12_006.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![图12.6 – 使用ARIMAX模型预测风速](img/B18945_12_006.jpg)'
- en: Figure 12.6 – Forecast of wind speed using an ARIMAX model
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.6 – 使用ARIMAX模型预测风速
- en: 'We can see the forecast for wind speed using the ARIMAX model we created in
    *Figure 12**.6*. Two observations stand out from the plotted forecast:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到使用我们在*图12.6*中创建的ARIMAX模型预测的风速。从绘制的预测中，有两个观察结果突出：
- en: The forecast captures the oscillation of the `windspeed` variable
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测捕捉了`风速`变量的振荡
- en: The forecast fails to capture the high spikes in `windspeed`
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测未能捕捉到`风速`中的高峰值
- en: 'To understand whether the exogenous variables provided material value in the
    model, we should compare the forecasts of the ARIMAX model, shown in *Figure 12**.6*,
    to forecasts from a univariate model. The forecasts from a univariate model are
    shown i*n* *Figure 12**.7*:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解提供的自变量是否在模型中提供了物质价值，我们应该将*图12.6*中显示的ARIMAX模型的预测与单变量模型的预测进行比较。单变量模型的预测显示在*i*
    *图12.7*：
- en: '![Figure 12.7 – Forecast of wind speed using an ARIMA model](img/B18945_12_007.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![图12.7 – 使用ARIMA模型预测风速](img/B18945_12_007.jpg)'
- en: Figure 12.7 – Forecast of wind speed using an ARIMA model
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.7 – 使用ARIMA模型预测风速
- en: The forecasts of the ARIMA model, shown in *Figure 12**.7*, do not appear to
    capture much variation in the time series as the forecast length grows. This is
    actually a property of ARMA models. It should be evident from the two plots that
    the ARIMAX model provides a better forecast than the ARIMA model. Finally, let
    us compare the **mean squared error** (**MSE**) of the forecasts of the two models.
    The MSE from the ARIMAX model is approximately 1.5, while the MSE from the ARIMA
    model is about 1.7\. The MSE value confirms what we saw in the plots—namely, the
    ARIMAX model provides a better forecast for this multivariate time series.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 如*图12.7*中所示，ARIMA模型的预测似乎没有捕捉到随着预测长度增长的时间序列中的很大变化。这实际上是ARMA模型的一个特性。从两个图中应该很明显，ARIMAX模型比ARIMA模型提供了更好的预测。最后，让我们比较两个模型的**均方误差**（**MSE**）。ARIMAX模型的MSE大约为1.5，而ARIMA模型的MSE约为1.7。MSE值证实了我们从图中看到的情况——即ARIMAX模型为这个多元时间序列提供了更好的预测。
- en: In this section, we discussed an extension to the ARIMA model that allows us
    to incorporate information from covariates in a multivariate time series. This
    is only one of many methods for multivariate time series. In the next section,
    we will discuss another method for working with multivariate time-series data.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们讨论了ARIMA模型的扩展，使我们能够将协变量信息纳入多元时间序列。这仅仅是多元时间序列的许多方法之一。在下一节中，我们将讨论另一种处理多元时间序列数据的方法。
- en: VAR modeling
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: VAR建模
- en: 'The AR(p), MA(q), ARMA(p,q), ARIMA(p,d,q)m, and SARIMA(p,d,q) models we looked
    at in the last chapter form the basis of multivariate VAR modeling. In this chapter,
    we have discussed ARIMA with exogenous variables (ARIMAX). We will now begin discussion
    on the VAR model. First, it is important to understand that while **ARIMAX requires
    leading (future) values of the exogenous variables**, **no future values of these
    variables are required for the VAR model** as they are all autoregressive to each
    other – hence the name vector autoregressive – and by definition not exogenous.
    To start, let us consider the two-variable, or bivariate, case. Consider a process
    y t that is the output of two different input variables, y t1 and y t2\. Note
    that in matrix form, we are discussing the case of an nxm matrix (y n,m) where
    *n* corresponds to the point in **time** and *m* corresponds to the **variables**
    involved (variables 1,2, … , m). We exclude the comma from notation going forward,
    but it is important to understand when we discuss multivariate autoregressive
    processes that we are discussing data within a multidimensional matrix rather
    than only the single-dimensional vector form we used for univariate time-series
    analysis. We can write our process, y t, in vector notation as follows:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们研究的 AR(p)，MA(q)，ARMA(p,q)，ARIMA(p,d,q)m 和 SARIMA(p,d,q) 模型构成了多元 VAR
    模型的基础。在本章中，我们讨论了带有外生变量的 ARIMA（ARIMAX）。现在，我们将开始讨论 VAR 模型。首先，重要的是要理解，虽然 **ARIMAX
    需要外生变量的领先（未来）值**，**VAR 模型不需要这些变量的未来值**，因为它们彼此都是自回归的——因此得名向量自回归——并且根据定义不是外生的。为了开始，让我们考虑两个变量，或双变量，的情况。考虑一个过程
    y_t，它是两个不同输入变量 y_t^1 和 y_t^2 的输出。请注意，在矩阵形式中，我们讨论的是 nxm 矩阵（y_n,m）的情况，其中 *n* 对应时间点，*m*
    对应涉及的变量（变量 1，2，…，m）。我们将在后续的符号中省略逗号，但重要的是要理解，当我们讨论多元自回归过程时，我们讨论的是多维矩阵中的数据，而不仅仅是用于单变量时间序列分析的单维向量形式。我们可以如下用向量符号表示我们的过程
    y_t：
- en: y t = [y t1 y t2].
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: y_t = [y_t^1 y_t^2].
- en: 'We can expand on the input variables’ definitions as a VAR(1) process, here,
    for the two variables in y t shown previously:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以进一步扩展输入变量的定义，这里，对于之前显示的 y_t 中的两个变量，作为 VAR(1) 过程：
- en: y t1 = (1 − ϕ 11) μ 1 − ϕ 12 μ 2 + ϕ 11 y t−11 + ϕ 12 y t−12 + ε t1
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: y_t^1 = (1 − ϕ_11) μ_1 − ϕ_12 μ_2 + ϕ_11 y_{t−1}^1 + ϕ_12 y_{t−1}^2 + ε_t^1
- en: y t2 = − ϕ 21 μ 1 + (1 − ϕ 22) μ 2 + ϕ 21 y t−11 + ϕ 22 y t−12 + ε t2.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: y_t^2 = − ϕ_21 μ_1 + (1 − ϕ_22) μ_2 + ϕ_21 y_{t−1}^1 + ϕ_22 y_{t−1}^2 + ε_t^2.
- en: The terms (1 − ϕ 11) μ 1 − ϕ 12 μ 2 and − ϕ 21 μ 1 − (1 − ϕ 22) μ 2 are our
    **model constants** (*β* coefficients).
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 项 (1 − ϕ_11) μ_1 − ϕ_12 μ_2 和 − ϕ_21 μ_1 − (1 − ϕ_22) μ_2 是我们的**模型常数**（*β* 系数）。
- en: 'We can reduce the previous processes (using a zero-mean form) into the matrix-reduced
    form, like so:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将前面的过程（使用零均值形式）简化为矩阵简化形式，如下所示：
- en: y t = Φ 1 y t−1 + ε t
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: y_t = Φ_1 y_{t−1} + ε_t
- en: 'Here, we have the following:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们有以下内容：
- en: Φ 1 = [ϕ 11 ϕ 12 ϕ 21 ϕ 22]
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: Φ_1 = [ϕ_11 ϕ_12 ϕ_21 ϕ_22]
- en: 'Our forecast for a VAR(1) model is shown here:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对 VAR(1) 模型的预测如下：
- en: ˆ y  t 01(l) = (1 − ϕ 11)  _ y  1 − ϕ 12  _ y  2 + ϕ 11  ˆ y  t 01(l − 1) +
    ϕ 12  ˆ y  t 02(l − 1)
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: ˆy_t^(1)(l) = (1 − ϕ_11) ˆy_1 − ϕ_12 ˆy_2 + ϕ_11 ˆy_t^(1)(l − 1) + ϕ_12 ˆy_t^(2)(l
    − 1)
- en: ˆ y  t 02(l) = − ϕ 21  _ y  1 + (1 − ϕ 22)  _ y  2 + ϕ 21  ˆ y  t 01(l − 1)
    + ϕ 22  ˆ y  t 02(l − 1)
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: ˆy_t^(2)(l) = − ϕ_21 ˆy_1 + (1 − ϕ_22) ˆy_2 + ϕ_21 ˆy_t^(1)(l − 1) + ϕ_22 ˆy_t^(2)(l
    − 1)
- en: 'It also includes this:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 它还包括以下内容：
- en: ˆ y  t 0(l) = [ ˆ y  t 01(l)  ˆ y  t 02(l)]
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: ˆy_t^(0)(l) = [ˆy_t^(1)(l) ˆy_t^(2)(l)]
- en: 'Here, *l* represents the forward lag (t + 1, t + 2, … , t + n),  ˆ y  t 0m
    represents the forecasted value at time *t* for variable *m*, and t 0 corresponds
    to the most recent point in time (often, the length of the data). It is also important
    to note the mxm covariance matrix is this:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*l* 代表前向滞后（t + 1，t + 2，…，t + n），ˆy_t^(0)m 代表变量 *m* 在时间 *t* 的预测值，t_0 对应时间上最接近的点（通常是数据的长度）。还应注意
    mxm 协方差矩阵如下：
- en: ˆ Γ (k) =   ˆ γ  11(k) …  ˆ γ  1m(k)  ⋮ ⋱ ⋮   ˆ γ  m1(k) …  ˆ γ  mm(k)
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: ˆΓ(k) = ˆγ_11(k) … ˆγ_1m(k) ⋮⋱⋮ ˆγ_m1(k) … ˆγ_mm(k)
- en: 'Here, each covariance,  ˆ γ  ij(k), with *k* corresponding to the lag, is calculated
    as follows:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，每个协方差 ˆγ_ij(k)，其中 *k* 对应滞后，计算如下：
- en: ˆ γ  ij(k) =  1 _ n  ∑ t=1 n−k (y ti −  _ y  i)(y t+k,j −  _ y  j).
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: ˆγ_ij(k) = 1/n ∑_{t=1}^{n−k} (y_t^i − ˆy_i)(y_{t+k,j} − ˆy_j).
- en: 'Our estimated cross-correlation between each variable y ti and y tj is therefore
    calculated as follows:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们计算每个变量 y_t^i 和 y_t^j 之间的估计互相关如下：
- en: ˆ ρ  ij(k) =   ˆ γ  ij(k) _ √ ___________  ˆ γ  ii(0)  ˆ γ  jj(0)
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: ˆρ_ij(k) = ˆγ_ij(k) √___________ ˆγ_ii(0) ˆγ_jj(0)
- en: Understanding the calculations for cross-correlation and, especially, covariance
    helps with understanding the relationships between the variables and their impact
    on model fit. The method for combining the two models to generate one overall
    process forecast,  ˆ y  t, is through weighting the two input means and their
    correlations into one response. As we can see in our VAR(1) forecast, shown previously,
    the correlations between each given variable and the other variables across different
    points in time are able to be modeled using a VAR model. Notably, there are no
    truly independent and dependent variables in a VAR model; there is simply an interaction
    between each variable. It is important to note that all processes modeled with
    a VAR model should be **stationary**.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 理解交叉相关和，尤其是协方差的计算方法有助于理解变量之间的关系及其对模型拟合的影响。将两个模型结合以生成一个整体过程预测的方法是通过加权两个输入均值及其相关性到一个响应中。正如我们之前在VAR(1)预测中看到的那样，每个给定变量与其他变量在不同时间点的相关性可以使用VAR模型进行建模。值得注意的是，在VAR模型中没有真正的独立和依赖变量；只是每个变量之间存在相互作用。重要的是要注意，所有使用VAR模型建模的过程都应该是**平稳的**。
- en: 'Using the *United States Macroeconomic* dataset found at [https://www.statsmodels.org/dev/datasets/generated/macrodata.xhtml](https://www.statsmodels.org/dev/datasets/generated/macrodata.xhtml),
    we can observe the relationship between real gross private domestic investment
    (`realinv`), real personal consumption expenditures (`realcons`), and real private
    disposable income (`realdpi`) with a zero-mean form in the context of VAR modeling,
    as follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 使用在[https://www.statsmodels.org/dev/datasets/generated/macrodata.xhtml](https://www.statsmodels.org/dev/datasets/generated/macrodata.xhtml)找到的*美国宏观经济*数据集，我们可以观察到在VAR建模的零均值形式下，实际国内私人投资（`realinv`）、实际个人消费支出（`realcons`）和实际私人可支配收入（`realdpi`）之间的关系。
- en: realcons(t) = ϕ 11 realcons t−11 + ϕ 12 realinv t−12 + ϕ 13 realdpi t−13 + ε t1
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: realcons(t) = ϕ 11 realcons t−11 + ϕ 12 realinv t−12 + ϕ 13 realdpi t−13 + ε t1
- en: realinv(t) = ϕ 21 realcons t−11 + ϕ 22 realinv t−12 + ϕ 23 realdpi t−13 + ε t2
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: realinv(t) = ϕ 21 realcons t−11 + ϕ 22 realinv t−12 + ϕ 23 realdpi t−13 + ε t2
- en: realdpi(t) = ϕ 31 realcons t−11 + ϕ 32 realinv t−12 + ϕ 33 realdpi t−13 + ε t3
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: realdpi(t) = ϕ 31 realcons t−11 + ϕ 32 realinv t−12 + ϕ 33 realdpi t−13 + ε t3
- en: 'Let us look at an example using this data in the VAR process in Python with
    the `statsmodels` VARMAX model. First, let’s load the data:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们用一个例子来看看如何在Python中使用`statsmodels` VARMAX模型对这个数据进行VAR过程分析。首先，让我们加载数据：
- en: '[PRE5]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'We can see here from the output that 100% of our yearly quarters are unique
    and thus, no timestamp duplication exists:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 从输出中我们可以看到，我们每年的季度都是唯一的，因此不存在时间戳重复：
- en: '`100.0% of yearly quarters` `are unique`'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '`100.0% of yearly quarters` `are unique`'
- en: 'One of the first things we always need to do when performing regression-based
    time-series modeling is to ensure stationarity. In VAR modeling, this means all
    variables must be stationary. The first step is to visualize the process realizations
    through line plotting by index. If data points are aggregated at an interval desired
    to be modeled, then we can leave the index as is, but if a different time indexing
    is desired, we need to specify this. Here, we are going to build a model to determine
    how `quarter` to the length of the data since that is the smallest denomination
    of time and there is one yearly quarter per index, as we checked previously. We
    then set the index to `quarter` (this is why `quarter` appears twice; once as
    the index and once as the column name):'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行基于回归的时间序列建模时，我们首先需要确保数据的平稳性。在VAR建模中，这意味着所有变量都必须是平稳的。第一步是通过按索引进行线绘图来可视化过程实现。如果数据点按要建模的间隔聚合，则可以保留索引不变，但如果需要不同的时间索引，则需要指定这一点。在这里，我们将构建一个模型来确定数据长度对应的`季度`，因为这是时间的最小单位，并且每个索引都有一个年度季度，正如我们之前检查的那样。然后我们将索引设置为`季度`（这就是为什么`季度`出现了两次；一次作为索引，一次作为列名）：
- en: '[PRE6]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Note the updated index and `quarter` values:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 注意更新的索引和`季度`值：
- en: '| **quarter** | **year** | **quarter** | **realcons** | **realinv** | **realdpi**
    |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| **季度** | **年份** | **季度** | **实际消费** | **实际投资** | **实际可支配收入** |'
- en: '| 1 | 1959 | 1 | 1707.4 | 286.898 | 1886.9 |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 1959 | 1 | 1707.4 | 286.898 | 1886.9 |'
- en: '| 2 | 1959 | 2 | 1733.7 | 310.859 | 1919.7 |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 1959 | 2 | 1733.7 | 310.859 | 1919.7 |'
- en: '| 3 | 1959 | 3 | 1751.8 | 289.226 | 1916.4 |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 1959 | 3 | 1751.8 | 289.226 | 1916.4 |'
- en: '| 4 | 1959 | 4 | 1753.7 | 299.356 | 1931.3 |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 1959 | 4 | 1753.7 | 299.356 | 1931.3 |'
- en: '| 5 | 1960 | 5 | 1770.5 | 331.722 | 1955.5 |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| 5 | 1960 | 5 | 1770.5 | 331.722 | 1955.5 |'
- en: Figure 12.8 – First five rows of macrodata data set for VAR modeling
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.8 – VAR建模的宏观数据集的前五行
- en: Here, we will walk through six steps to produce a VAR model using the dataset
    we imported and prepared, shown partially in *Figure 12**.8*.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将通过六个步骤来使用我们导入和准备的数据集构建一个VAR模型，部分内容如图*12.8*所示。
- en: Step 1 – visual inspection
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第1步 – 视觉检查
- en: 'In the line plot of the data in *Figure 12**.9*, we can see what appears to
    be a strong linear trend. We need to check the ACF plots to assess this. After,
    we will run a **Dickey-Fuller test** to confirm:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图12.9*的数据线图中，我们可以看到似乎有一个强烈的线性趋势。我们需要检查ACF图来评估这一点。之后，我们将运行**Dickey-Fuller测试**来确认：
- en: '![Figure 12.9 – Line plots of realcons, realdpi, and realinv](img/B18945_12_009.jpg)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![图12.9 – realcons、realdpi和realinv的线图](img/B18945_12_009.jpg)'
- en: Figure 12.9 – Line plots of *realcons*, *realdpi*, and *realinv*
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.9 – realcons、realdpi和realinv的线图
- en: 'The ACF plots in *Figure 12**.10* show a strong indication of a linear trend
    and at least one unit root, which likely gives us that trend:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '*图12.10*中的ACF图显示出强烈的线性趋势和至少一个单位根的迹象，这很可能是导致这种趋势的原因：'
- en: '![Figure 12.10 – ACF plots for VARMAX input variables](img/B18945_12_010.jpg)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![图12.10 – VARMAX输入变量的ACF图](img/B18945_12_010.jpg)'
- en: Figure 12.10 – ACF plots for VARMAX input variables
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.10 – VARMAX输入变量的ACF图
- en: 'After running a Dickey-Fuller test, we can see that each variable contains
    a unit root and is thus trended. Therefore, we need to apply a first-order difference
    to all three variables so that we can work toward stationarizing the data. Recall
    that the **null hypothesis for the Dickey-Fuller is that a unit root exists**,
    and the alternative hypothesis is that one does not. We’ll execute the following
    code:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行Dickey-Fuller测试后，我们可以看到每个变量都包含一个单位根，因此是趋势性的。因此，我们需要对所有三个变量应用一阶差分，以便我们可以朝着使数据平稳化的方向发展。回想一下，Dickey-Fuller的零假设是存在一个单位根，备择假设是不存在。我们将执行以下代码：
- en: '[PRE7]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Here we can see the Dickey-Fuller results for each variable. Recall the null
    hypothesis is the presence of a single unit root. Therefore, since the p-values
    are not low, we will not reject the null hypothesis. This gives us statistical
    evidence to assume the presence of trend:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到每个变量的Dickey-Fuller结果。回想一下，零假设是存在一个单位根。因此，由于p值不高，我们不会拒绝零假设。这为我们提供了统计证据，假设存在趋势：
- en: '`ADF p-value for` `realcons: 0.9976992503412904`'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '`ADF p-value for realcons: 0.9976992503412904`'
- en: '`ADF p-value for` `realinv: 0.6484956579101141`'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '`ADF p-value for realinv: 0.6484956579101141`'
- en: '`ADF p-value for` `realdpi: 1.0`'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '`ADF p-value for realdpi: 1.0`'
- en: 'Let’s difference the data here with a loop:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们用循环来区分这里的数据：
- en: '[PRE8]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Step 2 – selecting the order of AR(p)
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第2步 – 选择AR(p)的阶数
- en: Now, we can rerun the ACF plots to check whether we still see trending autocorrelation.
    Because the original line plots did not appear to have seasonality, we will go
    ahead and plot the **partial ACFs** (**PACFs**) to get an idea of what kind of
    AR(p) ordering might be useful. Had we suspected seasonality, it might have been
    useful to check the **spectral density of the sample autocorrelations to quantify
    seasonal periodicity**, a process we demonstrated in [*Chapter 11*](B18945_11.xhtml#_idTextAnchor174)*,
    ARIMA Models*. When checking the PACF plots, we will use the **Yule-Walker method**.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以重新运行ACF图来检查是否仍然看到趋势自相关。因为原始的线图看起来没有季节性，我们将继续绘制**部分ACF**（**PACFs**）来了解可能有用的AR(p)阶数。如果我们怀疑存在季节性，检查**样本自相关的频谱密度**来量化季节周期性可能是有用的，这个过程我们在[*第11章*](B18945_11.xhtml#_idTextAnchor174)“ARIMA模型”中演示过。在检查PACF图时，我们将使用**Yule-Walker方法**。
- en: We can see in the ACF plots there is no apparent seasonality. When using a VAR
    model, all terms are used to estimate all other terms as the estimates for a forecast
    of any term are developed. In other words, to forecast one, we must forecast all.
    The reason this matters is that when looking at the PACFs in *Figure 12**.11*,
    we can see one variable could arguably be fit with an AR(1) (real investment)
    model, one with an AR(2) (real disposable income) model, and another with an AR(3)
    (real consumption) model. Using orders that are significant for each variable
    is one important aspect of making VAR modeling work.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在ACF图中看到没有明显的季节性。在使用VAR模型时，所有项都用于估计所有其他项，因为任何项的预测都是通过估计所有项来发展的。换句话说，为了预测一个，我们必须预测所有。这之所以重要，是因为当我们查看*图12.11*中的PACFs时，我们可以看到一个变量可以用AR(1)（实际投资）模型拟合，另一个可以用AR(2)（实际可支配收入）模型拟合，另一个可以用AR(3)（实际消费）模型拟合。使用对每个变量都显著的阶数是使VAR建模工作的重要方面之一。
- en: 'Another important aspect of selecting ordering in a VAR model is cross-correlation.
    For example, we may have a model of variables whose highest order is order 3,
    but if the cross-correlation between the target variable and the input variable
    is at lag 5, we would most likely need to use lag 5\. However, a model using lag
    3 or 4 may also be useful. As with any regression model, however, we will always
    want to check the significance of coefficient terms following model training:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 在VAR模型中选择排序的一个重要方面是交叉相关。例如，我们可能有一个变量的最高阶数为3阶，但如果目标变量与输入变量之间的交叉相关在滞后5期，我们很可能需要使用滞后5期。然而，使用滞后3期或4期的模型也可能是有用的。然而，与任何回归模型一样，我们总是希望在模型训练后检查系数项的显著性：
- en: '![Figure 12.11 – Differenced VARMAX variables; ACFs and PACFs](img/B18945_12_011.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![图12.11 – 差分VARMAX变量；自相关函数（ACF）和偏自相关函数（PACF）](img/B18945_12_011.jpg)'
- en: Figure 12.11 – Differenced VARMAX variables; ACFs and PACFs
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.11 – 差分VARMAX变量；自相关函数（ACF）和偏自相关函数（PACF）
- en: Step 3 – assessing cross-correlation
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第3步 – 评估交叉相关
- en: For a VAR model, cross-correlation is most important between the variables we
    consider as inputs and the variable(s) we consider our target. This can be done
    using multiple lags or with the most significant lag if multiple iterations of
    the same variable using different shifts are a concern for overfitting. We must
    confirm cross-correlation analysis used in a forecasting model is done with respect
    to each input variable and the dependent variable. A cross-correlation that shows
    the input variable as a leading indicator for the target variable is not of major
    concern; it means historical values of the input are used to predict the target.
    However, if we have a scenario where the input is a lagging indicator—meaning
    the target predicts the input—and we want to use the input to predict the target,
    we will need to shift the input forward so that the correlation is at lag 0 and
    trim the data by the amount shifted.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 对于VAR模型，我们考虑的输入变量和目标变量之间的交叉相关最为重要。这可以通过多个滞后或使用最显著的滞后来实现，如果担心使用不同位移的同一变量的多次迭代会导致过拟合。我们必须确认在预测模型中使用的交叉相关分析是针对每个输入变量和因变量的。一个显示输入变量作为目标变量的领先指标的交叉相关不是主要问题；这意味着使用输入的历史值来预测目标。然而，如果我们有一个输入是滞后指标的场景——意味着目标预测输入——并且我们想使用输入来预测目标，我们需要将输入向前移动，以便相关性在滞后0期，并通过移动的量来裁剪数据。
- en: In many cases, there is significant leading and lagging cross-correlation; this
    may indicate seasonality. In the case of seasonality with a VAR model, an indicator
    variable should be included with the data that provides a value of 1 associated
    with the peak in spectral density and a 0 value otherwise. Another special case
    with cross-correlation is that the input variable has prominent statistical significance
    but only at a lag far back in time. In this case, it may be appropriate to shift
    the data forward so that the model does not include terms (autocorrelations) that
    are not significant at the risk of overfitting. To demonstrate shifting based
    on the CCF, we will incorporate this into our process, next.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '在许多情况下，存在显著的领先和滞后交叉相关；这可能会表明季节性。在季节性的VAR模型中，应该包含一个指示变量，该变量在频谱密度峰值时提供值为1，在其他情况下提供值为0。交叉相关的一个特殊情况是输入变量具有显著的统计显著性，但仅在时间上非常远的滞后。在这种情况下，可能需要将数据向前移动，以便模型不包括（自相关）不显著的项，以避免过拟合的风险。为了演示基于CCF的移动，我们将在下一个过程中将其纳入我们的流程。 '
- en: 'We observe in *Figure 12**.12* that the strongest correlation between `realdpi`
    and `realinv` is at lag 0, but there are at least two other similarly correlated
    lags at *x=-27* and *x=-37* in the plot. As we saw in the *ARIMAX* section, we
    can include multiple shifted versions of the same variables as new variables to
    improve the predictive power of the model. This would enable us to take advantage
    of multiple correlations. However, for the purpose of model demonstration, we
    will not include that as the output from the VAR summary can become large. Also,
    as we mentioned, including too many lags of the same variable can result in overfitting.
    It is up to the practitioner to ultimately decide how many lags to use. This must
    be done by assessing model fit and bias/variance trade-offs. The function code
    given here is also in [*Chapter 10*](B18945_10.xhtml#_idTextAnchor160)*, Introduction
    to* *Time Series*:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *图 12.12* 中，我们观察到 `realdpi` 和 `realinv` 之间最强的相关性出现在滞后 0，但在图中 *x=-27* 和 *x=-37*
    处至少还有两个其他类似相关性的滞后。正如我们在 *ARIMAX* 部分所看到的，我们可以将同一变量的多个平移版本作为新变量包括进来，以提高模型的预测能力。这将使我们能够利用多个相关性。然而，出于模型演示的目的，我们不会将其包括在内，因为
    VAR 汇总的结果可能会变得很大。此外，正如我们提到的，包括太多相同变量的滞后可能会导致过拟合。最终决定使用多少滞后取决于实践者。这必须通过评估模型拟合和偏差/方差权衡来完成。这里给出的函数代码也在
    [*第 10 章*](B18945_10.xhtml#_idTextAnchor160)*，时间序列导论* 中：
- en: '[PRE9]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![Figure 12.12 – Cross-correlation for realdpi and realinv](img/B18945_12_012.jpg)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.12 – 实际对数和实际逆的互相关](img/B18945_12_012.jpg)'
- en: Figure 12.12 – Cross-correlation for *realdpi* and *realinv*
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.12 – 实际对数和实际逆的互相关
- en: 'In *Figure 12**.13*, we can see `realcons` is a leading indicator for `realinv`
    with a positive correlation. This means an increase in consumption results in
    an increase in investment. Nonetheless, we could still use a downshifted version
    of `realinv` to predict `realcons`—if this were our objective—since both variables
    are expected to continue indefinitely:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *图 12.13* 中，我们可以看到 `realcons` 是 `realinv` 的领先指标，两者呈正相关。这意味着消费的增加会导致投资增加。尽管如此，我们仍然可以使用
    `realinv` 的下移版本来预测 `realcons`——如果这是我们的目标——因为这两个变量预计将无限期地继续：
- en: '[PRE10]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![Figure 12.13 – Cross-correlation for realcons and realinv](img/B18945_12_013.jpg)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.13 – 实际常数和实际逆的互相关](img/B18945_12_013.jpg)'
- en: Figure 12.13 – Cross-correlation for *realcons* and *realinv*
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.13 – 实际常数和实际逆的互相关
- en: To address the one-lag lead `realcons` has on `realinv`, let us shift `realcons`
    forward one index so that the strongest correlation is at lag 0\. This is not
    required for a VAR model but can be useful in scenarios where the most significant
    lag is **much farther back** in time and could result in including an unreasonably
    high order for our model to include the necessary variable relationships.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决 `realcons` 对 `realinv` 的一滞后领先问题，让我们将 `realcons` 向前移动一个索引，以便最强的相关性出现在滞后
    0。这对于 VAR 模型不是必需的，但在最显著的滞后远在时间上并且可能导致包括不合理的模型阶数以包含必要的变量关系的情况下可能是有用的。
- en: Note on shifting data
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 关于数据平移的说明
- en: When shifting data, null values will be included in the dataset. Consequently,
    the dataset must be trimmed by the length of the shift. This may come at the cost
    of model performance, so it is worth assessing the need to shift by comparing
    model errors.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在平移数据时，数据集中将包含空值。因此，数据集必须根据平移的长度进行裁剪。这可能会以模型性能为代价，因此值得通过比较模型误差来评估平移的需要。
- en: 'After applying a forward shift to `realcons` in the following code snippet
    and rerunning the CCF, we can see in *Figure 12**.14* the variables’ strongest
    correlation is now at lag 0:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下代码片段中对 `realcons` 应用前移平移并重新运行 CCF 后，我们可以在 *图 12.14* 中看到变量的最强相关性现在出现在滞后 0：
- en: '[PRE11]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![Figure 12.14 – Cross-correlation for realinv and forward-shifted realcons](img/B18945_12_014.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.14 – 实际逆和前移实际常数的互相关](img/B18945_12_014.jpg)'
- en: Figure 12.14 – Cross-correlation for *realinv* and forward-shifted *realcons*
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.14 – 实际逆和前移实际常数的互相关
- en: 'Next, we want to run a function to append possible values of p and q (AR(p)
    and MA(q)):'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们想要运行一个函数来追加 p 和 q 的可能值（AR(p) 和 MA(q)）：
- en: '[PRE12]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Here we can see the AIC error for VAR(1,0) and VAR(2,0) models:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到 VAR(1,0) 和 VAR(2,0) 模型的 AIC 错误：
- en: '`(p,q): (1,0),` `AIC: 6092.740258665657`'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '`(p,q): (1,0),` `AIC: 6092.740258665657`'
- en: '`(p,q): (2,0),` `AIC: 6050.444583720871`'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '`(p,q): (2,0),` `AIC: 6050.444583720871`'
- en: We have two possible models through the AIC selection method. First, we built
    a model with `p=2` and `q=0`, but after running, we observed that of seven coefficients
    predicting for `realinv`, only two were significant (even at the 0.10 level of
    significance), which is not good. After rerunning using a selection of `p=1` and
    `q=0`, two of the four coefficients were found significant at the 0.05 level of
    significance and all at the 0.10 level of significance. Therefore, we can conclude
    the `realinv`.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 通过AIC选择方法，我们有两种可能的模型。首先，我们构建了一个`p=2`和`q=0`的模型，但在运行后，我们观察到在预测`realinv`的七个系数中，只有两个在0.10的显著性水平上是显著的，这并不好。在重新运行并选择`p=1`和`q=0`后，我们发现四个系数中有两个在0.05的显著性水平上显著，并且在0.10的显著性水平上全部显著。因此，我们可以得出结论，`realinv`。
- en: Step 4 – building the VAR(p,q) model
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第4步 – 构建VAR(p,q)模型
- en: We will skip the model validation steps we walked through in the last chapter
    as the process would be the same here. What we will do here is re-order the columns
    so that when we run the `get_prediction()` function, the results are for the first
    column. The model will stay the same since all variables are used to predict all
    other variables. After re-indexing, we will run the `VARMAX` model with `realcons`
    shifted up one, and predict `realinv`. For our model, we used AR(1) and MA(0).
    Note that we use `trend='c'` for *constant* as we removed `trend` when performing
    differencing; the `trend` argument is for trend determinism. Trend differencing
    should be handled outside of the model since not all variables may have unit root
    trends. Handling trends outside of the model also helps us identify components
    such as seasonality or significance of the true autocorrelation structure following
    the removal of `trend`. It is worthwhile to note that seasonality is not addressed
    directly with the VAR (and VARMAX) model; indicator (dummy) variables for seasonality
    should be included.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将跳过上一章中介绍过的模型验证步骤，因为在这里的过程将是相同的。我们将在这里重新排序列，以便当我们运行`get_prediction()`函数时，结果是对第一列的。由于所有变量都用于预测所有其他变量，因此模型将保持不变。重新索引后，我们将运行带有`realcons`上移一个位置的`VARMAX`模型，并预测`realinv`。对于我们的模型，我们使用了AR(1)和MA(0)。请注意，我们使用`trend='c'`来表示**常数**，因为我们进行差分时移除了`trend`；`trend`参数用于趋势确定性。趋势差分应在模型之外处理，因为并非所有变量都可能具有单位根趋势。在模型之外处理趋势还有助于我们识别季节性或移除`trend`后的真实自相关结构的显著性。值得注意的是，季节性并没有直接通过VAR（和VARMAX）模型来处理；应包括表示季节性的指示（虚拟）变量。
- en: 'Regarding model fit, we can refer to [*Chapter 11*](B18945_11.xhtml#_idTextAnchor174)*,
    ARIMA Models,* for information on `Dep. Variable` list, shown next. Each model
    variable has listed the coefficients of the other variables’ terms used for predicting
    each variable. For example, we can observe in `Results for equation realcons`
    that `realinv` does not contribute much predictive capability to `realcons`, but
    `realdpi` does. We can also observe that `realcons` is significant for predicting
    `realinv`. We can also see based on the p-value and confidence interval in the
    `realinv` and `realdpi`. We can expect to see larger coefficient values if we
    have variance in one feature explained by variance in the other:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 关于模型拟合，我们可以参考[*第11章*](B18945_11.xhtml#_idTextAnchor174)*，ARIMA模型*，以获取有关下一节中显示的`Dep.
    Variable`列表的信息。每个模型变量都列出了用于预测每个变量的其他变量的项的系数。例如，我们可以在`Results for equation realcons`中观察到`realinv`对`realcons`的预测能力贡献不大，但`realdpi`却贡献较大。我们还可以观察到`realcons`对预测`realinv`是显著的。我们还可以根据`realinv`和`realdpi`中的p值和置信区间进行观察。如果我们有一个特征中的方差由另一个特征中的方差解释，我们可以期望看到更大的系数值：
- en: '[PRE13]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![Figure 12.15 – VAR(1) model output](img/B18945_12_015.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![图12.15 – VAR(1)模型输出](img/B18945_12_015.jpg)'
- en: Figure 12.15 – VAR(1) model output
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.15 – VAR(1)模型输出
- en: Step 5 – testing the forecast
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第5步 – 测试预测
- en: 'It is important to note that the prediction for the VAR model is actually quite
    stable compared to the long-running historical performance. The reason we see
    such extreme differences at the end of the forecast is that this time period corresponds
    to the **Great Recession**, which lasted from 2007 to 2009\. The last five points
    in our test forecast correspond to the last two quarters of 2008 and the first
    three quarters of 2009:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，与长期历史表现相比，VAR模型的预测实际上相当稳定。我们看到预测结束时出现如此极端差异的原因是，这个时间段对应于**大衰退**，该衰退从2007年持续到2009年。我们测试预测的最后五个点对应于2008年的最后两个季度和2009年的前三个季度：
- en: '[PRE14]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![Figure 12.16 – Test forecast for VARMAX with p=1](img/B18945_12_016.jpg)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![图12.16 – VARMAX模型（p=1）的测试预测](img/B18945_12_016.jpg)'
- en: Figure 12.16 – Test forecast for VARMAX with p=1
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.16 – VARMAX（p=1）的测试预测
- en: 'We can compare our forecast (*mean*) to actuals (`realinv`) for the investment
    variable, as follows:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将我们的预测（均值）与投资变量的实际值(`realinv`)进行比较，如下所示：
- en: '[PRE15]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Here in *Figure 12**.17*, we can see the VAR (from the `VARMAX` function) model
    test forecast:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图12**.17*中，我们可以看到VAR（来自`VARMAX`函数）模型测试预测：
- en: '|  | `mean` | `mean_se` | `mean_ci_lower` | `mean_ci_upper` | `realinv` |'
  id: totrans-182
  prefs: []
  type: TYPE_TB
  zh: '|  | `mean` | `mean_se` | `mean_ci_lower` | `mean_ci_upper` | `realinv` |'
- en: '| 196 | -12.4348 | 40.79603 | -92.3935 | 67.52398 | -56.368 |'
  id: totrans-183
  prefs: []
  type: TYPE_TB
  zh: '| 196 | -12.4348 | 40.79603 | -92.3935 | 67.52398 | -56.368 |'
- en: '| 197 | -6.26154 | 40.79603 | -86.2203 | 73.69722 | -35.825 |'
  id: totrans-184
  prefs: []
  type: TYPE_TB
  zh: '| 197 | -6.26154 | 40.79603 | -86.2203 | 73.69722 | -35.825 |'
- en: '| 198 | -33.5406 | 40.79603 | -113.499 | 46.41821 | -133.032 |'
  id: totrans-185
  prefs: []
  type: TYPE_TB
  zh: '| 198 | -33.5406 | 40.79603 | -113.499 | 46.41821 | -133.032 |'
- en: '| 199 | -53.6481 | 40.79603 | -133.607 | 26.31066 | -299.167 |'
  id: totrans-186
  prefs: []
  type: TYPE_TB
  zh: '| 199 | -53.6481 | 40.79603 | -133.607 | 26.31066 | -299.167 |'
- en: '| 200 | -81.514 | 40.79603 | -161.473 | -1.55526 | -101.816 |'
  id: totrans-187
  prefs: []
  type: TYPE_TB
  zh: '| 200 | -81.514 | 40.79603 | -161.473 | -1.55526 | -101.816 |'
- en: '| 201 | -10.1039 | 40.79603 | -90.0627 | 69.85483 | 29.72 |'
  id: totrans-188
  prefs: []
  type: TYPE_TB
  zh: '| 201 | -10.1039 | 40.79603 | -90.0627 | 69.85483 | 29.72 |'
- en: Figure 12.17 – VAR(1) model test forecast
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.17 – VAR(1)模型测试预测
- en: Step 6 – building the forecast
  id: totrans-190
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第6步 – 构建预测
- en: 'We can observe that because this is a model with an **autoregressive order
    p=1**, the forecast **tends very quickly toward the mean**. Including a higher
    order would likely result in more model variance, which we could see as a more
    confident, yet risky forecast. The multivariate AR(1) model produces more bias,
    which we can observe in *Figure 12**.18* as the tendency to the mean we mentioned.
    We can run the following code to generate the data and plot for the forecast:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以观察到，因为这个模型是一个**自回归阶数p=1**的模型，预测**非常快地趋向于均值**。包括更高阶数可能会导致更多的模型方差，这我们可以将其视为更自信但风险更高的预测。多元自回归(1)模型产生更多的偏差，我们可以在*图12**.18*中观察到我们提到的趋向均值的趋势。我们可以运行以下代码来生成数据并绘制预测图：
- en: '[PRE16]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![Figure 12.18 – VAR(1) model forecast, h=7](img/B18945_12_018.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![图12.18 – VAR(1)模型预测，h=7](img/B18945_12_018.jpg)'
- en: Figure 12.18 – VAR(1) model forecast, h=7
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.18 – VAR(1)模型预测，h=7
- en: 'Here, we can see the forecasted points and the confidence interval for the
    forecast:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到预测点以及预测的置信区间：
- en: '[PRE17]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '|  | `mean` | `mean_se` | `mean_ci_lower` | `mean_ci_upper` |'
  id: totrans-197
  prefs: []
  type: TYPE_TB
  zh: '|  | `mean` | `mean_se` | `mean_ci_lower` | `mean_ci_upper` |'
- en: '| 202 | -16.3442 | 40.79603 | -96.3029 | 63.6146 |'
  id: totrans-198
  prefs: []
  type: TYPE_TB
  zh: '| 202 | -16.3442 | 40.79603 | -96.3029 | 63.6146 |'
- en: '| 203 | -10.9571 | 43.69828 | -96.6041 | 74.68998 |'
  id: totrans-199
  prefs: []
  type: TYPE_TB
  zh: '| 203 | -10.9571 | 43.69828 | -96.6041 | 74.68998 |'
- en: '| 204 | -3.24668 | 44.4028 | -90.2746 | 83.7812 |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
  zh: '| 204 | -3.24668 | 44.4028 | -90.2746 | 83.7812 |'
- en: '| 205 | 1.301495 | 44.56735 | -86.0489 | 88.65189 |'
  id: totrans-201
  prefs: []
  type: TYPE_TB
  zh: '| 205 | 1.301495 | 44.56735 | -86.0489 | 88.65189 |'
- en: '| 206 | 3.576619 | 44.60344 | -83.8445 | 90.99775 |'
  id: totrans-202
  prefs: []
  type: TYPE_TB
  zh: '| 206 | 3.576619 | 44.60344 | -83.8445 | 90.99775 |'
- en: '| 207 | 4.650973 | 44.61108 | -82.7851 | 92.08709 |'
  id: totrans-203
  prefs: []
  type: TYPE_TB
  zh: '| 207 | 4.650973 | 44.61108 | -82.7851 | 92.08709 |'
- en: '| 208 | 5.147085 | 44.61268 | -82.2922 | 92.58633 |'
  id: totrans-204
  prefs: []
  type: TYPE_TB
  zh: '| 208 | 5.147085 | 44.61268 | -82.2922 | 92.58633 |'
- en: Figure 12.19 – VAR(1) model output data
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.19 – VAR(1)模型输出数据
- en: Note that our results are based on the differenced data. This model tells us
    the level of statistical significance between variables regarding their respective
    signals but does not give us forecast values in terms of the original data. To
    reverse differenced data, we need to estimate a constant of integration and then
    reverse-difference the data according to that constant or use a different transformation
    method that allows us to back-transform, such as a logarithmic transformation
    that can be exponentiated to reverse. Often, the VAR model is used for identifying
    potential causation between variables identified as highly correlated in a cross-correlation
    analysis as well as in economic shock analysis.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们的结果是基于差分数据的。此模型告诉我们变量之间关于它们各自信号的统计显著性水平，但不会给我们提供原始数据方面的预测值。要反转差分数据，我们需要估计一个积分常数，然后根据该常数进行反差分，或者使用允许我们进行反变换的不同变换方法，例如可以指数化的对数变换，以进行反转。通常，VAR模型用于识别在交叉相关分析以及经济冲击分析中作为高度相关变量识别的变量之间的潜在因果关系。
- en: It can be argued that depending on the level of detail needed in the forecast,
    differencing and shifting of variables may not be required. However, because this
    is a fully endogenous model with no exogenous variables, it is important that
    if we apply differencing to any variables, we must also apply differencing to
    all variables containing non-stationary behavior. With respect to shifting, it
    may be more useful to simply apply a higher autoregressive lag order than to apply
    a shift; the drawback of shifting is we lose samples early on in the process.
    However, the drawback of using a higher lag order is the inclusion of more variables
    in the time dimension, which can increase the likelihood of overfitting. Logically,
    as more variables are included in the model, we must also increase sample size.
    As with any model, we must apply rigorous cross-validation to ensure performance
    stability and minimize risk.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 可以认为，根据预测所需的详细程度，可能不需要对变量进行差分和移位。然而，由于这是一个没有外生变量的完全内生模型，如果我们对任何变量应用差分，我们也必须对包含非平稳行为的所有变量应用差分。至于移位，简单地应用更高的自回归滞后阶数可能比应用移位更有用；移位的缺点是在过程的早期阶段就会丢失样本。然而，使用更高滞后阶数的缺点是在时间维度中包含更多变量，这可能会增加过拟合的可能性。从逻辑上讲，随着模型中包含的变量增多，我们也必须增加样本量。与任何模型一样，我们必须应用严格的交叉验证以确保性能稳定并最小化风险。
- en: Summary
  id: totrans-208
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we provided an overview of multivariate time-series and how
    they differ from the univariate case. We then covered the math and intuition behind
    two popular approaches to solving problems using multivariate time-series models—ARIMAX
    and the VAR model framework. We walked through examples for each model using a
    step-by-step approach. This chapter concludes our discussions on time-series analysis
    and forecasting. At this point, you should be able to identify and assess the
    statistical properties of time series, transform them as needed, and construct
    models that are useful for fitting and forecasting both univariate and multivariate
    cases.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们概述了多元时间序列及其与单变量情况的不同之处。然后，我们介绍了使用多元时间序列模型解决问题的两种流行方法背后的数学和直觉——ARIMAX
    和 VAR 模型框架。我们通过逐步方法对每个模型进行了示例分析。本章总结了我们对时间序列分析和预测的讨论。到这一点，你应该能够识别和评估时间序列的统计特性，根据需要对其进行转换，并构建适用于拟合和预测单变量和多变量情况的有用模型。
- en: In the next chapter, we will begin our discussion on survival analysis with
    an introduction to **time-to-event** (**TTE**) variables.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将从**事件时间**（**TTE**）变量的介绍开始讨论生存分析。
- en: References
  id: totrans-211
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考文献
- en: '[1] *Liang, X., Zou, T., Guo, B., Li, S., Zhang, H., Zhang, S., Huang, H. and
    Chen, S. X.* (*2015*). *Assessing Beijing’s PM2.5 pollution: severity, weather
    impact, APEC and winter heating*. *Proceedings of the Royal Society A,* *471,
    20150257*.'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '[1] *Liang, X., Zou, T., Guo, B., Li, S., Zhang, H., Zhang, S., Huang, H. 和
    Chen, S. X.* (*2015*). *评估北京的 PM2.5 污染：严重程度、天气影响、APEC 和冬季供暖*。*皇家学会学报 A*，471，20150257。'
- en: '[2] *Dua, D. and Graff, C.* (*2019*). *UCI Machine Learning Repository* [[http://archive.ics.uci.edu/ml](http://archive.ics.uci.edu/ml)].
    *Irvine, CA: University of California, School of Information and* *Computer Science*.'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: '[2] *Dua, D. 和 Graff, C.* (*2019*). *UCI 机器学习仓库* [[http://archive.ics.uci.edu/ml](http://archive.ics.uci.edu/ml)].
    *加州大学欧文分校，信息与计算机科学学院*，加州，欧文市。'
- en: Part 5:Survival Analysis
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5部分：生存分析
- en: This part will cover another statistical approach named survival analysis by
    analyzing a time to event outcome variable. After an introduction of survival
    analysis and censored data, we will study models with survival responses.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 本部分将通过分析事件时间结果变量来介绍另一种统计方法，即生存分析。在介绍生存分析和截尾数据之后，我们将研究具有生存响应的模型。
- en: 'It includes the following chapters:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 它包括以下章节：
- en: '[*Chapter 13*](B18945_13.xhtml#_idTextAnchor206), *Time to Event variables
    - An introduction*'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第13章*](B18945_13.xhtml#_idTextAnchor206), *事件时间变量 - 简介*'
- en: '[*Chapter 14*](B18945_14.xhtml#_idTextAnchor217), *Survival Models*'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[*第14章*](B18945_14.xhtml#_idTextAnchor217), *生存模型*'

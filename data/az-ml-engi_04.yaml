- en: '4'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '4'
- en: Tuning Your Models with AMLS
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用AMLS调整您的模型
- en: '**Tuning your models** is an important step in your data science journey. The
    objective of a data science workload is to provide the best model on unseen data
    in the shortest duration of time. In order to provide a reliable model, not only
    are you required to tune the features that are the inputs to your model but you
    also need to tune the parameters of your model itself. Model parameters, also
    known as **hyperparameters**, can have a significant impact on the performance
    of your trained model. Tuning a model can take a lot of effort and involves trial
    and error. Several frameworks can be leveraged to automate this task. AMLS provides
    this functionality, which we will explore in this chapter. AMLS allows you to
    define model parameters that should be tuned to find the best model through the
    use of a special type of job referred to as a **sweep job**. These hyperparameters
    will be defined for a given AMLS job, and AMLS will run many trials and determine
    the best model for the hyperparameters within the range of possible defined values.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '**调整您的模型**是您数据科学之旅中的一个重要步骤。数据科学工作负载的目标是在最短的时间内提供最佳的模型，以应对未见过的数据。为了提供可靠的模型，您不仅需要调整作为模型输入的特征，还需要调整模型本身的参数。模型参数，也称为**超参数**，可以对您训练的模型性能产生重大影响。调整模型可能需要大量努力，并涉及试错。可以利用几个框架来自动化此任务。AMLS提供了这项功能，我们将在本章中探讨。AMLS允许您定义应调整以找到最佳模型的模型参数，通过使用称为**扫描作业**的特殊类型的工作来实现。这些超参数将为给定的AMLS作业定义，并且AMLS将在可能定义的值范围内运行许多试验，以确定最佳模型。'
- en: In this chapter, we will explore how AMLS enables hyperparameter tuning through
    a sweep job.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨AMLS如何通过扫描作业实现超参数调整。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Understanding model parameters
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解模型参数
- en: Sampling hyperparameters
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 超参数采样
- en: Understanding sweep jobs
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解扫描作业
- en: Setting up a sweep job with grid sampling
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用网格采样设置扫描作业
- en: Setting up a sweep job with random sampling
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用随机采样设置扫描作业
- en: Setting up a sweep job with Bayesian sampling
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用贝叶斯采样设置扫描作业
- en: Reviewing the results of a sweep job
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看扫描作业的结果
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'In order to access your workspace, recall the steps from the previous chapter:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 为了访问您的工作区，回想一下上一章中的步骤：
- en: Go to [https://ml.azure.com](https://ml.azure.com).
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往[https://ml.azure.com](https://ml.azure.com)。
- en: Select your workspace name.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择您的工作区名称。
- en: In the workspace **user interface** (**UI**), on the left-hand side, click on
    **Compute**.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在工作区**用户界面**（**UI**）的左侧，点击**计算**。
- en: 'On the **Compute** screen, select your compute instance and select **Start**:'
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**计算**屏幕上，选择您的计算实例并选择**启动**：
- en: '![Figure 4.1 – Start compute](img/B18003_04_001.jpg)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.1 – 开始计算](img/B18003_04_001.jpg)'
- en: Figure 4.1 – Start compute
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.1 – 开始计算
- en: Your compute instance will change from a **Stopped** status to a **Starting**
    status.
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您的计算实例将从**停止**状态变为**启动**状态。
- en: In the previous chapter, we cloned the Git repository – if you have not already
    done so, continue to follow the steps provided here. If you have already cloned
    the repository, skip to *step 7*.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在上一章中，我们克隆了Git仓库——如果您还没有这样做，请继续遵循这里提供的步骤。如果您已经克隆了仓库，请跳转到*步骤 7*。
- en: 'Open the terminal on your compute instance. Note that the path will include
    your user in the directory. Type the following into the terminal to clone the
    sample notebooks into your working directory:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的计算实例上打开终端。请注意，路径将包括您的用户目录。在终端中输入以下内容以将示例笔记本克隆到您的工作目录：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Clicking on the refresh icon shown in *Figure 4**.2* will update and refresh
    the notebooks displayed on your screen:'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击*图 4.2*中显示的刷新图标将更新并刷新您屏幕上显示的笔记本：
- en: '![Figure 4.2 – The refresh icon](img/B18003_04_002.jpg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.2 – 刷新图标](img/B18003_04_002.jpg)'
- en: Figure 4.2 – The refresh icon
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.2 – 刷新图标
- en: 'Review the notebooks in your `Azure-Machine-Learning-Engineering` directory.
    This will display the files cloned into your working directory as shown in *Figure
    4**.3*:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看您`Azure-Machine-Learning-Engineering`目录中的笔记本。这将显示克隆到您工作目录中的文件，如图*图 4.3*所示：
- en: '![Figure 4.3 – Azure-Machine-Learning-Engineering](img/B18003_04_003.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.3 – Azure-Machine-Learning-Engineering](img/B18003_04_003.jpg)'
- en: Figure 4.3 – Azure-Machine-Learning-Engineering
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.3 – Azure-Machine-Learning-Engineering
- en: Understanding model parameters
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解模型参数
- en: In your data science workload, as you define your features, you determine which
    parameters should be leveraged by your model. However, depending on the algorithm
    selected, you can control the training behavior by altering the parameters of
    the model itself – this is known as **hyperparameter tuning**. Using hyperparameter
    tuning, we can explore a variety of model parameters to identify the best model
    parameters to establish the best model result. To evaluate the model results,
    a **primary metric** is selected. A primary metric is defined as the key metric
    for evaluating the model. Every time a hyperparameter is changed, the primary
    metric will either go up or down in value and based on the primary metric, that
    will yield a better or worse model.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的数据科学工作中，当你定义你的特征时，你确定你的模型应该利用哪些参数。然而，根据所选算法的不同，你可以通过改变模型本身的参数来控制训练行为——这被称为**超参数调整**。使用超参数调整，我们可以探索各种模型参数，以确定建立最佳模型结果的最佳模型参数。为了评估模型结果，选择一个**主要指标**。主要指标被定义为评估模型的关键指标。每次更改超参数时，主要指标的价值要么上升要么下降，基于主要指标，这将产生更好的或更差的模型。
- en: In this chapter, we will create a logistic regression model by leveraging `sklearn`’s
    implementation of logistic regression with an `sklearn` pipeline. For a logistic
    regression model, there are several model parameters that we can tune to improve
    the performance of our model. For a logistic regression model, one parameter is
    the penalty term. Defining the penalty term as `l2`, referred to as ridge regression,
    is used by the logistic regression estimator to apply a penalty to a model when
    the model is overly complex. This uses the `l2` normalization on the coefficients
    of your model as the penalty. Typically, the `l2` normalization prevents the model
    from being overfitted by penalizing complex models. The `l2` norm squares the
    model coefficients, sums them, and takes the square root of the value. When creating
    the model, we can select the `l1` norm, referred to as lasso regression, which
    would be the sum of the absolute value of the coefficients as penalty terms. Changing
    the code from leveraging a `l2` normalization penalty to a `l1` normalization
    penalty would leverage the technique of hyperparameter tuning or tuning our model
    parameters. If we were not going to rely on hyperparameter tuning to select the
    penalty term, we would say that lasso regression generally performs better than
    ridge regression when few predictor variables are significant, and ridge regression
    generally performs better when there are many significant predictor variables.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将利用 `sklearn` 的逻辑回归实现和 `sklearn` 管道创建一个逻辑回归模型。对于一个逻辑回归模型，我们可以调整几个模型参数来提高我们模型的表现。对于一个逻辑回归模型，一个参数是惩罚项。将惩罚项定义为
    `l2`，称为岭回归，是逻辑回归估计器在模型过于复杂时对模型应用惩罚所使用的。这使用模型系数的 `l2` 归一化作为惩罚。通常，`l2` 归一化通过惩罚复杂模型来防止模型过拟合。`l2`
    范数平方模型系数，求和它们，然后取值的平方根。在创建模型时，我们可以选择 `l1` 范数，称为lasso回归，这将是系数绝对值的和作为惩罚项。将代码从利用
    `l2` 归一化惩罚更改为 `l1` 归一化惩罚将利用超参数调整或调整模型参数的技术。如果我们不打算依赖超参数调整来选择惩罚项，我们可以说当少数预测变量显著时，lasso回归通常比岭回归表现更好，而当有多个显著预测变量时，岭回归通常表现更好。
- en: In addition to the penalty term, we can also specify the value of `C`, which
    is the inverse of the regularization strength, as a hyperparameter to tune for
    our model.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 除了惩罚项之外，我们还可以指定 `C` 的值，它是正则化强度的倒数，作为调整我们模型的超参数。
- en: The last hyperparameter we will tune is `max_iter`, which is the maximum iterations
    that the solver can take before converging. As you consider the model parameters
    you would like to explore when building your model, you are defining the search
    space. The **search space** is a concept that defines the parameters and the range
    of values possible during hyperparameter tuning.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将要调整的最后超参数是 `max_iter`，这是求解器在收敛之前可以进行的最大迭代次数。当你考虑在构建模型时想要探索的模型参数时，你正在定义搜索空间。**搜索空间**是一个定义超参数和超参数调整期间可能值的范围的概念。
- en: Now that we have an understanding of hyperparameter tuning, and defining a search
    space, we will explore the method for selecting the combinations of model hyperparameters
    to leverage within an AMLS job designed to tune these parameters, known as a **sweep
    job**.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了超参数调优和定义搜索空间，我们将探讨在AMLS作业中选择模型超参数组合的方法，以利用这些参数，这被称为**扫描作业**。
- en: Sampling hyperparameters
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 超参数采样
- en: 'Inside the search space, hyperparameters are either continuous or discrete
    values. Continuous hyperparameters can be in a continuous range of values, while
    discrete hyperparameters are only able to use certain values. For logistic regression,
    the penalty term can have one of two discrete values: `l1` or `l2`. AMLS can use
    either a list or a range for setting hyperparameters, as we will see when we dig
    into the code.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在搜索空间内，超参数可以是连续值或离散值。连续超参数可以在一个连续的值范围内，而离散超参数只能使用某些特定的值。对于逻辑回归，惩罚项可以有两个离散值之一：`l1`
    或 `l2`。AMLS可以使用列表或范围来设置超参数，正如我们将在深入研究代码时看到的。
- en: For the hyperparameter of `C`, we could define it as a discrete value, or we
    could define C to be a value in a continuous range with a specified distribution.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`C`超参数，我们可以将其定义为离散值，或者我们可以将`C`定义为具有指定分布的连续范围内的值。
- en: For the `max_iter` hyperparameter, the default value for the `sklearn` logistic
    regression model is `100`. We could set this to a discrete value such as `penality_term`,
    or a uniform value such as `C`.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`max_iter`超参数，`sklearn`逻辑回归模型的默认值是`100`。我们可以将其设置为离散值，如`penality_term`，或均匀值，如`C`。
- en: 'The following code shown in *Figure 4**.4* defines the search space for the
    penalty term, the inverse regularization strength of the model, and the maximum
    iterations as choices, which are discrete values for a defined job command:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的代码显示在*图4**.4*中定义了惩罚项、模型的逆正则化强度和最大迭代次数的选择，这些是定义作业命令的离散值：
- en: '![Figure 4.4 – Defining the search space](img/B18003_04_004.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![图4.4 – 定义搜索空间](img/B18003_04_004.jpg)'
- en: Figure 4.4 – Defining the search space
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.4 – 定义搜索空间
- en: 'Once the search space has been defined, we can select what type of sampling
    we would like our sweep job to run. For each parameter defined in the search space,
    trials are created based on the sampled model hyperparameters. There are three
    types of sampling available with sweep jobs in AMLS: **random**, **grid**, and
    **Bayesian**.'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦定义了搜索空间，我们就可以选择我们的扫描作业想要运行哪种类型的采样。对于搜索空间中定义的每个参数，都会根据采样的模型超参数创建试验。在AMLS的扫描作业中有三种可用的采样类型：**随机**、**网格**和**贝叶斯**。
- en: Grid sampling will create a trial per hyperparameter combination. As an example,
    if we had specified our search space to check for `l1` and `l2`, and we selected
    `C` to be discrete values of `0.01`, `.1`, `1`, and `10` and `max_iter` to be
    `10`, `100`, `150`, and `200`, then there would be `2x4x4=32` trials created.
    Given grid sampling will create a trial per hyperparameter combination, grid sampling
    only supports discrete hyperparameters.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 网格采样将为每个超参数组合创建一个试验。例如，如果我们指定搜索空间以检查`l1`和`l2`，并选择`C`为离散值`0.01`、`.1`、`1`和`10`，以及`max_iter`为`10`、`100`、`150`和`200`，那么将创建`2x4x4=32`个试验。由于网格采样将为每个超参数组合创建一个试验，因此网格采样仅支持离散超参数。
- en: When leveraging random sampling, the hyperparameter values are randomly selected
    during the trials.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 当利用随机采样时，超参数值将在试验期间随机选择。
- en: '*Figure 4**.5* shows the hyperparameters defined in the search space here for
    both discrete and continuous values. In this code, the value for `C` follows a
    uniform distribution between values of `0.01` and `10` for a defined job command,
    which shows how we can define `C` as a continuous value, as opposed to with the
    grid job, when `C` was defined as a value from a list as shown in *Figure 4**.5*:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '*图4**.5*显示了在此搜索空间中定义的离散和连续超参数。在此代码中，`C`的值遵循在`0.01`和`10`之间的均匀分布，这是定义作业命令的值，这显示了我们可以如何将`C`定义为连续值，而不是像在*图4**.5*中显示的那样，当`C`被定义为列表中的值时：'
- en: '![Figure 4.5 – Discrete and continuous hyperparameters](img/B18003_04_005.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![图4.5 – 离散和连续超参数](img/B18003_04_005.jpg)'
- en: Figure 4.5 – Discrete and continuous hyperparameters
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.5 – 离散和连续超参数
- en: In the preceding example, since `C` is a continuous hyperparameter, we are not
    able to leverage grid sampling, but we can leverage either random or Bayesian
    sampling.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的例子中，由于`C`是一个连续超参数，我们无法利用网格采样，但我们可以利用随机或贝叶斯采样。
- en: Bayesian sampling leverages the output on the primary metric of the previous
    trial to determine the next set of hyperparameters to run.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯采样利用前一次试验的主要指标输出，以确定运行下一组超参数。
- en: Note
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Grid space sampling does not support continuous hyperparameters – it will only
    support choice hyperparameters containing discrete values.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 网格空间采样不支持连续超参数 – 它将仅支持包含离散值的选项超参数。
- en: Given that hyperparameters can be discrete or continuous, we will define how
    exhaustive the search on the grid space should be and, importantly, how to end
    a job that is searching across a search space to provide the best primary metric
    for a given model. In the next section, we will explore how to set up our job
    to effectively and efficiently search for the best hyperparameters.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 由于超参数可以是离散的或连续的，我们将定义网格空间搜索的全面性以及如何结束搜索空间以提供给定模型最佳主要指标的作业。在下一节中，我们将探讨如何设置我们的作业以有效地和高效地搜索最佳超参数。
- en: Understanding sweep jobs
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解sweep作业
- en: Sweep jobs in AMLS enable a data scientist to define the hyperparameters to
    explore in a single job. During the job, this will automate the task of searching
    for the hyperparameters that will provide a model with the best results for the
    primary metric-creating trials. In a run of a job, multiple trials are created
    and evaluated for the hyperparameters that are defined within the search space
    based on the sampling method selected. By defining the search space, we can create
    a single run of a job for testing multiple hypotheses at a single time rather
    than re-writing code and re-running jobs, reducing the time spent exploring the
    search space.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: AMLS中的sweep作业允许数据科学家在单个作业中定义要探索的超参数。在作业过程中，这将自动化搜索提供最佳主要指标结果的超参数的任务，创建并评估基于所选采样方法在搜索空间内定义的超参数的多个试验。通过定义搜索空间，我们可以创建单个作业的单一运行，以同时测试多个假设，而不是重写代码和重新运行作业，从而减少探索搜索空间所花费的时间。
- en: 'To leverage the hyperparameters in your job, your code needs to be updated
    to leverage these new parameters by passing them into your code through the Python
    `ArgumentParser` shown as follows:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 为了利用您工作中的超参数，您的代码需要更新以通过Python的`ArgumentParser`将这些新参数传递到代码中，如下所示：
- en: '![Figure 4.6 – Passing a parameter list into the job](img/B18003_04_006.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![图4.6 – 将参数列表传递到作业中](img/B18003_04_006.jpg)'
- en: Figure 4.6 – Passing a parameter list into the job
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.6 – 将参数列表传递到作业中
- en: Now that the arguments have been passed into the main function, they can be
    leveraged in the model training script by passing them into the `model_train`
    function.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 现在将参数传递到主函数后，它们可以在模型训练脚本中通过传递到`model_train`函数来利用。
- en: 'Here’s the code for passing parameters into the `model_train` function:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 这是将参数传递到`model_train`函数的代码：
- en: '![Figure 4.7 – Passing parameters for model training](img/B18003_04_007.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![图4.7 – 传递模型训练参数](img/B18003_04_007.jpg)'
- en: Figure 4.7 – Passing parameters for model training
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.7 – 传递模型训练参数
- en: In the `model_train` function, you can leverage the hyperparameters as you build
    the logistic regression model.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在`model_train`函数中，您可以在构建逻辑回归模型时利用超参数。
- en: 'Here’s the code for passing parameters into the logistic regression model:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这是将参数传递到逻辑回归模型的代码：
- en: '![Figure 4.8 – Leveraging hyperparameters](img/B18003_04_008.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![图4.8 – 利用超参数](img/B18003_04_008.jpg)'
- en: Figure 4.8 – Leveraging hyperparameters
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.8 – 利用超参数
- en: As with all AML SDK v2 jobs, a sweep job is defined initially as a `job` command.
    In the job command, you specify the code, the location of the file, the command
    with its parameters, inputs, the environment, the compute, and a display name,
    but for the sweep job, we also specify the hyperparameters as we saw in *Figures
    4.4* and *4.5*.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 与所有AML SDK v2作业一样，sweep作业最初定义为`job`命令。在作业命令中，您指定代码、文件位置、带有参数的命令、输入、环境、计算和显示名称，但对于sweep作业，我们还会指定如*图4.4*和*图4.5*中所示的超参数。
- en: Once the job command is updated to include the hyperparameters, you can specify
    the sweep parameters for the command. In the sweep method, you specify the compute
    that you are going to leverage, the sampling algorithm, the primary metric, and
    the goal. The sampling algorithm can be set to `random`, `bayesian`, or `grid`
    as discussed earlier. The primary metric is the metric that is required to be
    logged in the job that you would like to evaluate the trials against. The goal
    specifies how you would like the primary metric to be evaluated. The goal can
    be to minimize or maximize the primary metric, which is used to judge your model’s
    performance.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦将作业命令更新为包括超参数，你就可以指定命令的扫描参数。在扫描方法中，你指定将要利用的计算资源、抽样算法、主要指标和目标。抽样算法可以设置为`random`、`bayesian`或`grid`，如前所述。主要指标是你希望在作业中记录并评估试验的指标。目标指定了你希望如何评估主要指标。目标可以是最小化或最大化主要指标，这用于评估你的模型性能。
- en: 'The code for the sweep of the job command is shown here:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 这里展示了扫描作业命令的代码：
- en: '![Figure 4.9 – Setting the sweep parameters](img/B18003_04_009.jpg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![图4.9 – 设置扫描参数](img/B18003_04_009.jpg)'
- en: Figure 4.9 – Setting the sweep parameters
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.9 – 设置扫描参数
- en: In *Figure 4**.9* here, you can see the values for sweep parameters being set.
    In this case, we will evaluate the `test_AUC` primary metric to be maximized by
    leveraging a grid sampling algorithm on the compute cluster named `cpu-cluster`.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在此处的*图4.9*中，你可以看到正在设置的扫描参数值。在这种情况下，我们将评估`test_AUC`主要指标，通过在名为`cpu-cluster`的计算集群上利用网格抽样算法来最大化。
- en: 'To set the limits for a sweep job, we specify the maximum total trials – `max_total_trials`
    – which defaults to `1000`. The maximum concurrent trials – `max_concurrent_trials`
    – which defaults to the number specified by `max_total_trials` if not set, will
    specify how many concurrent trials should be run at any given time. An additional
    parameter to set is the timeout: `timeout`. The timeout is in seconds. The timeout
    is for the entire sweep job, which defaults to a value of `100800`:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置扫描作业的限制，我们指定最大总试验次数 – `max_total_trials` – 默认为`1000`。最大并发试验次数 – `max_concurrent_trials`
    – 如果未设置，则默认为`max_total_trials`指定的数字，将指定在任何给定时间内应运行多少并发试验。另一个需要设置的参数是超时时间：`timeout`。超时时间以秒为单位。超时时间适用于整个扫描作业，默认值为`100800`：
- en: '![Figure 4.10 – Setting job limits for grid sampling](img/B18003_04_010.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![图4.10 – 设置网格抽样的作业限制](img/B18003_04_010.jpg)'
- en: Figure 4.10 – Setting job limits for grid sampling
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.10 – 设置网格抽样的作业限制
- en: Note that in the grid sampling experiment explored in this chapter, the maximum
    number of total runs is actually 32, but if we added additional choices as hyperparameters,
    setting the trial limits will ensure the job does not exceed a total number of
    60 trials in *Figure* *4**.10* here.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，在本章中探索的网格抽样实验中，实际的总运行次数最大为32，但如果我们添加了额外的选择作为超参数，设置试验限制将确保作业的总试验次数不超过图*4.10*中的60次。
- en: With random sampling, hyperparameters are selected at random, so the job limit
    here will be very important to set. As stated, `max_total_trials` defaults to
    `1000`, so we can see that running a job with `max_total_trials` equal to `120`
    will result in only `120` trials being created for a given job run.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 使用随机抽样时，超参数是随机选择的，因此在这里设置作业限制将非常重要。正如所述，`max_total_trials`的默认值为`1000`，因此我们可以看到，当`max_total_trials`等于`120`时，将只为特定的作业运行创建`120`次试验。
- en: 'Setting the maximum limits of the sweep job is shown as follows:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 设置扫描作业的最大限制如下：
- en: '![Figure 4.11 – Setting job limits for random sampling](img/B18003_04_011.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![图4.11 – 设置随机抽样的作业限制](img/B18003_04_011.jpg)'
- en: Figure 4.11 – Setting job limits for random sampling
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.11 – 设置随机抽样的作业限制
- en: When leveraging Bayesian sampling, previous trial information is leveraged to
    determine the next parameters for which to search in the search space. With grid
    and random sampling, each trial is independent of other trials. Given each trial
    for grid sampling and random sampling is independent, once the primary metric
    has been determined in a given trial, if it will not yield the best model, there
    is no need for the code to continue running. These trials can be terminated early,
    so compute resources can be used for the next trial primary metric evaluation
    instead.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 当利用贝叶斯抽样时，将利用先前试验的信息来确定搜索空间中要搜索的下一个参数。对于网格和随机抽样，每个试验与其他试验独立。鉴于网格抽样和随机抽样的每个试验都是独立的，一旦在给定试验中确定了主要指标，如果它不会产生最佳模型，则无需代码继续运行。这些试验可以提前终止，以便将计算资源用于下一个试验的主要指标评估。
- en: To enable early termination, AMLS sweep jobs incorporate the concept of an **early
    termination policy**. An early termination policy will prematurely end a given
    trial after the primary metric is logged if the defined criteria are not met.
    For early termination, there are several policies that AMLS supports, including
    **none**, a **truncation** selection policy, a **median** stopping policy, and
    a **bandit** policy.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 为了启用早期终止，AMLS 扫描作业结合了**早期终止策略**的概念。如果未满足定义的标准，早期终止策略将在主要指标记录后提前结束一个给定的试验。对于早期终止，AMLS
    支持几种策略，包括**无**、**截断**选择策略、**中值**停止策略和**赌博**策略。
- en: If no early termination policy is selected, the trial run will execute until
    completion – as explained earlier, this is required for Bayesian sampling. However,
    when grid or random sampling is leveraged, if a truncation policy is selected,
    AMLS will terminate trials based on the selected early termination policy.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 如果未选择早期终止策略，试验运行将执行至完成 – 如前所述，这是贝叶斯抽样的要求。然而，当利用网格或随机抽样时，如果选择截断策略，AMLS 将根据所选的早期终止策略终止试验。
- en: Truncation policies
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 截断策略
- en: If a truncation policy is selected, AMLS will cancel a percentage of the lowest-performing
    runs based on the value in `truncation_percentage`.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 如果选择截断策略，AMLS 将根据`truncation_percentage`中的值取消一部分表现最差的运行。
- en: 'The following is the sample code for an early termination policy that starts
    evaluations at an interval of `1`, and terminates the lowest `75`% of all trials
    using a truncation policy:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个早期终止策略的示例代码，该策略以`1`个间隔开始评估，并使用截断策略终止所有试验中最低的`75`%：
- en: '![Figure 4.12 – Truncation early termination policy](img/B18003_04_012.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.12 – 截断早期终止策略](img/B18003_04_012.jpg)'
- en: Figure 4.12 – Truncation early termination policy
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.12 – 截断早期终止策略
- en: When executing a sweep job with a truncation early termination policy, in the
    **Overview** tab in AMLS, you can review the policy on the **Job Overview** screen.
    Regardless of the early termination policy selected, it can be viewed on the **Job**
    **Overview** screen.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用截断早期终止策略执行扫描作业时，在 AMLS 的**概览**选项卡中，您可以在**作业概览**屏幕上查看策略。无论选择哪种早期终止策略，都可以在**作业**
    **概览**屏幕上查看。
- en: 'An early termination policy is shown as follows in the workspace:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 早期终止策略在工作区中的显示如下：
- en: '![Figure 4.13 – Early termination policy for a sweep job](img/B18003_04_013.jpg)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.13 – 扫描作业的早期终止策略](img/B18003_04_013.jpg)'
- en: Figure 4.13 – Early termination policy for a sweep job
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.13 – 扫描作业的早期终止策略
- en: In addition to a truncation policy, we can also set a median policy, which we
    will look at next.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 除了截断策略之外，我们还可以设置一个中值策略，我们将在下一节中探讨。
- en: Median policies
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 中值策略
- en: Another type of early termination policy is the median stopping policy. This
    policy will prematurely end trials based on the median value across all the training
    trials. If a given trial is worse than the median average, it will be terminated.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种早期终止策略是中值停止策略。该策略将根据所有训练试验的中值提前结束试验。如果给定试验的值低于中值平均值，它将被终止。
- en: 'Here is the sample code for an early termination policy that starts evaluation
    at an interval of 2, and terminates any trial that is below the median of all
    trials:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是早期终止策略的示例代码，该策略以 2 个间隔开始评估，并终止所有试验中低于中值的任何试验：
- en: '![Figure 4.14 – Median early termination policy](img/B18003_04_014.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.14 – 中值早期终止策略](img/B18003_04_014.jpg)'
- en: Figure 4.14 – Median early termination policy
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.14 – 中值早期终止策略
- en: Bandit policies
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 赌博策略
- en: 'An early termination policy known as the bandit policy will end runs prematurely
    when the primary metric is not within a certain range of the current most successful
    trial. This range is defined by `slack_factor`. At the time of evaluation, the
    best primary metric value is divided by (1+ `slack_factor`), and if a trial does
    not have a primary metric that is better than that value, it will be terminated
    early. If a data scientist would prefer to set a value rather than setting a ratio
    with `slack_factor`, `slack_amount` can be used instead:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 一种称为“老虎机策略”的早期终止策略会在主要指标不在当前最成功试验的某个范围内时提前结束运行。这个范围由`slack_factor`定义。在评估时，最佳主要指标值除以（1+`slack_factor`），如果一个试验没有比这个值更好的主要指标，它将被提前终止。如果数据科学家更愿意设置一个值而不是用`slack_factor`设置一个比率，可以使用`slack_amount`代替：
- en: '![Figure 4.15 – Bandit early termination policy](img/B18003_04_015.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.15 – 老虎机早期终止策略](img/B18003_04_015.jpg)'
- en: Figure 4.15 – Bandit early termination policy
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.15 – 老虎机早期终止策略
- en: To provide some context to the bandit policy, let us assume that the primary
    metric at the interval of `2` so far has the best metric of `.85` for our `test_AUC`.
    In the example here, if the metric is below `.85`/`1.1` or `.773`, then it will
    be terminated.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 为了为老虎机策略提供一些背景，让我们假设到目前为止的间隔`2`中，我们的`test_AUC`的最佳指标为`.85`。在这个例子中，如果指标低于`.85`/`1.1`或`.773`，它将被终止。
- en: As the training becomes increasingly complex, establishing the ability to terminate
    trials prematurely ensures that compute resources are not consumed when the desired
    result will ultimately not be achieved.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 随着训练变得越来越复杂，建立提前终止试验的能力可以确保在最终无法实现所需结果时不会消耗计算资源。
- en: In the next section, we will explore setting up a sweep job that leverages grid
    sampling to determine the best model hyperparameters.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将探讨设置利用网格采样确定最佳模型超参数的扫描作业。
- en: Setting up a sweep job with grid sampling
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置网格采样扫描作业
- en: Earlier in the chapter, we cloned our sample notebook to leverage this material.
    The notebook for this chapter, `'``Chapter 4` `- Hyperparameter Tuning'`, provides
    a review on creating a job command to create a logistic regression model by leveraging
    an `sklearn` pipeline and `mlflow` capabilities.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的早期部分，我们克隆了我们的示例笔记本以利用这些材料。本章的笔记本，`'Chapter 4 – Hyperparameter Tuning'`，提供了利用`sklearn`管道和`mlflow`功能创建工作命令以创建逻辑回归模型的回顾。
- en: 'The code is then updated and placed into a new directory – the `hyperparametertune`
    folder. The code leverages python’s `argparse` module, which enables you to pass
    parameters into scripts. To run the script that has been generated by this notebook,
    we will create a job command and update the job command to include the hyperparameters
    as shown in the following code snippet:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 然后更新代码并将其放置到一个新的目录中——`hyperparametertune`文件夹。代码利用python的`argparse`模块，该模块允许你将参数传递到脚本中。要运行由这个笔记本生成的脚本，我们将创建一个工作命令并更新工作命令以包括以下代码片段中的超参数：
- en: '![Figure 4.16 – Job sweep command with hyperparameters for grid sampling](img/B18003_04_016.jpg)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.16 – 用于网格采样的超参数扫描命令](img/B18003_04_016.jpg)'
- en: Figure 4.16 – Job sweep command with hyperparameters for grid sampling
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.16 – 用于网格采样的超参数扫描命令
- en: Note that the hyperparameters have been included as inputs to the command, but
    their values are added to the command in line 22 in the preceding figure. This
    could have been done as a single command, but for illustrative purposes, it is
    provided separately as an update to `grid_sampling_job_command`.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，超参数已被包括在命令的输入中，但它们的值在前面图中的第22行添加到命令中。这可以作为一个单独的命令来完成，但为了说明目的，它被单独提供作为对`grid_sampling_job_command`的更新。
- en: 'Once the command is prepared, we call the sweep method providing the compute,
    the sampling algorithm, the primary metric, and the goal. Recall that here we
    will expect to see 32 runs, so setting `max_total_trials` to `60` will not be
    a hit, but if we were to update the hyperparameters to include more choices, we
    could hit `max_total_trials`:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦准备就绪，我们调用扫描方法，提供计算、采样算法、主要指标和目标。回想一下，我们预计将看到32次运行，所以将`max_total_trials`设置为`60`不会产生影响，但如果我们更新超参数以包括更多的选择，我们可能会达到`max_total_trials`：
- en: '![Figure 4.17 – Calling the sweep method during grid sampling](img/B18003_04_017.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.17 – 在网格采样期间调用扫描方法](img/B18003_04_017.jpg)'
- en: Figure 4.17 – Calling the sweep method during grid sampling
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.17 – 在网格采样期间调用扫描方法
- en: Later in the notebook when we look at random sampling and Bayesian sampling,
    we will define the value of `C` as a continuous value – however, to leverage grid
    sampling, we have defined it to be a choice, which is a list of discrete values.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在笔记本的后面，当我们查看随机采样和贝叶斯采样时，我们将`C`的值定义为连续值 - 然而，为了利用网格采样，我们将其定义为选择，即一系列离散值。
- en: 'To submit `grid_sweep_job`, we pass the command to `ml_client`, which was created
    to manage the connection to AMLS:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 要提交`grid_sweep_job`，我们将命令传递给`ml_client`，它是为了管理到AMLS的连接而创建的：
- en: '![Figure 4.18 – Running the sweep job](img/B18003_04_018.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![图4.18 – 执行扫描作业](img/B18003_04_018.jpg)'
- en: Figure 4.18 – Running the sweep job
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.18 – 执行扫描作业
- en: As the sweep job is executing, it can be helpful to get the status of the running
    job. Given we are leveraging `mlflow` to log the metrics of the `sklearn` model,
    we can request all trials for a given parent `run_id` value, which is the run
    for `grid_sweep_job`.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 当扫描作业正在执行时，获取正在运行的作业的状态可能会有所帮助。鉴于我们正在利用`mlflow`来记录`sklearn`模型的指标，我们可以请求给定父`run_id`值的所有试验，这是`grid_sweep_job`的运行。
- en: 'In the following code snippet, we pass in our `experiment_id` and `run_id`
    values and get back the job status:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下代码片段中，我们传递`experiment_id`和`run_id`值，并获取作业状态：
- en: '![Figure 4.19 – Getting the status of the sweep job](img/B18003_04_019.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![图4.19 – 获取扫描作业的状态](img/B18003_04_019.jpg)'
- en: Figure 4.19 – Getting the status of the sweep job
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.19 – 获取扫描作业的状态
- en: We search across the run for a given `experiment_id` value. Our `experiment_id`
    value will be `'chapter4'`, so we request all runs that have been made for `'chapter4'`
    and further refine that list based on `tags.mlflow.parentRunId`, which is the
    `run_id` value associated with the grid sampling run. In line 3 of *Figure 4**.19*,
    we request runs that have a `run_id` value associated with the run of the grid
    sweep job. If we get back a value of `0`, then we know that we have to wait for
    the run to be established in AMLS. Once there are runs provided, we move on to
    the next `while` loop, where we are checking whether all the runs have been completed.
    Once all the runs are completed for the grid sweep job, the message on line 24
    will be printed.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在运行中搜索给定的`experiment_id`值。我们的`experiment_id`值将是`'chapter4'`，因此我们请求所有为`'chapter4'`创建的运行，并根据`tags.mlflow.parentRunId`进一步精炼该列表，它是与网格采样运行关联的`run_id`值。在*图4**.19的第3行中，我们请求与网格扫描作业运行关联的`run_id`值的运行。如果我们得到`0`的值，那么我们知道我们必须等待运行在AMLS中建立。一旦提供了运行，我们就继续到下一个`while`循环，在那里我们检查是否所有运行都已完成。一旦网格扫描作业的所有运行都已完成，第24行的消息将被打印出来。
- en: Congratulations on leveraging a sweep job with grid sampling! Grid sampling
    works well when you have a search space that contains discrete values for your
    hyperparameters. Next, we will explore leveraging a sweep job with random sampling
    to enable use to explore continuous values for our hyperparameters.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜你利用了带有网格采样的扫描作业！当你的超参数搜索空间包含离散值时，网格采样效果很好。接下来，我们将探索利用带有随机采样的扫描作业来探索超参数的连续值。
- en: Setting up a sweep job for random sampling
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置随机采样的扫描作业
- en: As we saw with setting up a command for grid sampling, a command for random
    sampling is simply a job command with the hyperparameters included in the command.
    One difference between the `grid` command and the `random` command is that the
    hyperparameters can be continuous in a random sampling sweep job.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在设置网格采样命令时看到的那样，随机采样的命令只是一个包含超参数的作业命令。`grid`命令和`random`命令之间有一个区别是，在随机采样扫描作业中，超参数可以是连续的。
- en: 'Here’s the code for the job command for random sampling:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 这是随机采样的作业命令代码：
- en: '![Figure 4.20 – Sweep job command with hyperparameters for random sampling](img/B18003_04_020.jpg)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![图4.20 – 带有随机采样超参数的扫描作业命令](img/B18003_04_020.jpg)'
- en: Figure 4.20 – Sweep job command with hyperparameters for random sampling
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.20 – 带有随机采样超参数的扫描作业命令
- en: As shown in *Figure 4**.20* in line 25, the value of `C` is defined to follow
    a uniform distribution from `0.01` to `10.0`, making this a continuous hyperparameter
    across the search space.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 如第25行中的*图4**.20所示，`C`的值被定义为从`0.01`到`10.0`的均匀分布，这使得在整个搜索空间中这是一个连续的超参数。
- en: 'Just as with the grid sampling sweep job, we set parameters for our sweep but
    specify them using a random sampling algorithm as shown here:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 就像网格采样扫描作业一样，我们为扫描设置参数，但如这里所示，我们使用随机采样算法来指定它们：
- en: '![Figure 4.21 – Calling the sweep method during random sampling](img/B18003_04_021.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.21 – 在随机采样期间调用扫描方法](img/B18003_04_021.jpg)'
- en: Figure 4.21 – Calling the sweep method during random sampling
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.21 – 在随机采样期间调用扫描方法
- en: Given the parameters for the sweep job and the limits have been set, we are
    ready to execute the sweep job. In order to execute the code, again we leverage
    an `ml_client` method to create or update a job as shown in *Figure 4**.18*.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 给定扫描作业的参数和限制已设置，我们准备执行扫描作业。为了执行代码，我们再次利用 `ml_client` 方法创建或更新一个作业，如图 *4.18* 所示。
- en: Now you have gone through grid and random sampling, there is an additional type
    of hyperparameter sampling that can be applied, which we will look at next.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经完成了网格和随机采样，还有另一种可以应用的超参数采样类型，我们将在下一节中探讨。
- en: Setting up a sweep job for Bayesian sampling
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置贝叶斯采样扫描作业
- en: Earlier in the chapter, we cloned our sample notebook to leverage this material.
    The notebook for this chapter, `'``Chapter 4` `- Hyperparameter Tuning'`, provides
    a review on creating a job command to create a `sklearn` pipeline and `mlflow`
    capabilities.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章早期，我们克隆了我们的样本笔记本以利用这些材料。本章的笔记本 `'``Chapter 4` `- Hyperparameter Tuning'`
    提供了创建创建 `sklearn` 管道和 `mlflow` 功能的作业命令的回顾。
- en: The code is then updated and placed into a new directory – the `hyperparametertune`
    folder, which leverages Python’s `argparse` module and enables you to pass parameters
    into scripts. To run the script that has been generated by this notebook, we will
    create a job command and update the job command to include the hyperparameters
    as shown in the code snippet here. Conveniently, the job command is the same as
    was found for the random sampling displayed in *Figure 4**.16*.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 然后更新代码并将其放置到一个新的目录中 – `hyperparametertune` 文件夹，该文件夹利用 Python 的 `argparse` 模块，并允许您将参数传递到脚本中。要运行由该笔记本生成的脚本，我们将创建一个作业命令并更新作业命令以包括超参数，如代码片段所示。方便的是，作业命令与
    *图 4.16* 中显示的随机采样作业命令相同。
- en: 'The only difference here is that the sampling algorithm is defined as `bayesian`,
    as shown in the figure:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的唯一区别是采样算法被定义为 `bayesian`，如图所示：
- en: '![Figure 4.22 – Calling a sweep method using Bayesian sampling](img/B18003_04_022.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.22 – 使用贝叶斯采样调用扫描方法](img/B18003_04_022.jpg)'
- en: Figure 4.22 – Calling a sweep method using Bayesian sampling
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.22 – 使用贝叶斯采样调用扫描方法
- en: In order to execute the code, again, we leverage the `ml_client`’s method to
    create or update a job and continue by leveraging the `get_job_status` method
    as shown in *Figure 4**.19*.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 为了执行代码，我们再次利用 `ml_client` 的方法创建或更新一个作业，并继续利用 `get_job_status` 方法，如图 *4.19* 所示。
- en: You have now made it through grid, random, and Bayesian hyperparameter tuning
    job commands in AMLS. We will continue reviewing the results of the job within
    AMLS.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在已经完成了 AMLS 中的网格、随机和贝叶斯超参数调优作业命令。我们将继续在 AMLS 中查看作业结果。
- en: Reviewing results of a sweep job
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查看扫描作业结果
- en: Recall that for a single trial of a sweep job, several trials will be created
    to determine the model that will provide the best primary metric. Clicking on
    **jobs** in the left-hand menu pane of your AMLS workspace will display a list
    of your jobs for review. By now, you have run the sample notebook provided for
    this chapter – let’s review your results.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 回想一下，对于扫描作业的单次试验，将创建多个试验以确定将提供最佳主要指标的模型。点击 AMLS 工作区左侧菜单面板中的 **作业** 将显示您要查看的作业列表。到目前为止，您已经运行了本章提供的样本笔记本
    – 让我们查看您的结果。
- en: 'Clicking on the **chapter4** job brings you to the jobs that you have performed
    as part of this chapter. Selecting the display name will drill into a given job’s
    details. Let us start by reviewing the results of the jobs that we have run as
    shown here:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 点击 **chapter4** 作业将带您到您在本章中执行的作业。选择显示名称将深入查看特定作业的详细信息。让我们首先查看我们已运行的作业结果，如下所示：
- en: '![Figure 4.23 – Job results](img/B18003_04_023.jpg)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.23 – 作业结果](img/B18003_04_023.jpg)'
- en: Figure 4.23 – Job results
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.23 – 作业结果
- en: 'To review the results of the job, follow the next steps:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看作业结果，请按照以下步骤操作：
- en: Clicking on the **Experiment** name, **Chapter04**, will bring us to the different
    job sweeps that have been performed as part of this chapter.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **实验** 名称，**Chapter04**，将带我们到本章中执行的不同作业扫描。
- en: 'Clicking on a given run of your experiment will provide the details for a given
    job run as shown in *Figure 4**.24*:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击您实验的给定运行将提供特定作业运行的详细信息，如图 *4.24* 所示：
- en: '![Figure 4.24 – Job sweep details](img/B18003_04_024.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.24 – 作业扫描详情](img/B18003_04_024.jpg)'
- en: Figure 4.24 – Job sweep details
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.24 – 作业扫描详情
- en: 'Key information was captured as metadata, providing traceability for a given
    job run. This information includes the following:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 关键信息被捕获为元数据，为给定作业运行提供可追溯性。这些信息包括以下内容：
- en: The sampling policy
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 样本策略
- en: The parameter space
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 参数空间
- en: The primary metric
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 主要指标
- en: The best trial
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最佳试验
- en: The number of runs completed
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成的运行次数
- en: 'Clicking on the trial hyperlink from the run details brings up the trial with
    the best results for the selected primary metric:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击运行详情中的试验超链接，将显示具有所选主要指标最佳结果的试验：
- en: '![Figure 4.25 – Best trial run](img/B18003_04_025.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.25 – 最佳试验运行](img/B18003_04_025.jpg)'
- en: Figure 4.25 – Best trial run
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.25 – 最佳试验运行
- en: 'Clicking on the **Metrics** tab for the best trial run provides the metrics
    for the evaluation of a given trial:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击最佳试验运行的 **指标** 选项卡，可以提供给定试验的评估指标：
- en: '![Figure 4.26 – Metrics for the best trial run of the sweep job](img/B18003_04_026.jpg)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.26 – 扫描作业最佳试验运行的指标](img/B18003_04_026.jpg)'
- en: Figure 4.26 – Metrics for the best trial run of the sweep job
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.26 – 扫描作业最佳试验运行的指标
- en: 'To review all the trials created for a job run holistically, you can click
    on the job run and head over to the **Trials** tab as shown in *Figure 4**.27*:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要全面审查为作业运行创建的所有试验，您可以点击作业运行并转到如图 *4.27* 所示的 **试验** 选项卡：
- en: '![Figure 4.27 – Trial runs for a grid sampling sweep job](img/B18003_04_027.jpg)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.27 – 网格采样扫描作业的试验运行](img/B18003_04_027.jpg)'
- en: Figure 4.27 – Trial runs for a grid sampling sweep job
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.27 – 网格采样扫描作业的试验运行
- en: Not only are you able to review each metric individually through the AMLS workspace
    UI for a given run of a job but you can also view a parallel coordinates chart,
    displaying how the different hyperparameters selected impacted the primary metric.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 不仅可以通过 AMLS 工作空间 UI 对给定作业运行的每个指标进行审查，还可以查看一个平行坐标图，显示所选的不同超参数如何影响主要指标。
- en: 'To review the search space and its impact on the primary metric, review the
    parallel coordinates chart in the **Trials** tab:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 要全面审查搜索空间及其对主要指标的影响，请查看 **试验** 选项卡中的平行坐标图：
- en: '![Figure 4.28 – Grid search space parallel coordinates chart](img/B18003_04_028.jpg)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.28 – 网格搜索空间平行坐标图](img/B18003_04_028.jpg)'
- en: Figure 4.28 – Grid search space parallel coordinates chart
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.28 – 网格搜索空间平行坐标图
- en: In addition to the parallel coordinates chart, AMLS provides a 2D scatter chart
    and a 3D scatter chart for evaluating hyperparameter tuning.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 除了平行坐标图之外，AMLS 还提供了二维散点图和三维散点图来评估超参数调整。
- en: 'The 3D scatter chart for hyperparameter tuning is shown here:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 超参数调整的 3D 散点图如下所示：
- en: '![Figure 4.29 – 3D scatter chart](img/B18003_04_029.jpg)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.29 – 3D 散点图](img/B18003_04_029.jpg)'
- en: Figure 4.29 – 3D scatter chart
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.29 – 3D 散点图
- en: We have seen how to graphically view and compare models through charts in the
    AML Studio, but we are not limited to accessing this valuable information through
    the UI.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经看到了如何在 AML Studio 中通过图表图形化地查看和比较模型，但我们并不局限于通过 UI 访问这些有价值的信息。
- en: Not only are we able to retrieve the best trial of the sweep job through the
    AMLS Studio by reviewing results in the experiment tab but we are also able to
    access this information by leveraging the AMLS Python SDK v2.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不仅可以通过在实验选项卡中查看结果来通过 AMLS Studio 获取扫描作业的最佳试验，还可以通过利用 AMLS Python SDK v2 来访问这些信息。
- en: 'Putting the results from the job run into a pandas DataFrame is shown as follows:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 将作业运行的输出放入 pandas DataFrame 的示例如下：
- en: '![Figure 4.30 – Getting the job results into a pandas DataFrame](img/B18003_04_030.jpg)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.30 – 将作业结果放入 pandas DataFrame](img/B18003_04_030.jpg)'
- en: Figure 4.30 – Getting the job results into a pandas DataFrame
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.30 – 将作业结果放入 pandas DataFrame
- en: 'At the end of the notebook, we have included the code for returning a pandas
    DataFrame for the completed job run:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在笔记本的末尾，我们包含了返回完成作业运行的 pandas DataFrame 的代码：
- en: '![Figure 4.31 – Sorting the job trials to get the highest test_AUC for trials](img/B18003_04_031.jpg)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![图 4.31 – 对试验进行排序以获得最高的 test_AUC](img/B18003_04_031.jpg)'
- en: Figure 4.31 – Sorting the job trials to get the highest test_AUC for trials
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 图 4.31 – 对作业试验进行排序以获得最高的 test_AUC
- en: 'Given we have the pandas DataFrame properly sorted by the primary metric, we
    can easily pull out the `run_id` value for the best trial run as shown here:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们已经根据主要指标对 pandas DataFrame 进行了适当的排序，我们可以轻松地提取出最佳试验运行的 `run_id` 值，如下所示：
- en: '![Figure 4.32 – Getting the best run_id value from the sorted pandas DataFrame](img/B18003_04_032.jpg)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![图4.32 – 从排序的pandas DataFrame获取最佳run_id值](img/B18003_04_032.jpg)'
- en: Figure 4.32 – Getting the best run_id value from the sorted pandas DataFrame
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.32 – 从排序的pandas DataFrame获取最佳run_id值
- en: Now that we have the best run retrieved into the `best_run_id` variable as shown
    here, we can leverage the best model from the sweep job.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经将最佳运行检索到`best_run_id`变量中，如图所示，我们可以利用扫描作业中的最佳模型。
- en: 'Loading the model from the best sweep job trial is shown as follows:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 从最佳扫描作业试验中加载模型如下所示：
- en: '![Figure 4.33 – Loading the best model](img/B18003_04_033.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![图4.33 – 加载最佳模型](img/B18003_04_033.png)'
- en: Figure 4.33 – Loading the best model
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.33 – 加载最佳模型
- en: 'Once the model has been loaded and given we are using the virtual environment
    that was used to create the model, we can carry out inference using the loaded
    model as shown here:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦模型被加载，并且我们使用创建模型时使用的虚拟环境，我们就可以使用加载的模型进行推理，如下所示：
- en: '![Figure 4.34 – Inference using the best model from the sweep job](img/B18003_04_034.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![图4.34 – 使用扫描作业中的最佳模型进行推理](img/B18003_04_034.jpg)'
- en: Figure 4.34 – Inference using the best model from the sweep job
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 图4.34 – 使用扫描作业中的最佳模型进行推理
- en: Congratulations – you have retrieved the best trial run for a given sweep job
    from the SDK v2! This run information can be viewed in the UI as well as programmatically.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜您 – 您已从SDK v2中检索到给定扫描作业的最佳试验运行！此运行信息可以在UI中查看，也可以通过编程方式查看。
- en: Summary
  id: totrans-196
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we have explored what model parameters are and how a sweep
    job can be leveraged to tune hyperparameters that are defined for a given model.
    We have also explored options for setting up sweep jobs based on the search space
    and sampling methodology selected. AMLS provides the ability to sweep across the
    search space to tune a model, automating the process of hyperparameter tuning
    on a compute cluster, which will shut itself down in the idle period after the
    trials are completed, consuming compute resources wisely.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们探讨了模型参数是什么以及如何利用扫描作业来调整给定模型定义的超参数。我们还探讨了基于所选搜索空间和采样方法设置扫描作业的选项。AMLS提供了在搜索空间中扫描以调整模型的能力，自动化计算集群上的超参数调整过程，在试验完成后，在空闲期间自动关闭，明智地消耗计算资源。
- en: In addition to setting up a sweep job, you have been able to review your results
    in the Studio as well as in the code – providing intuitive insight into the best-performing
    model for your use case. Now that you have completed the chapter, be sure to turn
    off your compute resources to save cost.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 除了设置扫描作业外，您还能够在Studio以及代码中查看您的结果 – 提供了对您用例中表现最佳模型的直观洞察。现在您已经完成了本章，请务必关闭您的计算资源以节省成本。
- en: In the next chapter, we will show you how to leverage AMLS to take over the
    time-consuming task of model development. This functionality is not only available
    through the SDK and the CLI, but in the AMLS Studio itself as well.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将向您展示如何利用AMLS来接管模型开发这一耗时任务。此功能不仅可通过SDK和CLI访问，还可在AMLS Studio本身中访问。

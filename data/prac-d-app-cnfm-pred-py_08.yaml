- en: '8'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '8'
- en: Conformal Prediction for Time Series and Forecasting
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间序列和预测的一致性预测
- en: In this chapter, we will explore the exciting field of **conformal prediction**
    for time series and forecasting. Conformal prediction is a powerful tool for producing
    **prediction intervals** (**PIs**) for point forecasting models, and we will show
    you how to apply this technique to your data using open source libraries. This
    chapter will take you on a journey from understanding the fundamentals of **uncertainty
    quantification** (**UQ**) in time series to the intricate mechanisms behind conformal
    prediction in forecasting.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探索时间序列和预测中的激动人心的**一致性预测**领域。一致性预测是生成点预测模型的**预测区间（PIs**）的强大工具，我们将向您展示如何使用开源库应用这项技术到您的数据中。本章将带您从理解时间序列中不确定性量化（UQ）的基础到预测中一致性预测背后的复杂机制进行一次旅行。
- en: With this chapter, you will have a solid understanding of the various approaches
    to producing PIs, and you will be able to build your PIs using conformal prediction.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 通过本章，您将牢固地理解生成 PIs 的各种方法，并将能够使用一致性预测构建您的 PIs。
- en: 'In this chapter, we’re going to cover the following main topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主要主题：
- en: UQ for time series and forecasting problems
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间序列和预测问题的 UQ
- en: The concept of PIs in forecasting applications
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预测应用中 PI 的概念
- en: Various approaches to producing PIs
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 生成 PIs 的各种方法
- en: Conformal prediction for time series and forecasting
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间序列和预测的一致性预测
- en: By the end of this chapter, you’ll be able to apply the concepts and open source
    tools that will be discussed to your industry applications, providing robust forecasting
    with well-defined uncertainty bounds. These lessons will enhance your forecasting
    abilities, giving your models an edge by allowing you to add confidence measures
    to your predictions.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，您将能够将所讨论的概念和开源工具应用到您的行业应用中，提供具有明确不确定性界限的稳健预测。这些课程将提高您的预测能力，通过允许您向预测添加置信度度量，使您的模型更具优势。
- en: UQ for time series and forecasting problems
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间序列和预测问题的 UQ
- en: UQ is not just a sophisticated addition to time series forecasting; it is a
    fundamental aspect that provides invaluable insights into the nature of the predictions.
    Let’s look at why it’s important and a brief history of its development.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: UQ 不仅仅是时间序列预测中的复杂补充；它是一个基本方面，为预测的本质提供了宝贵的见解。让我们看看为什么它很重要，以及其发展的简要历史。
- en: The importance of UQ
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: UQ 的重要性
- en: 'UQ is a critical component of time series forecasting. While a forecast model
    may provide accurate predictions on average, understanding the uncertainty around
    those predictions is equally essential. There are several key reasons why properly
    quantifying uncertainty is vital for practical time series forecasting:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: UQ 是时间序列预测的一个关键组成部分。虽然预测模型可能在平均意义上提供准确的预测，但理解这些预测的不确定性同样至关重要。有几个关键原因说明为什么正确量化不确定性对于实际时间序列预测至关重要：
- en: '**Risk assessment**: In many domains, such as finance, healthcare, and environmental
    science, forecasting is closely linked with decision-making. Understanding the
    uncertainty in predictions aids in assessing potential risks, thus enabling informed
    decisions.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**风险评估**：在许多领域，如金融、医疗保健和环境科学，预测与决策紧密相连。理解预测的不确定性有助于评估潜在风险，从而实现明智的决策。'
- en: '**Model confidence**: UQ provides an understanding of the confidence in each
    model’s predictions. This can lead to a more refined model selection and help
    identify areas where the model may be underperforming.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**模型置信度**：UQ 提供了对每个模型预测的置信度的理解。这可能导致更精细的模型选择，并有助于识别模型可能表现不佳的领域。'
- en: '**Optimization of resources**: By acknowledging the uncertainty, resources
    can be allocated more optimally. For example, understanding the uncertainty in
    demand forecasts in supply chain management may lead to better inventory management.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**资源优化**：通过承认不确定性，资源可以更优化地分配。例如，了解供应链管理中需求预测的不确定性可能导致更好的库存管理。'
- en: '**Regulatory compliance**: In some industries, quantifying the uncertainty
    of forecasts might be mandated by regulatory bodies, emphasizing the importance
    of a systematic approach to UQ'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**合规性监管**：在某些行业中，监管机构可能要求量化预测的不确定性，这强调了系统化 UQ 方法的重要性'
- en: Having established the critical role of UQ, we now turn to its evolution.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在确立了不确定性量化（UQ）的关键作用后，我们现在转向其演变过程。
- en: The history of UQ
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: UQ 的历史
- en: 'The need to provide reliable measures of uncertainty alongside time series
    forecasts has long been recognized. Over the decades, advances in statistical
    and computational methods have enabled more sophisticated approaches to quantifying
    uncertainty. Some of the significant historical developments are as follows:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 提供可靠的不确定性度量与时间序列预测并行的需求早已被认识到。几十年来，统计和计算方法的发展使得量化不确定性的更复杂方法成为可能。以下是一些重要的历史发展：
- en: '**Early statistical methods**: The roots of UQ in time series can be traced
    back to the early statistical models. Techniques such as PIs were applied to provide
    bounds on predictions.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**早期统计方法**：时间序列中UQ的根源可以追溯到早期的统计模型。例如，PIs（预测区间）等技术被应用于为预测提供界限。'
- en: '**Bayesian approaches**: Bayesian methods brought a probabilistic perspective
    to UQ, allowing for more nuanced uncertainty descriptions. Bayesian forecasting
    models incorporate prior beliefs and likelihood functions to create posterior
    distributions, representing uncertainty comprehensively.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**贝叶斯方法**：贝叶斯方法为UQ带来了概率视角，允许进行更细致的不确定性描述。贝叶斯预测模型结合先验信念和似然函数来创建后验分布，全面地表示不确定性。'
- en: '**Bootstrapping and resampling**: Techniques such as bootstrapping enabled
    UQ without strong parametric assumptions, making it accessible for more complex
    models.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自助法和重采样**：如自助法等技术使UQ无需强烈的参数假设，使其对更复杂的模型变得可访问。'
- en: The historical developments we’ve explored provided a critical foundation for
    UQ in time series analysis. Now, let’s dive deeper into some of those early statistical
    techniques and see how they enabled the first steps toward quantifying forecast
    uncertainty.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 我们所探讨的历史发展为我们理解时间序列分析中的UQ提供了关键的基础。现在，让我们更深入地探讨那些早期统计技术，看看它们是如何使量化预测不确定性的第一步成为可能的。
- en: Early statistical methods – the roots of UQ in time series
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 早期统计方法——时间序列中UQ的根源
- en: UQ has always been a critical part of statistical analysis, and its role in
    time series forecasting is no different. The early days of statistical modeling
    laid the foundation for understanding uncertainty in predictions, and various
    techniques were developed to provide bounds on forecasts. Here, we will investigate
    some of these early statistical methods and see how they paved the way for the
    modern understanding of UQ in time series analysis.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: UQ（不确定性量化）一直是统计分析的关键部分，其在时间序列预测中的作用也并无不同。统计建模的早期阶段为理解预测中的不确定性奠定了基础，并开发了各种技术来为预测提供界限。在这里，我们将探讨这些早期统计方法，并了解它们是如何为现代时间序列分析中的UQ理解铺平道路的。
- en: 'One of the seminal contributions to UQ in time series forecasting was the concept
    of confidence intervals:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列预测中UQ的一个开创性贡献是置信区间的概念：
- en: '**T-distribution for small samples**: When dealing with small sample sizes,
    the t-distribution provided more accurate intervals, accounting for the increased
    uncertainty due to limited data'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**小样本的t分布**：在处理小样本量时，t分布提供了更准确的区间，考虑到由于数据有限而增加的不确定性。'
- en: '**Interval estimation for autoregressive models**: Specific techniques were
    developed for time series models such as ARIMA, where the confidence intervals
    could be derived for the parameters and forecasts'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自回归模型的区间估计**：为时间序列模型如ARIMA开发了特定技术，其中可以推导出参数和预测的置信区间。'
- en: 'Along with confidence intervals, prediction bounds were developed to encapsulate
    the uncertainty associated with future observations. These bounds considered the
    uncertainty in the model parameters and the random nature of future errors:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 除了置信区间，还开发了预测界限来封装与未来观测相关的不确定性。这些界限考虑了模型参数的不确定性和未来误差的随机性：
- en: '**Prediction error variance**: By estimating the prediction error variance,
    bounds could be created around the forecast values'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预测误差方差**：通过估计预测误差方差，可以在预测值周围创建界限。'
- en: '**Forecast error decomposition**: Techniques were developed to decompose the
    forecast error into various components, providing insights into the sources of
    uncertainty'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预测误差分解**：开发了将预测误差分解为各种组件的技术，从而为不确定性的来源提供了洞察。'
- en: 'While these early methods were highly influential, they often relied on strong
    assumptions about the underlying distributions and model structure. The parametric
    nature of these techniques made them less flexible in dealing with complex, non-linear
    time series data:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这些早期方法具有高度的影响力，但它们通常依赖于对潜在分布和模型结构的强烈假设。这些技术的参数性质使得它们在处理复杂、非线性时间序列数据时不够灵活：
- en: '**Non-parametric methods**: Recognizing these limitations led to the development
    of non-parametric methods that didn’t rely on specific distributional assumptions'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**非参数方法**：认识到这些局限性导致了非参数方法的发展，这些方法不依赖于特定的分布假设'
- en: '**Robust statistical techniques**: Efforts were also made to create more robust
    statistical methods that could handle outliers and non-constant variance, extending
    the scope of early UQ methods'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**稳健的统计技术**：还努力创造更稳健的统计方法，能够处理异常值和非恒定方差，扩展了早期UQ方法的范围'
- en: The early statistical methods for UQ in time series laid the groundwork for
    subsequent advancements in this field. The principles embedded in these techniques,
    such as confidence intervals and prediction bounds, continue to be central to
    modern UQ approaches. They represent a legacy that’s been built upon and refined,
    leading to various current methods for understanding uncertainty in time series
    forecasting.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列不确定性量化（UQ）的早期统计方法为该领域的后续进步奠定了基础。这些技术中嵌入的原则，如置信区间和预测界限，仍然是现代UQ方法的核心。它们代表了一种经过构建和改进的遗产，导致了当前理解时间序列预测中不确定性的各种方法。
- en: Now, let’s dive deeper into some of those early statistical techniques and see
    how they enabled the first steps toward quantifying forecast uncertainty.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们深入探讨一些早期的统计技术，看看它们是如何使预测不确定性的量化迈出第一步的。
- en: Modern machine learning approaches
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 现代机器学习方法
- en: 'The previous sections explored the early statistical foundations of UQ for
    time series predictions. These techniques, while pioneering, relied heavily on
    parametric assumptions and simple model structures. The rise of modern machine
    learning has enabled more flexible and robust approaches to quantifying uncertainty,
    overcoming some limitations of traditional methods. Let’s look at the key innovations
    in this area:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 前几节探讨了时间序列预测不确定性量化（UQ）的早期统计基础。虽然这些技术具有开创性，但它们在很大程度上依赖于参数假设和简单的模型结构。现代机器学习的兴起使得量化不确定性的方法更加灵活和稳健，克服了传统方法的一些局限性。让我们看看这个领域的关键创新：
- en: '**Modern machine learning approaches**: With the rise of machine learning,
    techniques such as dropout and ensemble methods have been developed to quantify
    uncertainty.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**现代机器学习方法**：随着机器学习的兴起，开发了诸如dropout和集成方法等技术来量化不确定性。'
- en: '**Conformal prediction**: Recently, conformal prediction has emerged as a robust
    framework for UQ. It provides a non-parametric approach, guaranteeing valid PIs
    under mild assumptions.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**符合预测**：最近，符合预测已成为UQ的一个稳健框架。它提供了一种非参数方法，在温和的假设下保证有效的PI。'
- en: UQ is integral to time series forecasting. It enriches the understanding of
    the predictions, facilitates better decision-making, and aligns with regulatory
    requirements. The evolution of UQ over time has led to diverse approaches, each
    adding value in different contexts.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: UQ对于时间序列预测至关重要。它丰富了预测的理解，促进了更好的决策，并符合监管要求。随着时间的推移，UQ的演变导致了多样化的方法，每种方法在不同的环境中都增加了价值。
- en: The recent advent of conformal prediction, which will be explored later in this
    chapter, represents a significant advancement in this field, offering robust and
    universally applicable uncertainty measures.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 本章稍后将探讨的符合预测（conformal prediction）的最近出现代表了该领域的一个重要进步，提供了稳健且普遍适用的不确定性度量。
- en: In summary, the emergence of flexible machine learning techniques has enabled
    robust new approaches to UQ that overcome the limitations of early statistical
    methods. This evolution has provided a diverse toolkit for quantifying uncertainty
    in time series forecasting.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，灵活的机器学习技术的出现使得UQ有了新的稳健方法，克服了早期统计方法的局限性。这种演变为量化时间序列预测中的不确定性提供了一套多样化的工具箱。
- en: Next, we will explore the concepts behind PIs, a foundation for communicating
    forecast uncertainty.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将探讨PI背后的概念，这是传达预测不确定性的基础。
- en: The concept of PIs in forecasting applications
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测应用中PI（预测区间）的概念
- en: PIs are vital tools in forecasting, providing a range of plausible values within
    which a future observation is likely to occur. Unlike point forecasts, which give
    a single best estimate, PIs communicate the uncertainty surrounding that estimate.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: PIs是预测中的关键工具，提供了一系列可能值，其中未来观测值很可能会发生。与只给出一个最佳估计值的点预测不同，PIs传达了该估计值周围的不确定性。
- en: This section explores the fundamental concepts behind PIs and their significance
    in various forecasting applications.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 本节探讨了PIs背后的基本概念及其在各个预测应用中的重要性。
- en: Definition and construction
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 定义和构建
- en: PIs are constructed around a point forecast to represent the range within which
    future observations are expected to lie with a given confidence level. For example,
    a 95% PI implies that 95 of 100 future observations are expected to fall within
    the defined range.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: PIs围绕一个预测点构建，以表示未来观测值预期落在其中的范围，并具有给定的置信水平。例如，95%的PI意味着在100个未来观测值中，有95个预期将落在定义的范围内。
- en: 'PIs can take several forms, depending on the approach used to generate them.
    Two key distinguishing factors are as follows:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: PIs可以采取多种形式，具体取决于生成它们的方法。以下有两个关键的区别因素：
- en: '**Symmetric versus asymmetric intervals**: PIs can be symmetric, where the
    bounds are equidistant from the point forecast, or asymmetric, reflecting differing
    uncertainty in different directions'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对称与不对称区间**：PIs可以是对称的，即边界与预测点等距，或者是不对称的，反映不同方向上的不同不确定性'
- en: '**Parametric versus non-parametric methods**: PIs can be created using parametric
    (for example, assuming normal distribution) or non-parametric methods, depending
    on the underlying data distribution assumptions'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**参数方法与非参数方法**：PIs可以使用参数方法（例如，假设正态分布）或非参数方法创建，具体取决于数据分布的潜在假设'
- en: The importance of forecasting applications
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 预测应用的重要性
- en: 'PIs play an essential role in various forecasting domains, and here’s why:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: PIs在各个预测领域扮演着至关重要的角色，原因如下：
- en: '**Decision making**: PIs enable decision-makers to assess risks and opportunities
    – for instance, they allow investors to gauge the volatility of an asset'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**决策制定**：PIs使决策者能够评估风险和机遇——例如，它们允许投资者评估资产的波动性'
- en: '**Model evaluation**: Comparing actual observations with PIs can be a part
    of model diagnostic checks, helping evaluate a model’s adequacy in capturing uncertainty'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**模型评估**：将实际观测值与PIs进行比较可以是模型诊断检查的一部分，有助于评估模型在捕捉不确定性方面的充分性'
- en: '**Optimizing operations**: In supply chain management, PIs can aid in optimizing
    inventory by reflecting the uncertainty in demand forecasts'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**优化运营**：在供应链管理中，PIs可以通过反映需求预测的不确定性来帮助优化库存'
- en: '**Communicating uncertainty**: PIs effectively communicate uncertainty to non-technical
    stakeholders, facilitating more nuanced discussions and planning'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**传达不确定性**：PIs有效地向非技术利益相关者传达不确定性，促进更细致的讨论和规划'
- en: Challenges and considerations
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 挑战和考虑因素
- en: 'While highly valuable, constructing accurate and reliable PIs is not without
    challenges:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然非常有价值，但构建准确可靠的PIs并非没有挑战：
- en: '**Assumption sensitivity**: PIs may be sensitive to the underlying assumptions
    about the data distribution, and incorrect assumptions can lead to misleading
    intervals.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**假设敏感性**：PIs可能对关于数据分布的潜在假设敏感，错误的假设可能导致误导性的区间。'
- en: '**Coverage and width trade-off**: Achieving the correct coverage probability
    (95%) often competes with the desire for narrow intervals. Wider intervals may
    cover the desired percentage of observations but may need to be more informative.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**覆盖范围与宽度权衡**：实现正确的覆盖概率（95%）往往与希望获得狭窄区间的愿望相竞争。较宽的区间可能覆盖所需的观测值百分比，但可能需要提供更多信息。'
- en: '**Computational complexity**: Some methods for constructing PIs can be computationally
    intensive, particularly with large datasets or complex models.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**计算复杂性**：一些构建PIs的方法可能计算密集，尤其是在大型数据集或复杂模型中。'
- en: PIs are at the heart of UQ in forecasting applications, offering a more comprehensive
    view of prospects. They support strategic decision-making, enable model evaluations,
    and foster effective communication of uncertainty. Understanding the concept and
    practicalities of PIs is essential for anyone working with forecasting models,
    providing a means to navigate and leverage the inherent uncertainty in predicting
    future outcomes.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: PIs是预测应用中不确定性量化（UQ）的核心，提供了对前景的更全面视角。它们支持战略决策，使模型评估成为可能，并促进对不确定性的有效沟通。理解PIs的概念和实践对于任何使用预测模型的人来说都是必不可少的，它提供了一种导航和利用预测未来结果固有不确定性的手段。
- en: While PIs bring invaluable insights, constructing accurate and informative intervals
    is only sometimes straightforward, as we’ve seen. However, decades of research
    have produced diverse techniques to tackle these challenges.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然PIs提供了无价的见解，但构建准确且信息丰富的区间并不总是那么简单，正如我们所看到的。然而，几十年的研究产生了各种技术来应对这些挑战。
- en: Various approaches to producing PIs
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生成PIs的各种方法
- en: PIs are an essential tool in forecasting, allowing practitioners to understand
    the range within which future observations are likely to fall. Various approaches
    have been developed to produce these intervals, each with advantages, applications,
    and challenges. This section will explore the most prominent techniques for creating
    PIs.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: PIs是预测中的基本工具，使从业者能够了解未来观测值可能落在的范围。已经开发出各种方法来生成这些区间，每种方法都有其优点、应用和挑战。本节将探讨创建PIs最突出的技术。
- en: Parametric approaches
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参数方法
- en: 'Parametric approaches make specific assumptions about the distribution of forecast
    errors to derive PIs. Some standard techniques in this category are as follows:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 参数方法对预测误差的分布做出具体假设以推导PIs。这一类别中的一些标准技术如下：
- en: '**Normal distribution assumptions**: By assuming that the forecast errors follow
    a normal distribution, we can compute symmetric PIs based on standard errors and
    critical values from the normal distribution.'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**正态分布假设**：通过假设预测误差遵循正态分布，我们可以根据正态分布的标准误差和临界值计算对称的PIs。'
- en: '**Time series models**: Models such as ARIMA and exponential smoothing can
    generate PIs by modeling the underlying stochastic process and using the estimated
    parameters to produce intervals.'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**时间序列模型**：例如ARIMA和指数平滑等模型可以通过对潜在随机过程建模并使用估计的参数来生成预测区间（PIs）。'
- en: '**Generalized linear models (GLMs)**: GLMs extend linear models to non-normal
    distributions, allowing for more flexible PI construction. GLMs broaden linear
    regression to response variables that follow distributions other than the normal
    distribution. GLMs allow us to model data with non-normal responses such as binary,
    count, or categorical outcomes. Like linear models, GLMs relate the mean response
    to explanatory variables through a link function and linear predictor. However,
    the response distribution can be non-normal, handled via an exponential family
    log-likelihood. Here are some common examples of GLMs:'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**广义线性模型（GLMs）**：GLMs将线性模型扩展到非正态分布，从而允许更灵活地构建PIs。GLMs将线性回归扩展到除了正态分布以外的响应变量。GLMs使我们能够对具有非正态响应的数据进行建模，例如二元、计数或分类结果。与线性模型一样，GLMs通过链接函数和线性预测器将均值响应与解释变量相关联。然而，响应分布可以是非正态的，通过指数族对数似然函数进行处理。以下是GLMs的一些常见示例：'
- en: Logistic regression for binary classification (logit link, binomial distribution)
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 二元分类的逻辑回归（logit链接，二项分布）
- en: Poisson regression for count data (log link, Poisson distribution)
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 泊松回归用于计数数据（log链接，泊松分布）
- en: Multinomial regression for categorical responses (logit link, multinomial distribution)
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多项式回归用于分类响应（logit链接，多项分布）
- en: GLMs estimate coefficients for each feature, just like ordinary linear regression.
    However, by expanding the response distribution and link function, they can model
    non-normal processes needed for regression-style prediction with non-continuous
    targets.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: GLMs估计每个特征的系数，就像普通线性回归一样。然而，通过扩展响应分布和链接函数，它们可以模拟回归式预测所需的非正态过程，目标是非连续的。
- en: Their flexibility makes GLMs helpful in constructing PIs for a broader range
    of problems compared to standard linear regression. The intervals incorporate
    the modeled response distribution.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 它们的灵活性使GLMs在构建比标准线性回归更广泛的问题的PIs时非常有用。这些区间包含了建模的响应分布。
- en: Non-parametric approaches
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 非参数方法
- en: 'Non-parametric methods aim to construct PIs without making strict assumptions
    about the distribution of forecast errors. Some fundamental techniques in this
    category are as follows:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 非参数方法旨在构建PI，而不对预测误差的分布做出严格假设。这一类别中的一些基本技术如下：
- en: '**Bootstrapping**: Bootstrapping involves resampling the observed data and
    estimating the distribution of forecasts, from which PIs can be derived'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自助法**：自助法涉及对观测数据进行重采样并估计预测的分布，从而可以推导出PI'
- en: '**Quantile regression**: This method directly models the response variable’s
    quantiles, enabling the construction of PIs without specific distributional assumptions'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分位数回归**：这种方法直接对响应变量的分位数进行建模，使得在无需特定分布假设的情况下构建PI成为可能'
- en: '**Empirical percentiles**: Using historical and empirical percentiles, we can
    construct PIs without parametric assumptions'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**经验分位数**：使用历史和经验分位数，我们可以构建无需参数假设的PI'
- en: Bayesian approaches
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 贝叶斯方法
- en: 'The Bayesian statistical framework provides a probabilistic approach to generating
    PIs by explicitly modeling different sources of uncertainty. Two critical techniques
    for Bayesian PI construction are as follows:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯统计框架通过明确建模不同来源的不确定性，提供了一种生成PI的概率方法。贝叶斯PI构建的两个关键技术如下：
- en: '**Bayesian forecasting models**: Bayesian models provide a probabilistic framework
    that captures uncertainty in parameters and predictions, allowing for the direct
    calculation of PIs from posterior distributions'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**贝叶斯预测模型**：贝叶斯模型提供了一个概率框架，该框架捕捉了参数和预测中的不确定性，允许从后验分布中直接计算PI'
- en: '**Monte Carlo Markov Chain (MCMC) sampling**: MCMC sampling can be used to
    simulate the posterior distribution of a Bayesian model, enabling the construction
    of PIs'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**蒙特卡洛马尔可夫链（MCMC）采样**：MCMC采样可以用来模拟贝叶斯模型的后验分布，从而能够构建PI'
- en: Machine learning approaches
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 机器学习方法
- en: 'The flexibility of modern machine learning models provides new opportunities
    for generating PIs in a data-driven manner. By leveraging techniques tailored
    for these highly complex and nonlinear models, valid PIs can be obtained without
    strict distributional assumptions. Let’s look at some machine learning approaches:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 现代机器学习模型的灵活性为以数据驱动的方式生成PI提供了新的机会。通过利用针对这些高度复杂和非线性模型量身定制的技巧，可以在不严格假设分布的情况下获得有效的PI。让我们来看看一些机器学习方法：
- en: '**Ensemble methods**: Techniques such as random forest and gradient boosting
    machines can create PIs by using the distribution of predictions from individual
    ensemble members'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**集成方法**：如随机森林和梯度提升机等技术可以通过使用单个集成成员的预测分布来创建PI'
- en: '**Neural network quantile regression**: Neural networks can be trained to predict
    specific quantiles, forming the basis for PIs'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**神经网络分位数回归**：神经网络可以被训练来预测特定的分位数，这构成了PI的基础'
- en: '**Dropout as a Bayesian approximation**: In deep learning, dropout can approximate
    Bayesian inference, allowing for UQ and PI construction'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**dropout作为贝叶斯近似**：在深度学习中，dropout可以近似贝叶斯推理，从而允许进行不确定性量化（UQ）和PI构建'
- en: Conformal prediction
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 一致性预测
- en: As a non-parametric, distribution-free framework, conformal prediction can be
    integrated with various modeling approaches to produce PIs. Producing PIs for
    time series forecasting models using conformal prediction methods is the main
    subject of this chapter.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一种非参数、无分布框架，一致性预测可以与各种建模方法相结合以生成PI。本章主要讨论使用一致性预测方法为时间序列预测模型生成PI。
- en: Producing PIs is multifaceted, with various approaches tailored to different
    data types, models, and requirements. From traditional statistical methods to
    cutting-edge machine learning techniques and conformal prediction, the field of
    PI construction is rich and diverse. Understanding these approaches empowers practitioners
    to select the most appropriate method for their forecasting application, balancing
    accuracy, interpretability, computational efficiency, and other considerations.
    Whether operating within rigorous parametric assumptions or exploring flexible
    non-parametric techniques, these methods offer valuable insights into the uncertainty
    inherent in forecasting.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 生成预测区间（PIs）是一个多方面的过程，针对不同的数据类型、模型和需求，有多种方法。从传统的统计方法到前沿的机器学习技术以及一致性预测，PI构建领域丰富多彩。了解这些方法使从业者能够为他们的预测应用选择最合适的方法，在准确性、可解释性、计算效率和其他考虑因素之间取得平衡。无论是严格遵循参数假设还是探索灵活的非参数技术，这些方法都能为预测中固有的不确定性提供有价值的见解。
- en: Conformal prediction, a robust framework for generating PIs for point forecasting
    models, has been widely utilized in time series and forecasting applications.
    Numerous studies have chronicled the evolution and popularity of various conformal
    prediction models for time series forecasting.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 符合预测，一个用于生成点预测模型PI的稳健框架，已被广泛应用于时间序列和预测应用中。许多研究记录了各种符合预测模型在时间序列预测中的演变和流行。
- en: Conformal prediction for time series and forecasting
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间序列和预测的符合预测
- en: Creating reliable PIs for time series forecasting has been a longstanding, intricate
    challenge that remained unsolved for years until conformal prediction emerged.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 为时间序列预测创建可靠的PI一直是一个长期而复杂的挑战，直到符合预测的出现才得以解决。
- en: This problem was underscored during the 2018 M4 Forecasting Competition, which
    necessitated participants to supply PIs and point estimates.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 这个问题在2018年M4预测竞赛中被强调，该竞赛要求参与者提供PI和点估计。
- en: In the research paper titled *Combining Prediction Intervals in the M4 Competition*,
    (https://www.sciencedirect.com/science/article/abs/pii/S0169207019301141), Yael
    Grushka-Cockayne from the Darden School of Business and Victor Richmond R. Jose
    from Harvard Business School scrutinized 20 interval submissions. They assessed
    both the calibration and precision of the predictions and gauged their performances
    across different time horizons. Their analysis concluded that the submissions
    were ineffective in accurately estimating uncertainty.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在题为《*M4竞赛中预测区间的结合*》的研究论文中（[https://www.sciencedirect.com/science/article/abs/pii/S0169207019301141](https://www.sciencedirect.com/science/article/abs/pii/S0169207019301141)），达登商学院的Yael
    Grushka-Cockayne和哈佛商学院的Victor Richmond R. Jose仔细审查了20个区间提交。他们评估了预测的校准和精度，并衡量了它们在不同时间跨度上的表现。他们的分析得出结论，提交的预测在准确估计不确定性方面是无效的。
- en: Ensemble batch PIs (EnbPIs)
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 集成批量PI（EnbPIs）
- en: '*Conformal Prediction Intervals for Dynamic Time-Series* ([http://proceedings.mlr.press/v139/xu21h/xu21h.pdf](http://proceedings.mlr.press/v139/xu21h/xu21h.pdf)),
    by researchers Chen Xu and Yao Xie from Georgia Tech University, was the first
    paper to implement conformal prediction for time series forecasting and was presented
    at the prestigious conference ICML in 2021.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 由乔治亚理工学院的研究员陈旭和谢耀撰写的《*动态时间序列的符合预测区间*》([http://proceedings.mlr.press/v139/xu21h/xu21h.pdf](http://proceedings.mlr.press/v139/xu21h/xu21h.pdf))，是第一篇将符合预测应用于时间序列预测的论文，并在2021年的著名会议ICML上展出。
- en: EnbPI is currently one of the most popular implementations of conformal prediction
    for time series forecasting. It has been implemented in popular open source conformal
    prediction libraries such as MAPIE, Amazon Fortuna, and PUNCC.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: EnbPI是目前时间序列预测中符合预测最流行的实现之一。它已被实现于流行的开源符合预测库，如MAPIE、Amazon Fortuna和PUNCC。
- en: The study introduces a technique for creating PIs not bound by any specific
    distribution for dynamic time series data. The EnbPI method encompasses a bootstrap
    ensemble estimator to formulate sequential PIs. Unlike classical conformal prediction
    methods that require data exchangeability, EnbPI does not require data exchangeability
    and has been custom-built for time series.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 该研究介绍了一种为动态时间序列数据创建不受任何特定分布限制的PI的技术。EnbPI方法包括一个自举集成估计器来制定顺序PI。与需要数据可交换性的经典符合预测方法不同，EnbPI不需要数据可交换性，并且专门为时间序列构建。
- en: The data exchangeability assumption suggests that the sequence in which observations
    appear in the dataset doesn’t matter. However, this assumption does not apply
    to time series, where the sequence of data points is crucial. EnbPI doesn’t rely
    on data exchangeability, making it aptly suited for time series analysis.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 数据可交换性假设表明，数据集中观测值出现的顺序并不重要。然而，这个假设并不适用于时间序列，其中数据点的顺序至关重要。EnbPI不依赖于数据可交换性，因此非常适合时间序列分析。
- en: PIs generated by EnbPI attain a finite-sample, approximately valid marginal
    coverage for broad regression functions and time series under the mild assumption
    of strongly mixing stochastic errors. Additionally, EnbPI is computationally efficient
    and avoids overfitting by not requiring data splitting or training multiple ensemble
    estimators. It is also scalable to producing arbitrarily many PIs sequentially
    and is well suited to a wide range of regression functions.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: EnbPI生成的PI在强混合随机误差的温和假设下，对于广泛的回归函数和时间序列具有有限样本、近似有效的边缘覆盖。此外，EnbPI计算效率高，通过不需要数据拆分或训练多个集成估计器来避免过拟合。它还可以按顺序生成任意数量的PI，非常适合广泛的回归函数。
- en: Time series data is dynamic and often non-stationary, meaning the statistical
    properties can change over time. While various regression functions exist for
    predicting time series, such as those using boosted trees or neural network structures,
    these existing methods often need help constructing accurate PIs. Typically, they
    can only create reliable intervals by placing restrictive assumptions on the underlying
    distribution of the time series, which may only sometimes be appropriate or feasible.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列数据是动态的，通常是非平稳的，这意味着统计属性会随时间变化。虽然存在各种用于预测时间序列的回归函数，例如使用提升树或神经网络结构的函数，但这些现有方法通常需要帮助构建准确的PIs。通常，它们只能通过在时间序列的潜在分布上施加限制性假设来创建可靠的区间，这可能只有时是适当或可行的。
- en: 'Here’s a simplified version of the steps to build an EnbPI predictor:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是构建EnbPI预测器的步骤简化版：
- en: '**Select a bootstrap ensemble estimator**: Any bootstrap ensemble estimator
    can be used with EnbPI.'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**选择bootstrap集成估计器**：任何bootstrap集成估计器都可以与EnbPI一起使用。'
- en: '**Train the ensemble estimators**: The base forecasting model is trained multiple
    times on different bootstrap samples drawn from the original training data to
    generate the ensemble. Each bootstrap sample is created by sampling with replacement
    from the training set. This results in an ensemble of models with slightly different
    training data.'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**训练集成估计器**：基础预测模型在从原始训练数据中抽取的不同bootstrap样本上多次训练，以生成集成。每个bootstrap样本是通过从训练集中有放回地采样创建的。这导致了一个具有略微不同训练数据的模型集成。'
- en: '**Compute residuals**: For each point in t = 1,…, T, calculate the residuals
    using ensemble estimators that did not use point *t* for training. The aim is
    to use out-of-sample errors as a nonconformity measure to indicate the variance
    of predictions. All such out-of-sample errors are compiled into a single array.'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**计算残差**：对于t = 1，…，T中的每个点，使用未使用点*t*进行训练的集成估计器计算残差。目的是使用样本外误差作为非一致性度量，以指示预测的方差。所有这些样本外误差都被编译成一个单一的数组。'
- en: '**Generate predictions**: The ensemble estimator generates point predictions
    for the test data.'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**生成预测**：集成估计器为测试数据生成点预测。'
- en: '**Construct PIs**: The PIs are constructed using the predictions from the ensemble
    estimator and a chosen significance level. Like many other conformal prediction
    methods, a quantile with a specified confidence level can be applied to the distribution
    of out-of-sample errors created in *step 3*. This quantile value is then used
    to create PIs by applying the quantile value to the aggregated point prediction
    produced using a trained ensemble estimator.'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**构建PIs**：PIs是通过使用集成估计器的预测和选定的显著性水平构建的。像许多其他一致性预测方法一样，可以将指定置信水平的分位数应用于在*步骤3*中创建的样本外误差分布。然后，使用训练的集成估计器生成的聚合点预测应用分位数值来创建PIs。'
- en: 'To demonstrate EnbPI in action, we will use Amazon Fortuna ([https://aws-fortuna.readthedocs.io/en/latest/index.html](https://aws-fortuna.readthedocs.io/en/latest/index.html))
    and follow its example, *Time series regression with EnbPI, a conformal prediction
    method* ([https://aws-fortuna.readthedocs.io/en/latest/examples/enbpi_ts_regression.html](https://aws-fortuna.readthedocs.io/en/latest/examples/enbpi_ts_regression.html)).
    You can find the Jupyter notebook, `Chapter_08_EnbPI_ipynb.ipynb`, in this book’s
    GitHub repository: [https://github.com/PacktPublishing/Practical-Guide-to-Applied-Conformal-Prediction/blob/main/Chapter_08_EnbPI.ipynb](https://github.com/PacktPublishing/Practical-Guide-to-Applied-Conformal-Prediction/blob/main/Chapter_08_EnbPI.ipynb).
    Let’s get started:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 为了展示EnbPI的实际应用，我们将使用Amazon Fortuna ([https://aws-fortuna.readthedocs.io/en/latest/index.html](https://aws-fortuna.readthedocs.io/en/latest/index.html))
    并遵循其示例，*使用EnbPI进行时间序列回归，一种一致性预测方法* ([https://aws-fortuna.readthedocs.io/en/latest/examples/enbpi_ts_regression.html](https://aws-fortuna.readthedocs.io/en/latest/examples/enbpi_ts_regression.html))。您可以在本书的GitHub仓库中找到Jupyter笔记本，`Chapter_08_EnbPI_ipynb.ipynb`：[https://github.com/PacktPublishing/Practical-Guide-to-Applied-Conformal-Prediction/blob/main/Chapter_08_EnbPI.ipynb](https://github.com/PacktPublishing/Practical-Guide-to-Applied-Conformal-Prediction/blob/main/Chapter_08_EnbPI.ipynb)。让我们开始吧：
- en: 'First, we will install Amazon Fortuna with `pip install`:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们将使用`pip install`安装Amazon Fortuna：
- en: '[PRE0]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'We will use the `Bike sharing demand` dataset, available on scikit-learn:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用scikit-learn上可用的`Bike sharing demand`数据集：
- en: '[PRE1]'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[PRE2]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Let’s inspect the dataset header:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们检查数据集标题：
- en: '![Figure 8.1 – Bike sharing demand dataset](img/B19925_08_01.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![图8.1 – 自行车共享需求数据集](img/B19925_08_01.jpg)'
- en: Figure 8.1 – Bike sharing demand dataset
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.1 – 自行车共享需求数据集
- en: The dataset contains information about bike-sharing rentals, including additional
    information such as temperature, humidity, and wind speed. The problem requires
    forecasting bike sharing demand expressed in the count of rented bikes.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集包含有关共享单车租赁的信息，包括温度、湿度和风速等附加信息。问题要求预测以租用自行车数量表示的共享单车需求。
- en: 'We can calculate the demand, grouped by weekday and hour, and illustrate the
    results with the following plot:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以按星期几和小时分组计算需求，并使用以下图表展示结果：
- en: '![Figure 8.2 – Average hourly bike demand during the week](img/B19925_08_02.jpg)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![图8.2 – 一周内平均每小时自行车需求](img/B19925_08_02.jpg)'
- en: Figure 8.2 – Average hourly bike demand during the week
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.2 – 一周内平均每小时自行车需求
- en: EnbPI requires bootstrapping the data – that is, sampling with replacement random
    subsets of the time series and training a model for each sample.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: EnbPI需要数据预取样 – 也就是说，对时间序列进行带替换的随机子集采样，并为每个样本训练一个模型。
- en: 'We can test the `DataFrameBootstrapper` class and look at an example of bootstrapped
    data samples. For example, the first bootstrapped sample looks like this:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以测试`DataFrameBootstrapper`类，并查看预取样数据样本的示例。例如，第一个预取样样本看起来是这样的：
- en: '![Figure 8.3 – Example of a bootstrapped sample](img/B19925_08_03.jpg)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![图8.3 – 预取样样本的示例](img/B19925_08_03.jpg)'
- en: Figure 8.3 – Example of a bootstrapped sample
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.3 – 预取样样本的示例
- en: 'We can check for duplicates in this bootstrapped sample – as bootstrapping
    is with replacement, as expected, we can see that some objects have been duplicated
    during bootstrapping:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以检查这个预取样样本中的重复项 – 由于预取样是带替换的，正如预期的那样，我们可以看到在预取样过程中一些对象被重复了：
- en: '![Figure 8.4 – Duplicated objects in the bootstrapped sample](img/B19925_08_04.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![图8.4 – 预取样样本中的重复对象](img/B19925_08_04.jpg)'
- en: Figure 8.4 – Duplicated objects in the bootstrapped sample
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.4 – 预取样样本中的重复对象
- en: We can now train the model for each bootstrapped sample. To evaluate conformal
    PIs, we can calculate the coverage probability, which measures the percentage
    of test observations that fall within the generated intervals, and check what
    proportion of intervals contain the point predictions.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以为每个预取样样本训练模型。为了评估一致PI，我们可以计算覆盖概率，这衡量了落在生成的区间内的测试观察值的百分比，并检查包含点预测的区间比例。
- en: Ultimately, we evaluate the dimension of the conformal intervals, which, in
    this scenario where no online feedback is given, are assumed by EnbPI to be uniform
    for all intervals.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最终，我们评估了一致区间的维度，在这个没有在线反馈的场景中，EnbPI假设所有区间都是均匀的。
- en: The percentage of intervals containing actual targets is `0.95`, while the size
    of the conformal intervals is `0.4446`.
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 包含实际目标的区间百分比是`0.95`，而一致区间的尺寸是`0.4446`。
- en: Using EnbPI, we created PIs based on a user-defined coverage of 0.95\. Contrary
    to most other UQ methods, which often fail to meet the user-specified confidence
    level, conformal prediction meets user requirements. It consistently generates
    PIs that align with the user-defined confidence level.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 使用EnbPI，我们根据用户定义的0.95置信度创建了PI。与大多数其他UQ方法不同，这些方法往往无法满足用户指定的置信水平，一致预测满足用户要求。它始终生成与用户定义的置信水平一致的PI。
- en: 'Let’s plot the predictions:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们绘制预测图：
- en: '![Figure 8.5 – Predictions using EnbPI](img/B19925_08_05.jpg)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![图8.5 – 使用EnbPI的预测](img/B19925_08_05.jpg)'
- en: Figure 8.5 – Predictions using EnbPI
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.5 – 使用EnbPI的预测
- en: The EnbPI model is adept at avoiding overfitting, ensuring computational efficiency,
    and is scalable for producing numerous PIs sequentially. In practice, the EnbPI
    model creates PIs in line with user-defined confidence levels, ensuring reliability
    in its predictions. We have provided practical examples using Amazon Fortuna and
    the bike-sharing demand dataset from scikit-learn, demonstrating the model’s capability
    to accurately gauge **prediction interval coverage probability** (**PICP**) and
    the size of the conformal intervals.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: EnbPI模型擅长避免过拟合，确保计算效率，并且可以扩展以顺序产生多个PI。在实践中，EnbPI模型根据用户定义的置信水平创建PI，确保其预测的可靠性。我们提供了使用Amazon
    Fortuna和来自scikit-learn的共享单车需求数据集的实用示例，展示了模型准确评估**预测区间覆盖概率**（PICP）和一致区间大小的能力。
- en: NeuralProphet
  id: totrans-142
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: NeuralProphet
- en: '`NeuralProphet` is a forecasting framework built on PyTorch that merges the
    interpretability of traditional methods with the scalability of deep learning
    models. It’s trained using standard deep learning techniques and provides accurate
    and interpretable results for various forecasting applications.'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 是一个基于 PyTorch 的预测框架，它将传统方法的可解释性与深度学习模型的可扩展性相结合。它使用标准的深度学习技术进行训练，并为各种预测应用提供准确且可解释的结果。'
- en: The framework introduces local context through auto-regression and covariate
    modules, which can be set up as either classical linear regression or neural networks.
    This allows `NeuralProphet` to handle short-term forecasting while capturing complex
    nonlinear relationships between variables. The auto-regression module models the
    dependency of the target variable on its past values, while the covariate module
    addresses its dependence on other known variables.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 该框架通过自回归和协变量模块引入局部上下文，这些模块可以设置为经典线性回归或神经网络。这使得 `NeuralProphet` 能够处理短期预测，同时捕捉变量之间的复杂非线性关系。自回归模块模型化目标变量对其过去值的依赖性，而协变量模块解决其对其他已知变量的依赖性。
- en: '`NeuralProphet` is designed to be user-friendly, offering reliable defaults
    and automatic hyperparameters for beginners while allowing experienced users to
    input domain knowledge through optional model customizations. As a successor to
    Facebook Prophet, it retains the foundational components but improves precision
    and scalability.'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 被设计成用户友好，为初学者提供可靠的默认值和自动超参数，同时允许经验丰富的用户通过可选的模型定制输入领域知识。作为 Facebook
    Prophet 的继任者，它保留了基础组件，但提高了精度和可扩展性。'
- en: The essential model components of `NeuralProphet` include the trend, seasonality,
    holidays, auto-regression, and covariate modules. These additive components can
    be scaled by the trend for a multiplicative effect. Each module has its inputs
    and modeling processes, but all modules must produce *h* outputs, where *h* is
    the number of steps to be forecasted into the future at once.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 的基本模型组件包括趋势、季节性、节假日、自回归和协变量模块。这些加性组件可以通过趋势进行缩放以产生乘性效应。每个模块都有其输入和建模过程，但所有模块都必须产生
    *h* 个输出，其中 *h* 是一次预测到未来的步数。'
- en: '`NeuralProphet` incorporates conformal prediction techniques into its forecasting
    workflow, specifically the **inductive (split) conformal prediction** (**ICP**)
    approach. The key steps are as follows:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 将符合预测技术纳入其预测工作流程，具体采用**归纳（分割）符合预测**（**ICP**）方法。关键步骤如下：'
- en: '`NeuralProphet` uses this data to create an initial PI.'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 使用这些数据来创建一个初始的预测区间（PI）。'
- en: '`NeuralProphet` evaluates the accuracy of its predictions by comparing the
    actual target variable values with the predicted outputs.'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 通过比较实际的目标变量值与预测输出，评估其预测的准确性。'
- en: '`NeuralProphet` measure the uncertainty in its forecasts. This is a crucial
    step as understanding this variance is essential for generating precise PIs.'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 测量其预测中的不确定性。这是一个关键步骤，因为理解这种方差对于生成精确的预测区间是至关重要的。'
- en: '`NeuralProphet` formulates the final PI. This interval provides a range within
    which the actual future values are expected to lie with a predefined confidence
    level.'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 公式化最终的预测区间。此区间提供了一个范围，其中实际的未来值预计将在此范围内，具有预定义的置信水平。'
- en: '`NeuralProphet` integrates conformal prediction methods into its forecasting
    workflow, particularly employing the ICP strategy. This approach enables the creation
    of statistically robust uncertainty sets or intervals for model predictions, enhancing
    their reliability and confidence.'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 将符合预测方法集成到其预测工作流程中，特别是采用 ICP 策略。这种方法能够为模型预测创建统计上稳健的不确定性集或区间，增强其可靠性和置信度。'
- en: 'Let’s look at two methodologies that are utilized by `NeuralProphet` within
    the conformal prediction framework to establish PIs:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看 `NeuralProphet` 在符合预测框架内用于建立预测区间的两种方法：
- en: '`NeuralProphet` provides a singular output as a point estimate for each instance,
    calculated based on a 50th-percentile regression. The `NeuralProphet` object requires
    at least one upper and lower quantile pair as parameters to create a PI. For instance,
    for a 90% probability of the actual value falling within the estimated interval,
    the confidence level is set at 0.9, defining two quantiles at 0.05 and 0.95, corresponding
    to the 5th and 95th percentiles of the forecast distribution.'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`NeuralProphet`为每个实例提供一个单独的输出，作为点估计，基于50%分位数回归计算。`NeuralProphet`对象需要至少一个上分位数和下分位数对作为参数来创建置信区间。例如，对于实际值有90%的概率落在估计区间内，置信水平设置为0.9，定义两个分位数在0.05和0.95，对应于预测分布的第5个和第95个分位数。'
- en: '`NeuralProphet` model, the `conformal_predict` method can be utilized to produce
    a conformal forecast. `NeuralProphet` uses two variants of UQ – naïve conformal
    prediction and **conformalized quantile regression** (**CQR**), which we looked
    at in [*Chapter 7*](B19925_07.xhtml#_idTextAnchor073).'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`NeuralProphet`模型，可以使用`conformal_predict`方法来生成符合性预测。`NeuralProphet`使用两种不确定性量化（UQ）的变体——朴素符合性预测和**符合性分位数回归**（**CQR**），我们在[*第7章*](B19925_07.xhtml#_idTextAnchor073)中讨论过。'
- en: To demonstrate how `NeuralProphet` can create PIs using conformal prediction,
    we will follow the notebook at https://github.com/PacktPublishing/Practical-Guide-to-Applied-Conformal-Prediction/blob/main/Chapter_08_NeuralProphet.ipynb,
    which is based on UQ in the `NeuralProphet` tutorial ([https://neuralprophet.com/how-to-guides/feature
    guides/uncertainty_quantification.html](https://neuralprophet.com/how-to-guides/feature-guides/uncertainty_quantification.html)).
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 为了展示`NeuralProphet`如何使用符合性预测创建置信区间，我们将遵循https://github.com/PacktPublishing/Practical-Guide-to-Applied-Conformal-Prediction/blob/main/Chapter_08_NeuralProphet.ipynb中的笔记本，该笔记本基于`NeuralProphet`教程中的UQ（[https://neuralprophet.com/how-to-guides/feature-guides/uncertainty_quantification.html](https://neuralprophet.com/how-to-guides/feature-guides/uncertainty_quantification.html))。
- en: The dataset uses hospital electric load data from a San Francisco hospital electric
    load dataset ([https://github.com/ourownstory/neuralprophet-data](https://github.com/ourownstory/neuralprophet-data)).
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 该数据集使用旧金山医院电力负荷数据集的电力负荷数据([https://github.com/ourownstory/neuralprophet-data](https://github.com/ourownstory/neuralprophet-data))。
- en: 'Let’s look at the header of the dataset:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看数据集的标题：
- en: '![Figure 8.6 – San Francisco hospital load dataset](img/B19925_08_06.jpg)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![图8.6 – 旧金山医院负荷数据集](img/B19925_08_06.jpg)'
- en: Figure 8.6 – San Francisco hospital load dataset
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.6 – 旧金山医院负荷数据集
- en: '`NeuralProphet` requires the data in the specific format with a time column
    named *ds* and time series values in a column called *y*.'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '`NeuralProphet`需要以特定格式提供数据，其中包含名为*ds*的时间列和名为*y*的时间序列值。'
- en: 'Let’s create a `NeuralProphet` object that specifies a data splitting ratio
    between 0 and 1:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建一个`NeuralProphet`对象，指定0到1之间的数据分割比率：
- en: '[PRE3]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'By default, `NeuralProphet`’s forecasting provides a singular output: a point
    estimate for each instance. This estimate is derived from a 50th percentile regression.
    A `NeuralProphet` object requires at least one upper and lower quantile pair as
    its parameters to establish a PI. Yet, within a `NeuralProphet` model, we can
    define multiple quantiles as desired.'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`NeuralProphet`的预测提供单一输出：每个实例的点估计。此估计是从50%分位数回归中得出的。`NeuralProphet`对象需要至少一个上分位数和下分位数对作为其参数以建立置信区间。然而，在`NeuralProphet`模型中，我们可以根据需要定义多个分位数。
- en: For example, say we want to forecast a hospital’s electric load with 90% PIs.
    We want 90% of the actual values to fall within the generated intervals.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设我们想要使用90%置信区间来预测医院的电力负荷。我们希望90%的实际值落在生成的区间内。
- en: 'We could train a quantile regression model to predict three quantiles – the
    5th, 50th, and 95th percentiles. The 5th and 95th quantiles would provide the
    lower and upper bounds for 90% PIs. The 50th quantile would provide the median
    point forecast:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以训练一个分位数回归模型来预测三个分位数——第5个、第50个和第95个分位数。第5个和第95个分位数将提供90%置信区间的下限和上限。第50个分位数将提供中位数预测点：
- en: '[PRE5]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Quantile regression is used in `NeuralProphet` to generate PIs. It trains the
    model using a specialized loss function called pinball loss, also known as quantile
    loss.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 分位数回归在`NeuralProphet`中用于生成置信区间。它使用一个称为pinball loss（也称为分位数损失）的专用损失函数来训练模型。
- en: Unlike simple error minimization, pinball loss weights errors asymmetrically
    based on the quantile. Under-prediction is penalized more heavily than over-prediction
    for an upper quantile such as 90%. The opposite is valid for a lower quantile,
    such as 10%.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 与简单的误差最小化不同，弹珠损失函数根据分位数不对称地加权误差。对于像90%这样的上分位数，低估比高估受到更重的惩罚。对于像10%这样的下分位数，情况正好相反。
- en: This matches the inherent meaning of the quantile – 90% indicates we expect
    90% of the actual values to lie below the prediction. So, errors where the actual
    value exceeds the forecast violate that more significantly.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 这与分位数的内在含义相匹配 – 90%表示我们预计90%的实际值将低于预测值。因此，实际值超过预测值的误差违反了这一点。
- en: By minimizing the asymmetric pinball loss during training, the model learns
    quantile lines that reflect the appropriate probability of actual values falling
    above or below based on the data. The upper and lower quantiles then form the
    PI.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在训练过程中最小化不对称的弹珠损失，模型学习到反映实际值根据数据落在上方或下方的适当概率的分位数线。然后上下分位数形成预测区间。
- en: 'We can now fit the model and create a DataFrame with the results, forecasting
    30 periods:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以拟合模型并创建一个包含结果的DataFrame，预测30个周期：
- en: '[PRE9]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '[PRE11]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'We can visualize the PIs from quantile regression using a plot. The solid line
    shows the median forecast, while the shaded area depicts the interval between
    the lower and upper quantile lines. This represents the range expected to contain
    the actual values with the specified confidence level:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用图表来可视化分位数回归的预测区间。实线表示中位数预测，而阴影区域表示下分位数线和上分位数线之间的区间。这代表在指定的置信水平下预期包含实际值的范围：
- en: '![Figure 8.7 – Forecasting hospital electric load using quantile regression](img/B19925_08_07.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![图8.7 – 使用分位数回归预测医院电力负荷](img/B19925_08_07.jpg)'
- en: Figure 8.7 – Forecasting hospital electric load using quantile regression
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.7 – 使用分位数回归预测医院电力负荷
- en: In summary, quantile regression allows `NeuralProphet` to generate PIs by training
    the model to forecast quantiles that serve as interval bounds. The pinball loss
    function enables quantile-based UQ.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，分位数回归允许 `NeuralProphet` 通过训练模型来预测作为区间边界的分位数来生成预测区间（PI）。弹珠损失函数使得基于分位数的不确定性量化（UQ）成为可能。
- en: Quantile regression relies on modeling assumptions and requires specifying the
    quantiles of interest. Next, we’ll explore how `NeuralProphet` can produce distribution-free
    PIs using conformal prediction techniques.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 分位数回归依赖于建模假设，并需要指定感兴趣的分位数。接下来，我们将探讨 `NeuralProphet` 如何使用符合预测技术产生无分布的预测区间（PI）。
- en: Conformal prediction in NeuralProphet
  id: totrans-185
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: NeuralProphet中的符合预测
- en: '`NeuralProphet` employs the split conformal prediction method. This approach
    necessitates a holdout or calibration set. The dataset must be divided into three
    sets to execute split conformal prediction: training, calibration, and testing.
    An initial PI is established using the model trained on the training dataset.
    Uncertainty is then gauged by comparing the calibration set’s target variables
    with the predicted values. This quantified uncertainty is subsequently incorporated
    into both ends of the prediction value to form the final conformal PI.'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 采用拆分符合预测方法。这种方法需要保留一个或校准集。为了执行拆分符合预测，数据集必须分为三个集合：训练集、校准集和测试集。使用训练数据集训练的模型建立初始PI。然后通过比较校准集的目标变量与预测值来评估不确定性。这种量化的不确定性随后被纳入预测值的两端，形成最终的符合预测区间。'
- en: Within `NeuralProphet`, you can choose either the naïve (based on the absolute
    residual) or CQR for conformal prediction.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `NeuralProphet` 中，您可以选择基于绝对残差的朴素方法或CQR进行符合预测。
- en: 'Add a calibration set using the data splitting function:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 使用数据拆分函数添加一个校准集：
- en: '[PRE12]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: You can build any `NeuralProphet` model you deem fit as the base model. The
    calibration process in conformal prediction would be later added to the base model
    to quantify the uncertainty in our final estimation. We are interested in knowing
    how conformal prediction affects different models.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以构建任何您认为合适的 `NeuralProphet` 模型作为基础模型。符合预测中的校准过程将随后添加到基础模型中，以量化最终估计中的不确定性。我们感兴趣的是了解符合预测如何影响不同的模型。
- en: In our example, we will compare the conformal prediction results between a simple
    quantile regression and a complex four-layer autoregression model in our illustration.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的例子中，我们将比较简单分位数回归和复杂四层自回归模型在我们的图示中的符合预测结果。
- en: 'We will specify 72 hours as lags and create a simple quantile regression model
    as base model 1\. We will also create a four-layer autoregression model as base
    model 2:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将指定 72 小时作为滞后时间，并创建一个简单的分位数回归模型作为基础模型 1。我们还将创建一个四层自回归模型作为基础模型 2：
- en: '[PRE13]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '[PRE14]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '[PRE15]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[PRE16]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '[PRE17]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '[PRE18]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '[PRE20]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '[PRE21]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '[PRE22]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[PRE23]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '[PRE24]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '[PRE25]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: After configuring the model, we must fit the model with the train set. Suppose
    you have further split the training dataset into training and validation. In that
    case, you can either concatenate the two datasets in one dataset for training
    or assign the training and validation datasets as two separate parameters.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置模型后，我们必须使用训练集拟合模型。假设您已经将训练数据集进一步分为训练集和验证集。在这种情况下，您可以将两个数据集连接为一个数据集进行训练，或者将训练集和验证集作为两个单独的参数分配。
- en: 'Feed the training subset in the configured `NeuralProphet` models. Then, configure
    the hourly frequency by assigning `H` to the `freq` parameter:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 将配置的 `NeuralProphet` 模型中的训练子集输入。然后，通过将 `H` 分配给 `freq` 参数来配置每小时频率：
- en: '[PRE26]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '[PRE28]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '[PRE29]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Let’s use the fitted base model to forecast both the point prediction and the
    quantile regression PIs for the testing dataset:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用拟合的基础模型来预测测试数据集的点预测和分位数回归 PI：
- en: '[PRE30]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '[PRE31]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Option 1 – naïve conformal prediction
  id: totrans-215
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 选项 1 – 天真一致性预测
- en: 'After training the base model, we can carry out the calibration process using
    the naïve module. The steps are as follows:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 在训练基础模型后，我们可以使用天真模块进行校准过程。步骤如下：
- en: Predict the output value of the instances within the calibration set.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 预测校准集中实例的输出值。
- en: Calculate the absolute residual by comparing the actual and predicted values
    for each observation in the calibration set.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过比较校准集中每个观测值的实际值和预测值来计算绝对残差。
- en: Sort all residuals in ascending order.
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将所有残差按升序排序。
- en: Find the quantile of the distribution of the absolute residuals with the desired
    confidence level.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用所需置信水平找到绝对残差分布的分位数。
- en: Use the quantile of the distribution of the absolute residuals to make the final
    PIs.
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用绝对残差的分布的分位数来制作最终的 PIs。
- en: 'Returning to our example, we need to denote the parameter value for the calibration
    set and the significant level (alpha) for conformal prediction on top of our pre-trained
    models:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 返回到我们的例子，我们需要在预训练模型之上表示校准集的参数值和一致性预测的显著性水平（α）：
- en: '[PRE32]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '[PRE33]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: We can now enable conformal prediction using pre-trained models.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以使用预训练模型启用一致性预测。
- en: '[PRE34]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '[PRE35]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '[PRE36]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '[PRE37]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '[PRE38]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: '[PRE39]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '[PRE40]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: '[PRE41]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '[PRE42]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '[PRE43]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '[PRE44]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '[PRE45]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '[PRE46]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '[PRE47]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: '[PRE48]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '[PRE49]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: '`NeuralProphet` can plot the one-sided interval width versus the selected confidence
    level:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: '`NeuralProphet` 可以绘制单侧区间宽度与所选置信水平的关系图：'
- en: '![Figure 8.8 – The one-side interval width versus the confidence level](img/B19925_08_08.jpg)'
  id: totrans-243
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.8 – 单侧区间宽度与置信水平的关系](img/B19925_08_08.jpg)'
- en: Figure 8.8 – The one-side interval width versus the confidence level
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.8 – 单侧区间宽度与置信水平的关系
- en: This plot demonstrates how the width of the PI changes with different confidence
    levels (1-alpha).
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 此图展示了 PI 的宽度如何随着不同的置信水平（1-α）而变化。
- en: Option 2 – CQR
  id: totrans-246
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 选项 2 – CQR
- en: 'CQR operates in the following manner within the CQR module:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: CQR 在 CQR 模块中按以下方式运行：
- en: Non-conformity scores are computed as the disparities between data points from
    the calibration dataset and their closest prediction quantile. These scores offer
    insight into the fit of the data to the existing quantile regression model. Data
    points within the quantile regression interval yield negative non-conformity scores,
    while those outside the interval produce positive scores.
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 非一致性分数是校准数据集中的数据点与其最近的预测分位数之间的差异。这些分数提供了对数据与现有分位数回归模型拟合程度的洞察。位于分位数回归区间内的数据点产生负的非一致性分数，而位于区间外的数据点产生正分数。
- en: The non-conformity scores are then organized in order.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 非一致性分数随后按顺序组织。
- en: The alpha value is determined so that a fraction of the scores greater than
    alpha matches the error rate.
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: α 值被确定，使得大于 α 的分数中的一部分与错误率相匹配。
- en: An amount of alpha adjusts the regression model’s quantiles.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: α 量调整回归模型的分位数。
- en: Based on alpha’s value, the CQR model can be interpreted in two ways.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 根据α的值，CQR模型可以有两种解释方式。
- en: When the one-sided PI width adjustment is positive, the CQR expands beyond the
    QR intervals. This suggests that the CQR perceives the QR interval as overly confident.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 当单侧 PI 宽度调整值为正时，CQR 超出 QR 间隔。这表明 CQR 认为QR 间隔过于自信。
- en: On the other hand, if the adjustment is negative, the CQR narrows the QR intervals,
    indicating that the QR interval might be overly cautious.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果调整值为负，CQR 会缩小 QR 间隔，这表明 QR 间隔可能过于谨慎。
- en: 'We can run the CQR option using the following code:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用以下代码运行CQR选项：
- en: '[PRE50]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: '[PRE51]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: '[PRE52]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: '[PRE53]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '[PRE54]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '[PRE55]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: '[PRE56]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Again, we can plot the PIs to examine how this CQR method affects the result:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，我们可以绘制PI来检查这种CQR方法如何影响结果：
- en: '![Figure 8.9 – Forecasting hospital electric load using quantile regression
    (the CQR option)](img/B19925_08_09.jpg)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![图8.9 – 使用分位数回归预测医院电力负荷（CQR选项）](img/B19925_08_09.jpg)'
- en: Figure 8.9 – Forecasting hospital electric load using quantile regression (the
    CQR option)
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.9 – 使用分位数回归预测医院电力负荷（CQR选项）
- en: We can see that `NeuralProphet` has produced excellent PIs using conformal prediction
    with the `cqr` option.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，`NeuralProphet`使用`cqr`选项进行一致性预测，已经产生了优秀的PI。
- en: Now, let’s learn how to evaluate performance and obtain some insights by comparing
    various UQ methods we have used.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们学习如何通过比较我们使用的各种不确定性量化方法来评估性能并获得一些见解。
- en: 'We are using the interval width and miscoverage rate as the performance metrics:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用区间宽度和误覆盖率作为性能指标：
- en: '`interval_width`: This is the average PI, or `q_hat`, multiplied by two because
    it is static or non-adaptive; this is also known as the **efficiency metric**'
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`interval_width`: 这是平均PI，或`q_hat`，乘以二，因为它是不变的或非自适应的；这也被称为**效率指标**'
- en: '`miscoverage_rate`: This is the actual miscoverage error rate on the OOS test
    set; this is also known as the **validity metric**'
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`miscoverage_rate`: 这是在OOS测试集上的实际误覆盖错误率；这也被称为**有效性指标**'
- en: 'Let’s evaluate the models we trained earlier. Based on the results in the notebook,
    we obtain the following conclusions:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们评估我们之前训练的模型。根据笔记本中的结果，我们得出以下结论：
- en: Quantile regression does not provide the required coverage
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分位数回归无法提供所需的覆盖范围
- en: The more complex the underlying model, the more accurate it is, hence the lower
    *interval width* of CP intervals
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础模型越复杂，其准确性就越高，因此CP区间的**区间宽度**就越低
- en: For the default model, CQR outputs a narrower *PI width* than naïve
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于默认模型，CQR输出的PI宽度比朴素方法窄
- en: Conformal prediction with Nixtla
  id: totrans-275
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用Nixtla进行一致性预测
- en: We will use the notebook at https://github.com/PacktPublishing/Practical-Guide-to-Applied-Conformal-Prediction/blob/main/Chapter_08_NixtlaStatsforecast.ipynb
    to illustrate how to use conformal prediction to create PIs for popular statistic
    and econometrics models.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用位于https://github.com/PacktPublishing/Practical-Guide-to-Applied-Conformal-Prediction/blob/main/Chapter_08_NixtlaStatsforecast.ipynb的笔记本来说明如何使用一致性预测为流行的统计和计量经济学模型创建PI。
- en: 'We will use the hourly dataset from the M4 Competition:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用M4竞赛的小时数据集：
- en: 'First, let’s install Nixtla’s `statsforecast`:'
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '首先，让我们安装Nixtla的`statsforecast`:'
- en: '[PRE57]'
  id: totrans-279
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Then, we must import the necessary modules, including specifically Nixtla’s
    modules:'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们必须导入必要的模块，包括特别是Nixtla的模块：
- en: '[PRE58]'
  id: totrans-281
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '[PRE59]'
  id: totrans-282
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: '[PRE60]'
  id: totrans-283
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: '[PRE61]'
  id: totrans-284
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: '[PRE62]'
  id: totrans-285
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: '[PRE63]'
  id: totrans-286
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: '[PRE64]'
  id: totrans-287
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '[PRE65]'
  id: totrans-288
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: '[PRE66]'
  id: totrans-289
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: '[PRE67]'
  id: totrans-290
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'Next, we must load the train and test datasets:'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们必须加载训练和测试数据集：
- en: '[PRE68]'
  id: totrans-292
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE68]'
- en: '[PRE69]'
  id: totrans-293
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Let’s look at the dataset’s structure. Similar to `NeuralProphet`, `statsforecast`
    requires columns to be named in a specific way:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们看看数据集的结构。类似于`NeuralProphet`，`statsforecast`要求列以特定的方式命名：
- en: '![Figure 8.10 – Hourly dataset from the M4 Competition](img/B19925_08_10.jpg)'
  id: totrans-295
  prefs: []
  type: TYPE_IMG
  zh: '![图8.10 – M4竞赛的小时数据集](img/B19925_08_10.jpg)'
- en: Figure 8.10 – Hourly dataset from the M4 Competition
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.10 – M4竞赛的小时数据集
- en: 'We can now train the models; we will only use the first eight series of the
    dataset to reduce the total computational time:'
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以训练模型了；我们将只使用数据集的前八个序列来减少总计算时间：
- en: '[PRE70]'
  id: totrans-298
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: '[PRE71]'
  id: totrans-299
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: '[PRE72]'
  id: totrans-300
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'We will get the following output:'
  id: totrans-301
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们将得到以下输出：
- en: '![Figure 8.11 – Hourly series from the M4 Competition](img/B19925_08_11.jpg)'
  id: totrans-302
  prefs: []
  type: TYPE_IMG
  zh: '![图8.11 – M4竞赛的小时序列](img/B19925_08_11.jpg)'
- en: Figure 8.11 – Hourly series from the M4 Competition
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.11 – M4竞赛的小时序列
- en: 'Let’s create a list of models and instantiation parameters. To use these models,
    we need to import them from `statsforecast.models` and then instantiate them.
    Given that we’re working with hourly data, we need to set `seasonal_length=24`
    in the models that require this parameter:'
  id: totrans-304
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们创建一个模型和实例化参数的列表。为了使用这些模型，我们需要从`statsforecast.models`导入它们，然后实例化它们。鉴于我们处理的是小时数据，我们需要在需要此参数的模型中设置`seasonal_length=24`：
- en: '[PRE73]'
  id: totrans-305
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: '[PRE74]'
  id: totrans-306
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE74]'
- en: '[PRE75]'
  id: totrans-307
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE75]'
- en: '[PRE76]'
  id: totrans-308
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE76]'
- en: '[PRE77]'
  id: totrans-309
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE77]'
- en: '[PRE78]'
  id: totrans-310
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE78]'
- en: '[PRE79]'
  id: totrans-311
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'To instantiate a new `StatsForecast` object, we need the following parameters:'
  id: totrans-312
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要实例化一个新的`StatsForecast`对象，我们需要以下参数：
- en: '`df`: The DataFrame that contains the training data.'
  id: totrans-313
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`df`: 包含训练数据的DataFrame。'
- en: '`models`: The list of models defined in the previous step.'
  id: totrans-314
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`models`: 在上一步定义的模型列表。'
- en: '`freq`: A string indicating the frequency of the data. See pandas’ available
    frequencies.'
  id: totrans-315
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`freq`: 一个表示数据频率的字符串。请参阅pandas的可用频率。'
- en: '`n_jobs`: An integer that indicates the number of jobs used in parallel processing.
    Use `-1` to select all cores:'
  id: totrans-316
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`n_jobs`：一个表示并行处理中使用的作业数量的整数。使用`-1`选择所有核心：'
- en: '[PRE80]'
  id: totrans-317
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE80]'
- en: '[PRE81]'
  id: totrans-318
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE81]'
- en: '[PRE82]'
  id: totrans-319
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE82]'
- en: '[PRE83]'
  id: totrans-320
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE83]'
- en: '[PRE84]'
  id: totrans-321
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE84]'
- en: '[PRE85]'
  id: totrans-322
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'Now, we’re ready to generate the point forecasts and the PIs. To do this, we’ll
    use the forecast method, which takes two arguments:'
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们已经准备好生成点预测和预测区间。为此，我们将使用预测方法，该方法接受两个参数：
- en: '`h`: An integer that represents the forecasting horizon. In this case, we’ll
    forecast the next 48 hours.'
  id: totrans-324
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`h`：一个表示预测范围的整数。在这种情况下，我们将预测接下来的48小时。'
- en: '`level`: A list of floats with the confidence levels of the PIs. For example,
    `level=[95]` means that the range of values should include the actual future value
    with a probability of 95%:'
  id: totrans-325
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`level`：一个包含预测区间置信水平的浮点数列表。例如，`level=[95]`意味着值范围应该包含实际未来值，概率为95%：'
- en: '[PRE86]'
  id: totrans-326
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE86]'
- en: '[PRE87]'
  id: totrans-327
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE87]'
- en: '[PRE88]'
  id: totrans-328
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE88]'
- en: '[PRE89]'
  id: totrans-329
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE89]'
- en: 'Now, we can plot the PIs:'
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以绘制预测区间：
- en: '[PRE90]'
  id: totrans-331
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'Here’s the plot for this:'
  id: totrans-332
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 下面是这个的图表：
- en: '![Figure 8.12 – Forecasting hourly series with a seasonal naïve benchmark](img/B19925_08_12.jpg)'
  id: totrans-333
  prefs: []
  type: TYPE_IMG
  zh: '![图8.12 – 使用季节性朴素基准预测每小时序列](img/B19925_08_12.jpg)'
- en: Figure 8.12 – Forecasting hourly series with a seasonal naïve benchmark
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.12 – 使用季节性朴素基准预测每小时序列
- en: Multi-quantile losses and statistical models can provide PIs. Still, the problem
    is that these are uncalibrated, meaning that the actual frequency of observations
    falling within the interval does not align with its confidence level. For example,
    a calibrated 95% PI should contain the actual value in repeated sampling 95% of
    the time. On the other hand, an uncalibrated 95% PI might contain the true value
    only 80% of the time or 99% of the time. In the first case, the interval is too
    narrow and underestimates the uncertainty, while in the second case, it is too
    broad and overestimates the uncertainty.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 多分位数损失和统计模型可以提供预测区间（PIs）。然而，问题是这些（预测区间）未校准，这意味着实际观测值落在区间内的频率与其置信水平不一致。例如，一个校准的95%预测区间应该在实际重复抽样中有95%的时间包含实际值。另一方面，一个未校准的95%预测区间可能只有80%或99%的时间包含真实值。在前一种情况下，区间太窄，低估了不确定性；而在后一种情况下，区间太宽，高估了不确定性。
- en: Statistical methods also often assume normality. Here, we calibrated PIs produced
    by statistical models using conformal prediction. Conformal PIs use cross-validation
    on a point forecaster model to generate the intervals. No prior probabilities
    are needed, and the output is well calibrated. No additional training is required,
    and the model is treated as a black box. The approach is compatible with any model.
    `Statsforecast` now supports conformal prediction on all available models.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 统计方法也经常假设正态性。在这里，我们使用一致性预测校准了统计模型生成的预测区间。一致性预测区间使用交叉验证在点预测模型上生成区间。不需要先验概率，输出是校准良好的。不需要额外的训练，模型被视为黑盒。这种方法与任何模型兼容。`Statsforecast`现在支持所有可用模型的一致性预测。
- en: '`StatsForecast` can train multiple models on different time series efficiently.
    These models can generate probabilistic forecasts, producing point forecasts and
    PIs. For this example, we’ll use `SimpleExponentialSmoothing` and ADIDA (a model
    for intermittent demand), which do not provide a PI natively. Thus, using conformal
    prediction to generate the PI makes sense. We’ll also show how to use it with
    ARIMA to provide PIs that don’t assume normality.'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: '`StatsForecast`可以高效地对不同的时间序列训练多个模型。这些模型可以生成概率预测，产生点预测和预测区间。在这个例子中，我们将使用`SimpleExponentialSmoothing`和ADIDA（一个间歇性需求模型），这些模型本身不提供预测区间。因此，使用一致性预测生成预测区间是有意义的。我们还将展示如何使用ARIMA提供不假设正态性的预测区间。'
- en: 'To use these models, we first need to import them from `statsforecast.models`,
    after which we need to instantiate them, as follows:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用这些模型，我们首先需要从`statsforecast.models`导入它们，然后需要实例化它们，如下所示：
- en: '[PRE91]'
  id: totrans-339
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: '[PRE92]'
  id: totrans-340
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: '[PRE93]'
  id: totrans-341
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: '[PRE94]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: '[PRE95]'
  id: totrans-343
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: '[PRE96]'
  id: totrans-344
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: '[PRE97]'
  id: totrans-345
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: '[PRE98]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: '[PRE99]'
  id: totrans-347
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: '[PRE100]'
  id: totrans-348
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: '[PRE101]'
  id: totrans-349
  prefs: []
  type: TYPE_PRE
  zh: '[PRE101]'
- en: '[PRE102]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE102]'
- en: '[PRE103]'
  id: totrans-351
  prefs: []
  type: TYPE_PRE
  zh: '[PRE103]'
- en: 'Let’s plot the forecasts that are produced using conformal prediction for ARIMA:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们绘制使用一致性预测生成的ARIMA预测区间：
- en: '![Figure 8.13 – PIs produced for ARIMA using conformal prediction](img/B19925_08_13.jpg)'
  id: totrans-353
  prefs: []
  type: TYPE_IMG
  zh: '![图8.13 – 使用一致性预测生成的ARIMA预测区间](img/B19925_08_13.jpg)'
- en: Figure 8.13 – PIs produced for ARIMA using conformal prediction
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.13 – 使用一致性预测生成的ARIMA预测区间
- en: This section explored implementations of conformal prediction for time series
    forecasting in several popular open source libraries.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 本节探讨了在几个流行的开源库中实现一致性预测用于时间序列预测的方法。
- en: Amazon Fortuna provides conformal prediction capabilities through its EnbPI
    module. This allows us to generate non-parametric PIs by wrapping any ensemble
    model with bootstrap resampling. We saw how EnbPI leverages an ensemble to approximate
    the forecast distribution without assumptions.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Fortuna 通过其 EnbPI 模块提供了共形预测功能。这使我们能够通过将任何集成模型与自助重采样包装起来来生成非参数 PI。我们看到了
    EnbPI 如何利用集成来近似预测分布而不做假设。
- en: Nixtla, an open source library for time series modeling, includes conformal
    prediction functions for forecasting tasks. We examined how its CP module can
    take any underlying model and add conformal PIs. Nixtla also supports online conformal
    prediction for adaptive intervals.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: Nixtla，一个用于时间序列建模的开源库，包括用于预测任务的共形预测函数。我们考察了其 CP 模块如何将任何底层模型转换为添加共形 PI。Nixtla
    还支持在线共形预测以适应区间。
- en: Finally, `NeuralProphet` natively integrates conformal prediction and quantile
    regression to quantify uncertainty. We examined its ICP approach, which uses a
    calibration set to refine initial intervals. This generates valid prediction regions
    without relying on distributional assumptions.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，`NeuralProphet` 本地集成了共形预测和分位数回归来量化不确定性。我们考察了其 ICP 方法，该方法使用校准集来细化初始区间。这在不依赖分布假设的情况下生成了有效的预测区域。
- en: By incorporating conformal prediction, these libraries make robust and accessible
    UQ available to time series forecasters in Python. The diversity of implementations
    demonstrates the flexibility of conformal prediction as a model-agnostic framework
    that can be applied to any forecasting method.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 通过整合共形预测，这些库使得鲁棒且易于访问的不确定性量化（UQ）在 Python 中的时间序列预测者中变得可用。实现方式的多样性展示了共形预测作为一个模型无关框架的灵活性，它可以应用于任何预测方法。
- en: Summary
  id: totrans-360
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: This chapter taught you how to apply conformal prediction to time series forecasting.
    Conformal prediction is a powerful technique for crafting PIs for point forecasting
    models.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 本章教给你如何将共形预测应用于时间序列预测。共形预测是构建点预测模型预测区间（PIs）的一种强大技术。
- en: This chapter also offered insights into how to harness this method using open
    source platforms.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 本章还提供了如何利用开源平台来运用这一方法的见解。
- en: We began by exploring UQ in a time series, delving into the significance of
    PIs, and showcasing various strategies to generate them.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从探索时间序列中的不确定性量化开始，深入探讨了预测区间的重要性，并展示了生成它们的各种策略。
- en: The concept of conformal prediction and its application in forecasting scenarios
    was central to this chapter. At this point, you are equipped with the knowledge
    to apply these methodologies in real-world settings, empowering your forecasting
    models with precise uncertainty bounds. Adding confidence measures to predictions
    ensures that the forecasts are accurate and reliable.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 共形预测的概念及其在预测场景中的应用是本章的核心。到这一点，你已经拥有了将这些方法应用于现实世界设置的知识，这将为你的预测模型提供精确的不确定性界限。将置信度度量添加到预测中确保了预测的准确性和可靠性。
- en: With a solid understanding of conformal prediction for time series, we will
    now focus on another critical application area – computer vision.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 对于时间序列的共形预测有了扎实的理解之后，我们现在将聚焦于另一个关键应用领域——计算机视觉。

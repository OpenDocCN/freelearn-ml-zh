- en: '*Chapter 9*: Suggesting the Right Product by Using Matrix Factorization'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第9章*：通过矩阵分解建议合适的产品'
- en: Suggesting the right product is one of the most common applications of **Machine
    Learning** (**ML**). Every day, product recommendation systems influence our choices
    on the internet. Newsletters, e-commerce websites, video streaming companies,
    and many other services leverage this powerful ML technique to offer us meaningful
    suggestions about the products that we may buy or like.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 建议合适的产品是**机器学习**（**ML**）最常见应用之一。每天，产品推荐系统影响着我们在互联网上的选择。新闻通讯、电子商务网站、视频流媒体公司以及许多其他服务利用这种强大的ML技术，为我们提供有关可能购买或喜欢的产品的有意义建议。
- en: In this chapter, with a hands-on and practical approach, we'll execute the main
    implementation steps to build a new recommendation engine using the matrix factorization
    algorithm.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将以实际操作和实用性的方法，执行构建新推荐引擎的主要实现步骤，该引擎使用矩阵分解算法。
- en: 'With a gradual and incremental approach and by leveraging BigQuery ML, we''ll
    cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 通过逐步和增量方法，利用BigQuery ML，我们将涵盖以下主题：
- en: Introducing the business scenario
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: Discovering matrix factorization
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现矩阵分解
- en: Configuring BigQuery Flex Slots
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置BigQuery Flex Slots
- en: Exploring and preparing the dataset
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索和准备数据集
- en: Training the matrix factorization model
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 训练矩阵分解模型
- en: Evaluating the matrix factorization model
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估矩阵分解模型
- en: Using the matrix factorization model
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用矩阵分解模型
- en: Drawing business conclusions
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提出业务结论
- en: Technical requirements
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter requires that you have access to a web browser and can leverage
    the following:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章要求您能够访问网络浏览器，并利用以下资源：
- en: A GCP account to access the Google Cloud Console.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP账户来访问Google Cloud控制台。
- en: A GCP project to host the BigQuery datasets.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP项目来托管BigQuery数据集。
- en: BigQuery Flex slots to train matrix factorization models in BigQuery ML. The
    training for these kinds of algorithms is only available to flat-rate customers
    or customers with reservations. If you're using BigQuery with its on-demand pricing,
    we'll show you how to use BigQuery Flex Slots.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BigQuery Flex slots用于在BigQuery ML中训练矩阵分解模型。这类算法的训练仅适用于固定价格客户或预留客户。如果您使用的是按需定价的BigQuery，我们将向您展示如何使用BigQuery
    Flex Slots。
- en: Now that the technical requirements are clear, let's look at our use case about
    the BigQuery ML matrix factorization model.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 现在技术要求已经明确，让我们看看关于BigQuery ML矩阵分解模型的使用案例。
- en: Introducing the business scenario
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: Imagine being a business analyst that works for the Google Merchandise e-commerce
    store. The website sells different Google-branded products to different users.
    Some of the users are registered and have their own identifier, and their clickstream
    activities are collected in a specific dataset.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，你是一名为Google商品电子商务店工作的商业分析师。该网站向不同用户销售不同的谷歌品牌产品。一些用户已注册并有自己的标识符，他们的点击流活动收集在特定的数据集中。
- en: Important note
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: '**Clickstream data** is the digital footprint left by users navigating a specific
    website. This data typically includes the web pages they visited, the time they
    spent on each page, the device they used, the origin of the traffic, and other
    relevant information.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '**点击流数据**是用户在特定网站上导航时留下的数字足迹。这些数据通常包括他们访问的网页、在每个页面上花费的时间、使用的设备、流量来源以及其他相关信息。'
- en: In this scenario, the data is collected by Google using **Google Analytics 360**
    from the Google Merchandise e-commerce portal. This tool can be integrated with
    any website and allows us to gather information about the users' behavior on each
    page of the portal for further analysis and analytics.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个场景中，数据是通过Google从Google商品电子商务门户使用**Google Analytics 360**收集的。这个工具可以集成到任何网站，并允许我们收集有关门户中每个页面上用户行为的详细信息，以便进行进一步分析和分析。
- en: 'The following screenshot is of the Google Merchandise Store, which sells Google-branded
    gadgets:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图是Google商品店，该店销售谷歌品牌的设备：
- en: '![Figure 9.1 – A screenshot of the Google Merchandise Store'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '![图9.1 – Google商品店的截图'
- en: '](img/B16722_09_001.jpg)'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_09_001.jpg)'
- en: Figure 9.1 – A screenshot of the Google Merchandise Store
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.1 – Google商品店的截图
- en: For our business scenario, we will imagine that our manager is asking us to
    build a new recommendation engine that can improve the user experience of their
    customers, as well as the revenues of their e-commerce sales.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的业务场景，我们将设想我们的经理要求我们构建一个新的推荐引擎，以提高客户的使用体验以及他们的电子商务销售额。
- en: Our goal is to develop a ML model that selects the right product to suggest
    for each customer who's registered on the website. To achieve this goal, we will
    use the clickstream data from the Google Merchandise Store that has already been
    collected and published in a BigQuery public dataset.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标是开发一个机器学习模型，为在网站上注册的每位客户推荐合适的产品。为了实现这一目标，我们将使用已经收集并发布在BigQuery公共数据集中的Google商品店点击流数据。
- en: As business analysts, our job is to analyze the data, build an effective recommendation
    engine, and use it on the existing data to provide meaningful information to the
    marketing team.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 作为业务分析师，我们的工作是分析数据，构建一个有效的推荐引擎，并使用现有数据向营销团队提供有意义的见解。
- en: Now that we've explained and understood the business scenario, let's take a
    look at the ML technique that we will use to build a recommendation engine for
    our e-commerce portal.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经解释并理解了业务场景，让我们来看看我们将用于构建电子商务门户推荐引擎的机器学习技术。
- en: Discovering matrix factorization
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发现矩阵分解
- en: In this section, we'll learn what **matrix factorization** is, and how it can
    be used to build recommendation engines.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习什么是**矩阵分解**，以及它是如何被用来构建推荐引擎的。
- en: '**Matrix factorization** represents a class of algorithms usually used to build
    recommendation engines. These algorithms are built on matrices that represent
    the interactions between users and items. In these kinds of matrices, the following
    occurs:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '**矩阵分解**代表了一类通常用于构建推荐引擎的算法。这些算法建立在表示用户和项目之间交互的矩阵上。在这些类型的矩阵中，以下情况会发生：'
- en: Each user or customer is represented as a row.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个用户或客户都由一行表示。
- en: Each item or product corresponds to a column of the matrix.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个项目或产品对应于矩阵的一列。
- en: 'Each cell of the matrix is filled with a numeric value: the **feedback**.'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 矩阵的每个单元格都填充了一个数值：**反馈**。
- en: This **feedback** represents a rating that a specific user has given to a specific
    item.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 这种**反馈**代表了一个特定用户对特定项目的评分。
- en: 'In the following screenshot, we can see an example of a matrix where the rows
    are the customers of a video streaming service and the columns are the films offered
    by the platform. Some of the cells contain a rating that ranges from **1** to
    **5**:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，我们可以看到一个矩阵的例子，其中行是视频流服务的客户，列是平台提供的电影。一些单元格包含一个从**1**到**5**的评分：
- en: '![Figure 9.2 – Representation of a recommendation matrix'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '![图9.2 – 推荐矩阵的表示'
- en: '](img/B16722_09_002.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_09_002.jpg]'
- en: Figure 9.2 – Representation of a recommendation matrix
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.2 – 推荐矩阵的表示
- en: In this example, we can say that **User 1** has expressed an average rating
    for the film **The Shining**, but disliked **Titanic**. On the other hand, **User
    4** assigned the maximum rating to **Titanic**, but didn't rate the other films.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们可以说**用户1**对电影**闪灵**给出了平均评分，但对**泰坦尼克号**不喜欢。另一方面，**用户4**对**泰坦尼克号**给出了最高评分，但没有对其他电影进行评分。
- en: 'According to different business scenarios, this feedback can be considered
    explicit or implicit:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 根据不同的业务场景，这种反馈可以被考虑为明确的或隐式的：
- en: '**Explicit feedback** is available when the user voluntarily rates a specific
    item, such as on a review website.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当用户自愿对特定项目进行评分时，例如在评论网站上，就有**明确的反馈**。
- en: If explicit feedback is not available, **implicit feedback** can be calculated
    and inferred by the developer of the recommendation system. For example, if a
    customer has bought a product, we can assume they would give positive feedback
    for that item.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果没有明确的反馈，推荐系统的开发者可以通过**隐式反馈**进行计算和推断。例如，如果客户购买了一个产品，我们可以假设他们会为该商品给出积极的反馈。
- en: Often, in e-commerce data, feedback is not explicitly given by the users but
    can be extracted from other information that's collected in the process, such
    as the number of clicks, the time spent on a specific page, or the quantity of
    a specific product bought by the user.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在电子商务数据中，用户往往不会明确给出反馈，但可以从收集过程中的其他信息中提取，例如点击次数、在特定页面上的时间或用户购买特定产品的数量。
- en: 'Matrix factorization algorithms are widely used in real-life scenarios. Some
    examples are as follows:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 矩阵分解算法在现实场景中得到广泛应用。以下是一些例子：
- en: The suggested books that we see in an online bookshop.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在在线书店中看到的推荐书籍。
- en: The recommended TV series that we can see on video streaming services.
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以在视频流服务中看到的推荐电视剧。
- en: The posts that are highlighted in our social media feeds.
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在我们的社交媒体动态中突出显示的帖子。
- en: The products suggested by internet advertising systems.
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网广告系统推荐的商品。
- en: In this section, we learned about the basics of matrix factorization. Now, let's
    configure BigQuery Flex Slots.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了矩阵分解的基础知识。现在，让我们配置BigQuery Flex槽位。
- en: Configuring BigQuery Flex Slots
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置BigQuery Flex槽位
- en: In this chapter, we'll understand how to configure BigQuery **Flex Slots** to
    train our ML model.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将了解如何配置BigQuery **Flex槽位**以训练我们的机器学习模型。
- en: A BigQuery **Slot** is a unit of BigQuery analytics capacity that's used to
    execute SQL queries and train BigQuery ML models. One BigQuery slot represents
    the compute capacity of a **Virtual Compute Processing Unit** (**VCPU**).
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: BigQuery **槽位**是BigQuery分析能力的单位，用于执行SQL查询和训练BigQuery ML模型。一个BigQuery槽位代表一个**虚拟计算处理单元**（**VCPU**）的计算能力。
- en: '**Flex Slots** allow us to buy BigQuery analytics capacity for short periods.
    They are usually used to quickly satisfy sudden demands for resources with a minimum
    duration of 60 seconds.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**Flex槽位**允许我们在短时间内购买BigQuery分析能力。它们通常用于快速满足至少持续60秒的资源突发需求。'
- en: Enabling Flex Slots is mandatory to train a matrix factorization model; otherwise,
    BigQuery will return an error during the training stage.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 启用Flex槽位是训练矩阵分解模型所必需的；否则，BigQuery将在训练阶段返回错误。
- en: 'Let''s see how we can enable BigQuery Flex Slots if we''re using an on-demand
    plan:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如果我们使用按需计划，我们如何启用BigQuery Flex槽位：
- en: If you haven't enabled BigQuery Reservations yet, we need to access **Reservations**
    from the BigQuery menu on the left:![Figure 9.3 – Accessing Reservations from
    the BigQuery navigation menu
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您尚未启用BigQuery预订，我们需要从左侧的BigQuery菜单访问**预订**：![图9.3 – 从BigQuery导航菜单访问预订
- en: '](img/B16722_09_003.jpg)'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_09_003.jpg)'
- en: Figure 9.3 – Accessing Reservations from the BigQuery navigation menu
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图9.3 – 从BigQuery导航菜单访问预订
- en: Click on the **BUY SLOTS** button to initialize the buying process for BigQuery
    Flex Slots:![Figure 9.4 – Screenshot of the Reservations page
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**购买槽位**按钮以初始化BigQuery Flex槽位的购买过程：![图9.4 – 预订页面截图
- en: '](img/B16722_09_004.jpg)'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_09_004.jpg)'
- en: Figure 9.4 – Screenshot of the Reservations page
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图9.4 – 预订页面截图
- en: Choose the minimum number of Flex Slots to buy; that is, **100**. Then, click
    on the **NEXT** button:![Figure 9.5 – BigQuery Buy Slots process
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择要购买的Flex槽位的最小数量；即**100**。然后，点击**下一步**按钮：![图9.5 – BigQuery购买槽位过程
- en: '](img/B16722_09_005.jpg)'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_09_005.jpg)'
- en: Figure 9.5 – BigQuery Buy Slots process
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图9.5 – BigQuery购买槽位过程
- en: Confirm your choice by writing **CONFIRM** in the confirmation text box and
    clicking on the blue **PURCHASE** button:![Figure 9.6 – Confirming your BigQuery
    Slots purchase
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在确认文本框中写下**CONFIRM**并点击蓝色**购买**按钮来确认您的选择：![图9.6 – 确认您的BigQuery槽位购买
- en: '](img/B16722_09_006.jpg)'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_09_006.jpg)'
- en: Figure 9.6 – Confirming your BigQuery Slots purchase
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图9.6 – 确认您的BigQuery槽位购买
- en: Once the purchase has been confirmed, you can switch to the **ASSIGNMENTS**
    tab to assign the reservation that you've just bought.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦确认购买，您就可以切换到**分配**选项卡来分配您刚刚购买的预订。
- en: On the **ASSIGNMENTS** tab, select your GCP project in the first combo box and
    the reservation of Flex Slots in the second. After that, click the **CREATE**
    button to finalize your configuration:![Figure 9.7 – Assigning BigQuery slots
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**分配**选项卡上，在第一个下拉菜单中选择您的GCP项目，在第二个下拉菜单中选择Flex槽位的预订。然后，点击**创建**按钮以完成您的配置：![图9.7
    – 分配BigQuery槽位
- en: '](img/B16722_09_007.jpg)'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_09_007.jpg)'
- en: Figure 9.7 – Assigning BigQuery slots
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图9.7 – 分配BigQuery槽位
- en: When the assignment is complete, we can go back to the BigQuery home page.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当分配完成时，我们可以返回BigQuery主页。
- en: Important note
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'Warning: Remember to deactivate the reservation of BigQuery slots at the end
    of this use case. Every BigQuery slot costs $0.04 per hour. Forgetting to disable
    this reservation will generate unexpected billing for your GCP project.'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 警告：请记住在本用例结束时禁用BigQuery槽位的预订。每个BigQuery槽位每小时收费0.04美元。忘记禁用此预订将为您的GCP项目产生意外的账单。
- en: In this section, we learned how to buy BigQuery Flex Slots so that we can use
    matrix factorization. Now, we will focus on the data exploration and preparation
    steps.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了如何购买 BigQuery Flex Slots 以便我们可以使用矩阵分解。现在，我们将专注于数据探索和准备步骤。
- en: Exploring and preparing the dataset
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索和准备数据集
- en: In this section, we'll analyze the data we'll use to train our BigQuery ML model
    and apply the data preparation steps.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将分析我们将用于训练 BigQuery ML 模型的数据，并应用数据准备步骤。
- en: Let's start by getting a clear understanding of the Google Analytics data that
    is available in the BigQuery public dataset so that we can build our recommendation
    system.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们先清楚地了解 BigQuery 公共数据集中可用的 Google Analytics 数据，以便我们可以构建我们的推荐系统。
- en: Understanding the data
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解数据
- en: In this section, we'll import the necessary data and then understand the most
    relevant fields of the dataset that will be used to train the BigQuery ML model.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将导入必要的数据，然后理解数据集中将用于训练 BigQuery ML 模型的最相关字段。
- en: 'Before we start developing the ML model, we''ll look at the dataset and its
    schema. To start exploring the dataset, we need to do the following:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始开发机器学习模型之前，我们将查看数据集及其模式。要开始探索数据集，我们需要执行以下操作：
- en: Log into our Google Cloud Console and access the **BigQuery** user interface
    from the navigation menu.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录我们的 Google Cloud Console，并通过导航菜单访问 **BigQuery** 用户界面。
- en: Create a new dataset under the project that we created in [*Chapter 2*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039),
    *Setting Up Your GCP and BigQuery Environment*. For this use case, we'll create
    the `09_recommendation_engine` dataset with the default options.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们创建的项目下创建一个新的数据集，该项目位于 [*第 2 章*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039)，*设置您的
    GCP 和 BigQuery 环境*。对于此用例，我们将使用默认选项创建 `09_recommendation_engine` 数据集。
- en: After that, we need to open the `bigquery-public-data` GCP project, which hosts
    the BigQuery public datasets, and browse the datasets until we find `google_analytics_sample`.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后，我们需要打开托管 BigQuery 公共数据集的 `bigquery-public-data` GCP 项目，并浏览数据集，直到我们找到 `google_analytics_sample`。
- en: The BigQuery public dataset contains multiple tables that host the Google Analytics
    sample data. Each table presents a different suffix according to the year and
    the month that it refers to:![Figure 9.8 – The Google Analytics sample dataset
    containing the ga_sessions tables
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: BigQuery 公共数据集包含多个表，这些表托管着 Google Analytics 示例数据。每个表根据它所引用的年份和月份展示不同的后缀：![图
    9.8 – 包含 ga_sessions 表的 Google Analytics 示例数据集
- en: '](img/B16722_09_008.jpg)'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_09_008.jpg](img/B16722_09_008.jpg)'
- en: Figure 9.8 – The Google Analytics sample dataset containing the ga_sessions
    tables
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 9.8 – 包含 ga_sessions 表的 Google Analytics 示例数据集
- en: We'll use the **ga_sessions** tables to build our matrix factorization model.
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们将使用 **ga_sessions** 表来构建我们的矩阵分解模型。
- en: Tip
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 小贴士
- en: The **ga_sessions** table is not well described, but if we need further information
    about this dataset, we can leverage the examples available in the BigQuery documentation
    at [https://support.google.com/analytics/answer/4419694?hl=en](https://support.google.com/analytics/answer/4419694?hl=en).
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**ga_sessions** 表没有很好地描述，但如果我们需要关于这个数据集的更多信息，我们可以利用 BigQuery 文档中提供的示例，文档链接为
    [https://support.google.com/analytics/answer/4419694?hl=en](https://support.google.com/analytics/answer/4419694?hl=en)。'
- en: 'To simplify the data access process, let''s create a single table that unifies
    all the tables with different suffixes. Let''s execute the following SQL statement:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了简化数据访问过程，让我们创建一个统一的单一表，将所有具有不同后缀的表合并在一起。让我们执行以下 SQL 语句：
- en: '[PRE0]'
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The query creates a new table called `all_ga_sessions` in our `09_recommendation_engine`
    dataset. This table stores all the data that comes from the different `ga_sessions`
    tables into a unique structure. To unify all the records, we've used the wildcard
    character, `*`.
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询创建了一个名为 `all_ga_sessions` 的新表，位于我们的 `09_recommendation_engine` 数据集中。此表将来自不同
    `ga_sessions` 表的所有数据存储到一个独特的结构中。为了统一所有记录，我们使用了通配符字符，`*`。
- en: Tip
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 小贴士
- en: '`ga_sessions_*` tables and placing them in our new structure, `all_ga_sessions`.'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将 `ga_sessions_*` 表放入我们的新结构 `all_ga_sessions` 中。
- en: 'Now, we can simply query `all_ga_sessions` to get a preview of the schema:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以简单地查询 `all_ga_sessions` 以预览其架构：
- en: '[PRE1]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The results of the query point out that the schema of the table is quite complex
    and contains multiple nested fields. Fortunately, for our purposes, we will only
    focus on some of them:'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询结果指出，表的架构相当复杂，包含多个嵌套字段。幸运的是，为了我们的目的，我们只需关注其中的一些：
- en: '`fullVisitorID` represents the identifier of each registered user that is browsing
    Google''s website.'
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`fullVisitorID` 代表每个浏览谷歌网站的注册用户的标识符。'
- en: '`productSku` is the product code that identifies a specific product in Google''s
    catalog. Some examples of products are mugs, T-shirts, bags, and socks.'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`productSku` 是识别 Google 目录中特定产品的产品代码。一些产品的示例包括杯子、T恤、包和袜子。'
- en: The `action_type` column is the action that a user has performed during a web
    session. If this field is equal to `6`, the row represents a specific product
    being purchased by a customer.
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`action_type` 列表示用户在网页会话期间执行的操作。如果此字段等于 `6`，则该行表示客户购买的具体产品。'
- en: Now that we've discovered which columns will be used for our ML model, it's
    time to prepare our training dataset.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经确定了哪些列将用于我们的 ML 模型，现在是时候准备我们的训练数据集了。
- en: Creating the training dataset
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建训练数据集
- en: In this section, we'll create the tables that will host the training data of
    our BigQuery ML model.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将创建将托管我们 BigQuery ML 模型训练数据的表。
- en: To train our model, we'll create a table that will host all the purchases that
    have been made by the registered customers on the website.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 为了训练我们的模型，我们将创建一个表，该表将托管网站上注册客户所进行的所有购买。
- en: 'Let''s create the `product_purchases` table, which contains three fields:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建包含三个字段的 `product_purchases` 表：
- en: 'The code of each user: `fullVisitorId`'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个用户的代码：`fullVisitorId`
- en: 'The identifier of the purchased product: `purchased_product_id`'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 购买产品的标识符：`purchased_product_id`
- en: The `quantity` field, which specifies the product that's been bought by the
    customer
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`quantity` 字段，指定客户购买的产品数量'
- en: 'Execute the following SQL statement to create the table:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下 SQL 语句以创建表：
- en: '[PRE2]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The most internal query extracts all the customers identified by `fullVisitorId`
    from the `all_ga_sessions` table that have at least bought a product on the e-commerce
    portal. To identify these purchases, we've added a `WHERE` clause to `hits.eCommerceAction.action_type
    = '6'`. To get distinct values of `fullVisitorId`, the query leverages the `GROUP
    BY fullVisitorId` clause.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 最内层的查询从 `all_ga_sessions` 表中提取所有通过 `fullVisitorId` 识别的顾客，这些顾客至少在电子商务门户上购买过产品。为了识别这些购买，我们在
    `WHERE` 子句中添加了 `hits.eCommerceAction.action_type = '6'`。为了获取 `fullVisitorId` 的唯一值，查询利用了
    `GROUP BY fullVisitorId` 子句。
- en: In the `FROM` clause of the nested query, we're using the `UNNEST` function
    to extract the nested fields present in the original table and access them.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在嵌套查询的 `FROM` 子句中，我们使用 `UNNEST` 函数提取原始表中存在的嵌套字段并访问它们。
- en: Important note
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: '**UNNEST** is a function that''s used to convert an array into a set of multiple
    rows. It takes an array as input and returns a table with a single row for each
    item in the array.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '**UNNEST** 是一个用于将数组转换为多行集合的函数。它接受一个数组作为输入，并返回一个表，其中每行对应数组中的一个项目。'
- en: 'In the most external query, we simply extract the three fields that are relevant
    to our use case: `fullVisitorId`, `purchased_product_id`, and our total `quantity`.
    This last measure is obtained by using the `SUM` operator on all the transactions
    being performed by a specific user to buy a specific product.'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在最外层的查询中，我们仅提取与我们用例相关的三个字段：`fullVisitorId`、`purchased_product_id` 和我们的总 `quantity`。此最后指标是通过使用
    `SUM` 操作符在特定用户购买特定产品时进行的所有交易获得的。
- en: Now that we've created the table that our recommendation engine will be trained
    on, let's create the BigQuery ML model.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经创建了推荐引擎将训练的表，让我们创建 BigQuery ML 模型。
- en: Training the matrix factorization model
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 训练矩阵分解模型
- en: In this section, we'll train the BigQuery ML matrix factorization model in order
    to build a recommendation system with the e-commerce data that we've already prepared.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将训练 BigQuery ML 矩阵分解模型，以便使用我们已准备好的电子商务数据构建推荐系统。
- en: 'Let''s start training the `purchase_recommender` ML model by executing the
    following SQL statement:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从执行以下 SQL 语句开始训练 `purchase_recommender` ML 模型：
- en: '[PRE3]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The first few lines of the query are composed of the `CREATE OR REPLACE MODEL`
    keywords, followed by the identifier of the new ML model, `` `09_recommendation_engine.purchase_recommender`
    ``, and `OPTIONS`.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 查询的前几行由 `CREATE OR REPLACE MODEL` 关键字组成，后面跟着新 ML 模型的标识符 `` `09_recommendation_engine.purchase_recommender`
    `` 和 `OPTIONS`。
- en: 'Now, let''s focus on the `OPTIONS` values that we''ve used to train our BigQuery
    ML model:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们关注我们用于训练 BigQuery ML 模型的 `OPTIONS` 值：
- en: The model type is `'matrix_factorization'`. This option describes the algorithm
    that we're using to train our recommendation model.
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模型类型是 `'matrix_factorization'`。此选项描述了我们用于训练推荐模型的算法。
- en: The `user_col='fullVisitorID'` option specifies which column represents the
    users of the recommendation engine. In our case, we're using the `fullVisitorID`
    field, which is assigned to the registered customers of the e-commerce portal.
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`user_col=''fullVisitorID''` 选项指定哪个列代表推荐引擎的用户。在我们的案例中，我们使用 `fullVisitorID`
    字段，该字段分配给电子商务门户的注册客户。'
- en: With the `item_col='purchased_product_id'` option, we're using the code of each
    product that's been purchased by our customers to identify each item in our model.
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `item_col='purchased_product_id'` 选项时，我们使用客户购买的产品代码来识别模型中的每个项目。
- en: Since we don't have an explicit rating for our products, we'll choose `feedback_type='implicit'`
    and use the purchased `quantity` value as the rating for our recommendation engine.
    In this case, we're assuming that if a user has bought large quantities of a product,
    they're interested and satisfied with the product.
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于我们没有产品的明确评分，我们将选择 `feedback_type='implicit'` 并使用购买的 `quantity` 值作为推荐引擎的评分。在这种情况下，我们假设如果用户购买了大量的产品，他们对产品感兴趣并且对产品满意。
- en: 'After about 7 minutes, the matrix factorization model will be trained, and
    we can move on to the next stage: the evaluation phase.'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 大约7分钟后，矩阵分解模型将被训练，我们可以进入下一个阶段：评估阶段。
- en: Evaluating the matrix factorization model
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估矩阵分解模型
- en: In this section, we'll evaluate the performances of the matrix factorization
    model that we trained in the previous section.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将评估我们在上一节中训练的矩阵分解模型的性能。
- en: The evaluation stage of a matrix factorization model can be performed using
    the `ML.EVALUATE` BigQuery ML function or through the BigQuery UI.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 矩阵分解模型的评估阶段可以使用 `ML.EVALUATE` BigQuery ML函数或通过BigQuery UI进行。
- en: 'Let''s execute the following query to extract all the evaluation parameters
    that characterize the recommendation model that we''ve just trained:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下查询以提取表征我们刚刚训练的推荐模型的全部评估参数：
- en: '[PRE4]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The result of this query is shown in the following screenshot:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 此查询的结果显示在下图中：
- en: '![Figure 9.9 – The record that''s been extracted from the evaluation of the
    matrix factorization model'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '![图9.9 – 从矩阵分解模型评估中提取的记录'
- en: '](img/B16722_09_009.jpg)'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_09_009.jpg)'
- en: Figure 9.9 – The record that's been extracted from the evaluation of the matrix
    factorization model
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.9 – 从矩阵分解模型评估中提取的记录
- en: The same information can be accessed by selecting the ML model from the BigQuery
    navigation menu and then accessing the **Evaluation** tab.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过从BigQuery导航菜单中选择ML模型，然后访问**评估**选项卡来获取相同的信息。
- en: 'In the following screenshot, you can see the evaluation metrics of the BigQuery
    ML model:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 在下图中，您可以查看BigQuery ML模型的评估指标：
- en: '![Figure 9.10 – The Evaluation tab of the matrix factorization model'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '![图9.10 – 矩阵分解模型的评估选项卡'
- en: '](img/B16722_09_010.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_09_010.jpg)'
- en: Figure 9.10 – The Evaluation tab of the matrix factorization model
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.10 – 矩阵分解模型的评估选项卡
- en: Since the value of **Mean squared error** is very low, we can be satisfied with
    the results that have been achieved by our matrix factorization model.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 由于**均方误差**的值非常低，我们可以对我们的矩阵分解模型所取得的结果感到满意。
- en: In this section, we learned how to access the performance indicators of our
    recommendation model. Now, let's use the recommendation model to find the best
    products to suggest to our customers.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了如何访问我们推荐模型的性能指标。现在，让我们使用推荐模型来找到最佳产品，向我们的客户推荐。
- en: Using the matrix factorization model
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用矩阵分解模型
- en: In this section, we'll test the matrix factorization model to get the recommended
    products for the users of our website.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将测试矩阵分解模型，以获取我们网站用户的推荐产品。
- en: To use our BigQuery ML model, we'll use the `ML.RECOMMEND` function while specifying
    the parameters for our prediction.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用我们的BigQuery ML模型，我们将使用 `ML.RECOMMEND` 函数，同时指定预测的参数。
- en: The recommendation engine does not need to take any additional input parameters
    besides the model itself. If the model has one input column, the model will only
    return the recommendations for the rows in the input. If no input values are provided,
    the model will apply the prediction for each combination of users and items in
    the original dataset.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 推荐引擎除了模型本身外，不需要任何额外的输入参数。如果模型有一个输入列，则模型将只返回输入行中的推荐。如果没有提供输入值，则模型将对原始数据集中用户和项目的每个组合应用预测。
- en: '`ML.RECOMMEND` returns three columns:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '`ML.RECOMMEND` 返回三列：'
- en: A column that represents the user. In our implementation, this is identified
    by the `fullVisitorID` column.
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代表用户的列。在我们的实现中，这由`fullVisitorID`列标识。
- en: A field dedicated to the item that is recommended to a specific user. In our
    case, this is represented by the `purchased_product_id` column.
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 专门针对推荐给特定用户的项目的领域。在我们的案例中，这由`purchased_product_id`列表示。
- en: A third column that represents the predicted rating in the case of an explicit
    matrix factorization model. If the model is implicit, as in our case, the field
    stores the predicted confidence of the recommendation.
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第三列代表在显式矩阵分解模型中的预测评分。如果模型是隐式的，就像在我们的案例中一样，该字段存储了推荐的预测置信度。
- en: 'Let''s execute the following query to materialize a table that contains all
    the recommendations that have been generated by our matrix factorization model:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行以下查询，以实现一个包含由我们的矩阵分解模型生成的所有推荐的表：
- en: '[PRE5]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The query creates a new table called `product_recommendations` that stores the
    `DISTINCT` couples of users and items. In our case, the couples are composed of
    the `fullVisitorID` and `purchased_product_id` columns.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 该查询创建了一个名为`product_recommendations`的新表，该表存储了用户和项目的`DISTINCT`对。在我们的案例中，这些对由`fullVisitorID`和`purchased_product_id`列组成。
- en: For each couple, the `ML.RECOMMEND` function also returns a predicted confidence
    that expresses the probability that a specific user has interest in a product
    in the e-commerce catalog.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每一对，`ML.RECOMMEND`函数还返回一个预测置信度，表示特定用户对电子商务目录中的产品感兴趣的概率。
- en: Now that we have the output of our recommendation engine, let's learn how to
    use this data from a business perspective.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经得到了推荐引擎的输出，让我们学习如何从业务角度使用这些数据。
- en: Drawing business conclusions
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提取业务结论
- en: Now that we've applied our BigQuery ML model, let's learn how the generated
    results can be used from a business perspective to improve the effectiveness of
    our sales strategy.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经应用了BigQuery ML模型，让我们学习如何从业务角度使用生成的结果来提高我们的销售策略的有效性。
- en: From the `product_recommendations` table, we can extract relevant information
    that we can use to improve our marketing campaigns or advertising strategy, and
    then target the users with higher propensity to buy a specific product.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 从`product_recommendations`表中，我们可以提取相关信息，我们可以使用这些信息来改进我们的营销活动或广告策略，然后针对更有可能购买特定产品的用户进行定位。
- en: 'For example, by executing the following query, we can extract the first `100`
    users with the highest propensity to buy a specific product from our e-commerce
    portal:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，通过执行以下查询，我们可以从我们的电子商务门户中提取出前`100`个最有可能购买特定产品的用户：
- en: '[PRE6]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Executing this SQL statement returns the following result:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 执行此SQL语句返回以下结果：
- en: '![Figure 9.11 – The customers with the highest propensity to buy a specific
    product'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '![图9.11 – 最有可能购买特定产品的客户'
- en: '](img/B16722_09_011.jpg)'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_09_011.jpg](img/B16722_09_011.jpg)'
- en: Figure 9.11 – The customers with the highest propensity to buy a specific product
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.11 – 最有可能购买特定产品的客户
- en: The list that we've just extracted can be sent to our marketing office to create
    tailored marketing campaigns. Alternatively, it can be used in our e-commerce
    portal to recommend the most interesting products for a specific registered customer.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚提取的列表可以发送到我们的营销办公室，以创建定制营销活动。或者，它也可以用于我们的电子商务门户，为特定注册客户推荐最有趣的产品。
- en: Summary
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we built a recommendation engine based on the matrix factorization
    algorithm. After we introduced the business scenario, we discovered what matrix
    factorization is and the difference between explicit and implicit models. Before
    diving into data exploration, we enabled BigQuery Flex Slots, which are necessary
    to train this category of ML algorithms.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们基于矩阵分解算法构建了一个推荐引擎。在介绍了业务场景之后，我们发现了矩阵分解是什么以及显式模型和隐式模型之间的区别。在深入数据探索之前，我们启用了BigQuery
    Flex Slots，这对于训练这类机器学习算法是必要的。
- en: Then, we applied some analyses and data preparation steps to the sample data
    collected by Google from the Google Merchandise e-commerce portal. Here, we've
    focused on the fields that were actually required to build our BigQuery ML model.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们对Google从Google Merchandise电子商务门户收集的样本数据进行了分析和数据准备步骤。在这里，我们专注于构建我们的BigQuery
    ML模型所必需的字段。
- en: Next, we created our training table, which includes the purchases that were
    made by each user, along with the related quantity for each product.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们创建了我们的训练表，其中包括每个用户所做的购买，以及每个产品的相关数量。
- en: After that, we trained our matrix factorization model on the data that we'd
    prepared. When the model was trained, we evaluated its key performance indicators
    using SQL code and the BigQuery UI.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们在准备好的数据上训练了我们的矩阵分解模型。当模型训练完成后，我们使用SQL代码和BigQuery UI评估了其关键性能指标。
- en: Finally, we generated some recommendations using our new matrix factorization
    model and extracted a list of 100 customers that can be targeted with high propensity
    to buy a set of products.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们使用我们新的矩阵分解模型生成了一些推荐，并提取了一份100名客户的清单，这些客户有很高的购买产品组合的倾向。
- en: In the next chapter, we'll introduce the XGBoost algorithm for predicting binary
    values.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍用于预测二元值的XGBoost算法。
- en: Further resources
  id: totrans-178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步资源
- en: '**Google Analytics 360 public dataset**: [https://console.cloud.google.com/marketplace/product/obfuscated-ga360-data/obfuscated-ga360-data](https://console.cloud.google.com/marketplace/product/obfuscated-ga360-data/obfuscated-ga360-data
    )'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Google Analytics 360公共数据集**: [https://console.cloud.google.com/marketplace/product/obfuscated-ga360-data/obfuscated-ga360-data](https://console.cloud.google.com/marketplace/product/obfuscated-ga360-data/obfuscated-ga360-data)'
- en: '**BigQuery ML create model**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create
    )'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML创建模型**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)'
- en: '**BigQuery ML evaluate model**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate
    )'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML评估模型**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
- en: '**BigQuery ML RECOMMEND**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-recommend](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-recommend
    )'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML推荐**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-recommend](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-recommend)'
- en: '**BigQuery ML explicit matrix factorization example**: [https://cloud.google.com/bigquery-ml/docs/bigqueryml-mf-explicit-tutorial](https://cloud.google.com/bigquery-ml/docs/bigqueryml-mf-explicit-tutorial)'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML显式矩阵分解示例**: [https://cloud.google.com/bigquery-ml/docs/bigqueryml-mf-explicit-tutorial](https://cloud.google.com/bigquery-ml/docs/bigqueryml-mf-explicit-tutorial)'
- en: '**BigQuery ML implicit matrix factorization example**: [https://cloud.google.com/bigquery-ml/docs/bigqueryml-mf-implicit-tutorial#implicit-model](https://cloud.google.com/bigquery-ml/docs/bigqueryml-mf-implicit-tutorial#implicit-model
    )'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML隐式矩阵分解示例**: [https://cloud.google.com/bigquery-ml/docs/bigqueryml-mf-implicit-tutorial#implicit-model](https://cloud.google.com/bigquery-ml/docs/bigqueryml-mf-implicit-tutorial#implicit-model)'

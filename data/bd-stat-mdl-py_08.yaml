- en: '8'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '8'
- en: Discrete Models
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 离散模型
- en: In the previous two chapters, we discussed models for predicting a continuous
    response variable. In this chapter, we will begin discussing models for predicting
    discrete response variables. We will start by discussing the probit and logit
    models for predicting binary outcome variables (categorical variables with two
    levels). Then, we will extend this idea to predicting categorical variables with
    multiple levels. Finally, we will look at predicting count variables, which are
    like categorical variables but only take values of integers and have an infinite
    number of levels.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在前两个章节中，我们讨论了预测连续响应变量的模型。在本章中，我们将开始讨论预测离散响应变量的模型。我们将首先讨论用于预测二元结果变量（具有两个级别的分类变量）的
    probit 和 logit 模型。然后，我们将这个想法扩展到预测具有多个级别的分类变量。最后，我们将探讨预测计数变量，这些变量类似于分类变量，但只取整数值，并且有无限多个级别。
- en: 'In this chapter, we’re going to cover the following main topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下主要主题：
- en: Probit and logit models
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Probit 和 logit 模型
- en: Multinomial logit model
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多项式 logit 模型
- en: Poisson model
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 泊松模型
- en: The negative binomial regression model
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负二项式回归模型
- en: Probit and logit models
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Probit 和 logit 模型
- en: Previously, we discussed different types of problems that can be solved with
    regression models. In particular, the dependent variable is continuous, such as
    house prices, salaries, and so on. A natural question is if dependent variables
    are not continuous – in other words, if they are categorical – how would we adapt
    our regression equation to predict a categorical response variable? For instance,
    a human resources department in a company wants to conduct an attrition study
    to predict whether an employee will stay with the company or a car dealership
    wants to know if one car can be sold or not based on prices, car models, colors,
    and so on.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在之前，我们讨论了可以用回归模型解决的问题的不同类型。特别是，因变量是连续的，例如房价、薪水等。一个自然的问题是，如果因变量不是连续的——换句话说，如果它们是分类的——我们如何调整我们的回归方程来预测一个分类响应变量？例如，一家公司的人力资源部门想要进行员工流失率研究，以预测员工是否会留在公司，或者一家汽车经销商想要知道基于价格、车型、颜色等因素，一辆车是否能够售出。
- en: 'First, we will study **binary classification**. Here, the outcome (dependent
    variable) is a binary response such as yes/no or to do/not to do. Let’s look back
    at the simple linear regression model:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将研究**二元分类**。在这里，结果（因变量）是一个二元响应，如是/否或做/不做。让我们回顾一下简单的线性回归模型：
- en: y = β 0 + β 1 x+ ϵ
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: y = β 0 + β 1 x+ ϵ
- en: 'Here, the predicted outcome is a line crossing data points. With this model,
    we could build a model to predict house prices (the dependent variable) based
    on different independent variables, such as districts, units, stories, or distances.
    The same idea cannot be applied to a binary classification problem. Let’s consider
    a simple example that we want to predict if a house is sold only based on its
    price. Let’s build a model based on linear regression:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，预测的结果是一条穿过数据点的线。使用这个模型，我们可以构建一个模型，根据不同的自变量（如地区、单元、楼层或距离）来预测房价（因变量）。同样的想法不能应用于二元分类问题。让我们考虑一个简单的例子，我们只想根据房价预测房屋是否售出。让我们基于线性回归构建一个模型：
- en: Sold = β 0 + β 1 * Price + ϵ (1)
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: Sold = β 0 + β 1 * Price + ϵ (1)
- en: 'Here, Sold = 1 if the house is sold and Sold=0 if it was not sold. By performing
    visualization using linear regression, we can draw a line of best fit through
    the data points. It looks like when the price increases, the chance of selling
    a house decreases:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，如果房屋售出，Sold = 1，如果没有售出，Sold = 0。通过使用线性回归进行可视化，我们可以画出穿过数据点的最佳拟合线。看起来当价格增加时，房屋售出的可能性会降低：
- en: '![Figure 8.1 – Line of best fit using linear regression](img/B18945_08_01.jpg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.1 – 使用线性回归的最佳拟合线](img/B18945_08_01.jpg)'
- en: Figure 8.1 – Line of best fit using linear regression
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.1 – 使用线性回归的最佳拟合线
- en: 'So, instead of considering the equation model (*1*), we will be considering
    the following:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们不会考虑方程模型(*1*)，而是考虑以下内容：
- en: Prob(Sold) = β 0 + β 1 * Price + ϵ
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: Prob(Sold) = β 0 + β 1 * Price + ϵ
- en: 'Here, Prob(Sold) is the probability of selling a house. The probability value
    will be between 0 and 1; the midpoint of its range is 0.5 when the probability
    of selling a house is equal to the probability of not selling a house. However,
    when the price of a house is very high, then the value of Prob(Sold) can be negative.
    To avoid this problem, we can model the problem with the following equation:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，Prob(Sold) 表示出售房屋的概率。概率值将在 0 和 1 之间；当出售房屋的概率等于不出售房屋的概率时，其范围的中间值为 0.5。然而，当房屋价格非常高时，Prob(Sold)
    的值可以是负数。为了避免这个问题，我们可以用以下方程来建模问题：
- en: P _ 1 − P = β 0 + β 1 * Price+ ϵ (2)
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: P * (1 - P) = β_0 + β_1 * Price + ϵ (2)
- en: 'Here, P is the probability of selling a house and 1 − P is the probability
    of not selling a house. The value of  P _ 1 − P is in the range of [0, ∞) and
    when the probability of selling a car is the same as the probability of not selling
    a car, (P=0.5), then  P _ 1 − P = 1, or the midpoint of its range is 1\. This
    is also called the **odds ratio**. To interpret the odds ratio, when  P _ 1 −
    P = 1, for every house that is sold, there is a house that is not sold. When P
    = 0.75, then the odds ratio is 3\. In this case, the interpretation is that the
    odds of being able to sell the house are three times higher than the odds of not
    being able to sell the house. Going back to the equation (*2*), the range of the
    odds ratio is [0, ∞) and its lower limit is 0, but as we discussed previously
    for equation (*1*), when the price of a house is really high, then the estimate
    of the odds ratio could be negative, which contradicts the probability properties.
    In addition, because the midpoint is 1 but the range of the odds ratio is from
    0 to infinity, then the distribution is very skewed with a long right tail. However,
    we expected it to be normally distributed per one of the assumptions of linear
    regression. So, instead of using equation (*2*), we will consider the following:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，P 是出售房屋的概率，1 - P 是不出售房屋的概率。P * (1 - P) 的值在 [0, ∞) 范围内，当出售汽车的概率与不出售汽车的概率相同时，(P=0.5)，则
    P * (1 - P) = 1，或者其范围的中间值为 1。这也被称为 **优势比**。要解释优势比，当 P * (1 - P) = 1 时，对于每出售一栋房屋，就有一栋房屋未出售。当
    P = 0.75 时，优势比为 3。在这种情况下，解释是能够出售房屋的概率是未能出售房屋概率的三倍。回到方程 (*2*)，优势比的范围是 [0, ∞)，其下限为
    0，但正如我们之前讨论方程 (*1*) 时所指出的，当房屋价格非常高时，优势比的估计值可能是负数，这与概率属性相矛盾。此外，由于中间值为 1 但优势比的范围是从
    0 到无穷大，因此分布非常偏斜，右尾较长。然而，我们期望它符合线性回归的一个假设，即正态分布。因此，我们不会使用方程 (*2*)，而是考虑以下：
- en: log( P _ 1 − P) = β 0 + β 1 * Price + ϵ
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: log(odds) = log(P * (1 - P)) = β_0 + β_1 * Price + ϵ
- en: 'The value of log( P _ 1 − P) is in the range of (− ∞ , ∞) and the midpoint
    is 0\. Similar to linear regression, we can use the following formula:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: log(P * (1 - P)) 的值在 (-∞, ∞) 范围内，中间值为 0。类似于线性回归，我们可以使用以下公式：
- en: log(odds) = log( P _ 1 − P) = β 0 + β 1 X 1 + β 2 X 2 + … = z (3)
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: log(odds) = log(P * (1 - P)) = β_0 + β_1 * X_1 + β_2 * X_2 + … = z (3)
- en: 'We can use this to interpret how the explanatory variables are associated with
    the categorical outcome. We can rewrite the previous equation (*3*) as follows:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以用此来解释解释变量与分类结果之间的关系。我们可以将之前的方程 (*3*) 重新写为以下形式：
- en: F(z) = P =  e z _ 1 + e z ,
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: F(z) = P = e^(z - 1) + e^z,
- en: The preceding formula is bounded below by 0 and above by 1 (the predicted probability,
    *P*, of the outcome takes place) and is called the logit model. It is the cumulative
    distribution function of the **logistic distribution**.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的公式下限为 0，上限为 1（预测结果发生的概率 *P*），这被称为 logit 模型。它是逻辑分布的累积分布函数。
- en: 'Another approach to model the probability of a binary dependent variable is
    **probit regression**. Instead of using the cumulative distribution function of
    logistic regression, we use the cumulative distribution function of the standard
    normal distribution:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 模型二元因变量的概率的另一种方法是 **probit 回归**。我们使用标准正态分布的累积分布函数，而不是逻辑回归的累积分布函数：
- en: F(z) =  ∫ −∞ zϕ(u)du = ϕ(z).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: F(z) = ∫_{-∞}^z ϕ(u) du = ϕ(z)。
- en: 'The preceding formula is bounded below by 0 and above by 1 (the predicted probability,
    *P*, of the outcome takes place), and is called the **probit model**. Remember
    the following:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的公式下限为 0，上限为 1（预测结果发生的概率 *P*），这被称为 **probit 模型**。记住以下：
- en: ϕ(z) = P(Z ≤ z), Z~𝒩(0,1).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: ϕ(z) = P(Z ≤ z)，其中 Z ~ 𝒩(0,1)。
- en: Both the logit and probit models are estimated by using the `statsmodels`, we
    have classes for the probit and logit models. The documentation for these classes
    can be found at [https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.Probit.xhtml](https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.Probit.xhtml)
    and [https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.Logit.xhtml](https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.Logit.xhtml).
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: logit 和 probit 模型都是通过使用 `statsmodels` 进行估计的，我们有 probit 和 logit 模型的类。这些类的文档可以在
    [https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.Probit.xhtml](https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.Probit.xhtml)
    和 [https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.Logit.xhtml](https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.Logit.xhtml)
    找到。
- en: 'Now, let’s create a training dataset to illustrate how to use the `Logit` class
    from `statsmodels` to conduct a logit study:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们创建一个训练数据集来展示如何使用 `statsmodels` 中的 `Logit` 类进行 logit 研究：
- en: '[PRE0]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Here, `Admitted` is the dependent variable and has two possibilities (1 – admitted
    and 0 – not admitted). `GPA` is the GPA grade and `Exp` is the number of years
    of experience. The output of the preceding code is as follows:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`Admitted` 是因变量，有两种可能性（1 – 被录取和 0 – 未录取）。`GPA` 是 GPA 成绩，`Exp` 是经验年数。前面代码的输出如下：
- en: '![Figure 8.2 – Training dataset on GPA grades and years of experience](img/B18945_08_002.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.2 – GPA 成绩和经验年数上的训练数据集](img/B18945_08_002.jpg)'
- en: Figure 8.2 – Training dataset on GPA grades and years of experience
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.2 – GPA 成绩和经验年数上的训练数据集
- en: 'We must also create a testing dataset for this model:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还必须为这个模型创建一个测试数据集：
- en: '[PRE1]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The resulting output is as follows:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 得到的输出如下：
- en: '![Figure 8.3 – Testing dataset on GPA grades and years of experience](img/B18945_08_003.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.3 – GPA 成绩和经验年数上的测试数据集](img/B18945_08_003.jpg)'
- en: Figure 8.3 – Testing dataset on GPA grades and years of experience
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.3 – GPA 成绩和经验年数上的测试数据集
- en: 'We will use `logit` from `statsmodels`:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用来自 `statsmodels` 的 `logit`：
- en: '[PRE2]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'This will print the following summary:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 这将打印以下摘要：
- en: '![Figure 8.4 – Logit Regression Output](img/B18945_08_004.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.4 – Logit 回归输出](img/B18945_08_004.jpg)'
- en: Figure 8.4 – Logit Regression Output
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.4 – Logit 回归输出
- en: From this output, we can see that `GPA` and `Exp` are significant at the α =
    0.05 significance level.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个输出中，我们可以看到 `GPA` 和 `Exp` 在 α = 0.05 的显著性水平上是显著的。
- en: 'The values under the `[0.025 0.975]` heading are the 95% confidence interval
    for `Intercept`, `GPA`, and `Exp`, respectively. The next step is to use `confusion_matrix`
    and `accuracy_score` to compute the accuracy of the model on the test set:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '`[0.025 0.975]` 下的值分别是 `Intercept`、`GPA` 和 `Exp` 的 95% 置信区间。下一步是使用 `confusion_matrix`
    和 `accuracy_score` 来计算模型在测试集上的准确率：'
- en: '[PRE3]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The output is as follows:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '![Figure 8.5 – Confusion matrix on testing dataset](img/B18945_08_005.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.5 – 测试数据集上的混淆矩阵](img/B18945_08_005.jpg)'
- en: Figure 8.5 – Confusion matrix on testing dataset
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.5 – 测试数据集上的混淆矩阵
- en: By using these train and test datasets, the model can predict the outcome perfectly.
    In the next section, we will discuss **multi-class regression** using a similar
    idea as in binary logistic regression.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用这些训练和测试数据集，模型可以完美地预测结果。在下一节中，我们将讨论使用与二元逻辑回归类似思想的**多类回归**。
- en: Multinomial logit model
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多项 logit 模型
- en: 'In practice, there are many situations where the outcomes (dependent variables)
    are not binary but have more than two possibilities. `MNLogit` class from `statsmodels`:
    [https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.MNLogit.xhtml](https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.MNLogit.xhtml).'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，有许多情况中，结果（因变量）不是二元的，而是有超过两种可能性。来自 `statsmodels` 的 `MNLogit` 类：[https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.MNLogit.xhtml](https://www.statsmodels.org/dev/generated/statsmodels.discrete.discrete_model.MNLogit.xhtml)。
- en: 'Iris data ([https://archive.ics.uci.edu/ml/datasets/iris](https://archive.ics.uci.edu/ml/datasets/iris))
    is one of the best-known statistical and machine learning datasets for education.
    The independent variables are sepal length (in cm), sepal width (in cm), petal
    length (in cm), and petal width (in cm). The dependent variable is a categorical
    variable with three levels: Iris Setosa (0), Iris Versicolor (1), and Iris Virginia
    (2). The following Python codes illustrate how to conduct this using `sklearn`
    and `statsmodels`:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 爱丽丝数据([https://archive.ics.uci.edu/ml/datasets/iris](https://archive.ics.uci.edu/ml/datasets/iris))是教育中最著名的统计和机器学习数据集之一。自变量是萼片长度（厘米），萼片宽度（厘米），花瓣长度（厘米）和花瓣宽度（厘米）。因变量是一个有三个级别的分类变量：Iris
    Setosa（0），Iris Versicolor（1）和Iris Virginia（2）。以下Python代码展示了如何使用`sklearn`和`statsmodels`进行这一操作：
- en: '[PRE4]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Both methods give us the same test accuracy value (96.67%), with the confusion
    matrix produced as follows:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这两种方法都给出了相同的测试准确率值（96.67%），混淆矩阵如下所示：
- en: '![Figure 8.6 – Confusion matrices using sklearn (left) and statsmodels (right)](img/B18945_08_06.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![图8.6 – 使用sklearn（左）和statsmodels（右）的混淆矩阵](img/B18945_08_06.jpg)'
- en: Figure 8.6 – Confusion matrices using sklearn (left) and statsmodels (right)
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.6 – 使用sklearn（左）和statsmodels（右）的混淆矩阵
- en: Poisson model
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 泊松模型
- en: In the previous section, we discussed models where the response variable was
    categorical. In this section, we will look at a model for count data. Count data
    is like categorical data (the categories are integers), but there are an infinite
    number of levels (0, 1, 2, 3, and so on). We model count data with the **Poisson
    distribution**. In this section, we will start by examining the Poisson distribution
    and its properties. Then, we will model a count variable with explanatory variables
    using the Poisson model.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，我们讨论了响应变量为分类变量的模型。在本节中，我们将探讨一个针对计数数据的模型。计数数据类似于分类数据（类别为整数），但是有无限多个级别（0、1、2、3等等）。我们使用**泊松分布**来建模计数数据。在本节中，我们将首先检查泊松分布及其性质。然后，我们将使用泊松模型用解释变量对计数变量进行建模。
- en: The Poisson distribution
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 泊松分布
- en: 'The Poisson distribution is given by the following formula:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 泊松分布由以下公式给出：
- en: P(k) =  λ k e −λ _ k !
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: P(k) = λ^k e^(-λ) / k!
- en: Here, λ is the average number of events and k is the number of events for which
    we would like the probability. P(k) is the probability that the k events occur.
    This distribution is used to calculate the probability of k events occurring in
    a fixed time interval or a defined space.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，λ是事件的平均数量，k是我们想要计算概率的事件数量。P(k)是k个事件发生的概率。这个分布用于计算在固定时间间隔或定义空间内发生k个事件的概率。
- en: 'The shape of the distribution changes with the value of λ. When λ is greater
    than 10, the distribution appears approximately normal. However, as λ approaches
    0, the distribution becomes right-skewed. This is because count data cannot be
    negative. Three example Poisson distributions are shown in *Figure 8**.7* with
    means of 12, 5, and 2\. Notice that the distribution with the mean of 12 is approximately
    normally distributed, while the distributions of 5 and 2 are right-skewed:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 分布的形状随着λ值的改变而变化。当λ大于10时，分布看起来近似于正态分布。然而，当λ接近0时，分布变得右偏斜。这是因为计数数据不能为负。图8.7*展示了三个泊松分布的例子，其平均值分别为12、5和2。注意，平均值为12的分布近似于正态分布，而平均值为5和2的分布则是右偏斜的：
- en: '![Figure 8.7 – Example Poisson distributions with means of 12, 5, and 2](img/B18945_08_007.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![图8.7 – 平均值为12、5和2的泊松分布示例](img/B18945_08_007.jpg)'
- en: Figure 8.7 – Example Poisson distributions with means of 12, 5, and 2
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.7 – 平均值为12、5和2的泊松分布示例
- en: Another interesting aspect of the distribution is that the mean and variance
    are equal. This means that as the mean increases, the spread of the distribution
    also increases. We can see this in action in the examples in *Figure 8**.7*. The
    distribution with a mean of 2 has a small spread with a large peak at the mean,
    while the distribution with a mean of 12 has a much wider spread with a lower
    peak at the mean.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 分布的另一个有趣方面是均值和方差相等。这意味着随着均值的增加，分布的分散度也会增加。我们可以在图8.7*的例子中看到这一点。均值为2的分布具有较小的分散度和在均值处的大峰值，而均值为12的分布具有更宽的分散度和在均值处较低峰值。
- en: Now that we have discussed the Poisson distribution, let’s look at how to set
    up a Poisson model.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经讨论了泊松分布，让我们看看如何设置泊松模型。
- en: Modeling count data
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 计数数据建模
- en: 'Now, let’s look at how to model the response variable of counts with the Poisson
    model. As mentioned previously, count data often follows a Poisson distribution.
    The Poisson model is expressed mathematically as follows:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看如何使用泊松模型对计数响应变量进行建模。如前所述，计数数据通常遵循泊松分布。泊松模型用以下数学公式表示：
- en: y = e b 0+b 1x 1+…+b nx n
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: y = e^b 0 + b 1x 1 + … + b nx n
- en: 'Here, y is the response variable, b values are model coefficients, and x variables
    represent explanatory variables. This should appear similar to the equation we
    used in the previous chapter but with the addition of the exponentiation of the
    explanatory variables. This type of model is called a **log-linear** model, which
    is a model where the logarithm of the response variable is modeled by a linear
    combination of variables. We can rewrite this equation by applying the natural
    logarithm to both sides of the equation to make it explicit:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，y是响应变量，b值是模型系数，x变量代表解释变量。这应该看起来与我们在上一章中使用的方程式相似，但增加了解释变量的指数。这种类型的模型称为**对数线性**模型，它是一种响应变量的对数由变量的线性组合建模的模型。我们可以通过将方程式的两边应用自然对数来重写此方程，使其更明确：
- en: ln(y) = b 0 + b 1 x 1 + … + b n x n
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: ln(y) = b 0 + b 1 x 1 + … + b n x n
- en: Now, we have the logarithm of the response variable ( ln(y) ) expressed as a
    linear combination of explanatory variables.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将响应变量的对数（ln(y)）表示为解释变量的线性组合。
- en: The natural logarithm
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 自然对数
- en: 'The Poisson model uses a special logarithm called the natural logarithm. The
    natural logarithm of a number is the logarithm of that number using the mathematical
    constant e as the base. The natural logarithm is generally written as ln(x), log e(x),
    or log(x) (the first two options are explicit, but the third option can be ambiguous).
    The logarithm operation is the inverse of exponentiation. In this case, the natural
    logarithm is the inverse of the exponential function: ln(e x) = x = e ln(x). The
    natural logarithm and exponential function are commonly used in statistics, mathematics,
    and science.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 泊松模型使用一种特殊的对数，称为自然对数。一个数的自然对数是以数学常数e为底的对数。自然对数通常写作ln(x)，log_e(x)，或log(x)（前两种是明确的，但第三种可能是有歧义的）。对数运算是对数的逆运算。在这种情况下，自然对数是对数函数的逆：ln(e^x)
    = x = e^ln(x)。自然对数和对数函数在统计学、数学和科学中常用。
- en: 'Let’s look at an example. We will be using the Bike Sharing Dataset from UCI
    ([https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset](https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset).).
    In this dataset, we have counts of bikes rented each day. There are two types
    of rentals: pre-registered (registered) and on-demand at a location (causal).
    In this example, we will model the weekly mean count of casually rented bikes
    over a given year. The dataset provides several explanatory variables, including
    environmental factors such as temperature and calendar information such as whether
    a holiday occurred.'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看一个例子。我们将使用UCI的共享单车数据集([https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset](https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset))。在这个数据集中，我们有每天租赁自行车的数量。有两种租赁类型：预先注册（注册）和按需在地点租赁（因果）。在这个例子中，我们将对给定年份的每周平均随意租赁自行车数量进行建模。数据集提供了几个解释变量，包括环境因素，如温度，以及日历信息，如是否为假日。
- en: 'We will start by setting up the equation for our model and then take a look
    at the results from fitting the model with `statsmodels`. The model equation follows
    the form we discussed previously:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先设置模型方程，然后查看使用`statsmodels`拟合模型的结果。模型方程遵循我们之前讨论的形式：
- en: ln(weekly _ mean _ rental _ count) = b 0 + b 1(temperature) + b 1(season)
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: ln(每周_平均_租赁_数量) = b 0 + b 1(温度) + b 1(季节)
- en: + b 2(weather _ situation) + b 3(humidity) + b 4(wind _ speed) + b 5(holiday)
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: + b 2(天气_情况) + b 3(湿度) + b 4(风速) + b 5(假日)
- en: 'We can fit this model with the given data using `statsmodels`, similar to how
    we did in the previous chapter. An excerpt of the code to fit the model is shown
    here (see the Jupyter Notebook for details on preprocessing):'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`statsmodels`根据给定数据拟合此模型，这与我们在上一章中做的方法类似。拟合模型的代码片段如下（有关预处理详情，请参阅Jupyter
    Notebook）：
- en: '[PRE5]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'After fitting the model, we can get details on the coefficients using the `summary()`
    method. For this model, we get the following output for the coefficients:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在模型拟合完成后，我们可以使用`summary()`方法获取系数的详细信息。对于这个模型，我们得到以下系数的输出：
- en: '![Figure 8.8 – Poisson model summary](img/B18945_08_08.jpg)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![图8.8 – 泊松模型摘要](img/B18945_08_08.jpg)'
- en: Figure 8.8 – Poisson model summary
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.8 – 泊松模型摘要
- en: Just like the modeling example for linear regression, these coefficient values
    are estimates of the parameters listed in our model. All the explanatory variables
    in the model appear to be significant in the model. Interestingly, based on the
    value of the coefficient estimates, temperature (`atemp`) appears to be the most
    influential factor, followed by humidity (`hum`) and wind speed. With the model
    fit and no need to remove insignificant variables, we can assess the model’s performance.
    This model has an MAE of 155, which corresponds to a MAPE of 36%.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 就像线性回归的建模示例一样，这些系数值是我们模型中列出的参数的估计值。模型中的所有解释变量在模型中似乎都显著。有趣的是，根据系数估计值，温度（`atemp`）似乎是最有影响力的因素，其次是湿度（`hum`）和风速。由于模型拟合良好且无需删除不显著的变量，我们可以评估模型的表现。此模型具有155的MAE，对应于36%的MAPE。
- en: The Poisson model depends strongly on the assumption that the response variable
    has a Poisson distribution. In the next section, we will look at a similar type
    of model for count data, but with weaker distributional assumptions.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 泊松模型强烈依赖于响应变量具有泊松分布的假设。在下一节中，我们将查看一个类似类型的计数数据模型，但具有较弱的分布假设。
- en: The negative binomial regression model
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 负二项回归模型
- en: Another useful approach to **discrete regression** is the **log-linear negative
    binomial regression** model, which uses the negative binomial probability distribution.
    At a high level, negative binomial regression is useful with *over-dispersed count
    data* where the *conditional mean of the count is smaller than the conditional
    variance of the count*. Model **over-dispersion** is where the variance of the
    target variable is greater than the mean assumed by the model. In a regression
    model, the mean is the regression line. We make the determination of using the
    negative binomial model based on target variable counts analysis (mean versus
    variance) and supply a measure of model over-dispersion to the negative binomial
    model to adjust for the over-dispersion, which we will discuss here.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种有用的**离散回归**方法是**对数线性负二项回归**模型，它使用负二项概率分布。从高层次来看，负二项回归对于**过度分散的计数数据**很有用，其中**计数条件均值**小于**计数条件方差**。模型**过度分散**是指目标变量的方差大于模型假设的均值。在回归模型中，均值是回归线。我们根据目标变量计数分析（均值与方差）来决定使用负二项模型，并向负二项模型提供一个度量模型过度分散的量，以调整过度分散，我们将在下面讨论这一点。
- en: It is important to note that the negative binomial model is not for modeling
    simply discrete data, but specifically **count data** associated with a fixed
    number of **random** trials, such as modeling the number of attempts before an
    event occurs – or failing to occur – in a random sampling scenario. The model
    operates only on count data, where each count response of the target variable
    is based on a finite set of outcomes. Additionally, because the count data is
    the result of repeated binomial trials, the order of count arrangement does not
    matter.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要注意，负二项模型不仅用于建模简单的离散数据，而是专门用于与固定数量的**随机**试验相关的**计数数据**，例如在随机抽样场景中建模事件发生前（或未发生）的尝试次数。该模型仅对计数数据进行操作，其中目标变量的每个计数响应都基于有限的结果集。此外，由于计数数据是重复的二项试验的结果，计数排列的顺序并不重要。
- en: Negative binomial distribution
  id: totrans-95
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 负二项分布
- en: 'The following is an example of the negative binomial distribution of failure
    counts with a conditional mean of 17 and a conditional variance of 52:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个负二项分布的失败计数示例，条件均值为17，条件方差为52：
- en: '![Figure 8.9 – Negative binomial distribution example](img/B18945_08_009.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![图8.9 – 负二项分布示例](img/B18945_08_009.jpg)'
- en: Figure 8.9 – Negative binomial distribution example
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.9 – 负二项分布示例
- en: 'The binomial distribution is a construct of counts of successes in a fixed
    count of random trials (X = ( X 1, X 2, … )) of a Bernoulli random variable, which
    is a variable that has one of two outcome values: 0 or 1\. The negative binomial
    distribution is a construct of the count of failures in a fixed count of random
    draws of the Bernoulli random variable. This distinction is important because
    a model using binomial regression models a binary outcome across observations,
    whereas a negative binomial regression model models a count outcome across observations.
    The negative binomial distribution is the inverse of the binomial distribution.
    The probability mass function for the negative binomial distribution is as follows:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 二项分布是固定次数随机试验（X = ( X 1, X 2, … ))中伯努利随机变量成功次数的构建，伯努利随机变量是一个具有两个结果值：0 或 1 的变量。负二项分布是伯努利随机变量固定次数随机抽取的失败次数的构建。这种区别很重要，因为使用二项回归模型的模型在观测之间建模二元结果，而负二项回归模型在观测之间建模计数结果。负二项分布是二项分布的逆。负二项分布的概率质量函数如下：
- en: P(X − x) = (x + n − 1 n − 1 ) p n (1 − p) x
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: P(X − x) = (x + n − 1 n − 1 ) p n (1 − p) x
- en: Here, there are x failures and n − 1 successes in a set of x + n − 1 trials
    reaching success at trial x + n.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，有一组 x + n − 1 次试验，其中 x 次失败和 n − 1 次成功，在第 x + n 次试验中达到成功。
- en: 'Concerning the Poisson distribution, the negative binomial *does not require
    strict adherence to the assumption that conditional variance is equal to the conditional
    mean* as it includes an additional parameter, *α*, to explain the extra variance,
    whereas the Poisson model assumes the variance is equal to the mean, *μ*. The
    negative binomial model assumes the variance, here based on the Poisson-gamma
    mixture distribution, is equal to the following:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 关于泊松分布，负二项分布*不需要严格遵循条件方差等于条件均值的假设*，因为它包含一个额外的参数 *α* 来解释额外的方差，而泊松模型假设方差等于均值 *μ*。负二项模型假设方差，此处基于泊松-伽马混合分布，等于以下：
- en: μ(1 + αμ)
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: μ(1 + αμ)
- en: 'This reduces to the following:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 这简化为以下形式：
- en: (μ + α μ 2)
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: (μ + α μ 2)
- en: 'Stated in terms of the probability of success, *p*, the negative binomial variance
    is calculated as follows:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 用成功概率 *p* 来表述，负二项分布的方差计算如下：
- en: n  1 − p _ p 2
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: n  1 − p _ p 2
- en: 'It has the following mean:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 它具有以下均值：
- en: n  1 − p _ p
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: n  1 − p _ p
- en: 'Because the variance is not expected to equal the mean with the negative binomial
    model, the negative binomial is likely to outperform the Poisson approach *when
    the counts are large enough that the variance in response exceeds the mean*. Similarly,
    to Poisson, a negative binomial is a log-linear model with confidence intervals
    being based on the Wald and drop-in-deviance likelihood ratio. The form of the
    negative binomial model’s regression equation, shown here, is the same as that
    for Poisson regression:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 由于负二项模型中方差不一定等于均值，因此当计数足够大，响应的方差超过均值时，负二项分布可能优于泊松方法。同样，与泊松一样，负二项分布是一个对数线性模型，置信区间基于
    Wald 和 drop-in-deviance 似然比。负二项分布回归方程的形式，如此处所示，与泊松回归相同：
- en: ln(y) = b 0 + b 1 x 1 + … + b n x n
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: ln(y) = b 0 + b 1 x 1 + … + b n x n
- en: 'It reduces to the following:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 它简化为以下形式：
- en: y = e b 0 + e b 1x 1 + … + e b nx n
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: y = e b 0 + e b 1x 1 + … + e b nx n
- en: 'The **maximum likelihood estimate** of the probability of success for a given
    sample of the distribution is as follows:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 对于分布的给定样本，成功概率的**最大似然估计**如下：
- en: n _ n +  _ x  ′
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: n _ n +  _ x  ′
- en: Maximum likelihood estimation
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 最大似然估计
- en: '**Maximum likelihood estimation** (**MLE**) is an underpinning of the log-odds
    (or logit) and log-likelihood approaches to statistical modeling. Likelihood is
    the probability of the known outcome of a regression model being observed given
    specific regression coefficient values. By default, a set of variables will have
    a higher likelihood than another set of variables if the set provides a higher
    probability of the observed outcome being obtained. The logarithm of the likelihood
    is taken as a measure of goodness-of-fit for a regression model. Out of a set
    of potential coefficient values for each variable, the set of coefficients with
    the maximum log-likelihood values for each variable are referred to as the **maximum
    likelihood estimates**. These values are obtained through an iterative approach
    that generates multiple possible values. If the sample size is sufficiently large
    and an appropriate set of variables has been obtained for the model, the maximum
    likelihood estimates can be considered unbiased.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '**最大似然估计**（**MLE**）是统计建模中对数优势（或logit）和对数似然方法的基础。似然是在给定特定的回归系数值的情况下，观察到的回归模型已知结果的概率。默认情况下，如果一组变量比另一组变量提供更高的观察结果概率，则该组变量将具有更高的似然。似然的对数被用作回归模型拟合优度的度量。对于每个变量的潜在系数值集合，具有每个变量最大对数似然值的系数集合被称为**最大似然估计**。这些值是通过迭代方法获得的，该方法生成多个可能的值。如果样本量足够大，并且已经为模型获得了一组适当的变量，则最大似然估计可以被认为是无偏的。'
- en: 'Calculating the confidence intervals for negative binomial regression is similar
    to that for logistic regression. The **Wald** approach to the calculation leverages
    a **z-ratio**. Where there are *j* variables in the model, the z-ratio is calculated
    as follows:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 计算负二项回归的置信区间与逻辑回归类似。计算中使用的**Wald**方法利用了**z比率**。在模型中有*j*个变量时，z比率计算如下：
- en: (  ˆ β  j− β j) _ SE(  ˆ β  j)
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: ( ˆβj − βj) _ SE( ˆβj)
- en: 'Here, *SE* is the standard error. The confidence interval is the variable’s
    coefficient estimate plus and minus the half-width confidence interval percentile
    multiplied by the standard error of the coefficient estimate. The z-ratio can
    be used because it is assumed the estimates have standard normal sampling distributions.
    Therefore, we can derive the 95% confidence interval for the variable’s estimated
    coefficient as follows:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*SE*是标准误差。置信区间是变量的系数估计值加减半宽置信区间百分位数乘以系数估计值的标准误差。可以使用z比率，因为假设估计值具有标准正态抽样分布。因此，我们可以推导出变量的估计系数的95%置信区间如下：
- en: 'Lower 95% confidence limit:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 下限95%置信限：
- en: ˆ β  j − 0.475 × SE( ˆ β  j)
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: ˆβj − 0.475 × SE( ˆβj)
- en: 'Upper 95% confidence limit:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 上限95%置信限：
- en: ˆ β  j + 0.475 × SE( ˆ β  j)
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: ˆβj + 0.475 × SE( ˆβj)
- en: 'There are three required assumptions specific to negative binomial regression:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 负二项回归有三个特定的假设要求：
- en: Independence between samples.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 样本间的独立性。
- en: A linear relationship between the log of the target variable and input variables
    (log-linear model).
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 目标变量的对数与输入变量之间存在线性关系（对数线性模型）。
- en: Conditional variance is greater than or equal to the conditional mean.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 条件方差大于或等于条件均值。
- en: Independence between samples means there is no serial correlation nor any cluster
    or other conditional dependence between samples. A linear relationship between
    the log of the target variable and input variables means that the relationship
    between the logarithm of the target variable and changes in each input variable
    scales linearly. Except for requirement 3, which we discussed at the start of
    this section, the requirements are essentially the same as for the Poisson model.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 样本间的独立性意味着没有序列相关性，也没有任何样本间的聚类或其他条件依赖性。目标变量的对数与输入变量之间存在线性关系意味着目标变量对数的对数与每个输入变量的变化之间的关系是线性缩放的。除了我们在本节开头讨论的第3个要求外，其他要求基本上与泊松模型相同。
- en: 'Let’s walk through an example in Python using statsmodels. For this, let’s
    load the statsmodels affairs dataset to model child count (the `children` variable)
    using the remaining variables. In line three, we must add the constant required
    to generate an intercept coefficient:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过Python中的statsmodels库来举一个例子。为此，我们需要加载statsmodels库中的affairs数据集，使用剩余变量来建模儿童数量（`children`变量）。在第三行，我们必须添加生成截距系数所需的常数：
- en: '[PRE6]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'First, let’s numerically confirm there is over-dispersion present in the target
    variable:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们通过数值方法确认目标变量中存在过度离散：
- en: '[PRE7]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'We can see the variance is greater than the mean:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到方差大于均值：
- en: '`Mean count of children per marriage:` `1.3968740182218033`'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '`每对婚姻的平均孩子数:` `1.3968740182218033`'
- en: '`Variance of the count of children per marriage:` `2.054838616333698`'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '`每对婚姻孩子数的方差:` `2.054838616333698`'
- en: 'Here, we can see that the conditional mean per marriage is smaller than the
    conditional variance. While not a massive difference, it is enough to consider
    using negative binomial regression. Let’s visually observe the distribution of
    the response:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到每对婚姻的条件均值小于条件方差。虽然这不是一个巨大的差异，但足以考虑使用负二项式回归。让我们直观地观察响应的分布：
- en: '![Figure 8.10 – Distribution of children](img/B18945_08_010.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![图8.10 – 孩子的分布](img/B18945_08_010.jpg)'
- en: Figure 8.10 – Distribution of children
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.10 – 孩子的分布
- en: 'The first five rows of the data can be seen here. Note that the first column
    of the design matrix should always contain the constant:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 可以在这里看到数据的前五行。请注意，设计矩阵的第一列应始终包含常数：
- en: '![Figure 8.11 – First five records of example data set, including the added
    constant](img/B18945_08_11.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![图8.11 – 示例数据集的前五条记录，包括添加的常数](img/B18945_08_11.jpg)'
- en: Figure 8.11 – First five records of example data set, including the added constant
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.11 – 示例数据集的前五条记录，包括添加的常数
- en: 'In our visual inspection of the distribution of children in *Figure 8**.10*,
    we identified that there is a value of 5.5 for children. This may be the result
    of averaging or an error. A subject matter expert may help determine this, but
    for our analysis, let’s assume it was a mistake and round to a whole number of
    children since people are not fractional. Let’s set up the target array, *y*,
    and design matrix, *X*:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们对*图8**.10*中孩子分布的视觉检查中，我们识别出孩子的值为5.5。这可能是由平均值计算或错误导致的。一个主题专家可能有助于确定这一点，但为了我们的分析，让我们假设这是一个错误，并将孩子数四舍五入到整数，因为人们不是分数。让我们设置目标数组*y*和设计矩阵*X*：
- en: '[PRE8]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Now, let’s create a train and test split for regression modeling. Note that
    `shuffle=True` will provide different results. To obtain a representative sample,
    the data should be randomly shuffled:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们为回归建模创建一个训练集和测试集分割。请注意，`shuffle=True`将提供不同的结果。为了获得代表性样本，数据应该随机打乱：
- en: '[PRE9]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Because the negative binomial model is based on a Poisson-gamma mixture model,
    we need to estimate the model’s measure of over-dispersion using a Poisson model.
    A method referred to as **auxiliary OLS regression (without constant)** is provided
    by A. Colin Cameron and Pravin K. Trivedi in *Microeconometrics: Methods and Applications*.
    The authors propose the creation of an over-dispersion test statistic where the
    null hypothesis is α=0 and the alternate hypothesis is α ≠ 0, where *α* is the
    estimate of over-dispersion. The auxiliary OLS regression formula is as follows:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 因为负二项式模型基于泊松-伽马混合模型，我们需要使用泊松模型来估计模型的过度分散度量。A. Colin Cameron和Pravin K. Trivedi在*微观计量经济学：方法和应用*中提供了一个称为**辅助OLS回归（无常数项）**的方法。作者提出了创建一个过度分散检验统计量，其中零假设是α=0，备择假设是α
    ≠ 0，其中*α*是过度分散的估计。辅助OLS回归公式如下：
- en: ( y i −  ˆ μ  i) 2 − y i  _  ˆ μ  i  = α  g(  ˆ μ  i) _  ˆ μ  i  + μ i
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ( y i −  ˆ μ  i) 2 − y i  _  ˆ μ  i  = α  g(  ˆ μ  i) _  ˆ μ  i  + μ i
- en: Here, μ i is an error term and g(  ˆ μ  i) is  ˆ μ  i 2\. Thus, the right-hand
    operand reduces to α  ˆ μ  i + μ i. In terms of negative binomial regression,
    we consider the error to equal zero, so we can factor α in as the over-dispersion
    estimate.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，μ i 是一个误差项，g(  ˆ μ  i) 是  ˆ μ  i 2\. 因此，右手边的操作数简化为 α  ˆ μ  i + μ i。在负二项式回归的术语中，我们考虑误差为零，因此我们可以将α作为过度分散估计因子。
- en: 'In the following code, we have fit our training data to a generalized linear
    model using the Poisson model for the linkage. Then, we used the regression mean
    of the model to build the estimated auxiliary target variable. Because the method
    is “without constant,” we subtract 1 to remove the constant from the process:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下代码中，我们使用泊松模型对链接进行了广义线性模型的拟合。然后，我们使用模型的回归均值构建了估计的辅助目标变量。因为方法是“无常数项”，所以我们减去1以从过程中移除常数：
- en: '[PRE10]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'As we can see, the estimated dispersion for the negative binomial model is
    `0.622034`. Now, we need to assess if the auxiliary estimate is statistically
    significant. We can do this using the p-value from the OLS model:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，负二项式模型的估计分散度为`0.622034`。现在，我们需要评估辅助估计的统计显著性。我们可以使用OLS模型的p值来完成此操作：
- en: '[PRE11]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This will print the following output:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 这将打印以下输出：
- en: '![Figure 8.12 – OLS regression results](img/B18945_08_12.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.12 – OLS 回归结果](img/B18945_08_12.jpg)'
- en: Figure 8.12 – OLS regression results
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.12 – OLS 回归结果
- en: 'Because the coefficient is significant and greater than 0, we can confirm the
    model has over-dispersion based on the target. The coefficient can be used as
    the measure for that over-dispersion in the negative binomial model, which we
    can use to adjust the variance in the `alpha` argument here:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 因为系数显著且大于 0，我们可以根据目标确认模型具有过度分散。该系数可以用作在负二项模型中衡量这种过度分散的指标，我们可以用它来调整此处`alpha`参数中的方差：
- en: '[PRE12]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The output is generated as follows:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 输出如下生成：
- en: '![Figure 8.13 – Generalized linear model regression results](img/B18945_08_13.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.13 – 广义线性模型回归结果](img/B18945_08_13.jpg)'
- en: Figure 8.13 – Generalized linear model regression results
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.13 – 广义线性模型回归结果
- en: 'Finally, let’s use the model we built on the training data to predict the training
    data, then again to predict on the test data so that we can compare generalizability
    on unseen data using residual error as a basis of comparison:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们使用我们在训练数据上构建的模型来预测训练数据，然后再在测试数据上预测，以便我们可以使用残差误差作为比较的基础来比较未见数据的泛化能力：
- en: '[PRE13]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'We can observe from the root mean squared error that the model’s performance
    is approximately constant across training and test data, indicating a consistent
    model:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以从均方根误差中观察到，模型的性能在训练数据和测试数据中大致保持不变，表明模型是一致的：
- en: '`Training Root Mean Squared` `Error: 1.2553439918425695`'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '`训练均方根误差：1.2553439918425695`'
- en: '`Testing Root Mean Squared` `Error: 1.266620561303553`'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '`测试均方根误差：1.266620561303553`'
- en: Summary
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we explained the issue of encountering negative raw probabilities
    that are generated by building a binary classification probability model based
    strictly on linear regression, where probabilities in a range of [0, 1] are expected.
    We provided an overview of the log-odds ratio and probit and logit modeling using
    the cumulative distribution function of both the standard normal distribution
    and logistic distribution, respectively. We also demonstrated methods for applying
    logistic regression to solve binary and multinomial classification problems. Lastly,
    we covered count-based regression using the log-linear Poisson and negative binomial
    models, which can also be logically extended to rate data without modification.
    We provided examples of their implementations.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们解释了在严格基于线性回归构建二元分类概率模型时遇到负的原始概率的问题，其中期望概率在[0, 1]范围内。我们分别概述了使用标准正态分布和对数逻辑分布的累积分布函数的对数优势比和probit及logit建模。我们还展示了将逻辑回归应用于解决二元和多项分类问题的方法。最后，我们介绍了使用对数线性泊松和负二项模型进行的基于计数的回归，这些模型也可以在不做修改的情况下逻辑上扩展到速率数据。我们提供了它们实现的示例。
- en: In the following chapter, we will introduce conditional probability using Bayes’
    theorem in addition to dimension reduction and classification modeling using linear
    discriminant analysis and quadratic discriminant analysis.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍使用贝叶斯定理的条件概率，以及使用线性判别分析和二次判别分析进行降维和分类建模。

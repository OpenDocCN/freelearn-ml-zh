- en: '*Chapter 6*'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第6章*'
- en: Anomaly Detection
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 异常检测
- en: Learning Objectives
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 学习目标
- en: 'By the end of this chapter, you will be able to:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，你将能够：
- en: Use parametric and non-parametric methods to find outliers in univariate and
    multivariate data
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用参数和非参数方法在单变量和多变量数据中寻找异常值
- en: Use data transformations to identify outliers in univariate and multivariate
    data
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用数据转换来识别单变量和多变量数据中的异常值
- en: Work with Mahalanobis distances
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用马氏距离工作
- en: Improve anomaly detection performance by incorporating a model of seasonality
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过结合季节性模型来提高异常检测性能
- en: In this chapter, we will have a look at different anomaly detection techniques.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨不同的异常检测技术。
- en: Introduction
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 简介
- en: Data analysis often begins with an implicit assumption that all observations
    are valid, accurate, and trustworthy. But this is not always a reasonable assumption.
    Consider the case of credit card companies, who collect data consisting of records
    of charges to an individual's credit card. If they assumed that all charges were
    valid, they would open the door to thieves and fraudsters to take advantage of
    them. Instead, they examine their transaction datasets and look for anomalies
    – transactions that deviate from the general observed pattern. Since fraudulent
    transactions are not labeled, they have to use unsupervised learning to find these
    anomalies and prevent criminal activity.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 数据分析通常隐含地假设所有观测值都是有效、准确和可靠的。但这种情况并不总是合理的假设。考虑信用卡公司的例子，他们收集的数据包括个人信用卡的消费记录。如果他们假设所有消费都是有效的，那么就会给盗贼和欺诈者可乘之机。相反，他们检查他们的交易数据集，寻找异常情况——即偏离一般观察模式的交易。由于欺诈交易没有标记，他们必须使用无监督学习来寻找这些异常情况，以防止犯罪活动。
- en: There are many other situations in which anomaly detection is useful. For example,
    manufacturers may use anomaly detection methods to find defects in their products.
    Medical researchers may look for anomalies in otherwise regular heartbeat patterns
    to diagnose illnesses. IT security professionals try to find anomalous activities
    on servers or computers to identify malware. In each case, unsupervised learning
    methods can help separate the valid observations from the anomalous ones.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多其他情况下，异常检测都是有用的。例如，制造商可能使用异常检测方法来寻找产品中的缺陷。医学研究人员可能在正常的心跳模式中寻找异常，以诊断疾病。IT安全专业人员试图在服务器或计算机上找到异常活动，以识别恶意软件。在每种情况下，无监督学习方法都可以帮助区分有效观测值和异常观测值。
- en: This chapter will cover several anomaly detection techniques. We will begin
    by using parametric and non-parametric methods to find outliers in univariate
    and multivariate data. We will then discuss using data transformations to identify
    outliers in univariate and multivariate data. Next, we will have a look at Mahalanobis
    distances, a multivariate tool for anomaly detection. We will conclude the chapter
    with a discussion of using regression modeling to improve anomaly detection performance
    by incorporating a model of seasonality, and detection of contextual and collective
    anomalies.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将介绍几种异常检测技术。我们将首先使用参数和非参数方法来寻找单变量和多变量数据中的异常值。然后，我们将讨论使用数据转换来识别单变量和多变量数据中的异常值。接下来，我们将探讨马氏距离，这是一种用于异常检测的多变量工具。我们将通过讨论使用回归模型来提高异常检测性能，通过结合季节性模型和检测上下文和集体异常来完成本章。
- en: Univariate Outlier Detection
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 单变量异常值检测
- en: Anomaly detection is simplest in the univariate case, that is, when each observation
    is only one number. In this case, we might start by doing a common-sense check
    for anomalies by checking whether observations are missing, NULL, NA, or recorded
    as infinity or something that doesn't match the type of the rest of the observations.
    After performing this check, we can apply true unsupervised learning.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在单变量情况下，异常检测是最简单的，也就是说，每个观测值只是一个数字。在这种情况下，我们可能首先通过检查观测值是否缺失、NULL、NA，或者记录为无穷大或其他与观测值类型不匹配的内容来进行常识性检查。完成此检查后，我们可以应用真正的无监督学习。
- en: For univariate data, anomaly detection consists of looking for outliers. R's
    built-in `boxplot` function makes an initial exploratory check for outliers quite
    easy, as can be seen in the following exercise.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 对于单变量数据，异常检测包括寻找异常值。R的内置`boxplot`函数使得对异常值进行初步探索性检查变得非常容易，如下面的练习所示。
- en: 'Exercise 37: Performing an Exploratory Visual Check for Outliers Using R''s
    boxplot Function'
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习37：使用R的boxplot函数进行异常值探索性视觉检查
- en: For univariate data, anomaly detection consists of looking for outliers. R's
    built-in boxplot function makes an initial exploratory check for outliers quite
    easy, as demonstrated in this exercise. We will use a dataset called `mtcars`,
    which is built into R.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 对于单变量数据，异常检测包括寻找异常值。R的内置箱线图函数使得在本练习中演示的初始探索性异常值检查变得非常简单。我们将使用一个名为`mtcars`的数据集，它是R内置的。
- en: In this exercise, we will create a boxplot that you can see in Figure 6.3\.
    A boxplot is an important type of univariate plot. Here, the thick horizontal
    line around 3 indicates the median value in the data. The box surrounding this
    median line has a lower limit at the first quartile (the 25th percentile) and
    an upper limit at the third quartile (the 75th percentile). The vertical dotted
    lines extend to the lower and upper ends of all of the non-outlier data. These
    dotted lines are called the whiskers of the plot, so this type of plot is sometimes
    called a "box and whiskers" plot. Finally, the two observations that are represented
    as circular points near the top of the plot are (at least, according to R) outliers.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将创建一个可以在图6.3中看到的箱线图。箱线图是一种重要的单变量图。在这里，围绕3的粗水平线表示数据中的中位数。围绕这个中位线的箱子在第一四分位数（25百分位数）处有下限，在第三四分位数（75百分位数）处有上限。垂直虚线延伸到所有非异常数据的上下端。这些虚线被称为图的触须，因此这种类型的图有时被称为“箱线和触须”图。最后，在图顶部附近表示为圆形点的两个观察值（至少根据R的结果）是异常值。
- en: Percentiles can also be called **quantiles**, and we'll refer to them as such
    in this boxplot. A quantile is a point in the data that is greater than some fixed
    proportion of all data points. For example, a 0.1 quantile is an observation in
    the data that is greater than 10% of all observations, and less than the rest.
    The 0.25 quantile is also called the 25th percentile or the first quartile, and
    it is greater than 25% of the data, and the 75th percentile or 0.75 quantile is
    greater than 75% of the data. When we take an observation and find what proportion
    of observations it is greater than, that is called finding its quantile. When
    we take a quantile such as 0.25 and try to find an observation that corresponds
    to that quantile, we can call that taking an inverse quantile.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 百分位数也可以称为**分位数**，在本例中我们将使用“分位数”来指代箱线图。分位数是数据中的一个点，它大于所有数据点中的一些固定比例。例如，0.1分位数是数据中的一个观察值，它大于所有观察值的10%，而小于其余部分。0.25分位数也称为25百分位数或第一四分位数，它大于数据的25%，而75百分位数或0.75分位数大于数据的75%。当我们取一个观察值并找出它大于多少比例的观察值时，这被称为找到它的分位数。当我们取一个如0.25的分位数并试图找到一个与该分位数相对应的观察值时，我们可以称之为取逆分位数。
- en: 'To perform an exploratory visual check for outliers using R''s `boxplot` function,
    perform the following steps:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用R的`boxplot`函数进行异常值探索性视觉检查，请执行以下步骤：
- en: 'To load the data, open the R console and enter the following command:'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要加载数据，打开R控制台并输入以下命令：
- en: '[PRE0]'
  id: totrans-22
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Execute the following command to view the first six rows of the dataset:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行以下命令以查看数据集的前六行：
- en: '[PRE1]'
  id: totrans-24
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The output is as follows:'
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '![Figure 6.1: Top six rows of the mtcars dataset](img/C12628_06_01.jpg)'
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.1：mtcars数据集的前六行](img/C12628_06_01.jpg)'
- en: 'Figure 6.1: Top six rows of the mtcars dataset'
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.1：mtcars数据集的前六行
- en: 'You can find details about this dataset by executing the following in the R
    console:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以在R控制台中执行以下操作来查找有关此数据集的详细信息：
- en: '[PRE2]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The documentation is as follows:'
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 文档如下：
- en: '![Figure 6.2: Section of output](img/C12628_06_02.jpg)'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.2：输出部分](img/C12628_06_02.jpg)'
- en: 'Figure 6.2: Section of output'
  id: totrans-32
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.2：输出部分
- en: 'Create a boxplot of the weights of cars as follows:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按以下方式创建汽车重量的箱线图：
- en: '[PRE3]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The output will look like this:'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出将如下所示：
- en: '![Figure 6.3: Boxplot representing weight of cars](img/C12628_06_03.jpg)'
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.3：表示汽车重量的箱线图](img/C12628_06_03.jpg)'
- en: 'Figure 6.3: Boxplot representing weight of cars'
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.3：表示汽车重量的箱线图
- en: 'There appear to be two observations that R has classified as outliers that
    appear to have values higher than 5\. Note that these weights are measured in
    thousands of pounds, so actually these are weights higher than 5,000 pounds. We
    can determine these observations by running a simple filter on our data:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 看起来有两个观察值被R归类为异常值，它们的值似乎高于5。请注意，这些重量是以千磅为单位的，所以实际上这些重量高于5,000磅。我们可以通过在我们的数据上运行一个简单的过滤器来确定这些观察值：
- en: '[PRE4]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The output is as follows:'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下所示：
- en: '![Figure 6.4: Cars with weights greater than 5,000 pounds](img/C12628_06_04.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![图6.4：重量超过5,000磅的汽车](img/C12628_06_04.jpg)'
- en: 'Figure 6.4: Cars with weights greater than 5,000 pounds'
  id: totrans-42
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.4：重量超过5,000磅的汽车
- en: 'We can see that there are three models of car whose weights are higher than
    5,000 pounds. Since we only observed two outliers, we conclude that the Cadillac
    Fleetwood, the car model with the third-highest weight, is not one of the outliers.
    This leaves the other two: the Lincoln Continental and the Chrysler Imperial,
    as the car models that apparently have outlier weights. These car models, when
    compared to the other car models, constitute anomalies. A potential next step
    for a researcher is to investigate why these car models appear to have anomalously
    high car weights.'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到有三个车型的重量超过5,000磅。由于我们只观察到两个异常值，我们得出结论，重量第三高的凯迪拉克Fleetwood不是异常值。这留下了其他两个：林肯大陆和克莱斯勒帝国，作为显然具有异常重量的车型。与其他车型相比，这些车型构成了异常。研究人员的一个潜在下一步是调查为什么这些车型似乎具有异常高的汽车重量。
- en: In *Chapter 3*, *Probability Distributions*, we discussed different distributions
    that datasets tend to follow. Many datasets have so-called long tails or fat tails,
    meaning that a disproportionate amount of observations are very far from the mean
    – not necessarily because they are anomalous outliers, but only because of the
    nature of their distribution. Our standard for defining an outlier should change
    if we happen to be working with a dataset that follows a fat-tailed distribution.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在**第3章**，**概率分布**中，我们讨论了数据集倾向于遵循的不同分布。许多数据集都有所谓的长尾或胖尾，这意味着与平均值相差很大的观测值所占的比例不均衡——不一定是因为它们是异常的异常值，只是因为它们分布的性质。如果我们碰巧正在处理一个遵循胖尾分布的数据集，我们定义异常值的标准应该改变。
- en: In the following exercise, we will transform a dataset that follows a fat-tailed
    distribution and observe the changes in which observations are reported as outliers.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下练习中，我们将转换一个遵循胖尾分布的数据集，并观察哪些观测值被报告为异常值。
- en: 'Exercise 38: Transforming a Fat-Tailed Dataset to Improve Outlier Classification'
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习38：将胖尾数据集转换为改进异常值分类
- en: 'In the following exercise, we will transform a dataset that follows a fat-tailed
    distribution and observe the changes in which observations are reported as outliers.
    We will use the `rivers` dataset, which comes pre-loaded into R:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下练习中，我们将转换一个遵循胖尾分布的数据集，并观察哪些观测值被报告为异常值。我们将使用预加载到R中的`rivers`数据集：
- en: 'Load the dataset as follows:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照以下方式加载数据集：
- en: '[PRE5]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Execute the following command to view the first six observations of the dataset:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行以下命令以查看数据集的前六个观测值：
- en: '[PRE6]'
  id: totrans-51
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The output is as follows:'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE7]'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'You can see that the `rivers` dataset is a vector. You can find out more about
    it by typing this:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以看到`rivers`数据集是一个向量。你可以通过输入以下内容来了解更多关于它的信息：
- en: '[PRE8]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The documentation is as follows:'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 文档说明如下：
- en: '![Figure 6.5: Information of the rivers dataset](img/C12628_06_05.jpg)'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.5：河流数据集的信息](img/C12628_06_05.jpg)'
- en: 'Figure 6.5: Information of the rivers dataset'
  id: totrans-58
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.5：河流数据集的信息
- en: 'Observe the distribution of outliers. First, try a boxplot of the rivers data
    by running the following command:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 观察异常值的分布。首先，尝试通过运行以下命令来绘制河流数据的箱线图：
- en: '[PRE9]'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The boxplot looks like this:'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 箱线图看起来是这样的：
- en: '![Figure 6.6: Boxplot of the rivers dataset](img/C12628_06_06.jpg)'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.6：河流数据集的箱线图](img/C12628_06_06.jpg)'
- en: 'Figure 6.6: Boxplot of the rivers dataset'
  id: totrans-63
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.6：河流数据集的箱线图
- en: You can see that this boxplot looks different from the `mtcars` boxplot that
    we looked at previously. In particular, the box and whiskers take up a smaller
    portion of the plot, and a huge amount of the plot consists of observations that
    R has classified as outliers. However, outliers are not supposed to be extremely
    numerous in any datasets – by definition, they are supposed to be rare. When we
    observe a boxplot such as this, that presents many outliers that take up a large
    portion of the plot, we can reasonably conclude that our distribution is fat-tailed.
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以看到这个箱线图与之前我们查看的`mtcars`箱线图看起来不同。特别是，箱线和须占据了较小的绘图部分，而大量的绘图由R分类为异常值的观测值组成。然而，异常值在任何数据集中都不应该非常多——根据定义，它们应该是稀少的。当我们观察到这样的箱线图，其中包含许多占据绘图大部分的异常值时，我们可以合理地得出结论，我们的分布是胖尾分布。
- en: 'In order to get a better classification of outliers, it could be helpful to
    transform the data. Many datasets related to nature and natural phenomena are
    known to follow a log-normal distribution. If we take the logarithm of every observation,
    the resulting distribution will be normal (and therefore not fat-tailed). To transform
    the data, you can use the following command:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了得到更好的异常值分类，对数据进行转换可能有所帮助。许多与自然和自然现象相关的数据集已知遵循对数正态分布。如果我们对每个观测值取对数，得到的分布将是正态分布（因此不是厚尾分布）。要转换数据，可以使用以下命令：
- en: '[PRE10]'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Observe the boxplot of the transformed data. Finally, we can execute the following
    command to see the boxplot of the transformed data:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 观察转换数据的箱线图。最后，我们可以执行以下命令来查看转换数据的箱线图：
- en: '[PRE11]'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The boxplot will look as follows:'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 箱线图将如下所示：
- en: '![Figure 6.7: Boxplot of transformed dataset](img/C12628_06_07.jpg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![图 6.7：转换数据集的箱线图](img/C12628_06_07.jpg)'
- en: 'Figure 6.7: Boxplot of transformed dataset'
  id: totrans-71
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.7：转换数据集的箱线图
- en: As expected, the box and whiskers take up a greater proportion of the plot,
    and there are fewer observations that are classified as outliers. In this case,
    we can use the `log_rivers` plot instead of the `rivers` plot to classify outliers.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期，箱线和须线占据了更大的绘图比例，被分类为异常值的观测值更少。在这种情况下，我们可以使用 `log_rivers` 图而不是 `rivers` 图来分类异常值。
- en: 'The preceding exercise shows the importance of data preparation in anomaly
    detection. We can also attempt anomaly detection on a raw dataset. But sometimes,
    like in the example of `rivers` that we looked at, we can get different and better
    results by performing some simple data preparation. One thing to keep in mind
    is that there are many possible transformations of data. We have used the log
    transformation, but there are many others that could work. Another thing to keep
    in mind is that data preparation can be harmful as well as helpful: some data
    preparation methods, such as averaging and data smoothing, can cause us to throw
    out valuable information that will make our anomaly detection less effective.'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的练习展示了数据准备在异常检测中的重要性。我们也可以尝试在原始数据集上进行异常检测。但有时，就像我们之前看到的 `rivers` 示例一样，通过进行一些简单的数据准备，我们可以得到不同且更好的结果。需要注意的是，数据有多种可能的转换方式。我们已经使用了对数转换，但还有许多其他可能有效的方法。另一件需要注意的事情是，数据准备既有利也有弊：一些数据准备方法，如平均和数据平滑，可能会导致我们丢弃有价值的信息，从而使我们的异常检测效果降低。
- en: So far, we have relied on R's built-in outlier detection methods, and we have
    done simple visual inspections of boxplots to determine which observations were
    outliers. In the next exercise, we will determine which observations are outliers
    ourselves without using R's built-in outlier classification. We will be finding
    quantiles of the data – specifically the 0.25 and 0.75 quantiles.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们一直依赖于 R 的内置异常检测方法，并且我们已经通过简单的箱线图视觉检查来确定哪些观测值是异常值。在下一个练习中，我们将自己确定哪些观测值是异常值，而不使用
    R 的内置异常分类。我们将找到数据的分位数——具体来说是 0.25 和 0.75 分位数。
- en: 'Exercise 39: Finding Outliers without Using R''s Built-In boxplot Function'
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 39：不使用 R 的内置 boxplot 函数找出异常值
- en: 'In this exercise, we will determine which observations are outliers ourselves
    without using R''s built-in outlier classification. We will be finding quantiles
    of the data – specifically the .25 and .75 quantiles. We will use the `rivers`
    data again, which we used in the preceding exercise:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将自己确定哪些观测值是异常值，而不使用 R 的内置异常值分类。我们将找到数据的分位数——具体来说是 .25 和 .75 分位数。我们将再次使用
    `rivers` 数据，这是我们之前练习中使用的数据：
- en: 'Load the data by executing the following command:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过执行以下命令加载数据：
- en: '[PRE12]'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The interquartile range is the difference between the first quartile (the 25th
    percentile) and the third quartile (the 75th percentile). So, we can store the
    interquartile range in a variable called `interquartile_range` by running the
    following:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 四分位距是第一四分位数（25 百分位数）和第三四分位数（75 百分位数）之间的差值。因此，我们可以通过运行以下命令将四分位距存储在名为 `interquartile_range`
    的变量中：
- en: '[PRE13]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: In this case, we use `unname` to make sure that `interquartile_range` is just
    a number instead of a DataFrame or list or other data type. This will make it
    easier and more reliable to work with later.
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这种情况下，我们使用 `unname` 确保将 `interquartile_range` 只是一个数字，而不是 DataFrame、列表或其他数据类型。这将使后续的工作更容易且更可靠。
- en: 'Use the following command to check the interquartile range:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令检查四分位距：
- en: '[PRE14]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The output is as follows:'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE15]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The standard method in R''s boxplot function is to use 1.5 times the interquartile
    range as a limit to how far non-outlier observations can be dispersed. Then the
    upper limit of non-outliers is the third quartile plus 1.5 times the interquartile
    range, and the lower limit of non-outliers is the first quartile minus 1.5 times
    the interquartile range. We can calculate this as follows:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: R中boxplot函数的标准方法是使用1.5倍的四分位距作为非异常观察值可以分散的范围的上限。然后非异常值的上限是第三四分位数加1.5倍的四分位距，非异常值的下限是第一四分位数减去1.5倍的四分位距。我们可以这样计算：
- en: '[PRE16]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Our outliers are the observations that are above our `upper_limit` or below
    our `lower_limit`. We can determine these as follows:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们识别出的异常值是那些高于我们的`upper_limit`或低于我们的`lower_limit`的观察值。我们可以这样确定：
- en: '[PRE17]'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'This will output a list of observations that we classify as outliers:'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将输出一个我们将其分类为异常值的观察值列表：
- en: '[PRE18]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Note
  id: totrans-92
  prefs:
  - PREF_IND
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: This exercise uses the method that is used in R's boxplot function. But with
    unsupervised learning, there is always flexibility about the details of the methods.
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这个练习使用了R中boxplot函数所使用的方法。但在无监督学习中，关于方法细节的灵活性总是存在的。
- en: 'Another way to look for outliers would be to use the method in the preceding
    exercise, but to use a different value for the upper and lower limits. We could
    do this by changing the coefficient that we multiply by `interquartile_range`,
    as follows:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 另一种寻找异常值的方法是使用前一个练习中的方法，但使用不同的上限和下限值。我们可以通过改变乘以`四分位距`的系数来实现这一点，如下所示：
- en: '[PRE19]'
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: We have changed the coefficient from 1.5 to 3\. This change makes our method
    less likely to classify any particular observation as an outlier, because it increases
    the upper limit and decreases the lower limit.
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们已经将系数从1.5改为3。这种改变使得我们的方法不太可能将任何特定观察值分类为异常值，因为它增加了上限并降低了下限。
- en: In general, you can try to be creative about changing unsupervised learning
    methods in ways that you believe are reasonable and will lead to good results.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，你可以尝试以你认为合理且能导致良好结果的方式创造性地改变无监督学习方法。
- en: 'The method in the preceding exercise is what is called a **non-parametric**
    **method**. In statistics, there are some methods that are called parametric and
    others that are called non-parametric. Parametric methods make assumptions about
    the underlying distribution of data, for example, the assumption that the data
    follows a normal distribution. Non-parametric methods are meant to be free of
    these constraining assumptions. The method in the preceding exercise relies only
    on quantiles, so it does not make any assumptions about the distribution of the
    data or the parameters (such as mean and variance) that go with them. Because
    of this, we call it a non-parametric method. A parametric anomaly detection method,
    by contrast, is one that makes assumptions about the distribution of the data
    or its parameters (such as mean and variance). Please note, non-parametric methods
    and parametric methods are always looking for the same anomalies: there is no
    such thing as a parametric anomaly or a non-parametric anomaly, but only parametric
    methods and non-parametric methods. We will discuss a parametric anomaly detection
    method in the next exercise.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 前一个练习中的方法是所谓的**非参数**方法。在统计学中，有些方法被称为参数方法，而有些被称为非参数方法。参数方法对数据的潜在分布做出假设，例如，假设数据遵循正态分布。非参数方法旨在摆脱这些约束性假设。前一个练习中的方法仅依赖于分位数，因此它不对数据的分布或与之相关的参数（如均值和方差）做出任何假设。正因为如此，我们称之为非参数方法。相比之下，参数异常检测方法是一种对数据的分布或其参数（如均值和方差）做出假设的方法。请注意，非参数方法和参数方法总是在寻找相同的异常：不存在参数异常或非参数异常，只有参数方法和非参数方法。我们将在下一个练习中讨论参数异常检测方法。
- en: We will calculate something called a **z-score**. A z-score is a standardized
    measurement of how far an observation is from the mean. Each z-score is measured
    in units of standard deviations. So, a z-score of 0 means that an observation
    is 0 standard deviations away from the mean; in other words, it is equal to the
    mean. A z-score of 1 means that an observation is 1 standard deviation above the
    mean. A z-score of -2.5 means that an observation is 2.5 standard deviations below
    the mean. It is conventional in some contexts to consider observations that are
    more than two standard deviations away from the mean unusual or anomalous.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将计算一个称为**z分数**的东西。z分数是衡量观察值与平均值之间距离的标准测量。每个z分数都是以标准差为单位测量的。因此，z分数为0表示观察值与平均值相差0个标准差；换句话说，它等于平均值。z分数为1表示观察值比平均值高1个标准差。z分数为-2.5表示观察值比平均值低2.5个标准差。在某些情况下，将距离平均值两个标准差以上的观察值视为异常或异常是惯例。
- en: 'Exercise 40: Detecting Outliers Using a Parametric Method'
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习40：使用参数方法检测异常值
- en: 'In this exercise, we will investigate anomalies by looking for observations
    whose z-scores are greater than 2 or less than -2\. We will use the rivers dataset
    used in previous exercise:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将通过寻找z分数大于2或小于-2的观察值来调查异常。我们将使用前一个练习中使用的河流数据集：
- en: 'Load the data and determine the standard deviation as follows:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按如下方式加载数据并确定标准差：
- en: '[PRE20]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Determine z-scores for every observation by calculating how many standard deviations
    each observation is away from the mean:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过计算每个观察值与平均值相差多少个标准差来确定每个观察值的z分数：
- en: '[PRE21]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Determine which observations are outliers by selecting observations whose z-scores
    are greater than 2 or less than -2:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过选择z分数大于2或小于-2的观察值来确定哪些观察值是异常值：
- en: '[PRE22]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The output is as follows:'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE23]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: In this case, we can see that there are six rivers that are classified as outliers
    – all of them with z-scores higher than 2\. Here, `outliers` is perhaps a strong
    word for these anomalies, since a z-score of 2 is not particularly enormous. There
    is no strict rule about what defines an outlier, and whether to use the term will
    depend on the particular situation and context.
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这种情况下，我们可以看到有六条河流被归类为异常值——它们的z分数都高于2。在这里，“异常值”这个词可能对这些异常来说过于强烈，因为2的z分数并不特别巨大。没有严格的规则来定义异常值，是否使用这个术语将取决于具体情况和背景。
- en: '**Parametric anomaly** detection, as shown in this exercise, is common practice.
    However, its applicability depends on whether the parametric assumptions behind
    it are valid. In this case, we calculated a standard deviation and looked for
    outliers more than two standard deviations away from the mean. This practice is
    justified if the data comes from a Gaussian (normal) distribution. In this case,
    some evidence indicates that the rivers data does not come from a Gaussian distribution.
    For cases in which there is doubt about the distribution of the underlying data,
    a non-parametric or transformed method (as used in the previous exercises) could
    be more suitable.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '**参数异常**检测，如本练习所示，是一种常见做法。然而，其适用性取决于其背后的参数假设是否有效。在这种情况下，我们计算了标准差，并寻找了距离平均值两个标准差以上的异常值。如果数据来自高斯（正态）分布，这种做法是合理的。在这种情况下，一些证据表明河流数据并不来自高斯分布。对于对基础数据分布有疑问的情况，可以使用非参数方法或转换方法（如前几项练习中使用的）可能更合适。'
- en: Multivariate Outlier Detection
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 多变量异常检测
- en: All of the methods so far have focused on univariate outlier detection. However,
    in practice such data is actually rare. Most datasets contain observations about
    multiple attributes of data. In these cases, it is not clear how to calculate
    whether a point is an outlier or not. We can calculate a z-score on each individual
    dimension, but what should be done about observations whose z-scores are high
    on one dimension and low in the other, or relatively large in one dimension and
    average in the other? There is no easy answer. In these cases, we can calculate
    a multidimensional analogue of a z-score using something called **Mahalanobis**
    **distance**. Mahalanobis distance is a multidimensional analogue of a z-score.
    What that means is that it measures the distance between two points, but in special
    units that, just like a z-score, depend on the variance of the data. We will be
    better able to understand the meaning of a Mahalanobis distance after going through
    the following exercise.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止的所有方法都集中在单变量异常值检测。然而，在实践中，这样的数据实际上是罕见的。大多数数据集包含关于数据多个属性的调查。在这些情况下，不清楚如何计算一个点是否是异常值。我们可以对每个单独的维度计算z分数，但对于那些在一个维度上z分数高而在另一个维度上低，或者在一个维度上相对较大而在另一个维度上平均的观察值，我们应该怎么办？没有简单的答案。在这些情况下，我们可以使用称为**马氏**
    **距离**的东西来计算z分数的多维类似物。马氏距离是z分数的多维类似物。这意味着它测量两点之间的距离，但使用特殊的单位，就像z分数一样，依赖于数据的方差。在完成以下练习后，我们将更好地理解马氏距离的含义。
- en: 'Exercise 41: Calculating Mahalanobis Distance'
  id: totrans-114
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习41：计算马氏距离
- en: In this exercise, we will learn a new measurement that will eventually help
    us find which individuals are outliers compared to the general population when
    considering both their height and their weight. The expected output of this exercise
    will be a Mahalanobis distance for a single data point, measuring how far from
    the center of the data it is.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将学习一种新的测量方法，它最终将帮助我们找到在考虑身高和体重时，与一般人群相比哪些个体是异常值。这个练习的预期输出将是一个单一数据点的马氏距离，测量它距离数据中心的距离。
- en: Note
  id: totrans-116
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: For all the exercises and activities where we are importing external CSV files
    or images, go to **RStudio**-> **Session**-> **Set Working Directory**-> **To
    Source File Location**. You can see in the console that the path is set automatically.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 对于所有需要导入外部CSV文件或图像的练习和活动，请转到**RStudio**-> **会话**-> **设置工作目录**-> **到源文件位置**。您可以在控制台中看到路径已自动设置。
- en: 'In a later exercise, we will find the Mahalanobis distance for all the points
    in the dataset. We will then be able to use these measurements to classify which
    individuals are outliers compared to the general population when considering both
    their height and their weight:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在后续的练习中，我们将计算数据集中所有点的马氏距离。然后，我们可以使用这些测量结果来分类哪些个体在考虑身高和体重时与一般人群相比是异常值：
- en: Note
  id: totrans-119
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: This dataset is taken from the Statistics Online Computational Resource. You
    can find the dataset at [http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights](http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights).
    We have downloaded the file and saved it at [https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv](https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv).
    We have used the first 200 rows of the data.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 此数据集来自在线统计计算资源。您可以在[http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights](http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights)找到数据集。我们已经下载了文件并将其保存在[https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv](https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv)。我们使用了数据的前200行。
- en: 'Start by loading this in R. First, download it from our GitHub repository at
    [https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv](https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv).
    Then, save it to your computer in R''s working directory. Then, load it into R
    as follows:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，在R中加载此数据。首先，从我们的GitHub存储库[https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv](https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv)下载它。然后，将其保存在R的工作目录中。然后，按照以下方式将其加载到R中：
- en: '[PRE24]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'We have given the dataset the name `raw`. You can make sure the columns have
    the right names as follows:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们已经给数据集命名为`raw`。你可以确保列有正确的名称如下：
- en: '[PRE25]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Plot the data and observe the patterns:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制数据并观察模式：
- en: '[PRE26]'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The plot appears as follows:'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图形如下所示：
- en: '![Figure 6.8: Plot of height and weight](img/C12628_06_08.jpg)'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.8：身高和体重的图](img/C12628_06_08.jpg)'
- en: 'Figure 6.8: Plot of height and weight'
  id: totrans-129
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.8：身高和体重的图
- en: We can see that there is great variation in both heights and weights in this
    sample. Note that our univariate methods will not work in a straightforward way
    in this data. We could calculate a standard deviation or interquartile range for
    height, and find outliers for height. But the outliers for height will not necessarily
    be outliers for weight – they might be a normal weight, or exactly what is expected
    for weight. Similarly, outliers for weight might have completely average or expected
    heights. It is not immediately obvious how we should calculate "complete outliers,"
    or observations that are outliers in some holistic sense, taking into account
    both height and weight.
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们可以看到，在这个样本中，身高和体重都有很大的变化。请注意，我们的单变量方法在这个数据中不会直接起作用。我们可以计算身高的标准差或四分位数范围，并找到身高的异常值。但身高的异常值不一定是体重的异常值——它们可能是正常体重，或者正好符合体重的预期。同样，体重的异常值可能有完全平均或预期的身高。我们并不立即清楚如何计算“完全异常值”，或者说在某些整体意义上是异常的观测值，考虑到身高和体重两个方面。
- en: 'Next, we will calculate the multidimensional equivalent of the mean, called
    `centroid`:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将计算多维平均值的等价物，称为`centroid`：
- en: '[PRE27]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Calculate the distance between any given point and the centroid. As an example,
    we will choose the first observation in the dataset:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算任何给定点和质心之间的距离。作为一个例子，我们将选择数据集中的第一个观测值：
- en: '[PRE28]'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Calculate the inverse of the covariance matrix of our data. First, we calculate
    the covariance matrix of our height and weight data:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算我们数据中身高和体重协方差矩阵的逆。首先，我们计算身高和体重数据的协方差矩阵：
- en: '[PRE29]'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Calculate its inverse using the `solve` function, which calculates matrix inverses
    in R:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用R中的`solve`函数计算其逆，该函数用于计算矩阵逆：
- en: '[PRE30]'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Calculate the Mahalanobis distance between our point and the centroid of our
    dataset:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算我们的点和数据集质心之间的马氏距离：
- en: '[PRE31]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: In this case, we use `%*%` because it indicates matrix multiplication, which
    is what we want to perform, and we likewise need to turn every argument into a
    numeric matrix.
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这个情况下，我们使用 `%*%` 因为它表示矩阵乘法，这正是我们想要执行的，我们同样需要将每个参数转换为一个数值矩阵。
- en: 'The output of this exercise is a Mahalanobis distance, which is a generalization
    of a z-score in multiple dimensions: that is, a generalized measure of how many
    standard deviations each point is away from the mean. In this case, the Mahalanobis
    distance we found is 1.71672\. Mahalanobis distances are like any type of distance
    measurement – 0 is the lowest possible measurement and the higher the number,
    the farther the distance. Only the centroid will have a measured Mahalanobis distance
    of 0\. The advantage of Mahalanobis distances is that they are standardized in
    a way that takes into account the variances of each variable and makes them effective
    for outlier detection. Later on in this chapter, we will see how to use this type
    of measurement to find outliers in this multi-dimensional dataset.'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这个练习的输出是一个马氏距离，它是多维z分数的推广：也就是说，它是衡量每个点距离均值多少个标准差的广义度量。在这种情况下，我们找到的马氏距离是1.71672。马氏距离类似于任何类型的距离测量——0是最低可能的测量值，数值越高，距离越远。只有质心会有测量的马氏距离为0。马氏距离的优势在于它们是以一种考虑了每个变量的方差的方式进行标准化的，这使得它们在异常值检测中非常有效。在本章的后面部分，我们将看到如何使用这种类型的测量来找到这个多维数据集中的异常值。
- en: Detecting Anomalies in Clusters
  id: totrans-143
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在簇中检测异常
- en: In the first two chapters, we discussed the different clustering methods. The
    method we are discussing now, Mahalanobis distances, could be used fruitfully
    in clustering applications, if you imagine that the data we are looking at is
    the data corresponding to one particular cluster. For example, in divisive clustering,
    the point with the highest Mahalanobis distance could be selected as the point
    to remove from a cluster. Also, the range of Mahalanobis distances could be used
    to express the dispersion of any given cluster.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在前两章中，我们讨论了不同的聚类方法。我们现在讨论的方法，马氏距离，如果想象我们正在查看的数据是某个特定聚类的数据，就可以在聚类应用中非常有用。例如，在划分聚类中，具有最高马氏距离的点可以被选为从聚类中移除的点。此外，马氏距离的范围可以用来表示任何给定聚类的分散程度。
- en: Other Methods for Multivariate Outlier Detection
  id: totrans-145
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 多变量异常值检测的其他方法
- en: There are other methods for multivariate outlier detection, including some that
    are known as **non-parametric** methods. Non-parametric methods, like some of
    the preceding exercises, may rely on quantiles, or in other words, the rank of
    each observation from largest to smallest, in order to classify outliers. Some
    non-parametric methods use the sums of such rankings to understand the distribution
    of data. However, such methods are not common and are not more effective than
    Mahalanobis distances in general, so we recommend relying on Mahalanobis distance
    for multivariate outlier detection.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 对于多变量异常值检测，还有其他方法，包括一些被称为**非参数**的方法。与非参数方法一样，一些先前的练习可能依赖于分位数，换句话说，从大到小排列每个观测值的排名，以分类异常值。一些非参数方法使用此类排名的总和来理解数据的分布。然而，这些方法并不常见，并且在一般情况下并不比马氏距离更有效，因此我们建议在多变量异常值检测中依赖马氏距离。
- en: 'Exercise 42: Classifying Outliers based on Comparisons of Mahalanobis Distances'
  id: totrans-147
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习42：基于马氏距离比较分类异常值
- en: 'In this exercise, we will use a comparison of Mahalanobis distances to classify
    outliers. This exercise is a continuation of the previous exercise, and it will
    rely on the same dataset and some of the same variables. In that exercise, we
    found the Mahalanobis distance for one data point; now we''re going to find it
    for all the data points. Before executing the following exercise, you should run
    all of the code in the previous exercise and make sure you are familiar with the
    ideas presented there:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将使用马氏距离的比较来分类异常值。这个练习是之前练习的延续，它将依赖于相同的数据库和一些相同的变量。在那个练习中，我们找到了一个数据点的马氏距离；现在我们将为所有数据点找到它。在执行以下练习之前，您应该运行之前练习中的所有代码，并确保您熟悉那里提出的思想：
- en: Note
  id: totrans-149
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: This dataset is taken from the UCI Machine Learning Repository. You can find
    the dataset at [http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights](http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights).
    We have downloaded the file and saved it at [https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv](https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv).
    We have used the first 200 rows of the data.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 此数据集来自UCI机器学习仓库。您可以在[http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights](http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_Dinov_020108_HeightsWeights)找到数据集。我们已经下载了文件，并将其保存在[https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv](https://github.com/TrainingByPackt/Applied-Unsupervised-Learning-with-R/tree/master/Lesson06/Exercise41-42/heightsweights.csv)。
- en: 'Create a `NULL` variable that will hold each of our calculated distances:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个`NULL`变量，用于存储我们计算出的每个距离：
- en: '[PRE32]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Loop through each observation and find the Mahalanobis distance between it
    and the centroid of the data. The code inside this loop is taken from the previous
    exercise, where we learned how to calculate Mahalanobis distances:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 遍历每个观测值，并计算它与数据质心的马氏距离。此循环中的代码来自之前的练习，我们在那里学习了如何计算马氏距离：
- en: '[PRE33]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: After running this loop, we have a measured Mahalanobis distance for each of
    the points in our data.
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行此循环后，我们为数据中的每个点测量了马氏距离。
- en: 'Plot all observations that have particularly high Mahalanobis distances. In
    this case, we will say that particularly high means the highest 10% of Mahalanobis
    distances. This means all Mahalanobis distances that are higher than the 0.9 quantile
    of Mahalanobis distances, which we select in the following code:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制所有具有特别高 Mahalanobis 距离的观测值。在这种情况下，我们将特别高定义为 Mahalanobis 距离的最高 10%。这意味着所有高于
    Mahalanobis 距离的 0.9 分位数（我们将在以下代码中选择）的 Mahalanobis 距离：
- en: '[PRE34]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'The output is as follows:'
  id: totrans-158
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '![Figure 6.9: Observations with high Mahalanobis distances](img/C12628_06_09.jpg)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![图 6.9：具有高 Mahalanobis 距离的观测值](img/C12628_06_09.jpg)'
- en: 'Figure 6.9: Observations with high Mahalanobis distances'
  id: totrans-160
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.9：具有高 Mahalanobis 距离的观测值
- en: This plot shows solid red points for each point that is in the top 10% of Mahalanobis
    distances. We can see that some of them appear to be outliers both for height
    and for weight, and could be observed simply by performing our univariate outlier
    detection methods. However, many of the red points in the plot above are neither
    univariate outliers for height nor for weight. They are outliers only relative
    to the entire cloud of points, and Mahalanobis distances enable us to quantify
    and detect that.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 此图显示了 Mahalanobis 距离最高的 10% 的每个点的实心红色点。我们可以看到，其中一些在身高和体重方面似乎都是异常值，并且可以通过执行我们的单变量异常检测方法来观察到。然而，图表上许多红色点既不是身高的单变量异常，也不是体重的单变量异常。它们只是相对于整个点云的异常，而
    Mahalanobis 距离使我们能够量化并检测这一点。
- en: Detecting Outliers in Seasonal Data
  id: totrans-162
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在季节性数据中检测异常
- en: So far, we have only discussed outlier detection as a way to detect anomalies.
    However, anomaly detection consists of more than only outlier detection. Some
    anomalies cannot easily be detected as raw outliers. Next, we will look at seasonal,
    trended data. In this data, we want to find anomalies that occur specifically
    in the context of a seasonal trend or cycle.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们只讨论了异常检测作为一种检测异常的方法。然而，异常检测不仅仅包括异常检测。一些异常不容易被检测为原始异常。接下来，我们将查看季节性、趋势性数据。在这类数据中，我们希望找到在季节性趋势或周期背景下发生的异常。
- en: We will use data from the `expsmooth` package in R.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 R 中的 `expsmooth` 包的数据。
- en: The data we will use records the monthly number of visitors to Australia between
    1985 and 2005, measured in thousands of people.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用的数据记录了 1985 年至 2005 年间澳大利亚每月游客数量，以千人计。
- en: In the following exercise, we will be working with data that has a **time trend**.
    By time trend, we mean that over time, the observations tend to increase or decrease
    (in this case, they tend to increase). In order to detect outliers, we want to
    do something called **de-trending**. To de-trend data means to remove, as much
    as possible, its time trend so that we can find how much each observation deviates
    from the expected values.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下练习中，我们将处理具有**时间趋势**的数据。通过时间趋势，我们指的是随着时间的推移，观测值倾向于增加或减少（在这种情况下，它们倾向于增加）。为了检测异常，我们想要做的是**去趋势**。去趋势数据意味着尽可能去除其时间趋势，以便我们可以找到每个观测值与预期值的偏差程度。
- en: 'Exercise 43: Performing Seasonality Modeling'
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 43：执行季节性建模
- en: 'In this exercise, we will attempt to model this data to establish what we should
    regard as the expected values of the data, and what we should regard as deviations
    from expectations. The expected output is a set of error values, which we will
    use in a future exercise to classify outliers – the observations with the largest
    errors will be classified as the dataset''s outliers:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将尝试对数据进行建模，以确定我们应该将哪些视为数据的预期值，哪些视为与预期值的偏差。预期的输出是一组误差值，我们将在未来的练习中使用这些误差值来分类异常——误差最大的观测值将被分类为数据集的异常：
- en: 'First, load this data into R by executing the following commands:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，通过执行以下命令将此数据加载到 R 中：
- en: '[PRE35]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'The output is as follows:'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '![Figure 6.10: Plot of monthly visitors to Australia between 1985 and 2005](img/C12628_06_10.jpg)'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 6.10：1985 年至 2005 年间澳大利亚每月游客数量的图表](img/C12628_06_10.jpg)'
- en: 'Figure 6.10: Plot of monthly visitors to Australia between 1985 and 2005'
  id: totrans-173
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.10：1985 年至 2005 年间澳大利亚每月游客数量的图表
- en: 'Check the first six observations of the data as follows:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按以下方式检查数据的第一个六个观测值：
- en: '[PRE36]'
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'The output is as follows:'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE37]'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Check the last six observations as follows:'
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 按以下方式检查最后六个观测值：
- en: '[PRE38]'
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'The output is as follows:'
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE39]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Since dates can be hard to work with, we can assign a numeric variable that
    tracks the dates in order. We will call this variable `period` and define it as
    follows:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于日期可能难以处理，我们可以分配一个数值变量来跟踪日期的顺序。我们将把这个变量称为 `period` 并定义如下：
- en: '[PRE40]'
  id: totrans-183
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Combine the `visitors` data with the `period` variable we just created by putting
    them both into one DataFrame called `raw`:'
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`visitors`数据与刚刚创建的`period`变量结合，将它们都放入一个名为`raw`的DataFrame中：
- en: '[PRE41]'
  id: totrans-185
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'This step is technically supervised, rather than unsupervised, learning. In
    this case, we will use supervised learning, but only as an intermediate step on
    the way to doing unsupervised learning. To find the time trend in the data, we
    can run a linear regression relating the sales figures to the numeric time period
    as follows:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这一步在技术上属于监督学习，而不是无监督学习。在这种情况下，我们将使用监督学习，但仅作为进行无监督学习过程中的一个中间步骤。为了找到数据中的时间趋势，我们可以运行一个线性回归，将销售额与数值时间周期相关联，如下所示：
- en: '[PRE42]'
  id: totrans-187
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Next, we can obtain fitted values for this time trend, and store them as part
    of the `raw` DataFrame:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们可以获得这个时间趋势的拟合值，并将它们作为`raw` DataFrame的一部分存储：
- en: '[PRE43]'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'The process of de-trending means we subtract the predicted trend that we found
    in *Step 6*. The reason we do this is that we want to find anomalies in the data.
    If we keep the trend in the data, something that looks like an anomaly may actually
    be the expected result of a trend. By removing the trend from the data, we can
    be sure that observed anomalies are not the result of a trend. We can accomplish
    de-trending as follows:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 去趋势的过程意味着我们从第6步中找到的预测趋势中减去。我们这样做的原因是我们想找到数据中的异常值。如果我们保留数据中的趋势，看起来像异常的东西实际上可能是趋势的预期结果。通过从数据中去除趋势，我们可以确保观察到的异常不是趋势的结果。我们可以按照以下方式完成去趋势：
- en: '[PRE44]'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'We can draw a simple plot of the de-trended data as follows:'
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以绘制去趋势数据的一个简单图表如下：
- en: '[PRE45]'
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'The plot looks as follows:'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 绘图如下：
- en: '![Figure 6.11: Plot of the de-trended data](img/C12628_06_11.jpg)'
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.11：去趋势数据的绘图](img/C12628_06_11.jpg)'
- en: 'Figure 6.11: Plot of the de-trended data'
  id: totrans-196
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.11：去趋势数据的绘图
- en: In this plot, you should notice that there is no apparent left-to-right trend
    in the data, showing that we have successfully de-trended it.
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这个图表中，你应该注意到数据中没有明显的从左到右的趋势，这表明我们已经成功地去除了趋势。
- en: Our data records the monthly number of visitors to Australia. There are variations
    in temperature and weather across seasons in Australia, and it is reasonable to
    hypothesize that tourist visits could increase or decline depending on how favorable
    the weather tends to be in a particular month. There could even be variations
    in business or diplomatic visits to Australia that relate to seasons and weather
    changes throughout the year. So, it is reasonable to suppose that there are yearly
    patterns in visits to Australia. Our next step will be to remove these yearly
    patterns from our data.
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们的数据记录了澳大利亚每月的访客数量。澳大利亚的季节温度和天气有变化，因此合理地假设游客访问量可能会根据特定月份的天气是否宜人而增加或减少。甚至可能存在与季节和全年天气变化相关的商务或外交访问澳大利亚的变化。因此，合理地假设澳大利亚的访问量存在年度模式。我们的下一步将是将这些年度模式从我们的数据中去除。
- en: 'First, we create a matrix where each of the columns contains de-trended visitor
    data about a separate month of the year:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们创建一个矩阵，其中每一列包含关于一年中不同月份的去趋势访客数据：
- en: '[PRE46]'
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Take the mean of each column to get the mean of de-trended visitors in that
    particular month:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算每一列的平均值，以得到该特定月份去趋势访客的平均值：
- en: '[PRE47]'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'This gives us a vector with 12 values – one for each month of the year. Since
    we have 20 years of data, we repeat this vector 20 times:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这给我们一个包含12个值的向量——每年一个月。由于我们有20年的数据，我们将这个向量重复20次：
- en: '[PRE48]'
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Finally, we can obtain our de-trended, de-cycled data, which we will name `error`
    because random error is the only thing remaining after removing the time trends
    and yearly cycles in the data:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们可以获得去趋势、去周期的数据，我们将它命名为`error`，因为在移除了数据中的时间趋势和年度周期后，随机误差是唯一剩下的东西：
- en: '[PRE49]'
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'We can plot this to see what it looks like:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以绘制这个图表来查看其外观：
- en: '[PRE50]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'The plot looks as follows:'
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 绘图如下：
- en: '![Figure 6.12: Plot of the de-trended data](img/C12628_06_12.jpg)'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.12：去趋势数据的绘图](img/C12628_06_12.jpg)'
- en: 'Figure 6.12: Plot of the de-trended data'
  id: totrans-211
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.12：去趋势数据的绘图
- en: 'Plot all elements of seasonality modeling together. Finally, we can show all
    of the elements we have isolated from our seasonal data: a time trend, a yearly
    cycle, and random error:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将季节性建模的所有元素一起绘制。最后，我们可以展示我们从季节性数据中分离出的所有元素：时间趋势、年度周期和随机误差：
- en: '[PRE51]'
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'The output is as follows:'
  id: totrans-214
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '![Figure 6.13: Plot of elements of seasonality modelling](img/C12628_06_13.jpg)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![图6.13：季节性建模元素的绘图](img/C12628_06_13.jpg)'
- en: 'Figure 6.13: Plot of elements of seasonality modelling'
  id: totrans-216
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.13：季节性建模元素的绘图
- en: 'The three plots shown together in Figure 6.13 show a decomposition of the original
    data. The first plot shows the time trend, or in other words the overall pattern
    observed in the data that each month tends to have more visitors than the previous
    month. Of course, this is an oversimplification of the data, because there are
    also seasonal patterns: certain months tend to have more or fewer visitors than
    other months, irrespective of the overall trend. The second plot shows these seasonal
    patterns, which repeat in the same way year after year. Finally, the third plot
    shows the error, which is all of the variation in the data that is not captured
    by an overall time trend or by a seasonal pattern within each year. If you take
    the sum of all the data presented in these three plots, you will recover the original
    dataset. But in these three plots, we can see these elements decomposed, and this
    decomposition gives us a better understanding of how time trends, seasonality,
    and error interact to constitute the observed data.'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.13 中一起显示的三个图显示了原始数据的分解。第一个图显示了时间趋势，换句话说，就是数据中观察到的整体模式，即每个月的访问量往往比上个月多。当然，这是对数据的过度简化，因为也存在季节性模式：某些月份的访问量往往比其他月份多或少，无论整体趋势如何。第二个图显示了这些季节性模式，这些模式每年都以相同的方式重复。最后，第三个图显示了误差，这是数据中未被整体时间趋势或每年内的季节性模式捕获的所有变化。如果你将这三个图中呈现的所有数据相加，你将恢复原始数据集。但在这些三个图中，我们可以看到这些元素被分解，这种分解使我们更好地理解了时间趋势、季节性和误差如何相互作用，从而构成观察到的数据。
- en: This exercise enabled us to create a variable called `error` that we added to
    the raw data frame. Now that we have created the error vector, we can use standard
    anomaly detection to find anomalies in the data frame.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 这个练习使我们能够创建一个名为 `error` 的变量，并将其添加到原始数据框中。现在我们已经创建了误差向量，我们可以使用标准的异常检测来在数据框中找到异常。
- en: 'Exercise 44: Finding Anomalies in Seasonal Data Using a Parametric Method'
  id: totrans-219
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 44：使用参数方法在季节性数据中寻找异常
- en: 'In this exercise, we will do anomaly detection by finding the largest deviations
    from expected values:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将通过寻找与预期值的最大偏差来进行异常检测：
- en: 'Calculate the standard deviation of the error data calculated in the previous
    exercise:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算前一个练习中计算出的误差数据的标准差：
- en: '[PRE52]'
  id: totrans-222
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Find which data points are more than two standard deviations away from the
    mean value:'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找出哪些数据点距离平均值超过两个标准差：
- en: '[PRE53]'
  id: totrans-224
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Examine the observations that we have classified as outliers:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查我们已分类为异常的观察结果：
- en: '[PRE54]'
  id: totrans-226
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'The output is as follows:'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE55]'
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Low outliers are classified as follows:'
  id: totrans-229
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 低异常被分类如下：
- en: '[PRE56]'
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'The output is as follows:'
  id: totrans-231
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE57]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'We can plot these points as follows:'
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以如下绘制这些点：
- en: '[PRE58]'
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'The plot looks as follows:'
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图形如下所示：
- en: '![Figure 6.14: Plot of data classified as anomalies](img/C12628_06_14.jpg)'
  id: totrans-236
  prefs: []
  type: TYPE_IMG
  zh: '![图 6.14：被分类为异常的数据的图形](img/C12628_06_14.jpg)'
- en: 'Figure 6.14: Plot of data classified as anomalies'
  id: totrans-237
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.14：被分类为异常的数据的图形
- en: The plot shows all of our data and the points that we have classified as anomalies,
    with high anomalies plotted in red and low anomalies plotted in blue. You should
    note that not all of these points are immediately obvious as outliers. We have
    only been able to recognize them as outliers after doing the seasonality modeling
    exercise earlier, and determining expected values that the anomalies depart from.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 该图显示了所有我们的数据和我们已经分类为异常的点，高异常用红色表示，低异常用蓝色表示。你应该注意，并非所有这些点都立即明显是异常值。我们只是在之前进行的季节性建模练习中，确定了异常偏离的预期值后，才将它们识别为异常。
- en: 'Next, we will introduce two more types of anomalies: contextual and collective
    anomalies. In order to introduce these concepts, we will generate an artificial
    dataset that contains both contextual and collective anomalies.'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将介绍两种更多类型的异常：上下文异常和集体异常。为了介绍这些概念，我们将生成一个包含上下文和集体异常的人工数据集。
- en: Contextual and Collective Anomalies
  id: totrans-240
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 上下文和集体异常
- en: At around x=1 in Figure 6.15, you can see a single point that is quite far from
    its neighbors. This is an example of a **contextual anomaly**, and we will discuss
    what that means and how to detect these types of anomalies first. At around x=3.6,
    you can see a region where y is flat, with every value equal to 0\. Zero values
    are not anomalous in this data, but having so many of them together is anomalous.
    So, this collection of data is referred to as a **collective anomaly**.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 在图6.15中大约x=1的位置，你可以看到一个与邻居相当远的单独点。这是一个**上下文异常**的例子，我们将首先讨论这意味着什么以及如何检测这些类型的异常。在大约x=3.6的位置，你可以看到一个y值平坦的区域，每个值都等于0。在这个数据中，零值并不异常，但这么多零值放在一起就是异常。因此，这些数据被称作**集体异常**。
- en: We will consider contextual anomalies first. Contextual anomalies are observations
    that are considered anomalies only because of their neighbors. In the dataset
    we have just generated, there is one point at x=1 where y=0\. However, the values
    of y for x=0.99 and x=1.01 are close to 0.84, very far from 0 in this context.
    Contextual anomalies can be detected by finding observations that have anomalous
    distance from their neighbors, as we will see in the following exercise.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先考虑上下文异常。上下文异常是指仅因为其邻居而被认为是异常的观测值。在我们刚刚生成的数据集中，有一个点在x=1处，y=0。然而，x=0.99和x=1.01处的y值接近0.84，在这个上下文中与0相差甚远。上下文异常可以通过找到与邻居距离异常的观测值来检测，正如我们将在以下练习中看到的那样。
- en: 'Exercise 45: Detecting Contextual Anomalies'
  id: totrans-243
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习45：检测上下文异常
- en: The following exercise shows how to detect contextual anomalies in the dataset
    we have just introduced. Since contextual anomalies are observations that are
    very different from their neighbors, we need to do an explicit comparison of each
    observation with its neighbor. In order to do this, we calculate a first difference.
    A first difference is simply the value of an observation minus the value of the
    observation before it.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 以下练习展示了如何检测我们刚刚介绍的数据集中的上下文异常。由于上下文异常是与邻居非常不同的观测值，我们需要对每个观测值与其邻居进行显式比较。为了做到这一点，我们计算第一差分。第一差分简单地是观测值的值减去其前一个观测值的值。
- en: 'The expected outcome of this exercise will be the observations in the dataset
    that are contextual anomalies:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 本练习的预期结果将是数据集中那些具有上下文异常的观测值：
- en: 'We will generate an artificial dataset that contains both contextual and collective
    anomalies. The dataset can be generated by running the following code in the R
    console:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将生成一个包含上下文和集体异常的人工数据集。该数据集可以通过在R控制台中运行以下代码生成：
- en: '[PRE59]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'You can see what this data looks like by plotting `x` and `y` as follows:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以通过以下方式绘制`x`和`y`来查看这些数据的外观：
- en: '[PRE60]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'The output is as follows:'
  id: totrans-250
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '![Figure 6.15: Plot of generated dataset](img/C12628_06_15.jpg)'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.15：生成数据集的绘图](img/C12628_06_15.jpg)'
- en: 'Figure 6.15: Plot of generated dataset'
  id: totrans-252
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.15：生成数据集的绘图
- en: 'This plot shows a sine curve: a simple type of curve that begins at 0, and
    slopes gently upward and downward, finally returning to 0 again. This data is
    artificially generated; however, we might imagine that it represents observations
    of temperature: low in some months, climbing higher in some months, high in some
    months, and climbing downward in other months. Temperature and weather data often
    follow a pattern that can be modeled with a trigonometric curve such as a sine
    or cosine. We have altered our sine curve so that it includes some anomalous data.'
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此图显示了一个正弦曲线：一种从0开始，向上和向下轻轻倾斜，最终再次回到0的简单曲线。这些数据是人工生成的；然而，我们可以想象它代表了温度的观测值：在某些月份较低，在某些月份上升较高，在某些月份较高，在其他月份下降。温度和天气数据通常遵循可以用正弦或余弦等三角曲线建模的规律。我们已经修改了我们的正弦曲线，使其包含一些异常数据。
- en: 'Find the first difference for every observation at the same time as follows:'
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同时为每个观测值找到第一差分如下：
- en: '[PRE61]'
  id: totrans-255
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Create a boxplot of the first difference data:'
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建第一差分数据的箱线图：
- en: '[PRE62]'
  id: totrans-257
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'The resulting boxplot looks as follows:'
  id: totrans-258
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 结果箱线图如下所示：
- en: '![Figure 6.16: Boxplot of the first difference data](img/C12628_06_16.jpg)'
  id: totrans-259
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.16：第一差分数据的箱线图](img/C12628_06_16.jpg)'
- en: 'Figure 6.16: Boxplot of the first difference data'
  id: totrans-260
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.16：第一差分数据的箱线图
- en: This boxplot shows that nearly all first differences are very close to zero,
    while two outlier differences are far away from the rest. We can see from the
    first difference boxplot that the single high outlier is larger than 0.5.
  id: totrans-261
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此箱线图显示，几乎所有第一差分都非常接近零，而两个异常差分则远离其他数据。我们可以从第一差分箱线图中看到，单个高异常值大于0.5。
- en: 'You may notice that there are two apparent outliers in Figure 6.16, but only
    one single outlier apparent in Figure 6.15\. The reason for this is that Figure
    6.16 shows first difference data, and the single outlier in the data leads to
    two large first differences: the difference between the 99th and the 100th values,
    and the difference between the 100th and 101st values. One outlier observation
    in the original data has led to two outlier observations in the first difference
    data.'
  id: totrans-262
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可能会注意到图 6.16 中有两个明显的异常值，但在图 6.15 中只有一个明显的异常值。这是因为图 6.16 显示的是一阶差分数据，数据中的单个异常值导致了两个大的第一阶差异：第
    99 个和第 100 个值之间的差异，以及第 100 个和第 101 个值之间的差异。原始数据中的一个异常观察值导致了一阶差分数据中的两个异常观察值。
- en: 'Determine which observation corresponds to this outlier by using R''s useful
    `which` function:'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 R 的有用 `which` 函数确定哪个观察值对应于这个异常值：
- en: '[PRE63]'
  id: totrans-264
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: '`which` returns the value 100, indicating that it is the 100th observation
    that is a contextual anomaly. If we check, `y[100]` is equal to 0, and its neighbors
    are not, so we have successfully found the contextual anomaly.'
  id: totrans-265
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`which` 返回值为 100，表示它是第 100 个观察值，是一个上下文异常。如果我们检查，`y[100]` 等于 0，而其邻居不是，所以我们已经成功找到了上下文异常。'
- en: Next, we will discuss collective anomalies. In our x-y plot, we pointed out
    the 100 observations that were all equal to 0 around x=3.64\. A zero value is
    not in itself an anomaly in this dataset, but having 100 observations all equal
    to 0 is anomalous. The collection of 100 zero values together here is referred
    to as a collective anomaly. Collective anomalies are more difficult to detect
    than contextual anomalies, but we will attempt to detect them anyway in the following
    exercise.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将讨论集体异常。在我们的 x-y 图中，我们指出了在 x=3.64 处所有观察值都等于 0 的 100 个观察点。在这个数据集中，0 值本身并不是异常，但是有
    100 个观察值都等于 0 则是异常的。这里 100 个零值一起被称为集体异常。集体异常比上下文异常更难检测，但我们将尝试在下面的练习中检测它们。
- en: 'Exercise 46: Detecting Collective Anomalies'
  id: totrans-267
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 46：检测集体异常
- en: 'In the following exercise, we will detect collective anomalies in the dataset
    we created earlier. The expected outcome of this exercise is a list of observations
    that constitute collective anomalies:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的练习中，我们将检测我们之前创建的数据集中的集体异常。这个练习的预期结果是构成集体异常的观察值列表：
- en: 'In order to detect this kind of anomaly, we need to look for groups of observations,
    or neighborhoods, that contain no variation or only small variations. The following
    loop accomplishes this. It creates a vector that consists of the maximum value
    of two differences: the difference between an observation and the observation
    50 periods before, and the difference between an observation and the observation
    50 periods later. If the maximum of these differences is zero or very small, then
    we have detected a neighborhood that is extremely flat, a sign of this kind of
    collective anomaly. Here is the loop we will use:'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了检测这种异常，我们需要寻找包含没有变化或只有微小变化的观察值组或邻域。以下循环实现了这一点。它创建了一个向量，该向量由两个差异的最大值组成：一个观察值与其
    50 个周期前的观察值之间的差异，以及一个观察值与其 50 个周期后的观察值之间的差异。如果这些差异中的最大值是零或非常小，那么我们就检测到了一个极端平坦的邻域，这是这种集体异常的迹象。以下是我们将使用的循环：
- en: '[PRE64]'
  id: totrans-270
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: This loop has created a vector called `changes`. Each element of this vector
    measures the maximum difference observed between an observation and its neighbors
    50 observations away. Especially small values of the `changes` vector will indicate
    that we could have a collective anomaly consisting of a flat neighborhood.
  id: totrans-271
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这个循环创建了一个名为 `changes` 的向量。这个向量的每个元素都测量了一个观察值与其邻居之间观察到的最大差异，距离为 50 个观察点。`changes`
    向量中特别小的值将表明我们可能有一个由平坦邻域组成的集体异常。
- en: 'Now that we have a vector measuring neighborhood changes, we can create a simple
    boxplot, the same as we have done in previous exercises:'
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们有一个测量邻域变化的向量，我们可以创建一个简单的箱线图，就像我们在之前的练习中所做的那样：
- en: '[PRE65]'
  id: totrans-273
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'The output is as follows:'
  id: totrans-274
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '![Figure 6.17: Boxplot of neighborhood changes](img/C12628_06_17.jpg)'
  id: totrans-275
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 6.17：邻域变化的箱线图](img/C12628_06_17.jpg)'
- en: 'Figure 6.17: Boxplot of neighborhood changes'
  id: totrans-276
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6.17：邻域变化的箱线图
- en: We can see that there are many observations classified as outliers, which shows
    evidence of very low neighborhood changes.
  id: totrans-277
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们可以看到有很多被分类为异常值的观察值，这表明存在非常低的邻域变化。
- en: 'We can find which observation leads to this collective anomaly as follows:'
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以按照以下方式找到导致这种集体异常的观察值：
- en: '[PRE66]'
  id: totrans-279
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: The output is 364.
  id: totrans-280
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出为 364。
- en: 'We can verify that this is an index corresponding to the collective anomaly
    by checking the y value at that index:'
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过检查该索引处的 y 值来验证这是对应于集体异常的索引：
- en: '[PRE67]'
  id: totrans-282
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: So, y is 0, which is the value of y at the collective anomaly, providing evidence
    that we have found the right point.
  id: totrans-283
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 因此，y 的值为 0，这是集体异常处的 y 值，这为我们找到了正确的点提供了证据。
- en: Kernel Density
  id: totrans-284
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 核密度
- en: To conclude the chapter, we will discuss using kernel density estimates to perform
    outlier detection on a set of blood samples. **Kernel density** estimation provides
    a natural way to test whether a particular set of blood results are anomalous,
    even without having specialized knowledge of the particular blood test being used
    or even of medicine in general.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 为了结束本章，我们将讨论如何使用核密度估计在一系列血液样本上执行异常值检测。**核密度**估计提供了一种自然的方式来测试特定的血液检测结果是否异常，即使没有特定血液测试或医学的一般专业知识。
- en: 'Suppose that you are working at a doctor''s office and your boss asks you to
    do a new type of blood test on patients. Your boss wants to know if any of the
    patients have anomalous test results. However, you are not familiar with this
    new blood test and you do not know what normal and anomalous results are supposed
    to look like. All you have is a record of previous blood tests that your boss
    assures you are from normal patients. Suppose that these tests had the following
    results:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你在一个诊所工作，你的老板要求你对患者进行一种新的血液测试。你的老板想知道是否有任何患者的测试结果异常。然而，你对这种新的血液测试不熟悉，也不知道正常和异常结果应该是什么样子。你所拥有的只是老板向你保证来自正常患者的先前血液测试记录。假设这些测试的结果如下：
- en: '[PRE68]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Now suppose that your boss wants you to find anomalies (if any) in the following
    new blood test results:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 现在假设你的老板要求你找出以下新血液测试结果中的异常值（如果有的话）：
- en: '[PRE69]'
  id: totrans-289
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: In kernel density estimation, we model a dataset with a collection of kernels.
    For our purposes, the kernels will just be normal distributions with different
    means and variances. You can learn more about the normal distribution in *Chapter
    3*, *Probability Distributions*. We will suppose that our data has a density that
    is captured by a sum of normal distributions. Then, any data that appears to be
    inconsistent with the sum of normal distributions that we specify can be classified
    as an anomaly.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 在核密度估计中，我们使用一组核来建模数据集。对于我们的目的，核将只是具有不同均值和方差的正态分布。你可以在*第 3 章*，*概率分布*中了解更多关于正态分布的信息。我们将假设我们的数据具有由正态分布之和捕获的密度。然后，任何看起来与我们指定的正态分布之和不一致的数据都可以被分类为异常。
- en: When we calculate kernel density, we will have to specify something called **bandwidth**.
    Here, the bandwidth will be a measure of the variance of the normal distributions
    that we are using to model our data. If we specify a high bandwidth, we are assuming
    that the data is widely dispersed, and if we specify a low bandwidth, we are assuming
    that the data is largely contained in a relatively narrow range. This should become
    more clearer to you as you work through the following exercise.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们计算核密度时，我们必须指定一个叫做**带宽**的东西。在这里，带宽将是我们用来建模数据的正态分布的方差的度量。如果我们指定一个高的带宽，我们假设数据广泛分散，如果我们指定一个低的带宽，我们假设数据主要包含在一个相对较窄的范围内。随着你完成以下练习，这应该会变得更加清晰。
- en: 'Exercise 47: Finding Anomalies Using Kernel Density Estimation'
  id: totrans-292
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 练习 47：使用核密度估计寻找异常值
- en: 'In this exercise, we will cover how to find anomalies using kernel density
    estimation. The expected output of this exercise is a list of observations that
    constitute anomalies according to a kernel density estimation method:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个练习中，我们将介绍如何使用核密度估计寻找异常值。这个练习的预期输出是按照核密度估计方法构成异常的一组观测值列表：
- en: 'Specify our data and our parameters. For our data, we will use the `normal
    results` and `new results` we specified earlier:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定我们的数据和参数。对于我们的数据，我们将使用之前指定的`正常结果`和`新结果`：
- en: '[PRE70]'
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'Kernel density estimation relies on a parameter called `bandwidth`. For that,
    we will start with 25\. The choice of bandwidth will depend on your own preferences
    and also on the original data. If you are not sure, you can choose a bandwidth
    that is about the same size as the standard deviation of your data. In this case,
    we will choose 25, which is lower than the standard deviation of our data. You
    can set the bandwidth at 25 as follows:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 核密度估计依赖于一个称为`带宽`的参数。因此，我们将从25开始。带宽的选择将取决于您的个人偏好以及原始数据。如果您不确定，可以选择一个与您数据的标准差大致相同的带宽。在这种情况下，我们将选择25，这低于我们数据的标准差。您可以如下设置带宽为25：
- en: '[PRE71]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE71]'
- en: Note
  id: totrans-298
  prefs:
  - PREF_IND
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: You can feel free to experiment with other bandwidth values if you like.
  id: totrans-299
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果您喜欢，可以自由地尝试其他带宽值。
- en: 'Use R''s `density` function to obtain a kernel density estimate:'
  id: totrans-300
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用R的`density`函数来获得核密度估计：
- en: '[PRE72]'
  id: totrans-301
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'Plot the density estimate:'
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制密度估计：
- en: '[PRE73]'
  id: totrans-303
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'The resulting plot appears as follows:'
  id: totrans-304
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 生成的图表如下所示：
- en: '![Figure 6.18: Plot of density estimate](img/C12628_06_18.jpg)'
  id: totrans-305
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图6.18：密度估计图](img/C12628_06_18.jpg)'
- en: 'Figure 6.18: Plot of density estimate'
  id: totrans-306
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.18：密度估计图
- en: 'The shape of the graph in Figure 6.18 represents the distribution of our original
    data. You can learn more about probability distributions in *Chapter 3*, *Probability
    Distributions*. This distribution is called `bimodal`, which means that the data
    appears to cluster mainly around two points: most of the observations are close
    to either 100 or 200\. We will interpret an observation as an anomaly if its corresponding
    point on the distribution shown in Figure 6.18 shows that it is particularly unlikely.'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 图6.18中的图形形状代表我们原始数据的分布。您可以在*第3章*，*概率分布*中了解更多关于概率分布的信息。这个分布被称为`双峰分布`，这意味着数据似乎主要围绕两个点聚集：大多数观察值接近100或200。如果观察值在图6.18所示的分布中的对应点显示它特别不可能，我们将将其解释为异常。
- en: 'We can obtain density estimates for each of our new results. For each of the
    observations in `new_results`, we will calculate the density estimate according
    to the kernel illustrated in Figure 6.18\. We will store each of these density
    estimates in new variables as follows:'
  id: totrans-308
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以为我们的每个新结果获得密度估计。对于`new_results`中的每个观察，我们将根据图6.18中展示的核来计算密度估计。我们将按照以下方式将这些密度估计存储在新变量中：
- en: '[PRE74]'
  id: totrans-309
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'The output will be the heights on the graph from *Step 3* that corresponds
    to each of the x-values specified in the `new_results` vector. We can observe
    each of these values by printing them. Print `new_density_1` as follows:'
  id: totrans-310
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出将是图表上从*步骤 3*对应于`new_results`向量中指定的每个x值的的高度。我们可以通过打印来观察这些值。按照以下方式打印`new_density_1`：
- en: '[PRE75]'
  id: totrans-311
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'The output is as follows:'
  id: totrans-312
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE76]'
  id: totrans-313
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'Print `new_density_2` as follows:'
  id: totrans-314
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 按照以下方式打印`new_density_2`：
- en: '[PRE77]'
  id: totrans-315
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'The output is as follows:'
  id: totrans-316
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE78]'
  id: totrans-317
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'Print `new_density_3` as follows:'
  id: totrans-318
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 按照以下方式打印`new_density_3`：
- en: '[PRE79]'
  id: totrans-319
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'The output is as follows:'
  id: totrans-320
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE80]'
  id: totrans-321
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE80]'
- en: 'Print `new_density_4` as follows:'
  id: totrans-322
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 按照以下方式打印`new_density_4`：
- en: '[PRE81]'
  id: totrans-323
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'The output is as follows:'
  id: totrans-324
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE82]'
  id: totrans-325
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'Print `new_density_5` as follows:'
  id: totrans-326
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 按照以下方式打印`new_density_5`：
- en: '[PRE83]'
  id: totrans-327
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'The output is as follows:'
  id: totrans-328
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输出如下：
- en: '[PRE84]'
  id: totrans-329
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'We can plot these points on our density plot as follows:'
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以将这些点绘制在我们的密度图上如下：
- en: '[PRE85]'
  id: totrans-331
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE85]'
- en: 'The result of executing these commands is the following plot:![Figure 6.19:
    Points mapped on density plot'
  id: totrans-332
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行这些命令的结果如下所示：![图6.19：密度图上的点映射
- en: '](img/C12628_06_19.jpg)'
  id: totrans-333
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/C12628_06_19.jpg](img/C12628_06_19.jpg)'
- en: 'Figure 6.19: Points mapped on density plot'
  id: totrans-334
  prefs:
  - PREF_IND
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.19：密度图上的点映射
- en: 'This shows the same density plot we examined earlier, with five points added
    – one for each of the new results that we are examining to find anomalies. Each
    of the points shows the relative likelihood of each particular observation: points
    that have a higher estimated density value are more likely to be observed, while
    points that have a lower estimated density value are less likely to be observed
    and are therefore more likely to be anomalies. There is no strict rule about which
    observations are anomalies and which are not, but in general the observations
    whose estimated densities are closest to zero are most likely to be anomalies.'
  id: totrans-335
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这显示了之前我们检查过的相同密度图，增加了五个点——每个新结果对应一个，我们正在检查这些新结果以寻找异常值。每个点都显示了每个特定观察的相对可能性：具有更高估计密度值的点更有可能被观察到，而具有较低估计密度值的点不太可能被观察到，因此更有可能是异常值。关于哪些观察是异常值，哪些不是，没有严格的规则，但一般来说，估计密度值最接近零的观察最可能是异常值。
- en: Interpret the results to classify anomalies.
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解释结果以分类异常。
- en: Each of the density values appear quite close to zero. However, some are much
    closer to zero than others. In this case, the closer the density estimate is to
    zero, the more confident we are that the observation is an anomaly. In this case,
    we will choose a threshold value and say that blood test results whose kernel
    density estimates are lower than the threshold are anomalous, and results whose
    kernel density estimates are higher than the threshold are not anomalous. It seems
    that 0.001 is a reasonable threshold, since it separates the high-density values
    from the lowest-density values – the observations whose density values are lower
    than 0.001 appear on the plot shown in *Step 6* to be very unlikely. So, we will
    classify the blood test results 35 and 270 as anomalous results, and all of the
    others as reasonable, because we saw in step 4 that 35 and 270 corresponded to
    density estimates that were lower than 0.001.
  id: totrans-337
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 每个密度值看起来都相当接近零。然而，有些比其他更接近零。在这种情况下，密度估计值越接近零，我们越有信心认为观察结果是异常的。在这种情况下，我们将选择一个阈值值，并说那些核密度估计值低于阈值的血液检测结果是异常的，而那些核密度估计值高于阈值的检测结果不是异常的。看起来0.001是一个合理的阈值，因为它将高密度值与最低密度值分开——密度值低于0.001的观察结果在*步骤6*所示的图表中看起来非常不可能。因此，我们将血液检测结果35和270归类为异常结果，而其他所有结果都视为合理，因为我们看到在步骤4中，35和270对应的是低于0.001的密度估计值。
- en: So, the final output of our exercise is the conclusion that the blood test results
    35 and 270 are anomalies, while the rest of the blood test results are reasonable.
  id: totrans-338
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 因此，我们练习的最终结论是血液检测结果35和270是异常的，而其他所有血液检测结果都是合理的。
- en: Continuing in Your Studies of Anomaly Detection
  id: totrans-339
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 继续学习异常检测
- en: 'If you continue to learn about anomaly detection, you will find that there
    are a huge number of different anomaly detection techniques. However, all of them
    follow the same basic pattern that we have seen in our seasonality modeling example.
    Specifically, advanced anomaly detection usually consists of the following:'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你继续学习异常检测，你会发现有大量的不同异常检测技术。然而，所有这些技术都遵循我们在季节性建模示例中看到的基本模式。具体来说，高级异常检测通常包括以下内容：
- en: Specifying a model of what is expected
  id: totrans-341
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 指定预期的模型
- en: Calculating the difference between what is expected based on the model, and
    what is observed – this is called the error
  id: totrans-342
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 计算基于模型预期的值与观察到的值之间的差异——这被称为误差
- en: Using univariate outlier detection on the error vector to determine anomalies
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用单变量异常值检测对误差向量进行检测以确定异常
- en: 'The biggest difficulty comes in the first step: specifying a useful model of
    what is expected. In this case, we specified a seasonal model. In other cases,
    it will be necessary to specify models that take into account multi-dimensional
    image data, audio recordings, or complicated economic indicators or other complex
    attributes. The right way to set up models for those cases will require study
    of the particular domains from which the data is drawn. However, in each case,
    anomaly detection will follow the three-step bulleted pattern listed earlier.'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 最大的困难在于第一步：指定一个有用的预期模型。在这种情况下，我们指定了一个季节性模型。在其他情况下，将需要指定考虑多维图像数据、音频记录、复杂的经济指标或其他复杂属性的模型。为这些情况设置模型的方法将需要研究数据来源的特定领域。然而，在每种情况下，异常检测都将遵循前面列出的三个步骤的要点模式。
- en: 'Activity 14: Finding Univariate Anomalies Using a Parametric Method and a Non-parametric
    Method'
  id: totrans-345
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 活动十四：使用参数方法和非参数方法寻找单变量异常
- en: The aim of the activity is to find univariate anomalies using a parametric method.
    For this activity, we will use a dataset that is built in to R, called `islands`.
    If you execute `?islands` in R, you can find the documentation of this dataset.
    In this documentation, you can notice that this dataset contains the areas in
    thousands of square miles of landmasses on Earth that exceed 10,000 square miles.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 活动的目的是使用参数方法来寻找单变量异常。为此活动，我们将使用R中内置的数据集，称为`islands`。如果你在R中执行`?islands`，你可以找到这个数据集的文档。在这个文档中，你可以注意到这个数据集包含了地球上面积超过10,000平方英里的陆地面积。
- en: 'This might be a dataset that would be of interest to a geologist who studied
    the formation of landmasses on earth. According to scientists, there are numerous
    ways that islands can form: sometimes through volcanic activity, sometimes through
    coral growth, and sometimes in other ways. A geologist might be interested in
    finding islands that are anomalously large or small – these islands might be the
    best places to do further research to try to understand the natural processes
    of island formation. In this activity, we will find anomalies in the `islands`
    dataset.'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能是一个对研究地球陆地形成过程的地质学家感兴趣的数据集。根据科学家的说法，岛屿可以通过多种方式形成：有时是通过火山活动，有时是通过珊瑚生长，有时是通过其他方式。地质学家可能对寻找异常大或小的岛屿感兴趣——这些岛屿可能是进行进一步研究以尝试理解岛屿自然形成过程的最佳地点。在这个活动中，我们将寻找`islands`数据集中的异常值。
- en: 'These steps will help you complete the activity:'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 这些步骤将帮助您完成活动：
- en: Load the data called `islands` in R's built-in datasets and create a boxplot
    of this data. What do you notice about the distribution of data and outliers?
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在R的内置数据集中加载名为`islands`的数据，并创建该数据的箱线图。您注意到数据分布和异常值有什么特点？
- en: Transform the `islands` data with a logarithm transformation and create a boxplot
    of this transformed data. How has this changed the data points that are classified
    as outliers?
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对`islands`数据进行对数变换，并创建变换后数据的箱线图。这如何改变了被分类为异常值的数据点？
- en: Calculate the outliers in the islands dataset manually using a non-parametric
    method (the method that defines outliers as points lying more than 1.5 times the
    interquartile range above or below the first and third quartiles, respectively).
    Do the same for the log transformation of the islands data.
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用非参数方法（该方法将异常值定义为位于第一四分位数和第三四分位数以上或以下1.5倍四分位距的点）手动计算`islands`数据集中的异常值。对`islands`数据的对数变换也进行同样的操作。
- en: Classify outliers in the `islands` dataset using a parametric method by calculating
    the mean and standard deviation of the data and classifying outliers as observations
    that are more than two standard deviations away from the mean. Do the same for
    the logarithm transformation of the islands data.
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用参数方法通过计算数据的均值和标准差来对`islands`数据集中的异常值进行分类，将异常值分类为距离均值超过两个标准差的观测值。对`islands`数据的对数变换也进行同样的操作。
- en: Compare the results of each of these outlier detection methods.
  id: totrans-353
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 比较这些异常值检测方法的结果。
- en: Note
  id: totrans-354
  prefs:
  - PREF_IND
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: The solution for this activity can be found on page 234.
  id: totrans-355
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 本活动的解决方案可在第234页找到。
- en: 'Activity 15: Using Mahalanobis Distance to Find Anomalies'
  id: totrans-356
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 活动十五：使用马氏距离寻找异常值
- en: In the following activity, we will examine data related to the speed and stopping
    distance of cars. This data might be useful to an automotive engineer who is trying
    to research which cars perform the best. Cars that have especially low stopping
    distance relative to their speeds can be used as examples of high-performing cars,
    while those that have anomalously high stopping distance relative to their speeds
    may be candidates for further research to find areas for improvement. In this
    activity, we will find anomalies based on both speed and stopping distance. Because
    we are working with multivariate data, it makes sense to use Mahalanobis distance
    to find anomalies.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的活动中，我们将检查与汽车速度和停车距离相关的数据。这些数据可能对试图研究哪些汽车表现最佳的汽车工程师有所帮助。那些相对于其速度具有特别低停车距离的汽车可以用作高性能汽车的例子，而那些相对于其速度具有异常高停车距离的汽车可能是进一步研究以寻找改进领域的候选者。在这个活动中，我们将基于速度和停车距离来寻找异常值。因为我们正在处理多变量数据，所以使用马氏距离来寻找异常值是有意义的。
- en: 'These steps will help you complete this activity:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 这些步骤将帮助您完成这项活动：
- en: Load the `cars` dataset from R's built-in datasets. This dataset contains the
    speed of some very old cars together with the distance required to stop at that
    speed. Plot the data.
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从R的内置数据集中加载`cars`数据集。这个数据集包含一些非常古老的汽车的速度以及在该速度下所需的停车距离。绘制数据图表。
- en: Calculate the centroid of this data, and calculate the Mahalanobis distance
    between each point and the centroid. Find the outliers (points whose Mahalanobis
    distance from the centroid is the highest). Draw a plot showing all the observations
    and the outliers plotted together.
  id: totrans-360
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算这些数据的质心，并计算每个点与质心之间的马氏距离。找出异常值（与质心的马氏距离最高的点）。绘制一个显示所有观测值和异常值的图表。
- en: 'The plot will look as follows:'
  id: totrans-361
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图表将如下所示：
- en: '![Figure 6.20: Plot with outliers marked](img/C12628_06_20.jpg)'
  id: totrans-362
  prefs: []
  type: TYPE_IMG
  zh: '![图6.20：标记了异常值的图表](img/C12628_06_20.jpg)'
- en: 'Figure 6.20: Plot with outliers marked'
  id: totrans-363
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6.20：标记了异常值的图表
- en: Note
  id: totrans-364
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 注意
- en: The solution for this activity is on page 237.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 本活动的解决方案在第237页。
- en: Summary
  id: totrans-366
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we have discussed anomaly detection. We began with univariate
    anomaly detection, including non-parametric and parametric approaches. We discussed
    performing data transformations to obtain better classifications of outliers.
    We then discussed multivariate anomaly detection using Mahalanobis distances.
    We completed more advanced exercises to classify anomalies related to seasonally
    varying data. We discussed collective and contextual anomalies, and concluded
    the chapter with a discussion of how to use kernel density estimation in anomaly
    detection.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了异常检测。我们首先介绍了单变量异常检测，包括非参数和参数方法。我们讨论了进行数据转换以获得更好的异常分类。然后，我们讨论了使用马氏距离的多变量异常检测。我们完成了更多高级练习，以分类与季节性变化数据相关的异常。我们讨论了集体和上下文异常，并在本章结束时讨论了如何在异常检测中使用核密度估计。

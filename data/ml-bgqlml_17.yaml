- en: '*Chapter 13*: Running TensorFlow Models with BigQuery ML'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第13章*：使用BigQuery ML运行TensorFlow模型'
- en: TensorFlow is one of the most used and relevant **Machine Learning** (**ML**)
    frameworks available. It allows data scientists and ML engineers to develop advanced
    models, and it also provides great flexibility and a rich set of mathematical
    functions.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: TensorFlow是最常用且相关的机器学习（ML）框架之一。它允许数据科学家和机器学习工程师开发高级模型，同时也提供了极大的灵活性和丰富的数学函数集。
- en: The advanced features that TensorFlow offers provide a huge opportunity for
    data analysts that want to leverage existing models developed by data scientists
    and ML engineers.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: TensorFlow提供的先进功能为想要利用数据科学家和机器学习工程师开发的现有模型的数据分析师提供了巨大的机会。
- en: Furthermore, the interoperability between BigQuery ML and TensorFlow represents
    a way to fill the gap between business and technical stakeholders within companies.
    The first group is usually more focused on in-depth knowledge of the data, while
    the second is technical-oriented and focused on programming skills.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，BigQuery ML与TensorFlow之间的互操作性代表了填补公司内部业务和技术利益相关者之间差距的一种方式。第一组通常更关注数据的深入知识，而第二组则更侧重于技术导向和编程技能。
- en: In this chapter, we'll learn what TensorFlow is and how it can be used with
    BigQuery ML. We'll understand how to export a BigQuery ML model into the TensorFlow
    format and how to run TensorFlow models using BigQuery ML SQL syntax.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将学习TensorFlow是什么以及如何与BigQuery ML一起使用。我们将了解如何将BigQuery ML模型导出为TensorFlow格式，以及如何使用BigQuery
    ML SQL语法运行TensorFlow模型。
- en: 'To understand how we can complement BigQuery ML with TensorFlow, we''ll cover
    the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解我们如何将BigQuery ML与TensorFlow相结合，我们将涵盖以下主题：
- en: Introducing TensorFlow
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍TensorFlow
- en: Discovering the relationship between BigQuery ML and TensorFlow
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索BigQuery ML与TensorFlow之间的关系
- en: Converting BigQuery ML models into TensorFlow
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将BigQuery ML模型转换为TensorFlow
- en: Running TensorFlow models with BigQuery ML
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用BigQuery ML运行TensorFlow模型
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter requires that you have access a web browser and can leverage the
    following:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章要求您能够访问网络浏览器并利用以下资源：
- en: A GCP account to access the Google Cloud Console
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP账户来访问Google Cloud控制台
- en: A GCP project to host BigQuery datasets
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP项目来托管BigQuery数据集
- en: A GCP project to host the Google Cloud storage bucket
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个GCP项目来托管Google Cloud存储桶
- en: Now that we've covered the technical requirements, let's start exploring BigQuery
    ML for TensorFlow models.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经涵盖了技术要求，让我们开始探索BigQuery ML用于TensorFlow模型。
- en: 'Check out the following video to see the Code in Action: [https://bit.ly/33ngmdf](https://bit.ly/33ngmdf)'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下视频以查看代码的实际应用：[https://bit.ly/33ngmdf](https://bit.ly/33ngmdf)
- en: Introducing TensorFlow
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍TensorFlow
- en: In this section, we'll introduce **TensorFlow**, its origins, and what this
    framework has achieved in the ML community.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍**TensorFlow**，其起源以及这个框架在机器学习（ML）社区中所取得的成就。
- en: '**TensorFlow** is an open source library that''s used to develop ML models.
    It''s very flexible and can be used to address a wide variety of use cases and
    business scenarios. Since TensorFlow is based on math functions, its name comes
    from the mathematical concept of the **Tensor**.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '**TensorFlow**是一个开源库，用于开发机器学习（ML）模型。它非常灵活，可以用于解决各种用例和业务场景。由于TensorFlow基于数学函数，其名称来源于数学概念**张量**。'
- en: In math, a **Tensor** is an algebraic object that describes a relationship between
    sets of other algebraic objects. Some examples of tensors are vectors and matrixes.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在数学中，**张量**是一个代数对象，它描述了其他代数对象集合之间的关系。张量的例子包括矢量和矩阵。
- en: The TensorFlow library was originally created by Google's engineers and then
    released under the Apache License in 2015\. Now, it is recognized as one of the
    most popular ML frameworks due to its potential and flexibility. In fact, a TensorFlow
    model can be executed on local machines, on-premises servers, in the cloud, or
    at the edge, such as on mobile phones and video surveillance cameras.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: TensorFlow库最初是由谷歌工程师创建的，并于2015年以Apache许可证发布。现在，由于其潜力和灵活性，它被认为是最受欢迎的机器学习（ML）框架之一。实际上，TensorFlow模型可以在本地机器、本地服务器、云中或边缘设备上执行，例如在手机和视频监控摄像头中。
- en: Important note
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: '**Edge computing** is a computing paradigm that brings the computation of business
    logic closer to the location where it is required. When a ML model runs at the
    edge, it is typically executed directly on the sensors or cameras that collect
    the data for the model to function without connecting to other systems.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**边缘计算**是一种将业务逻辑的计算更靠近所需位置的计算范式。当 ML 模型在边缘运行时，它通常直接在收集模型所需数据的传感器或摄像头上执行，而无需连接到其他系统。'
- en: 'TensorFlow is widely used by the ML community and is applied to solve different
    challenges in the artificial intelligence space, such as the following:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: TensorFlow 在 ML 社区中得到广泛应用，并应用于解决人工智能领域中的不同挑战，例如以下内容：
- en: 'Airbnb leverages TensorFlow to classify customers pictures, thus improving
    the virtual tours of houses to rent. For more details, you can visit the following
    link: https://medium.com/airbnb-engineering/categorizing-listing-photos-at-airbnb-f9483f3ab7e3.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Airbnb 利用 TensorFlow 对客户照片进行分类，从而改善了出租房屋的虚拟游览。更多详情，请访问以下链接：[https://medium.com/airbnb-engineering/categorizing-listing-photos-at-airbnb-f9483f3ab7e3](https://medium.com/airbnb-engineering/categorizing-listing-photos-at-airbnb-f9483f3ab7e3)。
- en: 'Google uses TensorFlow to empower its products, such as Google Search, Gmail,
    and Translate, with artificial intelligence capabilities. For more details, you
    can visit the following link: [https://ai.googleblog.com/search/label/TensorFlow](https://ai.googleblog.com/search/label/TensorFlow).'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Google 使用 TensorFlow 为其产品赋予人工智能能力，例如 Google 搜索、Gmail 和 Translate。更多详情，请访问以下链接：[https://ai.googleblog.com/search/label/TensorFlow](https://ai.googleblog.com/search/label/TensorFlow)。
- en: 'PayPal uses TensorFlow to prevent fraud and applies ML to increase the accuracy
    of its fraud detection models. For more details, you can visit the following link:
    [https://medium.com/paypal-engineering](https://medium.com/paypal-engineering).'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PayPal 使用 TensorFlow 来防止欺诈，并将 ML 应用于提高其欺诈检测模型的准确性。更多详情，请访问以下链接：[https://medium.com/paypal-engineering](https://medium.com/paypal-engineering)。
- en: 'Twitter leverages TensorFlow to identify and show the most relevant tweets
    to its users. For more details, you can visit the following link: https://blog.tensorflow.org/2019/03/ranking-tweets-with-tensorflow.html.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Twitter 利用 TensorFlow 识别并向用户展示最相关的推文。更多详情，请访问以下链接：[https://blog.tensorflow.org/2019/03/ranking-tweets-with-tensorflow.html](https://blog.tensorflow.org/2019/03/ranking-tweets-with-tensorflow.html)。
- en: Other interesting use cases can be found on the TensorFlow case studies web
    page at [https://www.tensorflow.org/about/case-studies?hl=en](https://www.tensorflow.org/about/case-studies?hl=en).
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 其他有趣的用例可以在 TensorFlow 案例研究网页上找到，网址为 [https://www.tensorflow.org/about/case-studies?hl=en](https://www.tensorflow.org/about/case-studies?hl=en)。
- en: Compared to what happens with BigQuery ML, advanced programming skills are required
    to develop a ML model using TensorFlow. In fact, the high flexibility of the TensorFlow
    library is balanced by the need to invest a certain amount of time in code development
    to create the model. Now, the suggested programming language to develop ML models
    with TensorFlow is Python.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 与 BigQuery ML 相比，使用 TensorFlow 开发 ML 模型需要高级编程技能。实际上，TensorFlow 库的高度灵活性是通过在代码开发上投入一定时间来创建模型的需求来平衡的。现在，建议使用
    Python 来开发 TensorFlow 的 ML 模型。
- en: Once the development and training phase of a TensorFlow model is completed,
    it can be exported into the **SavedModel** format.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦 TensorFlow 模型的开发和训练阶段完成，就可以将其导出为 **SavedModel** 格式。
- en: 'The **SavedModel** format contains the entire TensorFlow model. This format
    allows us to deploy the model without the need to run the code again in all the
    compatible environments. A SavedModel is composed of multiple files and folders
    stored in the same parent folder:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '**SavedModel** 格式包含整个 TensorFlow 模型。此格式允许我们在所有兼容环境中无需再次运行代码即可部署模型。SavedModel
    由多个文件和文件夹组成，这些文件和文件夹存储在同一个父文件夹中：'
- en: The SavedModel file stores the TensorFlow logic. This file is called `saved_model.pb`.
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SavedModel 文件存储 TensorFlow 逻辑。此文件称为 `saved_model.pb`。
- en: The `variables` directory contains the parameters of the trained model.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`variables` 目录包含训练模型的参数。'
- en: The `assets` folder can contain the external and additional files that are used
    by the ML model.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assets` 文件夹可以包含 ML 模型使用的外部和附加文件。'
- en: When a TensorFlow model is in the SavedModel format, it can be easily loaded
    and used on the platform where we want to use this model. The platform could be
    a physical server, a cloud instance, a smartphone, or an **Internet of Things**
    (**IoT**) device.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 当 TensorFlow 模型处于 SavedModel 格式时，它可以在我们希望使用此模型的平台轻松加载和使用。该平台可以是物理服务器、云实例、智能手机或
    **物联网**（**IoT**）设备。
- en: In this section, we introduced the basics of TensorFlow. In the next section,
    we'll discover how BigQuery ML is linked to TensorFlow.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们介绍了 TensorFlow 的基础知识。在下一节中，我们将探讨 BigQuery ML 如何与 TensorFlow 相关联。
- en: Discovering the relationship between BigQuery ML and TensorFlow
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索 BigQuery ML 和 TensorFlow 之间的关系
- en: In this section, we'll understand the relationship between BigQuery ML and TensorFlow.
    After completing this section, we'll be able to understand when to use BigQuery
    ML and TensorFlow according to our use case, but also how to get the best out
    of the two technologies, when they're used together.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解 BigQuery ML 和 TensorFlow 之间的关系。完成本节后，我们将能够根据我们的用例理解何时使用 BigQuery
    ML 和 TensorFlow，以及如何在使用这两种技术时获得最佳效果。
- en: Understanding commonalities and differences
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解共性和差异
- en: BigQuery ML and TensorFlow have some similar aspects, but there are also some
    relevant differences to highlight.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: BigQuery ML 和 TensorFlow 有一些相似之处，但也有一些相关的差异需要强调。
- en: 'In the following table, we have summarized the main similarities and differences
    of these two frameworks:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下表格中，我们总结了这两个框架的主要相似点和差异点：
- en: '![Figure 13.1 – Comparing BigQuery ML and TensorFlow'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.1 – 比较 BigQuery ML 和 TensorFlow'
- en: '](img/B16722_13_001.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_13_001.jpg]'
- en: Figure 13.1 – Comparing BigQuery ML and TensorFlow
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.1 – 比较 BigQuery ML 和 TensorFlow
- en: First, it is important to underline that TensorFlow offers greater flexibility
    in terms of the ML models that can be implemented. While BigQuery ML is characterized
    by a specific list of supported model types (https://cloud.google.com/bigquery-ml/docs/introduction#supported_models_in),
    TensorFlow offers a wider spectrum of ML techniques.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，重要的是要强调 TensorFlow 在实现 ML 模型方面提供了更大的灵活性。虽然 BigQuery ML 以其支持的特定模型类型列表（https://cloud.google.com/bigquery-ml/docs/introduction#supported_models_in）为特征，但
    TensorFlow 提供了更广泛的 ML 技术范围。
- en: BigQuery ML was designed as an extension of BigQuery and for this reason, it
    only focuses on structured data, which can be represented in a tabular format.
    All the BigQuery ML techniques are based on the possibility to train and apply
    the models to rows stored in BigQuery tables. On the other hand, TensorFlow is
    open to different formats, including free text, images, audio, and videos.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: BigQuery ML 被设计为 BigQuery 的扩展，因此它只关注结构化数据，这些数据可以用表格格式表示。所有 BigQuery ML 技术都是基于在
    BigQuery 表中存储的行上训练和应用模型的可能性。另一方面，TensorFlow 对不同的格式开放，包括自由文本、图像、音频和视频。
- en: To train, evaluate, and test BigQuery ML models, the user should know the SQL
    syntax and have minimal ML experience. Implementing a TensorFlow model, on the
    other hand, requires good programming skills and good knowledge of ML topics because
    the framework provides higher flexibility in terms of customization.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 要训练、评估和测试 BigQuery ML 模型，用户应了解 SQL 语法并具备基本的 ML 经验。另一方面，实现 TensorFlow 模型则需要良好的编程技能和对
    ML 主题的良好了解，因为该框架在定制方面提供了更高的灵活性。
- en: Considering the features of these two technologies, it is clear that they are
    addressed to different stakeholders in the companies. While BigQuery ML can easily
    be used by business analysts and data analysts that are familiar with data analytics
    tasks and SQL queries, TensorFlow is designed for advanced programmers, such as
    experienced data scientists and ML engineers.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到这两种技术的特点，很明显，它们针对的是公司中的不同利益相关者。虽然 BigQuery ML 可以轻松被熟悉数据分析任务和 SQL 查询的业务分析师和数据分析师使用，但
    TensorFlow 是为高级程序员设计的，例如经验丰富的数据科学家和 ML 工程师。
- en: Now that we have understood the commonalities and the differences of BigQuery
    ML and TensorFlow, in the next section, we'll learn how these two frameworks can
    complement each other.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经理解了 BigQuery ML 和 TensorFlow 的共性和差异，在下一节中，我们将学习这两个框架如何相互补充。
- en: Collaborating with BigQuery ML and TensorFlow
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 与 BigQuery ML 和 TensorFlow 协作
- en: In this section, we'll discover how to use BigQuery ML and TensorFlow together
    to get the maximum value from both technologies.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨如何结合使用 BigQuery ML 和 TensorFlow，以充分利用这两种技术。
- en: 'The following diagram shows the interactions between business analysts and
    data scientists using BigQuery ML and TensorFlow:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表显示了使用 BigQuery ML 和 TensorFlow 的业务分析师和数据科学家之间的交互：
- en: '![Figure 13.2 – Interactions between BigQuery ML and TensorFlow'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 13.2 – BigQuery ML 和 TensorFlow 之间的交互'
- en: '](img/B16722_13_002.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_13_002.jpg]'
- en: Figure 13.2 – Interactions between BigQuery ML and TensorFlow
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.2 – BigQuery ML 和 TensorFlow 之间的交互
- en: As we've described in [*Chapter 1*](B16722_01_Final_ASB_ePub.xhtml#_idTextAnchor016),
    *Introduction to Google Cloud and BigQuery*, the first steps of the ML development
    cycle are exploring the data and completely understanding it.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们在[*第一章*](B16722_01_Final_ASB_ePub.xhtml#_idTextAnchor016)中所述，“Google Cloud和BigQuery简介”，ML开发周期的第一步是探索数据并完全理解它。
- en: After this first phase of analysis, the data needs to be cleaned and prepared
    to train the ML algorithm. This phase is fundamental to creating a valuable ML
    model and proceeding on to the training stage.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在分析的第一阶段之后，需要对数据进行清理和准备，以便训练ML算法。这一阶段对于创建有价值的ML模型并进入训练阶段至关重要。
- en: 'When it''s time to actually develop the ML model, depending on our knowledge,
    background, and previous experience, we have two options:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 当真正开发ML模型时，根据我们的知识、背景和以往经验，我们有两种选择：
- en: If you are a business analyst or data analyst, you will prefer using BigQuery
    ML for its simplicity and immediacy thanks to the SQL syntax.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你是一名业务分析师或数据分析师，你将更喜欢使用BigQuery ML，因为它简单直观，得益于SQL语法。
- en: If you're a data scientist or a ML engineer, you will choose to train a TensorFlow
    model due to its flexibility and because it offers more opportunities for customization.
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你是一名数据科学家或ML工程师，你将选择训练一个TensorFlow模型，因为它具有灵活性，并且提供了更多定制的机会。
- en: As shown in the preceding diagram, the upper branch represents the typical workflow
    of a business or data analyst who leverages BigQuery ML SQL statements to create,
    evaluate, and use a ML model on data that's already been stored in BigQuery. This
    branch requires that you have good knowledge of the SQL language, the basics of
    ML, and the underlying data.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 如前图所示，上部分代表利用BigQuery ML SQL语句在已存储在BigQuery中的数据上创建、评估和使用ML模型的业务分析师或数据分析师的典型工作流程。这一部分要求你具备良好的SQL语言知识、ML基础知识以及底层数据。
- en: On the other hand, the lower branch of the diagram represents the development
    process based on a TensorFlow library that's been made by data scientists or ML
    engineers, who have a great experience in programming and ML algorithms.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，图的下部分代表基于由数据科学家或ML工程师创建的TensorFlow库的开发过程，这些人在编程和ML算法方面拥有丰富的经验。
- en: Typically, data analysts know the data very well but have little knowledge of
    the most advanced programming techniques, while data scientists and ML engineers
    have in-depth coding skills but a limited comprehension of the business data.
    This situation usually occurs in more established companies due to the employees
    having different professional backgrounds. This can cause friction between those
    who know the industry very well and the business processes where other people
    are more focused on programming.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，数据分析师对数据非常了解，但对最先进的编程技术知之甚少，而数据科学家和ML工程师具有深入的编码技能，但对业务数据的理解有限。这种情况通常发生在更成熟的公司中，因为员工具有不同的专业背景。这种情况通常会导致那些对行业非常了解的人和那些更专注于编程的业务流程之间产生摩擦。
- en: 'In order to reduce this gap and mitigate the risk of friction, BigQuery ML
    allows us to do the following:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 为了减少这种差距并减轻摩擦的风险，BigQuery ML允许我们做以下事情：
- en: Export the ML models that have been developed with BigQuery ML into the TensorFlow
    SavedModel format.
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将使用BigQuery ML开发的ML模型导出为TensorFlow SavedModel格式。
- en: Import TensorFlow ML models in the SavedModel format.
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入以SavedModel格式保存的TensorFlow ML模型。
- en: Looking at the preceding diagram, we can see that a business analyst can export
    BigQuery ML models and deploy them to other environments that are different from
    BigQuery and compatible with TensorFlow.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 观察前图，我们可以看到业务分析师可以将BigQuery ML模型导出并部署到与BigQuery不同但兼容TensorFlow的其他环境中。
- en: On the other hand, a data scientist who has implemented advanced TensorFlow
    models can save them into a Google Cloud storage bucket, which means they can
    be imported into BigQuery ML.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，已经实现了高级TensorFlow模型的数据科学家可以将它们保存到Google Cloud存储桶中，这意味着它们可以被导入到BigQuery
    ML中。
- en: 'This kind of bidirectional interaction between BigQuery ML and the TensorFlow
    framework allows us to do the following:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 这种BigQuery ML和TensorFlow框架之间的双向交互使我们能够做以下事情：
- en: Extend the applicability of a BigQuery ML model that is no longer confined to
    using data stored in BigQuery.
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扩展BigQuery ML模型的适用性，使其不再局限于使用存储在BigQuery中的数据。
- en: Import BigQuery ML advanced TensorFlow models that were not originally supported
    by the BigQuery ML syntax and use them, through SQL queries, on the data stored
    in BigQuery.
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 导入 BigQuery ML 高级 TensorFlow 模型，这些模型最初不支持 BigQuery ML 语法，并通过 SQL 查询在 BigQuery
    中使用它们。
- en: In this section, we learned how BigQuery ML and TensorFlow can interact and
    why it's so important to leverage this kind of integration. In the next section,
    we'll train a BigQuery ML model and export it in TensorFlow format.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了 BigQuery ML 和 TensorFlow 如何交互，以及为什么利用这种集成如此重要。在下一节中，我们将训练一个 BigQuery
    ML 模型并将其导出为 TensorFlow 格式。
- en: Converting BigQuery ML models into TensorFlow
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将 BigQuery ML 模型转换为 TensorFlow
- en: In this section, we'll train the same deep neural network that we trained in
    [*Chapter 11*](B16722_11_Final_ASB_ePub.xhtml#_idTextAnchor160), *Implementing
    Deep Neural Networks*, and then export this model into the TensorFlow SavedModel
    format.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将训练与我们在 [*第 11 章*](B16722_11_Final_ASB_ePub.xhtml#_idTextAnchor160) 的
    *实现深度神经网络* 部分中训练的相同深度神经网络，然后将其导出为 TensorFlow SavedModel 格式。
- en: Training the BigQuery ML to export it
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 训练 BigQuery ML 以导出它
- en: 'Before we start training the model, let''s access BigQuery to create the dataset
    and the tables that will be used for training and prediction:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始训练模型之前，让我们访问 BigQuery 来创建用于训练和预测的数据集和表格：
- en: Log into our Google Cloud Console and access the **BigQuery** user interface
    from the navigation menu.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录我们的 Google Cloud Console，并通过导航菜单访问 **BigQuery** 用户界面。
- en: Create a new dataset under the project that we' created in [*Chapter 2*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039),
    *Setting Up Your GCP and BigQuery Environment*. For this use case, we'll create
    a dataset called `13_tensorflow_model` with the default options.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们为 [*第 2 章*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039) 的 *设置您的 GCP
    和 BigQuery 环境* 创建的项目下创建一个新的数据集。对于此用例，我们将创建一个名为 `13_tensorflow_model` 的数据集，并使用默认选项。
- en: 'Now, we''re ready to create the table that will contain the training dataset.
    Let''s execute the following SQL statement:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们已经准备好创建一个包含训练数据集的表格。让我们执行以下 SQL 语句：
- en: '[PRE0]'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The result of this query is stored in the new `` `13_tensorflow_model.training_table`
    `` table that we created to support the following steps of our use case.
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此查询的结果存储在新的 `` `13_tensorflow_model.training_table` `` 表中，我们创建此表是为了支持我们用例的以下步骤。
- en: The business logic of this query is the same as what we applied in the *Preparing
    the dataset* section of [*Chapter 11*](B16722_11_Final_ASB_ePub.xhtml#_idTextAnchor160),
    *Implementing Deep Neural Networks*.
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此查询的业务逻辑与我们在 [*第 11 章*](B16722_11_Final_ASB_ePub.xhtml#_idTextAnchor160) 的 *准备数据集*
    部分中应用的逻辑相同。
- en: 'Now, we will create the table that will be used to test our ML model:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将创建一个用于测试我们的 ML 模型的表格：
- en: '[PRE1]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This query applies the same logic that was used to create the training table
    but only takes May 2018 into consideration.
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此查询应用了用于创建训练表的相同逻辑，但只考虑了 2018 年 5 月。
- en: 'Now, let''s train our ML model, which will be exported into TensorFlow format
    in the *Exporting the BigQuery ML model* section:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们训练我们的 ML 模型，该模型将在 *导出 BigQuery ML 模型* 部分中导出为 TensorFlow 格式：
- en: '[PRE2]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The business logic that was used to create the `` `13_tensorflow_model.bigquery_ml_model_to_export`
    `` ML model is the same logic we used to train the `CRELU` deep neural network
    in the *Training the deep neural network models* section of [*Chapter 11*](B16722_11_Final_ASB_ePub.xhtml#_idTextAnchor160),
    *Implementing Deep Neural Networks*.
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 创建 `` `13_tensorflow_model.bigquery_ml_model_to_export` `` ML 模型所使用的业务逻辑与我们在
    [*第 11 章*](B16722_11_Final_ASB_ePub.xhtml#_idTextAnchor160) 的 *训练深度神经网络模型* 部分中使用的逻辑相同，*实现深度神经网络*。
- en: Now that we've trained a ML model, in the next section, we'll learn how to export
    it into the TensorFlow SavedModel format.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经训练了一个 ML 模型，在下一节中，我们将学习如何将其导出为 TensorFlow SavedModel 格式。
- en: Exporting the BigQuery ML model
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 导出 BigQuery ML 模型
- en: 'In this section, we''ll export a BigQuery ML model into a Google Cloud storage
    bucket in the TensorFlow SavedModel format. Let''s get started:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将导出一个 BigQuery ML 模型到 Google Cloud 存储桶中的 TensorFlow SavedModel 格式。让我们开始吧：
- en: First, we need to access to the Cloud Shell from the Google Cloud Console:![Figure
    13.3 – The Activate Cloud Shell button in the Google Cloud Console
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要从 Google Cloud Console 访问 Cloud Shell：![图 13.3 – Google Cloud Console
    中的激活 Cloud Shell 按钮
- en: '](img/B16722_13_003.jpg)'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_13_003.jpg]'
- en: Figure 13.3 – The Activate Cloud Shell button in the Google Cloud Console
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 13.3 – Google Cloud Console 中的激活 Cloud Shell 按钮
- en: Important note
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要提示
- en: The **Cloud Shell** is an online Linux-based environment that can be accessed
    from the web browser of the Google Cloud Console. With the Cloud Shell, you can
    manage your Google Cloud resources by leveraging its preloaded utilities, such
    as the **gcloud** command-line tool.
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**云壳**是一个基于 Linux 的在线环境，可以通过 Google Cloud 控制台的网页浏览器访问。使用云壳，您可以通过利用其预加载的实用程序（如
    **gcloud** 命令行工具）来管理您的 Google Cloud 资源。'
- en: After clicking on the **Cloud Shell** button, a Linux command line will be provisioned
    and presented at the bottom of the screen. If this is the first time you're using
    the Google Cloud Shell, the following banner will be presented:![Figure 13.4 –
    The Cloud Shell information box
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**云壳**按钮后，将在屏幕底部提供 Linux 命令行。如果您是第一次使用 Google Cloud Shell，将显示以下横幅：![图 13.4
    – 云壳信息框](img/B16722_13_004.jpg)
- en: '](img/B16722_13_004.jpg)'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 13.4 – 云壳信息框](img/B16722_13_004.jpg)'
- en: Figure 13.4 – The Cloud Shell information box
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 13.4 – 云壳信息框
- en: 'After clicking on the blue **Continue** button, the Linux command line will
    be provisioned, as shown in the following screenshot:'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 点击蓝色**继续**按钮后，将提供 Linux 命令行，如下截图所示：
- en: '![Figure 13.5 – The Cloud Shell environment'
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 13.5 – 云壳环境](img/B16722_13_005.jpg)'
- en: '](img/B16722_13_005.jpg)'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图 13.5 – 云壳信息框](img/B16722_13_005.jpg)'
- en: Figure 13.5 – The Cloud Shell environment
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 13.5 – 云壳环境
- en: 'We need to authenticate our account for the Google Cloud SDK by running the
    following command:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要通过运行以下命令对 Google Cloud SDK 的账户进行认证：
- en: '[PRE3]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: A web URL will be shown in the command line. By clicking on this URL, we'll
    authorize our account to use Cloud SDK. At the end of this process, you'll see
    a code on the web page that you can copy and paste into your Cloud Shell to complete
    the authorization process.
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 命令行将显示一个网页 URL。通过点击此 URL，我们将授权账户使用 Cloud SDK。在此过程结束时，您将在网页上看到一个代码，您可以将其复制并粘贴到
    Cloud Shell 中以完成授权过程。
- en: 'Then, we can run the following command to set the current project name in the
    new `PROJECT` variable:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们可以运行以下命令来设置新的 `PROJECT` 变量中的当前项目名称：
- en: '[PRE4]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Using the `PROJECT` variable, we''ll create a second variable, `BUCKET`, that
    will contain the name of the Google Cloud storage bucket to create, which is where
    the BigQuery ML model will be exported:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `PROJECT` 变量，我们将创建第二个变量 `BUCKET`，它将包含要创建的 Google Cloud 存储桶的名称，BigQuery ML
    模型将导出到该存储桶：
- en: '[PRE5]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The Google Cloud storage bucket name will be a concatenation of the name of
    our project and the `-us-bigqueryml-export-tf` string.
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Google Cloud 存储桶的名称将是我们的项目名称和 `-us-bigqueryml-export-tf` 字符串的连接。
- en: 'Now that we have the name of the bucket stored in a variable, we can create
    the new bucket by running the following command:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们已经将存储桶的名称存储在一个变量中，我们可以通过运行以下命令来创建新的存储桶：
- en: '[PRE6]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Important note
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要提示
- en: The `gsutil mb` command is used to create a new bucket, while the `–l US` option
    specifies the geographic location where we want to create the bucket. In this
    case, the bucket will be created in the United States.
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 `gsutil mb` 命令创建新的存储桶，而 `–l US` 选项指定了我们希望创建存储桶的地理位置。在这种情况下，存储桶将在美国创建。
- en: 'If this is the first time that you are using Cloud Shell to create a Google
    Cloud storage bucket, then the following banner will appear before the bucket
    is created:'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果您是第一次使用 Cloud Shell 创建 Google Cloud 存储桶，则在创建存储桶之前将出现以下横幅：
- en: '![Figure 13.6 – The Cloud Shell authorization box](img/B16722_13_006.jpg)'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 13.6 – 云壳授权框](img/B16722_13_006.jpg)'
- en: Figure 13.6 – The Cloud Shell authorization box
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 13.6 – 云壳授权框
- en: Upon clicking on the blue **Authorize** button, the bucket will be created.
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 点击蓝色**授权**按钮后，将创建存储桶。
- en: 'Now, let''s execute the command that will export the BigQuery ML model into
    the Google Cloud storage bucket in the TensorFlow SavedModel format. Let''s run
    the following command:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们执行以下命令，将 BigQuery ML 模型以 TensorFlow SavedModel 格式导出到 Google Cloud 存储桶中。让我们运行以下命令：
- en: '[PRE7]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The `bq extract` command is used to extract the BigQuery ML model that''s specified
    after the `–m` option. The last part of the command indicates the path of the
    Google Cloud storage bucket where we want to extract the model and the related
    subfolder; that is, `bqml_exported_model`. As an alternative, it''s also possible
    to export the BigQuery ML model using the following SQL query:'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 `bq extract` 命令提取 `–m` 选项后面的指定 BigQuery ML 模型。命令的最后部分表示我们想要提取模型及其相关子文件夹的
    Google Cloud 存储桶路径；即 `bqml_exported_model`。作为替代，也可以使用以下 SQL 查询来导出 BigQuery ML
    模型：
- en: '[PRE8]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: To verify the presence of the exported model, we can browse the Google Cloud
    Console menu and access the **Browser** functionality under **Storage**, as shown
    in the following screenshot:![Figure 13.7 – Google Cloud Storage – Browser
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要验证导出模型的存档，我们可以浏览Google Cloud控制台菜单，并在**存储**下访问**浏览器**功能，如下面的截图所示：![图13.7 – Google
    Cloud Storage – 浏览器]
- en: '](img/B16722_13_007.jpg)'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_13_007.jpg]'
- en: Figure 13.7 – Google Cloud Storage – Browser
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.7 – Google Cloud Storage – 浏览器
- en: 'Upon accessing the Google Cloud storage bucket we created in *Step 6* and entering
    the `bqml_exported_model` subfolder, we''ll see the exported version of the BigQuery
    ML model, as shown in the following screenshot:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在访问我们在*步骤6*中创建的Google Cloud存储桶并进入`bqml_exported_model`子文件夹后，我们将看到BigQuery ML模型的导出版本，如下面的截图所示：
- en: '![Figure 13.8 – The BigQuery ML model exported into the TensorFlow SavedModel
    format'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '![图13.8 – 导入到TensorFlow SavedModel格式的BigQuery ML模型]'
- en: '](img/B16722_13_008.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_13_008.jpg]'
- en: Figure 13.8 – The BigQuery ML model exported into the TensorFlow SavedModel
    format
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.8 – 导入到TensorFlow SavedModel格式的BigQuery ML模型
- en: From this list of the files, we can easily recognize the main components of
    the TensorFlow SavedModel format that we mentioned in the *Introducing TensorFlow*
    section of this chapter. We can see the `saved_model.pb` file, which contains
    the TensorFlow program, the `assets` and `variables` folders, and some additional
    metadata files.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个文件列表中，我们可以轻松识别出我们在本章*介绍TensorFlow*部分中提到的TensorFlow SavedModel格式的主体组件。我们可以看到包含TensorFlow程序的`saved_model.pb`文件，以及`assets`和`variables`文件夹和一些额外的元数据文件。
- en: Now that the model has been exported into the TensorFlow SavedModel format,
    it's possible to share it with other people and run it on a TensorFlow-compatible
    environment, outside of BigQuery.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 现在模型已经导出到TensorFlow SavedModel格式，可以与他人共享，并在BigQuery之外的TensorFlow兼容环境中运行。
- en: In this section, we learned how to export a BigQuery ML model into a Google
    Cloud storage bucket by using the TensorFlow SavedModel format. In the next section,
    we'll learn how to import existing TensorFlow models into BigQuery ML.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了如何使用TensorFlow SavedModel格式将BigQuery ML模型导出到Google Cloud存储桶。在下一节中，我们将学习如何将现有的TensorFlow模型导入到BigQuery
    ML中。
- en: Running TensorFlow models with BigQuery ML
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用BigQuery ML运行TensorFlow模型
- en: In this section, we'll import the TensorFlow model that we exported in the *Converting
    BigQuery ML models into TensorFlow* section. Once the model has been imported,
    we'll use it through the BigQuery ML syntax.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将导入在*将BigQuery ML模型转换为TensorFlow*部分中导出的TensorFlow模型。一旦模型被导入，我们将通过BigQuery
    ML语法使用它。
- en: First, we need to remember that our BigQuery ML model has been exported into
    the folder of a Google Cloud storage bucket. The ML model is stored in the TensorFlow
    SavedModel format and is in the same format as any other ML model that's been
    developed by a data scientist using TensorFlow.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要记住我们的BigQuery ML模型已经被导出到Google Cloud存储桶的文件夹中。该ML模型以TensorFlow SavedModel格式存储，并且与任何其他由使用TensorFlow的数据科学家开发的ML模型具有相同的格式。
- en: 'If we want to use a TensorFlow model in BigQuery ML, we need to perform the
    following steps:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想在BigQuery ML中使用TensorFlow模型，我们需要执行以下步骤：
- en: 'First, let''s run the `CREATE OR REPLACE MODEL` SQL statement. Keep in mind
    that the path of the bucket –  `''gs://<PROJECT_NAME>-us-bigqueryml-export-tf/bqml_exported_model/*''`
    – is based on the name of your current project, so you need to replace the `<PROJECT_NAME>`
    placeholder with the name of the project you''re working on:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，让我们运行`CREATE OR REPLACE MODEL` SQL语句。请注意，存储桶的路径`'gs://<PROJECT_NAME>-us-bigqueryml-export-tf/bqml_exported_model/*'`是基于您当前项目的名称，因此您需要将`<PROJECT_NAME>`占位符替换为您正在工作的项目名称：
- en: '[PRE9]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The syntax of the query is composed of the `CREATE OR REPLACE MODEL` keywords,
    followed by the identifier of the new ML model; that is, `` `13_tensorflow_model.trip_duration_tf_imported_model`
    ``.
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询的语法由`CREATE OR REPLACE MODEL`关键字组成，后跟新ML模型的标识符；即`13_tensorflow_model.trip_duration_tf_imported_model`。
- en: In the `OPTIONS` clause, we've specified `'tensorflow'` in the `model_type`
    option. Using the `model_path` parameter, we've specified the folder where the
    TensorFlow SavedModel will be stored in the Google Cloud storage bucket.
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在`OPTIONS`子句中，我们在`model_type`选项中指定了`'tensorflow'`。使用`model_path`参数，我们指定了TensorFlow
    SavedModel将在Google Cloud存储桶中存储的文件夹。
- en: To verify that BigQuery ML successfully loaded the TensorFlow model, we can
    browse the BigQuery navigation menu and check that the model is present in the
    `13_tensorflow_model` dataset.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了验证 BigQuery ML 成功加载了 TensorFlow 模型，我们可以浏览 BigQuery 导航菜单，并检查模型是否存在于 `13_tensorflow_model`
    数据集中。
- en: 'The following screenshot shows that the TensorFlow model has been imported
    into BigQuery ML. Its name is `trip_duration_tf_imported_model`:'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下截图显示了 TensorFlow 模型已经被导入到 BigQuery ML 中。其名称为 `trip_duration_tf_imported_model`：
- en: '![Figure 13.9 – The TensorFlow model imported into BigQuery'
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![Figure 13.9 – The TensorFlow model imported into BigQuery](img/B16722_13_009.jpg)'
- en: '](img/B16722_13_009.jpg)'
  id: totrans-146
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_13_009.jpg](img/B16722_13_009.jpg)'
- en: Figure 13.9 – The TensorFlow model imported into BigQuery
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 13.9 – 导入到 BigQuery 的 TensorFlow 模型
- en: If we click on `trip_duration_tf_imported_model`, we'll be able to access the
    ML model's details.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们点击 `trip_duration_tf_imported_model`，我们将能够访问机器学习模型的详情。
- en: 'The following screenshot shows the details of the imported ML model:'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下截图显示了导入的机器学习模型的详情：
- en: '![Figure 13.10 – The details of the ML model we''ve imported into BigQuery'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![Figure 13.10 – The details of the ML model we''ve imported into BigQuery](img/B16722_13_010.jpg)'
- en: '](img/B16722_13_010.jpg)'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![img/B16722_13_010.jpg](img/B16722_13_010.jpg)'
- en: Figure 13.10 – The details of the ML model we've imported into BigQuery
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 13.10 – 我们导入到 BigQuery 的机器学习模型的详情
- en: On the **Details** page of the model, we can clearly see that the model type
    is **TENSORFLOW**. This feature confirms that, originally, the ML model was in
    the TensorFlow SavedModel format and has been imported into BigQuery ML.
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在模型的 **详情** 页面上，我们可以清楚地看到模型类型是 **TENSORFLOW**。这一特性确认了，原始的机器学习模型原本是以 TensorFlow
    SavedModel 格式存在的，并且已经被导入到 BigQuery ML 中。
- en: 'Now, we can use the imported TensorFlow model with the BigQuery ML `ML.PREDICT`
    function. Let''s run the following SQL statement:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以使用导入的 TensorFlow 模型与 BigQuery ML 的 `ML.PREDICT` 函数。让我们运行以下 SQL 语句：
- en: '[PRE10]'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The result of the query will be presented after a few seconds in the BigQuery
    UI.
  id: totrans-156
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询的结果将在几秒钟后在 BigQuery UI 中展示。
- en: 'The following screenshot shows the results of executing the query, along with
    the predictions that were generated by the ML model:'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下截图显示了查询的执行结果，以及由机器学习模型生成的预测：
- en: '![Figure 13.11 – The predictions that were generated by the TensorFlow model,
    imported into BigQuery](img/B16722_13_011.jpg)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![Figure 13.11 – The predictions that were generated by the TensorFlow model,
    imported into BigQuery](img/B16722_13_011.jpg)'
- en: Figure 13.11 – The predictions that were generated by the TensorFlow model,
    imported into BigQuery
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.11 – 由导入到 BigQuery 的 TensorFlow 模型生成的预测
- en: As we can see, the predicted values are stored in the `predictions` column and
    represent the predicted trip duration to go from `start_station_name` to `end_station_name`
    using the bike sharing service.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，预测值存储在 `predictions` 列中，并代表使用自行车共享服务从 `start_station_name` 到 `end_station_name`
    的预测行程时间。
- en: In this section, we learned how to import a TensorFlow model into BigQuery ML
    and how to use it by leveraging the BigQuery ML SQL syntax.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们学习了如何将 TensorFlow 模型导入到 BigQuery ML 中，以及如何通过利用 BigQuery ML SQL 语法来使用它。
- en: Summary
  id: totrans-162
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we learned what TensorFlow is and why it is so important for
    the ML industry.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了 TensorFlow 是什么以及为什么它在机器学习行业中如此重要。
- en: First, we analyzed the main commonalities and differences between BigQuery ML
    and TensorFlow, and we understood that they are addressed to different target
    personas within the ML community.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们分析了 BigQuery ML 和 TensorFlow 之间的主要共同点和差异，并了解到它们针对的是机器学习社区中的不同目标受众。
- en: Then, we discovered how we can complement BigQuery ML and TensorFlow to get
    the maximum value by combining these two frameworks.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们发现了如何通过结合这两个框架来补充 BigQuery ML 和 TensorFlow，以获得最大价值。
- en: By taking a gradual and step-by-step approach, we learned how to export BigQuery
    ML models into the TensorFlow format so that we can deploy them into environments
    other than BigQuery.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 通过采取逐步渐进的方法，我们学习了如何将 BigQuery ML 模型导出为 TensorFlow 格式，以便我们可以在除了 BigQuery 以外的环境中部署它们。
- en: After that, we tested how to import and use a TensorFlow model in BigQuery ML.
    This approach enables data analysts to easily access and use advanced TensorFlow
    ML models that have been developed by data scientists and ML engineers. Finally,
    after importing the ML model, we tested the imported ML model on a BigQuery table
    to predict the trip duration of a bike ride with the New York City bike sharing
    service.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们测试了如何在 BigQuery ML 中导入和使用 TensorFlow 模型。这种方法使得数据分析师可以轻松访问和使用由数据科学家和机器学习工程师开发的先进
    TensorFlow ML 模型。最后，在导入机器学习模型后，我们在 BigQuery 表上测试了导入的机器学习模型，以预测使用纽约市自行车共享服务的骑行行程时间。
- en: In the next chapter, we'll focus on some BigQuery tips and best practices so
    that we can improve our ML skills further.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将关注一些 BigQuery 技巧和最佳实践，以便我们进一步提高我们的机器学习技能。
- en: Further resources
  id: totrans-169
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步资源
- en: '**NYC Bike Sharing Public Dataset**: [https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike](https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike)'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**纽约市自行车共享公共数据集**: [https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike](https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-citi-bike)'
- en: '**BigQuery ML Create Model for TensorFlow**: https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-tensorflow'
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**为 TensorFlow 创建 BigQuery ML 模型**: https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-tensorflow'
- en: '**BigQuery ML Evaluate Model**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评估 BigQuery ML 模型**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
- en: '**BigQuery ML Predict**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML 预测**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
- en: '**TensorFlow official website**: https://www.tensorflow.org/'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**TensorFlow 官方网站**: https://www.tensorflow.org/'

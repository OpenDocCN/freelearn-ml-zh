- en: '14'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '14'
- en: Survival Models
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生存模型
- en: 'In *Chapter 13**, Time-to-Event Variables*, we introduced the topics of survival
    analysis, censoring, and **time-to-event** (**TTE**) variables. In this chapter,
    we will provide an in-depth overview and walkthrough of the implementation of
    these techniques with respect to three primary model frameworks:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第13章*，时间事件变量中，我们介绍了生存分析、删失和**时间事件**（**TTE**）变量的主题。在本章中，我们将深入概述并演示这些技术在三个主要模型框架中的应用：
- en: Kaplan-Meier model
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kaplan-Meier模型
- en: Exponential model
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 指数模型
- en: Cox Proportional Hazards model
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Cox比例风险模型
- en: We will discuss how each approach provides probabilistic insight into the survival
    and hazard risk of study subjects using univariate Kaplan-Meier and exponential
    approaches as well as the multivariate Cox Proportional Hazards regression model.
    We’ll walk through examples using real data and discuss the results so that the
    reader understands how to assess performance and translate test output into useful
    information. Finally, we will show how to use the trained models to provide forecast
    probabilities for unseen data.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将讨论每种方法如何通过单变量Kaplan-Meier和指数方法以及多变量Cox比例风险回归模型，提供对研究受试者生存和风险风险的概率洞察。我们将通过使用真实数据的示例来演示，并讨论结果，以便读者了解如何评估性能并将测试输出转换为有用的信息。最后，我们将展示如何使用训练好的模型为未见数据提供预测概率。
- en: Technical requirements
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'In this chapter, we use an additional Python library for survival analysis:
    `lifelines`. Please install the following versions of these libraries to run the
    provided code. Instructions for installing libraries can be found in [*Chapter
    1*](B18945_01.xhtml#_idTextAnchor015)*, Sampling* *and Generalization*:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们使用了一个额外的Python库进行生存分析：`lifelines`。请安装以下版本的这些库以运行提供的代码。有关安装库的说明，请参阅[*第1章*](B18945_01.xhtml#_idTextAnchor015)*，采样*
    *和泛化*：
- en: '`lifelines== 0.27.4`'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`lifelines== 0.27.4`'
- en: 'More information about `lifelines` can be found at this link:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 更多关于`lifelines`的信息可以在以下链接找到：
- en: '[https://lifelines.readthedocs.io/en/latest/index.xhtml](https://lifelines.readthedocs.io/en/latest/index.xhtml)'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://lifelines.readthedocs.io/en/latest/index.xhtml](https://lifelines.readthedocs.io/en/latest/index.xhtml)'
- en: Kaplan-Meier model
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Kaplan-Meier模型
- en: The first model for survival analysis we will discuss is the `lifelines` library.
    Let’s get started.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将讨论的第一个生存分析模型是`lifelines`库。让我们开始吧。
- en: Model definition
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模型定义
- en: 'The Kaplan-Meier estimator is defined by the following formula:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Kaplan-Meier估计量由以下公式定义：
- en: ˆ S (t) = ∏ i:t i≤t  n i − d i _ n i
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ˆ S (t) = ∏ i:t i≤t  n i − d i _ n i
- en: Here, n i is the number of subjects at risk just before time t, d i is the number
    of death events at time t, and  ˆ S (t) (the survival function) is the probability
    that life is longer than t. The Π symbol used in the formula is like the symbol
    Σ; however, Π indicates multiplication. This means that the preceding formula
    will result in a multiplication of fractions for each time step t. This means
    that the Kaplan-Meier estimator is a series of declining horizontal steps. To
    make this clear, let’s take a look at its application with some example data.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，n i是时间t之前处于风险中的受试者数量，d i是时间t的死亡事件数量，ˆ S (t)（生存函数）是寿命超过t的概率。公式中使用的Π符号类似于Σ符号；然而，Π表示乘法。这意味着前面的公式将在每个时间步t产生一系列分数的乘积。这意味着Kaplan-Meier估计量是一系列递减的水平步骤。为了使这一点更清晰，让我们通过一些示例数据来查看其应用。
- en: 'Let’s say that we have the following data, where the `duration` column represents
    how long a subject survived and the `death` column indicates whether a death was
    observed in the study. Let’s walk through the calculations for the Kaplan-Meier
    estimator for this data:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们有以下数据，其中`duration`列表示受试者存活的时间，`death`列表示研究中是否观察到死亡。让我们通过这个数据的Kaplan-Meier估计量进行计算：
- en: '| **duration** | **death** |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| **持续时间** | **死亡** |'
- en: '| `5` | `1` |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| `5` | `1` |'
- en: '| `7` | `1` |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| `7` | `1` |'
- en: '| `3.5` | `1` |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| `3.5` | `1` |'
- en: '| `8` | `0` |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| `8` | `0` |'
- en: '| `2` | `1` |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| `2` | `1` |'
- en: '| `5` | `1` |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| `5` | `1` |'
- en: Figure 14.1 – Death and duration example data
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.1 – 死亡和持续时间示例数据
- en: 'Initially (at t = 0), all subjects are at risk, but no subjects have died.
    That means the current survival rate is 1\. We calculate the value of the survival
    function at t = 0 as follows:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 初始时（t = 0），所有受试者都处于风险之中，但没有人死亡。这意味着当前的生存率是1。我们按照以下方式计算t = 0时生存函数的值：
- en: ˆ S (0) =  n 0 − d 0 _ n 0  =  6 − 0 _ 6  = 1
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ˆ S (0) =  n 0 − d 0 _ n 0  =  6 − 0 _ 6  = 1
- en: 'The first event occurs at t = 2\. At this point, all subjects (six subjects)
    are at risk just before the event, and one subject dies at this time. We calculate
    the current survival rate at this point, then multiply this value by all the previous
    values. The survival rate at t = 2 is given here:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个事件发生在 t = 2。此时，所有受试者（六个受试者）在事件发生前都处于风险中，并且此时有一个受试者死亡。我们计算此点的当前生存率，然后乘以所有前面的值。t
    = 2 时的生存率如下：
- en: n 2 − d 2 _ n 2  =  6 − 1 _ 6  ≈ 0.83
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: n2 - d2 / n2 = (6 - 1) / 6 ≈ 0.83
- en: 'Then, we calculate the survival function at t = 2:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们计算 t = 2 时的生存函数：
- en: ˆ S (2) =  n 0 − d 0 _ n 0  * n 2 − d 2  ______________ n 2  =  6 − 0 _ 6  *
    6 − 1  ___________ 6  ≈ 0.83
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ˆ S (2) = n0 - d0 * n0 * (n2 - d2) / n2 = (6 - 0) * (6 - 1) / 6 ≈ 0.83
- en: 'The next event occurs at t = 3.5\. We repeat the process as outlined previously.
    However, there are only five subjects at risk at this point since one has already
    died. Thus, the current survival rate at time t = 3.5 is this:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个事件发生在 t = 3.5。我们重复之前概述的过程。然而，此时只有五个受试者处于风险中，因为已经有一个人已经死亡。因此，t = 3.5 时的当前生存率如下：
- en: n 3 − d 3 _ n 3  =  5 − 1 _ 5  = 0.8
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: n3 - d3 / n3 = (5 - 1) / 5 = 0.8
- en: 'Then, we calculate the survival function at this point:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们计算此点的生存函数：
- en: ˆ S (3.5) =  n 0 − d 0  _ n 0  * n 2 − d 2  _ n 2  * n 3.5 − d 3.5   _____________  n 3.5 
    =  6 − 0 _ 6  * 6 − 1  _ 6  * 5 − 1  ___________ 5  ≈ 0.67
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ˆ S (3.5) = (n0 - d0) * (n0 * (n2 - d2) * (n3.5 - d3.5)) / n3.5 = (6 - 0) *
    (6 - 1) * (6 - 1) * (5 - 1) / 5 ≈ 0.67
- en: 'The next event occurs at t = 5, where two subjects die. At t = 5, there are
    four remaining subjects at risk, and two subjects die. Thus, we have a survival
    rate of 0.5 at t = 5\. The new value of the survival function is calculated as
    follows:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个事件发生在 t = 5，此时有两个受试者死亡。在 t = 5 时，有四个受试者处于风险中，并且有两个受试者死亡。因此，t = 5 时的生存率为 0.5。生存函数的新值计算如下：
- en: ˆ S (5) = 1 * 0.83 * 0.67 * 0.5 ≈ 0.33
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: ˆ S (5) = 1 * 0.83 * 0.67 * 0.5 ≈ 0.33
- en: 'The final event occurs at t = 7\. At this point, the survival rate is 0.5 and
    the value of the survival function at this point is approximately 0.167:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个事件发生在 t = 7。此时，生存率为 0.5，生存函数在此点的值大约为 0.167：
- en: ˆ S (7) = 1 * 0.83 * 0.67 * 0.5 * 0.5 ≈ 0.167
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: ˆ S (7) = 1 * 0.83 * 0.67 * 0.5 * 0.5 ≈ 0.167
- en: Since our study ends here, this is the final value of the survival function,
    and the function value remains constant through the end of the study.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们的研究在这里结束，这是生存函数的最终值，并且函数值在整个研究结束时保持不变。
- en: As you can see, this survival model is simple to calculate. Notice also that
    we did not mention assumptions or underlying statistical distributions. The Kaplan-Meier
    estimator is a nonparametric survival model. As we discussed in [*Chapter 5*](B18945_05.xhtml#_idTextAnchor087)*,
    Non-Parametric Tests*, this means it can be used as an alternative to parametric
    models when the data under analysis does not meet the assumptions of parametric
    models. The Kaplan-Meier estimator is a useful model to have in your tool belt
    for that reason.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，这个生存模型易于计算。注意，我们也没有提及假设或潜在的统计分布。Kaplan-Meier 估计器是一种非参数生存模型。正如我们在[*第五章*](B18945_05.xhtml#_idTextAnchor087)*，非参数检验*中讨论的，这意味着当分析的数据不符合参数模型的假设时，它可以作为参数模型的替代方案使用。Kaplan-Meier
    估计器因此是一个值得拥有的工具。
- en: Now that we have had a walkthrough of how this model works, let’s look at how
    to calculate the Kaplan-Meier estimator survival function with the `lifelines`
    package in Python.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了这个模型的工作原理，让我们看看如何使用 Python 的 `lifelines` 包计算 Kaplan-Meier 估计器生存函数。
- en: Model example
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模型示例
- en: 'For this example, we will use the `larynx` dataset from `lifelines`. This dataset
    consists of six variables: `time`, `age`, `death`, `Stage_II`, `Stage_III`, and
    `Stage_IV`. The information for this dataset is limited, so we will make the following
    assumptions about the variables for the purposes of this example:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个例子，我们将使用来自 `lifelines` 的 `larynx` 数据集。这个数据集包括六个变量：`时间`、`年龄`、`死亡`、`Stage_II`、`Stage_III`
    和 `Stage_IV`。关于这个数据集的信息有限，因此我们将为此示例对变量做出以下假设：
- en: '`time` is the amount of time a patient lived after diagnosis of larynx cancer'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`时间`表示患者在喉癌诊断后存活的时间'
- en: '`age` is the age of the patient at the time of diagnosis'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`年龄`表示患者在诊断时的年龄'
- en: '`death` indicates whether the death was observed during the study'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`死亡`表示在研究期间是否观察到死亡'
- en: '`Stage_II` indicates that the cancer was at stage two at the time of diagnosis'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Stage_II`表示在诊断时癌症处于第二阶段'
- en: '`Stage_III` indicates that the cancer was at stage three at the time of diagnosis'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Stage_III`表示在诊断时癌症处于第三阶段'
- en: '`Stage_IV` indicates that the cancer was at stage four at the time of diagnosis'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Stage_IV` 表示癌症在诊断时处于第四期'
- en: When a patient is not indicated in stage two or above, they were in stage one
    at the time of diagnosis
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当患者未指示在第二期或以上时，他们在诊断时处于第一期
- en: 'Let’s start by calculating the survival function of all the patients in the
    study. We will use `KaplanMeierFitter` from `lifelines`. This is an object that
    will be the Kaplan-Meier model we just discussed. To fit this model, we will use
    the `fit()` method, which takes two arguments: `duration` and `event_observed`.
    `duration` is how long the patient lived in the study. `event_observed` is whether
    the death was observed: `True` for observed and `False` for not observed. The
    data is already set up to work with these two arguments. We can fit the model
    as follows:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们先计算研究中所有患者的生存函数。我们将使用来自 `lifelines` 的 `KaplanMeierFitter`。这是一个我们将要讨论的 Kaplan-Meier
    模型。为了拟合这个模型，我们将使用 `fit()` 方法，它接受两个参数：`duration` 和 `event_observed`。`duration`
    是患者在研究中的生存时间。`event_observed` 是死亡是否被观察到：观察到为 `True`，未观察到为 `False`。数据已经设置好，可以与这两个参数一起使用。我们可以如下拟合模型：
- en: '[PRE0]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The output of the preceding code is shown in *Figure 14**.2*, which is the
    first five elements of the survival function:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 前一段代码的输出显示在 *图 14.2* 中，这是生存函数的前五个元素：
- en: '![Figure 14.2 – First five elements of the larynx survival function](img/B18945_14_002.jpg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.2 – 喉生存函数的前五个元素](img/B18945_14_002.jpg)'
- en: Figure 14.2 – First five elements of the larynx survival function
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.2 – 喉生存函数的前五个元素
- en: 'The elements of the survival function shown in *Figure 14**.2* are slowly decreasing,
    which is indicative of patients dying over time. However, it’s difficult to get
    the full story from a series of numbers. Let’s plot this series. We can also get
    the confidence intervals from the `KaplanMeierFitter` object, as shown in the
    next code block:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 14.2* 中显示的生存函数元素缓慢下降，这表明随着时间的推移患者正在死亡。然而，从一系列数字中很难得到完整的故事。让我们绘制这个序列。我们还可以从
    `KaplanMeierFitter` 对象中获取置信区间，如下一个代码块所示：'
- en: '[PRE1]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This code results in the plot shown in *Figure 14**.3*, which is the survival
    function over time:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码生成了 *图 14.3* 中所示的图表，这是随时间变化的生存函数：
- en: '![Figure 14.3 – Larynx survival function using Kaplan-Meier estimation](img/B18945_14_003.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.3 – 使用 Kaplan-Meier 估计的喉生存函数](img/B18945_14_003.jpg)'
- en: Figure 14.3 – Larynx survival function using Kaplan-Meier estimation
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.3 – 使用 Kaplan-Meier 估计的喉生存函数
- en: The Kaplan-Meier estimator survival function for the larynx data is shown in
    *Figure 14**.3*. This function decreases over time until the last observed death
    at time step 8 where the function remains constant until the end of the study.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 喉部数据的 Kaplan-Meier 估计生存函数显示在 *图 14.3* 中。这个函数随时间下降，直到在时间步 8 的最后观察到死亡，函数保持恒定，直到研究结束。
- en: Now, consider we have a few features in this dataset that we may want to compare.
    For example, we have the stages of cancer at the initial diagnosis, and we have
    the ages of the individuals. Let us start by comparing the survival functions
    of two age groups. Then, let us compare the survival functions of groups based
    on the cancer stage.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，假设我们在这个数据集中有一些特征，我们可能想要比较。例如，我们有初始诊断时的癌症阶段，以及个体的年龄。让我们先比较两个年龄组的生存函数。然后，让我们比较基于癌症阶段的组别的生存函数。
- en: 'The ages of individuals in the study range from about 40 to 85, with the bulk
    of the individuals in the range of 60 to 80 years old. Let’s split the individuals
    into groups at the age of 65\. Anyone younger than 65 will be in the younger group,
    and anyone 65 or older will be in the older group. The survival functions for
    the two groups are shown in *Figure 14**.4*:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 研究中个体的年龄范围大约在 40 到 85 岁之间，其中大部分个体年龄在 60 到 80 岁之间。让我们将个体按 65 岁分成两组。任何小于 65 岁的人将属于年轻组，任何
    65 岁或以上的人将属于老年组。两组的生存函数显示在 *图 14.4* 中：
- en: '![Figure 14.4 – Larynx survival functions for older and younger groups](img/B18945_14_004.jpg)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.4 – 老年和年轻组的喉生存函数](img/B18945_14_004.jpg)'
- en: Figure 14.4 – Larynx survival functions for older and younger groups
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.4 – 老年和年轻组的喉生存函数
- en: The survival functions for the older and younger group shown in *Figure 14**.4*
    appear to exhibit little difference until around time step 7\. However, the confidence
    intervals never appear to diverge. It appears that age does not appear to be a
    strong factor for survival based on this data.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图14.4*中显示的老年组和年轻组的生存函数似乎在时间步7之前几乎没有差异。然而，置信区间似乎从未发散。根据这些数据，年龄似乎并不是生存的强影响因素。
- en: 'Now, let’s do a similar survival analysis with the various stages. As mentioned
    previously, we will assume that any individual that is not indicated in stage
    two or above was diagnosed as stage one. The survival functions for these groups
    are shown in *Figure 14**.5*:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们对各个阶段进行类似的生存分析。如前所述，我们将假设任何未在第二阶段或以上阶段中指出的个体被诊断为第一阶段。这些组的生存函数显示在*图14.5*中：
- en: '![Figure 14.5 – Larynx survival functions based on stage](img/B18945_14_005.jpg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![图14.5 – 根据阶段划分的喉部生存函数](img/B18945_14_005.jpg)'
- en: Figure 14.5 – Larynx survival functions based on stage
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.5 – 根据阶段划分的喉部生存函数
- en: The survival functions for the groups based on stage are shown in *Figure 14**.5*.
    This plot omits the confidence intervals for plot clarity. Based on the plot,
    there does not appear to be a significant difference between stage one and stage
    two. We start to see a difference at stage three. The difference between stage
    four and the other stages is distinctly noticeable.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 根据阶段划分的组的生存函数显示在*图14.5*中。此图为了绘图清晰，省略了置信区间。根据图示，似乎第一阶段和第二阶段之间没有显著差异。我们开始看到第三阶段有差异。第四阶段与其他阶段之间的差异明显。
- en: In this section, we discussed the Kaplan-Meier model for survival, which is
    a nonparametric model for survival data. We also discussed how to compare the
    survival functions of multiple groups within a set. In the next section, we will
    discuss the exponential model, which is a parametric model for survival data.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们讨论了生存的Kaplan-Meier模型，这是一个针对生存数据的非参数模型。我们还讨论了如何在集合内比较多个组的生存函数。在下一节中，我们将讨论指数模型，这是一个针对生存数据的参数模型。
- en: Exponential model
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 指数模型
- en: 'In the last section, we studied the non-parametric **Kaplan-Meier survival
    model**. We will now bridge parametric modeling with the **exponential model**
    and then will discuss a semi-parametric model, the **Cox Proportional Hazards
    model**, in the next section. Before considering the exponential model, we will
    review what the exponential distribution is and why we mention it in this section.
    This distribution is based on the Poisson process. Here, events occur independently
    over time and the event rate, λ, is calculated by the number of occurrences per
    unit of time, as follows:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一节中，我们研究了非参数的**Kaplan-Meier生存模型**。现在，我们将参数模型与**指数模型**相结合，然后在下一节中讨论半参数模型，即**Cox比例风险模型**。在考虑指数模型之前，我们将回顾指数分布是什么以及为什么在本节中提到它。这种分布基于泊松过程。在这里，事件随时间独立发生，事件率λ通过单位时间内的发生次数计算，如下所示：
- en: λ = Y _ t
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: λ = Y _ t
- en: 'The Poisson distribution is a **statistical discrete distribution** concerning
    the number of events occurring in a specified time period. It is defined as follows.
    Let *Y* be the number of occurrences in time *t*. Y follows the Poisson distribution
    with parameter λ if a probability mass function is given by the following formula:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 泊松分布是关于在指定时间段内发生事件数量的**统计离散分布**。其定义如下。设*Y*为时间*t*内发生的次数。如果概率质量函数由以下公式给出，则Y遵循参数λ的泊松分布：
- en: f(Y) = Pr(y = Y) = e −λ λ Y _ Y !
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: f(Y) = Pr(y = Y) = e −λ λ Y _ Y !
- en: 'The mean and the variance of the discrete variable y are equal to the event
    rate. Instead of focusing on how many events occur in a specific time period,
    we can think about how long the event occurs; that’s why the exponential distribution
    is considered in this section. Let T be the time until the event occurs (Y = 1).
    The probability density function is calculated by the following formula:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 离散变量y的均值和方差等于事件发生率。我们不是关注在特定时间段内发生了多少事件，而是考虑事件持续了多长时间；这就是为什么在本节中考虑指数分布的原因。设T为事件发生的时间（Y
    = 1）。概率密度函数通过以下公式计算：
- en: f(t) = P(T = t) = λ e −λt
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: f(t) = P(T = t) = λ e −λt
- en: 'And the cumulative distribution function is calculated as follows:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 累积分布函数的计算方法如下：
- en: F(t) = P(T ≤ t) = 1 − e −λt
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: F(t) = P(T ≤ t) = 1 − e −λt
- en: 'The function F(t) represents the probability of not surviving past time t or
    the probability that survival time is less than t. We can see in *Figure 14**.6*
    the following probability form:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 函数 F(t) 表示超过时间 t 的生存概率或生存时间小于 t 的概率。我们可以在*图14.6*中看到以下概率形式：
- en: '![Figure 14.6 – Curve of the probability of not surviving past time t](img/B18945_14_006.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图14.6 – 超过时间 t 生存概率的曲线](img/B18945_14_006.jpg)'
- en: Figure 14.6 – Curve of the probability of not surviving past time t
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.6 – 超过时间 t 生存概率的曲线
- en: 'In contrast, the survival function is related to the probability of surviving
    past a certain time t:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，生存函数与超过一定时间 t 的生存概率相关：
- en: S(t) = P(T > t) = 1 − P(T ≤ t) = e −λt
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: S(t) = P(T > t) = 1 − P(T ≤ t) = e −λt
- en: 'By visualization, the survival function will have the form seen in *Figure
    14**.7*:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 通过可视化，生存函数将呈现*图14.7*中看到的形式：
- en: '![Figure 14.7 – Curve of the survival function](img/B18945_14_007.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![图14.7 – 生存函数的曲线](img/B18945_14_007.jpg)'
- en: Figure 14.7 – Curve of the survival function
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.7 – 生存函数的曲线
- en: 'The **accumulated hazard function** is H(t) = λt. We can then we can rewrite
    the survival function in terms of the hazard function as follows:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '**累积风险函数**是 H(t) = λt。然后我们可以用风险函数重新表示生存函数，如下所示：'
- en: S(t) = e −H(t)
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: S(t) = e −H(t)
- en: Given S(t) and f(t), we can use the idea of the log-likelihood equation approach
    and estimate the value for λ via maximum likelihood estimation.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 给定 S(t) 和 f(t)，我们可以使用对数似然方程的方法，并通过最大似然估计来估计 λ 的值。
- en: Model example
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模型示例
- en: 'We will use the same `larynx` dataset from `lifeline` as in the last section.
    In this example, we will use `ExponentialFitter` from `lifelines`. Similarly,
    the `fit()` method takes two arguments: `duration` and `event_observed`. We can
    fit the model as follows:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用与上一节相同的来自 `lifeline` 的 `larynx` 数据集。在这个例子中，我们将使用 `lifelines` 中的 `ExponentialFitter`。同样，`fit()`
    方法接受两个参数：`duration` 和 `event_observed`。我们可以如下拟合模型：
- en: '[PRE2]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'In the Kaplan-Meier model, the curve looks like stair steps, but using the
    exponential approach, the curve is gradually decreasing continuously, as we can
    see here:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在Kaplan-Meier模型中，曲线看起来像阶梯状，但使用指数方法，曲线是逐渐连续下降的，正如我们在这里可以看到的：
- en: '![Figure 14.8 – Larynx survival function using exponential distribution](img/B18945_14_008.jpg)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![图14.8 – 使用指数分布的喉部生存函数](img/B18945_14_008.jpg)'
- en: Figure 14.8 – Larynx survival function using exponential distribution
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.8 – 使用指数分布的喉部生存函数
- en: 'At time step 8, the function remains constant until the end of the study in
    the Kaplan-Meier model, but in the exponential model, the curve continues to decrease
    until the end of the study. We also perform similar studies between the younger
    group (less than 65 years old) and the older group (from 65 years old) (see *Figure
    14**.9*):'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在时间步8，Kaplan-Meier模型中的函数保持恒定，直到研究结束，但在指数模型中，曲线继续下降直到研究结束。我们还对年轻组（小于65岁）和老年组（65岁及以上）进行了类似的研究（见*图14.9*）：
- en: '![Figure 14.9 – Larynx survival functions for older and younger groups](img/B18945_14_009.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![图14.9 – 老年和年轻组的喉部生存函数](img/B18945_14_009.jpg)'
- en: Figure 14.9 – Larynx survival functions for older and younger groups
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.9 – 老年和年轻组的喉部生存函数
- en: 'We also do this on survival analysis with the various stages in the Larynx
    case (see *Figure 14**.10*):'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还在喉部案例的各个阶段进行生存分析（见*图14.10*）：
- en: '![Figure 14.10 – Larynx survival functions based on stage](img/B18945_14_010.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![图14.10 – 基于阶段的喉部生存函数](img/B18945_14_010.jpg)'
- en: Figure 14.10 – Larynx survival functions based on stage
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.10 – 基于阶段的喉部生存函数
- en: Both the exponential and Kaplan-Meier models give us similar information. There
    are advantages and disadvantages between the two models. In the Kaplan-Meier model,
    results interpretation is simpler; we can estimate the survival function value
    for both models, but one advantage of the exponential model is to be able to **estimate
    the hazard ratio**. Two disadvantages of exponential models are that results are
    not always realistic and that we must assume a constant hazard ratio, which is
    not always practical. In the next section, we will discuss another survival model,
    the Cox Proportional Hazards regression model, which is semi-parametric.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 指数模型和Kaplan-Meier模型都给我们提供了类似的信息。这两个模型之间有优缺点。在Kaplan-Meier模型中，结果解释更简单；我们可以估计两个模型的生存函数值，但指数模型的一个优点是能够**估计风险比**。指数模型的两个缺点是结果并不总是现实的，并且我们必须假设一个恒定的风险比，这并不总是实用的。在下一节中，我们将讨论另一个生存模型，即半参数的Cox比例风险回归模型。
- en: Cox Proportional Hazards regression model
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Cox比例风险回归模型
- en: 'Survival analysis, also called TTE analysis, as we discussed in *Chapter 13**,
    Time-to-Event Variables*, is an analytical approach that uses probability to estimate
    the time remaining before an event occurs based on previous observations. We have
    seen how this can be helpful when including appropriate covariates in applications
    such as estimating life expectancy, mechanical failure, and customer churn, which
    can help with prioritizing needs and to more efficiently allocate resources. As
    we discussed in depth in [*Chapter 13*](B18945_13.xhtml#_idTextAnchor206), censoring
    is an aspect making survival analysis unique from other statistical questions
    that can be solved using techniques such as regression. Consequently—and because
    dropping an observation due to censoring will almost certainly mislead our model
    and provide results we cannot trust—we insert what is known as an **event status
    indicator** to help account for whether an event will occur or fail to occur prior
    to estimating the time before an event’s occurrence. Recall that the event status
    indicator, δ, for object i is described as follows:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 生存分析，也称为TTE分析，正如我们在第13章“时间到事件变量”中讨论的，是一种使用概率来估计事件发生前剩余时间的分析方法。我们看到了如何通过在诸如估计预期寿命、机械故障和客户流失等应用中包含适当的协变量，这有助于确定优先事项并更有效地分配资源。正如我们在[*第13章*](B18945_13.xhtml#_idTextAnchor206)中深入讨论的，截尾是使生存分析区别于其他可以使用回归等技术解决的统计问题的独特方面。因此——并且由于由于截尾而删除的观察值几乎肯定会误导我们的模型并提供我们无法信任的结果——我们在估计事件发生前的时间之前插入了一个称为**事件状态指示器**的变量，以帮助解释事件是否会在事件发生前发生或未发生。回想一下，对象
    i 的事件状态指示器 δ 的描述如下：
- en: δ i = { 1 if the event was observed,   0 if censoring was observed.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: δ i = { 1 如果观察到事件，   0 如果观察到截尾。
- en: 'We noted that δ i = 1 when the true event T i occurs *before* censoring time
    C i and δ i = 0 when the true event T i occurs *after* censoring time C i and
    that thus, the outcome Y for object i is this:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 我们注意到，当真实事件 T i 在截尾时间 C i **之前**发生时，δ i = 1，而当真实事件 T i 在截尾时间 C i **之后**发生时，δ i
    = 0，因此，对象 i 的结果 Y 如下：
- en: Y i = min(T i, C i)
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: Y i = min(T i, C i)
- en: Censored survival data for object ican be captured as (Y i, δ i). In this chapter,
    we have discussed the **non-parametric** **Kaplan-Meier survival model**, which
    uses a raw conditional probability of survival counts respective to the sample
    volume at each point in time without consideration of covariates. We then walked
    through the parametric **exponential survival model**, which, unlike the Kaplan-Meier
    model assumes the data fits specific distributions and additionally includes a
    hazard ratio to compare groups. We will now discuss the semi-parametric **Cox
    Proportional Hazards survival model**, also referred to as the **Cox Proportional
    Hazards** **regression model**.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 对象 i 的截尾生存数据可以表示为 (Y i, δ i)。在本章中，我们讨论了**非参数**的**Kaplan-Meier生存模型**，该模型使用每个时间点的样本体积的原始条件生存概率计数，而不考虑协变量。然后我们介绍了**参数**的**指数生存模型**，与Kaplan-Meier模型不同，它假设数据适合特定的分布，并且还包括一个风险比来比较组别。现在我们将讨论**半参数**的**Cox比例风险生存模型**，也称为**Cox比例风险回归模型**。
- en: The primary purpose and distinction of the Cox Proportional Hazards model is
    to use multiple covariates risk factors to model survival time. These covariates
    can be categorical or continuous. The Cox Proportional Hazards model is able to
    account for differences in survival between groups by leveraging the **hazard
    ratio**. As we have discussed, the hazard ratio is the ratio of the event rate,
    at any point in time, for one group with respect to another group provided that
    survival up to that point in time has been maintained among the two groups.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: Cox比例风险模型的主要目的和特点是利用多个协变量风险因素来建模生存时间。这些协变量可以是分类的或连续的。Cox比例风险模型能够通过利用**风险比**来解释不同组之间生存时间的差异。正如我们之前讨论的，风险比是在任何时间点，对于一组相对于另一组的事件发生率的比率，前提是两组在该时间点之前都保持了生存。
- en: 'The hazard ratio can be calculated as follows:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 风险比可以按照以下方式计算：
- en: '![](img/B18945_14_1_formula.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B18945_14_1_formula.jpg)'
- en: 'The issue with the hazard ratio is that when we fail to obtain a balance of
    values across covariates shared among the groups, we lose control of confounding
    variables. When we cannot control for confounding variables, we cannot reliably
    obtain inference. To account for any imbalance that may exist among covariate
    values in survival analysis, we can use the **Cox Proportional Hazards model**
    to introduce coefficients that help explain different levels of exogenous influence.
    The model follows this form:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 风险比的问题在于，当我们无法在组间共享的协变量之间获得值的平衡时，我们就失去了对混杂变量的控制。当我们无法控制混杂变量时，我们无法可靠地获得推断。为了解释生存分析中可能存在的协变量值的不平衡，我们可以使用**Cox比例风险模型**来引入系数，这些系数有助于解释不同水平的外生影响。该模型遵循以下形式：
- en: h(t) = h 0(t) e (β 1X 1+β 2X 2+…+β nX n)
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: h(t) = h0(t) e^(β1X1 + β2X2 + … + βnXn)
- en: Here, h(t) is the expected hazard value at the base time, *t*, h 0(t) is the
    baseline hazard value at *t* when all covariates in the variable matrix *X* are
    equal to zero, and *n* is the count of variables included in the model. The coefficients
    β n provide quantification into the impact (effect) of each columnar variable
    in *X*. Therefore, we are able to predict survival using the specific values of
    the input variables multiplied against their corresponding estimated coefficients.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，h(t)是基础时间t的预期风险值，h0(t)是当变量矩阵X中的所有协变量都等于零时，t的基线风险值，而n是模型中包含的变量数量。系数βn提供了对X中每个列变量的影响（效应）的量化。因此，我们能够通过将输入变量的特定值乘以其相应的估计系数来预测生存。
- en: 'Cox Proportional Hazards has three pertinent assumptions:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: Cox比例风险模型有三个相关假设：
- en: It is assumed the hazard ratio *remains constant* through follow-up. If the
    nature of input for one group is subject to change, this may negatively influence
    the results of the model; for example, we compare the performance of two machines,
    but one is likely to improve when the weather is warmer and the other is not,
    so our model may not be able to properly model mechanical survival.
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 假设风险比*在随访期间保持恒定*。如果一个组输入的性质可能发生变化，这可能会对模型的结果产生负面影响；例如，我们比较两种机器的性能，但其中一种机器在天气变暖时可能会改善，而另一种则不会，因此我们的模型可能无法正确地模拟机械生存性。
- en: Complete *survival independence*. This means the survival of one study participant
    or object has no dependence on the other. Consider two separate machines. If one’s
    vibrations are likely to result in an early failure that would not otherwise occur,
    and that vibration is additionally felt by the other machine, also at that other
    machine’s detriment, there may not be survival independence between the two machines.
    However, if the vibration of the first machine is not felt by the other, there
    is likely to be survival independence if all other confounders are controlled
    for.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 完成*生存独立性*。这意味着一个研究参与者或对象的生存不受另一个对象的影响。考虑两个独立的机器。如果一个机器的振动可能导致早期故障，而这种振动也被另一个机器感受到，并且对另一个机器也有害，那么这两个机器之间可能没有生存独立性。然而，如果第一个机器的振动没有被另一个机器感受到，在其他混杂因素得到控制的情况下，很可能存在生存独立性。
- en: The model assumes *any censoring that takes place is non-informative*. As such,
    any censoring that takes place does not introduce confounding into the model.
    Losing a study subject due to censoring prior to follow-up must not be correlated
    to changes in survival risk. For example, when testing the mechanical survival
    of two types of machines in a specific area of a facility, if one machine is relocated
    to another area of the facility to minimize its own self-destructive vibrations,
    this is informative censoring. However, if the machine was moved to a different
    area simply to make space and the move does not impact the machine’s survival
    risk or outcome, the censoring is non-informative. Therefore, it does not introduce
    model confounding. The Cox Proportional Hazards model is for **right-censored**
    data.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模型假设*任何发生的数据截断都是非信息的*。因此，任何发生的数据截断都不会引入模型中的混杂因素。由于数据截断在随访前失去的研究对象必须与生存风险的改变无关。例如，当在一个设施的具体区域测试两种机器的机械生存性时，如果一个机器被转移到设施的其他区域以最小化其自身的自毁性振动，这是信息性截断。然而，如果机器被移动到不同的区域只是为了腾出空间，并且移动不会影响机器的生存风险或结果，那么截断就是非信息的。因此，它不会引入模型混杂。Cox比例风险模型适用于**右截尾**数据。
- en: The steps to be taken when performing Cox Proportional Hazards regression modeling
    are outlined next. The sequence is important as the test should only be performed
    when practical. These steps follow the outline provided by the **National Institutes
    of Health** (**NIH**) ([https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7876211/](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7876211/)).
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行Cox比例风险回归建模时需要采取的步骤将在下面概述。顺序很重要，因为测试应该在可行时才进行。这些步骤遵循**国家卫生研究院**（**NIH**）提供的概述（[https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7876211/](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7876211/)）。
- en: Step 1
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 步骤1
- en: 'Set up the null hypothesis to be tested (hypotheses in the multivariate case,
    which we will look at). We will use the *Stanford heart transplant* dataset, which
    lists the survival of the patients waiting for transplants in the Stanford heart
    transplant program. We will use `age` and `year` with respect to the start date
    of the program, `transplant` status, and the existence of previous bypass `surgery`
    as predictors for survival, which ends in either death or transplant. Survival
    duration is the `stop` variable, which is the exit time of the study. `event`
    is the variable confirming right-censoring and corresponds to either death or
    transplant. The null hypothesis for each variable is that there is no statistically
    significant difference in survival between the groups. For example, age has no
    impact on survival, while awaiting transplant would be the null hypothesis. The
    code is shown in the following snippet:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 设置要检验的零假设（多变量情况下的假设，我们将对其进行研究）。我们将使用*斯坦福心脏移植*数据集，该数据集列出了斯坦福心脏移植项目中等待移植的患者的生存情况。我们将使用`age`和`year`（与项目的开始日期相关）以及`transplant`状态和先前存在的旁路`手术`作为生存的预测因子，生存结果要么是死亡，要么是移植。生存持续时间是`stop`变量，即研究的退出时间。`event`是确认右端截断的变量，对应于死亡或移植。对于每个变量的零假设是组间在生存上没有统计学上显著的差异。例如，年龄对生存没有影响，而等待移植将是零假设。以下代码片段展示了代码：
- en: '[PRE3]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Two additional aspects of our data to be aware of are (1) that age has negative
    values; the starting `age` value is 48 years old, so an age of -1 corresponds
    to a 47-year-old patient and (2) `year` starts November 1, 1967\. `id` is unique
    to each patient’s identification. We will not model this variable but can use
    it for reference. In *Figure 14**.11* we can see, for reference, the first two
    rows of the data, including all variables we will use to model survival:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要注意我们数据中的两个额外方面：(1) 年龄值是负数；起始`年龄`值是48岁，因此-1岁的年龄对应于47岁的患者；(2) `年份`从1967年11月1日开始。`id`是每个患者身份的唯一标识。我们不会对这个变量进行建模，但可以将其用作参考。在*图14.11*中，我们可以看到，作为参考，数据的前两行，包括我们将用于建模生存的所有变量：
- en: '| **start** | **stop** | **Event** | **Age** | **year** | **surgery** | **transplant**
    | **id** |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
  zh: '| **开始** | **结束** | **事件** | **年龄** | **年份** | **手术** | **移植** | **id** |'
- en: '| 0 | 50 | 1 | -17.1554 | 0.123203 | 0 | 0 | 1 |'
  id: totrans-129
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 50 | 1 | -17.1554 | 0.123203 | 0 | 0 | 1 |'
- en: '| 0 | 6 | 1 | 3.835729 | 0.25462 | 0 | 0 | 2 |'
  id: totrans-130
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 6 | 1 | 3.835729 | 0.25462 | 0 | 0 | 2 |'
- en: Figure 14.11 – First two rows of the Stanford Heart Transplant data set
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.11 – 斯坦福心脏移植数据集的前两行
- en: Step 2
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 步骤2
- en: We estimate the survival function using a `stop=1`), corresponding to index
    column `event_at` equal to 1, we have right-censoring for three patients. We observed
    the event take place for one patient (`observed=1`) and the other two patients
    were censored. Here, we show the corresponding data. The patient with `id=45`
    stops but restarts the same day, then survives until day 45\. We see the same
    for patient `id=3`, who survives until day 16 when they receive a transplant.
    The patient with `id=15` does not re-enter for follow-up; we assume since they
    did not receive a transplant, they did not survive.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用`stop=1`来估计生存函数，对应于索引列`event_at`等于1，我们有三个患者的右端截断。我们观察到事件发生在一位患者身上（`observed=1`），而其他两位患者被截断。在这里，我们展示了相应的数据。`id=45`的患者停止但同一天重新开始，然后存活到第45天。对于`id=3`的患者，他们在接受移植后存活到第16天。`id=15`的患者没有重新进入随访；我们假设由于他们没有接受移植，所以他们没有存活。
- en: 'In the following code sample, the `durations` variable corresponds to survival
    time and `event_observed` corresponds to the event (transplant or death) that
    results in right-censoring:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的代码示例中，`durations`变量对应于生存时间，而`event_observed`对应于导致右端截断的事件（移植或死亡）：
- en: '[PRE4]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Note from the Kaplan-Meier results that `event=1` with `stop=1` results in
    `observed=1`, whereas `event=0` with `stop=1` results in `censored=1` and `stop=1`
    results in `removed=1`. All three conditions result in those corresponding samples
    being removed from the calculation for that day’s calculation, but unlike the
    patient who experienced the event, those who were censored are considered to survive
    at least as long as the study continues. We can see this by considering the Kaplan-Meier
    survival estimation probability function, S t:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Kaplan-Meier 结果中可以看出，`event=1` 且 `stop=1` 导致 `observed=1`，而 `event=0` 且 `stop=1`
    导致 `censored=1`，`stop=1` 导致 `removed=1`。所有这三种情况都会导致相应的样本从那天计算中移除，但与经历事件的病人不同，那些被截尾的病人被认为至少存活到研究继续的时间。我们可以通过考虑
    Kaplan-Meier 生存估计概率函数 S t 来看到这一点：
- en: S t =  n Patients at Start − nPatients with Event = 1 at time t     ______________________________________   n
    Patients at Start
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: S t =  起始时患者数量 - 时间 t 时事件发生数量 = 1 的患者数量     ______________________________________   起始时患者数量
- en: Here, survival probability at any time, *t*, is denoted as S t.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，任何时间 t 的生存概率表示为 S t。
- en: 'In looking at our event table from the `KaplanMeierFitter` function, we have
    the following:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在查看 `KaplanMeierFitter` 函数的事件表时，我们有以下结果：
- en: S t =  n Patients at risk − n Patients observed at time t    _________________________________   n
    Patients at risk
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: S t =  风险患者数量 - 时间 t 时观察到的患者数量    _________________________________   风险患者数量
- en: We can understand that a `removed` patient has limited impact on survival estimations
    unless they were also noted as `observed=1`, which we can ascribe to `event=1`.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以理解，除非他们也被标记为 `observed=1`，即 `event=1`，否则 `removed` 患者对生存估计的影响有限。我们可以将这种情况归因于
    `event=1`。
- en: 'Let’s consider patients 3, 15, and 45 to understand this relationship better.
    We can see based on counts in *Figure 14**.12* and *Figure 14**.13* that these
    patients were removed from the denominator on day 1 (`event_at=1`). However, by
    looking at *Figure 14**.14*, we can see patients 15 and 45 have later stops corresponding
    to events that get factored into the survival function. Let’s look at *Figure
    14**.12* first so we can see the three removed patients on day 1:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们考虑患者 3、15 和 45 来更好地理解这种关系。根据 *图 14**.12* 和 *图 14**.13* 中的计数，我们可以看到这些患者在第
    1 天 (`event_at=1`) 被从分母中移除。然而，通过查看 *图 14**.14*，我们可以看到患者 15 和 45 有后续的停止时间，对应的事件被纳入生存函数中。让我们首先看看
    *图 14**.12*，以便我们可以看到第 1 天被移除的三个患者：
- en: '|  | **event_at** | **removed** | **observed** | **censored** | **entrance**
    | **at_risk** |'
  id: totrans-143
  prefs: []
  type: TYPE_TB
  zh: '|  | **事件发生时间** | **移除** | **观察** | **截尾** | **进入** | **风险** |'
- en: '| 0 | 0 | 0 | 0 | 0 | 171 | 171 |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 0 | 0 | 0 | 0 | 171 | 171 |'
- en: '| 1 | 1 | 3 | 1 | 2 | 0 | 171 |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 1 | 3 | 1 | 2 | 0 | 171 |'
- en: '| 2 | 2 | 6 | 3 | 3 | 0 | 168 |'
  id: totrans-146
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 2 | 6 | 3 | 3 | 0 | 168 |'
- en: '| 3 | 3 | 6 | 3 | 3 | 0 | 162 |'
  id: totrans-147
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 3 | 6 | 3 | 3 | 0 | 162 |'
- en: '| 4 | 4 | 2 | 0 | 2 | 0 | 156 |'
  id: totrans-148
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 4 | 2 | 0 | 2 | 0 | 156 |'
- en: '| … | … | … | … | … | … | … |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
  zh: '| … | … | … | … | … | … | … |'
- en: '| 107 | 1401 | 1 | 0 | 1 | 0 | 5 |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| 107 | 1401 | 1 | 0 | 1 | 0 | 5 |'
- en: '| 108 | 1408 | 1 | 0 | 1 | 0 | 4 |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| 108 | 1408 | 1 | 0 | 1 | 0 | 4 |'
- en: '| 109 | 1572 | 1 | 0 | 1 | 0 | 3 |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| 109 | 1572 | 1 | 0 | 1 | 0 | 3 |'
- en: '| 110 | 1587 | 1 | 0 | 1 | 0 | 2 |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| 110 | 1587 | 1 | 0 | 1 | 0 | 2 |'
- en: '| 111 | 1800 | 1 | 0 | 1 | 0 | 1 |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| 111 | 1800 | 1 | 0 | 1 | 0 | 1 |'
- en: Figure 14.12 – Summary of the events table for the Stanford Heart Transplant
    data set
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.12 – 斯坦福心脏移植数据集事件表摘要
- en: Now, we can see in *Figure 14**.13* all patients that had stops on day 1.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以在 *图 14**.13* 中看到第 1 天所有有停止的患者。
- en: '[PRE5]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The patients with stops on day 1 are patients with `id` 3, 15, and 45:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 第 1 天有停止的患者是 `id` 为 3、15 和 45 的患者：
- en: '| **start** | **Stop** | **event** | **Age** | **Year** | **surgery** | **transplant**
    | **id** |'
  id: totrans-159
  prefs: []
  type: TYPE_TB
  zh: '| **开始** | **停止** | **事件** | **年龄** | **年份** | **手术** | **移植** | **id** |'
- en: '| 0 | 1 | 0 | 6.297057 | 0.265572 | 0 | 0 | 3 |'
  id: totrans-160
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 1 | 0 | 6.297057 | 0.265572 | 0 | 0 | 3 |'
- en: '| 0 | 1 | 1 | 5.815195 | 0.991102 | 1 | 0 | 15 |'
  id: totrans-161
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 1 | 1 | 5.815195 | 0.991102 | 1 | 0 | 15 |'
- en: '| 0 | 1 | 0 | -11.8166 | 3.263518 | 0 | 0 | 45 |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 1 | 0 | -11.8166 | 3.263518 | 0 | 0 | 45 |'
- en: Figure 14.13 – Training data values for patients who exited the study on day
    1
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.13 – 第 1 天退出研究的患者训练数据值
- en: 'To get a better understanding of how this analysis works, we can look specifically
    at all records for the patients having `id` 3, 15, and 45:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解这种分析是如何工作的，我们可以具体查看 `id` 为 3、15 和 45 的患者的所有记录：
- en: '[PRE6]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'These patients registered a stop on day 1, but patients 3 and 45 also registered
    stops on days 16 and 45, respectively:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 这些患者在第 1 天注册了停止，但患者 3 和 45 分别在第 16 天和第 45 天也注册了停止：
- en: '| **start** | **stop** | **event** | **Age** | **year** | **surgery** | **transplant**
    | **id** |'
  id: totrans-167
  prefs: []
  type: TYPE_TB
  zh: '| **开始** | **停止** | **事件** | **年龄** | **年份** | **手术** | **移植** | **id** |'
- en: '| 0 | 1 | 0 | 6.297057 | 0.265572 | 0 | 0 | 3 |'
  id: totrans-168
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 1 | 0 | 6.297057 | 0.265572 | 0 | 0 | 3 |'
- en: '| 1 | 16 | 1 | 6.297057 | 0.265572 | 0 | 1 | 3 |'
  id: totrans-169
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 16 | 1 | 6.297057 | 0.265572 | 0 | 1 | 3 |'
- en: '| 0 | 1 | 1 | 5.815195 | 0.991102 | 1 | 0 | 15 |'
  id: totrans-170
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 1 | 1 | 5.815195 | 0.991102 | 1 | 0 | 15 |'
- en: '| 0 | 1 | 0 | -11.8166 | 3.263518 | 0 | 0 | 45 |'
  id: totrans-171
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 1 | 0 | -11.8166 | 3.263518 | 0 | 0 | 45 |'
- en: '| 1 | 45 | 1 | -11.8166 | 3.263518 | 0 | 1 | 45 |'
  id: totrans-172
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 45 | 1 | -11.8166 | 3.263518 | 0 | 1 | 45 |'
- en: Figure 14.14 – Training data values for patients 3, 15, and 45
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.14 – 患者第3、15和45天的训练数据值
- en: 'We can also see patient 45 is the only patient with a `stop` value (corresponding
    to `event_at`) on day 45\. Therefore, we know a transplant results in an observation
    and a removal. To identify the values at day 45, run the following code:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以看到，患者45是唯一一个在45天有`停止`值（对应于`事件发生时间`）的患者。因此，我们知道移植会导致观察和移除。要识别45天的值，请运行以下代码：
- en: '[PRE7]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The code outputs the table in *Figure 14**.15*:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 代码输出*图14**.15*中的表格：
- en: '| **event_at** | **removed** | **observed** | **censored** | **entrance** |
    **at_risk** |'
  id: totrans-177
  prefs: []
  type: TYPE_TB
  zh: '| **事件发生时间** | **移除** | **观察** | **截尾** | **进入** | **在风险中** |'
- en: '| 45 | 1 | 1 | 0 | 0 | 87 |'
  id: totrans-178
  prefs: []
  type: TYPE_TB
  zh: '| 45 | 1 | 1 | 0 | 0 | 87 |'
- en: Figure 14.15 – Events on day 45
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.15 – 45天的事件
- en: 'Now we can look at the events table filtered to events with a stop at day 45
    by running the following code:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以通过运行以下代码来查看事件表，该表已过滤到45天停止的事件：
- en: '[PRE8]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'This gives us the tabular output seen in *Figure 14**.16*:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 这给我们带来了*图14**.16*中看到的表格输出：
- en: '| **start** | **stop** | **event** | **Age** | **year** | **surgery** | **transplant**
    | **id** |'
  id: totrans-183
  prefs: []
  type: TYPE_TB
  zh: '| **开始** | **停止** | **事件** | **年龄** | **年份** | **手术** | **移植** | **id** |'
- en: '| 1 | 45 | 1 | -11.8166 | 3.263518 | 0 | 1 | 45 |'
  id: totrans-184
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 45 | 1 | -11.8166 | 3.263518 | 0 | 1 | 45 |'
- en: Figure 14.16 – Events having a stop on day 45
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.16 – 45天停止的事件
- en: 'We can repeat this step to see if there is a difference in survival until the
    end of the study for those who receive a transplant and those who do not by splitting
    the two groups out in the following code:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过在以下代码中将两组分开来重复此步骤，以查看接受移植和未接受移植的人在整个研究结束时的生存率是否有差异：
- en: '[PRE9]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We observe in the **Kaplan-Meier survival function** in *Figure 14**.17* a
    steady decrease in survival probability for both groups, but a steeper decrease
    for the group that does not receive a transplant. We can also see the group, overall,
    with no transplant does not survive if the group that does receive the transplant.
    By the time the program closed, there were no non-transplants surviving. The shading
    corresponds to the 95% confidence interval bands for each probability interval:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在**Kaplan-Meier生存函数**（*图14**.17*）中观察到，两组的生存概率都在稳步下降，但未接受移植的组的下降更为陡峭。我们还可以看到，总体上，未接受移植的组如果与接受移植的组相比，是无法存活的。到项目结束时，没有非移植患者存活。阴影部分对应于每个概率区间的95%置信区间带：
- en: '![Figure 14.17 – Kaplan-Meier survival estimation probability function](img/B18945_14_017.jpg)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![图14.17 – Kaplan-Meier生存估计概率函数](img/B18945_14_017.jpg)'
- en: Figure 14.17 – Kaplan-Meier survival estimation probability function
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.17 – Kaplan-Meier生存估计概率函数
- en: 'To generate the exact probability of survival on any day (corresponding to
    the `stop` time), we can run the following code:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成任何一天（对应于`停止`时间）的确切生存概率，我们可以运行以下代码：
- en: '[PRE10]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Here we can see the probabilities of survival at day 300 for the transplant
    and non-transplant groups:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到移植组和未移植组在第300天的生存概率：
- en: '[PRE11]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Step 3
  id: totrans-195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第3步
- en: Now, we will use a **log-rank test** to determine if survivor curves are statistically
    different. At this step, we investigate if there is any statistical significance
    in survival between transplant and non-transplant groups. If there is no statistical
    significance, it would not be useful to understand the relationships between the
    covariates and their impacts on survival. We looked at **contingency table analysis**
    using the **Chi-Square test of independence** earlier in the book. This is essentially
    the log-rank test here, where we compare the survival distributions of the two
    groups (transplant versus non-transplant). We use this approach because the data
    is right-censored, and thus right-skewed; as such, we are working with non-parametric
    distributions. The null hypothesis is that the hazard ratio between the two groups
    is equal to 1, which would mean they are equal in terms of survival or hazard
    risk.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将使用**log-rank检验**来确定生存曲线在统计上是否存在差异。在这一步，我们调查移植和非移植组之间是否存在任何统计意义上的生存差异。如果没有统计意义上的差异，那么理解协变量及其对生存的影响之间的关系将没有意义。我们在书中之前已经使用**卡方独立性检验**进行了**列联表分析**。这本质上就是这里的log-rank检验，其中我们比较两组（移植与非移植）的生存分布。我们采用这种方法是因为数据是右截尾的，因此是右偏斜的；因此，我们正在处理非参数分布。零假设是两组之间的风险比等于1，这意味着他们在生存或风险风险方面是相等的。
- en: 'In the following code sample, we use the two different patient distributions
    (those with and those without transplants) as groups A and B in the `logrank_test`
    function:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下代码示例中，我们使用两种不同的患者分布（有移植和无移植的患者）作为`logrank_test`函数中的组A和B：
- en: '[PRE12]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We can see the Chi-Square distribution is used:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到使用了卡方分布：
- en: '[PRE13]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'This shows the default distribution is the chi-square distribution:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明默认分布是卡方分布：
- en: '[PRE14]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'We can run the following code to see the results of the test:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以运行以下代码来查看测试结果：
- en: '[PRE15]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We can also see a statistically significant difference at a 5% level of significance
    between the two groups. Therefore, we can assume there is a purpose in proceeding
    to use the Cox Proportional Hazards model to understand the relationships between
    the covariates we outlined earlier and the hazard risk for survival:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以看到在5%的显著性水平下，两组之间存在统计意义上的显著差异。因此，我们可以假设继续使用Cox比例风险模型来理解我们之前概述的协变量与生存风险之间的关系是有意义的：
- en: '| **test_statistic** | **P** | **-****log2(p)** |'
  id: totrans-206
  prefs: []
  type: TYPE_TB
  zh: '| **test_statistic** | **P** | **-****log2(p)** |'
- en: '| 4.02651 | 0.044791 | 4.480663 |'
  id: totrans-207
  prefs: []
  type: TYPE_TB
  zh: '| 4.02651 | 0.044791 | 4.480663 |'
- en: Figure 14.18 – Log-rank test results
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.18 – Log-rank检验结果
- en: Step 4
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第4步
- en: 'Here, we run the Cox Proportional Hazards test and analyze the p-values and
    confidence intervals for the terms included to identify whether they have statistical
    significance with respect to influence on survival rate. We look at the hazard
    ratio to determine any effects they have provided:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们运行Cox比例风险检验，并分析包含项的p值和置信区间，以确定它们是否与生存率的影响具有统计意义上的显著性。我们查看风险比以确定它们产生的任何影响：
- en: '[PRE16]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: We can see three of our four terms are significant at the 5% level of significance
    for predicting survival; our `surgery` variable does not appear to be based on
    the p-value. The 95% confidence interval for surgery does not contain 0, however,
    which suggests statistical significance. The difference is because the p-value
    is calculated based on the test statistic with respect to the critical value,
    which is estimated using the *log of the hazard ratio*, and the confidence interval
    is based on the *hazard ratio* itself. This discrepancy could mean the `surgery`
    variable is significant, but also that it may not be. Since we are not statistically
    certain, we should err on the side of caution and not consider it useful when
    predicting future survival.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，我们四个项中的三个在5%的显著性水平下对预测生存是显著的；我们的`surgery`变量似乎并不基于p值。然而，手术的95%置信区间不包含0，这表明统计意义上的显著性。这种差异是因为p值是基于与临界值相关的测试统计量计算的，临界值是使用*风险比的对数*估计的，而置信区间是基于*风险比*本身的。这种差异可能意味着`surgery`变量是显著的，但也可能不是。由于我们不是在统计上确定的，我们应该谨慎行事，在预测未来生存时不应将其视为有用。
- en: Note that `exp(coef)` corresponds to the hazard ratio and `coef` is the log
    of the hazard ratio. This follows the equation we provided earlier for the expected
    hazard value at the base time, *t*.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，`exp(coef)`对应于风险比，而`coef`是风险比的对数。这遵循我们之前提供的在基础时间*t*的预期风险值的方程。
- en: We can say, based on the hazard ratio `(exp(coef))` of 1.03, that a single unit
    increase in age over age 48 results in an increase of the hazard by a factor of
    1.03, or 3%. With respect to our `transplant` variable, we can say with a 95%
    level of confidence that having the heart transplant decreased the hazard by a
    factor of 0.54, which is equivalent to 46%.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以说，基于危险比`(exp(coef))`为1.03，年龄在48岁以上每增加一个单位，危险比增加1.03倍，即3%。至于我们的`transplant`变量，我们可以以95%的置信度说，进行心脏移植将危险比降低了0.54倍，相当于46%。
- en: 'Here in *Figure 14**.19*, we can see the results of the Cox Proportional Hazards
    regression model:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 在**图14.19**中，我们可以看到Cox比例风险回归模型的结果：
- en: '| **Model** | `lifelines.CoxPHFitter` |  |  |  |  |'
  id: totrans-216
  prefs: []
  type: TYPE_TB
  zh: '| **模型** | `lifelines.CoxPHFitter` |  |  |  |  |'
- en: '| Duration column | `stop` |  |  |  |  |'
  id: totrans-217
  prefs: []
  type: TYPE_TB
  zh: '| 持续时间列 | `stop` |  |  |  |  |'
- en: '| Event column | `event` |  |  |  |  |'
  id: totrans-218
  prefs: []
  type: TYPE_TB
  zh: '| 事件列 | `event` |  |  |  |  |'
- en: '| Baseline estimation | `breslow` |  |  |  |  |'
  id: totrans-219
  prefs: []
  type: TYPE_TB
  zh: '| 基线估计 | `breslow` |  |  |  |  |'
- en: '| Number of observations | 171 |  |  |  |  |'
  id: totrans-220
  prefs: []
  type: TYPE_TB
  zh: '| 观察数量 | 171 |  |  |  |  |'
- en: '| Number of events observed | 74 |  |  |  |  |'
  id: totrans-221
  prefs: []
  type: TYPE_TB
  zh: '| 观察到的事件数量 | 74 |  |  |  |  |'
- en: '| Partial log likelihood | -298.47 |  |  |  |  |'
  id: totrans-222
  prefs: []
  type: TYPE_TB
  zh: '| 部分对数似然 | -298.47 |  |  |  |  |'
- en: '| Time fit was run | 2023-03-18 16:23:26 UTC |  |  |  |  |'
  id: totrans-223
  prefs: []
  type: TYPE_TB
  zh: '| 运行时间 | 2023-03-18 16:23:26 UTC |  |  |  |  |'
- en: '|  | coef | exp (coef) | se (coef) | coef lower 95% | coef upper 95% | exp     (coef) lower 95% | exp     (coef) upper 95% | cmp to | z | p | -log2 (p) |'
  id: totrans-224
  prefs: []
  type: TYPE_TB
  zh: '|  | coef | exp (coef) | se (coef) | coef lower 95% | coef upper 95% | exp     (coef) lower 95% | exp     (coef) upper 95% | cmp to | z | p | -log2 (p) |'
- en: '| Age | 0.03 | 1.03 | 0.01 | 0.01 | 0.06 | 1.01 | 1.06 | 0 | 2.35 | 0.02 |
    5.74 |'
  id: totrans-225
  prefs: []
  type: TYPE_TB
  zh: '| 年龄 | 0.03 | 1.03 | 0.01 | 0.01 | 0.06 | 1.01 | 1.06 | 0 | 2.35 | 0.02 | 5.74
    |'
- en: '| Year | -0.16 | 0.85 | 0.07 | -0.3 | -0.02 | 0.74 | 0.98 | 0 | -2.25 | 0.02
    | 5.35 |'
  id: totrans-226
  prefs: []
  type: TYPE_TB
  zh: '| 年份 | -0.16 | 0.85 | 0.07 | -0.3 | -0.02 | 0.74 | 0.98 | 0 | -2.25 | 0.02
    | 5.35 |'
- en: '| Surgery | -0.64 | 0.53 | 0.37 | -1.36 | 0.08 | 0.26 | 1.08 | 0 | -1.74 |
    0.08 | 3.62 |'
  id: totrans-227
  prefs: []
  type: TYPE_TB
  zh: '| 手术 | -0.64 | 0.53 | 0.37 | -1.36 | 0.08 | 0.26 | 1.08 | 0 | -1.74 | 0.08
    | 3.62 |'
- en: '| Transplant | -0.62 | 0.54 | 0.27 | -1.15 | -0.08 | 0.32 | 0.92 | 0 | -2.26
    | 0.02 | 5.41 |'
  id: totrans-228
  prefs: []
  type: TYPE_TB
  zh: '| 移植 | -0.62 | 0.54 | 0.27 | -1.15 | -0.08 | 0.32 | 0.92 | 0 | -2.26 | 0.02
    | 5.41 |'
- en: '| Concordance | 0.67 |  |  |  |  |  |  |  |  |'
  id: totrans-229
  prefs: []
  type: TYPE_TB
  zh: '| 一致性 | 0.67 |  |  |  |  |  |  |  |  |'
- en: '| Partial AIC | 604.95 |  |  |  |  |  |  |  |  |'
  id: totrans-230
  prefs: []
  type: TYPE_TB
  zh: '| 部分AIC | 604.95 |  |  |  |  |  |  |  |  |'
- en: '| Log-likelihood ratio test | 21.22 on 4 df |  |  |  |  |  |  |  |  |'
  id: totrans-231
  prefs: []
  type: TYPE_TB
  zh: '| 对数似然比检验 | 21.22 on 4 df |  |  |  |  |  |  |  |  |'
- en: '| -log2(p) of ll-ratio test | 11.77 |  |  |  |  |  |  |  |  |'
  id: totrans-232
  prefs: []
  type: TYPE_TB
  zh: '| -log2(p) of ll-ratio test | 11.77 |  |  |  |  |  |  |  |  |'
- en: Figure 14.19 – Cox Proportional Hazard model output
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.19 – Cox比例风险模型输出
- en: 'In *Figure 14**.20*, we can see `age`, which applies only a 3% increase in
    hazard, does not explain much of the variance in the results. The age range spans
    roughly 9 years through 64 years of age. Without other covariates, we cannot say
    exactly why this might be, but including more covariates could prove helpful in
    understanding this variable more. Of the significant variables, `transplant` has
    notably the largest impact on survival outcomes:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 在**图14.20**中，我们可以看到`age`，它只增加了3%的危险，在结果中的方差解释不多。年龄范围大约从9岁到64岁。没有其他协变量，我们无法确切地说为什么可能是这样，但包括更多协变量可能有助于更深入地理解这个变量。在显著变量中，`transplant`对生存结果的影响最为显著：
- en: '[PRE17]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![Figure 14.20 – Confidence intervals for hazard-ratio terms](img/B18945_14_020.jpg)'
  id: totrans-236
  prefs: []
  type: TYPE_IMG
  zh: '![图14.20 – 危险比项的置信区间](img/B18945_14_020.jpg)'
- en: Figure 14.20 – Confidence intervals for hazard-ratio terms
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.20 – 危险比项的置信区间
- en: We can see the assumption of a constant hazard ratio between all patients in
    the survival function plot in *Figure 14**.21*. This is why it is important to
    prevent informative censoring. Let us assume this assumption is met.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在**图14.21**的生存函数图中看到，所有患者之间危险比是恒定的假设。这就是为什么防止信息性截断很重要的原因。让我们假设这个假设得到了满足。
- en: 'Note that when predicting, we do not have start and stop times. Therefore,
    we can input only the quantifiable covariates for a given patient, as follows:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 注意到在预测时，我们没有起始和结束时间。因此，我们只能输入给定患者的可量化协变量，如下所示：
- en: '[PRE18]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![Figure 14.21 – Survival function for all patients](img/B18945_14_021.jpg)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![图14.21 – 所有患者的生存函数](img/B18945_14_021.jpg)'
- en: Figure 14.21 – Survival function for all patients
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.21 – 所有患者的生存函数
- en: Step 5
  id: totrans-243
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第5步
- en: 'In *Figure 14**.22*, we can use the Cox Proportional Hazards model to predict
    the survival function for our held-out test patient:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 在**图14.22**中，我们可以使用Cox比例风险模型来预测我们保留的测试患者的生存函数：
- en: '[PRE19]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![Figure 14.22 – Survival function for test patient, id=171](img/B18945_14_022.jpg)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![图14.22 – 测试患者的生存函数，id=171](img/B18945_14_022.jpg)'
- en: Figure 14.22 – Survival function for test patient, id=171
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.22 – 测试患者的生存函数，id=171
- en: 'To generate the probability for this patient’s survival, using their covariates,
    at each potential stop point, we can run the following code:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成这位患者生存的概率，使用他们的协变量，在每一个潜在的停止点，我们可以运行以下代码：
- en: '[PRE20]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Summary
  id: totrans-250
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we discussed three survival analysis models in depth; the Kaplan-Meier,
    the exponential, and the Cox Proportional Hazards regression models. Using these
    frameworks, we modeled survival functions and estimated survival probabilities
    and hazard ratios for various TTE, right-censored studies. For the multivariate
    case, we used Cox Proportional Hazards regression to model hazard ratios for covariate
    analysis on dependent variables. For all models, we demonstrated using the confidence
    intervals for assessing significance, as well as the corresponding p-values. At
    this point, the reader should be able to confidently identify the scenarios in
    which each model would outperform the others and appropriately fit and implement
    that model to obtain the necessary results for strategic success.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们深入讨论了三种生存分析模型：Kaplan-Meier 模型、指数模型和 Cox 比例风险回归模型。使用这些框架，我们建立了生存函数，并估计了各种
    TTE（时间至事件）和右截尾研究的生存概率和风险比。对于多元情况，我们使用 Cox 比例风险回归模型来对依赖变量的协变量进行分析，以建模风险比。对于所有模型，我们展示了使用置信区间来评估显著性，以及相应的
    p 值。到此为止，读者应该能够自信地识别出在哪些场景下每个模型会优于其他模型，并适当地拟合和实现该模型，以获得战略成功所需的必要结果。

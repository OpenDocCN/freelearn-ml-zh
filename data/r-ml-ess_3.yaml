- en: Chapter 3. A Simple Machine Learning Analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章。简单的机器学习分析
- en: This chapter shows examples of exploratory data analysis and machine learning
    techniques. R provides us with different datasets that can be used to experiment
    with the tools. In this chapter, we will use an interesting dataset about the
    Titanic passengers.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章展示了探索性数据分析与机器学习技术的示例。R为我们提供了不同的数据集，可以用来实验这些工具。在本章中，我们将使用关于泰坦尼克号乘客的有趣数据集。
- en: There are some facts that happened during the Titanic event, such as the policy
    of saving the women and children first and the privileges of the first social
    classes. In order to investigate what happened, we can use the data related to
    the event. The R dataset is about some passengers and it displays their personal
    data and who survived. First, we can explore some data in order to understand
    what happened. Then, starting from the personal data of other passengers, the
    goal of the machine learning model is forecasting which new passengers will survive.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在泰坦尼克号事件中发生了一些事实，例如优先救助妇女和儿童的政策以及第一社会阶层的特权。为了调查发生了什么，我们可以使用与事件相关的数据。R数据集是关于一些乘客的，它显示了他们的个人数据和谁幸存。首先，我们可以探索一些数据以了解发生了什么。然后，从其他乘客的个人数据出发，机器学习模型的目标是预测哪些新乘客会幸存。
- en: 'In this chapter, we''ll cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Exploring the data
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索数据
- en: Visualizing the data using simple charts
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用简单图表可视化数据
- en: Exploring the data using machine learning techniques
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用机器学习技术探索数据
- en: Predicting an outcome using machine learning techniques
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用机器学习技术预测结果
- en: Exploring data interactively
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 交互式探索数据
- en: This section shows you how to visualize the data using simple techniques. We
    process the data using the `data.table` package and visualize the information
    using the basic R charts. A great plotting package is `ggplot2` and it allows
    you to create nice professional charts. Unfortunately, its syntax is more complex
    than the basic R charts, so we don't have enough space for it in this book.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本节展示了如何使用简单技术可视化数据。我们使用`data.table`包处理数据，并使用基本的R图表可视化信息。一个优秀的绘图包是`ggplot2`，它允许你创建漂亮的图表。不幸的是，它的语法比基本的R图表复杂，所以在这本书中没有足够的空间介绍它。
- en: 'R provides us with a `Titanic` dataset that contains the survival statistics
    of some passengers. Before starting to analyze the data, let''s take a look at
    their documentation using the following code:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: R为我们提供了一个包含一些乘客生存统计数据的`Titanic`数据集。在开始分析数据之前，让我们使用以下代码查看它们的文档：
- en: '[PRE0]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The documentation shows that the passengers are divided in groups on the basis
    of their social class, gender, and age. For each group, the dataset shows how
    many people survived and how many didn''t. We can see the format of data using
    `class`:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 文档显示，乘客根据他们的社会阶层、性别和年龄被分成不同的组。对于每个组，数据集显示了幸存人数和未幸存人数。我们可以使用`class`查看数据的格式：
- en: '[PRE1]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The object, `Titanic`, belongs to the `table` class so it displays the count
    of each combination of categoric variables, as shown:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 对象`Titanic`属于`table`类，因此它显示了分类变量组合的计数，如下所示：
- en: '[PRE2]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The table shows the frequency, that is, the number of passengers for each combination
    of variables that are the personal data and the data of those who survived.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 表格显示了频率，即每个变量组合（包括个人数据和幸存者数据）的乘客数量。
- en: Defining a table with the data
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 定义包含数据的表格
- en: 'In this subsection, we will convert the data in a more convenient format. The
    first step is to define a data frame:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在本小节中，我们将把数据转换成更方便的格式。第一步是定义一个数据框：
- en: '[PRE3]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'We can see the structure of `dfTitanic` using `str`:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`str`查看`dfTitanic`的结构：
- en: '[PRE4]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'There are four factors representing the passenger''s attributes and `Freq`
    displaying the number of passengers for each combination of attributes. In order
    to use powerful tools to process data, we transform `dfTitanic` into a data table:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 有四个因素代表乘客的属性，`Freq`显示每个属性组合的乘客数量。为了使用强大的数据处理工具，我们将`dfTitanic`转换成数据表：
- en: '[PRE5]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'We can visualize the top rows of the table using `head`:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`head`查看表的顶部行：
- en: '[PRE6]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Here, `Class`, `Sex`, `Age`, and `Survived` represent the attributes and `Freq`
    shows the number of passengers for each combination. For instance, there are 35
    male third class children that survived. The other five feature combinations having
    no passengers.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`Class`（等级）、`Sex`（性别）、`Age`（年龄）和`Survived`（是否存活）代表属性，而`Freq`显示每个组合的乘客数量。例如，有35名男性三等舱儿童幸存。其他五个特征组合没有乘客。
- en: 'To start the analysis, we can define `nTot` containing the total number of
    passengers:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始分析，我们可以定义包含乘客总数的`nTot`：
- en: '[PRE7]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'There are `2201` passengers. Out of them, how many survived? We can use a simple
    data table aggregation to count the passengers that survived and the ones that
    didn''t. We need to specify the following:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 有`2201`名乘客。其中有多少幸存？我们可以使用简单的数据表聚合来计算幸存和未幸存的乘客数量。我们需要指定以下内容：
- en: '**Operation**: In order to count the passengers, we sum up the `Freq` column,
    so the operation is `n=sum(Freq)`'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作**：为了计算乘客数量，我们求和`Freq`列，所以操作是`n=sum(Freq)`'
- en: '**Aggregation**: We count the passengers for each possible value of the `Survived`
    column, so we need to specify that we aggregate by `Survived`'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**聚合**：我们按`Survived`列的每个可能值计算乘客数量，因此我们需要指定我们按`Survived`聚合'
- en: 'This is the data table syntax. We use the square brackets and the three arguments
    are:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 这是数据表语法。我们使用方括号，并且三个参数是：
- en: '**Rows to select**: We are using all the tables, so the argument is empty'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**选择行**：我们使用所有表格，所以参数为空'
- en: '**Operations**: This contains a list containing the operation, that is, `n=sum(Freq)`'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作**：这包含一个包含操作的列表，即`n=sum(Freq)`'
- en: '**Aggregation**: We specify that we aggregate `by=''Survived''`'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**聚合**：我们指定我们按`Survived`聚合'
- en: 'Consider the following code:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下代码：
- en: '[PRE8]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Visualizing the data through a histogram
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通过直方图可视化数据
- en: 'We can visualize `dtSurvived` by building a histogram and the R function is
    `barplot`:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过构建直方图来可视化`dtSurvived`，R函数是`barplot`：
- en: '[PRE9]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'In our case, the arguments that we need are `height` and `names.arg`, specifying
    the height and labels of the bars. Both the arguments require a vector in our
    case. Let''s see how we can build the chart. Follow these steps:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们这个例子中，我们需要的是`height`和`names.arg`参数，指定条形的高度和标签。在这两种情况下，参数都需要一个向量。让我们看看我们如何构建图表。按照以下步骤：
- en: 'Define the vector with height containing the number of passengers:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义包含乘客数量的高度向量：
- en: '[PRE10]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Define the vector with names containing the number of passengers that survived:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义包含幸存乘客数量的名称向量：
- en: '[PRE11]'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Build the chart:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建图表：
- en: '[PRE12]'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The histogram is as follows:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图如下：
- en: '![Visualizing the data through a histogram](img/7740OS_03_01.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![通过直方图可视化数据](img/7740OS_03_01.jpg)'
- en: 'The histogram shows the number of passengers that survived or not. The height
    of each bar is equal to the number of passengers and the labels show what the
    bars represent. We could have built the same chart using just one line of code:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图显示了幸存或未幸存的乘客数量。每个条形的高度等于乘客数量，标签显示了条形代表的内容。我们可以只用一行代码构建相同的图表：
- en: '[PRE13]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'This chart shows the total number of passengers. What if we want to visualize
    the percentage instead? Let''s take a look at the following steps:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 此图表显示了乘客总数。如果我们想可视化百分比呢？让我们看看以下步骤：
- en: 'Define the `percentage` column containing the number of passengers divided
    by the total number of passengers. We can define the new column using the `:=`
    data table operation. This column will be the `height` argument:'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义包含乘客数量除以乘客总数的`percentage`列。我们可以使用数据表操作`:=`定义新列。此列将是`height`参数：
- en: '[PRE14]'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Define the `colorPlot` column containing the colors blue and red for visualization.
    We use `ifelse` that is a function specifying that the color is `blue` if `Survived
    == ''Yes''`, and `red` otherwise. This column will be the `col` argument:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义包含蓝色和红色以供可视化的`colorPlot`列。我们使用`ifelse`函数指定，如果`Survived == 'Yes'`，颜色为`blue`，否则为红色。此列将是`col`参数：
- en: '[PRE15]'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Build the chart and as anticipated, we include the `col` argument, defining
    the `color` vector. In addition, the percentage ranges between 0 and 1, so we
    can specify that the area of the plot will be between 0 and 1 adding the `ylim`
    argument equal to `c(0, 1)`:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建图表，并预期包括`col`参数，定义`color`向量。此外，百分比范围在0到1之间，因此我们可以指定图表区域将在0到1之间，添加`ylim`参数等于`c(0,
    1)`：
- en: '[PRE16]'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The histogram is as follows:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图如下：
- en: '![Visualizing the data through a histogram](img/7740OS_03_02.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![通过直方图可视化数据](img/7740OS_03_02.jpg)'
- en: 'We can add a title and a legend to the chart; follow these steps:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以向图表添加标题和图例；按照以下步骤：
- en: 'Define the `textPercentage` column containing the percentage as a string. For
    instance, for a percentage of 0.323035, we display 32 percent in the legend:'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义包含百分比的`textPercentage`列，例如，对于0.323035的百分比，我们在图例中显示32%：
- en: '[PRE17]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Define the plot title:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义图表标题：
- en: '[PRE18]'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Define the *y* axis label:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义*y*轴标签：
- en: '[PRE19]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Build the plot:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建图表：
- en: '[PRE20]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The histogram is as follows:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图如下：
- en: '![Visualizing the data through a histogram](img/7740OS_03_03.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![通过直方图可视化数据](img/7740OS_03_03.jpg)'
- en: The general survival rate is **32%**, although it varies across different attribute
    combinations. The next subsection shows you how to visualize the impact of an
    attribute.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 总体生存率为**32%**，尽管它在不同的属性组合中有所变化。下一小节将向您展示如何可视化属性的影响。
- en: Visualizing the impact of a feature
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 可视化特征的影响
- en: 'In this subsection, we identify the impact of gender on the survival rate.
    First, we can define `dtGender` displaying the number of passengers that survived
    or did not survive, for each gender. The operation is `n=sum(Freq)` and it is
    performed for each combination of `Survived` and `Sex`. Similar to the previous
    section, we perform a simple data table aggregation, specifying the following:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在本小节中，我们确定性别对生存率的影响。首先，我们可以定义`dtGender`，显示每个性别中幸存或未幸存的乘客数量。操作是`n=sum(Freq)`，并且对`Survived`和`Sex`的每个组合进行操作。类似于上一节，我们执行简单的数据表聚合，指定以下内容：
- en: '**Rows to select**: We are using the entire table, so the argument is empty'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**选择行**：我们使用整个表，因此参数为空'
- en: '**Operations**: This is a list containing the operation, that is, `n=sum(Freq)`'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作**：这是一个包含操作的列表，即`n=sum(Freq)`'
- en: '**Aggregation**: We aggregate by two columns, so we define `by=c(''Survived'',
    ''Sex'')`'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**聚合**：我们通过两列进行聚合，因此我们定义`by=c(''Survived'', ''Sex'')`'
- en: 'Consider the following code:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下代码：
- en: '[PRE21]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Now, we can visualize the new data table through a histogram, as we saw earlier.
    The steps are as follows:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以通过直方图可视化新的数据表，就像我们之前看到的那样。步骤如下：
- en: 'Add the `percentage` column dividing `n` by the number of passengers of the
    gender. The operation is `n / sum(n)` and it is done by gender. Then, we use the
    `:=` operation specifying that we compute the sum `by=''Sex''`:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加`percentage`列，通过将`n`除以该性别的乘客总数来计算。操作是`n / sum(n)`，并且按性别进行。然后，我们使用`:=`操作指定我们计算`by='Sex'`的总和：
- en: '[PRE22]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Define the plot colors:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义绘图颜色：
- en: '[PRE23]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Define the *y* axis label:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义*Y*轴标签：
- en: '[PRE24]'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Extract the table with the male survival statistics:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提取包含男性生存统计数据的表：
- en: '[PRE25]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Build the histogram for males:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为男性构建直方图：
- en: '[PRE26]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Instead of extracting `dtGenderMale`, we could have directly built the chart
    adding `Sex == ''Male''` when extracting the vectors. We can build the same histogram
    for females in a similar way:'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以直接在提取向量时添加`Sex == 'Male'`来构建图表，而不是提取`dtGenderMale`。我们可以以类似的方式为女性构建相同的直方图：
- en: '[PRE27]'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Let''s display the charts that we built:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们显示我们构建的图表：
- en: '![Visualizing the impact of a feature](img/7740OS_03_04.jpg)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![可视化特征的影响](img/7740OS_03_04.jpg)'
- en: The male survival rate is just **21%** compared with 32% of passengers who survived.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 与32%的幸存乘客相比，男性的生存率仅为**21%**。
- en: '![Visualizing the impact of a feature](img/7740OS_03_05.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![可视化特征的影响](img/7740OS_03_05.jpg)'
- en: As expected, the female survival rate is significantly higher than the average.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期的那样，女性的生存率显著高于平均水平。
- en: 'We can compare the two genders in the same chart displaying just the survival
    rate that is the `Yes` column. We can build the plot using the same commands and
    including the `Survived == ''Yes''` condition. The only difference is the `col`
    argument, that in this case is the `Sex` column that is a factor with two levels.
    In this case, `barplot` automatically defines two colors that are black and red:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在同一张图表中比较两个性别，只显示生存率，即`Yes`列。我们可以使用相同的命令构建绘图，并包括`Survived == 'Yes'`条件。唯一的区别是`col`参数，在这种情况下是`Sex`列，它是一个有两个级别的因子。在这种情况下，`barplot`自动定义两种颜色，即黑色和红色：
- en: '[PRE28]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'The histogram is shown as follows:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图如下所示：
- en: '![Visualizing the impact of a feature](img/7740OS_03_06.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![可视化特征的影响](img/7740OS_03_06.jpg)'
- en: The chart allows us to visualize the difference and the legend displays the
    survival rate. As expected, the difference is huge.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 该图表使我们能够可视化差异，图例显示生存率。正如预期的那样，差异很大。
- en: Visualizing the impact of two features combined
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 可视化两个特征结合的影响
- en: 'In this chapter, we investigate the impact of another feature: class. How does
    the survival rate vary across the different classes of passengers? First, we can
    just build the same survival rate chart as the one for gender, by following these
    steps:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们研究另一个特征的影响：等级。乘客的不同等级的生存率是如何变化的？首先，我们可以通过以下步骤构建与性别相同的生存率图表：
- en: 'Define `dtClass` containing the passengers that survived or didn''t survive
    for each class:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义包含每个等级的乘客是否幸存或未幸存的`dtClass`：
- en: '[PRE29]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Define the percentage of passengers that survived or didn''t survive for each
    class:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义每个等级中幸存或未幸存的乘客的百分比：
- en: '[PRE30]'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Define the percentage text:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义百分比文本：
- en: '[PRE31]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Build the histogram:'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建直方图：
- en: '[PRE32]'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'The histogram is as follows:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图如下所示：
- en: '![Visualizing the impact of two features combined](img/7740OS_03_07.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![可视化两个特征结合的影响](img/7740OS_03_07.jpg)'
- en: The survival rate varies a lot across the classes. We can notice that the passengers
    belonging to higher classes are more likely to survive and that the crew has a
    survival rate similar to the third class. Can we conclude that class has a high
    impact on the survival rate?
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 生存率在各个等级之间差异很大。我们可以注意到，属于较高等级的乘客更有可能幸存，而船员的生存率与三等舱相似。我们能得出结论说等级对生存率有重大影响吗？
- en: The chart shows the overall survival rate for each class. However, knowing that
    the females are more likely to survive, a class with a higher female:male ratio
    will likely have a higher survival rate. If a higher survival rate is explained
    by the gender only, the fact of belonging to a different class doesn't have an
    impact at all.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 该图表显示了每个等级的整体生存率。然而，考虑到女性更有可能幸存，女性与男性的比例较高的等级可能具有更高的生存率。如果较高的生存率仅由性别解释，那么属于不同等级的事实根本没有任何影响。
- en: 'In order to understand whether the difference between the survival rates depends
    on the percentage of females in each class, we can visualize the gender ratio
    by class. The chart is a histogram showing the percentage of females for each
    social class and the commands are similar as earlier:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解生存率之间的差异是否取决于每个等级中女性的百分比，我们可以通过等级可视化性别比例。图表是一个直方图，显示了每个社会等级中女性的百分比，命令与之前类似：
- en: '[PRE33]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'The histogram is as follows:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图如下所示：
- en: '![Visualizing the impact of two features combined](img/7740OS_03_08.jpg)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![可视化两个特征结合的影响](img/7740OS_03_08.jpg)'
- en: 'The gender ratio varies a lot across the different classes as the percentage
    of females is higher in the top classes, and that there are almost no females
    in the crew. Therefore, the percentage of females might have biased the survival
    rate by class. In order to have a better understanding of the impact of the two
    attributes on the survival rate, we need to take account of the gender and of
    the class at the same time. For this purpose, we can compute the survival rate
    for each combination of these two features. Use the following steps to build the
    chart:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 性别比例在不同等级之间差异很大，因为顶级等级中女性的百分比较高，而船员中几乎没有女性。因此，女性的百分比可能已经通过等级影响了生存率。为了更好地理解两个属性对生存率的影响，我们需要同时考虑性别和等级。为此，我们可以计算这两个特征的每个组合的生存率。使用以下步骤构建图表：
- en: 'Compute the sum of the passengers for each combination of `Survived`, `Sex`,
    and `Class`. Now the `by` argument includes three column names:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算每个`Survived`、`Sex`和`Class`组合的乘客总数。现在`by`参数包括三个列名：
- en: '[PRE34]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Add the `nTot` column specifying the total number of passengers for each feature
    combination (not including `Survived`). The `by` argument includes two features:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加指定每个特征组合的乘客总数的`nTot`列（不包括`Survived`）。`by`参数包括两个特征：
- en: '[PRE35]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Add the `percentage` column. The `by` argument includes the two features:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加`percentage`列。`by`参数包括两个特征：
- en: '[PRE36]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Extract the column containing the survival rate using the `Survived == ''Yes''`
    condition:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`Survived == 'Yes'`条件提取包含生存率的列：
- en: '[PRE37]'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Add the `textPercentage` column:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加`textPercentage`列：
- en: '[PRE38]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Add the `colorPlot` column. The `rainbow` function builds a vector with a defined
    number of rainbow colors. In this case, we define a column for each row, so we
    use `rainbow(nrow(dtGenderClass))`:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加`colorPlot`列。`rainbow`函数构建一个包含定义数量的彩虹颜色的向量。在这种情况下，我们为每一行定义一个列，因此我们使用`rainbow(nrow(dtGenderClass))`：
- en: '[PRE39]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Define the group name to be included in the labels. Since the histogram will
    display the survival rate for each combination of both the features, we set the
    name of each group as the gender and the class combined, using `paste`. In order
    to fit the names into the chart, we define `SexAbbr` containing an abbreviation
    of the gender:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义要包含在标签中的组名。由于直方图将显示每个特征组合的生存率，我们使用`paste`将每个组的名称设置为性别和等级的组合。为了将名称适应到图表中，我们定义了包含性别缩写的`SexAbbr`：
- en: '[PRE40]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Define the labels containing the plot name and the number of passengers in
    the group. Since we want to display the name and number in two different lines,
    we separate them with `\n` that defines a new line in a string:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义包含绘图名称和组内乘客数量的标签。由于我们希望在不同行中显示名称和数量，我们使用`\n`（在字符串中定义新行的符号）将它们分开：
- en: '[PRE41]'
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Generate the histogram. Similar to `ylim`, the `xlim` argument defines the
    *x* region to visualize. In this case, we use `xlim` to avoid overlapping the
    legend and the chart:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成直方图。与`ylim`类似，`xlim`参数定义了要可视化的*x*区域。在这种情况下，我们使用`xlim`来避免图例和图表重叠：
- en: '[PRE42]'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'The histogram generated is as follows:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 生成的直方图如下：
- en: '![Visualizing the impact of two features combined](img/7740OS_03_09.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![可视化两个特征结合的影响](img/7740OS_03_09.jpg)'
- en: We can find the number of passengers of a group under its column. Apart from
    the female crew, each bar contains at least 100 passengers, so we can assume that
    the result is meaningful. In order to measure the meaningfulness, we could have
    used a statistic technique such as confidence intervals or a hypothesis test,
    but it's not the topic of this book.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在其列下找到该组的乘客数量。除了女性船员外，每个条形图至少包含100名乘客，因此我们可以假设结果是具有意义的。为了衡量意义，我们本可以使用诸如置信区间或假设检验之类的统计技术，但这不是本书的主题。
- en: The class is affecting the males and the females in different ways. In the case
    of males, the survival rate is very low although it is significantly higher for
    the first class. In the case of females, the survival rate is close to 100 percent
    for each class apart from the third class.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 班级以不同的方式影响着男性和女性。在男性方面，尽管头等舱的生存率显著较高，但生存率非常低。在女性方面，除了第三班外，每个班级的生存率都接近100%。
- en: We can also look at the chart in the opposite way in order to understand the
    impact of the gender over the passengers belonging to the same class. In all the
    situations, the survival rate is significantly higher, although the difference
    is much higher for some specific classes. The impact of the gender and the class
    are related, so we need to take account of both the features at the same time
    if we want to understand their effect.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以从相反的角度来看图表，以了解性别对同一班级乘客的影响。在所有情况下，生存率都显著较高，尽管对于某些特定班级的差异要大得多。性别和班级的影响是相关的，因此如果我们想了解它们的影响，我们需要同时考虑这两个特征。
- en: 'We haven''t explored the age yet. We can visualize the survival rate for each
    combination of all the features. The code to prepare and plot the table is similar
    as before. In this case, we can just apply the operations to `dtTitanic` directly.
    The steps are as follows:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还没有探索年龄。我们可以可视化所有特征的每个组合的生存率。准备和绘制表的代码与之前类似。在这种情况下，我们只需直接对`dtTitanic`应用操作。步骤如下：
- en: 'Compute the percentage of people that survived or didn''t survive for each
    combination of the three features:'
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算每个三个特征的组合中生存或未生存的人的百分比：
- en: '[PRE43]'
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Add the percentage of passengers surviving for each attribute combination:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加每个属性组合中生存的乘客的百分比：
- en: '[PRE44]'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Extract the survival rate using the `Survived == ''Yes''` condition:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`Survived == 'Yes'`条件提取生存率：
- en: '[PRE45]'
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Add the legend text including the abbreviations of all the three features.
    For the class, we use substring that is a function extracting a part of the string.
    In our case, we extract the first character, so we specify that we extract the
    elements between `1` and `1` using `substring(Class, 1, 1)`:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加包括所有三个特征缩写的图例文本。对于班级，我们使用子字符串函数，这是一个提取字符串一部分的函数。在我们的情况下，我们提取第一个字符，因此我们指定使用`substring(Class,
    1, 1)`提取`1`和`1`之间的元素：
- en: '[PRE46]'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Add the plot color:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加绘图颜色：
- en: '[PRE47]'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Add the percentage to display in the label:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加要显示在标签中的百分比：
- en: '[PRE48]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Add the label including the percentage and the total number:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加包含百分比和总数的标签：
- en: '[PRE49]'
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Generate the plot. We have more groups than before, so the layout is different
    in order to visualize all the relevant information. The `xlim` argument leaves
    some space for the legend and the `cex.names` argument decreases the label text
    size:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成绘图。由于我们比之前有更多的组，因此布局不同，以便可视化所有相关信息。`xlim`参数为图例留出一些空间，而`cex.names`参数减小了标签文本的大小：
- en: '[PRE50]'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'The histogram is as follows:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 直方图如下：
- en: '![Visualizing the impact of two features combined](img/7740OS_03_10.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![可视化两个特征结合的影响](img/7740OS_03_10.jpg)'
- en: The legend displays the abbreviated feature combinations. For instance, **1MC**
    means first class, male, child. In the case of combinations with no passengers,
    we don't have any information about the percentage, so the bar label displays
    **NaN%**.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 图例显示了特征的缩写组合。例如，**1MC**代表一等舱、男性、儿童。在没有任何乘客的组合情况下，我们没有关于百分比的任何信息，因此条形标签显示**NaN%**。
- en: Since we are combining three features, some groups are very small. For instance,
    we have only five first class male children. There are also other groups with
    no passengers at all (for example, children in the crew). Therefore, this approach
    has some limitations.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们结合了三个特征，一些组非常小。例如，我们只有五位一等舱男性儿童。还有其他完全没有乘客的组（例如，船员中的儿童）。因此，这种方法有一些局限性。
- en: Exploring the data using machine learning models
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用机器学习模型探索数据
- en: Visualizing the survival rate for each group of passengers provides us with
    an overview of the data. We have an idea about how the different features interact
    with the survival rate and with each other. For instance, we know that the social
    class has a different impact on the survival rate depending on the gender. But
    which of the two features has the highest impact? How big is the impact of each
    feature? We haven't defined a ranking of the features or quantified the impact
    of each of them. Some machine learning techniques allow us to investigate further,
    answering to our questions.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 可视化每个乘客组的生存率为我们提供了数据的概览。我们了解不同的特征如何与生存率以及彼此相互作用。例如，我们知道社会阶层对生存率的影响取决于性别。但哪两个特征的影响最大？每个特征的影响有多大？我们还没有定义特征的排名或量化它们的影响。一些机器学习技术允许我们进一步调查，回答我们的问题。
- en: Exploring the data using a decision tree
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用决策树探索数据
- en: We have three features (class, sex, and age) and we want to divide the passengers
    in groups accordingly. We can't define a group for each combination of features
    since we won't have enough data for some groups such as the female children of
    the first class. A solution is to divide the passengers in groups in such a way
    that each group contains enough data. A group is defined by some conditions on
    the features, such as males not belonging to the first class. The groups should
    cover every possible situation without overlapping. A machine learning technique
    that identifies groups that are big enough is the decision tree learning.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有三个特征（类别、性别和年龄），并希望根据这些特征将乘客分成不同的组。由于某些组（例如一等舱的女童）的数据量不足，我们无法为每个特征组合定义一个组。一种解决方案是将乘客分成组，使得每个组都有足够的数据。一个组由一些关于特征的约束条件定义，例如男性不属于一等舱。这些组应该覆盖所有可能的情况，且不重叠。一种识别足够大组的机器学习技术是决策树学习。
- en: There is a new passenger and we know it's a male child of the second class.
    We don't know if the passenger will survive or not and we want to predict that.
    How can we use the data? We can check whether the passenger is a male or a female.
    Accordingly, with our previous data exploration, he'll survive with a probability
    of 21 percent since he's a male. Taking account of the social class, we can say
    that he will survive with a probability of 14 percent. There are 179 second class
    male passengers, so this result is meaningful. Then, knowing that he is a child,
    we can check the survival rate of the second class male children, which is 100
    percent. Does it make sense to say that he will survive with a probability of
    100 percent? There are only 11 passengers that are second class male children,
    so we don't have enough data to make an accurate prediction. Should we use the
    survival rate of the second class males? What if we use the survival rate of all
    the male children instead? What about the second class children? There are different
    options leading to different results.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 有一位新乘客，我们知道他是一位二等舱的男童。我们不知道这位乘客是否会幸存，我们想要预测这一点。我们如何使用这些数据？我们可以检查这位乘客是男性还是女性。根据我们之前的数据探索，他作为男性，幸存的可能性为21%。考虑到社会阶层，我们可以说他幸存的可能性为14%。有179位二等舱男性乘客，所以这个结果是有意义的。然后，知道他是一位儿童，我们可以查看二等舱男性儿童的生存率，这是100%。说他会以100%的概率幸存合理吗？只有11位乘客是二等舱男性儿童，所以我们没有足够的数据来做出准确的预测。我们应该使用二等舱男性的生存率吗？如果我们使用所有男性儿童的生存率呢？或者二等舱儿童的生存率呢？不同的选择会导致不同的结果。
- en: A solution is to identify the key features and take account of them only. For
    instance, if the gender and class are the two most important features, we can
    use them to make a prediction. However, in the case of the third class male children,
    we have much more data than the first class male children. What if we take account
    of the age only in the case of third class males? The number of features that
    we want to include depends on the group we're taking account of.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 一种解决方案是识别关键特征，并且只考虑它们。例如，如果性别和舱位是两个最重要的特征，我们可以使用它们来进行预测。然而，在第三等舱男性儿童的情况下，我们拥有的数据比第一等舱男性儿童多得多。如果我们只在第三等舱男性中考虑年龄会怎样？我们想要包含的特征数量取决于我们考虑的组。
- en: 'Instead of just selecting the two most important features, we can define a
    criterion of splitting a group only if it is big enough and we can visualize this
    principle through a decision tree. Let''s suppose that in the beginning all the
    passengers belong to the same group. We can split them in two groups based on
    gender. Then, we can split the males in two groups: first class on one side and
    all the other classes on the other side. For the females, the most meaningful
    split might be another: children on one side, the adults on the other.'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不仅可以选择两个最重要的特征，还可以定义一个标准，只有当分组足够大时才进行分割，我们可以通过决策树可视化这个原则。假设一开始所有乘客都属于同一个组。我们可以根据性别将他们分成两组。然后，我们可以将男性分成两组：一边是一等舱，另一边是所有其他舱位。对于女性，最有意义的分割可能是一个不同的：一边是儿童，另一边是成人。
- en: 'The decision tree learning technique learns from the data in order to identify
    the most meaningful splits and it can be used to explore the data. The tree continues
    splitting the data until the groups, defined by the tree leaves, are too small.
    Then, for each group, we use the related data to define an attribute that can
    be:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 决策树学习技术从数据中学习以识别最有意义的分割，并且可以用来探索数据。树继续分割数据，直到由树叶定义的组变得太小。然后，对于每个组，我们使用相关的数据来定义一个属性，该属性可以是：
- en: '**Categoric**: This is an attribute whose value belongs to categories. In this
    case, the categories are **Survived** and **Not survived**. The tree performs
    classification.'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Categoric**：这是一个其值属于类别的属性。在这种情况下，类别是**Survived**和**Not survived**。树执行分类。'
- en: '**Numeric**: This is an attribute that can be measured, and in this case it
    is the survival rate. The tree performs regression.'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Numeric**：这是一个可以测量的属性，在这种情况下，它是生存率。树执行回归。'
- en: 'We can build a decision tree in R using the `rpart` package. In addition, we
    can visualize the trees using another package that is `rpart.plot`. In order to
    use the packages, we need to install and load them. In and case of installation
    issues, you can specify the repository as an argument of `install.packages`:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`rpart`包在R中构建决策树。此外，我们可以使用另一个名为`rpart.plot`的包来可视化树。为了使用这些包，我们需要安装并加载它们。如果遇到安装问题，可以在`install.packages`函数的参数中指定仓库：
- en: '[PRE51]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'After the installation, we can load both the packages:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，我们可以加载以下两个包：
- en: '[PRE52]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: The starting point is `dtTitanic` and it contains a row for each combination
    of the features. Before building the decision tree, we need to transform the data
    into another format. We need to have a row for each passenger and the same columns
    apart from `Freq`. In order to generate the new table in the new format, we use
    the data table operation with `list` and `by`.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 起始点是`dtTitanic`，它包含每个特征组合的一行。在构建决策树之前，我们需要将数据转换成另一种格式。我们需要为每位乘客创建一行，除了`Freq`之外，其他列保持不变。为了生成新格式的新的表格，我们使用`data.table`操作与`list`和`by`。
- en: For each row of `dtTitanic`, we want to generate a table having a number of
    rows equal to `Freq`. Each row corresponds to a combination between `Survived`,
    `Sex`, `Age`, and `Class`, so the `by` argument contains a vector with the four
    features.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`dtTitanic`的每一行，我们希望生成一个具有与`Freq`相同的行数的表格。每一行对应于`Survived`、`Sex`、`Age`和`Class`之间的组合，因此`by`参数包含一个包含四个特征的向量。
- en: 'In the new table, each row contains a passenger, so `Freq` is equal to `1`.
    Then, for each row of `dtTitanic`, we need to define a vector having `Freq` elements
    equal to `1`. In order to do that, we use `rep` that is a function replicating
    an element a defined number of times. In our case, we use `rep(1, Freq))`. The
    other columns replicate the elements defined in `by` that are `Survived`, `Sex`,
    `Age`, and `Class`, so we don''t need to redefine them:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在新的表中，每一行包含一个乘客，所以 `Freq` 等于 `1`。然后，对于 `dtTitanic` 的每一行，我们需要定义一个包含 `Freq` 个
    `1` 的向量。为了做到这一点，我们使用 `rep` 函数，它是一个复制元素一定次数的函数。在我们的例子中，我们使用 `rep(1, Freq))`。其他列复制
    `by` 中定义的元素，即 `Survived`、`Sex`、`Age` 和 `Class`，所以我们不需要重新定义它们：
- en: '[PRE53]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '`Freq` is `1` for each row, so we don''t need it anymore and can delete it:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: '`Freq` 对于每一行都是 `1`，所以我们不再需要它，可以删除它：'
- en: '[PRE54]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'In order to build a decision tree showing the survival rate, we need to change
    the format of `Survived`. Instead of having `No` and `Yes`, we want `0` and `1`
    respectively. To modify the column, we can use `ifelse`:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 为了构建显示生存率的决策树，我们需要更改 `Survived` 的格式。我们希望将 `No` 和 `Yes` 分别改为 `0` 和 `1`。要修改列，我们可以使用
    `ifelse`：
- en: '[PRE55]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Let''s see the first six rows of `DtLong` using `head`:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用 `head` 查看一下 `DtLong` 的前六行：
- en: '[PRE56]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: The first six rows show six male children that didn't survive.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 前六行显示了六名未幸存的男性儿童。
- en: 'The `dtLong` object contains the standard input of the decision tree algorithm
    and we can use `rpart` to build the model. Our goal is to define groups of passengers
    about whom we are able to estimate the survival rate:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '`dtLong` 对象包含决策树算法的标准输入，我们可以使用 `rpart` 来构建模型。我们的目标是定义一组乘客，关于他们，我们能够估计生存率：'
- en: '[PRE57]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'The mandatory arguments are:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 必要的参数是：
- en: '`formula`: This is a formula object defining the attribute to predict and the
    feature used to predict. The formula is defined by a string such as `outcome ~
    feature1 + feature2 + feature3`.'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`formula`：这是一个公式对象，定义了要预测的属性和用于预测的特征。公式由一个字符串定义，例如 `outcome ~ feature1 + feature2
    + feature3`。'
- en: '`data`: This is the data frame or data table that is `dtLong` in our case.'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`data`：这是数据框或数据表，在我们的例子中是 `dtLong`。'
- en: 'We need to define the formula starting from the `Survived ~ Sex + Age + Class`
    string:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要从 `Survived ~ Sex + Age + Class` 字符串开始定义公式：
- en: '[PRE58]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Now we can build `treeRegr` containing a decision tree. Since `Survived` is
    numeric, the function automatically builds a `regrssion` tree:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以构建包含决策树的 `treeRegr`。由于 `Survived` 是数值型的，函数会自动构建一个回归树：
- en: '[PRE59]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'The `treeRegr` object contains the decision tree and we can visualize it using
    `prp(treeRegr)`:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '`treeRegr` 对象包含决策树，我们可以使用 `prp(treeRegr)` 来可视化它：'
- en: '![Exploring the data using a decision tree](img/7740OS_03_11.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![使用决策树探索数据](img/7740OS_03_11.jpg)'
- en: Let's take a look at the tree. Each interior node is labeled with a condition
    that splits the data in two parts. The node on the top, for instance, splits the
    passengers into males and females. The branch on the left corresponds to the passengers
    fulfilling the condition (in this case, the male passengers), and the branch on
    the right corresponds to the others (the females). Each leaf defines the survival
    rate of the group. For instance, the leaf to the right states that the survival
    rate for the females not belonging to the third class is 93 percent.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看这棵树。每个内部节点都标记了一个条件，该条件将数据分成两部分。例如，顶部的节点将乘客分为男性和女性。左边的分支对应满足条件的乘客（在这种情况下，男性乘客），右边的分支对应其他人（女性）。每个叶子定义了该组的生存率。例如，右边的叶子表明不属于第三类的女性的生存率为
    93%。
- en: The tree doesn't contain all the possible feature combinations because of the
    lack of data. For instance, in the case of the females, there are only 45 children
    and they belong to different social classes, so the tree doesn't divide the females
    based on their age.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 由于数据不足，这棵树不包含所有可能的特征组合。例如，在女性的情况下，只有 45 个孩子，她们属于不同的社会阶层，因此这棵树不会根据她们的年龄来划分女性。
- en: Let's suppose that we have a new passenger that is female, child, second class.
    How do we predict if she will survive? She is a female not belonging to the third
    class, so her expected survival rate is 93 percent. Therefore, we can say that
    she will likely survive.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们有一个新的乘客，她是女性、儿童、二等舱。我们如何预测她是否会生存？她是一个不属于第三类的女性，所以她的预期生存率为 93%。因此，我们可以说她很可能会生存。
- en: 'The tree defines a survival rate that is a number. What if we wanted to predict
    whether the passenger survived or not? We can build a classification tree adding
    `method=''class''` input to `rpart`:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 树定义了一个表示为数字的生存率。如果我们想预测乘客是否存活？我们可以通过向`rpart`添加`method='class'`输入来构建一个分类树：
- en: '[PRE60]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'The tree is shown as follows:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 树的表示如下：
- en: '![Exploring the data using a decision tree](img/7740OS_03_12.jpg)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![使用决策树探索数据](img/7740OS_03_12.jpg)'
- en: This tree predicts that the only passengers that will survive are females and
    children not belonging to the third class. This result is useful to explore the
    data. The next step is using machine learning models to predict an outcome. We
    can use this tree for that purpose, although it just defines five groups of passengers
    out of the 16 possible feature combinations, so it might not be the most appropriate
    technique. There are more advanced algorithms and in the next chapter we see one
    of them.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 这棵树预测只有女性和三等舱外的儿童乘客会存活。这个结果对于探索数据是有用的。下一步是使用机器学习模型来预测结果。我们可以用这棵树来达到这个目的，尽管它只定义了16种可能特征组合中的五个乘客组，所以它可能不是最合适的技术。还有更高级的算法，在下一章我们将看到其中之一。
- en: Predicting newer outcomes
  id: totrans-210
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 预测新的结果
- en: Given a new passenger and knowing his or her personal information, we want to
    predict whether he or she will survive. The options that we explored until now
    are based on dividing the passengers into groups and identifying the survival
    rate for each group. For some combinations of features, such as first class female
    children, we don't have enough data, so we have to use the survival rate of a
    larger group such as females not belonging to the third class. We are ignoring
    some details, for instance, the fact that they are children, and in this way we
    are losing information. Is there a way to estimate the survival rate for any combination
    of features, regardless of how many passengers we have?
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 给定一个新乘客以及他们的个人信息，我们想要预测他们是否会存活。我们至今探索的选项都是基于将乘客分为组并确定每个组的生存率。对于某些特征组合，例如头等舱女性儿童，我们没有足够的数据，因此我们必须使用更大组（如不属于三等舱的女性）的生存率。我们忽略了某些细节，例如他们是儿童的事实，这样我们就丢失了信息。有没有一种方法可以估计任何特征组合的生存率，而不管我们有多少乘客？
- en: There are many machine learning algorithms that take account of all the features
    at the same time. In this chapter, we see a very popular algorithm that is the
    **random forest** algorithm. It's not the best option in this context, as it performs
    better when there are much more features, but it's good for the purpose of illustrating
    a general approach.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多机器学习算法会同时考虑所有特征。在本章中，我们将看到一个非常流行的算法，即**随机森林**算法。在这个上下文中，它并不是最佳选择，因为当有更多特征时，它的表现会更好，但它对于说明一般方法是有益的。
- en: Building a machine learning model
  id: totrans-213
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建机器学习模型
- en: 'As its name suggests, the random forest algorithm is based on many random decision
    trees. The algorithm builds `ntree` trees repeating the following steps:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 如其名所示，随机森林算法基于许多随机决策树。算法通过重复以下步骤来构建`ntree`个树：
- en: Generate the data to build the tree choosing a random row from the data (in
    our case, that is `dtLong`) sampsize times. Each row can be chosen more than once
    and in the end we have a table with sampsize random rows.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过从数据中选择一个随机的行（在我们的案例中，即`dtLong`）`sampsize`次来生成构建树的数据。每一行可以选择多次，最终我们得到一个包含`sampsize`个随机行的表格。
- en: Randomly select a `mtry` number of features (unfortunately in our case we don't
    have many features, but it's still possible to select a subset of them).
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 随机选择一个`mtry`数量的特征（不幸的是，在我们的案例中我们没有很多特征，但仍然可以选择它们的子集）。
- en: Build a decision tree based on the sampled data taking account of the selected
    features only.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 基于采样数据，仅考虑所选特征来构建决策树。
- en: A random forest model is composed by `ntree` decision trees. In our context,
    given a new passenger, the model forecasts their survival rate using each tree.
    The final forecasted value is the average between the survival rates. In another
    variation of the algorithm, we have the mode instead of the average.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 随机森林模型由`ntree`个决策树组成。在我们的上下文中，给定一个新乘客，模型使用每个树来预测他们的生存率。最终的预测值是生存率的平均值。在算法的另一种变体中，我们使用众数而不是平均值。
- en: 'The random forest is a popular algorithm and it is provided by the `randomForest`
    package. Let''s install and load it:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 随机森林是一个流行的算法，它由`randomForest`包提供。让我们安装并加载它：
- en: '[PRE61]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Like the simple decision tree learning, the random forest attributes can be
    categoric or numeric.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 与简单的决策树学习一样，随机森林的特征可以是分类的或数值的。
- en: In our case, all the features are categoric and there are two to four possible
    values for each feature. We can convert the features into a numeric format. For
    instance, in the case of `Sex`, the possible values are `Male` and `Female`. We
    can define a numeric feature that is `1` in the case of `Male` and `0` otherwise.
    The new feature shows the same information in a different way. Numeric features
    derived from categoric in this way are called dummy variables. In the case of
    a categoric feature with more than two categories, we can define a dummy variable
    for each categories apart from one. In this way, looking at the dummy variables,
    if one of them is equal to `1`, we know which the groups are. If they are all
    equal to `0`, we know that a group is remaining.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的案例中，所有特征都是分类的，每个特征有两个到四个可能的值。我们可以将特征转换为数值格式。例如，在`Sex`的情况下，可能的值是`Male`和`Female`。我们可以定义一个数值特征，当性别为`Male`时为`1`，否则为`0`。新的特征以不同的方式展示了相同的信息。以这种方式从分类特征派生出的数值特征被称为虚拟变量。在具有两个以上类别的分类特征的情况下，我们可以为每个类别（除了一个）定义一个虚拟变量。这样，通过查看虚拟变量，如果其中一个等于`1`，我们就知道哪个组。如果它们都等于`0`，我们就知道还有一个组剩下。
- en: 'We can define a new table containing dummy variables through the following
    steps:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过以下步骤定义一个包含虚拟变量的新表：
- en: 'Build a copy of the categoric features table:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建分类特征表的副本：
- en: '[PRE62]'
  id: totrans-225
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Convert `Sex` into a dummy variable:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`Sex`转换为虚拟变量：
- en: '[PRE63]'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Convert `Age` into a dummy variable:'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`Age`转换为虚拟变量：
- en: '[PRE64]'
  id: totrans-229
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Convert `Class` into three dummy variables:'
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`Class`转换为三个虚拟变量：
- en: '[PRE65]'
  id: totrans-231
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Define the `formulaRf` formula:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义`formulaRf`公式：
- en: '[PRE66]'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'Build `forest` containing the random forest model. All the parameters are left
    as their default values:'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建`forest`，包含随机森林模型。所有参数都保留为它们的默认值：
- en: '[PRE67]'
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'We stored the random forest model in `forest` that is a list containing the
    machine learning model, and all the related parameters and information. We can
    explore the model observing the elements of the list. For instance, the number
    of trees that the model has built is contained in the `ntree` element:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将随机森林模型存储在名为`forest`的列表中，该列表包含机器学习模型、所有相关参数和信息。我们可以通过观察列表的元素来探索模型。例如，模型构建的树的数量包含在`ntree`元素中：
- en: '[PRE68]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'Another parameter is `mtry` and it defines the number of variables used in
    each iteration:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个参数是`mtry`，它定义了每次迭代中使用的变量数量：
- en: '[PRE69]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: The number of trees has been defaulted to 500.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 树的数量已默认设置为500。
- en: The algorithm is selecting just one feature at once. The reason is that the
    random forest is meant to work with a lot of features, so it doesn't perform well
    in this context.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 算法一次只选择一个特征。原因是随机森林旨在与许多特征一起工作，因此在这种环境中表现不佳。
- en: 'Another parameter is `type` and it defines the output of the algorithm. The
    random forest can be used for different purposes and in our case we want to estimate
    the survival rate, so we want to use it for regression:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个参数是`type`，它定义了算法的输出。随机森林可以用于不同的目的，在我们的案例中，我们想要估计生存率，因此我们想要将其用于回归：
- en: '[PRE70]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: As expected, `forest` is performing regression.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期的那样，`forest`正在执行回归。
- en: 'If we want to change some parameters, we can define them in the arguments.
    In this chapter, we are not defining a criterion to set the parameters, so we
    just assign another value. For instance, we can build `1000` trees using three
    random features and `1500` random rows for each. We can rebuild `forest` changing
    the parameters:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想更改一些参数，我们可以在参数中定义它们。在本章中，我们没有定义一个标准来设置参数，所以我们只是分配另一个值。例如，我们可以使用三个随机特征和每个`1500`行随机数据构建`1000`棵树。我们可以通过更改参数来重建`forest`：
- en: '[PRE71]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: We built a random `forest` model and the next subsection shows how to use it.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 我们构建了一个随机`forest`模型，下一个小节将展示如何使用它。
- en: Using the model to predict new outcomes
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用模型预测新的结果
- en: 'Now that we have built the model, we can use it to perform some predictions.
    If we have a new passenger, what is their survival rate? First, let''s extract
    a random passenger:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经构建了模型，我们可以使用它来进行一些预测。如果我们有一个新的乘客，他们的生存率是多少？首先，让我们提取一个随机乘客：
- en: '[PRE72]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 'The random passenger is an adult male of the first class. We can use the `forest`
    model to estimate his survival rate. The `predict` function allows us to apply
    the model on the new data, obtaining a prediction:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 随机乘客是一位一等舱的成年男性。我们可以使用`forest`模型来估计他的生存率。`predict`函数允许我们将模型应用于新数据，从而获得预测：
- en: '[PRE73]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 'The estimated survival rate is about 38 percent, so the passenger won''t likely
    survive. We can use the same approach to predict the survival rate of all the
    passengers. However, that means to apply the model on the same data that we used
    to build it. This approach is not good for testing the model because the predicted
    values will be related to the initial data. Keeping in mind that this result cannot
    be used, we can use it just to compare the prediction with the real data:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 估计的生存率约为38%，因此乘客不太可能幸存。我们可以使用相同的方法来预测所有乘客的生存率。然而，这意味着要使用构建模型所用的相同数据来应用模型。这种方法不适合测试模型，因为预测值将与初始数据相关。考虑到这个结果不能使用，我们可以用它来比较预测与实际数据：
- en: '[PRE74]'
  id: totrans-254
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'We can see the prediction of six random rows using `sample`:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`sample`查看六行随机数据的预测：
- en: '[PRE75]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'We defined a survival rate for each passenger. Let''s add the estimated survival
    rate to the `dtDummy` table:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 我们为每个乘客定义了一个生存率。让我们将估计的生存率添加到`dtDummy`表中：
- en: '[PRE76]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'Now, we can predict that a passenger will survive if their survival rate is
    above a threshold, for instance, 50 percent. We can define a new column name,
    `SurvivedPred`, containing our prediction:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以预测如果乘客的生存率高于一个阈值，例如50%，乘客将幸存。我们可以定义一个新的列名`SurvivedPred`，包含我们的预测：
- en: '[PRE77]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'Now we can compare the predicted survival with the initial data. In order to
    evaluate how many times the two values match, we can define an `error` column
    that is `TRUE` if the values don''t match:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以比较预测的生存率与初始数据。为了评估两个值匹配的次数，我们可以定义一个`error`列，如果值不匹配则为`TRUE`：
- en: '[PRE78]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'Starting from the error column, we can compute the general error as the percentage
    of passengers upon which we made a wrong prediction. We need to divide the number
    of errors by the number of passengers. We can have the number of errors applying
    sum to error, since the sum of a vector of Boolean variables is equal to the number
    of `TRUE` values. The total number of passengers is defined by `.N`, which in
    the `data.table` notation is equal to the number of rows:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 从错误列开始，我们可以计算总体误差，即我们做出错误预测的乘客百分比。我们需要将错误数量除以乘客数量。我们可以通过将错误求和来得到错误数量，因为布尔变量的向量之和等于`TRUE`值的数量。总乘客数由`.N`定义，在`data.table`表示法中等于行数：
- en: '[PRE79]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'The model predicted the wrong outcome in 21 percent of the situations, so we
    have an accuracy of 79 percent. Anyway, this result doesn''t make any sense since
    we''re making a prediction on the same data that we used to build the model. In
    addition, knowing how many passengers survived, we could have just guessed the
    most common outcome for each of them. If more than half of them survived, we can
    set `SurvivedPred = TRUE` for all of them and guess more than half. Let''s compute
    the overall probability of surviving. The general survival rate is lower than
    50 percent, so each passenger is more likely not to survive. Then, in absence
    of any other information, we can predict that no one survives:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 模型在21%的情况下预测了错误的结果，因此我们的准确率为79%。无论如何，这个结果没有任何意义，因为我们正在对构建模型所用的相同数据进行预测。此外，如果我们知道有多少乘客幸存，我们只需猜测每个乘客最常见的结果。如果其中超过一半的乘客幸存，我们可以将`SurvivedPred`设置为`TRUE`，并猜测超过一半。让我们计算幸存的整体概率。总体生存率低于50%，因此每个乘客不太可能幸存。然后，在没有其他信息的情况下，我们可以预测没有人会幸存：
- en: '[PRE80]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: We could have achieved accuracy of more than 65 percent without taking account
    of any feature, so 79 percent is just 15 percent higher. In addition, as already
    said, this accuracy cannot be used because we are applying the model on the same
    data used to build it.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 即使不考虑任何特征，我们也能达到超过65%的准确率，所以79%只是高出15%。此外，正如之前所说，这个准确率不能使用，因为我们正在将模型应用于构建模型所用的相同数据。
- en: Validating a model
  id: totrans-268
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 验证模型
- en: In order to evaluate the real accuracy of a model, we can build it using a part
    of the data, such as 80 percent of the passengers. Then, we can apply the model
    on the remaining 20 percent of data. The data that we use to build the model is
    called the **training set** and the other is called the **test set**.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 为了评估模型的实际准确率，我们可以使用数据的一部分来构建模型，例如80%的乘客。然后，我们可以将模型应用于剩余的20%数据。我们用来构建模型的数据称为**训练集**，而其他数据称为**测试集**。
- en: 'We can assign each row to the training set with a probability of 80 percent.
    In this way, the training set will include about 80 percent of the data. In order
    to define which rows should be included in the training set, we can define a logical
    vector, called `indexTrain`, which is `TRUE` for each row belonging to the training
    set. We can generate the vector using sample and the arguments are:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将每行以80%的概率分配到训练集中。这样，训练集将包括大约80%的数据。为了定义哪些行应该包含在训练集中，我们可以定义一个逻辑向量，称为`indexTrain`，对于属于训练集的每一行，它都是`TRUE`。我们可以使用`sample`函数生成这个向量，其参数为：
- en: '`x`: This represents the possible values; in this case, `TRUE` and `FALSE`'
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`x`：这代表可能的值；在这种情况下，`TRUE`和`FALSE`'
- en: '`size`: This represents the vector length; in this case, it is equal to the
    number of rows in `dtDummy`'
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`size`：这代表向量长度；在这种情况下，它等于`dtDummy`中的行数'
- en: '`replace`: If the value is `TRUE`, each value (`TRUE` or `FALSE`) can be sampled
    more than once'
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`replace`：如果值为`TRUE`，每个值（`TRUE`或`FALSE`）可以被采样多次'
- en: '`prob`: This is a vector with the probabilities of sampling the values of `x`;
    in this case, it is `c(0.8, 0.2)`'
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`prob`：这是一个包含采样`x`值概率的向量；在这种情况下，它是`c(0.8, 0.2)`'
- en: 'Consider the following code:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下代码：
- en: '[PRE81]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'Now, we can extract the rows in which `indexTrain` is equal to `TRUE`:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以提取`indexTrain`等于`TRUE`的行：
- en: '[PRE82]'
  id: totrans-278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'In the same way, we extract the rows of the test set. The `!` operator means
    `NOT` and it allows the rows for which `indexTrain` is equal to `FALSE` to be
    extracted:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 同样地，我们提取测试集的行。`!`运算符表示`NOT`，它允许提取`indexTrain`等于`FALSE`的行：
- en: '[PRE83]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'Now, we can build the model using the same parameters as before. Knowing that
    we have less data, we can just reduce the sampsize parameters that define the
    data to use for each tree:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以使用之前相同的参数来构建模型。知道我们数据较少，我们可以只减少定义每个树使用的数据的`sampsize`参数：
- en: '[PRE84]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'We built a model without taking account of `dtTest`, so we can use it to predict
    on `dtTest`. Like before, we predict that a passenger will survive if their survival
    rate is above 50 percent. After the prediction, we can estimate the error, using
    the same R commands as before:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 我们构建了一个模型，没有考虑到`dtTest`，因此我们可以用它来预测`dtTest`。和之前一样，我们预测如果乘客的生存率高于50%，他们将会幸存。预测之后，我们可以使用和之前相同的R命令来估计误差：
- en: '[PRE85]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: The estimated error, `percError`, depends on how we have split the data, so
    it's different every time we define a new random training/test split. However,
    we can repeat the steps many times and compute the average error. This approach
    is called cross validation and it's a very useful tool to estimate the accuracy.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 估计误差`percError`取决于我们如何分割数据，所以每次定义新的随机训练/测试分割时它都不同。然而，我们可以重复这些步骤多次并计算平均误差。这种方法称为交叉验证，它是一种非常有用的工具，用于估计准确性。
- en: This chapter showed a generic approach to build and validate a machine learning
    model. Using this approach, we can forecast an attribute and estimate the prediction
    accuracy.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 本章展示了一种通用的构建和验证机器学习模型的方法。使用这种方法，我们可以预测一个属性并估计预测的准确性。
- en: Summary
  id: totrans-287
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we learned how to process data using data table operations
    and built some simple R plots for exploratory data analysis. We learned how to
    use decision trees to find useful insights and build machine learning models (random
    forest) to perform predictions. We saw how to change the parameters of a model
    and how to validate it.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了如何使用数据表操作处理数据，并构建了一些简单的R图表进行探索性数据分析。我们学习了如何使用决策树找到有用的见解并构建机器学习模型（随机森林）进行预测。我们看到了如何更改模型的参数以及如何验证它。
- en: The next three chapters show the steps introduced in this chapter in detail.
    [Chapter 4](ch04.html "Chapter 4. Step 1 – Data Exploration and Feature Engineering"),
    *Step 1 - Data Exploration and Feature Engineering*, shows the first step of machine
    learning that consists of data exploration and feature engineering, in depth.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的三章将详细介绍本章介绍的方法。[第4章](ch04.html "第4章。步骤1 – 数据探索和特征工程")，*步骤1 - 数据探索和特征工程*，深入介绍了机器学习的第一步，即数据探索和特征工程。

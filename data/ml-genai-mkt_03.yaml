- en: '3'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '3'
- en: Unveiling the Dynamics of Marketing Success
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 揭示营销成功的动态
- en: '**Key performance indicators** (**KPIs**) are great at capturing the current
    status or results of marketing initiatives. However, they lack the ability to
    show what drives such results and how different factors may have affected the
    end results of marketing campaigns. We briefly looked at how you can further analyze
    relationships between various variables and KPIs with correlation analysis in
    the last chapter. In this chapter, we are going to delve deeper into how we can
    utilize **data science** (**DS**) and **machine learning** (**ML**) techniques
    and tools to unveil the dynamics of marketing success.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键绩效指标**（**KPIs**）擅长捕捉营销活动的当前状态或结果。然而，它们缺乏展示驱动这些结果的能力以及不同因素可能如何影响营销活动的最终结果。我们在上一章简要介绍了如何通过相关性分析进一步分析各种变量和KPI之间的关系。在本章中，我们将深入探讨如何利用**数据科学**（**DS**）和**机器学习**（**ML**）技术和工具来揭示营销成功的动态。'
- en: 'This chapter touches on three critical phases of the customer journey: engagement,
    conversion, and churn. These three types of customer behaviors are the key components
    and marketing goals to optimize for, and marketers often question what factors
    actually affect certain outcomes, such as why people engage more or less, why
    people end up converting more or less, and why people churn or don’t churn. The
    three most common approaches that are taken to unveil the factors that affect
    marketing outcomes, on top of the correlation analysis we have done in the last
    chapter, are (1) regression analysis, (2) decision tree interpretation, and (3)
    causal inference. In this chapter, we will discuss how we can perform those ML
    techniques in Python to have a better and more in-depth interpretation of the
    drivers behind marketing successes and failures.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涉及客户旅程的三个关键阶段：参与、转化和流失。这三种客户行为是优化营销目标的关键组成部分，营销人员经常质疑哪些因素实际上影响了某些结果，例如为什么人们的参与度更多或更少，为什么人们最终转化更多或更少，以及为什么人们流失或没有流失。除了我们在上一章中进行的相关性分析之外，揭示影响营销结果的因素的三个最常见方法包括（1）回归分析，（2）决策树解释和（3）因果推断。在本章中，我们将讨论如何在Python中执行这些ML技术，以更好地深入理解营销成功和失败背后的驱动因素。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Why people engage with regression analysis
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么人们会进行回归分析
- en: Why people convert with decision tree interpretation
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么人们会使用决策树解释进行转化
- en: Why people churn with causal inference
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为什么人们会使用因果推断进行流失分析
- en: Why people engage in regression analysis
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为什么人们会进行回归分析
- en: Usually, increasing the engagement rate is the very first step in marketing.
    Potential customers need to engage with the company or products first before they
    can convert into paying customers and then, eventually, repeat or loyal customers.
    There will be numerous factors that affect how potential customers engage with
    or click on your marketing campaigns. Customers with certain socio-economic backgrounds
    may be more attracted to your services and/or products than others. People from
    certain regions may engage more frequently in your marketing campaigns than others.
    Some who have been exposed to your previous sales may have a more favorable appetite
    for your services or products that results in higher engagement rates than others.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，提高参与度是营销的第一步。潜在客户需要首先与公司或产品互动，然后才能转化为付费客户，最终成为重复或忠诚的客户。会有许多因素影响潜在客户如何参与或点击您的营销活动。具有某些社会经济背景的客户可能比其他人更容易被您的服务或产品所吸引。来自某些地区的人可能比其他人更频繁地参与您的营销活动。一些之前接触过您销售的人可能对您的服务或产品有更积极的胃口，从而比其他人有更高的参与度。
- en: Understanding how potential customers interact with different components is
    the key to achieving higher engagement rates and the start of targeted or personalized
    marketing. **Regression analysis**, a well-known and widely used technique across
    various domains and often considered a fundamental concept in ML, is an intuitive
    and effective approach that we can use to understand the interactions among various
    components that may affect higher or lower engagement among your target customers.
    The two most commonly used types of regression analysis are **linear regression**
    and **logistic regression**.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 理解潜在客户如何与不同组件互动是实现更高参与率和个人化营销的关键。**回归分析**，一个在各个领域广为人知且广泛使用的技巧，通常被认为是机器学习中的基本概念，是一种直观且有效的方法，我们可以用它来理解可能影响目标客户参与度高低的各种组件之间的相互作用。最常用的两种回归分析类型是**线性回归**和**逻辑回归**。
- en: 'A linear regression assumes a linear relationship between a target variable
    and other factors. The linear relationship is defined as:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 线性回归假设目标变量与其他因素之间存在线性关系。线性关系定义为：
- en: '![](img/B30999_03_001.png)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_001.png)'
- en: where *Y* is the target variable, which is the outcome that you observe, each
    ![](img/B30999_03_002.png) is the factor that may affect the outcome, each ![](img/B30999_03_003.png)
    is the coefficient and degree of impact each factor has on the target variable,
    and *a* is the intercept. Linear regression is used when the target variable is
    a continuous variable, such as customer lifetime value, sales volume, and customer
    tenure.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *Y* 是目标变量，即观察到的结果，每个 ![](img/B30999_03_002.png) 是可能影响结果的因素，每个 ![](img/B30999_03_003.png)
    是每个因素对目标变量影响的系数和程度，*a* 是截距。当目标变量是连续变量时，如客户终身价值、销售额和客户任期，线性回归被使用。
- en: 'Logistic regression, on the other hand, is used when the target variable is
    binary, such as `Pass` vs. `Fail`, `True` vs. `False`, and 1 vs. 0\. When linear
    regression estimates the value of an outcome, logistic regression estimates the
    odds of success, and the relationship is defined as:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，当目标变量是二元变量时，如`通过` vs. `未通过`，`真` vs. `假`，和 1 vs. 0，使用逻辑回归。当线性回归估计结果值时，逻辑回归估计成功的概率，关系定义为：
- en: '![](img/B30999_03_004.png)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_004.png)'
- en: Where log denotes the natural logarithm and *P*(*y* = 1) is the probability
    of the outcome being 1
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 log 表示自然对数，*P*(*y* = 1) 是结果为 1 的概率
- en: As logistic regression estimates the probability of an outcome, it is a great
    tool to use when understanding the impacts of various factors on a binary outcome,
    such as whether a customer will respond to email marketing or whether a customer
    will click on an email message. In this section, we will use an auto insurance
    marketing dataset to discuss how logistic regression can be used to unveil the
    drivers behind customer engagement.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 由于逻辑回归估计结果的概率，它在理解各种因素对二元结果的影响时是一个非常有用的工具，例如客户是否会回应电子邮件营销或是否会点击电子邮件消息。在本节中，我们将使用一个汽车保险营销数据集来讨论如何使用逻辑回归揭示客户参与背后的驱动因素。
- en: '**Source code and data**:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**源代码和数据**：'
- en: '[https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Engage.ipynb](https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Engage.ipynb)'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Engage.ipynb](https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Engage.ipynb)'
- en: 'Data source: [https://www.kaggle.com/datasets/pankajjsh06/ibm-watson-marketing-customer-value-data](https://www.kaggle.com/datasets/pankajjsh06/ibm-watson-marketing-customer-value-data)'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 数据来源：[https://www.kaggle.com/datasets/pankajjsh06/ibm-watson-marketing-customer-value-data](https://www.kaggle.com/datasets/pankajjsh06/ibm-watson-marketing-customer-value-data)
- en: Target variable
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 目标变量
- en: 'The first thing we need to do is define the target or outcome we want to analyze.
    As we are interested in understanding how various factors affect customer engagement,
    we will have the `Response` variable as our target variable, which tells us whether
    a customer responded to a marketing call or not. The following code can be used
    for encoding the target variable with `0` for when a customer did not respond
    and `1` for when a customer did respond:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要做的第一件事是定义我们想要分析的目标或结果。由于我们感兴趣的是了解各种因素如何影响客户参与度，我们将把`响应`变量作为我们的目标变量，它告诉我们客户是否对营销电话做出了回应。以下代码可以用来用`0`编码目标变量，表示客户没有回应，用`1`表示客户做出了回应：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This code first loads the data into a variable, `df`, by using the `pandas`
    library’s `read_csv` function, and we create a new variable, `Engaged`, by encoding
    `Yes` as `1` and `No` as `0` from the `Response` column.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码首先使用 `pandas` 库的 `read_csv` 函数将数据加载到变量 `df` 中，并从 `Response` 列中创建一个新变量 `Engaged`，将
    `Yes` 编码为 `1`，将 `No` 编码为 `0`。
- en: Continuous variables
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连续变量
- en: 'There are largely two types of variants of factors that may affect the outcome
    or target variable:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 影响结果或目标变量的因素变体主要有两种类型：
- en: '**Continuous variables**: These are the variables that have real numbers as
    the values and can include fractions or decimals, such as monetary amounts, sales
    numbers, and pageview counts.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**连续变量**：这些是具有实数值的变量，可以包括分数或小数，例如货币金额、销售数量和页面浏览量。'
- en: '**Categorical variables**: These are discrete variables that have a distinct
    set of options or categories as values, such as education levels, genders, and
    customer account types.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分类变量**：这些是有明确选项或类别值的一组离散变量，例如教育水平、性别和客户账户类型。'
- en: 'We will first look at the relationships between some of the continuous variables
    in our auto insurance marketing dataset and the target variable, `Engaged`:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先查看我们汽车保险营销数据集中的一些连续变量与目标变量 `Engaged` 之间的关系：
- en: '[PRE1]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](img/B30999_03_01.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_01.png)'
- en: 'Figure 3.1: Distributions of continuous variables in the dataset'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.1：数据集中连续变量的分布
- en: 'As this screenshot shows, when we run the `df.describe()` function, it shows
    the overall statistics of the continuous variables. In our auto insurance example
    dataset, there are eight continuous variables: `Customer_Lifetime_Value`, `Income`,
    `Monthly_Premium_Auto`, `Months_Since_Last_Claim`, `Months_Since_Policy_Inception`,
    `Number_of_Open_Complaints`, `Number_of_Policies`, and `Total_Claim_Amount`.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 如此截图所示，当我们运行 `df.describe()` 函数时，它显示了连续变量的总体统计信息。在我们的汽车保险示例数据集中，有八个连续变量：`Customer_Lifetime_Value`、`Income`、`Monthly_Premium_Auto`、`Months_Since_Last_Claim`、`Months_Since_Policy_Inception`、`Number_of_Open_Complaints`、`Number_of_Policies`
    和 `Total_Claim_Amount`。
- en: 'In order for us to analyze the relationships between these variables and the
    outcome variable, `Engaged`, we are going to use `Logit` within the `statsmodels`
    package. The code to fit a logistic regression model is as follows:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 为了分析这些变量与结果变量 `Engaged` 之间的关系，我们将使用 `statsmodels` 包中的 `Logit`。拟合逻辑回归模型的代码如下：
- en: '[PRE2]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Here, we first import the required module, `statsmodels.api`, and define the
    continuous variable, `continuous_vars`. Then, we can use the `Logit` object in
    the `statsmodels` package to train a logistic regression model. We can view the
    trained logistic regression model with the following code:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们首先导入所需的模块 `statsmodels.api`，并定义连续变量 `continuous_vars`。然后，我们可以使用 `statsmodels`
    包中的 `Logit` 对象来训练一个逻辑回归模型。我们可以使用以下代码查看训练好的逻辑回归模型：
- en: '[PRE3]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The output of this code looks as in the following:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码的输出如下所示：
- en: '![](img/B30999_03_02.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_02.png)'
- en: 'Figure 3.2: Summary of logistic regression results'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.2：逻辑回归结果摘要
- en: Let’s analyze this logistic regression output. The two most important things
    to look at are, *coef* and *P*>|*z*|. The leftmost column, `coef`, in the bottom
    table is the coefficient for each variable. For example, the coefficient for the
    variable `Monthly_Premium_Auto` is `-0.0084` and the coefficient for the variable
    `Total_Claim_Amount` is `0.0001`. This means that customers paying higher monthly
    premiums are less likely to respond to marketing campaigns, which aligns with
    the heuristics that high-value customers often are the harder ones to get and
    encourage engagement. On the other hand, customers with higher claim amounts are
    more likely to engage, as they may be the ones utilizing insurance policies the
    most.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们分析这个逻辑回归输出。需要关注的两件最重要的事情是，*coef* 和 *P*>|*z*|。在底部表格的最左侧列，`coef`，代表每个变量的系数。例如，变量
    `Monthly_Premium_Auto` 的系数是 `-0.0084`，而变量 `Total_Claim_Amount` 的系数是 `0.0001`。这意味着支付更高月保费的客户不太可能对营销活动做出反应，这与高价值客户通常更难获取并鼓励参与的经验法则相符。另一方面，索赔金额较高的客户更有可能参与，因为他们可能是利用保险政策最多的人。
- en: The *P*>|*z*| column suggests the statistical significance each variable has
    on the outcome. The values lower than `0.05` are typically considered to have
    a statistically significant impact on the outcome, as p-values lower than `0.05`
    suggest there is strong evidence against the null hypothesis that there is no
    impact of this variable on the target variable. However, values larger than `0.05`
    do not necessarily suggest it does not have any significance on the outcome. You
    may also notice the coefficients for `Customer_Lifetime_Value` and `Income` are
    very small.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '*P*>|*z*|列表示每个变量对结果的影响的统计显著性。通常认为小于`0.05`的值对结果有显著的统计影响，因为小于`0.05`的p值表明有强有力的证据反对无影响的原假设，即这个变量对目标变量没有影响。然而，大于`0.05`的值并不一定意味着它对结果没有任何显著性。你也可能注意到`Customer_Lifetime_Value`和`Income`的系数非常小。'
- en: This does not suggest they have low impacts on the outcome. As you may have
    guessed, these two variables have monetary values and the scales for these two
    variables are in thousands, which results in small coefficient values, but with
    significant impact on the outcome.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 这并不表明它们对结果的影响低。正如你可能猜到的，这两个变量具有货币价值，这两个变量的尺度在千位，这导致了小的系数值，但它们对结果有显著的影响。
- en: Categorical variables
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分类变量
- en: We have seen how continuous variables interact with the outcome, `Engaged`,
    in a positive or negative way. You may wonder, then, what about categorical or
    discrete variables? We have a handful of categorical variables within our auto
    insurance example dataset; however, we will use the `Education` and `Gender` variables
    as examples to discuss how to handle categorical variables when performing regression
    analysis.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经看到连续变量如何以积极或消极的方式与结果`Engaged`相互作用。那么，关于分类或离散变量呢？在我们的汽车保险示例数据集中，我们有一些分类变量；然而，我们将使用`Education`和`Gender`变量作为例子来讨论在进行回归分析时如何处理分类变量。
- en: Factorize
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 因式分解
- en: 'The first approach we can take is to utilize the `factorize` functionality
    within the `pandas` library. Using `Education` as an example, you can run the
    following code to encode a textual discrete variable into a numerical variable:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以采取的第一种方法是利用`pandas`库中的`factorize`功能。以`Education`为例，你可以运行以下代码将文本离散变量编码为数值变量：
- en: '[PRE4]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The results of this factorization look like the following:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 这个因式分解的结果看起来如下：
- en: '[PRE5]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Categorical
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分类
- en: 'The second approach we can take to encode categorical variables is to use the
    `Categorical` function within the `pandas` library. The following code shows an
    example of how to use the `Categorical` function:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以采取的第二种方法是将分类变量编码为使用`pandas`库中的`Categorical`函数。以下代码展示了如何使用`Categorical`函数的示例：
- en: '[PRE9]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '[PRE11]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The `categories` argument in the `Categorical` function lets you define the
    order of the categories. Here, we defined the `Education` category to order from
    `High School or Below` to `Doctor`. You can access the categories by calling the
    `categories` attribute and you can get the encodings for each record by calling
    the `codes` attribute. For example, in our case, `High School or Below` is encoded
    with `0`, `Bachelor` with `1`, and `Doctor` with `4`.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '`Categorical`函数中的`categories`参数允许你定义类别的顺序。在这里，我们将`Education`类别定义为从`High School
    or Below`到`Doctor`的顺序。你可以通过调用`categories`属性来访问类别，通过调用`codes`属性来获取每个记录的编码。例如，在我们的案例中，`High
    School or Below`被编码为`0`，`Bachelor`为`1`，`Doctor`为`4`。'
- en: Dummy variables
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 虚拟变量
- en: One other approach that can be taken to encode categorical variables is to create
    dummy variables. Dummy variables are one-hot encoded variables for each category.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种可以采取的方法是将分类变量编码为创建虚拟变量。虚拟变量是每个类别的单热编码变量。
- en: 'For instance, in our example, the following dummy variables can be created
    for the `Education` variable:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在我们的例子中，可以为`Education`变量创建以下虚拟变量：
- en: '[PRE13]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](img/B30999_03_03.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_03.png)'
- en: 'Figure 3.3: Dummy variables created for the Education variable'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.3：为教育变量创建的虚拟变量
- en: 'As you can see from this example, the `pandas` library’s `get_dummies` function
    was used to create dummy variables for the `Education` variable. This creates
    five new variables: `Bachelor`, `College`, `Doctor`, `High School or Below`, and
    `Master`. Each of these newly created variables is encoded `0/1` (or `False/True`),
    where if a given record belongs to a given category, it is encoded as `1` or `True`.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从这个例子中看到的，使用了`pandas`库的`get_dummies`函数来为`Education`变量创建虚拟变量。这创建了五个新变量：`Bachelor`、`College`、`Doctor`、`High
    School or Below`和`Master`。这些新创建的每个变量都是`0/1`（或`False/True`）编码，如果给定记录属于给定类别，则编码为`1`或`True`。
- en: '**How to choose which method to use for categorical variable encoding**'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**如何选择用于分类变量编码的方法**'
- en: '**One-hot encoding**/**dummy variables**: Use these when there is no natural
    ordering in the variable. Both methods create binary variables for each category.
    Note that creating one-hot encoded and dummy variables for all categories can
    result in large dimensional data and make data sparse. Thus, you may want to subselect
    important categories for one-hot encoding/dummy variables.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '**独热编码**/**虚拟变量**：当变量没有自然顺序时，可以使用这些方法。两种方法都会为每个类别创建二进制变量。请注意，为所有类别创建独热编码和虚拟变量可能会导致数据维度很大，使数据稀疏。因此，您可能希望为独热编码/虚拟变量子选择重要的类别。'
- en: '**Factorize**: Use this as another quick and efficient method when you have
    nominal categorical variables that do not have any inherent order.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '**因子化**：当您有没有固有顺序的名义分类变量时，可以使用此方法作为另一种快速高效的方法。'
- en: '**Categorical**: When there is a natural ordering in the categorical variable,
    such as education levels, it is best to use `Categorical()` with a specified order.
    This ensures that the encoding respects the hierarchy of the categories, leading
    to accurate model predictions and evaluations such as AUC-ROC in analyses where
    order matters.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**分类**：当分类变量有自然顺序时，例如教育水平，最好使用指定顺序的`Categorical()`。这确保了编码尊重类别的层次结构，从而在顺序重要的分析中导致准确的模型预测和评估，如AUC-ROC。'
- en: Regression analysis
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 回归分析
- en: 'Now that we have explored different approaches that can be taken to encode
    categorical variables, we can run a regression analysis on how some of the categorical
    variables affect the outcome. Using the newly created categorical variables from
    the previous section, `GenderFactorized` and `EducationFactorized`, we can fit
    a logistic regression model with the following code to model the relationships
    and impacts of the `Gender` and `Education` levels on the level of marketing engagement:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经探讨了可以采取的不同方法来编码分类变量，我们可以运行回归分析来了解一些分类变量如何影响结果。使用上一节中创建的新分类变量`GenderFactorized`和`EducationFactorized`，我们可以使用以下代码拟合逻辑回归模型，以建模`Gender`和`Education`水平对营销参与度水平的影响和影响：
- en: '[PRE14]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Running `logit.summary()` will result in the following summary of the fitted
    logistic regression model:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 运行`logit.summary()`将导致以下拟合逻辑回归模型的总结：
- en: '![](img/B30999_03_04.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B30999_03_04.png)'
- en: 'Figure 3.4: Summary of logistic regression results'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.4：逻辑回归结果总结
- en: As you can see from this logistic regression model output, both variables, `GenderFactorized`
    and `EducationFactorized`, have negative coefficients or impact on the outcome,
    `Engaged`. As `Gender` is encoded as `0` for female and `1` for male, this suggests
    that males are less likely to respond than females.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从这个逻辑回归模型输出中看到的，两个变量`GenderFactorized`和`EducationFactorized`对结果`Engaged`都有负系数或影响。由于`Gender`编码为女性为`0`，男性为`1`，这表明男性比女性不太可能做出回应。
- en: Similarly, education levels are encoded from 0 to 4, and having a negative coefficient
    suggests that the higher the education level is, the less likely it is for a customer
    to respond.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，教育水平从0编码到4，拥有负系数表明教育水平越高，客户做出回应的可能性就越小。
- en: Along with the results we have seen from regression analysis with continuous
    variables in the previous section, these are great insights that show directional
    relationships among various factors against the engagement outcome.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 除了上一节中回归分析中看到的连续变量的结果外，这些都是很好的见解，显示了各种因素与参与度结果之间的方向关系。
- en: Interaction variables
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 交互变量
- en: 'Regression models are great at identifying and estimating linear relationships
    between the variables and the target variable. However, variables are likely to
    have some relationships among themselves. For example, income may have a high
    correlation with education levels. One approach that can be taken to address such
    intrinsic relationships within the variables in regression analysis is to introduce
    multiplicative terms, as shown in the following formula:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 回归模型擅长识别和估计变量与目标变量之间的线性关系。然而，变量之间可能存在一些关系。例如，收入可能与教育水平高度相关。在回归分析中解决变量内部这种内在关系的一种方法是在以下公式中引入乘法项：
- en: '![](img/B30999_03_005.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_005.png)'
- en: 'This way, the regression model considers the interactions between variables
    that have relationships within themselves. The same `Logit` within the `statsmodels`
    library can be used for running regression analysis with interaction terms in
    Python. The following code will fit a logistic regression model with interaction
    terms:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 这样，回归模型考虑了具有内在关系的变量之间的交互。Python中`statsmodels`库中的相同`Logit`可以用于运行包含交互项的回归分析。以下代码将拟合一个包含交互项的逻辑回归模型：
- en: '[PRE15]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'As shown in the code, we are fitting a logistic regression model with two variables,
    `Income` and `Education`, and one interaction term, `Income x Education`. The
    following is the summary of the fitted logistic regression model:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 如代码所示，我们正在拟合一个包含两个变量`Income`（收入）和`Education`（教育）以及一个交互项`Income x Education`的逻辑回归模型。以下是对拟合逻辑回归模型的总结：
- en: '![](img/B30999_03_05.png)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_05.png)'
- en: 'Figure 3.5: Summary of logistic regression results'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.5：逻辑回归结果总结
- en: Looking at the first two components, `Income`and `EducationFactorized`, this
    output suggests that `Income` and `Education` have positive impacts on engagement
    likelihood. However, the interaction term, `Income:EducationFactorized`, negates
    the individual positive effects of `Income` and `Education`, as it has a negative
    coefficient. In our case of marketing, this means that when you compare customers
    within the same income level, the higher the education level is, the lower their
    engagement rate will be. Similarly, this also suggests that for customers with
    the same education level, the higher their income is, the lower their engagement
    rate will be. As you can see from this example, by introducing the interaction
    terms, we can analyze the relationships among the variables more deeply and gain
    insights that may not be unveiled when analyzed individually.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 观察前两个成分，`Income`（收入）和`EducationFactorized`（教育因素化），这个输出表明`Income`（收入）和`Education`（教育）对参与可能性有积极影响。然而，交互项`Income:EducationFactorized`抵消了`Income`和`Education`的个体积极影响，因为它有一个负系数。在我们的市场营销案例中，这意味着当你比较同一收入水平的客户时，教育水平越高，他们的参与率就越低。同样，这也表明对于具有相同教育水平的客户，他们的收入越高，他们的参与率就越低。正如您从这个例子中可以看到的，通过引入交互项，我们可以更深入地分析变量之间的关系，并获得在单独分析时可能无法揭示的见解。
- en: As we have seen in this section, regression analysis is a powerful tool to unveil
    the dynamics of the drivers behind the successes and failures of marketing efforts.
    In our example, we have seen how various variables have negative and positive
    impacts on customer engagement rates. As shown, regression analysis is great at
    identifying linear relationships between various factors and the outcome and can
    be used to understand the interactions within the factors.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在本节中看到的，回归分析是揭示营销努力成功与失败背后驱动因素动态的强大工具。在我们的例子中，我们看到了各种变量如何对客户参与率产生积极和消极的影响。正如所示，回归分析擅长识别各种因素与结果之间的线性关系，并可用于理解因素之间的相互作用。
- en: However, it is generally considered that regression models lack the understanding
    of intervariable relationships. Part of this limitation is because we have to
    introduce interaction terms for all possible intervariable relationships. As we
    saw when we created `Income` and `Education` interaction terms previously, we
    will have to build similar interaction terms to address other possible interactions
    among the variables. Furthermore, if you want to introduce or consider interactions
    among more than two variables, it starts to get complicated.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，通常认为回归模型缺乏对变量之间关系的理解。这部分限制是因为我们必须为所有可能的变量间关系引入交互项。正如我们在之前创建`Income`和`Education`交互项时所看到的，我们将不得不构建类似的交互项来处理其他可能的变量间交互。此外，如果您想引入或考虑两个以上变量之间的交互，事情开始变得复杂。
- en: Decision trees, unlike linear regression analysis, have a strength in addressing
    complex interactions among variables. We will examine the use of decision trees
    in the following section, which captures the interactions among various factors
    and how these interactions ultimately affect the final outcome very well.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 与线性回归分析不同，决策树在处理变量之间的复杂交互方面具有优势。我们将在下一节中检查决策树的使用，该节捕捉了各种因素之间的交互以及这些交互最终如何影响最终结果。
- en: Why people convert with decision tree interpretation
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为什么人们会通过决策树解释进行转化
- en: Once potential customers start engaging with your marketing campaigns, it is
    time to start converting them into paying customers. Similar to how various backgrounds
    may affect the tendency to engage, there are numerous factors affecting who converts
    more often than others. Socio-economic factors, of course, will always play a
    vital role in affecting the conversion rates. Age, region, and gender may also
    be important factors in different conversion results. Months or seasons of the
    year can also cause conversion rates to vary, depending on the services or products
    you provide.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦潜在客户开始参与您的营销活动，就是开始将他们转化为付费客户的时候了。与各种背景可能影响参与倾向一样，有许多因素影响谁比其他人更频繁地转化。当然，社会经济因素在影响转化率方面始终扮演着至关重要的角色。年龄、地区和性别也可能是不同转化结果的重要因素。月份或季节也可能根据您提供的服务或产品导致转化率的变化。
- en: Not only single factors but also combinations of various factors may have significant
    influences on who may convert. A person who is employed and owns a house is more
    likely to convert for refinance loans than a person who owns a house but is retired.
    A 25-year-old student is less likely to look for a credit card than a 25-year-old
    entrepreneur. We have briefly discussed how regression analysis can help identify
    how factors interacting with each other affect customer behaviors by introducing
    interaction or multiplicative factors. Another great approach to uncovering the
    hidden insights around why certain people convert more than others is to use **decision
    trees** and their power to understand the interactions and relationships among
    various factors.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 不仅单个因素，而且各种因素的组合也可能对谁可能转化有重大影响。一个有工作和拥有房产的人比一个拥有房产但已退休的人更有可能为了再融资贷款而转化。一个25岁的学生比一个25岁的企业家更不可能寻找信用卡。我们简要讨论了如何通过引入交互或乘法因素，回归分析可以帮助识别相互作用的因素如何影响客户行为。另一种揭示为什么某些人比其他人更容易转化的隐藏洞察力的绝佳方法是使用**决策树**及其理解各种因素之间相互作用和关系的能力。
- en: 'Decision trees, as the name suggests, learn from data by growing trees. From
    a root node, a tree branches out by splitting the data into subcategories and
    eventually reaching the leaf nodes, from which you can understand what factors
    are affected in which ways to reach the corresponding leaf nodes. A sample of
    a decision tree may look like the following:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 决策树，正如其名所示，通过生长树来从数据中学习。从一个根节点开始，树通过将数据分割成子类别来分支，最终达到叶节点，从叶节点可以了解哪些因素以何种方式受到影响，以到达相应的叶节点。一个决策树的示例可能如下所示：
- en: '![](img/B30999_03_06.png)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_06.png)'
- en: 'Figure 3.6: Sample of a decision tree'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.6：决策树的示例
- en: We will have a detailed discussion on how to interpret the decision tree results
    with an example dataset, so we will save further explanation and discussion for
    later. Let’s talk first about how a decision tree branches out from each node.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将详细讨论如何使用示例数据集来解释决策树结果，因此我们将进一步解释和讨论留到以后。让我们首先谈谈决策树是如何从每个节点分支出来的。
- en: 'There are mainly two methods that are commonly used for splitting the data
    or branching out into child nodes:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 常用的两种方法用于分割数据或分支到子节点：
- en: '**Gini Impurity**: Gini impurity measures how impure a partition is. The formula
    for the Gini impurity measure is as follows:'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Gini不纯度**：Gini不纯度衡量一个划分的纯度。Gini不纯度度量的公式如下：'
- en: '![](img/B30999_03_006.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_006.png)'
- en: In this formula, *c* stands for the class labels, and ![](img/B30999_03_007.png)
    stands for the probability of a record with the class label *i* being chosen.
    When all records in each node of a tree are pure with all records being in a single
    target class, the Gini impurity measure reaches `0`.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个公式中，*c* 代表类别标签，![图片](img/B30999_03_007.png) 代表具有类别标签 *i* 的记录被选中的概率。当树中每个节点的所有记录都是纯的，即所有记录都属于单一目标类别时，Gini不纯度度量达到
    `0`。
- en: '**Entropy Information Gain**: Entropy measures how much information it gains
    from splitting the data with the criteria being tested. The formula for *Entropy*
    is as follows:'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**熵和信息增益**：熵衡量通过测试的准则分割数据所获得的信息量。熵的公式如下：'
- en: '![](img/B30999_03_008.png)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B30999_03_008.png)'
- en: As for the *Gini* measure, *c* stands for the class labels, and ![](img/B30999_03_009.png)
    stands for the probability of a record with the class label *i* being chosen.
    The split that gives the biggest change in the entropy measure will be chosen
    to branch out to child nodes, as it suggests that results in the highest information
    gain.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 至于*基尼系数*，*c*代表类别标签，而![](img/B30999_03_009.png)代表具有类别标签*i*的记录被选中的概率。将导致熵度量最大变化的分割将用于分支到子节点，因为它表明这将带来最高的信息增益。
- en: With this fundamental knowledge about decision trees, we will dive into applying
    one to understand what drives successful marketing campaigns for better conversion
    rates.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 关于决策树的基本知识，我们将深入探讨如何应用它来了解是什么因素推动了成功的营销活动，以实现更高的转化率。
- en: '**Source code and data**:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '**源代码和数据**：'
- en: '[https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Convert.ipynb](https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Convert.ipynb
    )'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Convert.ipynb](https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Convert.ipynb
    )'
- en: '**Data source:**'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据来源**：'
- en: '[https://archive.ics.uci.edu/dataset/222/bank+marketing](https://archive.ics.uci.edu/dataset/222/bank+marketing)'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://archive.ics.uci.edu/dataset/222/bank+marketing](https://archive.ics.uci.edu/dataset/222/bank+marketing)'
- en: Target variable
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 目标变量
- en: 'We will be using a bank marketing dataset for this exercise, where the marketing
    campaign was to convert customers to subscribe to term deposits. First things
    first, let’s load the data into a DataFrame and encode our target variable. Take
    a look at the following code:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一个银行营销数据集来完成这个练习，其中营销活动是将客户转化为订阅定期存款。首先，让我们将数据加载到DataFrame中，并编码我们的目标变量。请看以下代码：
- en: '[PRE16]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Here, we are loading the data into a variable, `df`, and encoding the `y` column
    into `1` for `yes` and `0` for `no`. When you run `df["conversion"].mean()`, you
    should see about 12% of the customers converted and subscribed to term deposits.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将数据加载到变量`df`中，并将`y`列编码为`1`表示“是”，`0`表示“否”。当你运行`df["conversion"].mean()`时，你应该看到大约12%的客户已经转化并订阅了定期存款。
- en: Continuous versus categorical variable
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连续变量与分类变量
- en: 'For our analysis, we will be using the following variables, which have continuous
    values: `age`, `balance`, `duration`, `campaign`, and `previous`. You can use
    the following code to see the distribution for these variables:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的分析，我们将使用以下变量，它们具有连续值：`age`、`balance`、`duration`、`campaign`和`previous`。你可以使用以下代码来查看这些变量的分布：
- en: '[PRE17]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The distribution looks as follows:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 分布如下所示：
- en: '![](img/B30999_03_07.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B30999_03_07.png)'
- en: 'Figure 3.7: Distribution of continuous variables'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.7：连续变量的分布
- en: 'Similar to the previous exercise, there are some categorical variables in this
    dataset as well. The first discrete text variable that we will convert into numerical
    values is `month`. If you look at the values of the variable `month`, you will
    notice that the values are 3-letter month abbreviations. As months have an inherent
    order, we will convert the values into corresponding numerical values using the
    following code:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 与之前的练习类似，这个数据集中也有一些分类变量。我们将首先将第一个离散文本变量`month`转换为数值。如果你查看`month`变量的值，你会注意到这些值是3个字母的月份缩写。由于月份有固有的顺序，我们将使用以下代码将这些值转换为相应的数值：
- en: '[PRE18]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Now, the variable `month` will have values from `1` to `12` for months respectively
    from `January` to `December`.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，变量`month`将具有从`1`到`12`的值，分别对应于从`January`到`December`的月份。
- en: 'The variable `job` is another categorical variable. Unlike the `month` variable,
    the `job` variable does not have an inherent order within itself. Thus, we will
    create dummy variables for each of the `job` categories, which will be one-hot
    encoded for the corresponding job categories. Take a look at the following code:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 变量`job`是另一个分类变量。与`month`变量不同，`job`变量在其内部没有固有的顺序。因此，我们将为每个`job`类别创建虚拟变量，这些变量将对应于相应的职业类别进行独热编码。请看以下代码：
- en: '[PRE19]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The output of this code will look like the following:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码的输出将如下所示：
- en: '[PRE20]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![](img/B30999_03_08.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B30999_03_08.png)'
- en: 'Figure 3.8: Encoded dummy variables'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.8：编码后的虚拟变量
- en: 'Similar to the previous exercise, we have used the `get_dummies` function to
    create dummy variables for each of the job categories in the dataset. You can
    use the following code to add these newly created dummy variables back to the
    DataFrame:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 与之前的练习类似，我们使用了 `get_dummies` 函数为数据集中的每个工作类别创建虚拟变量。您可以使用以下代码将这些新创建的虚拟变量添加回 DataFrame：
- en: '[PRE21]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: With this code run, the DataFrame, `df`, will now have newly created dummy variables
    of the `job` column added to it.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此代码运行后，DataFrame `df` 将会添加新创建的 `job` 列的虚拟变量。
- en: 'Lastly, we are going to encode `marital` and `housing` variables as well using
    the following code:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们还将使用以下代码将 `marital` 和 `housing` 变量进行编码：
- en: '[PRE22]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: As you can see from this code, we have created dummy variables for each of the
    marital categories, which are `divorced`, `married`, and `single`. Then, we concatenated
    these newly created dummy variables back to the DataFrame, `df`. We have also
    converted the textual values of the `housing` column into `1` for *yes* and `0`
    for *no*.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 如此代码所示，我们为婚姻类别中的每一个创建了虚拟变量，这些类别包括 `divorced`、`married` 和 `single`。然后，我们将这些新创建的虚拟变量连接回
    DataFrame `df`。我们还已将 `housing` 列的文本值转换为 `1` 表示 *yes*，`0` 表示 *no*。
- en: As categorical variable encoding is somewhat covered in depth in the previous
    exercise, we quickly went through this step for this exercise. Take your time
    going through this categorical variable encoding step and try different approaches
    that we discussed during the previous exercise as well!
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 由于分类变量编码在之前的练习中已经进行了深入探讨，所以我们在这个练习中快速地跳过了这一步。请花时间仔细研究这一步，并尝试在之前的练习中讨论的不同方法！
- en: Decision tree analysis
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 决策树分析
- en: 'We have compiled the variables of our interest, which are `age`, `balance`,
    `duration`, `campaign`, `previous`, `housing`, `month`, `job`, and `marital`status.
    We are going to start looking into how these factors have affected the conversion
    rate outcome of this marketing campaign. First, we are going to define our features
    and the target or response variable, as in the following code:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们收集了我们感兴趣的变量，包括 `age`、`balance`、`duration`、`campaign`、`previous`、`housing`、`month`、`job`
    和 `marital status`。我们将开始研究这些因素是如何影响这次营销活动的转换率结果的。首先，我们将定义我们的特征和目标或响应变量，如下面的代码所示：
- en: '[PRE23]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'As noted in this code, we are using the `conversion` column as our outcome
    or target variable and the continuous variables and encoded categorical variables
    that we have created previously. The resulting list of features should look as
    follows:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 如此代码所示，我们使用 `conversion` 列作为我们的结果或目标变量，以及我们之前创建的连续变量和编码后的分类变量。生成的特征列表应如下所示：
- en: '[PRE24]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![](img/B30999_03_09.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_09.png)'
- en: 'Figure 3.9: List of features'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.9：特征列表
- en: 'With the feature set and target variable defined, we are ready to build a decision
    tree. Take a look at the following code first:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在定义了特征集和目标变量后，我们就准备好构建决策树了。首先看看以下代码：
- en: '[PRE25]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: We are using the `tree` module within the `sklearn` or `scikit-learn` library
    and using the `DecisionTreeClassifier` class to train a decision tree model. You
    will notice one argument that we have defined, `max_depth`. This argument controls
    how much the tree grows. The deeper the tree grows, the more accurately the tree
    learns the data; however, it will likely overfit to the dataset and not be generalizable,
    meaning it will perform worse for the data that has not been observed. It is best
    to limit how much a tree grows and balance between how well and accurately a tree
    learns the data and how well this knowledge can be generalized. In this exercise,
    we will set `max_depth` to `3`. Finally, you can use the `fit` function to let
    the tree learn from the data.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在 `sklearn` 或 `scikit-learn` 库中使用 `tree` 模块，并使用 `DecisionTreeClassifier` 类来训练决策树模型。您会注意到我们定义了一个参数，`max_depth`。此参数控制树的生长程度。树生长得越深，树学习数据的准确性就越高；然而，它很可能会过拟合到数据集，并且不具有泛化性，这意味着它在未观察到的数据上的表现会更差。最好限制树的生长，并在树学习数据的准确性和知识泛化得有多好之间取得平衡。在这个练习中，我们将
    `max_depth` 设置为 `3`。最后，您可以使用 `fit` 函数让树从数据中学习。
- en: Try finding a golden spot for how deep a decision tree should grow by splitting
    the dataset into training and testing sets and choosing the depth that minimizes
    the difference between the training and testing sets.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试通过将数据集分为训练集和测试集，并选择最小化训练集和测试集之间差异的深度，来找到一个决策树应该生长多深的黄金点。
- en: 'The most intuitive method to use the knowledge that the decision tree gained
    from the data is to visualize how it branched out from each node and how the interactions
    between the variables lead to the leaf nodes. To do this, we will use the `graphviz`
    package, which you can install with the following command:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 使用决策树从数据中获取的知识最直观的方法是可视化它从每个节点分支出来以及变量之间的交互如何导致叶节点。为此，我们将使用 `graphviz` 包，您可以使用以下命令进行安装：
- en: '[PRE26]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'You can use the following code to draw the trained decision tree:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下代码来绘制训练好的决策树：
- en: '[PRE27]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'As you can see from the code, we are giving the function the trained model,
    `dt_model`, and the features, `features`, that were used for training the model.
    Then, you can output the graph into an image file with the `render` function of
    the graph. This code will generate an image file named `conversion-dt-depth-3.png`
    and it will look like the following:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如代码所示，我们正在向函数提供训练好的模型 `dt_model` 和用于训练模型的特征 `features`。然后，您可以使用图形的 `render`
    函数将图形输出到图像文件。此代码将生成一个名为 `conversion-dt-depth-3.png` 的图像文件，其外观如下：
- en: '![](img/B30999_03_10.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_10.png)'
- en: 'Figure 3.10: Decision tree diagram'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.10：决策树图
- en: As you can see from this decision tree graph, the depth of the tree is 3, which
    is what we defined it to be when we were training the decision tree. Let’s take
    a closer look at this graph.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从决策树图中所见，树的深度为 3，这是我们训练决策树时定义的。让我们更仔细地看看这个图。
- en: The root node is being split based on the variable `duration`. As the arrows
    suggest, if the duration is less than or equal to `521.5`, then it moves to the
    left child node; otherwise, it moves to the right child node. If we traverse to
    the rightmost leaf node by following the path with a duration greater than `827.5`
    and `marital_married` greater than `0.5`, the majority of the customers in this
    leaf node have converted. In other words, those customers who have had a contact
    duration that is longer than `827.5` seconds and who are married have converted
    more.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 根节点是根据变量 `duration` 进行分割的。正如箭头所示，如果持续时间小于或等于 `521.5`，则移动到左侧子节点；否则，移动到右侧子节点。如果我们沿着持续时间大于
    `827.5` 且 `marital_married` 大于 `0.5` 的路径遍历到最右侧的叶节点，那么这个叶节点中的大多数客户已经转化。换句话说，那些接触持续时间超过
    `827.5` 秒并且已婚的客户转化率更高。
- en: On the other hand, if we traverse to the leftmost leaf node, it suggests that
    those customers who have had a contact duration that is shorter than or equal
    to `521.5` seconds (root node), 0 previous contacts (left child node at depth
    1), and their age is less than or equal to `60.5` (leftmost child node at depth
    2) are more likely not to convert than the others.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果我们遍历到最左侧的叶节点，则表明那些接触持续时间小于或等于 `521.5` 秒（根节点）、0 次先前联系（深度 1 的左侧子节点）并且年龄小于或等于
    `60.5`（深度 2 的最左侧子节点）的客户不太可能转化，与其他客户相比。
- en: There are other parameters you can use to build decision trees. Try fine-tuning
    your trees and see how different parameters affect the formation of the decision
    trees and how you can deduce various other insights from the same dataset!
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用其他参数来构建决策树。尝试微调您的树，看看不同的参数如何影响决策树的形成，以及您如何从同一数据集中得出各种其他见解！
- en: As you can see from this example, by traversing through the tree and its branches
    and nodes, we can see the impacts of different factors of marketing on the customer
    behavior of conversion. Compared to the regression analysis that we did in the
    previous section, this decision tree has the advantage of better understanding
    more complex interactions and inter-relationships among different factors and
    how they affect the outcome variable. One thing to note is that both regression
    analysis and decision tree analysis results show correlations between the factors
    and the outcome rather than the causal relationships of what causes certain outcomes.
    Examining the causality of certain outcomes is not an easy task; however, in the
    following section, we will discuss how we can estimate the causal relationships
    between the features and the outcome from the data.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从本例中可以看到，通过遍历树及其分支和节点，我们可以看到不同营销因素对转化客户行为的影响。与我们在上一节中进行的回归分析相比，这个决策树有更好地理解不同因素之间更复杂相互作用和相互关系的优势，以及它们如何影响结果变量。需要注意的是，回归分析和决策树分析的结果都显示了因素与结果之间的相关性，而不是某些结果的原因关系。检验某些结果的原因并不是一件容易的任务；然而，在下一节中，我们将讨论如何从数据中估计特征与结果之间的因果关系。
- en: Why people churn with causal inference
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为什么人们会因因果推断而流失
- en: A high churn rate is especially a problem in marketing as it negates all the
    good marketing income that was generated from previous marketing campaigns. It
    is critical to have an in-depth understanding of why people churn and what factors
    need to be optimized to reduce the customer churn rate. As we have seen in previous
    sections, regression analysis and decision tree analysis are great at identifying
    linear relationships between the potential factors and the outcome and the inter-relationships
    between various factors and the outcome variable. However, as noted before, these
    identified relationships or correlations do not necessarily mean causations.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 高流失率在市场营销中尤其成问题，因为它抵消了之前营销活动产生的所有良好营销收入。深入了解人们为什么会流失以及需要优化哪些因素以降低客户流失率至关重要。正如我们在前面的章节中看到的，回归分析和决策树分析在识别潜在因素与结果之间的线性关系以及各种因素与结果变量之间的相互关系方面非常出色。然而，正如之前提到的，这些识别出的关系或相关性并不一定意味着因果关系。
- en: Identifying the causes of certain outcomes (for example, causes of customer
    churn) is often a difficult and complex task to achieve. This is where **causal
    analysis** comes in. If regression analysis was used to identify the relationships
    among the variables and decision tree analysis was used to identify the *interactions*
    among the variables, causal analysis is used to identify the *causes* and *effects*
    of certain outcomes.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 识别某些结果的原因（例如，客户流失的原因）通常是一项困难且复杂的任务。这就是因果分析发挥作用的地方。如果回归分析用于识别变量之间的关系，决策树分析用于识别变量之间的*相互作用*，那么因果分析用于识别某些结果的*原因*和*效果*。
- en: This is typically done through various experiments with control groups and treatment
    or experimental groups. The control group, as the name suggests, is the group
    to which no treatment is given. In a medical experiment setting, this control
    group is the one that will get a placebo. The treatment group, on the other hand,
    is the group that actually gets the treatment. Similarly, in a medical experiment
    setting, this treatment group is the one that gets the actual medical treatments,
    such as new medicine pills being developed.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 这通常是通过各种带有对照组和治疗组或实验组的实验来完成的。正如其名所示，对照组是未接受任何治疗的组。在医学实验环境中，这个对照组是将会接受安慰剂的组。另一方面，治疗组是实际接受治疗的组。同样，在医学实验环境中，这个治疗组是接受实际医疗治疗的组，例如正在开发的新药片。
- en: This paradigm of the necessity of setting up experiments prior to running a
    marketing campaign restricts the after-the-fact analysis. However, with the data,
    we can still run a causal analysis to estimate the effects of different factors
    on the outcome. We will be utilizing a Python package, `dowhy`, to run causal
    analysis based on the marketing campaign data. We will be using bank churn data
    as an example to discuss how a causal analysis can be done to unveil the causes
    and effects of certain variables on the marketing outcome.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在营销活动运行之前设置实验的必要性这一范式限制了事后的分析。然而，有了数据，我们仍然可以运行因果分析来估计不同因素对结果的影响。我们将使用Python包`dowhy`来基于营销活动数据运行因果分析。我们将使用银行客户流失数据作为例子来讨论如何进行因果分析，以揭示某些变量对营销结果的原因和影响。
- en: '**Source code and data**:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '**源代码和数据**：'
- en: '[https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Churn.ipynb](https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Churn.ipynb
    )'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Churn.ipynb](https://github.com/PacktPublishing/Machine-Learning-and-Generative-AI-for-Marketing/blob/main/ch.3/Why%20People%20Churn.ipynb)'
- en: '**Data source**:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据来源**：'
- en: '[https://www.kaggle.com/datasets/shrutimechlearn/churn-modelling](https://www.kaggle.com/datasets/shrutimechlearn/churn-modelling
    )'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://www.kaggle.com/datasets/shrutimechlearn/churn-modelling](https://www.kaggle.com/datasets/shrutimechlearn/churn-modelling)'
- en: 'Installation of the `dowhy` package:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 安装`dowhy`包：
- en: '[PRE28]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '(Note: you may require additional installations for the `dowhy` package. Please
    refer to the official documentation at [https://pypi.org/project/dowhy/](https://pypi.org/project/dowhy/).)'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: （注意：你可能需要安装`dowhy`包的额外组件。请参阅官方文档[https://pypi.org/project/dowhy/](https://pypi.org/project/dowhy/)。）
- en: Causal effect estimation
  id: totrans-173
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 因果效应估计
- en: 'The first step to estimating the causal effects of certain variables on the
    outcome is defining the problem with some assumptions. Let’s take the bank churn
    dataset as an example. First, when you load the data into a DataFrame, you will
    see variables as in the following:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 估计某些变量对结果产生因果效应的第一步是定义问题并做出一些假设。让我们以银行客户流失数据集为例。首先，当你将数据加载到DataFrame中时，你会看到以下变量：
- en: '[PRE29]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '![](img/B30999_03_11.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B30999_03_11.png)'
- en: 'Figure 3.11: Snapshot of the DataFrame'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.11：DataFrame快照
- en: Here, the `Exited` column is the target outcome we are interested in analyzing
    the causes for. As you may notice, there are several other columns that may be
    interesting to see causal effects on customer churn. Some may be interested in
    seeing whether a high or low credit score affects customer churn. Some others
    may be interested in seeing whether a long or short tenure affects customer churn.
    You may also be curious whether having multiple products affects customer churn.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`Exited`（退出）列是我们感兴趣分析其因果的指标。正如你可能注意到的，还有其他几个列可能对分析客户流失的因果效应很有趣。有些人可能想看看高或低的信用评分是否会影响客户流失。其他人可能想看看长期或短期的工作期限是否会影响客户流失。你也可能好奇拥有多个产品是否会影响客户流失。
- en: 'For our exercise in this chapter, we will define our problem or a causal effect
    of our interest as follows:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的练习中，我们将定义我们的问题或我们感兴趣的因果效应如下：
- en: “Does having multiple products affect customer churn?”
  id: totrans-180
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “拥有多个产品会影响客户流失吗？”
- en: 'With this problem definition, we can build some assumptions that eventually
    lead to customer churn:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个问题定义的基础上，我们可以建立一些假设，这些假设最终可能导致客户流失：
- en: Having multiple products may affect the churn rate, as it is likely that the
    people with multiple products will find it more difficult or cumbersome to switch
    to different banks.
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拥有多个产品可能会影响客户流失率，因为拥有多个产品的人可能觉得切换到不同银行更困难或更繁琐。
- en: '`CreditScore` may affect whether a customer can have multiple products or not,
    as the credit score is used to decide whether a person is qualified to have certain
    bank products or not, such as credit cards or term loans.'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`CreditScore`（信用评分）可能影响客户是否可以拥有多个产品，因为信用评分被用来决定一个人是否有资格拥有某些银行产品，例如信用卡或定期贷款。'
- en: '`Age` can also affect whether a customer has multiple products or not, as the
    older you are, the more likely you will have needed more bank products.'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Age`（年龄）也可能影响客户是否拥有多个产品，因为年龄越大，可能需要更多的银行产品。'
- en: Similarly, `Tenure`, `Balance`, and `Salary` can affect whether a customer may
    have multiple products or not. These factors may also affect customer churn.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同样，`Tenure`（客户服务期限）、`Balance`（账户余额）和`Salary`（薪水）都可能影响客户是否拥有多个产品。这些因素也可能影响客户流失。
- en: 'With these assumptions and the problem statement, let’s analyze the causal
    effect of a `MultipleProduct` variable on customer churn, which, using a do-calculus
    notation, can be written as:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 基于这些假设和问题陈述，让我们分析`MultipleProduct`变量对客户流失的因果效应，使用do-calculus记号，可以表示为：
- en: '![](img/B30999_03_010.png)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_010.png)'
- en: 'This, in turn, means the expected change in the likelihood of customer churn
    due to a change in the variable `MultipleProduct`. As with our assumptions, there
    can be a set of other variables that affect the outcome and we may be interested
    in estimating the causal effect of these covariates on the outcome. In our example,
    these covariates are `Tenure`, `Balance`, and `Salary`, and the estimated causal
    effect of these covariates on customer churn can be written as:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 这反过来意味着由于变量`MultipleProduct`的变化，客户流失可能性预期的变化。正如我们的假设一样，可能有一组其他变量会影响结果，我们可能对估计这些协变量对结果的影响感兴趣。在我们的例子中，这些协变量是`Tenure`、`Balance`和`Salary`，这些协变量对客户流失的估计因果效应可以表示为：
- en: '![](img/B30999_03_011.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_011.png)'
- en: Causal model
  id: totrans-190
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 因果模型
- en: With the pre-defined problem statement and our assumptions, let’s start building
    a causal model.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 基于预定义的问题陈述和我们的假设，让我们开始构建一个因果模型。
- en: 'First, we will need to build a variable that we will use as the treatment.
    Take a look at the following code:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要构建一个我们将用作处理的变量。看看下面的代码：
- en: '[PRE30]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: In our dataset, there is a column called `NumOfProducts`. We are simply encoding
    this into 0s and 1s, where customers with more than one product will be encoded
    as 1s and the rest as 0s.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的数据集中，有一个名为`NumOfProducts`的列。我们只是将其编码为0和1，其中拥有多个产品的客户将被编码为1，其余的为0。
- en: 'Now, we will use the `CausalModel` class within the `dowhy` package to define
    the causal model based on our assumptions, as in the following code:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将使用`dowhy`包中的`CausalModel`类来定义基于我们假设的因果模型，如下面的代码所示：
- en: '[PRE31]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: As you can see from this code, we defined the newly created variable, `MultipleProduct`,
    as the treatment for which we are interested in learning the causal effect on
    the outcome, `Exited`. We defined `Balance`, `EstimatedSalary`, and `Tenure` as
    common causes that may have causal effects on the customer churn and on whether
    a customer may have multiple products or not. Lastly, we defined `Age` and `CreditScore`
    as instruments as they may affect a customer’s ability to have multiple products.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从这段代码中看到的，我们定义了新创建的变量`MultipleProduct`作为我们感兴趣学习的因果效应的干预，即对结果变量`Exited`的因果效应。我们将`Balance`、`EstimatedSalary`和`Tenure`定义为可能对客户流失以及客户是否可能有多个产品有因果效应的共同原因。最后，我们将`Age`和`CreditScore`定义为工具变量，因为它们可能影响客户拥有多个产品的能力。
- en: 'You can visualize this causal model using the following code:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下代码可视化这个因果模型：
- en: '[PRE32]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'The resulting causal graph looks as follows:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 结果的因果图如下所示：
- en: '![](img/B30999_03_12.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_12.png)'
- en: 'Figure 3.12: Visualization of the causal graph'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.12：因果图的可视化
- en: Note that the actual output may differ each time this code is run.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，每次运行此代码时，实际输出可能不同。
- en: Here, the instrument variables, `CreditScore` and `Age`, affect the treatment
    variable, `MultipleProduct`, which affects the outcome variable, `Exited`, and
    the covariates or common causes, `Balance`, `EstimatedSalary`, and `Tenure`, affect
    the treatment variable as well as the outcome variable.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，工具变量`CreditScore`和`Age`影响处理变量`MultipleProduct`，而`MultipleProduct`影响结果变量`Exited`，以及协变量或共同原因`Balance`、`EstimatedSalary`和`Tenure`也影响处理变量以及结果变量。
- en: 'Then, we can have the model identify the causal effects, as with the following
    code:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以让模型识别因果效应，如下面的代码所示：
- en: '[PRE33]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'This code will show the following expressions for the causal effect under our
    assumptions:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码将在我们的假设下显示以下因果效应的表达式：
- en: '![](img/B30999_03_13.png)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_13.png)'
- en: 'Figure 3.13: Code expressions for causal effect'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.13：因果效应的代码表达式
- en: This should look familiar as this is the same as the causal effect formulas
    we discussed previously.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该看起来很熟悉，因为这与我们之前讨论的因果效应公式相同。
- en: Estimation
  id: totrans-211
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 估计
- en: 'With the causal model defined, we can now estimate the effects of the treatment
    variable, `MultipleProduct`. The `estimate_effect` function makes the estimation
    of these effects straightforward, as shown in the following code:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在定义了因果模型之后，我们现在可以估计处理变量`MultipleProduct`的影响。`estimate_effect`函数使得这些影响的估计变得简单，如下面的代码所示：
- en: '[PRE34]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'This should produce the following results:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该产生以下结果：
- en: '![](img/B30999_03_14.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_14.png)'
- en: 'Figure 3.14: Causal estimate results'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.14：因果估计结果
- en: Based on this result, we estimate the mean effect of the treatment variable,
    `MultipleProduct`, on the outcome, `Exited`, to be `-0.1390`. This means that
    having multiple products causes a decrease in the probability of customer churn
    of around 14%. This confirms our assumption that having multiple products will
    create stickiness toward the bank and reduce the chance of customer churn.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 根据这个结果，我们估计治疗变量`MultipleProduct`对结果`Exited`的平均效应为-0.1390。这意味着拥有多个产品会导致客户流失概率降低约14%。这证实了我们的假设，即拥有多个产品将增加对银行的粘性并降低客户流失的可能性。
- en: 'There are various methods you can use for estimation methods. To name a few:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用多种方法进行估计。以下是一些例子：
- en: Linear regression
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 线性回归
- en: Distance matching
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 距离匹配
- en: Propensity score stratification
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 倾向得分分层
- en: Propensity score matching
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 倾向得分匹配
- en: Propensity score weighting
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 倾向得分加权
- en: We used propensity score weighting for our example, but we recommend trying
    different estimation methods and analyzing how they affect the causal effect estimations.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在示例中使用了倾向得分加权，但我们建议尝试不同的估计方法，并分析它们如何影响因果效应估计。
- en: Refutation
  id: totrans-225
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 反驳
- en: Once we have estimated the causal effect of the treatment on the outcome, we
    need to validate it. This assumption validation step is called **refutation**.
    We are going to run robustness checks of our assumptions with a few approaches.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们估计了治疗对结果的影响，就需要对其进行验证。这个假设验证步骤被称为**反驳**。我们将通过几种方法对假设进行稳健性检查。
- en: 'The first approach is to introduce a random common cause or covariate variable.
    You can run this check as follows:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 第一种方法是引入一个随机共同原因或协变量变量。您可以按以下方式运行此检查：
- en: '[PRE35]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'The output looks like the following:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 输出看起来如下：
- en: '[PRE36]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: We are using the `refute_estimate` function within our causal model, `model`,
    with the argument ″`random_common_cause`". This refutation method introduces a
    new, randomly generated variable to test if the causal estimate significantly
    changes, helping assess the model’s robustness against omitted variable bias.
    As you can see from the output, the original estimated effect and the new effect
    after introducing a random common cause are the same with about -0.1390 as the
    estimated causal effect value. This confirms the fact that our assumption was
    correct.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在因果模型`model`中使用`refute_estimate`函数，参数为“`random_common_cause`”。这种反驳方法引入了一个新的、随机生成的变量来测试因果估计是否显著变化，有助于评估模型对遗漏变量偏差的稳健性。如您从输出中看到，引入随机共同原因后的原始估计效应和新效应相同，估计的因果效应值约为-0.1390。这证实了我们的假设是正确的。
- en: 'The second approach to refute our assumption is to randomly subsample the data
    and test on this random subset. You can run this check as follows:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 反驳我们假设的第二种方法是随机子采样数据并在该随机子集上进行测试。您可以按以下方式运行此检查：
- en: '[PRE37]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The output looks like the following:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 输出看起来如下：
- en: '[PRE38]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Similar to the previous case, we used the same `refute_estimate` function but
    with the ″`data_subset_refuter`" argument this time. The output suggests that
    the original estimated effect and the new estimated effect with a random subset
    of the data are very close. This confirms our assumption was correct about the
    causal relationship between the `MultipleProduct` variable and the `Exited` outcome
    variable and is a generalizable result across the dataset.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 与前一个案例类似，我们使用了相同的`refute_estimate`函数，但这次使用了“`data_subset_refuter`”参数。输出表明，原始估计效应和新估计效应（使用数据的一个随机子集）非常接近。这证实了我们对`MultipleProduct`变量和`Exited`结果变量之间因果关系的假设是正确的，并且是跨数据集的可推广结果。
- en: 'Similar to the multiple estimation method options, there are multiple ways
    you can run refutations. We have experimented with random common cause addition
    and random subset replacement in this chapter. However, there are various other
    ways you can validate your assumptions. To name a few:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 与多种估计方法选项类似，您有多种方式可以运行反驳。在本章中，我们尝试了随机共同原因添加和随机子集替换。然而，还有其他多种方式可以验证您的假设。以下是一些例子：
- en: '**Replace treatment with placebo**: Replace the treatment variable with one
    known not to have a causal effect on the outcome.'
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用安慰剂替换治疗**：将治疗变量替换为一个已知不会对结果产生因果效应的变量。'
- en: '**Replace with dummy outcome**: Instead of replacing the treatment variable,
    replace the outcome variable with one unrelated to the treatment.'
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用虚拟结果替换**：不是替换治疗变量，而是用与治疗无关的结果变量替换。'
- en: '**Refute with bootstrapped random sample**: Generate multiple bootstrapped
    samples from the data and estimate the causal effect on each sample.'
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用自举随机样本进行反驳**：从数据中生成多个自举样本，并估计每个样本上的因果效应。'
- en: 'We recommend trying different refutation methods as well! The examples in the
    official documentation may be a set of useful resources and can be found here:
    [https://www.pywhy.org/dowhy/v0.11.1/example_notebooks/nb_index.html](https://www.pywhy.org/dowhy/v0.11.1/example_notebooks/nb_index.html).'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还建议尝试不同的反驳方法！官方文档中的示例可能是一组有用的资源，您可以通过以下链接找到：[https://www.pywhy.org/dowhy/v0.11.1/example_notebooks/nb_index.html](https://www.pywhy.org/dowhy/v0.11.1/example_notebooks/nb_index.html)。
- en: Graphical causal model
  id: totrans-242
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 图形因果模型
- en: While the previous causal effect estimation was to analyze and identify the
    effects of treatment variables, the **graphical causal model** enables the root
    cause analysis and the analysis of causal effects and linkages of various factors.
    This will be a great tool to have when you want to understand the causal effects
    of underlying variables and how they eventually lead to certain outcomes.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然之前的因果效应估计是为了分析和识别处理变量的影响，但**图形因果模型**能够进行根本原因分析，以及分析各种因素的因果效应和联系。当你想要理解潜在变量的因果效应以及它们最终如何导致某些结果时，这将是一个非常有用的工具。
- en: With the same assumptions as previously, we will learn how to use the `dowhy`
    graphical causal model to better understand causal linkages among the variables.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 在与之前相同的假设下，我们将学习如何使用`dowhy`图形因果模型来更好地理解变量之间的因果联系。
- en: Causal influence
  id: totrans-245
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 因果影响
- en: 'One of the key differences using the graphical causal model is that we need
    to build a directed graph, where we define a start node to the next node. Let’s
    discuss this further with an example by running the following code:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 使用图形因果模型的一个关键区别是我们需要构建一个有向图，其中我们定义一个起始节点到下一个节点。让我们通过运行以下代码进一步讨论这个问题：
- en: '[PRE39]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'To install the `networkx` package:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装`networkx`包：
- en: '[PRE40]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'As you can see, we are using the `networkx` package’s `DiGraph` class to create
    a directed graph. You can visualize this directed graph with the following code:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，我们正在使用`networkx`包的`DiGraph`类来创建一个有向图。您可以使用以下代码可视化这个有向图：
- en: '[PRE41]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'The output will look like the following:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 输出将如下所示：
- en: '![](img/B30999_03_15.png)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_15.png)'
- en: 'Figure 3.15: Directed graph'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.15：有向图
- en: As you may notice, this is a similar graph to one we saw in the previous section,
    where there are directed edges that go from `Age` and `CreditScore` to `MultipleProduct`.
    Similarly, there are also directed edges that go from `Balance`, `EstimatedSalary`,
    and `Tenure` to `MultipleProduct` and `Exited`. Finally, there is a directed edge
    that goes from `MultipleProduct` to `Exited`. In summary, this is a visualization
    of our assumptions about how different variables may have causal effects on one
    another.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 如您可能注意到的，这是一个与我们之前章节中看到的类似的图，其中存在从`Age`和`CreditScore`到`MultipleProduct`的有向边。同样，也存在从`Balance`、`EstimatedSalary`和`Tenure`到`MultipleProduct`和`Exited`的有向边。最后，存在一个从`MultipleProduct`到`Exited`的有向边。总之，这是我们对不同变量可能相互产生因果效应的假设的视觉表示。
- en: 'With this directed graph, we can now fit a graphical causal model as in the
    following code:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这个有向图，我们现在可以拟合一个图形因果模型，如下面的代码所示：
- en: '[PRE42]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Here, we are using the `gcm` module in the `dowhy` package and defining the
    causal model with the `StructuralCausalModel` class within the `gcm` module. Then,
    we assign our dataset to each node in the graph with the `assign_causal_mechanisms`
    function and, finally, fit the graphical causal model with the `fit` function
    and the structural causal model and dataset as the input to the `fit` function.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们使用`dowhy`包中的`gcm`模块，并在`gcm`模块中使用`StructuralCausalModel`类定义因果模型。然后，我们使用`assign_causal_mechanisms`函数将我们的数据集分配给图中的每个节点，最后，使用`fit`函数和结构因果模型以及数据集作为`fit`函数的输入来拟合图形因果模型。
- en: 'Now that our graphical causal model has learned the causal effects of various
    variables on the outcome, we can quantify these learned relationships using the
    `arrow_strength` function, as in the following code:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经学习了各种变量对结果的影响的因果效应，我们可以使用`arrow_strength`函数对这些学习到的关系进行量化，如下面的代码所示：
- en: '[PRE43]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'You can visualize this by using the following code:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下代码进行可视化：
- en: '[PRE44]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'As you may notice from this code, we are normalizing the arrow strengths into
    percentages of the total in the first two lines of this code. The resulting graph
    should look like the following:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 从这段代码中，你可能注意到，在前两行代码中，我们将箭头强度归一化为总量的百分比。生成的图表应类似于以下：
- en: '![](img/B30999_03_16.png)'
  id: totrans-264
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_16.png)'
- en: 'Figure 3.16: Graph with arrow strengths'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.16：带有箭头强度的图表
- en: As this graph suggests, there is the strongest causal relationship between `MultipleProduct`
    and `Exited`, with about 45% contribution, and `Tenure` follows as the second
    most impactful variable for customer churn with about 25% contribution. This directed
    graph with estimated causal impacts on the outcome provides great insight for
    understanding the quantified causal effects of different variables on the outcome.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 如此图表所示，`MultipleProduct`与`Exited`之间存在最强的因果关联，贡献率约为45%，而`Tenure`作为第二个对客户流失影响最大的变量，贡献率约为25%。这个具有对结果估计因果影响的定向图，为理解不同变量对结果的量化因果效应提供了极大的洞察力。
- en: While the arrow strengths show us the impacts of direct linkages to the outcome,
    they do not show us indirect relationships between the instrument variables, `Age`
    and `CreditScore`, and the outcome variable, `Exited`. One approach we can take
    to compute and visualize the impacts of all the causal factors on the outcome
    variable is to quantify the intrinsic causal contributions that attribute the
    variance of the outcome variable to all the upstream nodes in the directed graph.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然箭头强度显示了直接链接到结果的影响，但它们并没有显示工具变量`Age`和`CreditScore`与结果变量`Exited`之间的间接关系。我们可以采取的一种计算和可视化所有因果因素对结果变量影响的方法是量化内在因果贡献，这些贡献将结果变量的方差归因于定向图中的所有上游节点。
- en: 'We can use the `intrinsic_causal_influence` function to quantify the intrinsic
    causal contributions, as in the following code:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`intrinsic_causal_influence`函数来量化内在因果贡献，如下面的代码所示：
- en: '[PRE45]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Here, we are using 100 random samples for evaluations, as you see from the
    `num_samples_randomization` parameter input. Before we visualize the quantified
    intrinsic causal influences, we will normalize the scale so that they sum up to
    100% first and then visualize them with a bar plot, using the following code:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们使用100个随机样本进行评估，如你从`num_samples_randomization`参数输入中看到的。在我们可视化量化的内在因果影响之前，我们将尺度归一化，使它们加起来达到100%，然后使用以下代码以条形图的形式可视化它们：
- en: '[PRE46]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'The output of this code should produce a bar plot like the following:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码的输出应生成一个类似于以下条形图的图表：
- en: '![](img/B30999_03_17.png)'
  id: totrans-273
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_17.png)'
- en: 'Figure 3.17: Bar plot of variance attribution for each factor'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.17：每个因素的方差分配条形图
- en: As expected, the variable `MultipleProduct` has the highest contribution to
    the variance of the outcome variable among all the variables. `Balance` comes
    next as the second most contributing variable. The variables `Age` and `CreditScore`
    seem to have very little attribution to the variance of the outcome, `Exited`.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期，变量`MultipleProduct`在所有变量中对结果变量的方差贡献最大。`Balance`作为第二个贡献最大的变量。变量`Age`和`CreditScore`似乎对结果变量`Exited`的方差贡献很小。
- en: '**What is a Shapley value?**'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: '**什么是Shapley值？**'
- en: 'You may notice that “Shapley values” appear while running causal inference
    code. Simply put, Shapley values are the estimations of the degrees of impact
    of individual variables on the target variable. If you would like to learn more,
    we suggest you take a look at the package documentation on how it computes the
    feature relevance here: [https://www.pywhy.org/dowhy/main/user_guide/causal_tasks/root_causing_and_explaining/feature_relevance.html](https://www.pywhy.org/dowhy/main/user_guide/causal_tasks/root_causing_and_explaining/feature_relevance.html).'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能注意到，在运行因果推理代码时会出现“Shapley值”。简单来说，Shapley值是单个变量对目标变量影响程度的估计。如果你想了解更多，我们建议你查看关于如何计算特征相关性的包文档：[https://www.pywhy.org/dowhy/main/user_guide/causal_tasks/root_causing_and_explaining/feature_relevance.html](https://www.pywhy.org/dowhy/main/user_guide/causal_tasks/root_causing_and_explaining/feature_relevance.html)。
- en: Anomaly attribution
  id: totrans-278
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 异常归因
- en: 'So far, we have seen ways to analyze the overall causal effects of individual
    variables on the outcome variable. However, there will be cases where we want
    to dig deeper into understanding which variables may have contributed in what
    way. For example, within our dataset, one may be curious about how a certain customer’s
    `Balance` amount may have caused them to churn or how that person’s `Tenure` with
    the bank may have impacted their churn. In order to figure out the causal contributions
    of different variables for individual customer churn, we can use the `attribute_anomalies`
    function, as in the following:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经看到了分析个体变量对结果变量整体因果效应的方法。然而，在有些情况下，我们可能想要深入了解哪些变量可能以何种方式做出了贡献。例如，在我们的数据集中，有人可能好奇某个客户的`Balance`金额是如何导致他们流失的，或者那个人的银行`Tenure`是如何影响他们的流失的。为了找出不同变量对个体客户流失的因果贡献，我们可以使用`attribute_anomalies`函数，如下所示：
- en: '[PRE47]'
  id: totrans-280
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'In our example, we chose the first customer who churned as an example, as you
    can see from the input for the `anomaly_samples` parameter. We can visualize the
    individual attributions on the outcome using the following code:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的例子中，我们选择了第一个流失的客户作为例子，如您从`anomaly_samples`参数的输入中看到的。我们可以使用以下代码在结果上可视化个体归因：
- en: '[PRE48]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: As this code suggests, we are normalizing the attributions so that they sum
    up to 100% and then visualizing individual attributions with a bar plot.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 如此代码所示，我们正在对归因进行归一化，以便它们加起来达到100%，然后使用条形图可视化个体归因。
- en: 'The resulting bar plot will look like the following:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 生成的条形图将看起来如下：
- en: '![](img/B30999_03_18.png)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_18.png)'
- en: 'Figure 3.18: Bar plot of anomaly attribution for each factor'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.18：每个因素的异常归因条形图
- en: 'Before we go deeper into the interpretations of this bar plot, let’s first
    look at the sample we chose for quantifying individual causal contributions. Take
    a look at the following code to take a closer look at an individual sample:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们深入解释这个条形图之前，让我们首先看看我们选择的用于量化个体因果贡献的样本。看看以下代码，以便更仔细地查看一个个体样本：
- en: '[PRE49]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'The output of this code will look as follows:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码的输出将如下所示：
- en: '![](img/B30999_03_19.png)Figure 3.19: Selected sample'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](img/B30999_03_19.png)图3.19：选择的样本'
- en: 'If we combine the attribution results with this customer’s info, we can dissect
    which factors were the most influential that ended up making this customer churn.
    We see from this customer’s record that this person only had one product with
    the bank and this was the most contributing factor to why this customer churned.
    On the other hand, `Balance`, `EstimatedSalary`, and `Tenure` actually reduced
    the chance of customer churn as they have negative scores. Let’s look at another
    sample, as follows:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们将归因结果与这位客户的个人信息结合起来，我们可以分析出哪些因素是最具影响力的，最终导致了这位客户的流失。从这位客户的记录中我们可以看到，这个人只与银行有一个产品，这是导致这位客户流失的最主要因素。另一方面，`Balance`（余额）、`EstimatedSalary`（估计薪资）和`Tenure`（任期）实际上降低了客户流失的可能性，因为它们有负分。让我们再看另一个样本，如下所示：
- en: '[PRE50]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'This has output like the following:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 这将产生如下输出：
- en: '![](img/B30999_03_20.png)'
  id: totrans-294
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_20.png)'
- en: 'Figure 3.20: Selected sample'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.20：选择的样本
- en: 'This customer’s causal contribution bar plot looks like the following:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 这位客户的因果贡献条形图看起来如下：
- en: '![](img/B30999_03_21.png)'
  id: totrans-297
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/B30999_03_21.png)'
- en: 'Figure 3.21: Bar plot of customer’s causal contribution'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.21：客户因果贡献条形图
- en: As you can see from this second example, this customer had a much higher balance,
    longer tenure, and more than one product with the bank, compared to the first
    example. For this customer, this higher balance, longer tenure, and higher estimated
    salary had a positive impact on why the customer churned, while the fact that
    this customer had more than one product reduced the chance of this customer churning.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从第二个例子中看到的，与第一个例子相比，这位客户的余额更高，任期更长，并且与银行有超过一个产品。对于这位客户来说，更高的余额、更长的任期和更高的估计薪资对客户流失有积极影响，而这位客户拥有多个产品的事实降低了客户流失的可能性。
- en: As we have seen from these examples, causal analysis and causal effect estimations
    bring deep insights into why people churn from your products. When used along
    with other methods and AI/ML models, this causal analysis will bring actionable
    insights that you can employ in your future marketing campaigns.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 从这些例子中我们可以看到，因果分析和因果效应估计可以深入了解人们为何会从您的产品中流失。当与其他方法和AI/ML模型结合使用时，这种因果分析将带来可操作的见解，您可以在未来的营销活动中加以应用。
- en: Summary
  id: totrans-301
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we gained an in-depth understanding of the factors affecting
    certain customer behaviors. We explored how **regression analysis** can help us
    understand the directional relationships between various factors and the outcome
    of customer behavior. Using our auto insurance marketing dataset as an example,
    we saw how to implement the `statsmodels` package in Python to run regression
    analysis and unveil the successes behind engagement rate marketing campaigns.
    We also discussed how **decision trees** can help us identify complex interactions
    that result in certain outcomes. Using a bank marketing dataset as an example
    and the `scikit-learn` package in Python, we successfully built a decision tree
    that unveiled the hidden interactions among various factors that lead to customer
    conversions. Lastly, with the bank churn dataset and the `dowhy` package in Python,
    we saw how **causal analysis** can bring deep insights into the root causes and
    directional contributions to the outcome of an event.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们深入了解了影响某些客户行为的因素。我们探讨了如何通过**回归分析**帮助我们理解各种因素与客户行为结果之间的方向性关系。以我们的车险营销数据集为例，我们看到了如何使用Python中的`statsmodels`包进行回归分析，揭示参与率营销活动背后的成功。我们还讨论了**决策树**如何帮助我们识别导致特定结果复杂交互。以银行营销数据集为例，并使用Python中的`scikit-learn`包，我们成功构建了一个揭示各种因素之间导致客户转换的潜在交互的决策树。最后，使用银行客户流失数据集和Python中的`dowhy`包，我们看到了**因果分析**如何对事件的根本原因和结果的方向性贡献带来深刻的洞察。
- en: In the next chapter, we are going to explore time-series data. In marketing,
    there are certain temporal patterns that repeat in certain ways. We will be discussing
    how to break down time-series data into overall trend, seasonality, and random
    noise components and how to utilize the trends and seasonalities that are identified
    through time-series decomposition for marketing initiatives, as well as how to
    do time-series forecasting, which can equip you with better planning and preparedness
    for certain events that may happen in the future.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨时间序列数据。在营销中，存在某些以特定方式重复出现的时序模式。我们将讨论如何将时间序列数据分解为总体趋势、季节性和随机噪声成分，以及如何利用通过时间序列分解识别出的趋势和季节性来开展营销活动，以及如何进行时间序列预测，这可以帮助你为未来可能发生的事件进行更好的规划和准备。
- en: Join our book’s Discord space
  id: totrans-304
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加入我们书籍的Discord空间
- en: 'Join our Discord community to meet like-minded people and learn alongside more
    than 5000 members at:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 加入我们的Discord社区，与志同道合的人交流，并与其他5000多名成员一起学习，请访问：
- en: '[https://packt.link/genai](https://packt.link/genai)'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://packt.link/genai](https://packt.link/genai)'
- en: '![](img/QR_Code12856128601808671.png)'
  id: totrans-307
  prefs: []
  type: TYPE_IMG
  zh: '![二维码](img/QR_Code12856128601808671.png)'

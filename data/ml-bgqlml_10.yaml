- en: '*Chapter 7*: Clustering Using the K-Means Algorithm'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第 7 章*：使用 K-Means 算法进行聚类'
- en: In this chapter, we'll introduce unsupervised machine learning, and you'll learn
    how to use BigQuery ML to build K-Means algorithms to cluster similar data into
    multiple categories.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍无监督机器学习，并学习如何使用 BigQuery ML 构建 K-Means 算法将相似数据聚类到多个类别中。
- en: Unsupervised machine learning is particularly useful when we have datasets without
    any labels, and we need to infer the structure of the data without any initial
    knowledge.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们拥有没有任何标签的数据集，并且需要在没有初始知识的情况下推断数据结构时，无监督机器学习特别有用。
- en: In different industries, it can be very valuable to identify similar events,
    objects, and people according to a specific set of features. K-Means clustering
    is typically used to identify similar customers, documents, products, events,
    or items according to a specific set of characteristics.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在不同的行业中，根据一组特定的特征识别相似的事件、对象和人物非常有价值。K-Means 聚类通常用于根据一组特定的特征识别相似的客户、文档、产品、事件或物品。
- en: In this chapter, we'll focus our attention on the K-Means clustering algorithm,
    which is widely used to reveal similarities in structured and unstructured data.
    We'll go through all the steps required to build a K-Means clustering model, leveraging
    BigQuery ML.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将重点关注广泛用于揭示结构化和非结构化数据相似性的 K-Means 聚类算法。我们将通过构建 K-Means 聚类模型所需的所有步骤，利用
    BigQuery ML 进行操作。
- en: 'With an incremental approach, we''ll go through the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 采用增量方法，我们将探讨以下主题：
- en: Introducing the business scenario
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: Discovering K-Means clustering
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现 K-Means 聚类
- en: Exploring and understanding the dataset
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索和理解数据集
- en: Training a K-Means clustering model
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 训练 K-Means 聚类模型
- en: Evaluating a K-Means clustering model
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估 K-Means 聚类模型
- en: Using a K-Means clustering model
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 K-Means 聚类模型
- en: Drawing business conclusions
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提炼业务结论
- en: Technical requirements
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'This chapter requires you to have access to a web browser and to be able to
    leverage the following:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章要求您能够访问网络浏览器，并能够利用以下内容：
- en: A **Google Cloud Platform** (**GCP**) account to access the **GCP** console
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个用于访问 GCP 控制台的 **Google Cloud Platform** (**GCP**) 账户
- en: A GCP project to host the BigQuery datasets
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个用于托管 BigQuery 数据集的 GCP 项目
- en: Now that we're ready with the technical requirements, let's dive into the analysis
    and development of our BigQuery ML clustering model.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经准备好了技术要求，让我们深入分析和发展我们的 BigQuery ML 聚类模型。
- en: 'Check out the following video to see the Code in Action: [https://bit.ly/2Rx2Uk5](https://bit.ly/2Rx2Uk5)'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 查看以下视频以查看代码的实际应用：[https://bit.ly/2Rx2Uk5](https://bit.ly/2Rx2Uk5)
- en: Introducing the business scenario
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍业务场景
- en: Imagine that you are a business analyst who works for large taxi companies in
    Chicago. These taxi companies make thousands of trips every day to satisfy the
    public transport needs of the entire city. The work and the behavior of the taxi
    drivers are fundamental in generating revenues for companies and delivering an
    effective service for all customers, every day.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 想象一下，你是一名为芝加哥大型出租车公司工作的商业分析师。这些出租车公司每天要完成数千次行程，以满足整个城市的公共交通需求。出租车司机的工作和行为对于为公司创造收入和为所有客户提供有效服务至关重要。
- en: 'For our business scenario, let''s imagine that all the taxi companies want
    to give an additional reward to drivers who perform the best. The goal of the
    companies is to segment the drivers into three distinct categories, according
    to generated revenue and driving speed. The three groups can be described as follows:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的业务场景，让我们想象所有出租车公司都想给表现最好的司机额外奖励。公司的目标是根据生成的收入和驾驶速度将司机分为三个不同的类别。这三个群体可以描述如下：
- en: The **Top Drivers** are the employees with the best revenue and efficiency throughout
    the year. This group will receive a huge additional reward.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**顶级司机**是全年收入和效率最佳的员工。这个群体将获得巨大的额外奖励。'
- en: The **Good Drivers** are drivers who performed well but aren't excelling. This
    group will not receive any reward.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**优秀司机**是表现良好但并不突出的司机。这个群体将不会获得任何奖励。'
- en: The **Neutral Drivers** are drivers with neutral or negative results in terms
    of revenue and efficiency.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**中性司机**是在收入和效率方面结果中性或负面的司机。'
- en: The parameters to identify the clusters are not known *a priori* because they
    can change according to different factors, such as profitability, speed, and traffic
    conditions. Some years are more profitable than others, and it can happen that
    the driving speed could be impacted by particular traffic conditions.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 识别聚类参数不是事先已知的，因为它们可以根据不同的因素（如盈利能力、速度和交通状况）而变化。有些年份比其他年份更有利可图，而且驾驶速度可能会受到特定交通状况的影响。
- en: As a business analyst, your job is to find the best algorithm to cluster the
    Chicago taxi drivers according to the described categories in order to classify
    the drivers into three clusters, according to their performance.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一名商业分析师，你的任务是找到最佳的算法，根据描述的分类将芝加哥出租车司机聚类，以便根据他们的表现将司机分为三个类别。
- en: Now that we've explained and understood the problem statement, let's take a
    look at the machine learning technique that we can use to predict a numerical
    value such as the duration of a trip.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经解释并理解了问题陈述，让我们看看我们可以用来预测数值（如行程持续时间）的机器学习技术。
- en: Discovering K-Means clustering
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发现K-Means聚类
- en: In this section, we'll understand what **unsupervised learning** is and we'll
    learn the basics of the **K-Means** clustering technique.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解什么是**无监督学习**，并学习**K-Means**聚类技术的基础知识。
- en: '**K-Means** is an **unsupervised learning** algorithm that solves clustering
    problems. This technique is used to classify data into a set of classes. The letter
    *k* represents the number of clusters that are fixed *a priori*. For our business
    scenario, we''ll use three different clusters.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**K-Means**是一种**无监督学习**算法，用于解决聚类问题。这种技术用于将数据分类到一组类别中。字母*k*代表事先固定的聚类数量。在我们的业务场景中，我们将使用三个不同的聚类。'
- en: Important note
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: While supervised learning is based on a prior knowledge of what the output values
    of labels should be in a training dataset, unsupervised learning does not leverage
    labeled datasets. Its goal is to infer the structure of data within a training
    dataset, without any prior knowledge of it.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然监督学习基于对训练数据集中标签输出值事先的知识，但无监督学习并不利用标记数据集。其目标是推断训练数据集中的数据结构，而不需要任何先验知识。
- en: Each cluster of data is characterized by a **centroid**. The centroid represents
    the midpoint of the cluster and is identified during the training stage and according
    to the features of the model.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 每个数据簇都由一个**质心**来表征。质心代表簇的中点，在训练阶段根据模型特征被识别。
- en: After the training of the K-Means clustering model, each entity can be associated
    with the nearest centroid and included in one of the *k* clusters.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在K-Means聚类模型训练之后，每个实体都可以与最近的质心关联，并包含在其中一个*k*个聚类中。
- en: 'In the following diagram, you can take a look at the graphical representation
    of a simple clustering model based on two features and a value of *k* equals to
    `3`:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的图中，你可以查看基于两个特征和一个*k*等于`3`的值的简单聚类模型的图形表示：
- en: '![Figure 7.1 – Graphical representation of K-Means clustering'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '![图7.1 – K-Means聚类的图形表示'
- en: '](img/B16722_07_002.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](img/B16722_07_002.jpg)'
- en: Figure 7.1 – Graphical representation of K-Means clustering
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.1 – K-Means聚类的图形表示
- en: In the preceding Cartesian diagram, you can see some observations represented
    by dots. The diagram is composed of two axes that correspond to the features used
    to train the K-Means clustering machine learning model.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的笛卡尔图中，你可以看到一些由点表示的观测值。该图由两个轴组成，这两个轴对应于用于训练K-Means聚类机器学习模型的特征。
- en: According to the values of the two features, some observations are closer than
    others. Assuming that we need to cluster the observations into three different
    clusters, the K-Means model is trained to find the three areas that divide the
    observations into different classes.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 根据两个特征值的差异，一些观测值比其他观测值更接近。假设我们需要将观测值聚类成三个不同的类别，K-Means模型被训练出来以找到将观测值划分为不同类别的三个区域。
- en: 'We''ll not go through all the details of the K-Means clustering algorithm in
    this book, but we can mention some examples of use cases where this kind of algorithm
    is applicable. In real life, we can find a lot of scenarios that can be addressed
    with a clustering model, such as the following:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会在本书中详细介绍K-Means聚类算法的所有细节，但我们可以提到一些此类算法适用的用例示例。在现实生活中，我们可以找到许多可以用聚类模型解决的问题，例如以下情况：
- en: '**Customer segmentation**: Finding similar customers in the customer base of
    a company to improve the effectiveness of marketing campaigns and promotions'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**客户细分**：在公司的客户基础上找到相似的客户，以提高营销活动和促销活动的有效性'
- en: '**Employee segmentation**: Identifying employees with the best performance'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**员工细分**：识别表现最佳的员工'
- en: '**Document classification**: Clustering documents into multiple categories
    according to tags, topics, authors, and publishing dates'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文档分类**：根据标签、主题、作者和发布日期将文档聚类到多个类别中'
- en: 'In our business scenario, we''ll train a K-Means clustering model based on
    three different clusters: **top**, **good**, and **neutral** drivers. To achieve
    our goal, we''ll use information regarding the revenues generated by each taxi
    driver and the driving speed, calculated as the ratio between miles driven and
    the time spent on each ride.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的业务场景中，我们将基于三个不同的聚类：**顶级**、**良好**和**中性**驾驶员，训练一个K-Means聚类模型。为了实现我们的目标，我们将使用有关每位出租车驾驶员产生的收入和驾驶速度的信息，驾驶速度是行驶英里数与每次行程花费时间的比率。
- en: We've learned the basics of K-Means clustering, so now it's time to take a look
    at the dataset that we'll use to build our machine learning model.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经学习了K-Means聚类的基础知识，现在是时候看看我们将用于构建机器学习模型的数据集了。
- en: Exploring and understanding the dataset
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索和理解数据集
- en: Before diving into the machine learning implementation, we'll start analyzing
    the dataset that will be used to train our machine learning model.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入到机器学习实现之前，我们将开始分析用于训练我们的机器学习模型的数据集。
- en: 'For this use case, we''ll use the BigQuery public dataset we''ve already used
    in [*Chapter 5*](B16722_05_Final_ASB_ePub.xhtml#_idTextAnchor075), *Predicting
    Boolean Values Using Binary Logistic Regression*. This dataset contains information
    on taxi rides collected by the *City of Chicago*, which can be found at the following
    link: [https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips](https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips).'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个用例，我们将使用我们在[*第5章*](B16722_05_Final_ASB_ePub.xhtml#_idTextAnchor075)中已经使用过的BigQuery公共数据集，*使用二元逻辑回归预测布尔值*。这个数据集包含了由*芝加哥市*收集的出租车行程信息，您可以通过以下链接找到：[https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips](https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips)。
- en: Let's start by getting a clear understanding of the information that we have
    in our dataset to build our K-Means clustering model.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们先清楚地了解我们数据集中所拥有的信息，以便构建我们的K-Means聚类模型。
- en: Understanding the data
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解数据
- en: In this section, we'll explore the structure of the data we'll use to develop
    our BigQuery ML model.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探索我们将用于开发我们的BigQuery ML模型的数据结构。
- en: 'To start exploring the data, we need to do the following:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始探索数据，我们需要做以下几步：
- en: Log in to GCP and access the **BigQuery** user interface from the navigation
    menu.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录GCP，并通过导航菜单访问**BigQuery**用户界面。
- en: Create a new dataset under the project that we created in [*Chapter 2*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039),
    *Setting Up Your GCP and BigQuery Environment*. For this use case, we'll create
    a `07_chicago_taxi_drivers` dataset with default options.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在[*第2章*](B16722_02_Final_ASB_ePub.xhtml#_idTextAnchor039)中创建的项目下创建一个新的数据集，*设置您的GCP和BigQuery环境*。对于这个用例，我们将创建一个带有默认选项的`07_chicago_taxi_drivers`数据集。
- en: 'Open the `bigquery-public-data` GCP project that hosts all the BigQuery public
    datasets and browse the items until we find the `chicago_taxi_trips` dataset.
    In this public dataset, we can see only one BigQuery table: `taxi_trips`. This
    table contains all the information about taxi rides happening in the city of Chicago,
    and we''ll use it to train and test our K-Means clustering model.'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`bigquery-public-data` GCP项目，该项目托管所有BigQuery公共数据集，浏览项目直到找到`chicago_taxi_trips`数据集。在这个公共数据集中，我们可以看到只有一个BigQuery表：`taxi_trips`。这个表包含了关于在芝加哥市发生的所有出租车行程的信息，我们将使用它来训练和测试我们的K-Means聚类模型。
- en: We've already used the same data in [*Chapter 5*](B16722_05_Final_ASB_ePub.xhtml#_idTextAnchor075),
    *Predicting Boolean Values Using Binary Logistic Regression*. For this reason,
    we already know the overall schema of the `taxi_trips` table and its fields.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在[*第5章*](B16722_05_Final_ASB_ePub.xhtml#_idTextAnchor075)中使用了相同的数据，*使用二元逻辑回归预测布尔值*。因此，我们已经了解了`taxi_trips`表及其字段的总体架构。
- en: 'In the following screenshot, you can see the full list of fields belonging
    to the `taxi_trips` table:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，您可以查看属于`taxi_trips`表的完整字段列表：
- en: '![Figure 7.2 – The list of fields belonging to the taxi_trips table'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '![图7.2 – 属于taxi_trips表的字段列表'
- en: '](img/B16722_07_003.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_07_003.jpg)'
- en: Figure 7.2 – The list of fields belonging to the taxi_trips table
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.2 – 属于taxi_trips表的字段列表
- en: 'For this use case, we focus our attention on the following fields that will
    be used in the creation of our machine learning model:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 对于此用例，我们关注以下字段，这些字段将用于创建我们的机器学习模型：
- en: '`trip_miles`: Contains the number of miles traveled by the taxi driver during
    a specific ride.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`trip_miles`：包含出租车司机在特定行程中行驶的英里数。'
- en: '`trip_seconds`: Represents the duration of each taxi ride, expressed in seconds.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`trip_seconds`：表示每次出租车行程的持续时间，以秒为单位。'
- en: '`fare`: This is the fee paid by the customer to the taxi driver and represents
    the income of the driver.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`fare`：这是乘客支付给出租车司机的费用，代表司机的收入。'
- en: '`tips`: This column contains the value of the tip that the taxi driver received
    from the customer.'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`提示`：此列包含出租车司机从乘客那里收到的小费金额。'
- en: We deliberately ignore other columns related to the cost of the taxi ride, such
    as `tolls` and `extras`, because these values are not directly impacted by the
    taxi driver's activity.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 我们故意忽略与出租车行程成本相关的其他列，例如`tolls`和`extras`，因为这些值不会直接受到出租车司机活动的影响。
- en: In this section, we've selected the table and columns that will be used to train
    our machine learning model. Now, it's time to look at the data so that we can
    understand how to use it.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们已选择了用于训练我们的机器学习模型的表和列。现在，是时候查看数据，以便我们了解如何使用它。
- en: Checking the data quality
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 检查数据质量
- en: In this section, we'll apply some data quality checks before developing our
    machine learning model.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们在开发我们的机器学习模型之前将应用一些数据质量检查。
- en: The quality of data is fundamental to building effective K-Means clustering
    models. Since the goal is to cluster observations into multiple categories, outliers
    in the data can create unbalanced clusters, based on incorrect values in the data.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 数据质量对于构建有效的K-Means聚类模型至关重要。由于目标是将观测值聚类到多个类别中，数据中的异常值可以基于数据中的错误值创建不平衡的聚类。
- en: 'Let''s start analyzing the dataset that will be used to build our machine learning
    model, as follows:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始分析用于构建我们的机器学习模型的数据集，如下所示：
- en: 'In order to identify the time frame of our dataset, let''s extract the minimum
    and maximum value of the `trip_start_timestamp` field, like this:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了确定我们数据集的时间范围，让我们提取`trip_start_timestamp`字段的最低值和最高值，如下所示：
- en: '[PRE0]'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: On executing this `2013` to `2020`.
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在执行此`2013`到`2020`。
- en: 'The result of the query is presented in the following screenshot:'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询结果如下所示：
- en: '![Figure 7.3 – The result of the query shows the time frame of the dataset'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图7.3 – 查询结果显示了数据集的时间范围'
- en: '](img/B16722_07_004.jpg)'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_07_004.jpg)'
- en: Figure 7.3 – The result of the query shows the time frame of the dataset
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图7.3 – 查询结果显示了数据集的时间范围
- en: To address our business scenario, we can focus our attention on the taxi rides
    that occurred in `2020`.
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了解决我们的业务场景，我们可以关注发生在`2020`年的出租车行程。
- en: 'In the second step, we''ll inspect the maximum values of the speed (expressed
    in miles per hour) and of a taxi driver''s income. Let''s execute the following
    query:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第二步中，我们将检查速度（以每小时英里为单位）和出租车司机收入的最高值。让我们执行以下查询：
- en: '[PRE1]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The internal `SELECT` statement calculates the average speed, dividing the value
    of the `trip_miles` field and the duration of the ride expressed in hours `(trip_seconds/60/60)`.
    The calculated value is stored in the `speed_mph` column. It also creates the
    `tot_income` field, which sums up the `fare` and `tips` values for each `taxi_id`
    field. With the `EXTRACT(YEAR from trip_start_timestamp) = 2020` filter, we're
    selecting only the taxi rides that occurred in `2020`. Adding filters on the `trip_seconds`,
    `trip_miles`, and `fare` fields, we're also excluding all the empty and `NULL`
    values that can occur in the dataset. The most external `SELECT` statement identifies
    the maximum values of the average speed and of the income, using the `MAX (speed_mph),
    MAX (tot_income)` keywords.
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 内部`SELECT`语句通过将`trip_miles`字段的值除以以小时表示的行程持续时间（`trip_seconds/60/60`）来计算平均速度。计算出的值存储在`speed_mph`列中。它还创建了`tot_income`字段，该字段将每个`taxi_id`字段的`fare`和`tips`值相加。使用`EXTRACT(YEAR
    from trip_start_timestamp) = 2020`过滤器，我们只选择发生在`2020`年的出租车行程。在`trip_seconds`、`trip_miles`和`fare`字段上添加过滤器，我们还排除了数据集中可能出现的所有空值和`NULL`值。最外层的`SELECT`语句使用`MAX
    (speed_mph), MAX (tot_income)`关键字确定平均速度和收入的最高值。
- en: 'The result of the query is presented in the following screenshot:'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询的结果在以下屏幕截图中进行展示：
- en: '![Figure 7.4 – The result of the query shows outliers in terms of speed and
    income'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '![图7.4 – 查询结果显示了速度和收入方面的异常值'
- en: '](img/B16722_07_005.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/B16722_07_005.jpg)'
- en: Figure 7.4 – The result of the query shows outliers in terms of speed and income
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.4 – 查询结果显示了速度和收入方面的异常值
- en: From the results, it's quite clear that the dataset contains some outliers that
    are not compatible with the actual use case. In fact, the maximum average speed
    is about 667 miles per hour, and the maximum income for a taxi driver is more
    than 1 million **US dollars** (**USD**).
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 从结果来看，很明显，数据集中包含一些与实际用例不兼容的异常值。事实上，最大平均速度约为667英里/小时，出租车司机的最高收入超过100万美元（**USD**）。
- en: The query that we've just executed points out that there are some unrealistic
    values in our dataset that need to be filtered out in the next steps.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚执行的查询指出，我们的数据集中存在一些不切实际的数据值，需要在接下来的步骤中过滤掉。
- en: Now that we've performed some quality checks on our dataset, let's focus on
    creating our training datasets.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经对我们的数据集进行了一些质量检查，让我们专注于创建我们的训练数据集。
- en: Creating the training datasets
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建训练数据集
- en: For K-Means clustering, we only need to create a dataset that will be used to
    train and test the machine learning model.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 对于K-Means聚类，我们只需要创建一个用于训练和测试机器学习模型的训练数据集。
- en: 'Let''s start creating our datasets that will be used to train two different
    K-Means clustering models, as follows:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始创建将用于训练两个不同的K-Means聚类模型的训练数据集，如下所示：
- en: 'First of all, let''s create a table that contains only the `speed_mph` field
    as an input feature for our K-Means clustering model, by running the following
    code:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，让我们通过运行以下代码创建一个只包含`speed_mph`字段作为K-Means聚类模型输入特征的表格：
- en: '[PRE2]'
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The query creates the `taxi_miles_per_minute` table in the `07_chicago_taxi_drivers`
    dataset.
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询在`07_chicago_taxi_drivers`数据集中创建了`taxi_miles_per_minute`表格。
- en: 'The table contains two different fields: the identifier of the taxi in the
    `taxi_id` column, and the average speed (expressed in miles per hour) in the `speed_mph`
    field. The average speed is calculated for each `taxi_id` field present in the
    `taxi_trips` table, using the `GROUP BY taxi_id` clause. The new table includes
    only the taxi rides that occurred in 2020.'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 表格包含两个不同的字段：`taxi_id`列中的出租车标识符，以及`speed_mph`字段中的平均速度（以英里/小时表示）。平均速度是使用`GROUP
    BY taxi_id`子句为`taxi_trips`表中的每个`taxi_id`字段计算的。新表格仅包括2020年发生的出租车行程。
- en: The last two lines of the query contain the `WHERE` clause that is used to filter
    out outliers. We're assuming that the maximum realistic average speed is `50`
    miles per hour.
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询的最后两行包含用于过滤异常值的`WHERE`子句。我们假设最大合理的平均速度是`50`英里/小时。
- en: 'In the second step, we''ll create another table to host the additional feature
    (namely, `tot_income`), as follows:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第二步中，我们将创建另一个表格来存储额外的特征（即`tot_income`），如下所示：
- en: '[PRE3]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The execution of the query generates a `taxi_speed_and_income` table. This table
    includes the `speed_mph` field calculated with the same rules of *Step 1*. The
    table also includes the `tot_income` field. This value is calculated as the `SUM`
    of the `fare` and the `tips` for each `taxi_id` field and for the entire duration
    of 2020.
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询的执行生成了`taxi_speed_and_income`表格。此表格包括使用与*步骤1*相同的规则计算的`speed_mph`字段。表格还包括`tot_income`字段。此值是每个`taxi_id`字段和2020年整个期间的`fare`和`tips`的`SUM`。
- en: Compared to the table created in *Step 1*, we've added another filter that limits
    the annual `tot_income` value to 150,000.
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 与*步骤1*中创建的表格相比，我们添加了一个额外的过滤器，将年度`tot_income`值限制在150,000。
- en: This second table will be used to create another K-Means clustering machine
    learning model based on the two `speed_mph` and `tot_income` features.
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此第二个表格将用于创建另一个基于两个`speed_mph`和`tot_income`特征的K-Means聚类机器学习模型。
- en: Now that we've created the tables on which our BigQuery ML model will be trained,
    let's dive into the creation of the machine learning model.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经创建了我们的BigQuery ML模型将要训练的表格，让我们深入到机器学习模型的创建中。
- en: Training the K-Means clustering model
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 训练K-Means聚类模型
- en: 'In this section, we''ll create two different K-Means machine learning models.
    The first model will be created using `taxi_miles_per_minute` as a training dataset,
    while the second will include also `tot_income` as a feature and will leverage
    `taxi_speed_and_income`. Let''s proceed as follows:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将创建两个不同的 K-Means 机器学习模型。第一个模型将使用 `taxi_miles_per_minute` 作为训练数据集，而第二个模型将包括
    `tot_income` 作为特征，并利用 `taxi_speed_and_income`。让我们按以下步骤进行：
- en: 'As a first step, let''s start training a machine learning model named `clustering_by_speed`
    by running the following code:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为第一步，让我们通过运行以下代码开始训练一个名为 `clustering_by_speed` 的机器学习模型：
- en: '[PRE4]'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The first lines of the SQL statement are composed of the `CREATE OR REPLACE
    MODEL` keywords, followed by the identifier of the `` `07_chicago_taxi_drivers.clustering_by_speed`
    `` machine learning model and the `OPTIONS` clause.
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: SQL 语句的前几行由 `CREATE OR REPLACE MODEL` 关键字组成，后跟 `07_chicago_taxi_drivers.clustering_by_speed`
    机器学习模型的标识符和 `OPTIONS` 子句。
- en: 'Now, let''s take a look at the options that we''ve used to train the machine
    learning model. The selected model type is `''kmeans''`. This option describes
    the technique that we''re using to train the model. The `num_clusters` option
    is valued at `3` because we''re trying to classify observations into three different
    clusters: *Top*, *Good*, and *Neutral*.'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在，让我们看看我们用来训练机器学习模型的选项。选定的模型类型是 `'kmeans'`。此选项描述了我们用于训练模型的技术。`num_clusters`
    选项的值为 `3`，因为我们试图将观测值分类到三个不同的簇中：*Top*、*Good* 和 *Neutral*。
- en: By default, BigQuery ML starts the training of the K-Means clustering algorithm
    with a random starting point. The quality of the machine learning model also depends
    on this point, which is randomly chosen by BigQuery. By using the `kmeans_init_method
    = 'KMEANS++'` option, the point is initialized leveraging the `taxi_miles_per_minute`
    table except for the `taxi_id` column, which will only be used during the prediction
    phase.
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 默认情况下，BigQuery ML 使用随机起点开始训练 K-Means 聚类算法。机器学习模型的质量也取决于这一点，这一点是由 BigQuery 随机选择的。通过使用
    `kmeans_init_method = 'KMEANS++'` 选项，该点利用 `taxi_miles_per_minute` 表初始化，除了 `taxi_id`
    列，该列仅在预测阶段使用。
- en: 'After the training of the first machine learning model, let''s train a second
    one, which also includes the `tot_income` value of the taxi driver during the
    year, as illustrated in the following code snippet:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在第一个机器学习模型训练完成后，让我们再训练第二个模型，该模型还包括出租车司机在该年的 `tot_income` 值，如下面的代码片段所示：
- en: '[PRE5]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: This query is very similar to the SQL statement executed for the creation of
    the previous K-Means clustering model, but we can immediately notice a relevant
    difference. The `clustering_by_speed_and_income` model is trained using an additional
    option, `standardize_features = true`. This option is particularly useful when
    you have numeric features with different orders of magnitude. In this case, the
    model is using the `speed_mph` field (which goes from 0 to 50) and the `tot_income`
    field, which can reach a value of 150,000.
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这个查询与用于创建先前 K-Means 聚类模型的 SQL 语句非常相似，但我们立即可以注意到一个相关的差异。`clustering_by_speed_and_income`
    模型是使用一个额外的选项 `standardize_features = true` 训练的。当您有不同数量级的数值特征时，此选项特别有用。在这种情况下，模型正在使用
    `speed_mph` 字段（从 0 到 50）和 `tot_income` 字段，其值可以达到 150,000。
- en: Now that we've trained two different machine learning models based on the K-Means
    clustering algorithm, let's take a look at how we can evaluate them leveraging
    BigQuery ML SQL syntax and the BigQuery **user interface** (**UI**).
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经基于 K-Means 聚类算法训练了两个不同的机器学习模型，让我们看看如何利用 BigQuery ML SQL 语法和 BigQuery **用户界面**（**UI**）来评估它们。
- en: Evaluating the K-Means clustering model
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估 K-Means 聚类模型
- en: In this section, we'll learn how to evaluate the performance of our K-Means
    clustering model.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将学习如何评估我们的 K-Means 聚类模型性能。
- en: 'The evaluation stage of a K-Means clustering model is different from the supervised
    machine learning models that we''ve performed in the previous chapters. Let''s
    take a look at the steps we need to take to evaluate our machine learning model,
    as follows:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: K-Means 聚类模型的评估阶段与我们之前章节中执行的监督机器学习模型不同。让我们看看评估我们的机器学习模型需要采取的步骤，如下所示：
- en: 'Let''s extract the centroids from the first machine learning model that we
    trained in the previous section, by running the following code:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们通过运行以下代码提取上一节中训练的第一个机器学习模型的质心：
- en: '[PRE6]'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The `ML.CENTROIDS` function returns information about the centroids of the K-Means
    model. It accepts the model name as input in the round brackets, preceded by the
    `MODEL` keyword.
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`ML.CENTROIDS`函数返回K-Means模型质心的信息。它接受模型名称作为输入，放在圆括号内，前面是`MODEL`关键字。'
- en: Important note
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要提示
- en: A centroid represents the center of a cluster in a K-Means clustering model.
    During the training phase of the machine learning model, the centroids are iteratively
    optimized to minimize the distance between centroids and observations in the training
    dataset. When the training stage ends, the centroids are stabilized. BigQuery
    ML stops iterating when the relative loss improvement is less than the value specified
    for the `MIN_REL_PROGRESS` parameter.
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 质心代表K-Means聚类模型中一个集群的中心。在机器学习模型的训练阶段，质心会迭代优化以最小化质心与训练数据集中观测值之间的距离。当训练阶段结束时，质心会稳定下来。BigQuery
    ML在相对损失改进小于`MIN_REL_PROGRESS`参数指定的值时停止迭代。
- en: 'The execution of the query returns three centroids, as shown in the following
    screenshot:'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查询的执行返回三个质心，如下截图所示：
- en: '![Figure 7.5 – The result of the query shows the centroids identified by the
    machine learning model'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图7.5 – 查询结果显示机器学习模型识别的质心'
- en: '](img/B16722_07_006.jpg)'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_07_006.jpg)'
- en: Figure 7.5 – The result of the query shows the centroids identified by the machine
    learning model
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图7.5 – 查询结果显示机器学习模型识别的质心
- en: In this case, each centroid is represented only by the numerical value of the
    `speed_mph` feature that represents the average speed of the taxi driver.
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这种情况下，每个质心仅用代表出租车驾驶员平均速度的`speed_mph`特征的数值来表示。
- en: 'The same information can be achieved leveraging the BigQuery UI. Selecting
    the `clustering_by_speed` model from the BigQuery navigation menu and accessing
    the `1` belongs to the first cluster and represents the taxi drivers with the
    best average speed: the *Top Drivers*. From the BigQuery UI, we can also notice
    that 869 taxi drivers belong to this cluster.'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可以通过BigQuery UI获取相同的信息。从BigQuery导航菜单中选择`clustering_by_speed`模型，访问`1`属于第一个集群，代表平均速度最佳的出租车驾驶员：*顶级驾驶员*。从BigQuery
    UI，我们还可以注意到869名出租车驾驶员属于这个集群。
- en: The second centroid includes most of the population, with a `speed_mph` value
    of 14.3222\. This centroid is the center of the *Good Drivers* cluster.
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 第二个质心包括大部分人口，`speed_mph`值为14.3222。这个质心是*良好驾驶员*集群的中心。
- en: The last centroid is the center of the cluster with the slowest drivers and
    includes 425 observations in the *Neutral Drivers* cluster.
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 最后一个质心是速度最慢的驾驶员所在集群的中心，包含425个观测值，属于*中性驾驶员*集群。
- en: If we choose to analyze the `clustering_by_speed_and_income` model from the
    **Evaluation** tab in the BigQuery UI, we'll see the following information:![Figure
    7.7 – The Evaluation tab of the clustering_by_speed_and_income BigQuery ML model
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们选择从BigQuery UI的**评估**标签页分析`clustering_by_speed_and_income`模型，我们将看到以下信息：![图7.7
    – 基于速度和收入的聚类BigQuery ML模型的评估标签页
- en: '](img/B16722_07_008.jpg)'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/B16722_07_008.jpg)'
- en: Figure 7.7 – The Evaluation tab of the clustering_by_speed_and_income BigQuery
    ML model
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.7 – 基于速度和收入的聚类BigQuery ML模型的评估标签页
- en: 'Looking at the clusters and centroids identified by this second model, we can
    immediately notice that the clusters are based on two different features: `speed_mph`
    and `tot_income`.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 观察由第二个模型识别的集群和质心，我们可以立即注意到集群基于两个不同的特征：`speed_mph`和`tot_income`。
- en: 'The first cluster, with `1`, includes the best 466 drivers in terms of speed
    and annual income: *Top Drivers*. The second one contains the 417 *Neutral Drivers*
    with the poorest performance. The last centroid includes the majority of the drivers
    and is the *Good Drivers* cluster.'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个集群，编号为`1`，包括速度和年收入最佳的466名驾驶员：*顶级驾驶员*。第二个集群包含表现最差的417名*中性驾驶员*。最后一个质心包括大多数驾驶员，是*良好驾驶员*集群。
- en: Tip
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: The result of training different iterations of K-Means clustering can generate
    different values, according to the initialization seeds that are used by BigQuery
    ML. It could happen that the positions of the centroids are different from the
    values shown in this section.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 训练不同迭代的K-Means聚类可以生成不同的值，这取决于BigQuery ML使用的初始化种子。可能发生的情况是质心的位置与本节中显示的值不同。
- en: Now that we've taken a look at the results created by the training of the K-Means
    clustering models, let's start using them to classify taxi drivers into different
    clusters.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经查看了K-Means聚类模型训练产生的结果，让我们开始使用它们将出租车司机分类到不同的聚类中。
- en: Using the K-Means clustering model
  id: totrans-140
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用K-Means聚类模型
- en: In this section, we'll understand how to use our K-Means clustering model on
    new data.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将了解如何在新数据上使用我们的K-Means聚类模型。
- en: To use our BigQuery ML model, we'll use the `ML.PREDICT` function on the same
    table that we've created to train the machine learning model.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用我们的BigQuery ML模型，我们将在创建用于训练机器学习模型的同一张表上使用`ML.PREDICT`函数。
- en: 'In this case, we''ll also include the `taxi_id` column, which identifies each
    taxi driver. The following query will classify each `taxi_id` field to the nearest
    cluster, according to the values of the `speed_mph` and `tot_income` fields:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们还将包括`taxi_id`列，该列标识每个出租车司机。以下查询将根据`speed_mph`和`tot_income`字段的值将每个`taxi_id`字段分类到最近的聚类：
- en: '[PRE7]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The query statement is composed of a `SELECT` keyword that extracts all the
    columns returned by the `ML.PREDICT` function, except for the `nearest_centroids_distance`
    field.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 查询语句由一个`SELECT`关键字组成，该关键字提取了`ML.PREDICT`函数返回的所有列，除了`nearest_centroids_distance`字段。
- en: 'The execution of the query generates the result shown in the following screenshot:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 查询的执行生成了以下屏幕截图所示的结果：
- en: '![Figure 7.8 – The result of the query shows the application of the K-Means
    clustering model'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '![图7.8 – 查询结果展示了K-Means聚类模型的应用'
- en: '](img/B16722_07_009.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '![img/B16722_07_009.jpg]'
- en: Figure 7.8 – The result of the query shows the application of the K-Means clustering
    model
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.8 – 查询结果展示了K-Means聚类模型的应用
- en: Each `taxi_id` field is assigned to a specific centroid and to the corresponding
    cluster. The assignment is visible from the first column, `CENTROID_ID`.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 每个`taxi_id`字段被分配到一个特定的质心及其对应的聚类。分配从第一列`CENTROID_ID`中可见。
- en: Now that we've applied our model, let's formulate some final considerations
    and provide a list of taxi drivers that can be rewarded because they're in the
    *Top Drivers* cluster.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经应用了我们的模型，让我们制定一些最终考虑事项，并提供一份可以奖励的出租车司机名单，因为他们属于*顶级司机*聚类。
- en: Drawing business conclusions
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提炼业务结论
- en: In this section, we'll formulate some final considerations using the results
    that we got from the application of our machine learning model.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将使用我们机器学习模型应用的结果制定一些最终考虑事项。
- en: 'Using the query executed in the *Using the K-Means clustering model* section,
    we can create a table that contains the *Top Drivers* identified by the `clustering_by_speed_and_income`
    K-Means machine learning model, as follows:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 使用*使用K-Means聚类模型*部分中执行的查询，我们可以创建一个包含由`clustering_by_speed_and_income` K-Means机器学习模型识别的*顶级司机*的表，如下所示：
- en: '[PRE8]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The execution of the query generates a `top_taxi_drivers_by_speed_and_income`
    table that contains all the drivers classified in the cluster with `CENTROID_ID=1`
    and corresponding to the *Top Drivers* cluster. Keep in mind that the K-Means
    clustering algorithm doesn't always return the same segmentations. For this reason,
    the clause `CENTROID_ID=1` can vary according to the results generated by each
    training stage.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 查询的执行生成一个包含所有被分类到`CENTROID_ID=1`聚类并对应于*顶级司机*聚类的司机的`top_taxi_drivers_by_speed_and_income`表。请注意，K-Means聚类算法并不总是返回相同的分割。因此，`CENTROID_ID=1`的子句可以根据每个训练阶段生成的结果而变化。
- en: This result set includes the identifiers of the taxi drivers that should be
    rewarded for their performances.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 此结果集包括应奖励其表现的出租车司机的标识符。
- en: Summary
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we've built our unsupervised machine learning model. After
    a brief introduction of the business scenario, we've discovered what unsupervised
    machine learning is and used the K-Means clustering algorithm to group similar
    observations within the same clusters.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们构建了我们的无监督机器学习模型。在简要介绍业务场景后，我们发现了无监督机器学习是什么，并使用K-Means聚类算法将相似观察结果分组到同一聚类中。
- en: Before diving into the development of the machine learning models, we applied
    some data quality checks to our dataset and selected the fields to use as features
    of our machine learning models.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入开发机器学习模型之前，我们对数据集进行了数据质量检查，并选择了用作机器学习模型特征的字段。
- en: During the training stage, we trained two different machine learning models
    to learn how to create a K-Means clustering model.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在训练阶段，我们训练了两个不同的机器学习模型，以学习如何创建K-Means聚类模型。
- en: Then, we evaluated the two models, leveraging BigQuery ML SQL syntax and the
    functionalities available in the BigQuery UI.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们评估了两个模型，利用 BigQuery ML SQL 语法和 BigQuery UI 中可用的功能。
- en: In the last step, we tested our machine learning model to cluster the taxi drivers
    available in the dataset according to their features and into the clusters generated
    by the K-Means model.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一步，我们测试了我们的机器学习模型，根据数据集中的特征将可用的出租车驾驶员聚类到由 K-Means 模型生成的聚类中。
- en: Finally, we've also created a list of drivers belonging to the *Top Drivers*
    cluster that can be rewarded because they can be considered top performers against
    the average of the other drivers.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们还创建了一个属于 *Top Drivers* 聚类的驾驶员列表，这些驾驶员可以受到奖励，因为他们可以被认为是与其他驾驶员平均水平的顶尖表现者。
- en: In the next chapter, we'll introduce forecasting, using time series data.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍使用时间序列数据进行预测。
- en: Further resources
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更多资源
- en: '**Chicago Taxi Trips public dataset**: [https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips](https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips)'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**芝加哥出租车行程公共数据集**: [https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips](https://console.cloud.google.com/marketplace/details/city-of-chicago-public-data/chicago-taxi-trips)'
- en: '**Chicago Open Data**: [https://data.cityofchicago.org/](https://data.cityofchicago.org/)'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**芝加哥开放数据**: [https://data.cityofchicago.org/](https://data.cityofchicago.org/)'
- en: '`CREATE MODEL` **statement**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`CREATE MODEL` **语句**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create)'
- en: '`ML.EVALUATE` **function**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML.EVALUATE` **函数**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-evaluate)'
- en: '`ML.PREDICT` **function**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ML.PREDICT` **函数**: [https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict)'
- en: '**BigQuery ML K-Means clustering example**: [https://cloud.google.com/bigquery-ml/docs/kmeans-tutorial](https://cloud.google.com/bigquery-ml/docs/kmeans-tutorial)'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**BigQuery ML K-Means 聚类示例**: [https://cloud.google.com/bigquery-ml/docs/kmeans-tutorial](https://cloud.google.com/bigquery-ml/docs/kmeans-tutorial)'

- en: Data Mining Models in Excel Hands-On Examples
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Excel中的数据挖掘模型实战示例
- en: Data mining is about finding hidden patterns and associations in data. A large
    number of analyses that can only be performed by a human in a reasonable time
    if the amount of data is small, can be done by a computer in a very short time.
    Before Excel 2016, it was possible to install an add-in (called **Data Mining**)
    that was packed with different methods and models that could be used, mostly as
    black boxes, to get insights and discover information in any dataset. Microsoft
    then changed its policy and started migrating this capability to the cloud, first
    to Office 365 and, most recently, to Azure. It is also possible to calculate many
    things in Excel, with built-in functions and even with the help of macros programmed
    in **Visual Basic Applications** (**VBA**). Here, we will show two cases where
    data mining can help us find important information hidden in our data.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 数据挖掘是关于在数据中寻找隐藏的模式和关联。如果数据量小，那么在合理的时间内只能由人类完成的大量分析，计算机可以在极短的时间内完成。在Excel 2016之前，可以安装一个名为**数据挖掘**的插件，它包含了许多可以用于获取洞察力和发现任何数据集中信息的方法和模型，通常作为黑盒使用。随后，微软改变了其政策，开始将这项功能迁移到云端，首先是Office
    365，最近则是Azure。在Excel中，还可以使用内置函数甚至通过在**Visual Basic应用程序**（**VBA**）中编写的宏来计算许多事情。在这里，我们将展示两个案例，说明数据挖掘如何帮助我们找到数据中隐藏的重要信息。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: 'Learning by example: Market Basket Analysis'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过示例学习：市场篮子分析
- en: Learning by example: Customer Cohort Analysis
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过示例学习：客户群体分析
- en: Market Basket Analysis studies which pairs of product/services are often bought
    together by customers. Customer Cohort Analysis analyses which customers are still
    buying products/services after a given amount of time and which ones *churn*.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 市场篮子分析研究哪些产品/服务的组合经常被客户一起购买。客户群体分析分析在给定时间后仍然购买产品/服务的客户，以及哪些客户*流失*。
- en: Technical requirements
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: To complete this section, the reader will need to download the `transactions_by_dept.csv`
    and `cohort_input_data.csv` files from the GitHub repository at [https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter06](https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter06).
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 为了完成本节，读者需要从GitHub仓库[https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter06](https://github.com/PacktPublishing/Hands-On-Machine-Learning-with-Microsoft-Excel-2019/tree/master/Chapter06)下载`transactions_by_dept.csv`和`cohort_input_data.csv`文件。
- en: Learning by example – Market Basket Analysis
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过示例学习 – 市场篮子分析
- en: 'We have all read the sentence in almost every online store: *People who bought
    this product also bought...*. It all started with Amazon in the 1990s, and it
    is widespread today. This same principle is even being tested in physical stores,
    where customers can get personalized suggestions on which items to buy based on
    their shopping history and similarity with other products. These techniques are
    generally known as cross-selling, and they are useful since it is often easier
    to sell an additional product to an existing customer than to acquire a new one.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我们几乎在每一个在线商店都读过这句话：“购买此产品的顾客还购买了...”。这一切始于20世纪90年代的亚马逊，如今已经非常普遍。同样的原则甚至正在实体店中进行测试，顾客可以根据他们的购物历史和与其他产品的相似性获得个性化的购买建议。这些技术通常被称为交叉销售，它们很有用，因为通常向现有客户销售附加产品比获取新客户更容易。
- en: In this section, we will show a simplified example of Market Basket Analysis,
    which is the type of data mining technique behind these recommender systems. The
    results might not be as accurate as those obtained with more advanced methods,
    but are still useful to explain the method and to teach how to escalate it.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将展示市场篮子分析的简化示例，这是这些推荐系统背后的数据挖掘技术类型。结果可能不如更先进的方法准确，但仍然有助于解释该方法并教授如何提升它。
- en: We will use a list of commercial transactions downloaded from [https://data.world/](https://data.world/).
    Start by loading the `transactions_by_dept.csv` file the usual way. Navigate to
    Data | From Text/CSV and select the file.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用从[https://data.world/](https://data.world/)下载的商业交易列表。首先，按照常规方式加载`transactions_by_dept.csv`文件。导航到数据
    | 从文本/CSV，并选择该文件。
- en: You will need to edit the table in Power Query to change the data type of the
    first column to Text, since it contains the transaction ID, and will probably
    be interpreted as a number and truncated by Excel.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要编辑Power Query中的表格，将第一列的数据类型更改为文本，因为它包含交易ID，Excel可能会将其解释为数字并截断。
- en: 'The resulting table looks like this:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 结果表看起来像这样：
- en: '![](img/d202be3a-3433-4c26-84b5-b9ea0a2e93fd.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/d202be3a-3433-4c26-84b5-b9ea0a2e93fd.png)'
- en: In this particular example, we will concentrate only on the first two columns.
    `POS Txn`contains the transaction ID, while `Dept` shows a description of the
    department where the transaction took place. Our goal is to find out how frequently
    the same customer shops in different departments in one single transaction.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个特定的例子中，我们将只关注前两列。`POS Txn`包含交易ID，而`Dept`显示交易发生的部门描述。我们的目标是找出同一个客户在一次交易中在不同部门购物的频率。
- en: In our findings we will see obvious, uninteresting combinations; unexpected
    ones that can be explained and exploited (for example, by offering products sold
    in one department when shopping in a related one), and combinations we cannot
    explain (which might occur by chance or simply need further investigation).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的发现中，我们将看到明显的、无趣的组合；可以解释和利用的意外组合（例如，在相关部门购物时提供该部门销售的产品），以及我们无法解释的组合（可能偶然发生或需要进一步调查）。
- en: 'To start our analysis, we need to do the following:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 为了开始我们的分析，我们需要做以下事情：
- en: Group all transactions by transaction number.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按交易编号分组所有交易。
- en: Build a list of all the departments visited in each particular purchase.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建一个包含每次特定购买中访问的所有部门的列表。
- en: 'To perform these tasks, we will use the Power Query capabilities, following
    these steps:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行这些任务，我们将使用Power Query功能，按照以下步骤进行：
- en: Navigate to Data | From Table/Range.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到数据 | 从表/范围。
- en: Make sure that the data type of the `POS Txn` column is set to Text before continuing.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在继续之前，请确保`POS Txn`列的数据类型设置为文本。
- en: 'Click on Group by*.* You will see the following pop-up window:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“分组”*.* 您将看到以下弹出窗口：
- en: '![](img/35d06f1d-2e2a-4c55-9135-176351c9a222.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/35d06f1d-2e2a-4c55-9135-176351c9a222.png)'
- en: Select the grouping by `POS Txn`,change the name of the new column to something
    meaningful, like `Concat_dept` (since we are trying to concatenate all departments
    visited in one purchase in a single string), and select any Operation*.* Click the OKbutton
    at the lower-right corner of the window, similar to the one shown in the preceding
    screenshot.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择按`POS Txn`分组，将新列的名称改为有意义的名称，例如`Concat_dept`（因为我们正在尝试将一次购买中访问的所有部门连接成一个字符串），并选择任何操作*.*
    点击窗口右下角的“确定”按钮，类似于前面截图所示。
- en: 'Change the calculation formula manually to get the data transformation we want. Navigate
    to View and make sure that Formula Bar is selected. If not, select it, and you
    will see the following formula:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 手动更改计算公式以获取我们想要的数据转换。导航到视图并确保公式栏被选中。如果没有，请选中它，您将看到以下公式：
- en: '*= Table.Group(#"Changed Type", {"POS Txn"}, {{"Concat_dept", each Table.RowCount(_),
    type number}})*'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '*= Table.Group(#"Changed Type", {"POS Txn"}, {{"Concat_dept", each Table.RowCount(_),
    type number}})*'
- en: 'The preceding formula is shown in the following screenshot:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了前面的公式：
- en: '![](img/685d3625-7faf-4ca3-a863-52e5ec1d052b.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/685d3625-7faf-4ca3-a863-52e5ec1d052b.png)'
- en: 'The formula must be replaced by the following:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 必须将公式替换为以下内容：
- en: '*= Table.Group(#"Changed Type", {"POS Txn"}, {{"Concat_dept", each Text.Combine([Dept],"
    | "), type text}})*'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '*= Table.Group(#"Changed Type", {"POS Txn"}, {{"Concat_dept", each Text.Combine([Dept],"
    | "), type text}})*'
- en: 'The difference is that, instead of counting rows in the table (*Table.RowCount*),
    we concatenate them, using *"|"* as a delimiter (*Text.Combine*). We are also
    changing the output type to *text. *The output should look similar to this:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 不同之处在于，我们不是在表中计数行（*Table.RowCount*），而是使用*"|"*作为分隔符进行连接（*Text.Combine*）。我们还更改了输出类型为*text*。输出应类似于以下内容：
- en: '![](img/86e13d24-162e-4a68-9295-071d69eb5056.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/86e13d24-162e-4a68-9295-071d69eb5056.png)'
- en: 'For each transaction ID, we now have a string representing the list of the
    departments involved. We are going to use this table to count the combinations
    of departments, but first, we convert it to a range:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个交易ID，我们现在有一个表示涉及部门的字符串列表。我们将使用这个表来计算部门的组合，但首先，我们将它转换为范围：
- en: Right-click on any cell within the table and go to Table | Convert to Range.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在表格中的任何单元格上右键单击，然后转到 表格 | 转换为范围。
- en: Rename the sheet to `Concat depts`(use the same name so that the references
    in future functions are correct).
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将工作表重命名为`Concat depts`（使用相同的名称，以确保未来函数中的引用正确）。
- en: 'In a real-life example, we might have to limit the time period we are analyzing
    to reduce the amount of calculations needed and clean the data, leaving out unusual
    transactions (outliers). In our case, we will limit the number of combinations
    studied. We could take the departments in pairs, triads, or even larger numbers.
    The problem is that the number of combinations quickly scales with the number
    of departments. In fact, this number can be calculated as follows:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在实际生活中，我们可能需要限制我们分析的时间段以减少所需的计算量并清理数据，排除异常交易（异常值）。在我们的案例中，我们将限制研究的组合数量。我们可以按对、三元组或更大的数字来选择部门。问题是组合的数量会随着部门数量的增加而迅速增加。实际上，这个数字可以按以下方式计算：
- en: '![](img/a55b261b-4b99-4605-8b01-025b39de83f7.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/a55b261b-4b99-4605-8b01-025b39de83f7.png)'
- en: Here, *m* is the total number of elements and *n* is the number of elements
    in each combination. This calculation takes into account that the elements cannot
    be repeated (it doesn't make sense to compare a department with itself), and the
    order is irrelevant.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`*m*`是元素的总数，`*n*`是每个组合中的元素数量。这个计算考虑到了元素不能重复（与自己比较没有意义），并且顺序无关紧要。
- en: 'We will select the top 10 departments according to the number of transactions
    and calculate the combinations using Excel functions. In order to do this, perform
    the following steps:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将根据交易数量选出前10个部门，并使用Excel函数计算组合。为了做到这一点，请执行以下步骤：
- en: 'Create a PivotTable as shown in the following screenshot:'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个如图所示的PivotTable：
- en: '![](img/c64a6138-e705-434d-94f3-0b20dba90d67.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/c64a6138-e705-434d-94f3-0b20dba90d67.png)'
- en: 'Order the rows by the count of transactions to get the top 10:'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按交易数量排序行以获取前10名：
- en: '[PRE0]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: How can we easily build all possible combinations of two departments? It is
    simple if we define the cell contents correctly and use the copy feature built
    in to Excel.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 我们如何轻松构建两个部门的所有可能组合？如果我们正确定义单元格内容并使用Excel内置的复制功能，这很简单。
- en: 'Let''s assume that the 10 departments are listed in cells *A1:A10*. Then follow
    these steps:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 假设有10个部门列在单元格*A1:A10*中。然后按照以下步骤操作：
- en: Create two new columns that you can label `X` and `Y`.
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建两个新的列，你可以将其标记为`X`和`Y`。
- en: Define the first cell in column `X` as *=$A$1* and the first cell in column
    `Y` as *=A2.*
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将列`X`的第一个单元格定义为`*=$A$1*`，将列`Y`的第一个单元格定义为`*=A2.*`
- en: Select both cells and copy them down until column `Y` shows an empty value.
    Remember that the *$* symbol fixes the cell value when copying.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择这两个单元格并将它们复制到`Y`列显示空值之前。记住，`*$*`符号在复制时固定单元格值。
- en: 'You will get a list as shown in the following screenshot, containing all possible
    `X-Y` pairs of departments:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将得到一个如图所示的列表，包含所有可能的部门`X-Y`对：
- en: '![](img/17b2795a-2542-4ff3-b956-053b80d2dfd5.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/17b2795a-2542-4ff3-b956-053b80d2dfd5.png)'
- en: In the cells following the last in this list, define `X` as *= $A$2* and `Y`
    as *= A3*.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此列表中的最后一个单元格之后，将`X`定义为`*= $A$2*`，将`Y`定义为`*= A3*`。
- en: Repeat the copy operation. If you continue until defining `X` as *= $A$9* and
    `Y` as *= A10*, you will get the full list of combinations.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复复制操作。如果你继续复制，直到将`X`定义为`*= $A$9*`和`Y`定义为`*= A10*`，你将得到完整的组合列表。
- en: 'The total number of elements should be as follows:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 元素的总数应如下所示：
- en: '![](img/03d5fd46-e562-4299-babd-f7a4cc68dca1.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/03d5fd46-e562-4299-babd-f7a4cc68dca1.png)'
- en: 'Going back to our `Cancat depts` sheet, we need to count the number of transactions
    in which each pair appears in the same transaction (`X` and `Y`) and the number
    of times that each department appears. We will define two functions:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 返回到我们的`Concat depts`工作表，我们需要计算每个对在相同交易（`X`和`Y`）中出现的交易数量以及每个部门出现的次数。我们将定义两个函数：
- en: 'Here, we assume that the concatenated department names are in column *B* in
    the `Concat depts`  sheet(this is why it needs to be named like that; if you understand
    the function you can change the name), and columns *C* and *D* contain the `X`
    and `Y` list respectively. The two *COUNTIF* functions account for the fact that
    the department names can appear in a different order, as shown in the following
    formula:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这里，我们假设连接后的部门名称位于`Concat depts`工作表的列*B*中（这就是为什么需要这样命名的原因；如果你理解了函数，你可以更改名称），列*C*和*D*分别包含`X`和`Y`列表。两个`COUNTIF`函数考虑到了部门名称可能以不同的顺序出现，如下面的公式所示：
- en: '*X&Y = =COUNTIF(''Concat depts''!$B$2:$B$2065;"*"&C2&"*"&D2&"*")+COUNTIF(''Concat
    depts''!$B$2:$B$2065;"*"&D2&"*"&C2&"*")*'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '*X&Y = =COUNTIF(''Concat depts''!$B$2:$B$2065;"*"&C2&"*"&D2&"*")+COUNTIF(''Concat
    depts''!$B$2:$B$2065;"*"&D2&"*"&C2&"*")*'
- en: 'We copy the following formulas until we reach the last element, that is, number
    `45`:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将复制以下公式，直到达到最后一个元素，即数字`45`：
- en: '*X = COUNTIF(''Concat depts''!$B$2:$B$2065;"*"&C2&"*")*'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '*X = COUNTIF(''Concat depts''!$B$2:$B$2065;"*"&C2&"*")*'
- en: 'We will calculate the following:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将计算以下内容：
- en: '*Support = X&Y/N*'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '*支持 = X&Y/N*'
- en: '*Confidence = X&Y/X*'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '*自信 = X&Y/X*'
- en: 'Here, *N* is the total number of transactions. *Support* represents the frequency
    of the rule (combination of departments) in the data, and *Confidence* is an estimation
    of the conditional probability of a transaction involving the `X` and `Y` departments
    at the same time. Adding these two columns, we get a table as shown in the following
    screenshot, showing the results of the calculations:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*N*是交易的总数。*支持*表示规则（部门组合）在数据中的频率，而*置信度*是对涉及`X`和`Y`部门同时进行的交易的条件概率的估计。将这两个列相加，我们得到以下截图所示的表格，显示了计算结果：
- en: '![](img/7dca0b75-28a6-47c1-be40-800864c252c8.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/7dca0b75-28a6-47c1-be40-800864c252c8.png)'
- en: The calculations we have just performed are the basis of the Apriori algorithm, published
    by R. Agrawal and R. Srikant in 1994 for finding frequent item sets in a dataset
    for Boolean association rules, so named because it uses prior knowledge of frequent
    item set properties. The Apriori algorithm is also useful in mining frequent item
    sets and relevant association rules. Usually, this algorithm is used to operate
    on a database containing a large number of transactions, such as items that customers
    buy at a supermarket. It helps customers to easily make their purchases and enhances
    the sales performance of the store. It is important to notice that the correlation
    between items does not imply causation; for example, that buying one item causes
    someone to buy another.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚进行的计算是Apriori算法的基础，该算法由R. Agrawal和R. Srikant于1994年发表，用于在数据集中寻找频繁项集的布尔关联规则，之所以命名为Apriori算法，是因为它使用了频繁项集属性的先验知识。Apriori算法在挖掘频繁项集和相关的关联规则方面也非常有用。通常，这个算法用于操作包含大量交易的数据库，例如顾客在超市购买的商品。它帮助顾客轻松地进行购买，并提高了商店的销售业绩。重要的是要注意，商品之间的相关性并不一定意味着因果关系；例如，购买一个商品会导致某人购买另一个商品。
- en: In a real-world scenario, we would choose the combinations with the largest
    *Support* and *Confidence* above a certain threshold, and study those insights.
    Apart from obvious rules, such as people shopping at the spirits and wine departments
    in the same purchase, we will find other combinations that we didn't expect. The
    main point is to find actionable insights; that is, those we can do something
    about. We can offer new articles, combine them in promotions, and advertise them
    in different places.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 在现实场景中，我们会选择支持度和置信度超过一定阈值的组合，并研究这些见解。除了明显的规则，例如在同一笔购买中在酒水和葡萄酒部门购物的规则之外，我们还会发现我们没有预料到的其他组合。主要目的是找到可操作的见解；也就是说，我们可以采取行动的见解。我们可以提供新产品，将它们组合在促销活动中，并在不同的地方进行广告。
- en: There are a large number of possibilities. The important thing is that the machine
    has learned hidden associations and has given us useful information about our
    own business. It is extremely important that it is not only machine learning specialists
    who are a part of these analyses, but also people involved in the business should
    give their impressions and use their experience and knowledge to turn this information
    into an economic benefit.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 有大量的可能性。重要的是，机器已经学会了隐藏的关联，并为我们提供了关于我们自己的业务的有用信息。极其重要的是，不仅机器学习专家是这些分析的一部分，而且参与业务的人也应该提供他们的看法，并利用他们的经验和知识将此信息转化为经济利益。
- en: Can a full analysis be carried out in Excel? Should we limit ourselves to a
    toy model if we don't have access to more advanced tools? Of course not! Excel
    is extremely powerful and able to be used in advanced analyses, but we need to
    know how to write a little VBA code in macros.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 是否可以在Excel中完成全面分析？如果我们无法访问更高级的工具，我们应该限制自己使用玩具模型吗？当然不是！Excel功能极其强大，能够用于高级分析，但我们需要知道如何在宏中编写一点VBA代码。
- en: The concept of Market Basket Analysis should be clear now, and we can move forward
    to another example of customer behavior analysis.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 现在应该已经清楚市场篮子分析的概念了，我们可以继续到另一个客户行为分析的例子。
- en: Learning by example – Customer Cohort Analysis
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过实例学习 - 客户群体分析
- en: An excellent way of gaining insights about a company's customers and their behavior
    is to perform a segmented analysis. These segments are groups of customers that
    share the same characteristics and are usually called **cohorts**. Their definition
    depends very much on the type of business we are dealing with.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 对一个公司的客户及其行为获得洞察的一个极好方式是进行分段分析。这些分段是具有相同特征的客户组，通常被称为 **队列**。它们的定义在很大程度上取决于我们正在处理的企业类型。
- en: The dataset we will analyze contains a list of customer IDs, the date when they
    first purchased something from us, the day they left us, and the mean amount of
    money spent per month. What does "left us*"* mean in this context? It is mainly
    a matter of definition. For example, if we refer to a credit card, we could consider
    that the customer left when they cancelled the card, or maybe we want to go further
    and say that if the customer did not spend any money for two or three months,
    we consider that they have left.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将分析的数据集包含客户 ID 列表、他们首次从我们这里购买东西的日期、他们离开我们的日期以及每月平均花费金额。在这个上下文中，“离开我们”是什么意思？这主要是一个定义问题。例如，如果我们指的是信用卡，我们可能会认为客户在取消卡片时离开，或者我们可能想更进一步，如果客户连续两三个月没有花费任何钱，我们认为他们已经离开了。
- en: Our grouping will then be based on the starting date. We will study how many
    customers **churned**, or abandoned us in a given period.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们的分组将基于开始日期。我们将研究在给定时间段内有多少客户 **流失**，或者放弃了我们。
- en: The **Lifetime Value of a Customer** (**LTV**) often refers to the gross profit
    generated by this customer over the whole period that they stayed with us. Both
    analyses together help us decide which customers we must retain and which actions
    were more effective in acquiring more valuable customers in terms of monthly spend
    and fidelity.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户终身价值**（**LTV**）通常指的是客户在我们这里整个期间产生的毛利润。这两个分析一起帮助我们决定哪些客户我们必须保留，以及哪些行动在获取更多有价值客户（就每月支出和忠诚度而言）方面更有效。'
- en: 'The analysis comprises the following steps:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 分析包括以下步骤：
- en: Read the `cohort_input_data.csv` input file, navigating to Data | From Text/CSV
    and selecting it.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 读取 `cohort_input_data.csv` 输入文件，导航到数据 | 从文本/CSV，并选择它。
- en: 'The two date columns, `Date in` and `Date out`, look better and are easier
    to understand if we choose the *month-year* format for them. Select the columns,
    right-click on them, and click on Format Cells. A pop-up window, like the one
    in the following screenshot, will appear:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们选择 *month-year* 格式，两个日期列 `Date in` 和 `Date out` 会看起来更好，也更易于理解。选择这些列，右键单击它们，然后点击格式单元格。会出现一个弹出窗口，如下面的截图所示：
- en: '![](img/18076bf4-8444-4adc-bd25-3b955addd14a.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](img/18076bf4-8444-4adc-bd25-3b955addd14a.png)'
- en: 'Add two columns: `Cohort`, which in this case is equal to `Date in`, and `Active
    months`, which we can calculate as follows:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加两列：`Cohort`，在这种情况下等于 `Date in`，以及 `Active months`，我们可以按以下方式计算：
- en: '*=DATEDIF(B2;C2;"m")*'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '*=DATEDIF(B2;C2;"m")*'
- en: This assumes that column *B* contains the `Data in` values and column *C* contains
    the `Data out` values.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 这假设列 *B* 包含 `Data in` 值，列 *C* 包含 `Data out` 值。
- en: 'Copy this formula to the remaining cells. The resulting table, sorted by `Date
    in`, is as follows:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将此公式复制到剩余的单元格中。按 `Date in` 排序的结果表格如下：
- en: '![](img/bb8f39f7-2083-4345-9b9b-0f459a662794.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bb8f39f7-2083-4345-9b9b-0f459a662794.png)'
- en: Rename this sheet `Customer data` for future reference.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将此工作表重命名为 `Customer data` 以便将来参考。
- en: 'First, we will study how well we retained customers over the lifetime of a
    given cohort. Each group will tell us what actions to repeat and which to avoid
    to prevent customer churn. We will use the *COUNTIFS* Excel function to count
    the number of active customers per month in each cohort:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将研究在给定队列的生命周期内我们保留客户的情况如何。每个组都会告诉我们哪些行动需要重复，哪些需要避免以防止客户流失。我们将使用 *COUNTIFS*
    Excel 函数来计算每个队列每月活跃客户的数量：
- en: 'Create a matrix with 48 rows, from zero to the largest difference in months
    in our dataset (48 months), and one column per month, from `Feb-15` to `Jan-19`.
    An example of this matrix can be seen in the following screenshot:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个包含 48 行的矩阵，从零到我们数据集中月份的最大差异（48 个月），以及每月一列，从 `Feb-15` 到 `Jan-19`。以下截图展示了此矩阵的一个示例：
- en: '![](img/dfca291b-2ee9-4a2a-944c-1639f8e2e841.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dfca291b-2ee9-4a2a-944c-1639f8e2e841.png)'
- en: 'Add a row at the end of the table to calculate the total number of customers
    in each cohort by using the following formula:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在表格末尾添加一行，使用以下公式计算每个队列中客户总数：
- en: '*=COUNTIF(''Customer* data''!$E$2:$E$751;"="&C$1)'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '*=COUNTIF(''Customer* data''!$E$2:$E$751;"="&C$1)'
- en: This is because column *E* in the `Customer data` sheet contains the list of
    cohorts, and row one contains the list of cohorts in our matrix.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 这是因为`Customer data`工作表的*C*列包含队列列表，而矩阵的第一行包含我们的矩阵中的队列列表。
- en: 'Copy the cell contents to all cells to the right in the table, and, since the
    row is fixed, the correct values are calculated for each column, as shown in the
    following screenshot:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将单元格内容复制到表格右侧的所有单元格中，由于行是固定的，因此每个列的正确值都会被计算出来，如下截图所示：
- en: '![](img/bba4ea96-0edf-4e25-ad55-7329cc445b95.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bba4ea96-0edf-4e25-ad55-7329cc445b95.png)'
- en: 'In the first cell of the matrix, write the following formula:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在矩阵的第一个单元格中，输入以下公式：
- en: '*=COUNTIFS(''Customer data''!$E$2:$E$751;"="&C$1;''Customer data''!$C$2:$C$751;">"&EOMONTH(C$1;$B1))/C$52*'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '*=COUNTIFS(''Customer data''!$E$2:$E$751;"="&C$1;''Customer data''!$C$2:$C$751;">"&EOMONTH(C$1;$B1))/C$52*'
- en: 'Let''s see in detail what it means:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们详细看看这意味着什么：
- en: We only count if the contents of *C1* (`Feb-15`, the current cohort) are part
    of the list of cohorts in column *E* inthe `Customer data` sheet.
  id: totrans-97
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们只计算如果*C1*（`Feb-15`，当前队列）的内容是`Customer data`工作表*C*列中队列列表的一部分。
- en: We count if `Date out` (column *C* inthe `Customer data` sheet ) is larger than
    the current cohort plus the number of months in column *B*. We use the *EOMONTH* function
    to deal with the fact that we might have full dates as inputs, and not just months
    and years. Check the definition of this function in Excel help.
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们计算`Date out`（`Customer data`工作表的*C*列）是否大于当前队列加上*B*列中的月份数。我们使用*EOMONTH*函数来处理可能作为输入的完整日期，而不仅仅是月份和年份。请在Excel帮助中查看此函数的定义。
- en: We finally divide this by the total number of customers to get a percentage.
  id: totrans-99
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们最后将这个值除以客户总数，得到一个百分比。
- en: Copy the formula to the whole matrix.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将公式复制到整个矩阵。
- en: Format the cells as a percentage.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将单元格格式化为百分比。
- en: 'Format the cells conditionally using a three-color scale. The result looks
    like the following screenshot:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用三色刻度条件格式化单元格。结果如下截图所示：
- en: '![](img/75ab0c52-61ac-4180-9d12-e0c2454c64e6.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/75ab0c52-61ac-4180-9d12-e0c2454c64e6.png)'
- en: We can see, for example, that after 20 months, only 19% of the customers acquired
    in `Feb-15` remain. The color scale also shows that some cohorts show a faster
    churn than others. It is now necessary for the business expert to evaluate what
    actions were actions taken during each time period and repeat or change them.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们可以看到在20个月后，`Feb-15`获得的客户中只有19%仍然存在。颜色刻度还显示，某些队列的流失速度比其他队列快。现在，业务专家需要评估在每个时间段采取了哪些行动，并重复或更改它们。
- en: 'We know now how many customers we were able to keep, but what was their value?
    They do not spend the same amount, so we need to include that variable in the
    analysis. Follow these steps:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在知道我们能够保留多少客户，但他们的价值是多少？他们的消费金额并不相同，因此我们需要将这个变量包含在分析中。按照以下步骤操作：
- en: 'Create a similar matrix, with the month number and cohorts, but now we will
    use a different formula:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个类似的矩阵，包含月份和队列，但现在我们将使用不同的公式：
- en: '*=SUMIFS(''Customer* data''!$D$2:$D$751;''Customer data''!$E$2:$E$751;"="&C$1;''Customer
    data''!$C$2:$C$751;">"&EOMONTH(C$1;$B1))'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '*=SUMIFS(''Customer* data''!$D$2:$D$751;''Customer data''!$E$2:$E$751;"="&C$1;''Customer
    data''!$C$2:$C$751;">"&EOMONTH(C$1;$B1))'
- en: 'This formula means that we only sum the values on the `Customer data` sheet
    in column *D* if two conditions are met:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 这个公式意味着，只有当以下两个条件都满足时，我们才会在`Customer data`工作表的`D`列上对值进行求和：
- en: If the summed values correspond to the cohort in *C1*
  id: totrans-109
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果总和值对应于*C1*队列
- en: If `Date out` is larger than the current cohort, that is, the customer is still
    with us
  id: totrans-110
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果`Date out`大于当前队列，即客户仍然在我们这里，那么：
- en: Copy the cell value to the whole matrix.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将单元格值复制到整个矩阵。
- en: 'Format the table in a similar way as before to get a colored matrix, as shown
    in the following screenshot:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以与之前类似的方式格式化表格，以得到一个彩色矩阵，如下截图所示：
- en: '![](img/c1f101af-d39a-42fc-8fb5-4f01e3853c1a.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c1f101af-d39a-42fc-8fb5-4f01e3853c1a.png)'
- en: In this case, we can see how the amount of money spent changes with time for
    each cohort, and it is slightly different then the raw number of customers.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们可以看到每个队列随时间变化的消费金额，这与原始客户数量略有不同。
- en: Summary
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: 'In this chapter, we learned about two data mining techniques: Market Basket
    Analysis and Customer Cohort Analysis. The first one tells us about hidden relations
    between store departments or products based on the customers'' behavior. The second
    shows the time evolution of the number of customers, revealing differences between
    different customer segments or cohorts.'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了两种数据挖掘技术：市场篮子分析和顾客群体分析。第一种技术基于顾客行为告诉我们店铺部门或产品之间的隐藏关系。第二种技术显示了顾客数量的时间演变，揭示了不同顾客细分市场或群体之间的差异。
- en: There are a large number of data mining analyses that can help us dig into our
    datasets and find hidden information, which is extremely important in order for
    us to understand our business and make the right decisions.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 有大量数据挖掘分析可以帮助我们深入挖掘数据集，找到隐藏信息，这对于我们理解业务和做出正确决策至关重要。
- en: 'In the next chapter, we will study a special kind of dataset in detail: time
    series. We will see that it needs a different kind of modeling and analysis.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将详细研究一种特殊的数据集：时间序列。我们将看到它需要不同类型的建模和分析。
- en: Questions
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: How can the unexplainable, random associations be avoided in a Market Basket
    Analysis?
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在市场篮子分析中，如何避免无法解释的随机关联？
- en: If we find a correlation between two products or two departments in a given
    store, can this be generalized to other places?
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们在某个店铺中找到两种产品或两个部门之间的相关性，这种相关性能否推广到其他地方？
- en: Some columns in the cohort matrix show zeroes starting at a given date. What
    does this mean in the context of the current dataset?
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 群体矩阵中的一些列从某个特定日期开始显示零。这在当前数据集的背景下意味着什么？
- en: The last rows in the cohort matrix show zero consistently. What does this mean
    in the context of the current dataset?
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 群体矩阵的最后几行持续显示零。这在当前数据集的背景下意味着什么？
- en: How would you maximize the amount of money spent by customers as time passes?
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 随着时间的推移，你如何最大化顾客的消费金额？
- en: Further reading
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: '*Database Marketing: Analyzing and Managing Customers* by Robert C. Blattberg, Byung-Do Kim, Scott
    A Neslin'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 《*数据库营销：分析和管理顾客*》由Robert C. Blattberg，Byung-Do Kim，Scott A Neslin著
- en: '*Data Science for Business: What You Need to Know about Data Mining and Data-Analytic
    Thinking, 1st Edition*, by Foster Provost, Tom Fawcett'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 《*数据科学商业应用：你需要了解的数据挖掘和数据分析思维，第1版*》，由Foster Provost，Tom Fawcett著

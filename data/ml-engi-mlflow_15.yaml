- en: '*Chapter 11*: Performance Monitoring'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第11章*：性能监控'
- en: In this chapter, you will learn about the important and relevant area of **Machine
    Learning (ML)** operations and how to ensure a smooth ride in the production systems
    developed so far in this book using best practices in the area and known operational
    patterns. We will understand the concept of operations in ML, and look at metrics
    for monitoring data quality in ML systems.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将了解机器学习（ML）操作的重要和相关性领域，以及如何使用该领域的最佳实践和已知的操作模式来确保到目前为止在此书中开发的系统在生产中的平稳运行。我们将了解机器学习中的操作概念，并查看用于监控机器学习系统中数据质量的指标。
- en: 'Specifically, we will look at the following sections in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 具体来说，我们将在本章中查看以下部分：
- en: Overview of performance monitoring for ML models
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 机器学习模型性能监控概述
- en: Monitoring data drift and model performance
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控数据漂移和模型性能
- en: Monitoring target drift
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控目标漂移
- en: Infrastructure monitoring and alerting
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础设施监控和警报
- en: We will address some practical reference tools for performance and reliability
    monitoring of ML systems.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将介绍一些用于监控机器学习系统性能和可靠性的实用参考工具。
- en: Technical requirements
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'For this chapter, you will need the following prerequisites:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章，你需要以下先决条件：
- en: The latest version of Docker installed on your machine. If you don't already
    have it installed, please follow the instructions at [https://docs.docker.com/get-docker/](https://docs.docker.com/get-docker/).
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在您的机器上安装了最新版本的Docker。如果您还没有安装，请按照[https://docs.docker.com/get-docker/](https://docs.docker.com/get-docker/)上的说明操作。
- en: The latest version of `docker-compose` installed. To do this, please follow
    the instructions at https://docs.docker.com/compose/install/.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装了最新版本的`docker-compose`。为此，请按照[https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)上的说明操作。
- en: Access to Git in the command line, which can be installed as described at [https://git-scm.com/book/en/v2/Getting-Started-Installing-Git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git).
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在命令行中访问Git，可以按照[https://git-scm.com/book/en/v2/Getting-Started-Installing-Git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)中的说明进行安装。
- en: Access to a Bash terminal (Linux or Windows).
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 访问Bash终端（Linux或Windows）。
- en: Access to a browser.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 访问浏览器。
- en: Python 3.8+ installed.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python 3.8+已安装。
- en: The latest version of your ML platform installed locally as described in [*Chapter
    3*](B16783_03_Final_SB_epub.xhtml#_idTextAnchor066)*, Your Data Science Workbench*.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按照[*第3章*](B16783_03_Final_SB_epub.xhtml#_idTextAnchor066)*，*您的数据科学工作台*中描述的，在本地安装了您机器学习的最新版本。
- en: An AWS account configured to run the MLflow model.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置了AWS账户以运行MLflow模型。
- en: Overview of performance monitoring for machine learning models
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 机器学习模型性能监控概述
- en: Monitoring is at the cornerstone of reliable ML systems able to consistently
    unlock the value of data and provide critical feedback for improvement.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 监控是可靠机器学习系统的基石，能够持续释放数据的价值并提供改进的关键反馈。
- en: 'On the monitoring side of ML models, there are multiple interested parties,
    and we should take the requirements for monitoring from the different stakeholders
    involved. One example of a typical set of stakeholders is the following:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在机器学习模型的监控方面，有多个利益相关者，我们应该从涉及的不同利益相关者那里获取监控要求。以下是一个典型的利益相关者集的一个例子：
- en: '**Data scientists**: Their focus regarding monitoring is evaluating model performance
    and data drift that might negatively affect that performance.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据科学家**：他们在监控方面的重点是评估可能对性能产生负面影响的模型性能和数据漂移。'
- en: '**Software engineers**: These stakeholders want to ensure that they have metrics
    that assess whether their products have reliable and correct access to the APIs
    that are serving models.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**软件工程师**：这些利益相关者希望确保他们有衡量指标，以评估他们的产品是否能够可靠且正确地访问为模型提供服务的API。'
- en: '**Data engineers**: They want to ensure that the data pipelines are reliable
    and pushing data reliably, at the right velocity, and in line with the correct
    schemas.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据工程师**：他们希望确保数据管道是可靠的，并且能够可靠地推送数据，以适当的速度，并且符合正确的模式。'
- en: '**Business/product stakeholders**: These stakeholders are interested in the
    core impact of the overall solution on their customer base. For instance, in a
    trading platform, they might be most concerned with the profit-to-risk ratio that
    the overall solution brings to the company. A circuit breaker might be added to
    the algorithm if the market is in a day of very high volatility or in an atypical
    situation.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**业务/产品利益相关者**：这些利益相关者对其客户群整体解决方案的核心影响感兴趣。例如，在一个交易平台中，他们可能最关心整体解决方案为公司带来的盈利与风险比率。如果市场在一天内非常波动或处于非典型情况，可能会向算法中添加断路器。'
- en: 'The most widely used dimensions of monitoring in the ML industry are the following:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在机器学习行业中，最广泛使用的监控维度如下：
- en: '**Data drift**: This corresponds to significant changes in the input data used
    either for training or inference in a model. It might indicate a change of the
    modeled premise in the real world, which will require the model to be retrained,
    redeveloped, or even archived if it''s no longer suitable. This can be easily
    detected by monitoring the distributions of data used for training the model versus
    the data used for scoring or inference over time.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据漂移**：这对应于用于模型训练或推理的输入数据发生的重大变化。这可能表明现实世界中模型假设的变化，这将需要重新训练、重新开发模型，甚至如果不再适用，则存档。这可以通过监控用于训练模型的数据与用于评分或推理的数据随时间变化的分布来轻松检测。'
- en: '**Target drift**: In line with the change of regimens in input data, we often
    see the same change in the distribution of outcomes of the model over a period
    of time. The common periods are months, weeks, or days, and might indicate a significant
    change in the environment that would require model redevelopment and tweaking.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目标漂移**：随着输入数据中方案的变化，我们在一段时间内经常看到模型输出分布的相同变化。常见的周期是几个月、几周或几天，可能表明环境发生了重大变化，这将需要模型重新开发和调整。'
- en: '**Performance drift**: This involves looking at whether the performance metrics
    such as accuracy for classification problems, or root mean square error, start
    suffering a gradually worsening over time. This is an indication of an issue with
    the model requiring investigation and action from the model developer or maintainer.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**性能漂移**：这涉及到查看性能指标，如分类问题的准确度或均方根误差，是否随着时间的推移逐渐恶化。这是模型存在问题的迹象，需要模型开发人员或维护人员进行调查和采取行动。'
- en: '**Platform and infrastructure metrics**: This type of metrics is not directly
    related to modeling, but with the systems infrastructure that encloses the model.
    It implies abnormal CPU, memory, network, or disk usage that will certainly affect
    the ability of the model to deliver value to the business.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平台和基础设施指标**：此类指标与建模无直接关系，而是与包围模型的系统基础设施有关。它意味着异常的CPU、内存、网络或磁盘使用，这肯定会影响模型向业务提供价值的能力。'
- en: '**Business metrics**: Very critical business metrics, such as the profitability
    of the models, in some circumstances should be added to the model operations in
    order to ensure that the team responsible for the model can monitor the ability
    of the model to deliver on its business premise.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**业务指标**：非常关键的业务指标，如模型的盈利能力，在某些情况下应添加到模型运营中，以确保负责模型的团队能够监控模型实现其业务假设的能力。'
- en: In the next section, we will look at using a tool that we can integrate with
    **MLflow** to monitor for data drift and check the performance of models.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将探讨使用一个可以与**MLflow**集成的工具来监控数据漂移并检查模型的性能。
- en: Monitoring data drift and model performance
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控数据漂移和模型性能
- en: In this section, we will run through an example that you can follow in the notebook
    available in the **GitHub** repository (at https://github.com/PacktPublishing/Machine-Learning-Engineering-with-MLflow/tree/master/Chapter11/model_performance_drifts)
    of the code of the package. We will run through the process of calculating different
    types of drift and exploring its integration with MLflow.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将通过一个示例，您可以在**GitHub**仓库（https://github.com/PacktPublishing/Machine-Learning-Engineering-with-MLflow/tree/master/Chapter11/model_performance_drifts）中找到的笔记本中的代码进行演示。我们将通过计算不同类型的漂移并探索其与MLflow的集成来运行整个过程。
- en: One emergent open source tool in the space of monitoring model performance is
    called `pandas`, JSON, and CSV. It allows us to monitor multiple drifts in ML
    models and their performance. The GitHub repository for Evidently is available
    at [https://github.com/evidentlyai/evidently/](https://github.com/evidentlyai/evidently/).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 监控模型性能领域的一个新兴开源工具被称为 `pandas`、JSON 和 CSV。它允许我们监控机器学习模型中的多个漂移及其性能。Evidently 的
    GitHub 仓库可在 [https://github.com/evidentlyai/evidently/](https://github.com/evidentlyai/evidently/)
    找到。
- en: In this section, we will explore the combination of Evidently with MLflow, in
    order to monitor data drift and model performances in the next section.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探索 Evidently 与 MLflow 的组合，以便在下一节中监控数据漂移和模型性能。
- en: Monitoring data drift
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 监控数据漂移
- en: 'In this subsection, we will set up **Evidently** in our environment and understand
    how to integrate it. Follow these steps in the GitHub repository (refer to the
    *Technical requirements* section for more details):'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在本小节中，我们将在我们的环境中设置 **Evidently** 并了解如何将其集成。请按照 GitHub 仓库中的这些步骤操作（更多详细信息请参阅 *技术要求*
    部分）：
- en: 'Install `evidently`:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 `evidently`：
- en: '[PRE0]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Import the relevant libraries:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入相关库：
- en: '[PRE1]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Get a reference dataset, basically a training dataset. We will add a set of
    features to the `pandas` DataFrame so `evidently` will be able to use the feature
    names in the drift reports:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取一个参考数据集，基本上是一个训练数据集。我们将向 `pandas` DataFrame 添加一组特征，以便 `evidently` 能够在漂移报告中使用特征名称：
- en: '[PRE2]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The following *Figure 11.1* represents the data structure of the training data
    that we will be using as the reference dataset:'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 以下 *图 11.1* 代表我们将用作参考数据集的训练数据的数据结构：
- en: '![Figure 11.1 – Sample of the dataset to be used](img/image0017.jpg)'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图 11.1 – 要使用的数据集样本](img/image0017.jpg)'
- en: Figure 11.1 – Sample of the dataset to be used
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 11.1 – 要使用的数据集样本
- en: 'In this step, we load the `to_score_input_data.csv` file. This is the file
    to be scored. Our intention later in this exercise is to calculate the distribution
    difference between the data in the reference training set and the data to be scored:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此步骤中，我们加载 `to_score_input_data.csv` 文件。这是要评分的文件。我们在此练习中的目的是计算参考训练集中的数据与要评分的数据之间的分布差异：
- en: '[PRE3]'
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Execute the data drift report generation and log into an MLflow run. Basically,
    what happens in the following code excerpt is the generation of an Evidently dashboard
    with the reference data and the latest input data. A drift report is calculated
    and loaded into an MLflow run so it can be actioned and reviewed in further steps:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行数据漂移报告生成并记录到 MLflow 运行中。基本上，以下代码片段所发生的是生成一个包含参考数据和最新输入数据的 Evidently 仪表板。计算漂移报告并将其加载到
    MLflow 运行中，以便在后续步骤中采取行动和审查：
- en: '[PRE4]'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'You can run now the notebook code (on the `monitoring_data_drift_performance.ipynb`
    file) of the previous cells and explore your data drift reports in the MLflow
    UI over the Artifacts component of the MLflow run. *Figure 11.2* shows that the
    tool didn''t detect any drift among the 14 features, and the distributions are
    presented accordingly:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您现在可以运行前几行中的笔记本代码（在 `monitoring_data_drift_performance.ipynb` 文件中），并在 MLflow
    运行的“工件”组件中探索您的数据漂移报告。*图 11.2* 显示，该工具在 14 个特征中没有检测到任何漂移，并相应地展示了分布：
- en: '![Figure 11.2 – Sample of the dataset to be used](img/image0028.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.2 – 要使用的数据集样本](img/image0028.jpg)'
- en: Figure 11.2 – Sample of the dataset to be used
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.2 – 要使用的数据集样本
- en: In a similar fashion to data drift, we will now look in the next subsection
    at target drift to uncover other possible issues in our model.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 与数据漂移类似，我们现在将在下一小节中查看目标漂移，以揭示模型中可能的其他问题。
- en: Monitoring target drift
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 监控目标漂移
- en: 'We will now compare the scored output with the reference training output to
    look for possible target drift:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将比较评分输出与参考训练输出，以寻找可能的目标漂移：
- en: 'Get the recently scored dataset:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取最近评分的数据集：
- en: '[PRE5]'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Execute the data drift report generation and log the results in MLflow:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行数据漂移报告生成并将结果记录在 MLflow 中：
- en: '[PRE6]'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Explore the target drift reports on your target. As can be seen in *Figure 11.3*,
    no statistically significant figure on this run was found for target drift. In
    detecting drift, Evidently does statistical tests using the probability of the
    data being from a different distribution represented by the **p-value** (more
    details on this can be found at [https://en.wikipedia.org/wiki/P-value](https://en.wikipedia.org/wiki/P-value)).
    It compares the results between the reference and the current data:![](img/image0037.jpg)
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 探索您的目标漂移报告。如*图11.3*所示，在此次运行中未发现对目标漂移有统计学意义的数值。在检测漂移时，Evidently使用数据来自不同分布的概率（由**p值**表示）进行统计测试（更多详情请见[https://en.wikipedia.org/wiki/P-value](https://en.wikipedia.org/wiki/P-value)）。它比较了参考数据和当前数据的结果！[](img/image0037.jpg)
- en: Figure 11.3 – Target data drift for target
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![图11.3 – 目标数据漂移](img/image0048.jpg)'
- en: 'As shown in *Figure 11.4*, you can drill down further into target drift on
    a specific feature; in this case, a specific previous **day8** to predict the
    stock price:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如*图11.4*所示，您可以进一步深入到特定特征的目标漂移；在这种情况下，预测股票价格的特定前**8天**：
- en: '![Figure 11.4 – Target data drift for our target](img/image0048.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![图11.4 – 我们目标的数据漂移](img/image0048.jpg)'
- en: Figure 11.4 – Target data drift for our target
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.4 – 我们目标的数据漂移
- en: After having learned how to detect drift in the input data, we will now look
    at how to use Evidently to monitor drift in models.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在学习了如何检测输入数据中的漂移之后，我们现在将探讨如何使用Evidently来监控模型中的漂移。
- en: Monitoring model drift
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 监控模型漂移
- en: Monitoring model drift is extremely important to ensure that your model is still
    delivering at its optimal performance level. From this analysis, you can make
    a decision on whether to retrain your model or even develop a new one from scratch.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 监控模型漂移对于确保您的模型仍然以最佳性能水平运行至关重要。通过这次分析，您可以决定是否重新训练您的模型，甚至从头开始开发一个新模型。
- en: 'We will now monitor model drift. To do this, you need to execute the following
    steps:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将监控模型漂移。为此，您需要执行以下步骤：
- en: 'Import the relevant libraries:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入相关库：
- en: '[PRE7]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Get a reference dataset:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取参考数据集：
- en: '[PRE8]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Train your model:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 训练您的模型：
- en: '[PRE9]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Create a reference prediction and training predictions:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建参考预测和训练预测：
- en: '[PRE10]'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Generate and attach the performance reports to your execution:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成并附加性能报告到您的执行中：
- en: '[PRE11]'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Explore your MLflow performance metrics report. By looking at the reports generated,
    you can check on the **Reference** metrics that **Accuracy**, **Precision**, **Recall**,
    and **F1 metrics**, which are considered the reference metrics based on the training
    data, have maximum values of **1**. The current status on the row below is definitely
    degraded when we test the subset of testing data. This can help you make the call
    on whether it is sensible for the model to still be in production with the current
    **F1** value:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 探索您的MLflow性能指标报告。通过查看生成的报告，您可以检查**参考**指标，包括**准确率**、**精确度**、**召回率**和**F1指标**，这些是基于训练数据的参考指标，其最大值为**1**。当我们测试测试数据集的子集时，下面一行当前状态肯定已经退化。这可以帮助您判断是否在当前的**F1**值下，模型仍然在生产中运行是有意义的：
- en: '![Figure 11.5 – Target data drift for target](img/image0056.jpg)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![图11.5 – 目标数据漂移](img/image0056.jpg)'
- en: Figure 11.5 – Target data drift for target
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '![图11.5 – 目标数据漂移](img/image0056.jpg)'
- en: After having delved into the details of data drift, target drift, and model
    performance monitoring, along with how to integrate these functionalities with
    MLflow, we will now look at the basic principles of monitoring infrastructure,
    including monitoring and alerting.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入了解数据漂移、目标漂移和模型性能监控的细节，以及如何将这些功能与MLflow集成之后，我们现在将探讨监控基础设施的基本原则，包括监控和警报。
- en: Infrastructure monitoring and alerting
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基础设施监控和警报
- en: The main dimensions of monitoring in ML systems from an infrastructure perspective
    do not differ from those in traditional software systems.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 从基础设施的角度来看，ML系统监控的主要维度与传统软件系统没有区别。
- en: In order to illustrate this exact issue, we will leverage the monitoring and
    alerting tools available in **AWS CloudWatch** and **SageMaker** to illustrate
    an example of setting up monitoring and alerting infrastructure. This same mechanism
    can be set up with tools such as Grafana/Prometheus for on-premises and cloud
    deployments alike. These monitoring tools achieve similar goals and provide comparable
    features, so you should choose the most appropriate depending on your environment
    and cloud provider.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明这个问题，我们将利用 **AWS CloudWatch** 和 **SageMaker** 中可用的监控和警报工具来展示设置监控和警报基础设施的示例。这个相同的机制可以使用
    Grafana/Prometheus 等工具在本地和云部署中设置。这些监控工具实现类似的目标，并提供类似的功能，因此您应该根据您的环境和云提供商选择最合适的工具。
- en: '**AWS CloudWatch** provides a monitoring and observability solution. It allows
    you to monitor your applications, respond to system-wide performance changes,
    optimize resource use, and receive a single view of operational health.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**AWS CloudWatch** 提供了一种监控和可观察性解决方案。它允许您监控您的应用程序，响应系统级性能变化，优化资源使用，并获得操作健康性的单一视图。'
- en: 'At a higher level, we can split the infrastructure monitoring and alerting
    components into the following three items:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在更高层次上，我们可以将基础设施监控和警报组件分为以下三个部分：
- en: '**Resource metrics**: This refers to metrics regarding the hardware infrastructure
    where the system is deployed. The main metrics in this case would be the following:'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**资源指标**：这指的是系统部署的硬件基础设施的指标。在这种情况下，主要的指标包括以下内容：'
- en: 'a. **CPU utilization**: This is basically a unit of utilization of your processor
    as a percentage value. This is the general metric available and should be monitored.'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: a. **CPU 利用率**：这基本上是处理器利用率的百分比单位。这是一个通用的指标，应该被监控。
- en: 'b. **Memory utilization**: The percentage of memory in use at the moment by
    your computing system.'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: b. **内存利用率**：您的计算系统当前使用的内存百分比。
- en: 'c. **Network data transfer**: Network data transfer refers to the amount of
    traffic in and out of a specific compute node. It is generally measured in Mb/s.
    An anomaly might mean that you need to add more nodes to your system or increase
    capacity.'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: c. **网络数据传输**：网络数据传输是指特定计算节点进出流量的大小。它通常以 Mb/s 为单位。异常可能意味着您需要向系统中添加更多节点或增加容量。
- en: 'd. **Disk I/O**: This is measured in the throughput of writes and reads from
    the disk; it might point to a system under stress that needs to be either scaled
    or have its performance investigated:'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: d. **磁盘 I/O**：这是通过磁盘的读写吞吐量来衡量的；它可能表明系统处于压力之下，需要扩展或调查其性能：
- en: '![Figure 11.6 – SageMaker infrastructure metric examples'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 11.6 – SageMaker 基础设施指标示例](img/image0065.jpg)'
- en: '](img/image0065.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 11.6 – SageMaker 基础设施指标示例](img/image0065.jpg)'
- en: Figure 11.6 – SageMaker infrastructure metric examples
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.6 – SageMaker 基础设施指标示例
- en: '**System metrics**: The second pillar of infrastructure monitoring and alerting
    components refers to metrics regarding the system infrastructure where the system
    is deployed. The main metrics in this case would be the following:'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**系统指标**：基础设施监控和警报组件的第二支柱是指系统基础设施的指标，系统部署在其中。在这种情况下，主要的指标包括以下内容：'
- en: 'a. **Request throughput**: The number of predictions served over a second'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: a. **请求吞吐量**：每秒处理的预测数量
- en: 'b. **Error rate**: The number of errors per prediction'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: b. **错误率**：每个预测的错误数量
- en: 'c. **Request latencies**: The end-to-end time taken to serve a prediction'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: c. **请求延迟**：服务预测的端到端时间
- en: 'd. **Validation metrics**: Error metrics on input data for the request'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: d. **验证指标**：请求输入数据的错误指标
- en: 'A production system such as SageMaker pushes system metrics into AWS CloudWatch
    to provide real-time system metrics monitoring. AWS CloudWatch has a complete
    feature set of features to manage, store, and monitor metrics and dashboards:'
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一个生产系统，如 SageMaker，会将系统指标推送到 AWS CloudWatch 以提供实时系统指标监控。AWS CloudWatch 拥有一套完整的特性集，用于管理、存储和监控指标和仪表板：
- en: '![Figure 11.7 – Specify an alarm in AWS CloudWatch](img/image0074.jpg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.7 – 在 AWS CloudWatch 中指定警报](img/image0074.jpg)'
- en: Figure 11.7 – Specify an alarm in AWS CloudWatch
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.7 – 在 AWS CloudWatch 中指定警报
- en: '**Alerting**: For alerting, we use any of the metrics calculated in the previous
    section and set up a threshold that we consider acceptable. The AWS CloudWatch
    interface allows you to easily set up alerts on the default service metrics and
    custom metrics. The team responsible for reliability is alerted by CloudWatch
    sending messages to a corporate chat/Slack, email address, or mobile phone to
    allow the team to address or mitigate the incident:'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**警报**：对于警报，我们使用上一节计算出的任何指标，并设置一个我们认为可接受的阈值。AWS CloudWatch界面允许您轻松设置默认服务指标和自定义指标的警报。负责可靠性的团队将通过CloudWatch发送消息到公司聊天/Slack、电子邮件地址或手机来接收警报，以便团队处理或减轻事件：'
- en: '![Figure 11.8 – Specify an alarm in AWS CloudWatch](img/image0084.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![图11.8 – 在AWS CloudWatch中指定一个警报](img/image0084.jpg)'
- en: Figure 11.8 – Specify an alarm in AWS CloudWatch
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.8 – 在AWS CloudWatch中指定一个警报
- en: You can use the same monitoring tools to log and monitor all the other metrics
    that are interrelated with your ML systems. For instance, having an alert for
    the weekly profit of a ML model is a business metric that should be deployed alongside
    the core systems metrics of your system.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用相同的监控工具记录和监控与您的ML系统相关联的所有其他指标。例如，为ML模型的周利润设置警报是一个应该与系统核心系统指标一起部署的业务指标。
- en: After being exposed to an overview of AWS CloudWatch as an example of a tool
    to implement metrics monitoring and alerting for your ML systems in production,
    we will explore advanced concepts of MLflow in the last chapter of the book.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的最后一章，我们将探讨MLflow的高级概念，作为对AWS CloudWatch作为实现生产中ML系统指标监控和警报工具的概述。
- en: Summary
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we introduced the concepts of data drift and target drift,
    and examined different approaches to performance monitoring in ML systems.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了数据漂移和目标漂移的概念，并探讨了ML系统中性能监控的不同方法。
- en: We started by introducing important concepts in the realm of performance and
    monitoring, different types of drift and business metrics to monitor, and the
    use of AWS CloudWatch as a tool to implement monitoring and alerting in real-time
    systems.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先介绍了性能和监控领域的重要概念，不同类型的漂移和需要监控的业务指标，以及使用AWS CloudWatch作为实时系统中实现监控和警报的工具。
- en: Performance and monitoring is an important component of our architecture, and
    it will allow us to conclude an important layer of our ML system's architecture.
    Now let's delve into the next chapter on advanced topics in MLflow.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 性能和监控是我们架构的重要组成部分，它将使我们能够完成我们ML系统架构的重要一层。现在让我们深入了解MLflow的高级主题。
- en: Further reading
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'In order to further your knowledge, you can consult the documentation at the
    following links:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进一步扩展您的知识，您可以查阅以下链接中的文档：
- en: '[https://www.mlflow.org/docs/latest/projects.html](https://www.mlflow.org/docs/latest/projects.html)'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.mlflow.org/docs/latest/projects.html](https://www.mlflow.org/docs/latest/projects.html)'
- en: '[https://evidentlyai.com/](https://evidentlyai.com/)'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://evidentlyai.com/](https://evidentlyai.com/)'
- en: '[https://aws.amazon.com/cloudwatch/](https://aws.amazon.com/cloudwatch/)'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://aws.amazon.com/cloudwatch/](https://aws.amazon.com/cloudwatch/)'

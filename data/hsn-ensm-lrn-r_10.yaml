- en: Chapter 10. Ensembling Survival Models
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第10章：集成生存模型
- en: The primary biliary cirrhosis data was introduced in first two chapters using
    the jackknife method. Observations in clinical trials are usually subject to censoring,
    and the jackknife method helps to complete incomplete observations through the
    idea of pseudo values. Since pseudo values are likely to be dependent on each
    other, the generalized estimating equation framework made it possible to estimate
    the impact of twelve covariates at the time of interest. The idea of pseudo values
    and the generalized estimating equation framework makes it easy for practitioners
    to interpret the results. However, this method might not be useful if the number
    of censored observations is exceptionally high. Furthermore, it is also preferable
    to have statistical methods that preserve the incompleteness of the observations
    and yet make good use of them. The general (linear) regression framework with
    time as the dependent variable and the error term following appropriate lifetime
    distribution can be set up in the usual regression framework. However, it turns
    out to be unreliable, and in many cases, it is known to be unstable, or the convergence
    simply does not take place. In *Regression Models and Life-Tables* ([http://www.stat.cmu.edu/~ryantibs/journalclub/cox_1972.pdf](http://www.stat.cmu.edu/~ryantibs/journalclub/cox_1972.pdf)),
    Cox (1972) achieved a breakthrough in the regression modeling of the survival
    data when he proposed the proportional hazards model. So, what is a hazards model?
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 原始的胆汁性肝硬化数据在前两章中使用了Jackknife方法进行介绍。临床试验中的观察结果通常会受到截尾的影响，而Jackknife方法通过伪值的概念帮助完成不完整的观察。由于伪值很可能会相互依赖，广义估计方程框架使得在感兴趣的时间点估计十二个协变量的影响成为可能。伪值的概念和广义估计方程框架使得从业者更容易解释结果。然而，如果截尾观察的数量异常高，这种方法可能并不适用。此外，也
    preferable to have statistical methods that preserve the incompleteness of the
    observations and yet make good use of them. 在常规回归框架中，可以将以时间为因变量，误差项遵循适当的生存分布的（线性）回归框架建立起来。然而，事实证明这种方法并不可靠，在许多情况下，它被认为是不可靠的，或者收敛根本不发生。在《回归模型与生命表》（[http://www.stat.cmu.edu/~ryantibs/journalclub/cox_1972.pdf](http://www.stat.cmu.edu/~ryantibs/journalclub/cox_1972.pdf)）中，Cox（1972）在提出比例风险模型时，在生存数据的回归建模方面取得了突破。那么，什么是风险模型？
- en: This chapter will open with core survival analysis concepts such as hazard rate,
    cumulative hazard function, and survival function. A few parametric lifetime models
    are also discussed and visualized through R programs. For the given data, we will
    then study how to carry out inference for the lifetime distribution through nonparametric
    methods. An estimation of the survival function and cumulative hazard function
    is then illustrated for the time to event of interest for the `pbc` dataset. Hypothesis
    testing through the use of the logrank test is demonstrated for different segments
    of the `pbc` data. Regression models will begin with a simple illustration of
    the parametric regression model, using exponential distribution as an example.
    It is known that the parametric models are not very useful for clinical trials
    data. This leads to an important variant in the Cox proportional hazards regression
    model, which is a **semiparametric** model in the sense that the baseline hazard
    rate is left completely unspecified and the impact of covariates is modeled through
    an exponential linear term on the hazard rate.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将首先介绍核心生存分析概念，如风险率、累积风险函数和生存函数。还将讨论和通过R程序可视化一些参数生存模型。对于给定的数据，我们将研究如何通过非参数方法进行寿命分布的推断。然后，对于`pbc`数据集中的感兴趣事件时间，将展示生存函数和累积风险函数的估计。通过logrank检验对不同段落的`pbc`数据进行假设检验。回归模型将从参数回归模型的一个简单示例开始，以指数分布为例。众所周知，参数模型对于临床试验数据并不非常有效。这导致Cox比例风险回归模型的一个重要变体，即半参数模型，在这种模型中，基线风险率被完全未指定，协变量的影响通过风险率上的指数线性项进行建模。
- en: Survival trees are an important variant of the decision tree applicable to the
    survival data. The split criteria are based on the **logrank** test. Naturally,
    we will be interested in ensemble methods for the survival data, and hence we
    develop the survival random forests in the concluding section.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 生存树是决策树在生存数据上的一个重要变体，其分裂标准基于**logrank**检验。自然地，我们将对生存数据的集成方法感兴趣，因此我们在最后一节中开发了生存随机森林。
- en: 'We will cover the following topics in this chapter:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们将涵盖以下主题：
- en: Essential concepts of survival analysis, such as hazard rate, cumulative hazard
    function, and survival function
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 生存分析的基本概念，如风险率、累积风险函数和生存函数
- en: The Nelson-Aalen and Kaplan Meier estimators as respective estimators of the
    cumulative hazard function and the survival function
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nelson-Aalen 和 Kaplan-Meier 估计量分别作为累积风险函数和生存函数的估计量
- en: Logrank tests for the comparison of survival curves
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Logrank 测试用于比较生存曲线
- en: Parametric and semiparametric methods analyzing the impact of independent covariates
    on the hazard rate
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 参数和半参数方法分析独立协变量对风险率的影响
- en: Survival tree based on logrank test
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于Logrank测试的生存树
- en: Random forests as ensemble methods for the survival data
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随机森林作为生存数据的集成方法
- en: Core concepts of survival analysis
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生存分析的核心概念
- en: Survival analysis deals with censored data, and it is very common that parametric
    models are unsuitable for explaining the lifetimes observed in clinical trials.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 生存分析处理截尾数据，在临床试验中观察到寿命时，参数模型通常不适用。
- en: Let *T* denote the survival time, or the time to the event of interest, and
    we will naturally have ![Core concepts of survival analysis](img/00399.jpeg),
    which is a continuous random variable. Suppose that the lifetime cumulative distribution
    is *F* and the associated density function is *f*. We define important concepts
    as required for further analysis. We will explore the concept of *survival function*
    next.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 用 *T* 表示生存时间，或感兴趣的事件发生的时间，我们自然有![生存分析的核心概念](img/00399.jpeg)，这是一个连续随机变量。假设寿命累积分布为
    *F*，相关的密度函数为 *f*。我们将定义进一步分析所需的重要概念。我们将探讨生存函数的概念。
- en: 'Suppose that *T* is the continuous random variable of a lifetime and that the
    associated cumulative distribution function is *F*. The survival function at time
    *t* is the probability the observation is still alive at the time, and it is defined
    by the following:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 假设 *T* 是寿命的连续随机变量，相关的累积分布函数为 *F*。在时间 *t* 的生存函数是观察到的时间点仍然存活的可能性，它由以下定义：
- en: '![Core concepts of survival analysis](img/00400.jpeg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00400.jpeg)'
- en: The survival function can take different forms. Let's go through some examples
    for each of the distributions to get a clearer picture of the difference in survival
    functions.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 生存函数可以采取不同的形式。让我们通过每个分布的例子来了解生存函数之间的差异，以获得更清晰的图像。
- en: '**Exponential Distribution**: Suppose that the lifetime distribution of an
    electronic component follows exponential distribution with rate ![Core concepts
    of survival analysis](img/00401.jpeg). Then, its density function is as follows:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '**指数分布**：假设一个电子元件的寿命分布遵循指数分布，其速率![生存分析的核心概念](img/00401.jpeg)。那么，其密度函数如下：'
- en: '![Core concepts of survival analysis](img/00402.jpeg)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00402.jpeg)'
- en: 'The cumulative distribution function is as follows:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 累积分布函数如下：
- en: '![Core concepts of survival analysis](img/00403.jpeg)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00403.jpeg)'
- en: 'The mean and variance of the exponential distribution are, respectively, ![Core
    concepts of survival analysis](img/00404.jpeg) and ![Core concepts of survival
    analysis](img/00405.jpeg). The survival function of the exponential distribution
    is as follows:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 指数分布的均值和方差分别为![生存分析的核心概念](img/00404.jpeg)和![生存分析的核心概念](img/00405.jpeg)。指数分布的生存函数如下：
- en: '![Core concepts of survival analysis](img/00406.jpeg)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00406.jpeg)'
- en: The mean of exponential distribution is ![Core concepts of survival analysis](img/00407.jpeg).
    The exponential distribution is driven by a single parameter and it also enjoys
    an elegant property, which is known as a memoryless property (see Chapter 6, Tattar,
    et al. (2016)).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 指数分布的均值![生存分析的核心概念](img/00407.jpeg)。指数分布由单个参数驱动，并且它还享有一种优雅的性质，称为无记忆性质（参见第6章，Tattar
    等人，2016年）。
- en: '**Gamma Distribution**: We say that the lifetime random variable follows a
    gamma distribution with rate ![Core concepts of survival analysis](img/00408.jpeg)
    and shape ![Core concepts of survival analysis](img/00409.jpeg), if its probability
    density function `f` is of the following form:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '**伽马分布**：如果寿命随机变量的概率密度函数 `f` 具有以下形式，我们说其遵循速率![生存分析的核心概念](img/00408.jpeg)和形状![生存分析的核心概念](img/00409.jpeg)的伽马分布：'
- en: '![Core concepts of survival analysis](img/00410.jpeg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00410.jpeg)'
- en: The mean and variance of gamma distribution are, respectively, ![Core concepts
    of survival analysis](img/00411.jpeg) and ![Core concepts of survival analysis](img/00412.jpeg).
    A closed form of the cumulative distribution functions, and hence the survival
    function, does not exist.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 均值和方差分别为 ![生存分析的核心概念](img/00411.jpeg) 和 ![生存分析的核心概念](img/00412.jpeg)。累积分布函数的闭式形式，因此生存函数也不存在。
- en: '**Weibull Distribution**: A lifetime random variable is said to follow a Weibull
    distribution with rate ![Core concepts of survival analysis](img/00413.jpeg) and
    shape ![Core concepts of survival analysis](img/00414.jpeg), if its probability
    density function `f` is of the following form:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '**威布尔分布**：如果一个寿命随机变量遵循具有率 ![生存分析的核心概念](img/00413.jpeg) 和形状 ![生存分析的核心概念](img/00414.jpeg)
    的威布尔分布，那么其概率密度函数 `f` 的形式如下：'
- en: '![Core concepts of survival analysis](img/00415.jpeg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00415.jpeg)'
- en: 'The cumulative distribution function of the Weibull distribution is demonstrated
    as follows:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 威布尔分布的累积分布函数如下所示：
- en: '![Core concepts of survival analysis](img/00416.jpeg)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00416.jpeg)'
- en: 'The survival function is as follows:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 生存函数如下：
- en: '![Core concepts of survival analysis](img/00417.jpeg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00417.jpeg)'
- en: Next, we will define the concept of hazard rate, which is also known as the
    instantaneous failure rate.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将定义风险率的概念，它也被称为瞬时故障率。
- en: 'Let *T* denote the lifetime random variable and *F* denote the associated cumulative
    distribution function, then the hazard rate at time `t` is defined as follows:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 用 *T* 表示寿命随机变量，用 *F* 表示相关的累积分布函数，那么在时间 `t` 的风险率定义为以下：
- en: '![Core concepts of survival analysis](img/00418.jpeg)![Core concepts of survival
    analysis](img/00419.jpeg)![Core concepts of survival analysis](img/00420.jpeg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00418.jpeg)![生存分析的核心概念](img/00419.jpeg)![生存分析的核心概念](img/00420.jpeg)'
- en: The problem of estimating the hazard rate is as difficult as that of the density
    function, and hence the cumulative function concept will be useful.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 估计风险率的问题与密度函数的问题一样困难，因此累积函数的概念将是有用的。
- en: 'Let *T* denote the lifetime random variable and ![Core concepts of survival
    analysis](img/00421.jpeg) be the associated hazard rate, then the cumulative hazard
    function is defined using the following:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 用 *T* 表示寿命随机变量，![生存分析的核心概念](img/00421.jpeg) 表示相关风险率，那么累积风险函数的定义如下：
- en: '![Core concepts of survival analysis](img/00422.jpeg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00422.jpeg)'
- en: 'The following relationship exists between these three quantities:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 这三个量之间存在以下关系：
- en: '![Core concepts of survival analysis](img/00423.jpeg)![Core concepts of survival
    analysis](img/00424.jpeg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00423.jpeg)![生存分析的核心概念](img/00424.jpeg)'
- en: 'The expected value is related to the survival function as follows:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 期望值与生存函数的关系如下：
- en: '![Core concepts of survival analysis](img/00425.jpeg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00425.jpeg)'
- en: 'In the next R program, we will visualize the three survival quantities for
    the three probability distributions. First, we will set up a graphical device
    for nine plots with the par and `mfrow` functions. The program is explained for
    the exponential distribution. Consider the time period 0-100 and create a numeric
    object `Time` in the program. We will begin with the computation of the values
    of the density functions using the `dexp` function for the Time object. This means
    that `dexp(Time)` will calculate the value of the density function *f(t)* for
    each point between 0–100\. Since the survival function is related to the cumulative
    distribution by ![Core concepts of survival analysis](img/00426.jpeg) and `pexp`
    gives us the values of *F* at the time point *t*, the survival function for the
    exponential distribution is computed as *1-pexp()*. The hazard rate, density function,
    and survival function are related by ![Core concepts of survival analysis](img/00427.jpeg)
    and can be easily obtained. The cumulative hazard function is obtained by using
    the values of the survival function and the relationship as follows:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个R程序中，我们将可视化三个概率分布的三个生存量。首先，我们将使用`par`和`mfrow`函数设置九个图的图形设备。程序以指数分布为例进行解释。考虑时间区间0-100，并在程序中创建一个名为`Time`的数值对象。我们将从使用`dexp`函数计算`Time`对象的密度函数值开始。这意味着`dexp(Time)`将为0-100之间的每个点计算密度函数*f(t)*的值。由于生存函数与累积分布函数通过![生存分析的核心概念](img/00426.jpeg)相关联，而`pexp`给出了时间点*t*处的*F*值，因此指数分布的生存函数计算为*1-pexp()*。危险率、密度函数和生存函数通过![生存分析的核心概念](img/00427.jpeg)相关联，并且可以轻松获得。通过使用生存函数的值和以下关系，可以获得累积危险函数：
- en: '![Core concepts of survival analysis](img/00428.jpeg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00428.jpeg)'
- en: 'The program is then repeated for the gamma and Weibull distribution with changes
    in the appropriate specification of the parameters, as shown in the following
    code:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 程序随后将重复用于伽马分布和威布尔分布，并对适当的参数进行更改，如下面的代码所示：
- en: '[PRE0]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![Core concepts of survival analysis](img/00429.jpeg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00429.jpeg)'
- en: 'Figure 1: Hazard rate, Cumulative hazard function, and Survival function for
    Exponential, Gamma, and Weibull distributions'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 图1：指数、伽马和威布尔分布的危脸率、累积危脸函数和生存函数
- en: Repeat the preceding program for different parameter values and prepare a summary
    of your observations for the change in the hazard function, cumulative hazard
    function, and the survival function. Summarize your observations separately for
    the three distributions of exponential, gamma, and Weibull.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 重复前面的程序，使用不同的参数值，并为危险函数、累积危险函数和生存函数的变化准备观察总结。分别总结指数、伽马和威布尔分布的观察结果。
- en: 'Now, we need to see how well the model fits to the `pbc` dataset. Here, we
    will fit the exponential, gamma, and Weibull distributions to the lifetimes of
    interest in the `pbc` dataset. Note that, since we have censored data, the incomplete
    observations can''t simply be thrown away, as 257 out of 418 are incomplete observations.
    Though we can''t go into the mathematics of the maximum likelihood estimation
    for survival data, it is important to note here that the contribution of a complete
    observation to the likelihood is *f(t)* and if it is incomplete/censored, it is
    *S(t)*. Consequently, it is important for the software to know which observation
    is complete and which is incomplete. Here we will use the `Surv` function from
    the `survival` package to specify this, and then use the `flexsurvreg` function
    from the `flexsurv` package to fit an appropriate lifetime distribution. The option
    of `dist` helps set up the appropriate distributions, as can be seen in the following
    program:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要查看模型与`pbc`数据集的拟合程度。在这里，我们将指数、伽马和威布尔分布拟合到`pbc`数据集中感兴趣的生命周期。请注意，由于我们有截尾数据，不能简单地丢弃不完整的观察值，因为418个中有257个是不完整的观察值。虽然我们不能深入探讨生存数据的最大似然估计的数学原理，但在此处重要的是要注意，完整观察对似然函数的贡献是*f(t)*，如果它是不完整/截尾的，则是*S(t)*。因此，对于软件来说，知道哪个观察值是完整的，哪个是不完整的非常重要。在这里，我们将使用`survival`包中的`Surv`函数来指定这一点，然后使用`flexsurv`包中的`flexsurvreg`函数来拟合适当的生命周期分布。`dist`选项有助于设置适当的分布，如下面的程序所示：
- en: '[PRE1]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The resulting diagram is given here:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 结果图如下所示：
- en: '![Core concepts of survival analysis](img/00430.jpeg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![生存分析的核心概念](img/00430.jpeg)'
- en: 'Figure 2: Fitting exponential, gamma, and Weibull distributions for censored
    data'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图2：对截尾数据进行指数、伽马和威布尔分布的拟合
- en: The AIC value for the fitted exponential model is 3065.187, for the fitted gamma
    model it is 3066.147, and for Weibull it is 3066.035\. The lower the criteria,
    the better. Consequently, the exponential is the best fit according to the AIC
    criteria. This is then followed by the Weibull and gamma distributions. The exponential
    distribution with a single parameter is a better fit here than the more complex
    models of gamma and Weibull.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 拟合的指数模型的AIC值是3065.187，拟合的伽马模型的AIC值是3066.147，而韦伯尔分布的AIC值是3066.035。标准越低越好。因此，根据AIC标准，指数模型是最好的拟合。然后是韦伯尔分布和伽马分布。在这里，单参数的指数分布比更复杂的伽马和韦伯尔模型拟合得更好。
- en: Some explanation of the R program is in order now. The `pbc` dataset is loaded
    with `survival::pbc` since the R package `randomForestSRC` also has a dataset
    with the same name and it is a slightly different version. Consequently, the `survival::pbc`
    code ensures that we continue to load the `pbc` dataset as we did in earlier instances.
    The event of interest for us is indicated by `status==2` and `Surv(pbc$time,pbc$status==2)`,
    which creates a survival object that has complete observations mentioned in the
    numeric object. If the `status` is anything other than `2`, the observation is
    censored and this is indicated by the number followed by the `+` sign. The `Surv(time,status==2)~1`
    code creates the necessary formula, which is useful for applying survival functions.
    The `dist="exponential"` option ensures that exponential distribution is fitted
    on the survival data. When the fitted model `pbc_exp` is run on the console, we
    get a summary of the fitted model and it returns the estimates of the parameters
    of the model, the 95% confidence interval, and the standard error of the parameter's
    estimate. We also get the count of complete and censored observations, the total
    time at risk for all patients, the likelihood function value, and the AIC. Note
    how the degrees of freedom vary across the three fitted distributions.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 现在需要对R程序进行一些解释。`pbc`数据集通过`survival::pbc`加载，因为R包`randomForestSRC`也有一个同名数据集，它是稍有不同的版本。因此，`survival::pbc`代码确保我们继续加载`pbc`数据集，就像我们在早期实例中所做的那样。对我们来说，感兴趣的事件由`status==2`和`Surv(pbc$time,pbc$status==2)`指示，它创建了一个包含在数值对象中的完整观察值的生存对象。如果`status`不是`2`，则观察值是删失的，这由跟在`+`号后面的数字表示。`Surv(time,status==2)~1`代码创建必要的公式，这对于应用生存函数很有用。`dist="exponential"`选项确保在生存数据上拟合指数分布。当在控制台上运行拟合模型`pbc_exp`时，我们得到拟合模型的摘要，并返回模型参数的估计值、95%置信区间和参数估计的标准误差。我们还得到完整和删失观察值的数量、所有患者的总风险时间、似然函数值和AIC。注意三个拟合分布的自由度是如何变化的。
- en: The parametric models detailed here give an idea of the survival concepts. When
    we don't have enough evidence to construct a parametric model, we resort to nonparametric
    and semiparametric models for carrying out the statistical inference. In the following
    section, we will continue our analysis of the `pbc` data.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这里详细描述的参数模型给出了生存概念的一个概念。当我们没有足够的证据来构建一个参数模型时，我们求助于非参数和半参数模型来进行统计推断。在下一节中，我们将继续分析`pbc`数据。
- en: Nonparametric inference
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 非参数推断
- en: 'Survival data is subject to censoring and we need to introduce a new quantity
    to capture this information. Suppose that we have a *n* IID random sample of lifetime
    random variables in ![Nonparametric inference](img/00431.jpeg), and we know that
    the event of interest might have occurred or that it will occur sometime in the
    future. The additional information is captured by the Kronecker indicator variable,
    ![Nonparametric inference](img/00432.jpeg):'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 生存数据会受到删失的影响，我们需要引入一个新的量来捕捉这个信息。假设我们有一个来自![非参数推断](img/00431.jpeg)的独立同分布的寿命随机变量的*n*样本，并且我们知道感兴趣的事件可能已经发生，或者它将在未来的某个时间发生。通过克罗内克指示变量![非参数推断](img/00432.jpeg)捕捉了额外的信息：
- en: '![Nonparametric inference](img/00433.jpeg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![非参数推断](img/00433.jpeg)'
- en: 'Thus, we have n pairs of random observations in the *Ts* and ![Nonparametric
    inference](img/00434.jpeg)s, ![Nonparametric inference](img/00435.jpeg). To obtain
    the estimates of the cumulative hazard function and the survival function, we
    will need an additional notation. Let ![Nonparametric inference](img/00436.jpeg)
    denote the unique times of Ts at which the event of interest is observed. Next,
    we denote ![Nonparametric inference](img/00437.jpeg) to represent the number of
    observations that are at risk just before times ![Nonparametric inference](img/00438.jpeg)
    and ![Nonparametric inference](img/00439.jpeg) the number of events that occur
    at that time. Using these quantities, we now propose to estimate the cumulative
    hazard function using the following:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们在 *Ts* 和 ![非参数推断](img/00434.jpeg)s，![非参数推断](img/00435.jpeg) 中有 n 对随机观测值。为了获得累积风险函数和生存函数的估计值，我们需要额外的符号。让
    ![非参数推断](img/00436.jpeg) 表示 Ts 中事件发生时的唯一时间点。接下来，我们用 ![非参数推断](img/00437.jpeg) 表示在时间
    ![非参数推断](img/00438.jpeg) 和 ![非参数推断](img/00439.jpeg) 之前处于风险中的观测值数量，而 ![非参数推断](img/00439.jpeg)
    表示在该时间发生的事件数量。使用这些量，我们现在提出使用以下方法来估计累积风险函数：
- en: '![Nonparametric inference](img/00440.jpeg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![非参数推断](img/00440.jpeg)'
- en: 'The estimator ![Nonparametric inference](img/00441.jpeg) is the famous Nelson-Aalen
    estimator. The Nelson-Aalen estimator enjoys statistical properties including
    the fact that (i) it is the nonparametric maximum likelihood estimator for the
    cumulative hazard function, and (ii) it follows an asymptotically normal distribution.
    An estimator of the survival function is given by the following:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 估计量 ![非参数推断](img/00441.jpeg) 是著名的 Nelson-Aalen 估计量。Nelson-Aalen 估计量具有统计性质，包括（i）它是累积风险函数的非参数最大似然估计量，以及（ii）它遵循渐近正态分布。生存函数的估计量如下：
- en: '![Nonparametric inference](img/00442.jpeg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![非参数推断](img/00442.jpeg)'
- en: The estimator ![Nonparametric inference](img/00443.jpeg) is the well-known Kaplan-Meier
    estimator. The properties of the Nelson-Aalen estimator get carried over to the
    Kaplan-Meier estimator by an application of the functional-delta theorem. It should
    be noted that the Kaplan-Meier estimator is again the nonparametric maximum likelihood
    estimator and asymptotically, it follows the normal distribution. We will now
    look at how to obtain the estimates for a given dataset using R software.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 估计量 ![非参数推断](img/00443.jpeg) 是著名的 Kaplan-Meier 估计量。通过应用函数-Δ定理，Nelson-Aalen 估计量的性质被传递到
    Kaplan-Meier 估计量。需要注意的是，Kaplan-Meier 估计量再次是非参数最大似然估计量，并且渐近地遵循正态分布。我们现在将探讨如何使用
    R 软件获取给定数据集的估计值。
- en: 'We have already created the survival object using the `Surv(pbc$time, pbc$status==2)`
    code. Now, applying the `survfit` function on the survival object, we set up the
    Kaplan-Meier estimator in the `pbc_sf survfit` object:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经使用 `Surv(pbc$time, pbc$status==2)` 代码创建了生存对象。现在，在生存对象上应用 `survfit` 函数，我们在
    `pbc_sf survfit` 对象中设置了 Kaplan-Meier 估计器：
- en: '[PRE2]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The output shows that we have `418` observations. Out of these, `161` experience
    the event of interest. We would like to obtain the survival function at different
    time points of interest. The median survival time is shown as `3395` and the confidence
    interval for this point estimate is `3090` and `3853`. However, if you find the
    median of the overall times, the median time for complete observations, and for
    censored observations, none of that will come closer to the displayed value of
    `3395`. A quick code reveals the results as follows:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 输出结果显示我们共有 `418` 个观测值。其中，`161` 个经历了感兴趣的事件。我们希望获取不同时间点的生存函数。中位生存时间为 `3395`，该点估计值的置信区间为
    `3090` 至 `3853`。然而，如果你找到整体时间的平均值，完整观测值的平均时间，以及截尾观测值的平均时间，这些值都不会接近显示的 `3395` 值。一段快速代码显示了以下结果：
- en: '[PRE3]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: You may ask yourself, Why is there so much of a difference between the estimated
    median survival time and these medians? The answer will become clear soon enough.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会问自己，为什么估计的中位生存时间与这些中位数之间有如此大的差异？答案很快就会变得清晰。
- en: 'The `summary` function will be used to obtain that answer. For the ten deciles
    of the observed time, inclusive of censored times, we will obtain the Kaplan-Meier
    estimates and the associated 95% confidence interval, which is based on the variance
    estimate, which in turn is based on Greenwood''s formula:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 `summary` 函数来获取这个答案。对于观察到的十个时间分位数，包括截尾时间，我们将获得 Kaplan-Meier 估计值及其相关的 95%
    置信区间，该置信区间基于方差估计，而方差估计又基于 Greenwood 公式：
- en: '[PRE4]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'We have now obtained the Kaplan-Meier estimates at each of the decile time
    points, the standard error, and the confidence interval at each of the points.
    Using the `plot` function, we will now visualize the fitted Kaplan-Meier estimator
    for the `pbc` dataset:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经得到了每个十分位时间点的Kaplan-Meier估计值、每个点的标准误差和置信区间。使用`plot`函数，我们现在将可视化`pbc`数据集的拟合Kaplan-Meier估计值：
- en: '[PRE5]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![Nonparametric inference](img/00444.jpeg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![非参数推断](img/00444.jpeg)'
- en: 'Figure 3: Kaplan-Meier estimator for the PBC dataset'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图3：PBC数据集的Kaplan-Meier估计值
- en: Now, if you look at the time at which the survival time becomes nearly 0.5,
    the earlier answer of median survival time being 3395 becomes clear enough. Next,
    we look at the cumulative hazard function.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果你观察生存时间接近0.5的时间点，中位生存时间3395的早期答案就足够清晰了。接下来，我们来看累积风险函数。
- en: 'To obtain the cumulative hazard function, we will apply the `coxph` function
    on the survival object and use the `basehaz` function to get the baseline cumulative
    hazard function, as shown in the following code:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 要获得累积风险函数，我们将对生存对象应用`coxph`函数，并使用`basehaz`函数获取基线累积风险函数，如下面的代码所示：
- en: '[PRE6]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'We will use the following code to create a visual display of the Nelson-Aalen
    estimator:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用以下代码创建Nelson-Aalen估计值的可视化表示：
- en: '[PRE7]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The following graph illustrates the Nelson-Aalen estimator:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的图表说明了Nelson-Aalen估计值：
- en: '![Nonparametric inference](img/00445.jpeg)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![非参数推断](img/00445.jpeg)'
- en: 'Figure 4: The Nelson-Aalen estimator for the cumulative hazard function'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图4：累积风险函数的Nelson-Aalen估计值
- en: 'Note that one might be tempted to use the ![Nonparametric inference](img/00446.jpeg)
    relationship to obtain the Kaplan-Meier estimator, or vice versa. Let us check
    it out using the following code:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，有人可能会倾向于使用![非参数推断](img/00446.jpeg)关系来获得Kaplan-Meier估计值，或者反之亦然。让我们使用以下代码来检查一下：
- en: '[PRE8]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Everything seems to be right here, so let''s check it in its entirety:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 这里似乎一切正常，所以让我们全面检查一下：
- en: '[PRE9]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: After a certain length of time, the estimates will differ vastly, and hence
    we compute these two quantities separately. Next, we will look at how to carry
    out statistical tests to compare the equality of survival curves.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 经过一段时间后，估计值会有很大差异，因此我们分别计算这两个量。接下来，我们将探讨如何进行统计检验以比较生存曲线的相等性。
- en: As noted previously, we are feeding a formula to the `survfit` function. It
    appeared as an extra specification `'~1'` in the `Surv` formula. As the formula
    is essential for further analysis of survival data, we can now make good use of
    this framework. If we replace 1 with a categorical variable such as sex, then
    we will then obtain survival curves for each level of the categorical variable.
    For the `pbc` data, we will plot the survival curves. The Kaplan-Meier estimates
    for males and females separately.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，我们将公式输入到`survfit`函数中。它出现在`Surv`公式中的额外指定`'~1'`。由于公式对于生存数据的进一步分析至关重要，我们现在可以很好地利用这个框架。如果我们用1替换为一个分类变量，如性别，那么我们将为分类变量的每个水平获得生存曲线。对于`pbc`数据，我们将绘制生存曲线。分别对男性和女性的Kaplan-Meier估计值进行绘图。
- en: '[PRE10]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![Nonparametric inference](img/00447.jpeg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![非参数推断](img/00447.jpeg)'
- en: 'Figure 5: Gender-wise comparison of the survival curves for the PBC data'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图5：PBC数据的性别生存曲线比较
- en: 'The survival curves (indicated by the blue and red continuous lines) clearly
    show differences and we need to evaluate whether the observed difference is statistically
    significant. To that end, we apply the `survdiff` function and check if the difference
    is significant, as shown in the following code:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 生存曲线（用蓝色和红色连续线表示）清楚地显示了差异，我们需要评估观察到的差异是否具有统计学意义。为此，我们应用`survdiff`函数并检查差异是否显著，如下面的代码所示：
- en: '[PRE11]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The p-value is `0.0845`, and hence if the chosen significance is 95%, we conclude
    that the difference is insignificant.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: p值为`0.0845`，因此如果选择的显著性水平是95%，我们得出结论，差异不显著。
- en: 'A note to the reader: the significance level is pre-determined. If you have
    fixed it at 95% before carrying out the analysis and then look at the p-value
    and find that it is between 0.05 and 0.10, don''t change the level. Stick to what
    was agreed on earlier.'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 读者注意：显著性水平是预先确定的。如果你在进行分析之前将其固定在95%，然后查看p值发现它在0.05和0.10之间，不要改变水平。坚持之前达成的协议。
- en: In the analysis thus far, we have looked at parametric and nonparametric methods,
    and now we need to develop a larger framework. The impact of covariates needs
    to be evaluated clearly, and we will explore this topic in the following section.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在到目前为止的分析中，我们考虑了参数和非参数方法，现在我们需要开发一个更大的框架。需要明确评估协变量的影响，我们将在下一节探讨这个主题。
- en: Regression models – parametric and Cox proportional hazards models
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 回归模型 – 参数和Cox比例风险模型
- en: 'You may recall that the survival data consists of complete as well as censored
    observations, and we saw that the lifetimes look like 400, 4500+, 1012, 1925,
    1504+, … for the `pbc` dataset. Although the lifetimes are continuous random variables,
    a regression model of the form ![Regression models – parametric and Cox proportional
    hazards models](img/00448.jpeg) will not be appropriate here. In fact, there were
    many attempts to correct and improvise on models of this form in the 1970s, and
    most often the results were detrimental. We will define a generic **hazards regression
    model** as follows:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能还记得，生存数据包括完整的以及截尾的观测值，我们看到了对于 `pbc` 数据集，寿命看起来像是 400，4500+，1012，1925，1504+，……。尽管寿命是连续的随机变量，但形式为
    ![回归模型 – 参数和Cox比例风险模型](img/00448.jpeg) 的回归模型在这里并不合适。事实上，在 20 世纪 70 年代，有许多尝试修正和改进这种形式的模型，而且结果往往是有害的。我们将一个通用的**风险回归模型**定义为以下形式：
- en: '![Regression models – parametric and Cox proportional hazards models](img/00449.jpeg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![回归模型 – 参数和Cox比例风险模型](img/00449.jpeg)'
- en: 'Here, *t* is the lifetime, ![Regression models – parametric and Cox proportional
    hazards models](img/00450.jpeg) is the lifetime indicator, ![Regression models
    – parametric and Cox proportional hazards models](img/00451.jpeg) is the covariate
    vector, ![Regression models – parametric and Cox proportional hazards models](img/00452.jpeg)
    is the vector of regression coefficients, and ![Regression models – parametric
    and Cox proportional hazards models](img/00453.jpeg) is the baseline hazard rate.
    A relative risks model that is of specific interest is the following:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*t* 是寿命，![回归模型 – 参数和Cox比例风险模型](img/00450.jpeg) 是寿命指标，![回归模型 – 参数和Cox比例风险模型](img/00451.jpeg)
    是协变量向量，![回归模型 – 参数和Cox比例风险模型](img/00452.jpeg) 是回归系数向量，![回归模型 – 参数和Cox比例风险模型](img/00453.jpeg)
    是基线风险率。一个特别感兴趣的相对风险模型如下：
- en: '![Regression models – parametric and Cox proportional hazards models](img/00454.jpeg)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![回归模型 – 参数和Cox比例风险模型](img/00454.jpeg)'
- en: 'We will focus solely on this class of model. First, the parametric hazards
    regression is considered. This means that we will specify the hazard rate ![Regression
    models – parametric and Cox proportional hazards models](img/00455.jpeg) through
    a parametric model, for example, through exponential distribution. But what does
    this mean? It means that the baseline hazard function is of the following form:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将专注于这一类模型。首先，考虑参数风险回归。这意味着我们将通过参数模型指定风险率 ![回归模型 – 参数和Cox比例风险模型](img/00455.jpeg)，例如，通过指数分布。但这意味着什么呢？这意味着基线风险函数具有以下形式：
- en: '![Regression models – parametric and Cox proportional hazards models](img/00456.jpeg)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![回归模型 – 参数和Cox比例风险模型](img/00456.jpeg)'
- en: 'Consequently, the hazards regression model is as follows:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，风险回归模型如下：
- en: '![Regression models – parametric and Cox proportional hazards models](img/00457.jpeg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![回归模型 – 参数和Cox比例风险模型](img/00457.jpeg)'
- en: 'The estimation problem is then to find ![Regression models – parametric and
    Cox proportional hazards models](img/00458.jpeg) and ![Regression models – parametric
    and Cox proportional hazards models](img/00459.jpeg). The R function `survreg`
    from the `flexsurv` package will be useful to fit the parametric hazards regression
    model. It is demonstrated as continuity on the `pbc` dataset. The `survival` formula
    will be extended to include all the covariates in the model, as shown in the following
    code:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 然后估计问题就是找到 ![回归模型 – 参数和Cox比例风险模型](img/00458.jpeg) 和 ![回归模型 – 参数和Cox比例风险模型](img/00459.jpeg)。`flexsurv`
    包中的 R 函数 `survreg` 将有助于拟合参数风险回归模型。它将在 `pbc` 数据集上展示连续性。`survival` 公式将被扩展以包括模型中的所有协变量，如下面的代码所示：
- en: '[PRE12]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Here, the convergence occurs after five iterations. The p-value is nearly equal
    to zero, which implies that the fitted model is significant. However, not all
    the p-values associated with the covariates indicate significance. We will use
    the following code to find it:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，迭代五次后收敛。p值几乎等于零，这意味着拟合的模型是显著的。然而，并非所有与协变量相关的p值都表明显著性。我们将使用以下代码来查找：
- en: '[PRE13]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The AIC value is also very high, and we try to see if this can be improved
    on. Hence, we slap the `step` function on the fitted exponential hazards regression
    model and eliminate the covariates that are insignificant, as shown in the following
    code:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: AIC值也非常高，我们试图看看是否可以改进。因此，我们将`step`函数应用于拟合的指数风险回归模型，并消除不显著的协变量，如下面的代码所示：
- en: '[PRE14]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: We see here that all the covariates in the current model are significant, except
    the `trig` and `platelet` variables. The AIC value has also decreased drastically.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里看到，当前模型中的所有协变量都是显著的，除了`trig`和`platelet`变量。AIC值也急剧下降。
- en: 'Parametric models are often not acceptable in life sciences. A flexible framework
    for ![Regression models – parametric and Cox proportional hazards models](img/00460.jpeg)
    is the famous Cox proportional hazards model. It is a semi-parametric regression
    model in that the baseline hazard function ![Regression models – parametric and
    Cox proportional hazards models](img/00461.jpeg) is completely unspecified. Cox
    (1972) proposed this model, which is one of the most important models in statistics.
    The only requirement of the baseline hazard function ![Regression models – parametric
    and Cox proportional hazards models](img/00462.jpeg) is that it must be non-negative
    and the associated probability distribution with it must be a *proper* probability
    distribution. In this model, the regression coefficient vector ![Regression models
    – parametric and Cox proportional hazards models](img/00463.jpeg) is estimated
    by treating the baseline hazard function as a nuisance factor. Its inference is
    based on the important notion of partial likelihood function; see Cox (1975) for
    complete details. Here, we will only specify the form of the Cox proportional
    hazards model and refer the interested reader to Kalbfleisch and Prentice (2002):'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在生命科学中，参数模型通常不可接受。![回归模型 – 参数和Cox比例风险模型](img/00460.jpeg)的灵活框架是著名的Cox比例风险模型。它是一个半参数回归模型，因为基线风险函数![回归模型
    – 参数和Cox比例风险模型](img/00461.jpeg)是完全未指定的。Cox（1972）提出了这个模型，这是统计学中最重要的模型之一。基线风险函数![回归模型
    – 参数和Cox比例风险模型](img/00462.jpeg)的唯一要求是它必须是非负的，并且与之相关的概率分布必须是*合适的*概率分布。在这个模型中，回归系数向量![回归模型
    – 参数和Cox比例风险模型](img/00463.jpeg)通过将基线风险函数视为一个干扰因素来估计。其推断基于部分似然函数的重要概念；有关完整细节，请参阅Cox（1975）。在这里，我们只指定Cox比例风险模型的形式，并将感兴趣的读者指引到Kalbfleisch和Prentice（2002）：
- en: '![Regression models – parametric and Cox proportional hazards models](img/00464.jpeg)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![回归模型 – 参数和Cox比例风险模型](img/00464.jpeg)'
- en: 'We will use the `coxph` function from the `survival` package to fit the proportional
    hazards regression model. For some technical reason, we will have to omit all
    rows from the `pbc` dataset which have missing values, and the remaining steps
    parallel the fitting of the exponential hazards regression model:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用`survival`包中的`coxph`函数来拟合比例风险回归模型。由于某些技术原因，我们必须从`pbc`数据集中省略所有包含缺失值的行，并且剩余步骤与指数风险回归模型的拟合平行：
- en: '[PRE15]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Since we find that a lot of variables are insignificant, we will attempt to
    improve on it by using the `step` function and then calculating the improved AIC
    value, as shown in the following code:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们发现许多变量不显著，我们将尝试通过使用`step`函数并计算改进的AIC值来改进它，如下面的代码所示：
- en: '[PRE16]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: We can now see that almost all the variables in the `pbc_coxph_eff` model are
    significant. The AIC value has also decreased from its earlier value.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以看到，`pbc_coxph_eff`模型中的几乎所有变量都是显著的。AIC值也与其早期值相比有所下降。
- en: In most survival data analyses, the purpose is to find the effective covariates
    and their impact on the hazard rate. Accuracy measures, such as AUC with classification
    problems, do not exist in the context of survival data. On similar (though important)
    lines, the prediction of the lifetime for a given choice of covariates might not
    again be of importance. In [Chapter 2](part0018_split_000.html#H5A41-2006c10fab20488594398dc4871637ee
    "Chapter 2. Bootstrapping"), *Bootstrapping*, we looked at the application of
    pseudo values and the jackknife methods that provided ease of interpretation.
    We will look at a different approach in the following section.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数生存数据分析中，目的是找到有效的协变量及其对风险率的影响。在生存数据的情况下，不存在像AUC这样的分类问题准确度度量。在类似（尽管重要）的方面，对于给定协变量选择的寿命预测可能不再重要。在[第2章](part0018_split_000.html#H5A41-2006c10fab20488594398dc4871637ee
    "第2章。Bootstrapping")中，我们探讨了伪值方法和Jackknife方法的应用，这些方法提供了易于解释的便利。在下一节中，我们将探讨不同的方法。
- en: Survival tree
  id: totrans-123
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生存树
- en: The parametric hazards regression model is sometimes seen as a restrictive class
    of models by practitioners, and the Cox proportional hazards regression is sometimes
    preferred over its parametric counterpart. Compared with the parametric models,
    the interpretation is sometimes lost, and the regular practitioner finds it difficult
    to connect with the hazards regression model. Of course, an alternative is to
    build a survival tree over the pseudo observations. Such an attempt can be seen
    in Tattar's (2016) unpublished paper. Gordon and Olshen (1985) made the first
    attempt to build a survival tree and many scientists have continued constructing
    it. LeBlanc and Crowley (1992) are among the most important contributors to set
    up a survival tree. Zhang and Singer (2010) have also given a systematic development
    of related methods, and chapters 7-10 of their book deal with survival trees.
    The basic premise remains the same, and we need good splitting criteria in order
    to create the survival tree.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 参数风险回归模型有时被从业者视为一种限制性模型类别，Cox比例风险回归有时比其参数对应物更受欢迎。与参数模型相比，解释有时会丢失，常规从业者发现很难与风险回归模型联系起来。当然，一个替代方案是在伪观察值上构建生存树。这种尝试可以在Tattar（2016）未发表的论文中看到。Gordon和Olshen（1985）首次尝试构建生存树，许多科学家继续构建它。LeBlanc和Crowley（1992）是建立生存树的重要贡献者之一。Zhang和Singer（2010）也对相关方法进行了系统发展，他们书中第7-10章讨论了生存树。基本前提保持不变，我们需要好的分割标准来创建生存树。
- en: LeBlanc and Crowley proposed the splitting criteria based on the node deviance
    measure between a saturated model log-likelihood and the maximum log-likelihood,
    and then the unknown full likelihood is approximated by replacing the baseline
    cumulative hazard function as estimated by the Nelson-Aalen estimator. As suggested
    by Hamad et al. (2011), note that the advantage of this method is that any software
    that can carry out the implementation of Poisson trees would be able to create
    the survival tree. This approach has been exploited in the `rpart` R package created
    by Therneau and Atkinson (2017). The terminal nodes of the survival tree can be
    summarized by the Kaplan-Meier survival function for the observations belonging
    in the node.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: LeBlanc和Crowley提出了基于饱和模型对数似然与最大对数似然之间的节点偏差度量的分割标准，然后通过用Nelson-Aalen估计器估计的基线累积风险函数替换，来近似未知的完整似然。正如Hamad等人（2011）所建议的，请注意，这种方法的优势在于任何能够执行泊松树实现的软件都能够创建生存树。这种方法在Therneau和Atkinson（2017）创建的`rpart`R包中被利用。生存树的终端节点可以通过属于该节点的观察值的Kaplan-Meier生存函数来总结。
- en: 'We will now set up the survival tree for the `pbc` dataset using the `rpart`
    library:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将使用`rpart`库为`pbc`数据集设置生存树：
- en: '[PRE17]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: A text display of the survival tree is displayed by running `pbc_stree` at the
    console. The asterisk (`*`) at the end of the `yval` for a node indicates censorship.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在控制台运行`pbc_stree`，显示生存树的文本表示。节点`yval`末尾的星号（`*`）表示删失。
- en: 'We will now look at the `cptable` and variable importance associated with the
    survival tree, as shown in the following program:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将查看与生存树相关的`cptable`和变量重要性，如下程序所示：
- en: '[PRE18]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The variable importance shows that the `bili` variable is the most important,
    followed by `protime` and `age`. We conclude this section with a visual depiction
    of the survival tree, using the following code:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 变量重要性显示，`bili`变量是最重要的，其次是`protime`和`age`。我们用以下代码的视觉表示来结束本节：
- en: '[PRE19]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![Survival tree](img/00465.jpeg)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![生存树](img/00465.jpeg)'
- en: 'Figure 6: Survival tree for the PBC dataset'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图6：PBC数据集的生存树
- en: As with the problem of overfitting with a single tree, we need to look at an
    important alternative method of ensembles of survival trees.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 就像单个树模型中存在的过拟合问题一样，我们需要考虑生存树集成的重要替代方法。
- en: Ensemble survival models
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 集成生存模型
- en: 'The random forest package `randomForestSRC` will continue to be useful for
    creating the random forests associated with the survival data. In fact, the `S`
    of `SRC` in the package name stands for survival! The usage of the `rfsrc` function
    remains the same as in previous chapters, and we will now give it a `Surv` object,
    as shown in the following code:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 随机森林包`randomForestSRC`将继续用于创建与生存数据相关的随机森林。实际上，包名中的`SRC`的`S`代表生存！`rfsrc`函数的使用方法与前面章节相同，现在我们将提供一个`Surv`对象，如下面的代码所示：
- en: '[PRE20]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'We will find some of the basic settings that have gone into setting up this
    random forest:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将找到设置此随机森林的一些基本设置：
- en: '[PRE21]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Thus, the splitting criteria is based on the log-rank test, the minimum number
    of observations in a terminal node is six, and the number of variables considered
    at random for each split is five.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，分裂标准基于log-rank检验，终端节点中的最小观测数是六个，每个分裂考虑的变量数是五个。
- en: 'Next, we will find the variable importance for both events and apply the function
    `var.select` as we have done in earlier chapters. We will then show a part of
    the iteration run using the following code:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将找到两个事件的变量重要性，并应用我们在前面章节中使用的`var.select`函数。然后，我们将展示迭代运行的一部分，如下面的代码所示：
- en: '[PRE22]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Next, the error rate plot as the number of trees increases will be depicted
    using the following code:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，随着树的数量增加，错误率图将使用以下代码进行展示：
- en: '[PRE23]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![Ensemble survival models](img/00466.jpeg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![集成生存模型](img/00466.jpeg)'
- en: 'Figure 7: Random forest error rates for the two events'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 图7：两个事件的随机森林错误率
- en: Consequently, we have now seen the construction and setup of random forests
    for the survival data.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们现在已经看到了生存数据的随机森林构建和设置。
- en: Summary
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Survival data is different to typical regression data, and the incomplete observations
    pose a challenge. Since the data structure is completely different, we need specialized
    techniques to handle the incomplete observations and to that end, we introduced
    core survival concepts, such as hazard rate and survival function. We then introduced
    parametric lifetime models, which gives us a brief peek at how the lifetime distribution
    should look. We even fitted these lifetime distributions into the pbc dataset.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 生存数据与典型的回归数据不同，不完整的观测值构成了挑战。由于数据结构完全不同，我们需要专门的技巧来处理不完整的观测值，为此，我们介绍了核心生存概念，如风险率和生存函数。然后，我们介绍了参数生存模型，这让我们对寿命分布的形状有一个大致的了解。我们甚至将这些寿命分布拟合到pbc数据集中。
- en: We also learned that the parametric setup might be very restrictive, and hence
    considered the nonparametric methods of the estimation of survival quantities.
    We also demonstrated the utility of the Nelson-Aalen estimator, the Kaplan-Meier
    survival function, and the log-rank test. The parametric hazards regression model
    was backed with the Cox proportional hazards regression model and applied to the
    pbc dataset. The logrank test can also help in the splitting criteria, and it
    has also been seen as the criteria for the random forest. Survival trees were
    demonstrated in the earlier section.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还了解到参数设置可能非常严格，因此考虑了生存量估计的非参数方法。我们还展示了Nelson-Aalen估计量、Kaplan-Meier生存函数和对数秩检验的实用性。参数风险回归模型以Cox比例风险回归模型为支持，并应用于pbc数据集。logrank检验也可以帮助确定分裂标准，它也被视为随机森林的标准。生存树在前面章节中已展示。
- en: 'In the next chapter, we will look at another kind of data structure: time series
    data. The reader does not need to be familiar with time series analysis in order
    to follow the ensemble methods applied in it.'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨另一种数据结构：时间序列数据。读者不需要熟悉时间序列分析，就可以理解其中应用的集成方法。

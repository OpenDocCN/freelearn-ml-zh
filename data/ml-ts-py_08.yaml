- en: '9'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '9'
- en: Probabilistic Models for Time-Series
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间序列的概率模型
- en: Probability is a measure of how likely something is to occur. In sales forecasting,
    an estimate of uncertainty is crucial because these forecasts, providing insights
    into cash flow, margin, and revenue, drive business decisions on which depend
    the financial stability and the livelihoods of employees. This is where probabilistic
    models for time-series come in. They help us make decisions when an estimate of
    certainty is important.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 概率是衡量某事发生可能性的指标。在销售预测中，不确定性的估计至关重要，因为这些预测提供了有关现金流、利润率和收入的洞察，进而驱动了商业决策，这些决策关系到财务稳定性和员工生计。这时，时间序列的概率模型派上了用场。它们帮助我们在需要确定性估计时做出决策。
- en: In this chapter, I'll introduce Prophet, Markov models, and Fuzzy time-series
    models. At the end, we'll go through an applied exercise with these methods.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我将介绍Prophet、马尔可夫模型和模糊时间序列模型。最后，我们将通过这些方法进行一个实际的练习。
- en: Another application for probabilistic modeling is estimating counterfactuals,
    where we can estimate treatment effects in experiments. We'll discuss the concept
    of Bayesian Structural Time-Series Models, and we'll run through a practical example
    with a time-series in the practice section.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 概率建模的另一个应用是估计反事实，其中我们可以估计实验中的治疗效果。我们将讨论贝叶斯结构时间序列模型的概念，并在实践部分通过一个时间序列的实际例子进行演示。
- en: 'We''re going to cover the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将涵盖以下主题：
- en: Probabilistic Models for Time-Series
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间序列的概率模型
- en: Prophet
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Prophet
- en: Markov Models
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 马尔可夫模型
- en: Fuzzy Modeling
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模糊建模
- en: Bayesian Structural Time-Series Models
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 贝叶斯结构时间序列模型
- en: 'Python Exercise:'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Python练习：
- en: Prophet
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 先知
- en: Markov Switching Model
  id: totrans-13
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 马尔可夫转换模型
- en: Fuzzy Time-Series
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模糊时间序列
- en: Bayesian Structural Time-Series Models
  id: totrans-15
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 贝叶斯结构时间序列模型
- en: We'll start with an introduction to probabilistic time-series predictions.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从时间序列概率预测的介绍开始。
- en: Probabilistic Models for Time-Series
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间序列的概率模型
- en: As mentioned in the introduction, probabilistic models can help us make decisions
    under uncertainty, and in situations where estimates have to come with quantified
    confidence, such as in financial forecasting, this can be crucial. For predictions
    of sales or cash flow, attaching probabilities to model predictions can make it
    easier for financial controllers and managers to act on the new information.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 如前言中所述，概率模型可以帮助我们在不确定性下做出决策，尤其是在估计必须带有量化置信度的情况下，如在财务预测中，这可能至关重要。对于销售或现金流的预测，将概率附加到模型预测中，可以使财务控制人员和经理更容易根据新信息采取行动。
- en: Some well-known algorithms include Prophet, explicitly designed for monitoring
    operational metrics and **key** **performance indicators** (**KPIs**), and Markov
    models. Others are stochastic deep learning models such as **DeepAR** and **DeepState**.
    Since we are dealing with deep learning models in *Chapter 10*, *Deep Learning
    Models*, we'll not deal with them in detail in this chapter.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 一些著名的算法包括专门用于监控操作指标和**关键** **绩效指标** (**KPIs**)的Prophet和马尔可夫模型。其他则是随机深度学习模型，如**DeepAR**和**DeepState**。由于我们将在*第10章*《深度学习模型》中讨论深度学习模型，因此本章不会详细讨论它们。
- en: The Prophet model comes from Facebook (Taylor and Letham, 2017) and is based
    on a decomposable model with interpretable parameters. A guiding design principle
    was that parameters can be intuitively adjusted by analysts.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Prophet模型源自Facebook（Taylor和Letham，2017），并基于一个可分解的模型，具有可解释的参数。一个设计原则是参数可以由分析师直观地进行调整。
- en: Both Prophet and the Silverkite algorithm, which we introduced in *Chapter 7*,
    *Machine Learning Models for Time-Series*, aim for accurate predictions with time-series
    that can have changing trends, seasonality, and recurring events (such as holidays),
    and short-term effects, and are therefore well suited for many applications in
    data science, where the focus is on tasks such as resource planning, optimizing
    financial decisions, and tracking progress for operational analysis – typical
    tasks for operations research.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: Prophet和我们在*第7章*《时间序列的机器学习模型》中介绍的Silverkite算法，旨在对具有变化趋势、季节性和重复事件（如假期）以及短期效应的时间序列进行准确预测，因此非常适合数据科学中的许多应用，尤其是在资源规划、优化财务决策和追踪运营分析进展等任务中，这些都是运筹学中的典型任务。
- en: Other types of models of particular interest within the application of time-series
    include Markov models, which we'll discuss in a dedicated section.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在时间序列应用中，其他类型的模型也特别重要，包括马尔可夫模型，我们将在专门的章节中进行讨论。
- en: '**Bayesian Structural Time-Series** (**BSTS**) models, which we mentioned in
    *Chapter 6*, *Unsupervised Models for Time-Series*, allow the quantification of
    the posterior uncertainty of the individual components, control the variance of
    the components, and impose prior beliefs on the model. The BSTS model is a technique
    that can be used for feature selection, time-series forecasting, and inferring
    causal relationships. This last point, causal inference, is another use case for
    probabilistic models in time-series. Understanding the impact of interventions
    can be important, for example, with A/B tests.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**贝叶斯结构时间序列**（**BSTS**）模型，我们在*第 6 章*，*无监督模型用于时间序列*中提到过，允许量化各个组件的后验不确定性，控制组件的方差，并对模型施加先验信念。BSTS
    模型是一种可以用于特征选择、时间序列预测和推断因果关系的技术。最后一点，因果推断，是概率模型在时间序列中的另一种应用。例如，在 A/B 测试中，了解干预的影响非常重要。'
- en: 'The following plot illustrates the popularity of a few selected probabilistic
    libraries suitable for time-series predictions:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表展示了适用于时间序列预测的几种选定概率库的受欢迎程度：
- en: '![probabilistic-star_history.png](img/B17577_09_01.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![probabilistic-star_history.png](img/B17577_09_01.png)'
- en: 'Figure 9.1: Libraries for the probabilistic modeling of time-series'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.1：用于概率建模时间序列的库
- en: You can see that, of these three libraries, `pyFTS` outranks the other two.
    I haven't included the `statsmodels` library, which includes a few probabilistic
    models. Neither have I included Prophet. Both `statsmodels` and Prophet would
    have outstripped HMMs by far, a library for Hidden Markov Models, and Pints, a
    library for noisy time-series.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以看到，在这三种库中，`pyFTS` 排名高于另外两个。我没有包含 `statsmodels` 库，它包括了一些概率模型。我也没有包括 Prophet。`statsmodels`
    和 Prophet 都远远超过了 HMMs，一个用于隐马尔可夫模型的库，以及 Pints，一个用于噪声时间序列的库。
- en: Neither have I included neural network or deep learning libraries such as TensorFlow
    Probability or Gluon-TS. Deep learning will be the topic of *Chapter 10*, *Deep
    Learning for Time-Series*.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 我也没有包含神经网络或深度学习库，如 TensorFlow Probability 或 Gluon-TS。深度学习将在*第 10 章*，*时间序列的深度学习*中讨论。
- en: Let's start with a forecasting model in Prophet!
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从 Prophet 中的一个预测模型开始！
- en: Prophet
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Prophet
- en: Facebook's Prophet is both a Python/R library and the algorithm that comes with
    it. The algorithm was published in 2017 ("Forecasting at Scale" by Sean Taylor
    and Benjamin Letham). The authors write that the problems of forecasting and anomaly
    detection in practice involve the complexity of handling a variety of idiosyncratic
    forecasting problems at Facebook with piecewise trends, multiple seasonalities,
    and floating holidays, and building trust across the organization in these forecasts.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: Facebook 的 Prophet 既是一个 Python/R 库，也是附带的算法。该算法于 2017 年发布（《Forecasting at Scale》由
    Sean Taylor 和 Benjamin Letham 编写）。作者指出，实践中的预测和异常检测问题涉及处理各种特殊的预测问题，这些问题在 Facebook
    中具有分段趋势、多重季节性和浮动假期，并且在整个组织中建立对这些预测的信任。
- en: With these goals in mind, Prophet was designed to be scalable to many time-series,
    flexible enough for a wide range of business-relevant, possibly idiosyncratic
    time-series, and at the same time intuitive enough to be configurable by domain
    experts who might have little knowledge of time-series methods.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到这些目标，Prophet 被设计成可以扩展到多个时间序列，足够灵活以适应各种可能具有特殊性、与业务相关的时间序列，并且足够直观，便于领域专家配置，即使他们对时间序列方法了解甚少。
- en: 'The Prophet algorithm is similar to the **Generalized Additive Model** (**GAM**)
    and formalizes the relationship between the forecast for the three model components,
    trend (growth), seasonality, and holiday, as follows:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: Prophet 算法类似于**广义加法模型**（**GAM**），并正式化了三种模型组件的预测关系：趋势（增长）、季节性和假期，如下所示：
- en: '![](img/B17577_09_001.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_001.png)'
- en: The error term epsilon represents the residual—idiosyncratic changes not accommodated
    by the model. All functions use time as the regressor. The three effects are additive;
    however, Sean Taylor and Benjamin Letham advise that multiplicative seasonality,
    where the seasonal effect is a factor that multiplies g(t), can be accomplished
    through a log transform.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 误差项 epsilon 代表残差——模型未能适应的特殊变化。所有函数都以时间作为回归变量。这三种效应是加法的；然而，Sean Taylor 和 Benjamin
    Letham 建议，可以通过对数变换实现乘法季节性，其中季节效应是一个乘以 g(t) 的因子。
- en: The trend or growth function can be linear or logistic for saturating growth.
    Both can incorporate piecewise effects through change points. The seasonality
    models periodic effects based on the Fourier series.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 趋势或增长函数可以是线性或对数型，适用于饱和增长。两者都可以通过变化点来融入分段效应。季节性模型基于傅里叶级数模拟周期性效应。
- en: Change point selection in Prophet is automated. Parameters are optimized via
    the Broyden–Fletcher–Goldfarb–Shanno (BFGS) algorithm, as implemented in the Stan
    platform for statistical modeling.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: Prophet中的变化点选择是自动化的。参数通过Broyden–Fletcher–Goldfarb–Shanno（BFGS）算法进行优化，该算法在统计建模平台Stan中得到了实现。
- en: Probabilistic models bring the advantage of providing a measure of certainty
    with the prediction; however, their predictions are not necessarily better than
    those of non-probabilistic models. Benchmark results of Prophet against other
    models have seen mixed results.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 概率模型的优点在于能够为预测提供一个确定性度量；然而，它们的预测不一定优于非概率模型。Prophet与其他模型的基准测试结果呈现出混合效果。
- en: In their 2020 paper "*A Worrying Analysis of Probabilistic Time-Series Models
    for Sales Forecasting*", Seungjae Jung and others validated probabilistic time-series
    models on a large-scale dataset. The univariate time-series consists of the daily
    sales from an e-commerce website.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在他们2020年的论文《*销售预测的概率时间序列模型分析*》中，Seungjae Jung及其团队在大规模数据集上验证了概率时间序列模型。该单变量时间序列包含了一个电子商务网站的每日销售数据。
- en: They compared two deep-learning probabilistic models, DeepAR and DeepState,
    and Prophet to baseline models that comprised a **moving average** (**MA**), **linear
    regression** (**LR**), a **multi-layer perceptron** (**MLP**), and **Seasonal
    ARIMA** (**SARIMA**). You should remember from *Chapter 5*, *Moving Averages and
    Autoregressive Models*, that the MA is a simple unweighted mean of preceding days.
    They tried 72 different hyperparameters for prophet and all baseline models.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 他们将两个深度学习概率模型DeepAR和DeepState与Prophet进行了比较，并与基准模型（包括**移动平均**（**MA**）、**线性回归**（**LR**）、**多层感知器**（**MLP**）和**季节性ARIMA**（**SARIMA**））进行了对比。你应该记得在*第5章*，*移动平均和自回归模型*中，MA是前几天的简单无权均值。他们对Prophet和所有基准模型尝试了72种不同的超参数。
- en: They found that probabilistic models in their test failed to outperform even
    the simplest baseline models such as MLP and LR in terms of **root mean squared
    error** (**RMSE**) and **mean absolute percentage error** (**MAPE**). Overall,
    Prophet performed the worst of all models. As always, model performance depends
    on the dataset and the task at hand—there's no silver bullet.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 他们发现，测试中的概率模型甚至未能在**均方根误差**（**RMSE**）和**平均绝对百分比误差**（**MAPE**）方面超越最简单的基准模型，如MLP和LR。总体而言，Prophet表现最差。正如往常一样，模型的表现依赖于数据集和任务本身——没有万能的解决方案。
- en: Let's see how Markov Models work!
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看马尔可夫模型是如何工作的！
- en: Markov Models
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 马尔可夫模型
- en: A Markov chain is a probabilistic model describing a sequence of possible events
    that satisfies the Markov property.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 马尔可夫链是一种概率模型，描述满足马尔可夫性质的可能事件序列。
- en: '**Markov property**: In a sequence or stochastic process that possesses the
    Markov property, the probability of each event depends only on the immediately
    preceding state (rather than earlier states). These sequences or processes can
    also be called **Markovian**, or a **Markov Process**.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '**马尔可夫性质**：在具有马尔可夫性质的序列或随机过程中，每个事件的概率仅取决于紧接其前的状态（而不是早期的状态）。这些序列或过程也可以称为**马尔可夫过程**，或者**马尔可夫过程**。'
- en: Named after Russian mathematician Andrey Markov, the Markov property is very
    desirable since it significantly reduces the complexity of a problem. In forecasting,
    instead of taking into account all previous states, t-1, t-2, …, 0, only t-1 is
    considered.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 以俄罗斯数学家安德烈·马尔可夫（Andrey Markov）命名，马尔可夫性质非常理想，因为它显著降低了问题的复杂性。在预测中，代替考虑所有之前的状态（t-1，t-2，…，0），只考虑t-1。
- en: Similarly, the **Markov assumption**, for a mathematical or machine learning
    model is that the sequence satisfies the Markov property. In models such as the
    Markov chain and Hidden Markov model, the process or sequence is assumed to be
    a Markov process.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，**马尔可夫假设**，对于一个数学或机器学习模型来说，是指序列满足马尔可夫性质。在如马尔可夫链和隐马尔可夫模型等模型中，过程或序列假设为马尔可夫过程。
- en: In a **discrete-time Markov chain** (**DTMC**), the sequence (or chain) transitions
    between states at discrete time steps. Markov chains can also be operating at
    continuous time steps. This less common model is called a **continuous-time Markov
    chain** (**CTMC**).
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在**离散时间马尔科夫链**（**DTMC**）中，序列（或链）在离散的时间步长之间转换状态。马尔科夫链也可以在连续时间步长下运行。这种不太常见的模型称为**连续时间马尔科夫链**（**CTMC**）。
- en: In a **hidden Markov model** (**HMM**), it is assumed that the process X follows
    unobservable states Y, which is another process whose behavior depends on X. The
    HMM models this latent or hidden process Y based on X.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在**隐马尔科夫模型**（**HMM**）中，假设过程X遵循不可观察的状态Y，Y是另一个过程，其行为依赖于X。HMM基于X建模这个潜在或隐藏的过程Y。
- en: 'Yet another Markov-type model is the nonlinear regime-switching model (also:
    Markov switching model). Invented by James Hamilton in 1989, the regime-switching
    model specifically addresses situations of abrupt changes, where more conventional
    linear models would struggle to capture distinct behaviors. The regime-switching
    model is an autoregressive model, where the mean of the process switches between
    regimes.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种马尔科夫类型模型是非线性状态转移模型（也称为：马尔科夫切换模型）。该模型由詹姆斯·汉密尔顿于1989年发明，专门用于处理突变情况，在这些情况下，传统的线性模型往往难以捕捉到明显的行为变化。状态转移模型是一种自回归模型，其中过程的均值在不同状态之间切换。
- en: For the practical example, we'll follow a `statsmodels` library implementation
    and build a model to replicate Hamilton's 1989 model. Hamilton modeled a time-series
    of the real gross national product (RGNP), a macroeconomic measure of the value
    of economic output adjusted for price changes, between 1951 and 1984\.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 对于实际例子，我们将遵循`statsmodels`库的实现，并构建一个模型来复制汉密尔顿1989年的模型。汉密尔顿在1951年到1984年间建模了实际国民生产总值（RGNP）的时间序列，RGNP是一个调整了价格变化的宏观经济指标，衡量经济产出的价值。
- en: 'We''ll use a Markov switching model of order 4, which can be written as follows:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一个四阶马尔科夫切换模型，可以写成如下形式：
- en: '![](img/B17577_09_002.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_002.png)'
- en: 'For each state (or period), the regime transitions according to the following
    matrix of transition probabilities:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个状态（或时期），状态转换按照以下转移概率矩阵进行：
- en: '![](img/B17577_09_003.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_003.png)'
- en: '![](img/B17577_09_004.png) is the probability of transitioning from regime
    i to regime j.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '![](img/B17577_09_004.png) 是从状态i转移到状态j的概率。'
- en: In this case, we are modeling two regimes.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们正在建模两个状态。
- en: In the next section, we'll discuss a Fuzzy approach to time-series modeling.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将讨论一种基于模糊方法的时间序列建模方法。
- en: Fuzzy Modeling
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 模糊建模
- en: Fuzzy logic and fuzzy set theory were developed by Lotfi Zadeh in the 1960s
    and 70s while a professor at the University of California, Berkeley. Born to Persian
    and Jewish Russian parents in Baku, Azerbaijan, he completed his schooling in
    Tehran, Iran, and later moved to the USA, where he studied at MIT and Columbia.
    As a result, he was familiar with how concepts are understood in different cultures
    and expressed in different languages. This inspired his research approach to approximate
    reasoning and linguistic variables that he formalized as fuzzy theory.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 模糊逻辑和模糊集理论是由洛特菲·扎德（Lotfi Zadeh）在1960年代和70年代发展起来的，当时他是加利福尼亚大学伯克利分校的教授。扎德出生于阿塞拜疆巴库，父母分别是波斯人和犹太俄罗斯人，他在伊朗德黑兰完成了学业，后来移居美国，在麻省理工学院和哥伦比亚大学学习。因此，他对不同文化中如何理解概念以及不同语言中如何表达这些概念非常熟悉。这激发了他对近似推理和语言变量的研究方法，并将其形式化为模糊理论。
- en: '**Fuzzy set theory** is an approach that can deal with problems relating to
    ambiguous, subjective, and imprecise judgments. Vagueness is inherent in everyday
    language, and fuzziness was invented to express this and work with it in an intuitive
    manner. Fuzzy logic expresses subjective belief and vagueness. It can and has
    been claimed that probability theory is a subset of fuzzy logic.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '**模糊集理论**是一种能够处理与模糊、主观和不精确判断相关问题的方法。模糊性是日常语言中的固有特征，而模糊性理论正是为了解释这一点并以直观的方式进行操作。模糊逻辑表达了主观信念和模糊性。可以说，概率论是模糊逻辑的一个子集。'
- en: '**Fuzzy sets** are sets whose elements have degrees of membership. In Fuzzy
    logic, instead of binary (Boolean) truth values, True and False, the unit interval
    [0, 1] is used as a basis for rules of inference. More formally, the membership
    function, which expresses the degree of certainty that an element belongs to the
    set, is characterized by a membership mapping function:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '**模糊集**是具有成员度的集合。在模糊逻辑中，规则推理的基础不再使用二值（布尔）真值“真”和“假”，而是使用单位区间[0, 1]。更正式地，成员函数表示元素属于集合的确定程度，由成员映射函数来表征：'
- en: '![](img/B17577_09_005.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_005.png)'
- en: For example, a well-known algorithm, **fuzzy c-means** (James Bezdek, 1981),
    based on k-means, returns degrees of membership to clusters. This means that each
    point can belong to each cluster, but to varying degrees. This fuzzy set membership
    is in contrast to the so-called crisp partitioning typically returned by other
    clustering algorithms, where a point is either a member of a cluster or not.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，基于k-means的著名算法**模糊C均值**（James Bezdek，1981），返回点属于各个簇的成员度。这意味着每个点可以属于每个簇，但程度不同。与此相对的是，其他聚类算法通常返回的所谓清晰划分，其中一个点要么属于某个簇，要么不属于。
- en: 'For fuzzy logic, all set operations, such as equality, sub- and superset, union,
    and intersection, had to be redefined. The union between two fuzzy sets (or relations)
    is defined as the max operation on each point, while the intersection is defined
    as the min operation. More formally, the union between two sets A and B, ![](img/B17577_09_006.png),
    is defined as:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 对于模糊逻辑，所有集合运算，如等价、子集与超集、并集和交集，都必须重新定义。两个模糊集（或关系）之间的并集被定义为每个点上的最大操作，而交集则定义为最小操作。更正式地，两个集合A和B之间的并集，![](img/B17577_09_006.png)，被定义为：
- en: '![](img/B17577_09_007.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_007.png)'
- en: where ![](img/B17577_09_008.png) is the membership function for point x.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 ![](img/B17577_09_008.png) 是点x的成员函数。
- en: 'Song and Chissom (1993) proposed a first-order, time-invariant fuzzy time-series
    model to forecast enrollments at the University of Alabama. This is formalized
    as follows:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: Song 和 Chissom（1993）提出了一种一阶、时不变的模糊时间序列模型，用于预测阿拉巴马大学的入学人数。其形式化如下：
- en: '![](img/B17577_09_009.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_009.png)'
- en: where ![](img/B17577_09_010.png) is the enrollment in year t, *R* is the union
    of fuzzy relations, and ![](img/B17577_09_011.png) is the fuzzy Max-Min composition
    operator.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 ![](img/B17577_09_010.png) 是第t年的入学人数，*R*是模糊关系的并集，![](img/B17577_09_011.png)
    是模糊Max-Min组合运算符。
- en: The **Max-Min composition operation**, ![](img/B17577_09_012.png), is obtained
    by taking the minimum term-by-term of the ith row of A and the jth column of B,
    and taking the maximum of these n minimums.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**Max-Min组合运算**，![](img/B17577_09_012.png)，是通过对A的第i行和B的第j列逐项取最小值，然后取这些n个最小值的最大值来获得的。'
- en: 'This is illustrated in the diagram below (from the Matrix Multiplication page
    on Wikipedia):'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 这在下面的图示中得到了说明（来自维基百科的矩阵乘法页面）：
- en: '![atrix multiplication diagram 2.svg](img/B17577_09_02.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![atrix multiplication diagram 2.svg](img/B17577_09_02.png)'
- en: 'Figure 9.2: The Max-Min composition operator'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.2：Max-Min组合运算符
- en: 'The values at the positions marked with circles are calculated as follows:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 用圆圈标记的各位置的值按以下方式计算：
- en: '![](img/B17577_09_013.png)![](img/B17577_09_014.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_013.png)![](img/B17577_09_014.png)'
- en: In Song and Chissom's approach, relations between values at time t and values
    preceding it are extracted and carried forward for the forecast. A necessary preprocessing
    step in their algorithm is the conversion of time-series X into a fuzzy time-series
    Y. This is called fuzzification and consists of constraining an input from the
    set of real values to fuzzy memberships of a discrete set. This quantization can
    be performed by vector quantization methods such as Kohonen Self-Organizing Maps
    (SOM), an unsupervised machine learning method that produces a low-dimensional
    representation.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在Song和Chissom的方法中，提取当前时刻t与其之前时刻的值之间的关系，并将其用于预测。算法中的一个必要预处理步骤是将时间序列X转换为模糊时间序列Y。这个过程称为模糊化，指的是将来自实数集的输入约束为离散集的模糊成员。这个量化过程可以通过向量量化方法来执行，比如Kohonen自组织映射（SOM），这是一种无监督机器学习方法，能够产生低维表示。
- en: While fuzzy time-series models have not enjoyed widespread application, they
    have been shown to be competitive in some applications to more traditional approaches,
    such as SARIMA (for example, Maria Elena et al., 2012). They work on discrete
    and continuous time-series and produce interpretable models for forecasting.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管模糊时间序列模型尚未广泛应用，但在一些应用中，它们已被证明与传统方法（如SARIMA）具有竞争力（例如，Maria Elena等，2012）。它们适用于离散和连续时间序列，并为预测提供可解释的模型。
- en: In the following section, we'll do a few practice examples for probabilistic
    time-series predictions.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分，我们将做一些概率时间序列预测的练习示例。
- en: Bayesian Structural Time-Series Models
  id: totrans-80
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 贝叶斯结构时间序列模型
- en: 'In causal inference, we want to analyze the effect of a treatment. The treatment
    can be any action that interacts with the system or environment that we care about,
    from changing the colors of a button on a website to the release of a product.
    We have the choice of taking the action (for example, releasing the product),
    thereby observing the outcome under treatment, or not taking the action, where
    we observe the outcome under no treatment. This is illustrated in the diagram
    here:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在因果推断中，我们想分析某个治疗的效果。治疗可以是任何与我们关心的系统或环境互动的行为，从改变网站按钮的颜色到发布一个产品。我们可以选择采取行动（例如发布产品），从而观察治疗下的结果，或者不采取行动，这时我们观察到未治疗下的结果。这个过程在下图中有所示例：
- en: '![../causal%20(1).png](img/B17577_09_03.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![../causal%20(1).png](img/B17577_09_03.png)'
- en: 'Figure 9.3: Causal effect of a treatment'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.3：治疗的因果效应
- en: In the diagram, an action is taken or not (medicine is administered to a patient),
    and depending on whether the action is taken we see the patient recovering (cycling)
    or going into intensive care.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在图示中，是否采取某个行动（给患者服药），根据是否采取行动，患者可能会康复（循环恢复）或进入重症监护室。
- en: A causal effect is the difference between what happens under treatment and what
    happens under no treatment. The problem with this is that we can't observe both
    potential outcomes at the same time.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 因果效应是治疗下发生的事情与未治疗下发生的事情之间的差异。问题在于，我们无法同时观察到两个潜在的结果。
- en: However, we can run an experiment to observe both potential outcomes under treatment
    and potential outcomes under no treatment, such as in an A/B test, where the treatment
    is given only to a subset of the total population and the treatment condition
    B can be compared against the control condition A.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，我们可以通过实验来观察治疗下的潜在结果和未治疗下的潜在结果，例如在A/B测试中，治疗只施加在总人口的一个子集上，条件B与控制条件A进行比较。
- en: 'We can tabulate potential outcomes like this:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以像这样列出潜在结果：
- en: '| Unit | Treatment status, ![](img/B17577_09_015.png) | Outcome under treatment,
    ![](img/B17577_09_016.png) | Outcome under no treatment, ![](img/B17577_09_017.png)
    | Covariates, ![](img/B17577_09_018.png) |'
  id: totrans-88
  prefs: []
  type: TYPE_TB
  zh: '| 单位 | 治疗状态，![](img/B17577_09_015.png) | 治疗下的结果，![](img/B17577_09_016.png)
    | 未治疗下的结果，![](img/B17577_09_017.png) | 协变量，![](img/B17577_09_018.png) |'
- en: '| 1 | 1 | ![heck mark, Segoe UI Symbol font, character code 2714 hex.](img/B17577_09_04.png)
    | estimate | ![heck mark, Segoe UI Symbol font, character code 2714 hex.](img/B17577_09_04.png)
    |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 1 | ![对号，Segoe UI符号字体，字符代码2714十六进制](img/B17577_09_04.png) | 估计 | ![对号，Segoe
    UI符号字体，字符代码2714十六进制](img/B17577_09_04.png) |'
- en: '| 2 | 1 | ![heck mark, Segoe UI Symbol font, character code 2714 hex.](img/B17577_09_04.png)
    | estimate | ![heck mark, Segoe UI Symbol font, character code 2714 hex.](img/B17577_09_04.png)
    |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 1 | ![对号，Segoe UI符号字体，字符代码2714十六进制](img/B17577_09_04.png) | 估计 | ![对号，Segoe
    UI符号字体，字符代码2714十六进制](img/B17577_09_04.png) |'
- en: '| 3 | 0 | estimate | ![heck mark, Segoe UI Symbol font, character code 2714
    hex.](img/B17577_09_04.png) | ![heck mark, Segoe UI Symbol font, character code
    2714 hex.](img/B17577_09_04.png) |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 0 | 估计 | ![对号，Segoe UI符号字体，字符代码2714十六进制](img/B17577_09_04.png) | ![对号，Segoe
    UI符号字体，字符代码2714十六进制](img/B17577_09_04.png) |'
- en: '| 4 | 0 | estimate | ![heck mark, Segoe UI Symbol font, character code 2714
    hex.](img/B17577_09_04.png) | ![heck mark, Segoe UI Symbol font, character code
    2714 hex.](img/B17577_09_04.png) |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 0 | 估计 | ![对号，Segoe UI符号字体，字符代码2714十六进制](img/B17577_09_04.png) | ![对号，Segoe
    UI符号字体，字符代码2714十六进制](img/B17577_09_04.png) |'
- en: 'Figure 9.4: Potential outcomes from an experiment'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.4：实验中的潜在结果
- en: In the first column, *Unit*, we see the sample indexes. Each row refers to a
    separate unit or sample in the population. The second column (*Treatment status*)
    encodes if the treatment was administered (1) or not (0). In the third and fourth
    columns, *Outcome under treatment* and *Outcome under no treatment*, respectively,
    are registered.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一列中，*单位*，我们看到了样本索引。每一行都指的是人口中的一个单独单位或样本。第二列（*治疗状态*）编码了是否施行了治疗（1）或未施行治疗（0）。在第三和第四列中，*治疗下的结果*和*非治疗下的结果*分别记录。
- en: 'The marks show what should be obvious: when there is a treatment, we can observe
    the outcomes under treatment, but not the outcomes under no treatment. Inversely,
    when there is no treatment, we can observe the outcomes under no treatment, but
    not the outcomes under treatment.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 这些标记显示了显而易见的事实：当有治疗时，我们可以观察治疗下的结果，但无法观察非治疗下的结果。反之亦然，当没有治疗时，我们可以观察非治疗下的结果，但无法观察治疗下的结果。
- en: Finally, in the last column, there are additional variables that can help us
    in our model that are available irrespective of treatment or no treatment.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，在最后一列中，还有一些无论治疗与否都可以帮助我们的模型的额外变量。
- en: With **Bayesian Structural Time-Series** (**BSTS**), the focus is on estimating
    the treatment effect in the absence of an experiment. We can estimate or impute
    the counterfactuals, which are the unknown potential outcomes of an experiment.
    This allows to compare the outcomes under treatment against outcomes under no
    treatment, and therefore to quantify the causal treatment effect.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**贝叶斯结构时间序列**（**BSTS**），重点是在没有实验的情况下估计治疗效应。我们可以估计或插补反事实，即实验中未知的潜在结果。这允许我们比较治疗下的结果与非治疗下的结果，从而量化因果治疗效应。
- en: 'The model consists of three main components:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 该模型由三个主要组件组成：
- en: Kalman filter
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 卡尔曼滤波器
- en: Variable selection
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 变量选择
- en: Bayesian model averaging
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 贝叶斯模型平均
- en: Kalman filters are used for time-series decomposition. This allows the modeling
    of trends, seasonality, and holidays. In the Bayesian variable selection step
    (the spike-and-slab technique), the most important regression predictors are selected.
    Finally, in the model averaging, the prediction results are combined.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 卡尔曼滤波器用于时间序列分解。这允许对趋势、季节性和假期进行建模。在贝叶斯变量选择步骤（尖峰与平板技术）中，选择最重要的回归预测变量。最后，在模型平均中，将预测结果结合起来。
- en: The application of BSTS models for change point and anomaly detection was described
    in the paper "*Predicting the Present with Bayesian Structural Time-Series*" (2013),
    by Steven L. Scott and Hal Varian.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在2013年的论文"*用贝叶斯结构时间序列预测现在*"中描述了BSTS模型在变点和异常检测中的应用，作者是Steven L. Scott和Hal Varian。
- en: A paper outlining the application of BSTS for estimating the causal effect of
    interventions was published in 2015 by Google Research ("*Inferring causal impact
    using Bayesian structural time-series models*", by Kay H. Brodersen, Fabian Gallusser,
    Jim Koehler, Nicolas Remy, and Steven L. Scott).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 2015年Google Research发表了一篇论文，概述了BSTS在估计干预因果效应中的应用（"*使用贝叶斯结构时间序列模型推断因果影响*"，作者是Kay
    H. Brodersen、Fabian Gallusser、Jim Koehler、Nicolas Remy和Steven L. Scott）。
- en: The mathematical details of this are beyond the scope of this chapter. Fortunately,
    we can use a Python library to apply BSTS models. We'll run through an example
    in a practice section of this chapter.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 这一数学细节超出了本章的范围。幸运的是，我们可以使用Python库应用BSTS模型。我们将在本章的实践部分中运行一个示例。
- en: We can practice now some of the theory that we have learned so far in this chapter.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以在本章学到的一些理论上进行实践。
- en: Python Exercise
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Python练习
- en: Let's put into practice what we've learned in this chapter so far. We'll be
    doing a model in Prophet, a Markov Switching model, a Fuzzy time-series model,
    and a BSTS model.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们把到目前为止在本章学到的东西付诸实践。我们将在Prophet中做一个模型，一个Markov切换模型，一个模糊时间序列模型和一个BSTS模型。
- en: Let's get started with Prophet!
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始使用Prophet吧！
- en: Prophet
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Prophet
- en: 'First, let''s make sure we have everything installed that we need. Let''s quickly
    install the required libraries. We can do this from the terminal (or similarly
    from the Anaconda navigator):'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们确保我们已经安装了我们需要的一切。我们可以通过终端（或类似地通过Anaconda导航器）快速安装所需的库。
- en: '[PRE0]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: You'll need a recent version of pandas-datareader, otherwise you might get a
    `RemoteDataError`.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 您将需要一个最新版本的pandas-datareader，否则可能会出现`RemoteDataError`。
- en: 'We''ll use the Prophet model through Facebook''s Prophet library. Let''s install
    it:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过Facebook的Prophet库使用Prophet模型。让我们安装它：
- en: '[PRE1]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Once this is done, we are set to go.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦完成这些，我们就可以开始了。
- en: In this example, we'll use the daily Yahoo closing stock values in this chapter
    that we used in several examples in *Chapter 7*, *Machine Learning Models for
    Time-Series*.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将使用第七章*时间序列的机器学习模型*中使用过的Yahoo每日收盘股票数据。
- en: 'To recap, we can download the daily Yahoo stock history from 2001 to 2021 in
    pandas-datareader as follows:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 简而言之，我们可以通过以下方式下载2001到2021年的Yahoo每日股票历史数据，使用pandas-datareader：
- en: '[PRE2]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'This gives us a pandas DataFrame with two columns, the adjusted daily closing
    value and the date. Let''s quickly check the datatypes of these two columns:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这为我们提供了一个pandas DataFrame，包含两个列：调整后的每日收盘值和日期。让我们快速检查这两列的数据类型：
- en: '[PRE3]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'These are the datatypes:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是数据类型：
- en: '[PRE4]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The `Date` column is datetime in nanoseconds. `Adj Close` is of type float.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '`Date`列是以纳秒为单位的日期时间。`Adj Close`是浮动类型。'
- en: 'We''ll feed this into the `fit()` method for training:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将把数据输入到`fit()`方法中进行训练：
- en: '[PRE5]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: We have to rename our columns `ds` and `y` in order to stick to the Prophet
    conventions. We have a trained Prophet model now.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要将列重命名为`ds`和`y`，以符合Prophet的约定。现在我们已经有了一个训练好的Prophet模型。
- en: 'We''ll then create a new DataFrame that will have future dates. We''ll be able
    to stick this DataFrame into the `predict()` method of the Prophet model:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将创建一个新的DataFrame，其中包含未来的日期。我们可以将这个DataFrame传递给Prophet模型的`predict()`方法：
- en: '[PRE6]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The forecast is calling the `predict()` method with this new DataFrame:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 预测是通过这个新的DataFrame调用`predict()`方法：
- en: '[PRE7]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The `forecast` DataFrame contains the upper and lower confidence intervals alongside
    the forecast. The `ds` columns is the date corresponding to the forecast.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '`forecast` DataFrame包含了预测值以及上下置信区间。`ds`列是与预测值对应的日期。'
- en: 'Let''s plot the forecasts against the actual data:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将预测与实际数据进行对比绘图：
- en: '[PRE8]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Here''s the plot:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 这是图表：
- en: '![](img/B17577_09_05.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_05.png)'
- en: 'Figure 9.5: Forecast versus actual time-series (Prophet)'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.5：预测与实际时间序列（Prophet）
- en: You might want to compare this plot to the one in *Chapter 7*,*Machine Learning
    Models for Time-Series*. The actual data is thick and bold, while the forecast
    is thinner. The upper and lower confidence intervals are around the forecast.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能想把这个图与*第七章*，*时间序列的机器学习模型*中的图进行比较。实际数据是粗体且较粗，而预测则较细。上下置信区间围绕着预测值。
- en: 'We can inspect the forecasts by looking at the DataFrame:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过查看DataFrame来检查预测结果：
- en: '![](img/B17577_09_06.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B17577_09_06.png)'
- en: 'Figure 9.6: Table of forecasts (Prophet)'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.6：预测表（Prophet）
- en: It is quite easy to get a first model, and there are many ways to tweak it.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 获取第一个模型非常简单，并且有很多方法可以进行调整。
- en: Markov Switching Model
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 马尔科夫切换模型
- en: 'For the Markov Switching model, we''ll use the `statsmodels` library. If you
    don''t have it installed yet, you can install it like this:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 对于马尔科夫切换模型，我们将使用`statsmodels`库。如果你还没有安装它，可以通过以下方式安装：
- en: '[PRE9]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We''ll use a dataset with `statsmodels` in this example. This is based on the
    `statsmodels` tutorial on Markov switching autoregression models. We can get the
    dataset from the Stata Press publishing house on their website:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将使用`statsmodels`的数据集。这个数据集基于`statsmodels`关于马尔科夫切换自回归模型的教程。我们可以从Stata
    Press出版社的网站上获取数据集：
- en: '[PRE10]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This gives us a pandas series of the RGNP, and the index annotates the dates.
    Let''s quickly plot this:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 这为我们提供了一个RGNP的pandas序列，索引标注了日期。让我们快速绘制这个图：
- en: '[PRE11]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'We get the following plot:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到以下图表：
- en: '![RGNP.png](img/B17577_09_07.png)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![RGNP.png](img/B17577_09_07.png)'
- en: 'Figure 9.7: Growth rate of RGNP'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.7：RGNP增长率
- en: We'll model domestic recessions and expansions. The model will include transition
    probabilities between these two regimes and predict probabilities of expansion
    or recession at each time point.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将建模国内衰退和扩张。该模型将包括这两个状态之间的转移概率，并预测每个时间点扩张或衰退的概率。
- en: 'Let''s fit the 4^(th) order Markov switching model. We''ll specify two regimes:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将拟合四阶马尔科夫切换模型。我们将指定两个状态：
- en: '[PRE12]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: We now have the model fitted via maximum likelihood estimation to the RGNP data.
    We've set `switching_ar=False` because the `statsmodels` implementation defaults
    to switching autoregressive coefficients.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经通过最大似然估计拟合了RGNP数据。我们设置了`switching_ar=False`，因为`statsmodels`的实现默认使用切换自回归系数。
- en: 'Let''s have a look at the `statsmodels` model summary:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看`statsmodels`模型的摘要：
- en: '[PRE13]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'We get the following output (truncated):'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到以下输出（截断）：
- en: '![/var/folders/80/g9sqgdws2rn0yc3rd5y3nd340000gp/T/TemporaryItems/NSIRD_screencaptureui_qPxkLo/Screenshot
    2021-07-11 at 18.36.54.png](img/B17577_09_08.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![/var/folders/80/g9sqgdws2rn0yc3rd5y3nd340000gp/T/TemporaryItems/NSIRD_screencaptureui_qPxkLo/Screenshot
    2021-07-11 at 18.36.54.png](img/B17577_09_08.png)'
- en: 'Figure 9.8: Markov Switching Model Results'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.8：马尔可夫切换模型结果
- en: We can see that we have two sets of parameters, one each for the two regimes.
    We also get measures of the statistical model quality (such as AIC and BIC).
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到我们有两组参数，每组对应一个制度。我们还得到了统计模型质量的度量（如 AIC 和 BIC）。
- en: 'At the bottom of the same output, we can see the regime transition parameters:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在相同输出的底部，我们可以看到制度转换参数：
- en: '![../../Desktop/Screenshot%202021-07-11%20at%2018.40.01.pn](img/B17577_09_09.png)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![../../Desktop/Screenshot%202021-07-11%20at%2018.40.01.pn](img/B17577_09_09.png)'
- en: 'Figure 9.9: Regime transition parameters'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.9：制度转换参数
- en: These are the regime transitions we mentioned in the theory section on Markov
    Switching models.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是我们在马尔可夫切换模型理论部分中提到的制度转换。
- en: 'Let''s see the lengths of recession and expansion:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看一下衰退和扩张的长度：
- en: '[PRE14]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The output `array([ 4.07604793, 10.4258926 ])` is in financial quarters. Therefore,
    a recession is expected to take about four quarters (1 year) and an expansion
    10 quarters (two and a half years).
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 输出 `array([ 4.07604793, 10.4258926 ])` 以财务季度为单位。因此，预计衰退将持续约四个季度（一年），扩张将持续十个季度（两年半）。
- en: 'Next, we''ll plot the probability of recession at each point in time. However,
    this is more informative if we overlay indicators of recession by the National
    Bureau of Economic Research (NBER), which we can load up with pandas-dataloader:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将绘制每个时间点的衰退概率。然而，如果我们叠加由美国国家经济研究局（NBER）提供的衰退指标，这将更具信息性，我们可以使用 pandas-dataloader
    来加载这些数据：
- en: '[PRE15]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'This gives us a DataFrame in which recessions are indicated. Here are the first
    five rows:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 这为我们提供了一个数据框，指示了衰退情况。以下是前五行数据：
- en: '![/var/folders/80/g9sqgdws2rn0yc3rd5y3nd340000gp/T/TemporaryItems/NSIRD_screencaptureui_P2RnuW/Screenshot
    2021-07-11 at 19.00.46.png](img/B17577_09_10.png)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![/var/folders/80/g9sqgdws2rn0yc3rd5y3nd340000gp/T/TemporaryItems/NSIRD_screencaptureui_P2RnuW/Screenshot
    2021-07-11 at 19.00.46.png](img/B17577_09_10.png)'
- en: 'Figure 9.10: Recession indicators by NBER'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.10：由 NBER 提供的衰退指标
- en: In the first five rows, there was no recession according to NBER indicators.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在前五行数据中，根据 NBER 指标没有发生衰退。
- en: 'We''ll now plot NBER recession indicators against the model regime predictions:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将绘制 NBER 衰退指标与模型制度预测的对比：
- en: '[PRE16]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'This gives us actual recession data against model predictions:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 这为我们提供了实际的衰退数据与模型预测的对比：
- en: '![filtered_probability_of_recession.png](img/B17577_09_11.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![filtered_probability_of_recession.png](img/B17577_09_11.png)'
- en: 'Figure 9.11: Filtered probability of recession'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.11：过滤后的衰退概率
- en: We can see there seems to be quite a good match between the model predictions
    and actual recession indicators.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，模型预测和实际衰退指标之间似乎有很好的匹配。
- en: Unfortunately, the `statsmodels` implementation doesn't provide the functionality
    for forecasting or out-of-sample prediction, so we'll end the brief demo here.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，`statsmodels` 实现并未提供预测或样本外预测的功能，因此我们将在此结束简短的演示。
- en: '`Statsmodels` includes other datasets for regime-switching models to play around
    with.'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '`Statsmodels` 包含其他用于制度切换模型的数据集供我们探索。'
- en: In the following practice section, we'll apply Song and Chissom's model to a
    time-series forecasting problem using the `pyFTS` library for fuzzy time-series
    developed in the MINDS laboratory at the Universidade Federal de Minas Gerais
    (UFMG), Brazil.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的实践部分，我们将使用 `pyFTS` 库（由巴西米纳斯吉拉斯联邦大学（UFMG）的 MINDS 实验室开发）将宋氏和奇索姆的模型应用于时间序列预测问题。
- en: Fuzzy Time-Series
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模糊时间序列
- en: In this section, we'll load two time-series of ticker symbols, the NASDAQ and
    the S&P 500 indices, over time and forecast them using Song and Chissom's 1993
    algorithm. This follows closely the example tutorial in the library.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将加载两个时间序列，分别是纳斯达克指数和标准普尔500指数，并使用宋氏和奇索姆1993年的算法进行预测。这与该库中的示例教程非常接近。
- en: 'First, we''ll install the library from the terminal (or similarly from the
    Anaconda navigator):'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将从终端（或类似的 Anaconda 导航器）安装该库：
- en: '[PRE17]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Then, we''ll define our datasets:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将定义我们的数据集：
- en: '[PRE18]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Both datasets, the entries in our `datasets` dictionary, are vectors of roughly
    4,000 scalar values. We''ll take about 50% of these points for training, and we''ll
    set this as a constant:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 两个数据集，即我们 `datasets` 字典中的条目，是大约 4000 个标量值的向量。我们将使用其中约 50% 的点进行训练，并将其设置为常量：
- en: '[PRE19]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The model assumes a stationary process, so we'll need to preprocess our time-series
    by temporal differencing as discussed in *Chapter 2*, *Exploratory Time-Series
    Analysis with Time-Series*.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 该模型假设是平稳过程，因此我们需要按照*第二章*《探索性时间序列分析》中讨论的那样，通过时间差分预处理我们的时间序列。
- en: 'We''ll define a first-order differencing operation for preprocessing:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将定义一个一阶差分操作进行预处理：
- en: '[PRE20]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Let''s plot our time-series and the transformation:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们绘制我们的时间序列和其变换：
- en: '[PRE21]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The plots of the original and transformed time-series look like this:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 原始时间序列和转化后的时间序列的图表如下所示：
- en: '![nasdaq_sp500.png](img/B17577_09_12.png)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![nasdaq_sp500.png](img/B17577_09_12.png)'
- en: 'Figure 9.12: NASDAQ and S&P 500—the original and transformed time-series'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.12: 纳斯达克和标准普尔500指数——原始和转化后的时间序列'
- en: In the GitHub repository for this, you can see the Augmented Dickey-Fuller unit
    root test applied to the transformed time-series. This test for stationarity gives
    us the green light, and we continue with our model.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个 GitHub 仓库中，您可以看到应用于变换后时间序列的增广迪基-富勒单位根检验。该平稳性检验为我们提供了绿灯，我们继续进行模型构建。
- en: 'The next step is training our models for the two transformed (differenced)
    time-series:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是训练我们针对两个转化后的（差分）时间序列的模型：
- en: '[PRE22]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: We iterate over the datasets and train a separate model for each, which we save
    into a dictionary, `models`. The training consists of extracting relations from
    the training set.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 我们遍历数据集，并为每个数据集训练一个独立的模型，将其保存在字典 `models` 中。训练过程包括从训练集中提取关系。
- en: As part of the model training, the preprocessed time-series is quantized as
    discussed in the theory section on fuzzy time-series models of this chapter.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 作为模型训练的一部分，预处理的时间序列会按照本章中模糊时间序列模型的理论部分进行量化。
- en: 'We can plot our forecasts from the two models:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以绘制两个模型的预测结果：
- en: '[PRE23]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Again, we iterate over the two datasets. This time, we plot the original values
    in the test set (200 points) against estimated values predicted one step ahead.
    Please note that the models are not updated based on new data during the prediction.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，我们遍历这两个数据集。这次，我们将测试集中的原始值（200个点）与预测的一步前值进行对比。请注意，在预测过程中模型并不会根据新数据进行更新。
- en: 'This is our plot comparing the forecasts against the actual values in the test
    set:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们将预测结果与测试集中的实际值进行比较的图表：
- en: '![fuzzy_predicted_actual.png](img/B17577_09_13.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![fuzzy_predicted_actual.png](img/B17577_09_13.png)'
- en: 'Figure 9.13: Fuzzy time-series forecast versus actual (S&P 500, NASDAQ).'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.13: 模糊时间序列预测与实际值对比（标准普尔500，纳斯达克）。'
- en: Looking at these charts, the predictions look quite promising, but let's look
    at some hard numbers!
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 看这些图表，预测看起来相当有希望，但让我们看看一些实际数字！
- en: '`PyFTS` has a convenience function to extract RMSE, MAPE, and finally, Theil''s
    U, a measure of correlation. We introduced these measures in *Chapter 2*, *Exploratory
    Time-Series Analysis with Time-Series*.'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: '`PyFTS` 提供了一个方便的函数来提取 RMSE、MAPE，以及最后的 Theil''s U，这是一个相关性度量。我们在*第二章*中介绍了这些度量，*探索性时间序列分析与时间序列*。'
- en: '[PRE24]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'We get these statistics:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到这些统计数据：
- en: '![/var/folders/80/g9sqgdws2rn0yc3rd5y3nd340000gp/T/TemporaryItems/NSIRD_screencaptureui_PJYAmO/Screenshot
    2021-07-11 at 23.36.47.png](img/B17577_09_14.png)'
  id: totrans-216
  prefs: []
  type: TYPE_IMG
  zh: '![/var/folders/80/g9sqgdws2rn0yc3rd5y3nd340000gp/T/TemporaryItems/NSIRD_screencaptureui_PJYAmO/Screenshot
    2021-07-11 at 23.36.47.png](img/B17577_09_14.png)'
- en: 'Figure 9.14: Model statistics for fuzzy time-series modeling of NASDAQ and
    S&P 500'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.14: 纳斯达克和标准普尔500的模糊时间序列建模统计数据'
- en: I'll leave it as an exercise for the reader to compare these two models with
    others based on these error metrics.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 我将把比较这两个模型与其他模型的练习留给读者，通过这些误差指标进行对比。
- en: Bayesian Structural Time-Series Modeling
  id: totrans-219
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 贝叶斯结构时间序列建模
- en: In this example, we'll apply BSTS modeling to understand the causal effect of treatment
    in time-series.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将应用 BSTS 建模来理解时间序列中治疗的因果效应。
- en: 'First, we''ll install the library:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将安装这个库：
- en: '[PRE25]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Now, we'll load a dataset, and we'll estimate the consequence of a treatment.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将加载一个数据集，并估计治疗的结果。
- en: 'Here, we''ll be estimating the impact of the emissions scandal of September
    2015 for Volkswagen. We''ll work with the stock values of three big companies,
    Volkswagen, BMW, and Allianz. The dataset comes with the Python Causal Impact
    (tfcausalimpact) library:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将估计2015年9月大众汽车排放丑闻的影响。我们将使用三家大公司的股票价值数据，分别是大众汽车、宝马和安联。数据集与 Python Causal
    Impact（tfcausalimpact）库一起提供：
- en: '[PRE26]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Now we have the stock values. Let''s plot them:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经有了股票价值。让我们绘制它们：
- en: '[PRE27]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Here are the stocks over time:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是股票的时间变化：
- en: '![emission_scandal_stocks.png](img/B17577_09_15.png)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![emission_scandal_stocks.png](img/B17577_09_15.png)'
- en: 'Figure 9.15: Stock values of three big companies (Volkswagen, BMW, Allianz)'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '图 9.15: 三家大公司的股票价值（大众汽车，宝马，安联）'
- en: 'We can see a sharp drop in the value of Volkswagen shares in late 2015\. Let''s
    try to find out the actual impact of the emission scandal. We can build our model
    like this:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，2015年底大众汽车股票的价值急剧下跌。让我们尝试找出排放丑闻的实际影响。我们可以这样构建我们的模型：
- en: '[PRE28]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'The model statistics provide us with the causal impact estimate:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 模型统计数据为我们提供了因果影响估计：
- en: '[PRE29]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'We see these stats here:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里看到了这些统计数据：
- en: '[PRE30]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Figure 9.16: Causal impact estimates and model statistics'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.16：因果影响估计与模型统计
- en: As discussed before, the Causal Impact model developed by Google works by fitting
    a BSTS model to observed data, which is later used to predict what the results
    would be had no intervention happened in a given time period.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Google开发的因果影响模型通过将BSTS模型拟合到观察数据来工作，随后用于预测如果在给定时间段内没有发生干预，结果会是怎样。
- en: 'The total estimated effect is about 44 points—the stock price would be 44 points
    higher if not for the emissions scandal. The impact summary report gives us this
    analysis (excerpt):'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 总体估计效应约为44个点——如果没有排放丑闻，股票价格将高出44个点。影响总结报告为我们提供了以下分析（摘录）：
- en: '[PRE31]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Figure 9.17: Causal impact analysis report'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.17：因果影响分析报告
- en: This gives us a very good idea of what the model estimates.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 这为我们提供了关于模型估计的非常好的概念。
- en: 'We can plot the effect as well:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也可以绘制效应图：
- en: '[PRE32]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'The plot is as follows:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 绘图如下：
- en: '![/var/folders/80/g9sqgdws2rn0yc3rd5y3nd340000gp/T/TemporaryItems/NSIRD_screencaptureui_OzvijR/Screenshot
    2021-07-18 at 17.03.38.png](img/B17577_09_16.png)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![/var/folders/80/g9sqgdws2rn0yc3rd5y3nd340000gp/T/TemporaryItems/NSIRD_screencaptureui_OzvijR/Screenshot
    2021-07-18 at 17.03.38.png](img/B17577_09_16.png)'
- en: 'Figure 9.18: Causal impact graph'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 图9.18：因果影响图
- en: Again, we see the original time-series against the predicted counterfactual
    value.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，我们看到原始时间序列与预测的反事实值。
- en: The emissions scandal wiped out a massive amount of value from Volkswagen. The
    44 points can give us a monetary value of how much cheating emissions tests cost
    Volkswagen.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 排放丑闻使大众汽车损失了大量的价值。这44个点可以为我们提供作弊排放测试对大众汽车造成的金钱损失。
- en: Summary
  id: totrans-250
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we've discussed how probabilistic models for time-series can
    help us make decisions with an estimate of uncertainty in the context of financial
    forecasting. These forecasts drive business decisions for financial planning.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了如何使用时间序列的概率模型帮助我们在金融预测的背景下做出带有不确定性估计的决策。这些预测驱动着财务规划的商业决策。
- en: I've introduced Prophet, Markov models, and Fuzzy time-series models. We've
    discussed the components of Facebook's Prophet model. For Markov models, we've
    discussed the main ideas, such as the Markov property, and we've discussed more
    details regarding Switching Models. Then I've explained some basics of fuzzy set
    theory and how this is applied to time-series.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 我已经介绍了Prophet、马尔可夫模型和模糊时间序列模型。我们讨论了Facebook的Prophet模型的组成部分。对于马尔可夫模型，我们讨论了主要的概念，如马尔可夫性质，并详细讨论了转换模型。接着，我解释了模糊集合理论的一些基础知识以及它如何应用于时间序列。
- en: Finally, we've delved into the intuition and some of the theory of BSTS models
    in the context of estimating treatment effects in experiments.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们深入探讨了BSTS模型的直觉以及在实验中估计处理效应的一些理论。
- en: Finally, we went through an applied exercise with each method. In the BSTS practice,
    we've looked at the effect of the Volkswagen emissions scandal.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们通过每种方法进行了一次应用练习。在BSTS实践中，我们研究了大众排放丑闻的影响。
